{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626",
    "id": 1347147288,
    "node_id": "PR_kwDOABII585QS9YY",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/27626",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/27626.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/27626.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
    "number": 27626,
    "state": "closed",
    "locked": false,
    "maintainer_can_modify": false,
    "title": "Parallel compact block downloads, take 3",
    "user": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This is an attempt at mitigating https://github.com/bitcoin/bitcoin/issues/25258 , which is a revival of https://github.com/bitcoin/bitcoin/pull/10984, which is a revival of https://github.com/bitcoin/bitcoin/pull/9447.\r\n\r\nThis PR attempts to mitigate a single case, where high bandwidth peers can bail us out of a flakey\r\npeer not completing blocks for us. We allow up to 2 additional getblocktxns requests per unique block.\r\nThis would hopefully allow the chance for an honest high bandwidth peer to hand us the transactions\r\neven if the first in flight peer stalls out.\r\n\r\nIn contrast to previous effort:\r\n\r\n1) it will not help if subsequent peers send block headers only, so only high-bandwidth peers this time. See: https://github.com/bitcoin/bitcoin/pull/10984/files#diff-6875de769e90cec84d2e8a9c1b962cdbcda44d870d42e4215827e599e11e90e3R1411\r\n2)  `MAX_GETBLOCKTXN_TXN_AFTER_FIRST_IN_FLIGHT` is removed, in favor of aiding recovery during turbulent mempools\r\n3) We require one of the 3 block fetching slots to be an outbound peer. This can be the original offering peer, or subsequent compact blocks given by high bandwidth peers.\r\n",
    "labels": [
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      }
    ],
    "milestone": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/60",
      "html_url": "https://github.com/bitcoin/bitcoin/milestone/60",
      "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/60/labels",
      "id": 9286970,
      "node_id": "MI_kwDOABII584AjbU6",
      "number": 60,
      "state": "open",
      "title": "26.0",
      "description": "",
      "creator": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "open_issues": 3,
      "closed_issues": 9,
      "created_at": "2023-04-15T11:36:05Z",
      "updated_at": "2023-06-02T10:00:06Z"
    },
    "created_at": "2023-05-11T14:05:20Z",
    "updated_at": "2023-06-02T15:00:47Z",
    "closed_at": "2023-05-24T09:09:27Z",
    "mergeable_state": "unknown",
    "merged_at": "2023-05-24T09:09:27Z",
    "merge_commit_sha": "51c050787fd6bcd016969dd7e245818ebd110b67",
    "assignees": [],
    "requested_reviewers": [
      {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      }
    ],
    "requested_teams": [],
    "head": {
      "label": "instagibbs:2023-05-parallel-block-downloads",
      "ref": "2023-05-parallel-block-downloads",
      "sha": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 13910191,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMzkxMDE5MQ==",
        "name": "bitcoin",
        "full_name": "instagibbs/bitcoin",
        "owner": {
          "login": "instagibbs",
          "id": 5767891,
          "node_id": "MDQ6VXNlcjU3Njc4OTE=",
          "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/instagibbs",
          "html_url": "https://github.com/instagibbs",
          "followers_url": "https://api.github.com/users/instagibbs/followers",
          "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
          "organizations_url": "https://api.github.com/users/instagibbs/orgs",
          "repos_url": "https://api.github.com/users/instagibbs/repos",
          "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/instagibbs/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/instagibbs/bitcoin",
        "description": "Bitcoin integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/instagibbs/bitcoin",
        "archive_url": "https://api.github.com/repos/instagibbs/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/instagibbs/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/instagibbs/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/instagibbs/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/instagibbs/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/instagibbs/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/instagibbs/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/instagibbs/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/instagibbs/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/instagibbs/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/instagibbs/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/instagibbs/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/instagibbs/bitcoin/events",
        "forks_url": "https://api.github.com/repos/instagibbs/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/instagibbs/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/instagibbs/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/instagibbs/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/instagibbs/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/instagibbs/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/instagibbs/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/instagibbs/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/instagibbs/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/instagibbs/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/instagibbs/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/instagibbs/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/instagibbs/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/instagibbs/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/instagibbs/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/instagibbs/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:instagibbs/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/instagibbs/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/instagibbs/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/instagibbs/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/instagibbs/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/instagibbs/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/instagibbs/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/instagibbs/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/instagibbs/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/instagibbs/bitcoin/hooks",
        "svn_url": "https://github.com/instagibbs/bitcoin",
        "homepage": "http://www.bitcoin.org",
        "language": "C++",
        "forks_count": 1,
        "stargazers_count": 2,
        "watchers_count": 2,
        "size": 213381,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-05-25T13:43:57Z",
        "created_at": "2013-10-27T20:56:53Z",
        "updated_at": "2022-12-28T23:57:23Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "5ef2c1ee7a7416907e0f9135dc0701a88d92a7f6",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 34325,
        "stargazers_count": 69819,
        "watchers_count": 69819,
        "size": 233879,
        "default_branch": "master",
        "open_issues_count": 626,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-07T07:29:24Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-06-07T07:34:31Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 242,
    "deletions": 76,
    "changed_files": 5,
    "commits": 6,
    "review_comments": 96,
    "comments": 32
  },
  "events": [
    {
      "event": "commented",
      "id": 1544049487,
      "node_id": "IC_kwDOABII585cCFNP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1544049487",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-11T14:05:23Z",
      "updated_at": "2023-05-23T18:17:59Z",
      "author_association": "MEMBER",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [sdaftuar](https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1559886304), [mzumsande](https://github.com/bitcoin/bitcoin/pull/27626#pullrequestreview-1440297516) |\n| Concept ACK | [jamesob](https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1559648210), [theuni](https://github.com/bitcoin/bitcoin/pull/27626#pullrequestreview-1440012745) |\n| Stale ACK | [dergoegge](https://github.com/bitcoin/bitcoin/pull/27626#pullrequestreview-1433928913), [ajtowns](https://github.com/bitcoin/bitcoin/pull/27626#pullrequestreview-1438918136) |\n\nIf your review is incorrectly listed, please react with 👎 to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27596](https://github.com/bitcoin/bitcoin/pull/27596) (assumeutxo (2) by jamesob)\n* [#27052](https://github.com/bitcoin/bitcoin/pull/27052) (test: rpc: add last block announcement time to getpeerinfo result by LarryRuane)\n* [#26969](https://github.com/bitcoin/bitcoin/pull/26969) (net, refactor: net_processing, add `ProcessCompactBlockTxns` by brunoerg)\n* [#26812](https://github.com/bitcoin/bitcoin/pull/26812) (test: add end-to-end tests for CConnman and PeerManager by vasild)\n* [#26621](https://github.com/bitcoin/bitcoin/pull/26621) (refactor: Continue moving application data from CNode to Peer by dergoegge)\n* [#24008](https://github.com/bitcoin/bitcoin/pull/24008) (assumeutxo: net_processing changes by jamesob)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1544049487",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9222899414,
      "node_id": "HRFPE_lADOABII585lrb4NzwAAAAIlukbW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9222899414",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-11T14:10:59Z"
    },
    {
      "event": "labeled",
      "id": 9222902598,
      "node_id": "LE_lADOABII585lrb4NzwAAAAIlulNG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9222902598",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-11T14:11:14Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "labeled",
      "id": 9223045448,
      "node_id": "LE_lADOABII585lrb4NzwAAAAIlvIFI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9223045448",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-11T14:23:06Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    },
    {
      "event": "review_requested",
      "id": 9223047585,
      "node_id": "RRE_lADOABII585lrb4NzwAAAAIlvImh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9223047585",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-11T14:23:17Z",
      "requested_reviewer": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "referenced",
      "id": 9223144134,
      "node_id": "REFE_lADOABII585lrb4NzwAAAAIlvgLG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9223144134",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "74c4a66c863fbf25c8b65647d18881144c8ed3e8",
      "commit_url": "https://api.github.com/repos/chaincodelabs/bmon/commits/74c4a66c863fbf25c8b65647d18881144c8ed3e8",
      "created_at": "2023-05-11T14:30:54Z"
    },
    {
      "event": "unlabeled",
      "id": 9223661193,
      "node_id": "UNLE_lADOABII585lrb4NzwAAAAIlxeaJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9223661193",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-11T15:11:27Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1422727983,
      "node_id": "PRR_kwDOABII585UzRsv",
      "url": null,
      "actor": null,
      "commit_id": "673695521845167d550951bb362336e921a42195",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Seems okay at first glance. It would be nice to have a \"blockrequest.cpp\" module that collects all this logic together. Perhaps we want to keep this change simple so it's a smaller backport, and refactor later, though.",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#pullrequestreview-1422727983",
      "submitted_at": "2023-05-11T15:47:40Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
    },
    {
      "event": "reviewed",
      "id": 1423003852,
      "node_id": "PRR_kwDOABII585U0VDM",
      "url": null,
      "actor": null,
      "commit_id": "df1218b447aabfc54f86406d4813057df1ddf216",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#pullrequestreview-1423003852",
      "submitted_at": "2023-05-11T16:24:44Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9224646778,
      "node_id": "HRFPE_lADOABII585lrb4NzwAAAAIl1PB6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9224646778",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-11T16:45:08Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9224754893,
      "node_id": "HRFPE_lADOABII585lrb4NzwAAAAIl1pbN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9224754893",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-11T16:57:43Z"
    },
    {
      "event": "labeled",
      "id": 9224755643,
      "node_id": "LE_lADOABII585lrb4NzwAAAAIl1pm7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9224755643",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-11T16:57:49Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 9225352313,
      "node_id": "UNLE_lADOABII585lrb4NzwAAAAIl37R5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9225352313",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-11T18:05:27Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9225595104,
      "node_id": "HRFPE_lADOABII585lrb4NzwAAAAIl42jg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9225595104",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-11T18:33:56Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9225778677,
      "node_id": "HRFPE_lADOABII585lrb4NzwAAAAIl5jX1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9225778677",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-11T18:55:28Z"
    },
    {
      "event": "reviewed",
      "id": 1424128109,
      "node_id": "PRR_kwDOABII585U4nht",
      "url": null,
      "actor": null,
      "commit_id": "ceded96265fbf3528dbb2a845d599ecbbae1bdb7",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#pullrequestreview-1424128109",
      "submitted_at": "2023-05-12T09:28:46Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
    },
    {
      "event": "commented",
      "id": 1545766429,
      "node_id": "IC_kwDOABII585cIoYd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1545766429",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-12T13:38:16Z",
      "updated_at": "2023-05-12T13:42:21Z",
      "author_association": "MEMBER",
      "body": "I'll clean up history later when we're closer to ACKs",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1545766429",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "labeled",
      "id": 9234081125,
      "node_id": "LE_lADOABII585lrb4NzwAAAAImZOVl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9234081125",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-12T15:07:39Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1546082245,
      "node_id": "IC_kwDOABII585cJ1fF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1546082245",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-12T17:47:10Z",
      "updated_at": "2023-05-12T17:47:10Z",
      "author_association": "MEMBER",
      "body": "> In contrast to previous effort, it will not help if subsequent peers send block headers only\r\n\r\nCan you elaborate on this? Are you saying that falling back to full block download is pointless?\r\n",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1546082245",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "commented",
      "id": 1546091957,
      "node_id": "IC_kwDOABII585cJ321",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1546091957",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-12T17:56:51Z",
      "updated_at": "2023-05-12T17:56:51Z",
      "author_association": "MEMBER",
      "body": "@Sjors Basically previous efforts would allow the peer to send a header, not a compact block, and we would fire off an additional `getdata` for the compact block. See this block of code: https://github.com/bitcoin/bitcoin/pull/10984/files#diff-6875de769e90cec84d2e8a9c1b962cdbcda44d870d42e4215827e599e11e90e3R1411\r\n\r\nIMO it's unlikely to make an impact, as high-bandwidth peers are already demonstrably fast, and allows us to control better who takes up the additional slots.",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1546091957",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "mentioned",
      "id": 9235394856,
      "node_id": "MEE_lADOABII585lrb4NzwAAAAImePEo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9235394856",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-12T17:56:52Z"
    },
    {
      "event": "subscribed",
      "id": 9235394869,
      "node_id": "SE_lADOABII585lrb4NzwAAAAImePE1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9235394869",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-12T17:56:52Z"
    },
    {
      "event": "commented",
      "id": 1546170005,
      "node_id": "IC_kwDOABII585cKK6V",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1546170005",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-12T19:13:58Z",
      "updated_at": "2023-05-12T19:13:58Z",
      "author_association": "MEMBER",
      "body": "So that earlier attempt would solicit a compact block from a (BIP 152) low-bandwidth mode peer, in response to it announcing a header. That's similar to what we already do in `HeadersDirectFetchBlocks`, but allowing more than 1 in transit?\r\n\r\nWhereas in this PR we focus on the high-bandwidth mode peers, which are [allowed to send us](https://github.com/bitcoin/bips/blob/master/bip-0152.mediawiki#intended-protocol-flow) a `cmpctblock` message straight away (rather than waiting for us to ask). Right now we can only have one `cmpctblock` -> `getblocktxn` -> `blocktxn` \"session\" in progress. This PR makes that 3.\r\n\r\nThis approach seems fine, but the other attempts were never merged, which is why I am confused by the \"it will not help\" phrase. Are you saying these earlier attempts failed in some experiment, are they useless in general or is this new approach just better (and less complex?)?",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1546170005",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "commented",
      "id": 1546173220,
      "node_id": "IC_kwDOABII585cKLsk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1546173220",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-12T19:17:34Z",
      "updated_at": "2023-05-12T19:17:34Z",
      "author_association": "MEMBER",
      "body": "> This PR makes that 3.\r\n\r\nMakes it 3 parallel block downloads, first can be of any kind, the 2nd and 3rd must be compact block announcements from high badwidth peers. \r\n\r\n> I am confused by the \"it will not help\" phrase\r\n\r\nThis PR does not take advantage of low-bandwidth compact block peers message patterns, in other words.",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1546173220",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "commented",
      "id": 1548057302,
      "node_id": "IC_kwDOABII585cRXrW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1548057302",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-15T15:13:36Z",
      "updated_at": "2023-05-15T15:23:11Z",
      "author_association": "MEMBER",
      "body": "I was getting some sybil-stalls above the missing txn <=10 limit, so for now uncapped it.\r\n\r\nI also added in logic to ensure that at least one of the 3 slots is taken by an outbound peer. This should be more robust against sybils that are able to take up all inbound hb slots. e.g.,:\r\n\r\n1) uses fresh connection to announce, then stall\r\n2) uses both inbound hb peers to take up 2nd and 3rd slots, but never gives txns\r\n3) fresh peer times out, gets disconnected\r\n4) repeat 1-3\r\n\r\nAdded more extensive tests.",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1548057302",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9248013946,
      "node_id": "HRFPE_lADOABII585lrb4NzwAAAAInOX56",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9248013946",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-15T15:18:38Z"
    },
    {
      "event": "unlabeled",
      "id": 9248682675,
      "node_id": "UNLE_lADOABII585lrb4NzwAAAAInQ7Kz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9248682675",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-15T16:24:53Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9261876836,
      "node_id": "HRFPE_lADOABII585lrb4NzwAAAAIoDQZk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9261876836",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-16T19:39:04Z"
    },
    {
      "event": "reviewed",
      "id": 1430785565,
      "node_id": "PRR_kwDOABII585VSA4d",
      "url": null,
      "actor": null,
      "commit_id": "324af0fd5c64a91780c7beaf9c2023dcf4df90da",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "I have not reviewed the test or done any manual testing yet, but just finished reading the code.\r\n\r\nOne conceptual thing that I wanted to mention: right now it is possible for none of our HB compactblock peers to be outbound. The way the HB outbound reservation logic works is that if we ever have an outbound peer taking an HB slot, we will not allow inbounds to take over all 3 slots. However, it is possible that a peer starting up for the first time could have all its slots taken by inbounds.",
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#pullrequestreview-1430785565",
      "submitted_at": "2023-05-17T15:52:15Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
    },
    {
      "event": "commented",
      "id": 1551697808,
      "node_id": "IC_kwDOABII585cfQeQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1551697808",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-17T16:15:13Z",
      "updated_at": "2023-05-17T16:15:13Z",
      "author_association": "MEMBER",
      "body": "> However, it is possible that a peer starting up for the first time could have all its slots taken by inbounds.\r\n\r\nYeah, goes without saying, but maybe it doesn't. This PR offers no protection on fresh restart(no hb peers), and only offers 3 parallel downloads when an outbound is selected as hb and offers a block",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1551697808",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9271888230,
      "node_id": "HRFPE_lADOABII585lrb4NzwAAAAIopclm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9271888230",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-17T17:04:58Z"
    },
    {
      "event": "labeled",
      "id": 9272144235,
      "node_id": "LE_lADOABII585lrb4NzwAAAAIoqbFr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9272144235",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-17T17:36:05Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1551819825,
      "node_id": "IC_kwDOABII585cfuQx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1551819825",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-17T17:47:52Z",
      "updated_at": "2023-05-17T17:47:52Z",
      "author_association": "MEMBER",
      "body": "Thanks for the quick updates -- the code looks right to me now; will test. ",
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1551819825",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9273439224,
      "node_id": "HRFPE_lADOABII585lrb4NzwAAAAIovXP4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9273439224",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-17T20:27:42Z"
    },
    {
      "event": "commented",
      "id": 1553089898,
      "node_id": "IC_kwDOABII585ckkVq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1553089898",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-18T13:52:03Z",
      "updated_at": "2023-05-18T13:57:21Z",
      "author_association": "MEMBER",
      "body": "ACK 2d12fab42cc0f11d5ede96c7eb71a496931df0b5. I've reviewed the test as well and have been running this branch live, and it looks good to me.\r\n\r\nI think it'd be good to merge this sooner than later so we can get some experience running this in master before it appears in a release, so that we can get a sense of whether we want to institute any better bandwidth management before deploying.\r\n\r\nEDIT: not sure what's up with the CI failure?",
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1553089898",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "commented",
      "id": 1553102278,
      "node_id": "IC_kwDOABII585cknXG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1553102278",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-18T13:59:06Z",
      "updated_at": "2023-05-18T13:59:06Z",
      "author_association": "MEMBER",
      "body": "\"jq: command not found\" weird one, probably just restart?",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1553102278",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDg2Y2ZmOGJmMThmMmM2MzQ0YTI1YWQ4YjgxY2YzNjYyMDFhNzNjMzY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/86cff8bf18f2c6344a25ad8b81cf366201a73c36",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/86cff8bf18f2c6344a25ad8b81cf366201a73c36",
      "tree": {
        "sha": "8837576aee138628bdecd3f88746248f88f1f851",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8837576aee138628bdecd3f88746248f88f1f851"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ccc431d53ea05081e8f827d6165221129f362ebb",
          "sha": "ccc431d53ea05081e8f827d6165221129f362ebb",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/ccc431d53ea05081e8f827d6165221129f362ebb"
        }
      ],
      "message": "alias BlockDownloadMap for mapBlocksInFlight",
      "committer": {
        "name": "Greg Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2023-05-18T14:03:37Z"
      },
      "author": {
        "name": "Greg Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2023-05-09T14:30:23Z"
      },
      "sha": "86cff8bf18f2c6344a25ad8b81cf366201a73c36"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGE5MDU5NTQ3OGRjZjRlNDQzY2QxNWJiYjgyMmQ0ODVkYzQyYmRiMTg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a90595478dcf4e443cd15bbb822d485dc42bdb18",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a90595478dcf4e443cd15bbb822d485dc42bdb18",
      "tree": {
        "sha": "750c5b9dd2cdcfa63381c802d3ee19e726c0ab99",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/750c5b9dd2cdcfa63381c802d3ee19e726c0ab99"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/86cff8bf18f2c6344a25ad8b81cf366201a73c36",
          "sha": "86cff8bf18f2c6344a25ad8b81cf366201a73c36",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/86cff8bf18f2c6344a25ad8b81cf366201a73c36"
        }
      ],
      "message": "Remove nBlocksInFlight",
      "committer": {
        "name": "Greg Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2023-05-18T14:03:37Z"
      },
      "author": {
        "name": "Greg Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2023-05-09T14:46:51Z"
      },
      "sha": "a90595478dcf4e443cd15bbb822d485dc42bdb18"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGNjZTk2MTgyYmEyNDU3MzM1ODY4YzY1ZGMxNmIwODFjM2RlZTMyZWU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cce96182ba2457335868c65dc16b081c3dee32ee",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/cce96182ba2457335868c65dc16b081c3dee32ee",
      "tree": {
        "sha": "ff3cbb222e4379ab3b27a38405282ad5a681496d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ff3cbb222e4379ab3b27a38405282ad5a681496d"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a90595478dcf4e443cd15bbb822d485dc42bdb18",
          "sha": "a90595478dcf4e443cd15bbb822d485dc42bdb18",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a90595478dcf4e443cd15bbb822d485dc42bdb18"
        }
      ],
      "message": "Convert mapBlocksInFlight to a multimap",
      "committer": {
        "name": "Greg Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2023-05-18T14:03:37Z"
      },
      "author": {
        "name": "Greg Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2023-05-09T16:56:49Z"
      },
      "sha": "cce96182ba2457335868c65dc16b081c3dee32ee"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDEzZjliMjBiNGNiMmYzZjI2ZTgxMTg0YTc3ZTljZjFmNjI2ZDRmNTc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/13f9b20b4cb2f3f26e81184a77e9cf1f626d4f57",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/13f9b20b4cb2f3f26e81184a77e9cf1f626d4f57",
      "tree": {
        "sha": "44f756d5efcbfed3595516adbe3e68192e360e0a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/44f756d5efcbfed3595516adbe3e68192e360e0a"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cce96182ba2457335868c65dc16b081c3dee32ee",
          "sha": "cce96182ba2457335868c65dc16b081c3dee32ee",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/cce96182ba2457335868c65dc16b081c3dee32ee"
        }
      ],
      "message": "Only request full blocks from the peer we thought had the block in-flight\n\nThis is a change in behavior so that if for some reason we request a block from a peer, we don't allow an unsolicited CMPCT_BLOCK announcement for that same block to cause a request for a full block from the uninvited peer (as some type of request is already outstanding from the original peer)",
      "committer": {
        "name": "Greg Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2023-05-18T14:03:37Z"
      },
      "author": {
        "name": "Greg Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2023-05-09T17:35:02Z"
      },
      "sha": "13f9b20b4cb2f3f26e81184a77e9cf1f626d4f57"
    },
    {
      "event": "commented",
      "id": 1553108896,
      "node_id": "IC_kwDOABII585cko-g",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1553108896",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-18T14:03:38Z",
      "updated_at": "2023-05-18T14:03:38Z",
      "author_association": "MEMBER",
      "body": "> \"jq: command not found\" weird one, probably just restart?\r\n\r\nRebase should do it. Added recently for IWYU in the tidy job.",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1553108896",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9280203093,
      "node_id": "HRFPE_lADOABII585lrb4NzwAAAAIpJKlV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9280203093",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-18T14:03:54Z"
    },
    {
      "event": "commented",
      "id": 1553109478,
      "node_id": "IC_kwDOABII585ckpHm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1553109478",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-18T14:04:03Z",
      "updated_at": "2023-05-18T14:04:03Z",
      "author_association": "MEMBER",
      "body": "rebased",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1553109478",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "milestoned",
      "id": 9280221755,
      "node_id": "MIE_lADOABII585lrb4NzwAAAAIpJPI7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9280221755",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-18T14:05:27Z",
      "milestone": {
        "title": "26.0"
      }
    },
    {
      "event": "commented",
      "id": 1553177921,
      "node_id": "IC_kwDOABII585ck51B",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1553177921",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-18T14:48:22Z",
      "updated_at": "2023-05-18T14:48:22Z",
      "author_association": "MEMBER",
      "body": "ACK 42c2696ae58e07de005edf1dda952761f8c9008e",
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1553177921",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "connected",
      "id": 9280860507,
      "node_id": "COE_lADOABII585lrb4NzwAAAAIpLrFb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9280860507",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-18T15:03:55Z"
    },
    {
      "event": "unlabeled",
      "id": 9280897711,
      "node_id": "UNLE_lADOABII585lrb4NzwAAAAIpL0Kv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9280897711",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-18T15:07:15Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1433364121,
      "node_id": "PRR_kwDOABII585Vb2aZ",
      "url": null,
      "actor": null,
      "commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "brunoerg",
        "id": 19480819,
        "node_id": "MDQ6VXNlcjE5NDgwODE5",
        "avatar_url": "https://avatars.githubusercontent.com/u/19480819?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/brunoerg",
        "html_url": "https://github.com/brunoerg",
        "followers_url": "https://api.github.com/users/brunoerg/followers",
        "following_url": "https://api.github.com/users/brunoerg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/brunoerg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/brunoerg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/brunoerg/subscriptions",
        "organizations_url": "https://api.github.com/users/brunoerg/orgs",
        "repos_url": "https://api.github.com/users/brunoerg/repos",
        "events_url": "https://api.github.com/users/brunoerg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/brunoerg/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#pullrequestreview-1433364121",
      "submitted_at": "2023-05-18T19:55:59Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
    },
    {
      "event": "reviewed",
      "id": 1433928913,
      "node_id": "PRR_kwDOABII585VeATR",
      "url": null,
      "actor": null,
      "commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Code review ACK 42c2696ae58e07de005edf1dda952761f8c9008e\r\n\r\nHaven't done a lot of testing yet besides reviewing the tests and running a node with this patch, but the code looks good to me.\r\n\r\n(comments are nits, feel free to ignore)",
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#pullrequestreview-1433928913",
      "submitted_at": "2023-05-19T08:01:04Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
    },
    {
      "event": "review_requested",
      "id": 9287910637,
      "node_id": "RRE_lADOABII585lrb4NzwAAAAIpmkTt",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9287910637",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-19T10:13:26Z",
      "requested_reviewer": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "commented",
      "id": 1554410798,
      "node_id": "IC_kwDOABII585cpm0u",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1554410798",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-19T11:06:46Z",
      "updated_at": "2023-05-19T11:06:46Z",
      "author_association": "MEMBER",
      "body": "holding off on touching for nits, can do in follow-up",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1554410798",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "reviewed",
      "id": 1435468460,
      "node_id": "PRR_kwDOABII585Vj4Ks",
      "url": null,
      "actor": null,
      "commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Concept ACK, code looks good on first walkthrough.\r\n\r\nI want to run this code with some additional logging for a day or two before acking.\r\n\r\nIn particular, I wonder if the fact that we'll now try additional peers will lead to redundancies / increased traffic under non-adversarial conditions where there's no staller but delivering the block just needs some time - especially when blocks contain a large number of txns that weren't in our mempool, or on slower networks like Tor. Did you consider the possibility of giving the original peer a few seconds to deliver before requesting from additional peers?\r\n\r\nAlso, all that `first->second.second` in connection with the multimap is not very pretty or easy to read, but I don't see a better way.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#pullrequestreview-1435468460",
      "submitted_at": "2023-05-21T21:21:40Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
    },
    {
      "event": "commented",
      "id": 1556553095,
      "node_id": "IC_kwDOABII585cxx2H",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1556553095",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-22T05:18:47Z",
      "updated_at": "2023-05-22T05:35:23Z",
      "author_association": "MEMBER",
      "body": "> In particular, I wonder if the fact that we'll now try additional peers will lead to redundancies / increased traffic under non-adversarial conditions where there's no staller but delivering the block just needs some time - especially when blocks contain a large number of txns that weren't in our mempool, or on slower networks like Tor. Did you consider the possibility of giving the original peer a few seconds to deliver before requesting from additional peers?\r\n\r\nYeah, this is the behaviour I'm seeing --\r\n\r\n```\r\n# peer=3 first reports it\r\n2023-05-22T03:13:48.490251Z Saw new header hash=000000000000000000028a6e01ad99705343eea1ff85e43aa580bbae52a3a8ab height=790827\r\n2023-05-22T03:13:48.490389Z [net] Saw new cmpctblock header hash=000000000000000000028a6e01ad99705343eea1ff85e43aa580bbae52a3a8ab peer=3\r\n2023-05-22T03:13:48.512908Z [cmpctblock] Initialized PartiallyDownloadedBlock for block 000000000000000000028a6e01ad99705343eea1ff85e43aa580bbae52a3a8ab using a cmpctblock of size 18890\r\n2023-05-22T03:13:48.513282Z [net] sending getblocktxn (35 bytes) peer=3\r\n\r\n# peer=11 0.2s later\r\n2023-05-22T03:13:48.740077Z [net] received: cmpctblock (18890 bytes) peer=11\r\n2023-05-22T03:13:48.761214Z [cmpctblock] Initialized PartiallyDownloadedBlock for block 000000000000000000028a6e01ad99705343eea1ff85e43aa580bbae52a3a8ab using a cmpctblock of size 18890\r\n2023-05-22T03:13:48.761562Z [net] sending getblocktxn (35 bytes) peer=11\r\n\r\n# peer=9 another 0.2s later\r\n2023-05-22T03:13:48.946673Z [net] received: cmpctblock (18890 bytes) peer=9\r\n2023-05-22T03:13:48.968735Z [cmpctblock] Initialized PartiallyDownloadedBlock for block 000000000000000000028a6e01ad99705343eea1ff85e43aa580bbae52a3a8ab using a cmpctblock of size 18890\r\n2023-05-22T03:13:48.969097Z [net] sending getblocktxn (35 bytes) peer=9\r\n\r\n# peer=11 responds first\r\n2023-05-22T03:13:49.051028Z [net] received: blocktxn (97486 bytes) peer=11\r\n2023-05-22T03:13:49.055872Z [cmpctblock]   blocktxn peer=11 tx=f401366ed3a40be59923388aa5e58d90c921ac162a92d14a573d24553ba0ce65\r\n2023-05-22T03:13:49.055891Z [cmpctblock]   blocktxn peer=11 tx=5ebf80ab6ac479bd3568cf9d1575c62b94aaf8bace4058970ca5e3e35a3b0ab1\r\n2023-05-22T03:13:49.081909Z [cmpctblock] Successfully reconstructed block 000000000000000000028a6e01ad99705343eea1ff85e43aa580bbae52a3a8ab with 1 txn prefilled, 3078 txn from mempool (incl at least 0 from extra pool) and 2 txn requested\r\n\r\n# then peer=3 about 0.4s later\r\n2023-05-22T03:13:49.457226Z [net] received: blocktxn (97486 bytes) peer=3\r\n2023-05-22T03:13:49.461365Z [net] Peer 3 sent us block transactions for block we weren't expecting\r\n\r\n# then peer=9 about 0.14s later\r\n2023-05-22T03:13:49.600309Z [net] received: blocktxn (97486 bytes) peer=9\r\n2023-05-22T03:13:49.604364Z [net] Peer 9 sent us block transactions for block we weren't expecting\r\n```\r\n\r\nFor block 790788 I received two 1.5MB blocktxn messages:\r\n\r\n```\r\n2023-05-21T20:02:38.285186Z Saw new header hash=000000000000000000023a845351079f13015d10aa55003d30e7589e597caa2a height=790788\r\n2023-05-21T20:02:38.285264Z [net] Saw new cmpctblock header hash=000000000000000000023a845351079f13015d10aa55003d30e7589e597caa2a peer=3\r\n\r\n# peer=9 announces 0.3s later\r\n2023-05-21T20:02:38.659630Z [net] received: cmpctblock (4129 bytes) peer=9\r\n2023-05-21T20:02:38.679677Z [cmpctblock] Initialized PartiallyDownloadedBlock for block 000000000000000000023a845351079f13015d10aa55003d30e7589e597caa2a using a cmpctblock of size 4129\r\n\r\n# peer=3 took ~2s to respond\r\n2023-05-21T20:02:40.240719Z [net] received: blocktxn (1541605 bytes) peer=3\r\n2023-05-21T20:02:43.332966Z UpdateTip: new best=000000000000000000023a845351079f13015d10aa55003d30e7589e597caa2a height=790788 version=0x20014000 log2_work=94.193595 tx=841476965 date='2023-05-21T20:01:57Z' progress=1.000000 cache=26.9MiB(224222txo)\r\n\r\n# peer=9 took ~7s to respond\r\n2023-05-21T20:02:45.830208Z [net] received: blocktxn (1541605 bytes) peer=9\r\n2023-05-21T20:02:45.893063Z [net] Peer 9 sent us block transactions for block we weren't expecting\r\n```\r\n\r\n(EDIT: that [block](https://mempool.space/block/000000000000000000023a845351079f13015d10aa55003d30e7589e597caa2a) had a bunch of large, low feerate consolidation txs that are below mempool minfee so aren't eligible for cpfp. One I looked at seems to have been first broadcast around 4th May, perhaps)\r\n\r\nIn that case, if peer=9 had announced first, and I'd waited 5s before requesting for peer=3, I'd still have doubled up the 1.5MB response, and not gotten either respond until 7s after the announcement. But at least there would have been a maybe 50% chance of avoiding the second request entirely.\r\n\r\nTripling the outgoing bandwidth load for peers selected for hb compact block relay seems concerning; not sure if I'd call it a blocker though.",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1556553095",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "reviewed",
      "id": 1436019702,
      "node_id": "PRR_kwDOABII585Vl-v2",
      "url": null,
      "actor": null,
      "commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#pullrequestreview-1436019702",
      "submitted_at": "2023-05-22T09:10:31Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
    },
    {
      "event": "commented",
      "id": 1557002308,
      "node_id": "IC_kwDOABII585czfhE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1557002308",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-22T10:54:55Z",
      "updated_at": "2023-05-22T11:04:09Z",
      "author_association": "MEMBER",
      "body": "@mzumsande  This is a delicate trade-off as you're aware.\r\n\r\n> delivering the block just needs some time \r\n\r\nThere's a lot of mix and match we can likely do to improve the bandwidth usage, probably with only a small delay in block propagation. There are block timeouts, yes, but we also care about block prop speed for mining fairness(e.g., selfish mining attacks). So maybe there can be 2 buckets for each type of issue.\r\n\r\ne.g.,\r\n1) first or second slot must have outbound peer (best effort to keep blocks fast)\r\n2) third request is only dispatched after 5s delay (don't let node get unduly timed out)\r\n\r\nObviously a bit more complexity, but the linked issue can stay open and discussion continue with metrics?\r\n\r\nIn other words, I don't want a trivial sybil attacker to be able to slow down blocks at all listening nodes by 5 seconds each hop. That would be pretty bad for mining fairness. ",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1557002308",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "mentioned",
      "id": 9301200938,
      "node_id": "MEE_lADOABII585lrb4NzwAAAAIqZRAq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9301200938",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-22T10:54:55Z"
    },
    {
      "event": "subscribed",
      "id": 9301200954,
      "node_id": "SE_lADOABII585lrb4NzwAAAAIqZRA6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9301200954",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-22T10:54:55Z"
    },
    {
      "event": "mentioned",
      "id": 9301227147,
      "node_id": "MEE_lADOABII585lrb4NzwAAAAIqZXaL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9301227147",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-22T10:57:47Z"
    },
    {
      "event": "subscribed",
      "id": 9301227164,
      "node_id": "SE_lADOABII585lrb4NzwAAAAIqZXac",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9301227164",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-22T10:57:47Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9302596061,
      "node_id": "HRFPE_lADOABII585lrb4NzwAAAAIqelnd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9302596061",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-22T13:11:49Z"
    },
    {
      "event": "commented",
      "id": 1557224231,
      "node_id": "IC_kwDOABII585c0Vsn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1557224231",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-22T13:28:19Z",
      "updated_at": "2023-05-22T13:30:41Z",
      "author_association": "MEMBER",
      "body": "responded to all nits\r\n\r\nlet's keep the tracking issue open for further discussion on bandwidth saving strategies post-merge",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1557224231",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "labeled",
      "id": 9302850184,
      "node_id": "LE_lADOABII585lrb4NzwAAAAIqfjqI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9302850184",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-22T13:34:12Z",
      "label": {
        "name": "Needs backport (25.x)",
        "color": "ff8200"
      }
    },
    {
      "event": "commented",
      "id": 1557285593,
      "node_id": "IC_kwDOABII585c0krZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1557285593",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-22T14:06:42Z",
      "updated_at": "2023-05-22T14:06:42Z",
      "author_association": "MEMBER",
      "body": "Red CI can be ignored. This is an upstream bug, see https://github.com/bitcoin/bitcoin/issues/27492#issuecomment-1527772394",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1557285593",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "commented",
      "id": 1557469158,
      "node_id": "IC_kwDOABII585c1Rfm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1557469158",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-22T15:51:08Z",
      "updated_at": "2023-05-22T16:06:58Z",
      "author_association": "MEMBER",
      "body": "> Tripling the outgoing bandwidth load for peers selected for hb compact block relay seems concerning; not sure if I'd call it a blocker though.\r\n\r\nTo be clear, this is only a tripling in the case where where all your peers are roughly equally as fast, and triple of *what* is the most important thing.\r\n\r\nThe worst case scenario is going to be block after block of stuff we don't have in our mempool, and them being slow to validate, allowing multiple compact blocks to arrive before receiving a response from any peer. This would result in roughly 3x bandwidth at tip for new blocks.\r\n\r\nTo get a slightly more realistic scenario, glancing at my logs it's ~119 extra transactions requested over the last 50 blocks due to the new logic. This will go up if there's more transaction churn, and down if less, obviously. (edit: I see my non-listening node has significantly more, maybe 15 transactions a block, most from a single outlier?)",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1557469158",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "commented",
      "id": 1557536125,
      "node_id": "IC_kwDOABII585c1h19",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1557536125",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-22T16:26:47Z",
      "updated_at": "2023-05-22T16:26:47Z",
      "author_association": "MEMBER",
      "body": "> > Tripling the outgoing bandwidth load for peers selected for hb compact block relay seems concerning; not sure if I'd call it a blocker though.\r\n> \r\n> To be clear, this is only a tripling in the case where where all your peers are roughly equally as fast, and triple of _what_ is the most important thing.\r\n\r\nIn an \"everyone's honest\" environment, I think the most likely reason for there to be enough of a delay between `cmpctblock / getblocktxns / blocktxns` that there'll be another `cmpctblock` received in the meantime (and thus another `getblocktxns / blocktxns`) is that the `blocktxns` message is large due to a lot of the block being made up of non-mempool txs (violating standardness, or fees paid out of band). That's already pretty rare, and it's already size limited by max block weight. The difference between limiting the number of reqs to outbounds is exacerbated by the ratio of listening/non-listening -- if there's 80k non-listening nodes and 20k listening nodes, then the worst case has 240k requests being made to the hb listening nodes from non-listening nodes instead of just 80k (as a non-listening node doesn't have any inbound peers in the first place), and that extra load might not just be affecting random non-listening nodes.\r\n\r\nI think this is more of a todo than a blocker though.",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1557536125",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "reviewed",
      "id": 1438918136,
      "node_id": "PRR_kwDOABII585VxCX4",
      "url": null,
      "actor": null,
      "commit_id": "3b57b2b8d958871bec9a33953be051a75d8bf07c",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK 3b57b2b8d958871bec9a33953be051a75d8bf07c\r\n\r\nDespite thinking this is an improvement on what we currently do and that it's ready for merge, there's two things I'm not 100% comfortable with, and that I think would be good to improve in a followup. (1) I think this puts more demand on outbound peers than it should, as per [previous comments](https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1200426349). (2) I think the multimap stuff makes this hard to understand, and it would be good to have a custom class that abstracts the multimap behaviour. I think it could look something like [this](https://github.com/ajtowns/bitcoin/commit/0d77be6cb2c20466136a99054c5ae696f58f0a55) -- ie, have a structure that collects the results you want from the multimap, and a function that returns that structure that you use in most places. (This also avoids querying the map for the same hash many times in the same function, which isn't actually a problem, but was bugging me...)",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#pullrequestreview-1438918136",
      "submitted_at": "2023-05-23T09:42:04Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
    },
    {
      "event": "review_requested",
      "id": 9313716474,
      "node_id": "RRE_lADOABII585lrb4NzwAAAAIrJAj6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9313716474",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-23T09:42:10Z",
      "requested_reviewer": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "review_requested",
      "id": 9313716506,
      "node_id": "RRE_lADOABII585lrb4NzwAAAAIrJAka",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9313716506",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-23T09:42:10Z",
      "requested_reviewer": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "commented",
      "id": 1559648210,
      "node_id": "IC_kwDOABII585c9lfS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1559648210",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-23T15:16:16Z",
      "updated_at": "2023-05-23T15:16:16Z",
      "author_association": "MEMBER",
      "body": "Blackbox ACK\r\n\r\nBeen running an earlier version of this branch (a9f914515df0) for 5+ days and measuring header-to-tip timings with a recent bmon addition (https://github.com/chaincodelabs/bmon/pull/27); data is here: https://gist.github.com/jamesob/b601f083d5d88fdd3432da65bf5f43ae. \r\n\r\nThis branch seems to compare well with other versions I'm running. I'm going to redeploy with HEAD and will get back with some more specific analysis.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1559648210",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "reviewed",
      "id": 1439962692,
      "node_id": "PRR_kwDOABII585V1BZE",
      "url": null,
      "actor": null,
      "commit_id": "3b57b2b8d958871bec9a33953be051a75d8bf07c",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#pullrequestreview-1439962692",
      "submitted_at": "2023-05-23T15:53:32Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
    },
    {
      "event": "reviewed",
      "id": 1440012745,
      "node_id": "PRR_kwDOABII585V1NnJ",
      "url": null,
      "actor": null,
      "commit_id": "3b57b2b8d958871bec9a33953be051a75d8bf07c",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Very shallow/mechanical code review ACK. Left a few nits for some head-scratchers.\r\n\r\nI was mostly looking for misuses of the multimap. Zero opinion about the logical change itself.",
      "user": {
        "login": "theuni",
        "id": 417043,
        "node_id": "MDQ6VXNlcjQxNzA0Mw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theuni",
        "html_url": "https://github.com/theuni",
        "followers_url": "https://api.github.com/users/theuni/followers",
        "following_url": "https://api.github.com/users/theuni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theuni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theuni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
        "organizations_url": "https://api.github.com/users/theuni/orgs",
        "repos_url": "https://api.github.com/users/theuni/repos",
        "events_url": "https://api.github.com/users/theuni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theuni/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#pullrequestreview-1440012745",
      "submitted_at": "2023-05-23T16:01:55Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9318535427,
      "node_id": "HRFPE_lADOABII585lrb4NzwAAAAIrbZED",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9318535427",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-23T16:28:24Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9318607757,
      "node_id": "HRFPE_lADOABII585lrb4NzwAAAAIrbquN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9318607757",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-23T16:37:43Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDAzNDIzZjhiZDEyYjk1YTA2YTRhOWQ4Mzc3ZTc4MTYyNWRkMzhhYWU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/03423f8bd12b95a06a4a9d8377e781625dd38aae",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/03423f8bd12b95a06a4a9d8377e781625dd38aae",
      "tree": {
        "sha": "f8ab6335e73a791de8791c36d917116c7b735e62",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f8ab6335e73a791de8791c36d917116c7b735e62"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/13f9b20b4cb2f3f26e81184a77e9cf1f626d4f57",
          "sha": "13f9b20b4cb2f3f26e81184a77e9cf1f626d4f57",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/13f9b20b4cb2f3f26e81184a77e9cf1f626d4f57"
        }
      ],
      "message": "Support up to 3 parallel compact block txn fetchings\n\nA single outbound slot is required, so if the first two slots\nare taken by inbound in-flights, the node will reject additional\nunless they are coming from outbound.\n\nThis means in the case where a fast sybil peer is attempting to\nstall out a node, a single high bandwidth outbound peer can\nmitigate the attack.",
      "committer": {
        "name": "Greg Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2023-05-23T17:07:49Z"
      },
      "author": {
        "name": "Greg Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2023-05-16T19:36:38Z"
      },
      "sha": "03423f8bd12b95a06a4a9d8377e781625dd38aae"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGQ3ZjM1OWIzNWU4YjFlOWFjYzRkMzk3ZGUyNjJjZDliYTliYmNiODM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "tree": {
        "sha": "26ce490fc4820f498598b68b290d644cc6c4f829",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/26ce490fc4820f498598b68b290d644cc6c4f829"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/03423f8bd12b95a06a4a9d8377e781625dd38aae",
          "sha": "03423f8bd12b95a06a4a9d8377e781625dd38aae",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/03423f8bd12b95a06a4a9d8377e781625dd38aae"
        }
      ],
      "message": "Add tests for parallel compact block downloads",
      "committer": {
        "name": "Greg Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2023-05-23T17:07:49Z"
      },
      "author": {
        "name": "Greg Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2023-05-16T19:37:44Z"
      },
      "sha": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9318870840,
      "node_id": "HRFPE_lADOABII585lrb4NzwAAAAIrcq84",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9318870840",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-23T17:08:02Z"
    },
    {
      "event": "labeled",
      "id": 9318871578,
      "node_id": "LE_lADOABII585lrb4NzwAAAAIrcrIa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9318871578",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-23T17:08:07Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1559872914,
      "node_id": "IC_kwDOABII585c-cWS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1559872914",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-23T17:33:54Z",
      "updated_at": "2023-05-23T17:33:54Z",
      "author_association": "MEMBER",
      "body": "Ready for re-ACKs now that `getblockfrompeer` issue is fixed",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1559872914",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "commented",
      "id": 1559886304,
      "node_id": "IC_kwDOABII585c-fng",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1559886304",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-23T17:45:30Z",
      "updated_at": "2023-05-23T17:45:30Z",
      "author_association": "MEMBER",
      "body": "ACK d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83\r\n\r\nTo reiterate, I think we should continue to keep an eye on bandwidth usage (and load on outbound peers) after this patch and revisit whether any additional tuning of this behavior is needed prior to release. However it'll be useful to have this in master so that we can monitor for the next few months.",
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1559886304",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "review_request_removed",
      "id": 9319165498,
      "node_id": "RRRE_lADOABII585lrb4NzwAAAAIrdy46",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9319165498",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-23T17:45:35Z",
      "requested_reviewer": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "review_requested",
      "id": 9319165619,
      "node_id": "RRE_lADOABII585lrb4NzwAAAAIrdy6z",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9319165619",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-23T17:45:36Z",
      "requested_reviewer": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "reviewed",
      "id": 1440297516,
      "node_id": "PRR_kwDOABII585V2TIs",
      "url": null,
      "actor": null,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Code Review ACK d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83\r\n\r\nI've run this for >2 days now with additional logging and encountered no problems.\r\n\r\nOne thing I frequently observe that hasn't been mentioned above is that a low-bandwidth peer is first to give us a new header, so there is a header/getdata(CMPCT) roundtrip, and by the time that has finished we already requested the block additionally from a high-bandwidth peer that doesn't need the roundtrip.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#pullrequestreview-1440297516",
      "submitted_at": "2023-05-23T18:08:30Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
    },
    {
      "event": "merged",
      "id": 9325091554,
      "node_id": "ME_lADOABII585lrb4NzwAAAAIr0Zri",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9325091554",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "51c050787fd6bcd016969dd7e245818ebd110b67",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/51c050787fd6bcd016969dd7e245818ebd110b67",
      "created_at": "2023-05-24T09:09:27Z"
    },
    {
      "event": "closed",
      "id": 9325091626,
      "node_id": "CE_lADOABII585lrb4NzwAAAAIr0Zsq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9325091626",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-24T09:09:28Z"
    },
    {
      "event": "commented",
      "id": 1560904235,
      "node_id": "IC_kwDOABII585dCYIr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1560904235",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-24T10:56:44Z",
      "updated_at": "2023-05-24T11:02:38Z",
      "author_association": "MEMBER",
      "body": "The first two commits are wonderful refactors. But cce96182ba2457335868c65dc16b081c3dee32ee breaks `p2p_compactblocks.py --valgrind` for me:\r\n\r\n```\r\n023-05-24T10:54:53.143000Z TestFramework (INFO): Testing reconstructing compact blocks from all peers...\r\n2023-05-24T10:54:53.304000Z TestFramework (ERROR): Assertion failed\r\n...\r\n  File \"/home/sjors/.pyenv/versions/3.8.16/lib/python3.8/http/client.py\", line 972, in send\r\n    self.sock.sendall(data)\r\nBrokenPipeError: [Errno 32] Broken pipe\r\n```\r\n\r\nThe tip of the PR (with the modified tests) fails at:\r\n\r\n```\r\n023-05-24T11:01:14.517000Z TestFramework (INFO): Testing reconstructing compact blocks with a stalling peer...\r\n2023-05-24T11:01:14.678000Z TestFramework (ERROR): Assertion failed\r\n```\r\n\r\nOn Ubuntu 23.04 with g++ 12.2.0 and `./configure --without-bdb`.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1560904235",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "commented",
      "id": 1560936457,
      "node_id": "IC_kwDOABII585dCgAJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1560936457",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-24T11:20:20Z",
      "updated_at": "2023-05-24T11:20:20Z",
      "author_association": "MEMBER",
      "body": "I can't reproduce. Can you share the combined log or steps to reproduce starting on a fresh install of the operating system? Otherwise there is nothing we can do.",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1560936457",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "commented",
      "id": 1561017232,
      "node_id": "IC_kwDOABII585dCzuQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1561017232",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-24T12:17:16Z",
      "updated_at": "2023-05-24T12:17:16Z",
      "author_association": "MEMBER",
      "body": "I also cannot reproduce.",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1561017232",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "unlabeled",
      "id": 9327071106,
      "node_id": "UNLE_lADOABII585lrb4NzwAAAAIr78-C",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9327071106",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-24T12:24:27Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1561078786,
      "node_id": "IC_kwDOABII585dDCwC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1561078786",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-24T12:46:50Z",
      "updated_at": "2023-05-24T13:08:48Z",
      "author_association": "MEMBER",
      "body": "It's not a virtual machine. Logs are combined by default, right?\r\n\r\n```\r\n$ cat /tmp/bitcoin_func_test_zkozpx3h/test_framework.log | nc termbin.com 9999 \r\n```\r\n\r\nhttps://termbin.com/c3yr (this is from cce96182ba2457335868c65dc16b081c3dee32ee)\r\n\r\nvalgrind-3.19.0, not using depends (also reproduced with depends).\r\n\r\nThe node seems to disconnect right after receiving `msg_sendcmpct` at `delivery_peer.send_and_ping(msg_cmpctblock(cmpct_block.to_p2p()))`.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1561078786",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "commented",
      "id": 1561118892,
      "node_id": "IC_kwDOABII585dDMis",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1561118892",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-24T13:09:33Z",
      "updated_at": "2023-05-24T13:42:33Z",
      "author_association": "MEMBER",
      "body": "Ah, this is more useful:\r\n\r\n```\r\n==2894643== Thread 25 b-msghand:\r\n==2894643== Conditional jump or move depends on uninitialised value(s)\r\n==2894643==    at 0x24A6EC: (anonymous namespace)::PeerManagerImpl::RemoveBlockRequest(uint256 const&, std::optional<long>) [clone .isra.0] (in /home/sjors/dev/bitcoin/src/bitcoind)\r\n==2894643==    by 0x25AAA1: (anonymous namespace)::PeerManagerImpl::ProcessBlock(CNode&, std::shared_ptr<CBlock const> const&, bool, bool) (in /home/sjors/dev/bitcoin/src/bitcoind)\r\n==2894643==    by 0x2718A4: (anonymous namespace)::PeerManagerImpl::ProcessMessage(CNode&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, CDataStream&, std::chrono::duration<long, std::ratio<1l, 1000000l> >, std::atomic<bool> const&) (in /home/sjors/dev/bitcoin/src/bitcoind)\r\n==2894643==    by 0x274E68: (anonymous namespace)::PeerManagerImpl::ProcessMessages(CNode*, std::atomic<bool>&) (in /home/sjors/dev/bitcoin/src/bitcoind)\r\n==2894643==    by 0x22A9E7: CConnman::ThreadMessageHandler() (in /home/sjors/dev/bitcoin/src/bitcoind)\r\n==2894643==    by 0x620BF5: util::TraceThread(std::basic_string_view<char, std::char_traits<char> >, std::function<void ()>) (in /home/sjors/dev/bitcoin/src/bitcoind)\r\n==2894643==    by 0x22095C: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(std::basic_string_view<char, std::char_traits<char> >, std::function<void ()>), char const*, CConnman::Start(CScheduler&, CConnman::Options const&)::{lambda()#5}> > >::_M_run() (in /home/sjors/dev/bitcoin/src/bitcoind)\r\n==2894643==    by 0x494F3E2: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.31)\r\n==2894643==    by 0x4C6F189: start_thread (pthread_create.c:444)\r\n==2894643==    by 0x4CFDAF3: clone (clone.S:100)\r\n==2894643== \r\n{\r\n   <insert_a_suppression_name_here>\r\n   Memcheck:Cond\r\n   fun:_ZN12_GLOBAL__N_115PeerManagerImpl18RemoveBlockRequestERK7uint256St8optionalIlE.isra.0\r\n   fun:_ZN12_GLOBAL__N_115PeerManagerImpl12ProcessBlockER5CNodeRKSt10shared_ptrIK6CBlockEbb\r\n   fun:_ZN12_GLOBAL__N_115PeerManagerImpl14ProcessMessageER5CNodeRKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEER11CDataStreamNSt6chrono8durationIlSt5ratioILl1ELl1000000EEEERKSt6atomicIbE\r\n   fun:_ZN12_GLOBAL__N_115PeerManagerImpl15ProcessMessagesEP5CNodeRSt6atomicIbE\r\n   fun:_ZN8CConnman20ThreadMessageHandlerEv\r\n   fun:_ZN4util11TraceThreadESt17basic_string_viewIcSt11char_traitsIcEESt8functionIFvvEE\r\n   fun:_ZNSt6thread11_State_implINS_8_InvokerISt5tupleIJPFvSt17basic_string_viewIcSt11char_traitsIcEESt8functionIFvvEEEPKcZN8CConnman5StartER10CSchedulerRKNSE_7OptionsEEUlvE3_EEEEE6_M_runEv\r\n   obj:/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.31\r\n   fun:start_thread\r\n   fun:clone\r\n}\r\n==2894643== \r\n==2894643== Exit program on first error (--exit-on-first-error=yes)\r\n```\r\n\r\nHaving a hard time narrowing the config down, but it does seem that `--enable-debug` hides the issue (at least without depends).",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1561118892",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "commented",
      "id": 1561137418,
      "node_id": "IC_kwDOABII585dDREK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1561137418",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-24T13:20:29Z",
      "updated_at": "2023-05-24T13:20:29Z",
      "author_association": "MEMBER",
      "body": "Maybe open a separate issue? (There are already too many comments in this thread).\r\n\r\nMake sure to include details, otherwise it will be harder to do something. Note that not all compiler versions are compatible with all valgrind versions.",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1561137418",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "reviewed",
      "id": 1441610483,
      "node_id": "PRR_kwDOABII585V7Trz",
      "url": null,
      "actor": null,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#pullrequestreview-1441610483",
      "submitted_at": "2023-05-24T14:35:32Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
    },
    {
      "event": "referenced",
      "id": 9329475154,
      "node_id": "REFE_lADOABII585lrb4NzwAAAAIsFH5S",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9329475154",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "97c5058859b4b973504f8dab80ca9b6bb53580c4",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/97c5058859b4b973504f8dab80ca9b6bb53580c4",
      "created_at": "2023-05-24T15:31:25Z"
    },
    {
      "event": "reviewed",
      "id": 1442250064,
      "node_id": "PRR_kwDOABII585V9v1Q",
      "url": null,
      "actor": null,
      "commit_id": "cce96182ba2457335868c65dc16b081c3dee32ee",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#pullrequestreview-1442250064",
      "submitted_at": "2023-05-24T16:22:29Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
    },
    {
      "event": "reviewed",
      "id": 1442325175,
      "node_id": "PRR_kwDOABII585V-CK3",
      "url": null,
      "actor": null,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Post merge utACK d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83 modulo question about missing `return`. Other comments can wait for a followup.\r\n\r\nConceptually this PR still relies on our node immediately reacting to an incoming compact block message. This forces us to be a bit impatient and potentially use more bandwidth than needed.\r\n\r\nIn a followup we could instead track which peers have announced a block and then request block transactions from other peers if the first peer takes too long. This could be a function of the number of transactions we asked for, the typical pace we're used to, if the announcing peer was inbound, etc. That's all much more complex though. See point 4 in #27740.\r\n\r\nAs @ajtowns mentioned, refactoring the multimap stuff in a followup would really help future developers - including future versions of myself.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#pullrequestreview-1442325175",
      "submitted_at": "2023-05-24T17:30:14Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
    },
    {
      "event": "referenced",
      "id": 9337441006,
      "node_id": "REFE_lADOABII585lrb4NzwAAAAIsjgru",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9337441006",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "e43432086a7785e64f82b385cb3d0bc1c650246c",
      "commit_url": "https://api.github.com/repos/bitcoin-core/gui/commits/e43432086a7785e64f82b385cb3d0bc1c650246c",
      "created_at": "2023-05-25T09:06:03Z"
    },
    {
      "event": "referenced",
      "id": 9340042563,
      "node_id": "REFE_lADOABII585lrb4NzwAAAAIstb1D",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9340042563",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "907a7c96811bfa977d11b8469d69d5b4ff980cb1",
      "commit_url": "https://api.github.com/repos/fanquake/bitcoin/commits/907a7c96811bfa977d11b8469d69d5b4ff980cb1",
      "created_at": "2023-05-25T13:16:45Z"
    },
    {
      "event": "referenced",
      "id": 9340042580,
      "node_id": "REFE_lADOABII585lrb4NzwAAAAIstb1U",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9340042580",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "f7b63cd202970f68131d78453f107019d816e372",
      "commit_url": "https://api.github.com/repos/fanquake/bitcoin/commits/f7b63cd202970f68131d78453f107019d816e372",
      "created_at": "2023-05-25T13:16:45Z"
    },
    {
      "event": "referenced",
      "id": 9340042600,
      "node_id": "REFE_lADOABII585lrb4NzwAAAAIstb1o",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9340042600",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "f36668a976d5f56b514827a2f3c498a55c647988",
      "commit_url": "https://api.github.com/repos/fanquake/bitcoin/commits/f36668a976d5f56b514827a2f3c498a55c647988",
      "created_at": "2023-05-25T13:16:45Z"
    },
    {
      "event": "referenced",
      "id": 9340042631,
      "node_id": "REFE_lADOABII585lrb4NzwAAAAIstb2H",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9340042631",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "3be347d804cdf3dd2353fcde12ce797c4d3c9c5c",
      "commit_url": "https://api.github.com/repos/fanquake/bitcoin/commits/3be347d804cdf3dd2353fcde12ce797c4d3c9c5c",
      "created_at": "2023-05-25T13:16:45Z"
    },
    {
      "event": "referenced",
      "id": 9340042656,
      "node_id": "REFE_lADOABII585lrb4NzwAAAAIstb2g",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9340042656",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "98103f921c20f27b7e93ae95a5bce7f450242425",
      "commit_url": "https://api.github.com/repos/fanquake/bitcoin/commits/98103f921c20f27b7e93ae95a5bce7f450242425",
      "created_at": "2023-05-25T13:16:45Z"
    },
    {
      "event": "referenced",
      "id": 9340042680,
      "node_id": "REFE_lADOABII585lrb4NzwAAAAIstb24",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9340042680",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "99bf252f9ed90c3f8c04aa7f825869b060b0853d",
      "commit_url": "https://api.github.com/repos/fanquake/bitcoin/commits/99bf252f9ed90c3f8c04aa7f825869b060b0853d",
      "created_at": "2023-05-25T13:16:45Z"
    },
    {
      "event": "unlabeled",
      "id": 9340172904,
      "node_id": "UNLE_lADOABII585lrb4NzwAAAAIst7po",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9340172904",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-25T13:29:12Z",
      "label": {
        "name": "Needs backport (25.x)",
        "color": "ff8200"
      }
    },
    {
      "event": "commented",
      "id": 1562913602,
      "node_id": "IC_kwDOABII585dKCtC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1562913602",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-25T13:30:17Z",
      "updated_at": "2023-05-25T13:30:17Z",
      "author_association": "MEMBER",
      "body": "Up for backport in #27752.",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1562913602",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "referenced",
      "id": 9346344681,
      "node_id": "REFE_lADOABII585lrb4NzwAAAAItFebp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9346344681",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "4f72852f81406c53debb323ef792c59860a47a3a",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/4f72852f81406c53debb323ef792c59860a47a3a",
      "created_at": "2023-05-26T04:26:30Z"
    },
    {
      "event": "referenced",
      "id": 9357326637,
      "node_id": "REFE_lADOABII585lrb4NzwAAAAItvXkt",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9357326637",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "f5bbc60963ddf665de40d5ef5a480a475465410b",
      "commit_url": "https://api.github.com/repos/Sjors/bitcoin/commits/f5bbc60963ddf665de40d5ef5a480a475465410b",
      "created_at": "2023-05-27T13:30:11Z"
    },
    {
      "event": "referenced",
      "id": 9357326640,
      "node_id": "REFE_lADOABII585lrb4NzwAAAAItvXkw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9357326640",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "0a4da4954362beb322be48a3eb2778bd22623d1a",
      "commit_url": "https://api.github.com/repos/Sjors/bitcoin/commits/0a4da4954362beb322be48a3eb2778bd22623d1a",
      "created_at": "2023-05-27T13:30:12Z"
    },
    {
      "event": "referenced",
      "id": 9357326642,
      "node_id": "REFE_lADOABII585lrb4NzwAAAAItvXky",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9357326642",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "5d1a6b2b86bb26f4a14d246a666736a4352ef827",
      "commit_url": "https://api.github.com/repos/Sjors/bitcoin/commits/5d1a6b2b86bb26f4a14d246a666736a4352ef827",
      "created_at": "2023-05-27T13:30:12Z"
    },
    {
      "event": "referenced",
      "id": 9357326643,
      "node_id": "REFE_lADOABII585lrb4NzwAAAAItvXkz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9357326643",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "944a06875bdf335b2dcd7632b924fb6f069972ec",
      "commit_url": "https://api.github.com/repos/Sjors/bitcoin/commits/944a06875bdf335b2dcd7632b924fb6f069972ec",
      "created_at": "2023-05-27T13:30:12Z"
    },
    {
      "event": "referenced",
      "id": 9357326645,
      "node_id": "REFE_lADOABII585lrb4NzwAAAAItvXk1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9357326645",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "0c75a94ec57fbdf54019db29e7a594e5ecb875da",
      "commit_url": "https://api.github.com/repos/Sjors/bitcoin/commits/0c75a94ec57fbdf54019db29e7a594e5ecb875da",
      "created_at": "2023-05-27T13:30:12Z"
    },
    {
      "event": "referenced",
      "id": 9357326648,
      "node_id": "REFE_lADOABII585lrb4NzwAAAAItvXk4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9357326648",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "55e9aa680051e1184d0938074687ecac2e67f879",
      "commit_url": "https://api.github.com/repos/Sjors/bitcoin/commits/55e9aa680051e1184d0938074687ecac2e67f879",
      "created_at": "2023-05-27T13:30:12Z"
    },
    {
      "event": "referenced",
      "id": 9412184343,
      "node_id": "REFE_lADOABII585lrb4NzwAAAAIxAokX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9412184343",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "da527094cf97b2ba4f96cb242537bcd4b509728d",
      "commit_url": "https://api.github.com/repos/fanquake/bitcoin/commits/da527094cf97b2ba4f96cb242537bcd4b509728d",
      "created_at": "2023-06-02T09:26:21Z"
    },
    {
      "event": "referenced",
      "id": 9412184359,
      "node_id": "REFE_lADOABII585lrb4NzwAAAAIxAokn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9412184359",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "ff01fc0052320ca50b0dfc7fecbd3d1f86057b73",
      "commit_url": "https://api.github.com/repos/fanquake/bitcoin/commits/ff01fc0052320ca50b0dfc7fecbd3d1f86057b73",
      "created_at": "2023-06-02T09:26:21Z"
    },
    {
      "event": "referenced",
      "id": 9412184375,
      "node_id": "REFE_lADOABII585lrb4NzwAAAAIxAok3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9412184375",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "f1e276cae5d0d3bb3f81844fdd60fc2cd85ca451",
      "commit_url": "https://api.github.com/repos/fanquake/bitcoin/commits/f1e276cae5d0d3bb3f81844fdd60fc2cd85ca451",
      "created_at": "2023-06-02T09:26:22Z"
    },
    {
      "event": "referenced",
      "id": 9412184391,
      "node_id": "REFE_lADOABII585lrb4NzwAAAAIxAolH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9412184391",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "debe9d292fd49d15f1acfc440c4622f57e954916",
      "commit_url": "https://api.github.com/repos/fanquake/bitcoin/commits/debe9d292fd49d15f1acfc440c4622f57e954916",
      "created_at": "2023-06-02T09:26:22Z"
    },
    {
      "event": "referenced",
      "id": 9412184411,
      "node_id": "REFE_lADOABII585lrb4NzwAAAAIxAolb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9412184411",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "c17746d87fc121fec46a1933c0f7ab2a303ca9fb",
      "commit_url": "https://api.github.com/repos/fanquake/bitcoin/commits/c17746d87fc121fec46a1933c0f7ab2a303ca9fb",
      "created_at": "2023-06-02T09:26:22Z"
    },
    {
      "event": "referenced",
      "id": 9412184428,
      "node_id": "REFE_lADOABII585lrb4NzwAAAAIxAols",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9412184428",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "ce969f4684bae841792146964a44f86127db8b27",
      "commit_url": "https://api.github.com/repos/fanquake/bitcoin/commits/ce969f4684bae841792146964a44f86127db8b27",
      "created_at": "2023-06-02T09:26:22Z"
    },
    {
      "event": "commented",
      "id": 1573877749,
      "node_id": "IC_kwDOABII585dz3f1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1573877749",
      "actor": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-02T15:00:46Z",
      "updated_at": "2023-06-02T15:00:46Z",
      "author_association": "MEMBER",
      "body": "@instagibbs does this close https://github.com/bitcoin/bitcoin/issues/21803 ?",
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#issuecomment-1573877749",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626"
    },
    {
      "event": "mentioned",
      "id": 9415327438,
      "node_id": "MEE_lADOABII585lrb4NzwAAAAIxMn7O",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9415327438",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-02T15:00:47Z"
    },
    {
      "event": "subscribed",
      "id": 9415327466,
      "node_id": "SE_lADOABII585lrb4NzwAAAAIxMn7q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9415327466",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-02T15:00:47Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191251631",
      "pull_request_review_id": 1422727983,
      "id": 1191251631,
      "node_id": "PRRC_kwDOABII585HAQ6v",
      "diff_hunk": "@@ -901,7 +901,7 @@ class PeerManagerImpl final : public PeerManager\n      */\n     void FindNextBlocksToDownload(const Peer& peer, unsigned int count, std::vector<const CBlockIndex*>& vBlocks, NodeId& nodeStaller) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n-    typedef std::map<uint256, std::pair<NodeId, std::list<QueuedBlock>::iterator>> BlockDownloadMap;\n+    typedef std::multimap<uint256, std::pair<NodeId, std::list<QueuedBlock>::iterator>> BlockDownloadMap;",
      "path": "src/net_processing.cpp",
      "position": 24,
      "original_position": 5,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "e85fa404627430094c1e25f96af156b0de9d3605",
      "in_reply_to_id": null,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Would this be better as a `map<uint256, map<NodeId, list<>::iterator>>` ? Seems like it'd make some of the `FIXME`s easier.",
      "created_at": "2023-05-11T14:24:31Z",
      "updated_at": "2023-05-11T15:47:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1191251631",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191251631"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 905,
      "original_line": 905,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191307770",
      "pull_request_review_id": 1422727983,
      "id": 1191307770,
      "node_id": "PRRC_kwDOABII585HAen6",
      "diff_hunk": "@@ -4300,7 +4300,7 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n \n         if (pindex->nChainWork <= m_chainman.ActiveChain().Tip()->nChainWork || // We know something better\n                 pindex->nTx != 0) { // We had this block at some point, but pruned it\n-            if (fAlreadyInFlight) {\n+            if (in_flight_same_peer) {\n                 // We requested this block for some reason, but our mempool will probably be useless\n                 // so we just grab the block via normal getdata",
      "path": "src/net_processing.cpp",
      "position": 235,
      "original_position": 7,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "e7911fd8901bc2093e1194dc62e11123592f14f5",
      "in_reply_to_id": null,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think this case is (mostly) for when a non-high-bandwidth peer tells us about a block, we request it via a compact block, and then we get a different block from some other peer, UpdateTip to that, and only afterwards see the CMPCTBLOCK response from the original peer. But now that response is probably useless, so replace it with a GETDATA.\r\n\r\nI wonder if that might be better expressed as: `if (in_flight_same_peer && pindex->pprev != ActiveChain().Tip())` ?",
      "created_at": "2023-05-11T14:55:20Z",
      "updated_at": "2023-05-11T15:47:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1191307770",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191307770"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4327,
      "original_line": 4327,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191313364",
      "pull_request_review_id": 1422727983,
      "id": 1191313364,
      "node_id": "PRRC_kwDOABII585HAf_U",
      "diff_hunk": "@@ -4275,12 +4283,21 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             nodestate->m_last_block_announcement = GetTime();\n         }\n \n-        BlockDownloadMap::iterator blockInFlightIt = mapBlocksInFlight.find(pindex->GetBlockHash());\n-        bool fAlreadyInFlight = blockInFlightIt != mapBlocksInFlight.end();\n-\n         if (pindex->nStatus & BLOCK_HAVE_DATA) // Nothing to do here\n             return;\n \n+        auto range_flight = mapBlocksInFlight.equal_range(pindex->GetBlockHash());\n+        bool fAlreadyInFlight = range_flight.first != range_flight.second;\n+        bool in_flight_same_peer = false;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 127,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "e85fa404627430094c1e25f96af156b0de9d3605",
      "in_reply_to_id": null,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Might be better to name this `requested_block_from_this_peer` ? (I think for new code we prefer `bool x{false};` so we get errors if we're accidently narrowing values?)",
      "created_at": "2023-05-11T14:58:03Z",
      "updated_at": "2023-05-11T15:47:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1191313364",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191313364"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4291,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191320979",
      "pull_request_review_id": 1422727983,
      "id": 1191320979,
      "node_id": "PRRC_kwDOABII585HAh2T",
      "diff_hunk": "@@ -4297,6 +4297,7 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             }\n             range_flight.first++;\n         }\n+        bool first_in_flight = !already_in_flight || in_flight_same_peer;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 35,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "1cde8b4862182571cde493cbceb612f321c6c3ef",
      "in_reply_to_id": null,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`already_in_flight == 0 || (already_in_flight == 1 && in_flight_same_peer)` ?",
      "created_at": "2023-05-11T15:03:31Z",
      "updated_at": "2023-05-11T15:47:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1191320979",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191320979"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4300,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191323390",
      "pull_request_review_id": 1422727983,
      "id": 1191323390,
      "node_id": "PRRC_kwDOABII585HAib-",
      "diff_hunk": "@@ -4357,8 +4363,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     blockTxnMsg << txn;\n                     fProcessBLOCKTXN = true;\n                 } else {\n-                    req.blockhash = pindex->GetBlockHash();\n-                    m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETBLOCKTXN, req));\n+                    // We will try to round-trip any compact blocks we get on failure,\n+                    // as long as it's first, or not too large\n+                    if (req.indexes.size() <= MAX_GETBLOCKTXN_TXN_AFTER_FIRST_IN_FLIGHT || first_in_flight) {",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 78,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "1cde8b4862182571cde493cbceb612f321c6c3ef",
      "in_reply_to_id": null,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "(Test the bool first?)",
      "created_at": "2023-05-11T15:05:16Z",
      "updated_at": "2023-05-11T15:47:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1191323390",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191323390"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4368,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191357478",
      "pull_request_review_id": 1422727983,
      "id": 1191357478,
      "node_id": "PRRC_kwDOABII585HAqwm",
      "diff_hunk": "@@ -22,6 +22,11 @@ static const bool DEFAULT_PEERBLOOMFILTERS = false;\n static const bool DEFAULT_PEERBLOCKFILTERS = false;\n /** Threshold for marking a node to be discouraged, e.g. disconnected and added to the discouragement filter. */\n static const int DISCOURAGEMENT_THRESHOLD{100};\n+/** Maximum number of outstanding CMPCTBLOCK requests for the same block. */\n+/** Greg: Setting to 3 to match number of high bandwidth peers... ~ensures one is outbound */\n+static const unsigned int MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK = 3;\n+/** Maximum number of missing transactions for a non-first getblocktxn request */\n+static const unsigned int MAX_GETBLOCKTXN_TXN_AFTER_FIRST_IN_FLIGHT = 10;",
      "path": "src/net_processing.h",
      "position": null,
      "original_position": 8,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "1cde8b4862182571cde493cbceb612f321c6c3ef",
      "in_reply_to_id": null,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Out of the last 612 compact blocks my node's reconstructed that required requesting transactions, 277 needed 10 or fewer (45%), 441 needed 50 or fewer (72%), 488 needed 100 or fewer (80%), 548 needed 500 or fewer (90%). I'd probably prefer 50 or 100 than 10, I guess?\r\n\r\n(In simpler times, 1086/1162 (93%) need 10 or fewer, 1140/1162 (98%) needed 50 or fewer, 1144/1162 (98.5%) needed 100 or fewer. Again, I'm not including blocks that requested 0 txs in those denominators)",
      "created_at": "2023-05-11T15:30:25Z",
      "updated_at": "2023-05-11T15:47:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1191357478",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191357478"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 28,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191369251",
      "pull_request_review_id": 1422727983,
      "id": 1191369251,
      "node_id": "PRRC_kwDOABII585HAtoj",
      "diff_hunk": "@@ -4452,13 +4465,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             LOCK(cs_main);\n \n             bool expected_blocktxn = false;\n+            bool first_in_flight = true;\n             auto range_flight = mapBlocksInFlight.equal_range(resp.blockhash);\n             while (range_flight.first != range_flight.second) {\n                 auto [node_id, block_it] = range_flight.first->second;\n                 if (node_id == pfrom.GetId() && block_it->partialBlock) {\n                     expected_blocktxn = true;\n                     break;\n                 }\n+                first_in_flight = false;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 100,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "1cde8b4862182571cde493cbceb612f321c6c3ef",
      "in_reply_to_id": null,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This logic is different to the previous `first_in_flight`; probably should be the same?",
      "created_at": "2023-05-11T15:39:18Z",
      "updated_at": "2023-05-11T15:47:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1191369251",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191369251"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4487,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191418745",
      "pull_request_review_id": 1422991579,
      "id": 1191418745,
      "node_id": "PRRC_kwDOABII585HA5t5",
      "diff_hunk": "@@ -4300,7 +4300,7 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n \n         if (pindex->nChainWork <= m_chainman.ActiveChain().Tip()->nChainWork || // We know something better\n                 pindex->nTx != 0) { // We had this block at some point, but pruned it\n-            if (fAlreadyInFlight) {\n+            if (in_flight_same_peer) {\n                 // We requested this block for some reason, but our mempool will probably be useless\n                 // so we just grab the block via normal getdata",
      "path": "src/net_processing.cpp",
      "position": 235,
      "original_position": 7,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "e7911fd8901bc2093e1194dc62e11123592f14f5",
      "in_reply_to_id": 1191307770,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "sounds right, I'll sit on this for a bit",
      "created_at": "2023-05-11T16:17:34Z",
      "updated_at": "2023-05-11T16:17:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1191418745",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191418745"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4327,
      "original_line": 4327,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191426977",
      "pull_request_review_id": 1423003852,
      "id": 1191426977,
      "node_id": "PRRC_kwDOABII585HA7uh",
      "diff_hunk": "@@ -4364,8 +4364,11 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     fProcessBLOCKTXN = true;\n                 } else {\n                     // We will try to round-trip any compact blocks we get on failure,\n-                    // as long as it's first, or not too large\n-                    if (req.indexes.size() <= MAX_GETBLOCKTXN_TXN_AFTER_FIRST_IN_FLIGHT || first_in_flight) {\n+                    // as long as it's first, or not too large, and as long as we chose\n+                    // the peer for high-bandwidth relay.\n+                    auto hb_peer = std::find(lNodesAnnouncingHeaderAndIDs.begin(), lNodesAnnouncingHeaderAndIDs.end(), pfrom.GetId());\n+                    if ((hb_peer != lNodesAnnouncingHeaderAndIDs.end() && req.indexes.size() <= MAX_GETBLOCKTXN_TXN_AFTER_FIRST_IN_FLIGHT) ||",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 9,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "df1218b447aabfc54f86406d4813057df1ddf216",
      "in_reply_to_id": null,
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Could use `pfrom.m_bip152_highbandwidth_to`?",
      "created_at": "2023-05-11T16:24:43Z",
      "updated_at": "2023-05-11T16:24:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1191426977",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191426977"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": 4369,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 4370,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191435827",
      "pull_request_review_id": 1423017870,
      "id": 1191435827,
      "node_id": "PRRC_kwDOABII585HA94z",
      "diff_hunk": "@@ -22,6 +22,11 @@ static const bool DEFAULT_PEERBLOOMFILTERS = false;\n static const bool DEFAULT_PEERBLOCKFILTERS = false;\n /** Threshold for marking a node to be discouraged, e.g. disconnected and added to the discouragement filter. */\n static const int DISCOURAGEMENT_THRESHOLD{100};\n+/** Maximum number of outstanding CMPCTBLOCK requests for the same block. */\n+/** Greg: Setting to 3 to match number of high bandwidth peers... ~ensures one is outbound */\n+static const unsigned int MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK = 3;\n+/** Maximum number of missing transactions for a non-first getblocktxn request */\n+static const unsigned int MAX_GETBLOCKTXN_TXN_AFTER_FIRST_IN_FLIGHT = 10;",
      "path": "src/net_processing.h",
      "position": null,
      "original_position": 8,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "1cde8b4862182571cde493cbceb612f321c6c3ef",
      "in_reply_to_id": 1191357478,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "what if we just removed the limit, since it's not much of a protection, especially if the missing 10 txns are *nscriptions",
      "created_at": "2023-05-11T16:32:57Z",
      "updated_at": "2023-05-11T16:32:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1191435827",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191435827"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 28,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191441529",
      "pull_request_review_id": 1423026354,
      "id": 1191441529,
      "node_id": "PRRC_kwDOABII585HA_R5",
      "diff_hunk": "@@ -4300,7 +4300,7 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n \n         if (pindex->nChainWork <= m_chainman.ActiveChain().Tip()->nChainWork || // We know something better\n                 pindex->nTx != 0) { // We had this block at some point, but pruned it\n-            if (fAlreadyInFlight) {\n+            if (in_flight_same_peer) {\n                 // We requested this block for some reason, but our mempool will probably be useless\n                 // so we just grab the block via normal getdata",
      "path": "src/net_processing.cpp",
      "position": 235,
      "original_position": 7,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "e7911fd8901bc2093e1194dc62e11123592f14f5",
      "in_reply_to_id": 1191307770,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Probably better to defer it as an unrelated change anyway?",
      "created_at": "2023-05-11T16:38:28Z",
      "updated_at": "2023-05-11T16:38:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1191441529",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191441529"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4327,
      "original_line": 4327,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191449571",
      "pull_request_review_id": 1423038359,
      "id": 1191449571,
      "node_id": "PRRC_kwDOABII585HBBPj",
      "diff_hunk": "@@ -4275,12 +4283,21 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             nodestate->m_last_block_announcement = GetTime();\n         }\n \n-        BlockDownloadMap::iterator blockInFlightIt = mapBlocksInFlight.find(pindex->GetBlockHash());\n-        bool fAlreadyInFlight = blockInFlightIt != mapBlocksInFlight.end();\n-\n         if (pindex->nStatus & BLOCK_HAVE_DATA) // Nothing to do here\n             return;\n \n+        auto range_flight = mapBlocksInFlight.equal_range(pindex->GetBlockHash());\n+        bool fAlreadyInFlight = range_flight.first != range_flight.second;\n+        bool in_flight_same_peer = false;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 127,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "e85fa404627430094c1e25f96af156b0de9d3605",
      "in_reply_to_id": 1191313364,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "don't love your name suggestion; changed the initialization though",
      "created_at": "2023-05-11T16:46:14Z",
      "updated_at": "2023-05-11T16:46:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1191449571",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191449571"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4291,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191449589",
      "pull_request_review_id": 1423038391,
      "id": 1191449589,
      "node_id": "PRRC_kwDOABII585HBBP1",
      "diff_hunk": "@@ -22,6 +22,11 @@ static const bool DEFAULT_PEERBLOOMFILTERS = false;\n static const bool DEFAULT_PEERBLOCKFILTERS = false;\n /** Threshold for marking a node to be discouraged, e.g. disconnected and added to the discouragement filter. */\n static const int DISCOURAGEMENT_THRESHOLD{100};\n+/** Maximum number of outstanding CMPCTBLOCK requests for the same block. */\n+/** Greg: Setting to 3 to match number of high bandwidth peers... ~ensures one is outbound */\n+static const unsigned int MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK = 3;\n+/** Maximum number of missing transactions for a non-first getblocktxn request */\n+static const unsigned int MAX_GETBLOCKTXN_TXN_AFTER_FIRST_IN_FLIGHT = 10;",
      "path": "src/net_processing.h",
      "position": null,
      "original_position": 8,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "1cde8b4862182571cde493cbceb612f321c6c3ef",
      "in_reply_to_id": 1191357478,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think the limit's fine; when you start up with an empty mempool, you'll be requesting most of the transactions in the block because your mempool's empty, and there's no need to do that three times in parallel. Could perhaps have the limit work the other way: if you've already got N txs and need K txs, and `0 < K <= N/4 + 10`; then if the block just has ten 100kvB txs, you won't request them multiple times.",
      "created_at": "2023-05-11T16:46:16Z",
      "updated_at": "2023-05-11T16:46:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1191449589",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191449589"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 28,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191458103",
      "pull_request_review_id": 1423054145,
      "id": 1191458103,
      "node_id": "PRRC_kwDOABII585HBDU3",
      "diff_hunk": "@@ -4364,8 +4364,11 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     fProcessBLOCKTXN = true;\n                 } else {\n                     // We will try to round-trip any compact blocks we get on failure,\n-                    // as long as it's first, or not too large\n-                    if (req.indexes.size() <= MAX_GETBLOCKTXN_TXN_AFTER_FIRST_IN_FLIGHT || first_in_flight) {\n+                    // as long as it's first, or not too large, and as long as we chose\n+                    // the peer for high-bandwidth relay.\n+                    auto hb_peer = std::find(lNodesAnnouncingHeaderAndIDs.begin(), lNodesAnnouncingHeaderAndIDs.end(), pfrom.GetId());\n+                    if ((hb_peer != lNodesAnnouncingHeaderAndIDs.end() && req.indexes.size() <= MAX_GETBLOCKTXN_TXN_AFTER_FIRST_IN_FLIGHT) ||",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 9,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "df1218b447aabfc54f86406d4813057df1ddf216",
      "in_reply_to_id": 1191426977,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "done",
      "created_at": "2023-05-11T16:54:47Z",
      "updated_at": "2023-05-11T16:54:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1191458103",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191458103"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": 4369,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 4370,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191480873",
      "pull_request_review_id": 1423093314,
      "id": 1191480873,
      "node_id": "PRRC_kwDOABII585HBI4p",
      "diff_hunk": "@@ -4275,12 +4283,21 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             nodestate->m_last_block_announcement = GetTime();\n         }\n \n-        BlockDownloadMap::iterator blockInFlightIt = mapBlocksInFlight.find(pindex->GetBlockHash());\n-        bool fAlreadyInFlight = blockInFlightIt != mapBlocksInFlight.end();\n-\n         if (pindex->nStatus & BLOCK_HAVE_DATA) // Nothing to do here\n             return;\n \n+        auto range_flight = mapBlocksInFlight.equal_range(pindex->GetBlockHash());\n+        bool fAlreadyInFlight = range_flight.first != range_flight.second;\n+        bool in_flight_same_peer = false;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 127,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "e85fa404627430094c1e25f96af156b0de9d3605",
      "in_reply_to_id": 1191313364,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Let me rephrase. What I meant was that `in_flight_same_peer` confused me: \"we just received the block from this peer, of course it was in flight, how else would it get to us?\". But what the bool is actually telling us is that we had deliberately asked this peer for this block, it wasn't just spontaneously sent to us.",
      "created_at": "2023-05-11T17:16:56Z",
      "updated_at": "2023-05-11T17:16:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1191480873",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191480873"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4291,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191523726",
      "pull_request_review_id": 1423160189,
      "id": 1191523726,
      "node_id": "PRRC_kwDOABII585HBTWO",
      "diff_hunk": "@@ -22,6 +22,11 @@ static const bool DEFAULT_PEERBLOOMFILTERS = false;\n static const bool DEFAULT_PEERBLOCKFILTERS = false;\n /** Threshold for marking a node to be discouraged, e.g. disconnected and added to the discouragement filter. */\n static const int DISCOURAGEMENT_THRESHOLD{100};\n+/** Maximum number of outstanding CMPCTBLOCK requests for the same block. */\n+/** Greg: Setting to 3 to match number of high bandwidth peers... ~ensures one is outbound */\n+static const unsigned int MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK = 3;\n+/** Maximum number of missing transactions for a non-first getblocktxn request */\n+static const unsigned int MAX_GETBLOCKTXN_TXN_AFTER_FIRST_IN_FLIGHT = 10;",
      "path": "src/net_processing.h",
      "position": null,
      "original_position": 8,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "1cde8b4862182571cde493cbceb612f321c6c3ef",
      "in_reply_to_id": 1191357478,
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Imo, it doesn't seem worthwhile to have the limit:\r\n* the good case (small K) should be far more common than the bad one (large K)\r\n* the limit makes relay of blocks with large K less reliable w.r.t to stalling (reduces to what we have now)\r\n* the limit adds code complexity and a maintenance burden. 10 is not a good value according to your data and if #10984 had been merged then we would need to re-evaluate now. Who's to say this won't change again.",
      "created_at": "2023-05-11T18:01:25Z",
      "updated_at": "2023-05-11T18:01:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1191523726",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191523726"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 28,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191541721",
      "pull_request_review_id": 1423187928,
      "id": 1191541721,
      "node_id": "PRRC_kwDOABII585HBXvZ",
      "diff_hunk": "@@ -901,7 +901,7 @@ class PeerManagerImpl final : public PeerManager\n      */\n     void FindNextBlocksToDownload(const Peer& peer, unsigned int count, std::vector<const CBlockIndex*>& vBlocks, NodeId& nodeStaller) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n-    typedef std::map<uint256, std::pair<NodeId, std::list<QueuedBlock>::iterator>> BlockDownloadMap;\n+    typedef std::multimap<uint256, std::pair<NodeId, std::list<QueuedBlock>::iterator>> BlockDownloadMap;",
      "path": "src/net_processing.cpp",
      "position": 24,
      "original_position": 5,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "e85fa404627430094c1e25f96af156b0de9d3605",
      "in_reply_to_id": 1191251631,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "after attempting the change, I think that would violate https://github.com/bitcoin/bitcoin/pull/27626/commits/e424dcba60e61f014b19a3e2f59238ca3b91f3db#diff-6875de769e90cec84d2e8a9c1b962cdbcda44d870d42e4215827e599e11e90e3R1394 which requires insertion ordering to know which is the stalling peer.\r\n\r\ntotally forgot about the FIXME...",
      "created_at": "2023-05-11T18:21:34Z",
      "updated_at": "2023-05-11T18:21:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1191541721",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191541721"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 905,
      "original_line": 905,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191560489",
      "pull_request_review_id": 1423217956,
      "id": 1191560489,
      "node_id": "PRRC_kwDOABII585HBcUp",
      "diff_hunk": "@@ -4275,12 +4283,21 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             nodestate->m_last_block_announcement = GetTime();\n         }\n \n-        BlockDownloadMap::iterator blockInFlightIt = mapBlocksInFlight.find(pindex->GetBlockHash());\n-        bool fAlreadyInFlight = blockInFlightIt != mapBlocksInFlight.end();\n-\n         if (pindex->nStatus & BLOCK_HAVE_DATA) // Nothing to do here\n             return;\n \n+        auto range_flight = mapBlocksInFlight.equal_range(pindex->GetBlockHash());\n+        bool fAlreadyInFlight = range_flight.first != range_flight.second;\n+        bool in_flight_same_peer = false;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 127,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "e85fa404627430094c1e25f96af156b0de9d3605",
      "in_reply_to_id": 1191313364,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "ok, I can see that and how it reads cleaner, changed",
      "created_at": "2023-05-11T18:42:17Z",
      "updated_at": "2023-05-11T18:42:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1191560489",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191560489"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4291,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191569820",
      "pull_request_review_id": 1423234162,
      "id": 1191569820,
      "node_id": "PRRC_kwDOABII585HBemc",
      "diff_hunk": "@@ -4452,13 +4465,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             LOCK(cs_main);\n \n             bool expected_blocktxn = false;\n+            bool first_in_flight = true;\n             auto range_flight = mapBlocksInFlight.equal_range(resp.blockhash);\n             while (range_flight.first != range_flight.second) {\n                 auto [node_id, block_it] = range_flight.first->second;\n                 if (node_id == pfrom.GetId() && block_it->partialBlock) {\n                     expected_blocktxn = true;\n                     break;\n                 }\n+                first_in_flight = false;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 100,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "1cde8b4862182571cde493cbceb612f321c6c3ef",
      "in_reply_to_id": 1191369251,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "done, cleaner thank you",
      "created_at": "2023-05-11T18:51:29Z",
      "updated_at": "2023-05-11T18:51:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1191569820",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191569820"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4487,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191650786",
      "pull_request_review_id": 1423375759,
      "id": 1191650786,
      "node_id": "PRRC_kwDOABII585HByXi",
      "diff_hunk": "@@ -22,6 +22,11 @@ static const bool DEFAULT_PEERBLOOMFILTERS = false;\n static const bool DEFAULT_PEERBLOCKFILTERS = false;\n /** Threshold for marking a node to be discouraged, e.g. disconnected and added to the discouragement filter. */\n static const int DISCOURAGEMENT_THRESHOLD{100};\n+/** Maximum number of outstanding CMPCTBLOCK requests for the same block. */\n+/** Greg: Setting to 3 to match number of high bandwidth peers... ~ensures one is outbound */\n+static const unsigned int MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK = 3;\n+/** Maximum number of missing transactions for a non-first getblocktxn request */\n+static const unsigned int MAX_GETBLOCKTXN_TXN_AFTER_FIRST_IN_FLIGHT = 10;",
      "path": "src/net_processing.h",
      "position": null,
      "original_position": 8,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "1cde8b4862182571cde493cbceb612f321c6c3ef",
      "in_reply_to_id": 1191357478,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "if the issue is during warmup, that's a pretty small window, and typically won't actually do parallel fetching, 3 seems rare even when warmed up with limit of 10. I'll gather some more stats on that front, seeing how many parallel blocks are initialized.",
      "created_at": "2023-05-11T20:19:33Z",
      "updated_at": "2023-05-11T20:19:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1191650786",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191650786"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 28,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1192138027",
      "pull_request_review_id": 1424128109,
      "id": 1192138027,
      "node_id": "PRRC_kwDOABII585HDpUr",
      "diff_hunk": "@@ -4342,8 +4372,17 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     blockTxnMsg << txn;\n                     fProcessBLOCKTXN = true;\n                 } else {\n-                    req.blockhash = pindex->GetBlockHash();\n-                    m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETBLOCKTXN, req));\n+                    // We will try to round-trip any compact blocks we get on failure,\n+                    // as long as it's first, or not too large and as long as we chose\n+                    // the peer for high-bandwidth relay.\n+                    if (first_in_flight ||\n+                        (pfrom.m_bip152_highbandwidth_to && req.indexes.size() <= MAX_GETBLOCKTXN_TXN_AFTER_FIRST_IN_FLIGHT)) {\n+                        req.blockhash = pindex->GetBlockHash();\n+                        m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETBLOCKTXN, req));",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 249,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "ceded96265fbf3528dbb2a845d599ecbbae1bdb7",
      "in_reply_to_id": null,
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This could be a `else if` of the outer if statement. That would avoid the nesting here.",
      "created_at": "2023-05-12T09:28:46Z",
      "updated_at": "2023-05-12T09:28:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1192138027",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1192138027"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": 4378,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 4381,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1192388557",
      "pull_request_review_id": 1424529964,
      "id": 1192388557,
      "node_id": "PRRC_kwDOABII585HEmfN",
      "diff_hunk": "@@ -4342,8 +4372,17 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     blockTxnMsg << txn;\n                     fProcessBLOCKTXN = true;\n                 } else {\n-                    req.blockhash = pindex->GetBlockHash();\n-                    m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETBLOCKTXN, req));\n+                    // We will try to round-trip any compact blocks we get on failure,\n+                    // as long as it's first, or not too large and as long as we chose\n+                    // the peer for high-bandwidth relay.\n+                    if (first_in_flight ||\n+                        (pfrom.m_bip152_highbandwidth_to && req.indexes.size() <= MAX_GETBLOCKTXN_TXN_AFTER_FIRST_IN_FLIGHT)) {\n+                        req.blockhash = pindex->GetBlockHash();\n+                        m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETBLOCKTXN, req));",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 249,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "ceded96265fbf3528dbb2a845d599ecbbae1bdb7",
      "in_reply_to_id": 1192138027,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "done",
      "created_at": "2023-05-12T13:35:28Z",
      "updated_at": "2023-05-12T13:35:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1192388557",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1192388557"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": 4378,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 4381,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1192406738",
      "pull_request_review_id": 1424559087,
      "id": 1192406738,
      "node_id": "PRRC_kwDOABII585HEq7S",
      "diff_hunk": "@@ -22,6 +22,11 @@ static const bool DEFAULT_PEERBLOOMFILTERS = false;\n static const bool DEFAULT_PEERBLOCKFILTERS = false;\n /** Threshold for marking a node to be discouraged, e.g. disconnected and added to the discouragement filter. */\n static const int DISCOURAGEMENT_THRESHOLD{100};\n+/** Maximum number of outstanding CMPCTBLOCK requests for the same block. */\n+/** Greg: Setting to 3 to match number of high bandwidth peers... ~ensures one is outbound */\n+static const unsigned int MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK = 3;\n+/** Maximum number of missing transactions for a non-first getblocktxn request */\n+static const unsigned int MAX_GETBLOCKTXN_TXN_AFTER_FIRST_IN_FLIGHT = 10;",
      "path": "src/net_processing.h",
      "position": null,
      "original_position": 8,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "1cde8b4862182571cde493cbceb612f321c6c3ef",
      "in_reply_to_id": 1191357478,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This \"warmup\" should really only be an issue after we've seen new blocks from 3+ peers since we don't persist hb peers across restarts and we have to wait for `MaybeSetPeerAsAnnouncingHeaderAndIDs` to be called on multiple unique peers. I now suspect the warmup period handles itself? My logs show 4+ blocks per node with only one partial block.",
      "created_at": "2023-05-12T13:50:40Z",
      "updated_at": "2023-05-12T13:50:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1192406738",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1192406738"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 28,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196575479",
      "pull_request_review_id": 1430785565,
      "id": 1196575479,
      "node_id": "PRRC_kwDOABII585HUkr3",
      "diff_hunk": "@@ -1125,34 +1126,40 @@ bool PeerManagerImpl::IsBlockRequested(const uint256& hash)\n \n void PeerManagerImpl::RemoveBlockRequest(const uint256& hash, std::optional<NodeId> from_peer)\n {\n-    auto it = mapBlocksInFlight.find(hash);\n-    if (it == mapBlocksInFlight.end()) {\n-        // Block was not requested\n+    auto range = mapBlocksInFlight.equal_range(hash);\n+    if (range.first == range.second) {\n+        // Block was not requested by any peer",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 19,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "ffc0aa03903a57fdcf66111e7874f17f390414eb",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: This comment is not right, should say something like \"was not requested from any peer\".",
      "created_at": "2023-05-17T14:02:52Z",
      "updated_at": "2023-05-17T15:52:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1196575479",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196575479"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1131,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196640876",
      "pull_request_review_id": 1430785565,
      "id": 1196640876,
      "node_id": "PRRC_kwDOABII585HU0ps",
      "diff_hunk": "@@ -1514,6 +1522,15 @@ void PeerManagerImpl::FinalizeNode(const CNode& node)\n         nSyncStarted--;\n \n     for (const QueuedBlock& entry : state->vBlocksInFlight) {\n+        auto range = mapBlocksInFlight.equal_range(entry.pindex->GetBlockHash());\n+        while (range.first != range.second) {\n+            auto [node_id, list_it] = range.first->second;\n+            if (node_id != nodeid) {\n+                range.first++;\n+            } else {\n+                range.first = mapBlocksInFlight.erase(range.first);\n+            }\n+        }\n         mapBlocksInFlight.erase(entry.pindex->GetBlockHash());",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 121,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "ffc0aa03903a57fdcf66111e7874f17f390414eb",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Doesn't this line need to be removed here?",
      "created_at": "2023-05-17T14:47:26Z",
      "updated_at": "2023-05-17T15:52:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1196640876",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196640876"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1534,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196669983",
      "pull_request_review_id": 1430785565,
      "id": 1196669983,
      "node_id": "PRRC_kwDOABII585HU7wf",
      "diff_hunk": "@@ -4320,7 +4320,7 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         // If we're not close to tip yet, give up and let parallel block fetch work its magic\n-        if (!fAlreadyInFlight && !CanDirectFetch()) {\n+        if (!in_flight_same_peer && !CanDirectFetch()) {",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "999a123082a21aae5c2cecfa7b7e4b9ee67e66ae",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "What's the justification for this change?  It seems like this changes things so that in edge-case scenarios, we wouldn't allow the opportunistic compact block reconstruction to take place, and I don't see why we need to do that.",
      "created_at": "2023-05-17T15:05:45Z",
      "updated_at": "2023-05-17T15:52:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1196669983",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196669983"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4323,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196679410",
      "pull_request_review_id": 1430785565,
      "id": 1196679410,
      "node_id": "PRRC_kwDOABII585HU-Dy",
      "diff_hunk": "@@ -1132,8 +1147,8 @@ void PeerManagerImpl::RemoveBlockRequest(const uint256& hash, std::optional<Node\n         return;\n     }\n \n-    // Currently we don't request more than one peer for same block\n-    Assume(mapBlocksInFlight.count(hash) == 1);\n+    // We should never requested too many of this block",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 35,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "e54f2d3680ad79ce8652fcdc37bf8331b9e892b5",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: perhaps \"We should not have requested too many of this block\"",
      "created_at": "2023-05-17T15:10:51Z",
      "updated_at": "2023-05-17T15:52:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1196679410",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196679410"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1150,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196683873",
      "pull_request_review_id": 1430785565,
      "id": 1196683873,
      "node_id": "PRRC_kwDOABII585HU_Jh",
      "diff_hunk": "@@ -1179,8 +1194,8 @@ bool PeerManagerImpl::BlockRequested(NodeId nodeid, const CBlockIndex& block, st\n         }\n     }\n \n-    // Make sure it's not listed somewhere already.\n-    RemoveBlockRequest(hash, std::nullopt);\n+    // Make sure it's not being fetched already from same peer.\n+    RemoveBlockRequest(hash, nodeid);",
      "path": "src/net_processing.cpp",
      "position": 131,
      "original_position": 47,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "e54f2d3680ad79ce8652fcdc37bf8331b9e892b5",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Is it worth adding an `Assume()` here that we have strictly less than MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK requests outstanding?",
      "created_at": "2023-05-17T15:13:21Z",
      "updated_at": "2023-05-17T15:52:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1196683873",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196683873"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1195,
      "original_line": 1195,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196713707",
      "pull_request_review_id": 1430785565,
      "id": 1196713707,
      "node_id": "PRRC_kwDOABII585HVGbr",
      "diff_hunk": "@@ -4460,33 +4496,43 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         {\n             LOCK(cs_main);\n \n-            bool expected_blocktxn = false;\n             auto range_flight = mapBlocksInFlight.equal_range(resp.blockhash);\n+            size_t already_in_flight = std::distance(range_flight.first, range_flight.second);\n+            bool requested_block_from_this_peer{false};\n+\n             while (range_flight.first != range_flight.second) {\n                 auto [node_id, block_it] = range_flight.first->second;\n                 if (node_id == pfrom.GetId() && block_it->partialBlock) {\n-                    expected_blocktxn = true;\n+                    requested_block_from_this_peer = true;\n                     break;\n                 }\n                 range_flight.first++;\n             }\n \n-            if (!expected_blocktxn) {\n+            if (!requested_block_from_this_peer) {\n                 LogPrint(BCLog::NET, \"Peer %d sent us block transactions for block we weren't expecting\\n\", pfrom.GetId());\n                 return;\n             }\n \n+            bool first_in_flight = already_in_flight == 0 || (already_in_flight == 1 && requested_block_from_this_peer);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 178,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "e54f2d3680ad79ce8652fcdc37bf8331b9e892b5",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "So if we get 3 compact block announcements from 3 peers, and we then send 3 getblocktxn messages to them, and then the first blocktxn comes back and reconstruction fails, we will wait until we get the third blocktxn message back before we send out a getdata message for the full block, I think?\r\n\r\nThat seems suboptimal, though I don't have a fix in mind yet.",
      "created_at": "2023-05-17T15:34:22Z",
      "updated_at": "2023-05-17T15:52:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1196713707",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196713707"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4518,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196715533",
      "pull_request_review_id": 1430785565,
      "id": 1196715533,
      "node_id": "PRRC_kwDOABII585HVG4N",
      "diff_hunk": "@@ -4460,33 +4496,43 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         {\n             LOCK(cs_main);\n \n-            bool expected_blocktxn = false;\n             auto range_flight = mapBlocksInFlight.equal_range(resp.blockhash);\n+            size_t already_in_flight = std::distance(range_flight.first, range_flight.second);\n+            bool requested_block_from_this_peer{false};\n+\n             while (range_flight.first != range_flight.second) {\n                 auto [node_id, block_it] = range_flight.first->second;\n                 if (node_id == pfrom.GetId() && block_it->partialBlock) {\n-                    expected_blocktxn = true;\n+                    requested_block_from_this_peer = true;\n                     break;\n                 }\n                 range_flight.first++;\n             }\n \n-            if (!expected_blocktxn) {\n+            if (!requested_block_from_this_peer) {\n                 LogPrint(BCLog::NET, \"Peer %d sent us block transactions for block we weren't expecting\\n\", pfrom.GetId());\n                 return;\n             }\n \n+            bool first_in_flight = already_in_flight == 0 || (already_in_flight == 1 && requested_block_from_this_peer);\n+\n             PartiallyDownloadedBlock& partialBlock = *range_flight.first->second.second->partialBlock;\n             ReadStatus status = partialBlock.FillBlock(*pblock, resp.txn);\n             if (status == READ_STATUS_INVALID) {\n                 RemoveBlockRequest(resp.blockhash, pfrom.GetId()); // Reset in-flight state in case Misbehaving does not result in a disconnect\n                 Misbehaving(*peer, 100, \"invalid compact block/non-matching block transactions\");\n                 return;\n             } else if (status == READ_STATUS_FAILED) {\n-                // Might have collided, fall back to getdata now :(\n-                std::vector<CInv> invs;\n-                invs.push_back(CInv(MSG_BLOCK | GetFetchFlags(*peer), resp.blockhash));\n-                m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETDATA, invs));\n+                if (first_in_flight) {\n+                    // Might have collided, fall back to getdata now :(\n+                    std::vector<CInv> invs;\n+                    invs.push_back(CInv(MSG_BLOCK | GetFetchFlags(*peer), resp.blockhash));\n+                    m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETDATA, invs));\n+                } else {\n+                    RemoveBlockRequest(resp.blockhash, pfrom.GetId()); // Reset in-flight state in case of whitelist",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 197,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "e54f2d3680ad79ce8652fcdc37bf8331b9e892b5",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: this comment doesn't seem right",
      "created_at": "2023-05-17T15:35:57Z",
      "updated_at": "2023-05-17T15:52:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1196715533",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196715533"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4532,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196732363",
      "pull_request_review_id": 1430785565,
      "id": 1196732363,
      "node_id": "PRRC_kwDOABII585HVK_L",
      "diff_hunk": "@@ -4277,15 +4307,25 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             nodestate->m_last_block_announcement = GetTime();\n         }\n \n-        std::map<uint256, std::pair<NodeId, std::list<QueuedBlock>::iterator> >::iterator blockInFlightIt = mapBlocksInFlight.find(pindex->GetBlockHash());\n-        bool fAlreadyInFlight = blockInFlightIt != mapBlocksInFlight.end();\n-\n         if (pindex->nStatus & BLOCK_HAVE_DATA) // Nothing to do here\n             return;\n \n+        auto range_flight = mapBlocksInFlight.equal_range(pindex->GetBlockHash());\n+        size_t already_in_flight = std::distance(range_flight.first, range_flight.second);\n+        bool requested_block_from_this_peer{false};\n+\n+        while (range_flight.first != range_flight.second) {\n+            if (range_flight.first->second.first == pfrom.GetId()) {\n+                requested_block_from_this_peer = true;\n+                break;\n+            }\n+            range_flight.first++;\n+        }\n+        bool first_in_flight = already_in_flight == 0 || (already_in_flight == 1 && requested_block_from_this_peer);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 209,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "324af0fd5c64a91780c7beaf9c2023dcf4df90da",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This notion of `first_in_flight` is not correct, I think.  Imagine we get a headers announcement from an outbound (non-hb) peer, and so we send a getdata(cmpctblock).  In the meantime, we get a compact block announcement from an inbound peer which fails to reconstruct.  Then the compact block comes back from the outbound peer; `first_in_flight` will be false because we think we have two requests outstanding.\r\n\r\nFurther down, when we decide whether to send a GETBLOCKTXN message to this non-HB outbound peer, we will choose not to, because `first_in_flight` is false and the peer is not already HB.  This seems like it would be a regression, as inbound HB peers would gain the ability to interfere with compact block relay happening with other peers just by making a compactblock announcement.",
      "created_at": "2023-05-17T15:49:30Z",
      "updated_at": "2023-05-17T16:04:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1196732363",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196732363"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4325,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196773469",
      "pull_request_review_id": 1431106216,
      "id": 1196773469,
      "node_id": "PRRC_kwDOABII585HVVBd",
      "diff_hunk": "@@ -4460,33 +4496,43 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         {\n             LOCK(cs_main);\n \n-            bool expected_blocktxn = false;\n             auto range_flight = mapBlocksInFlight.equal_range(resp.blockhash);\n+            size_t already_in_flight = std::distance(range_flight.first, range_flight.second);\n+            bool requested_block_from_this_peer{false};\n+\n             while (range_flight.first != range_flight.second) {\n                 auto [node_id, block_it] = range_flight.first->second;\n                 if (node_id == pfrom.GetId() && block_it->partialBlock) {\n-                    expected_blocktxn = true;\n+                    requested_block_from_this_peer = true;\n                     break;\n                 }\n                 range_flight.first++;\n             }\n \n-            if (!expected_blocktxn) {\n+            if (!requested_block_from_this_peer) {\n                 LogPrint(BCLog::NET, \"Peer %d sent us block transactions for block we weren't expecting\\n\", pfrom.GetId());\n                 return;\n             }\n \n+            bool first_in_flight = already_in_flight == 0 || (already_in_flight == 1 && requested_block_from_this_peer);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 178,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "e54f2d3680ad79ce8652fcdc37bf8331b9e892b5",
      "in_reply_to_id": 1196713707,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Actually, can we use the insertion order guarantees of multimap to solve this?",
      "created_at": "2023-05-17T16:16:39Z",
      "updated_at": "2023-05-17T16:16:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1196773469",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196773469"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4518,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196774969",
      "pull_request_review_id": 1431108455,
      "id": 1196774969,
      "node_id": "PRRC_kwDOABII585HVVY5",
      "diff_hunk": "@@ -4277,15 +4307,25 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             nodestate->m_last_block_announcement = GetTime();\n         }\n \n-        std::map<uint256, std::pair<NodeId, std::list<QueuedBlock>::iterator> >::iterator blockInFlightIt = mapBlocksInFlight.find(pindex->GetBlockHash());\n-        bool fAlreadyInFlight = blockInFlightIt != mapBlocksInFlight.end();\n-\n         if (pindex->nStatus & BLOCK_HAVE_DATA) // Nothing to do here\n             return;\n \n+        auto range_flight = mapBlocksInFlight.equal_range(pindex->GetBlockHash());\n+        size_t already_in_flight = std::distance(range_flight.first, range_flight.second);\n+        bool requested_block_from_this_peer{false};\n+\n+        while (range_flight.first != range_flight.second) {\n+            if (range_flight.first->second.first == pfrom.GetId()) {\n+                requested_block_from_this_peer = true;\n+                break;\n+            }\n+            range_flight.first++;\n+        }\n+        bool first_in_flight = already_in_flight == 0 || (already_in_flight == 1 && requested_block_from_this_peer);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 209,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "324af0fd5c64a91780c7beaf9c2023dcf4df90da",
      "in_reply_to_id": 1196732363,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Similarly here, can we use the insertion order of multimap to determine which peer was actually first to make the announcement?  If in the situation where an outbound (non-hb) peer is the first to announce that we still always send the getblocktxn if compact blocks fail, then this new logic would not be making anything worse, which seems sufficient to me.",
      "created_at": "2023-05-17T16:18:03Z",
      "updated_at": "2023-05-17T16:18:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1196774969",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196774969"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4325,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196823777",
      "pull_request_review_id": 1431182979,
      "id": 1196823777,
      "node_id": "PRRC_kwDOABII585HVhTh",
      "diff_hunk": "@@ -1125,34 +1126,40 @@ bool PeerManagerImpl::IsBlockRequested(const uint256& hash)\n \n void PeerManagerImpl::RemoveBlockRequest(const uint256& hash, std::optional<NodeId> from_peer)\n {\n-    auto it = mapBlocksInFlight.find(hash);\n-    if (it == mapBlocksInFlight.end()) {\n-        // Block was not requested\n+    auto range = mapBlocksInFlight.equal_range(hash);\n+    if (range.first == range.second) {\n+        // Block was not requested by any peer",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 19,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "ffc0aa03903a57fdcf66111e7874f17f390414eb",
      "in_reply_to_id": 1196575479,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "done",
      "created_at": "2023-05-17T17:04:59Z",
      "updated_at": "2023-05-17T17:04:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1196823777",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196823777"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1131,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196823829",
      "pull_request_review_id": 1431183061,
      "id": 1196823829,
      "node_id": "PRRC_kwDOABII585HVhUV",
      "diff_hunk": "@@ -1514,6 +1522,15 @@ void PeerManagerImpl::FinalizeNode(const CNode& node)\n         nSyncStarted--;\n \n     for (const QueuedBlock& entry : state->vBlocksInFlight) {\n+        auto range = mapBlocksInFlight.equal_range(entry.pindex->GetBlockHash());\n+        while (range.first != range.second) {\n+            auto [node_id, list_it] = range.first->second;\n+            if (node_id != nodeid) {\n+                range.first++;\n+            } else {\n+                range.first = mapBlocksInFlight.erase(range.first);\n+            }\n+        }\n         mapBlocksInFlight.erase(entry.pindex->GetBlockHash());",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 121,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "ffc0aa03903a57fdcf66111e7874f17f390414eb",
      "in_reply_to_id": 1196640876,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "done",
      "created_at": "2023-05-17T17:05:02Z",
      "updated_at": "2023-05-17T17:05:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1196823829",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196823829"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1534,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196823878",
      "pull_request_review_id": 1431183147,
      "id": 1196823878,
      "node_id": "PRRC_kwDOABII585HVhVG",
      "diff_hunk": "@@ -4320,7 +4320,7 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n \n         // If we're not close to tip yet, give up and let parallel block fetch work its magic\n-        if (!fAlreadyInFlight && !CanDirectFetch()) {\n+        if (!in_flight_same_peer && !CanDirectFetch()) {",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "999a123082a21aae5c2cecfa7b7e4b9ee67e66ae",
      "in_reply_to_id": 1196669983,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "hmm yeah, this is old code, doesn't make sense to me either. removed the change.",
      "created_at": "2023-05-17T17:05:05Z",
      "updated_at": "2023-05-17T17:05:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1196823878",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196823878"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4323,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196823938",
      "pull_request_review_id": 1431183239,
      "id": 1196823938,
      "node_id": "PRRC_kwDOABII585HVhWC",
      "diff_hunk": "@@ -1132,8 +1147,8 @@ void PeerManagerImpl::RemoveBlockRequest(const uint256& hash, std::optional<Node\n         return;\n     }\n \n-    // Currently we don't request more than one peer for same block\n-    Assume(mapBlocksInFlight.count(hash) == 1);\n+    // We should never requested too many of this block",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 35,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "e54f2d3680ad79ce8652fcdc37bf8331b9e892b5",
      "in_reply_to_id": 1196679410,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "done",
      "created_at": "2023-05-17T17:05:09Z",
      "updated_at": "2023-05-17T17:05:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1196823938",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196823938"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1150,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196823999",
      "pull_request_review_id": 1431183360,
      "id": 1196823999,
      "node_id": "PRRC_kwDOABII585HVhW_",
      "diff_hunk": "@@ -1179,8 +1194,8 @@ bool PeerManagerImpl::BlockRequested(NodeId nodeid, const CBlockIndex& block, st\n         }\n     }\n \n-    // Make sure it's not listed somewhere already.\n-    RemoveBlockRequest(hash, std::nullopt);\n+    // Make sure it's not being fetched already from same peer.\n+    RemoveBlockRequest(hash, nodeid);",
      "path": "src/net_processing.cpp",
      "position": 131,
      "original_position": 47,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "e54f2d3680ad79ce8652fcdc37bf8331b9e892b5",
      "in_reply_to_id": 1196683873,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "done",
      "created_at": "2023-05-17T17:05:13Z",
      "updated_at": "2023-05-17T17:05:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1196823999",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196823999"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1195,
      "original_line": 1195,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196824091",
      "pull_request_review_id": 1431183498,
      "id": 1196824091,
      "node_id": "PRRC_kwDOABII585HVhYb",
      "diff_hunk": "@@ -4460,33 +4496,43 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         {\n             LOCK(cs_main);\n \n-            bool expected_blocktxn = false;\n             auto range_flight = mapBlocksInFlight.equal_range(resp.blockhash);\n+            size_t already_in_flight = std::distance(range_flight.first, range_flight.second);\n+            bool requested_block_from_this_peer{false};\n+\n             while (range_flight.first != range_flight.second) {\n                 auto [node_id, block_it] = range_flight.first->second;\n                 if (node_id == pfrom.GetId() && block_it->partialBlock) {\n-                    expected_blocktxn = true;\n+                    requested_block_from_this_peer = true;\n                     break;\n                 }\n                 range_flight.first++;\n             }\n \n-            if (!expected_blocktxn) {\n+            if (!requested_block_from_this_peer) {\n                 LogPrint(BCLog::NET, \"Peer %d sent us block transactions for block we weren't expecting\\n\", pfrom.GetId());\n                 return;\n             }\n \n+            bool first_in_flight = already_in_flight == 0 || (already_in_flight == 1 && requested_block_from_this_peer);\n+\n             PartiallyDownloadedBlock& partialBlock = *range_flight.first->second.second->partialBlock;\n             ReadStatus status = partialBlock.FillBlock(*pblock, resp.txn);\n             if (status == READ_STATUS_INVALID) {\n                 RemoveBlockRequest(resp.blockhash, pfrom.GetId()); // Reset in-flight state in case Misbehaving does not result in a disconnect\n                 Misbehaving(*peer, 100, \"invalid compact block/non-matching block transactions\");\n                 return;\n             } else if (status == READ_STATUS_FAILED) {\n-                // Might have collided, fall back to getdata now :(\n-                std::vector<CInv> invs;\n-                invs.push_back(CInv(MSG_BLOCK | GetFetchFlags(*peer), resp.blockhash));\n-                m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETDATA, invs));\n+                if (first_in_flight) {\n+                    // Might have collided, fall back to getdata now :(\n+                    std::vector<CInv> invs;\n+                    invs.push_back(CInv(MSG_BLOCK | GetFetchFlags(*peer), resp.blockhash));\n+                    m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETDATA, invs));\n+                } else {\n+                    RemoveBlockRequest(resp.blockhash, pfrom.GetId()); // Reset in-flight state in case of whitelist",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 197,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "e54f2d3680ad79ce8652fcdc37bf8331b9e892b5",
      "in_reply_to_id": 1196715533,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "removed nonsense copy/paste",
      "created_at": "2023-05-17T17:05:18Z",
      "updated_at": "2023-05-17T17:05:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1196824091",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196824091"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4532,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196858330",
      "pull_request_review_id": 1431235703,
      "id": 1196858330,
      "node_id": "PRRC_kwDOABII585HVpva",
      "diff_hunk": "@@ -4277,15 +4307,25 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             nodestate->m_last_block_announcement = GetTime();\n         }\n \n-        std::map<uint256, std::pair<NodeId, std::list<QueuedBlock>::iterator> >::iterator blockInFlightIt = mapBlocksInFlight.find(pindex->GetBlockHash());\n-        bool fAlreadyInFlight = blockInFlightIt != mapBlocksInFlight.end();\n-\n         if (pindex->nStatus & BLOCK_HAVE_DATA) // Nothing to do here\n             return;\n \n+        auto range_flight = mapBlocksInFlight.equal_range(pindex->GetBlockHash());\n+        size_t already_in_flight = std::distance(range_flight.first, range_flight.second);\n+        bool requested_block_from_this_peer{false};\n+\n+        while (range_flight.first != range_flight.second) {\n+            if (range_flight.first->second.first == pfrom.GetId()) {\n+                requested_block_from_this_peer = true;\n+                break;\n+            }\n+            range_flight.first++;\n+        }\n+        bool first_in_flight = already_in_flight == 0 || (already_in_flight == 1 && requested_block_from_this_peer);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 209,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "324af0fd5c64a91780c7beaf9c2023dcf4df90da",
      "in_reply_to_id": 1196732363,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> If in the situation where an outbound (non-hb) peer is the first to announce that we still always send the getblocktxn if compact blocks fail, then this new logic would not be making anything worse, which seems sufficient to me.\r\n\r\nExactly. Fixed, I think!",
      "created_at": "2023-05-17T17:35:57Z",
      "updated_at": "2023-05-17T17:35:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1196858330",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196858330"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4325,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196858467",
      "pull_request_review_id": 1431235897,
      "id": 1196858467,
      "node_id": "PRRC_kwDOABII585HVpxj",
      "diff_hunk": "@@ -4460,33 +4496,43 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         {\n             LOCK(cs_main);\n \n-            bool expected_blocktxn = false;\n             auto range_flight = mapBlocksInFlight.equal_range(resp.blockhash);\n+            size_t already_in_flight = std::distance(range_flight.first, range_flight.second);\n+            bool requested_block_from_this_peer{false};\n+\n             while (range_flight.first != range_flight.second) {\n                 auto [node_id, block_it] = range_flight.first->second;\n                 if (node_id == pfrom.GetId() && block_it->partialBlock) {\n-                    expected_blocktxn = true;\n+                    requested_block_from_this_peer = true;\n                     break;\n                 }\n                 range_flight.first++;\n             }\n \n-            if (!expected_blocktxn) {\n+            if (!requested_block_from_this_peer) {\n                 LogPrint(BCLog::NET, \"Peer %d sent us block transactions for block we weren't expecting\\n\", pfrom.GetId());\n                 return;\n             }\n \n+            bool first_in_flight = already_in_flight == 0 || (already_in_flight == 1 && requested_block_from_this_peer);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 178,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "e54f2d3680ad79ce8652fcdc37bf8331b9e892b5",
      "in_reply_to_id": 1196713707,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Looks like some lost in translation logic from prior PRs. Indeed, we can just peek at the first entry, if it exists. Fixed, I think.",
      "created_at": "2023-05-17T17:36:05Z",
      "updated_at": "2023-05-17T17:36:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1196858467",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196858467"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4518,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198247881",
      "pull_request_review_id": 1433364121,
      "id": 1198247881,
      "node_id": "PRRC_kwDOABII585Ha8_J",
      "diff_hunk": "@@ -823,12 +827,100 @@ def assert_highbandwidth_states(node, hb_to, hb_from):\n         hb_test_node.send_and_ping(msg_sendcmpct(announce=False, version=2))\n         assert_highbandwidth_states(self.nodes[0], hb_to=True, hb_from=False)\n \n+    def test_compactblock_reconstruction_parallel_reconstruction(self, stalling_peer, delivery_peer, inbound_peer, outbound_peer):\n+        \"\"\" All p2p connections are inbound except outbound_peer. We test that ultimate parallel slot\n+            can only be taken by an outbound node unless prior attempts were done by an outbound\n+        \"\"\"\n+        node = self.nodes[0]\n+        assert len(self.utxos)\n+\n+        def announce_cmpct_block(node, peer, txn_count):\n+            utxo = self.utxos.pop(0)\n+            block = self.build_block_with_transactions(node, utxo, txn_count)\n+\n+            cmpct_block = HeaderAndShortIDs()\n+            cmpct_block.initialize_from_block(block)\n+            msg = msg_cmpctblock(cmpct_block.to_p2p())\n+            peer.send_and_ping(msg)\n+            with p2p_lock:\n+                assert \"getblocktxn\" in peer.last_message\n+            return block, cmpct_block\n+\n+        # First, make delivery_peer, inbound_peer, and outbound_peer high bandwidth\n+        block, cmpct_block = announce_cmpct_block(node, delivery_peer, 1)",
      "path": "test/functional/p2p_compactblocks.py",
      "position": null,
      "original_position": 44,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "in_reply_to_id": null,
      "user": {
        "login": "brunoerg",
        "id": 19480819,
        "node_id": "MDQ6VXNlcjE5NDgwODE5",
        "avatar_url": "https://avatars.githubusercontent.com/u/19480819?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/brunoerg",
        "html_url": "https://github.com/brunoerg",
        "followers_url": "https://api.github.com/users/brunoerg/followers",
        "following_url": "https://api.github.com/users/brunoerg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/brunoerg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/brunoerg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/brunoerg/subscriptions",
        "organizations_url": "https://api.github.com/users/brunoerg/orgs",
        "repos_url": "https://api.github.com/users/brunoerg/repos",
        "events_url": "https://api.github.com/users/brunoerg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/brunoerg/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Suggestion to simplify it, in case you touch it again:\r\n```diff\r\nindex 50cce9318..cd9268f6b 100755\r\n--- a/test/functional/p2p_compactblocks.py\r\n+++ b/test/functional/p2p_compactblocks.py\r\n@@ -847,29 +847,14 @@ class CompactBlocksTest(BitcoinTestFramework):\r\n             return block, cmpct_block\r\n \r\n         # First, make delivery_peer, inbound_peer, and outbound_peer high \r\nbandwidth\r\n-        block, cmpct_block = announce_cmpct_block(node, delivery_peer, 1)\r\n-        msg = msg_blocktxn()\r\n-        msg.block_transactions.blockhash = block.sha256\r\n-        msg.block_transactions.transactions = block.vtx[1:]\r\n-        delivery_peer.send_and_ping(msg)\r\n-        assert_equal(int(node.getbestblockhash(), 16), block.sha256)\r\n-        delivery_peer.clear_getblocktxn()\r\n-\r\n-        block, cmpct_block = announce_cmpct_block(node, inbound_peer, 1)\r\n-        msg = msg_blocktxn()\r\n-        msg.block_transactions.blockhash = block.sha256\r\n-        msg.block_transactions.transactions = block.vtx[1:]\r\n-        inbound_peer.send_and_ping(msg)\r\n-        assert_equal(int(node.getbestblockhash(), 16), block.sha256)\r\n-        inbound_peer.clear_getblocktxn()\r\n-\r\n-        block, cmpct_block = announce_cmpct_block(node, outbound_peer, 1)\r\n-        msg = msg_blocktxn()\r\n-        msg.block_transactions.blockhash = block.sha256\r\n-        msg.block_transactions.transactions = block.vtx[1:]\r\n-        outbound_peer.send_and_ping(msg)\r\n-        assert_equal(int(node.getbestblockhash(), 16), block.sha256)\r\n-        outbound_peer.clear_getblocktxn()\r\n+        for peer in [delivery_peer, inbound_peer, outbound_peer]:\r\n+            block, _ = announce_cmpct_block(node, peer, 1)\r\n+            msg = msg_blocktxn()\r\n+            msg.block_transactions.blockhash = block.sha256\r\n+            msg.block_transactions.transactions = block.vtx[1:]\r\n+            peer.send_and_ping(msg)\r\n+            assert_equal(int(node.getbestblockhash(), 16), block.sha256)\r\n+            peer.clear_getblocktxn()\r\n \r\n         # Test the simple parallel download case...\r\n         for num_missing in [1, 5, 20]:\r\n```",
      "created_at": "2023-05-18T19:55:58Z",
      "updated_at": "2023-05-18T19:55:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1198247881",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198247881"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 850,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198642367",
      "pull_request_review_id": 1433928913,
      "id": 1198642367,
      "node_id": "PRRC_kwDOABII585HcdS_",
      "diff_hunk": "@@ -4338,9 +4386,24 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     txn.blockhash = blockhash;\n                     blockTxnMsg << txn;\n                     fProcessBLOCKTXN = true;\n-                } else {\n+                } else if (first_in_flight) {\n+                    // We will try to round-trip any compact blocks we get on failure,\n+                    // as long as it's first...\n                     req.blockhash = pindex->GetBlockHash();\n                     m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETBLOCKTXN, req));\n+                } else if (pfrom.m_bip152_highbandwidth_to &&\n+                    (!nodestate->m_is_inbound ||",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 275,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "in_reply_to_id": null,
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```suggestion\r\n                    (pfrom.IsOutboundOrBlockRelayConn() ||\r\n```\r\nI would avoid using CNodeState when possible.",
      "created_at": "2023-05-19T07:33:57Z",
      "updated_at": "2023-05-19T08:01:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1198642367",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198642367"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4395,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198645480",
      "pull_request_review_id": 1433928913,
      "id": 1198645480,
      "node_id": "PRRC_kwDOABII585HceDo",
      "diff_hunk": "@@ -1117,40 +1121,57 @@ std::chrono::microseconds PeerManagerImpl::NextInvToInbounds(std::chrono::micros\n \n bool PeerManagerImpl::IsBlockRequested(const uint256& hash)\n {\n-    return mapBlocksInFlight.find(hash) != mapBlocksInFlight.end();\n+    return mapBlocksInFlight.count(hash);\n }\n \n-void PeerManagerImpl::RemoveBlockRequest(const uint256& hash, std::optional<NodeId> from_peer)\n+bool PeerManagerImpl::IsBlockRequestedFromOutbound(const uint256& hash)\n {\n-    auto it = mapBlocksInFlight.find(hash);\n-    if (it == mapBlocksInFlight.end()) {\n-        // Block was not requested\n-        return;\n+    for (auto range = mapBlocksInFlight.equal_range(hash); range.first != range.second; range.first++) {\n+        auto [nodeid, block_it] = range.first->second;\n+        CNodeState *nodestate = State(nodeid);\n+        assert(nodestate);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 47,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "in_reply_to_id": null,
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```suggestion\r\n        CNodeState& nodestate = *Assert(State(nodeid));\r\n```",
      "created_at": "2023-05-19T07:37:26Z",
      "updated_at": "2023-05-19T08:01:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1198645480",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198645480"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": 1131,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1132,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198646710",
      "pull_request_review_id": 1433928913,
      "id": 1198646710,
      "node_id": "PRRC_kwDOABII585HceW2",
      "diff_hunk": "@@ -1117,40 +1121,57 @@ std::chrono::microseconds PeerManagerImpl::NextInvToInbounds(std::chrono::micros\n \n bool PeerManagerImpl::IsBlockRequested(const uint256& hash)\n {\n-    return mapBlocksInFlight.find(hash) != mapBlocksInFlight.end();\n+    return mapBlocksInFlight.count(hash);\n }\n \n-void PeerManagerImpl::RemoveBlockRequest(const uint256& hash, std::optional<NodeId> from_peer)\n+bool PeerManagerImpl::IsBlockRequestedFromOutbound(const uint256& hash)\n {\n-    auto it = mapBlocksInFlight.find(hash);\n-    if (it == mapBlocksInFlight.end()) {\n-        // Block was not requested\n-        return;\n+    for (auto range = mapBlocksInFlight.equal_range(hash); range.first != range.second; range.first++) {\n+        auto [nodeid, block_it] = range.first->second;\n+        CNodeState *nodestate = State(nodeid);\n+        assert(nodestate);\n+        if (!nodestate->m_is_inbound) return true;\n     }\n \n-    auto [node_id, list_it] = it->second;\n+    return false;\n+}\n \n-    if (from_peer && node_id != *from_peer) {\n-        // Block was requested by another peer\n+void PeerManagerImpl::RemoveBlockRequest(const uint256& hash, std::optional<NodeId> from_peer)\n+{\n+    auto range = mapBlocksInFlight.equal_range(hash);\n+    if (range.first == range.second) {\n+        // Block was not requested from any peer\n         return;\n     }\n \n-    CNodeState *state = State(node_id);\n-    assert(state != nullptr);\n+    // We should not have requested too many of this block\n+    Assume(mapBlocksInFlight.count(hash) <= MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK);\n \n-    if (state->vBlocksInFlight.begin() == list_it) {\n-        // First block on the queue was received, update the start download time for the next one\n-        state->m_downloading_since = std::max(state->m_downloading_since, GetTime<std::chrono::microseconds>());\n-    }\n-    state->vBlocksInFlight.erase(list_it);\n+    while (range.first != range.second) {\n+        auto [node_id, list_it] = range.first->second;\n+\n+        if (from_peer && *from_peer != node_id) {\n+            range.first++;\n+            continue;\n+        }\n \n-    state->nBlocksInFlight--;\n-    if (state->nBlocksInFlight == 0) {\n-        // Last validated block on the queue was received.\n-        m_peers_downloading_from--;\n+        CNodeState *state = State(node_id);\n+        assert(state != nullptr);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 88,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "in_reply_to_id": null,
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```suggestion\r\n        CNodeState& state = *Assert(State(node_id));\r\n```",
      "created_at": "2023-05-19T07:38:52Z",
      "updated_at": "2023-05-19T08:01:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1198646710",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198646710"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": 1158,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1159,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198846834",
      "pull_request_review_id": 1434245421,
      "id": 1198846834,
      "node_id": "PRRC_kwDOABII585HdPNy",
      "diff_hunk": "@@ -823,12 +827,100 @@ def assert_highbandwidth_states(node, hb_to, hb_from):\n         hb_test_node.send_and_ping(msg_sendcmpct(announce=False, version=2))\n         assert_highbandwidth_states(self.nodes[0], hb_to=True, hb_from=False)\n \n+    def test_compactblock_reconstruction_parallel_reconstruction(self, stalling_peer, delivery_peer, inbound_peer, outbound_peer):\n+        \"\"\" All p2p connections are inbound except outbound_peer. We test that ultimate parallel slot\n+            can only be taken by an outbound node unless prior attempts were done by an outbound\n+        \"\"\"\n+        node = self.nodes[0]\n+        assert len(self.utxos)\n+\n+        def announce_cmpct_block(node, peer, txn_count):\n+            utxo = self.utxos.pop(0)\n+            block = self.build_block_with_transactions(node, utxo, txn_count)\n+\n+            cmpct_block = HeaderAndShortIDs()\n+            cmpct_block.initialize_from_block(block)\n+            msg = msg_cmpctblock(cmpct_block.to_p2p())\n+            peer.send_and_ping(msg)\n+            with p2p_lock:\n+                assert \"getblocktxn\" in peer.last_message\n+            return block, cmpct_block\n+\n+        # First, make delivery_peer, inbound_peer, and outbound_peer high bandwidth\n+        block, cmpct_block = announce_cmpct_block(node, delivery_peer, 1)",
      "path": "test/functional/p2p_compactblocks.py",
      "position": null,
      "original_position": 44,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "in_reply_to_id": 1198247881,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "(If this nit is taken, it would also be good to add a log statement, so that if the loop is failing, one can derive easily in which iteration it failed. Generally I think any, or almost any comment in a functional test case can be a (debug)log statement to aid debugging in case of failure)",
      "created_at": "2023-05-19T11:15:16Z",
      "updated_at": "2023-05-19T11:15:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1198846834",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198846834"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 850,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199687717",
      "pull_request_review_id": 1435466960,
      "id": 1199687717,
      "node_id": "PRRC_kwDOABII585Hgcgl",
      "diff_hunk": "@@ -4338,9 +4386,24 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     txn.blockhash = blockhash;\n                     blockTxnMsg << txn;\n                     fProcessBLOCKTXN = true;\n-                } else {\n+                } else if (first_in_flight) {\n+                    // We will try to round-trip any compact blocks we get on failure,\n+                    // as long as it's first...\n                     req.blockhash = pindex->GetBlockHash();\n                     m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETBLOCKTXN, req));\n+                } else if (pfrom.m_bip152_highbandwidth_to &&\n+                    (!nodestate->m_is_inbound ||",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 275,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "in_reply_to_id": 1198642367,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Should be `!pfrom.IsInboundConn()` presumably, to include manual connections at least.",
      "created_at": "2023-05-21T03:05:17Z",
      "updated_at": "2023-05-21T03:05:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1199687717",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199687717"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4395,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199689963",
      "pull_request_review_id": 1435468460,
      "id": 1199689963,
      "node_id": "PRRC_kwDOABII585HgdDr",
      "diff_hunk": "@@ -823,12 +827,100 @@ def assert_highbandwidth_states(node, hb_to, hb_from):\n         hb_test_node.send_and_ping(msg_sendcmpct(announce=False, version=2))\n         assert_highbandwidth_states(self.nodes[0], hb_to=True, hb_from=False)\n \n+    def test_compactblock_reconstruction_parallel_reconstruction(self, stalling_peer, delivery_peer, inbound_peer, outbound_peer):\n+        \"\"\" All p2p connections are inbound except outbound_peer. We test that ultimate parallel slot\n+            can only be taken by an outbound node unless prior attempts were done by an outbound\n+        \"\"\"\n+        node = self.nodes[0]\n+        assert len(self.utxos)\n+\n+        def announce_cmpct_block(node, peer, txn_count):\n+            utxo = self.utxos.pop(0)\n+            block = self.build_block_with_transactions(node, utxo, txn_count)\n+\n+            cmpct_block = HeaderAndShortIDs()\n+            cmpct_block.initialize_from_block(block)\n+            msg = msg_cmpctblock(cmpct_block.to_p2p())\n+            peer.send_and_ping(msg)\n+            with p2p_lock:\n+                assert \"getblocktxn\" in peer.last_message\n+            return block, cmpct_block\n+\n+        # First, make delivery_peer, inbound_peer, and outbound_peer high bandwidth\n+        block, cmpct_block = announce_cmpct_block(node, delivery_peer, 1)\n+        msg = msg_blocktxn()\n+        msg.block_transactions.blockhash = block.sha256\n+        msg.block_transactions.transactions = block.vtx[1:]\n+        delivery_peer.send_and_ping(msg)\n+        assert_equal(int(node.getbestblockhash(), 16), block.sha256)\n+        delivery_peer.clear_getblocktxn()\n+\n+        block, cmpct_block = announce_cmpct_block(node, inbound_peer, 1)\n+        msg = msg_blocktxn()\n+        msg.block_transactions.blockhash = block.sha256\n+        msg.block_transactions.transactions = block.vtx[1:]\n+        inbound_peer.send_and_ping(msg)\n+        assert_equal(int(node.getbestblockhash(), 16), block.sha256)\n+        inbound_peer.clear_getblocktxn()\n+\n+        block, cmpct_block = announce_cmpct_block(node, outbound_peer, 1)\n+        msg = msg_blocktxn()\n+        msg.block_transactions.blockhash = block.sha256\n+        msg.block_transactions.transactions = block.vtx[1:]\n+        outbound_peer.send_and_ping(msg)\n+        assert_equal(int(node.getbestblockhash(), 16), block.sha256)\n+        outbound_peer.clear_getblocktxn()\n+\n+        # Test the simple parallel download case...\n+        for num_missing in [1, 5, 20]:\n+\n+            # Remaining low-bandwidth peer is stalling_peer, who announces first\n+            [peer['bip152_hb_to'] for peer in node.getpeerinfo()] == [False, True, True, True]",
      "path": "test/functional/p2p_compactblocks.py",
      "position": null,
      "original_position": 72,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "missing `assert` here",
      "created_at": "2023-05-21T03:36:01Z",
      "updated_at": "2023-05-21T21:21:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1199689963",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199689963"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 878,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199822582",
      "pull_request_review_id": 1435468460,
      "id": 1199822582,
      "node_id": "PRRC_kwDOABII585Hg9b2",
      "diff_hunk": "@@ -4456,18 +4496,23 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         {\n             LOCK(cs_main);\n \n-            bool expected_blocktxn = false;\n             auto range_flight = mapBlocksInFlight.equal_range(resp.blockhash);\n+            size_t already_in_flight = std::distance(range_flight.first, range_flight.second);",
      "path": "src/net_processing.cpp",
      "position": 321,
      "original_position": 170,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "620b3f54830579ef48a2374e5b0bc4b2fba9dcc4",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: `already_in_flight` could be just a bool here",
      "created_at": "2023-05-21T20:23:30Z",
      "updated_at": "2023-05-21T21:21:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1199822582",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199822582"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4497,
      "original_line": 4497,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200117089",
      "pull_request_review_id": 1436019702,
      "id": 1200117089,
      "node_id": "PRRC_kwDOABII585HiFVh",
      "diff_hunk": "@@ -4338,9 +4386,24 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     txn.blockhash = blockhash;\n                     blockTxnMsg << txn;\n                     fProcessBLOCKTXN = true;\n-                } else {\n+                } else if (first_in_flight) {\n+                    // We will try to round-trip any compact blocks we get on failure,\n+                    // as long as it's first...\n                     req.blockhash = pindex->GetBlockHash();\n                     m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETBLOCKTXN, req));\n+                } else if (pfrom.m_bip152_highbandwidth_to &&\n+                    (!nodestate->m_is_inbound ||\n+                    IsBlockRequestedFromOutbound(blockhash) ||\n+                    already_in_flight < MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK - 1)) {\n+                    // ... or it's a hb relay peer and:\n+                    // - peer is outbound, or\n+                    // - we already have an outbound attempt in flight(so we'll take what we can get), or\n+                    // - it's not the final parallel download slot (which we may reserve for first outbound)",
      "path": "src/net_processing.cpp",
      "position": 295,
      "original_position": 281,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "in_reply_to_id": null,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't understand this logic -- why is having an outbound attempt in flight so terrible that we'll query all subsequent hb peers, even to the point of exceeding the parallel download limit? If outbound attempts are terrible, why do we also have an exception to immediately query hb outbound peers, also to the point of potentially exceeding the parallel download limit?\r\n\r\nI would have expected logic more like:\r\n * is this the first attempt?\r\n * otherwise, is this a hb peer, and `already_in_flight < MAX-1` ? \r\n * otherwise, is this an outbound peer, and `already_in_flight < MAX` ? (ie, reserving the last slot for an outbound peer, possibly additional to one-or-more existing outbound peers)\r\n\r\nOr alternatively:\r\n * is this the first attempt?\r\n * is this a hb inbound peer, and `already_in_flight < MAX` ?\r\n * is this an outbound peer, are there no other outbound peers in flight? (ie request from all the hb inbound peers, and one outbound peer hb or not, avoiding putting an increased load on outbound peers)",
      "created_at": "2023-05-22T08:04:53Z",
      "updated_at": "2023-05-22T09:10:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1200117089",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200117089"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4398,
      "original_line": 4398,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200353306",
      "pull_request_review_id": 1436374948,
      "id": 1200353306,
      "node_id": "PRRC_kwDOABII585Hi_Aa",
      "diff_hunk": "@@ -4338,9 +4386,24 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     txn.blockhash = blockhash;\n                     blockTxnMsg << txn;\n                     fProcessBLOCKTXN = true;\n-                } else {\n+                } else if (first_in_flight) {\n+                    // We will try to round-trip any compact blocks we get on failure,\n+                    // as long as it's first...\n                     req.blockhash = pindex->GetBlockHash();\n                     m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETBLOCKTXN, req));\n+                } else if (pfrom.m_bip152_highbandwidth_to &&\n+                    (!nodestate->m_is_inbound ||\n+                    IsBlockRequestedFromOutbound(blockhash) ||\n+                    already_in_flight < MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK - 1)) {\n+                    // ... or it's a hb relay peer and:\n+                    // - peer is outbound, or\n+                    // - we already have an outbound attempt in flight(so we'll take what we can get), or\n+                    // - it's not the final parallel download slot (which we may reserve for first outbound)",
      "path": "src/net_processing.cpp",
      "position": 295,
      "original_position": 281,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "in_reply_to_id": 1200117089,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "https://github.com/bitcoin/bitcoin/pull/27626/files#diff-6875de769e90cec84d2e8a9c1b962cdbcda44d870d42e4215827e599e11e90e3R4346 <--- this line will filter out any attempts beyond 3.\r\n\r\nSo implicitly each of these conditions in this block hold with `already_in_flight < MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK`\r\n\r\nI could touch up my comments, add some `Assume`s to make things clearer, if indeed the code is doing what I think it is.",
      "created_at": "2023-05-22T11:01:44Z",
      "updated_at": "2023-05-22T11:01:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1200353306",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200353306"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4398,
      "original_line": 4398,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200362883",
      "pull_request_review_id": 1436387814,
      "id": 1200362883,
      "node_id": "PRRC_kwDOABII585HjBWD",
      "diff_hunk": "@@ -4338,9 +4386,24 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     txn.blockhash = blockhash;\n                     blockTxnMsg << txn;\n                     fProcessBLOCKTXN = true;\n-                } else {\n+                } else if (first_in_flight) {\n+                    // We will try to round-trip any compact blocks we get on failure,\n+                    // as long as it's first...\n                     req.blockhash = pindex->GetBlockHash();\n                     m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETBLOCKTXN, req));\n+                } else if (pfrom.m_bip152_highbandwidth_to &&\n+                    (!nodestate->m_is_inbound ||\n+                    IsBlockRequestedFromOutbound(blockhash) ||\n+                    already_in_flight < MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK - 1)) {\n+                    // ... or it's a hb relay peer and:\n+                    // - peer is outbound, or\n+                    // - we already have an outbound attempt in flight(so we'll take what we can get), or\n+                    // - it's not the final parallel download slot (which we may reserve for first outbound)",
      "path": "src/net_processing.cpp",
      "position": 295,
      "original_position": 281,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "in_reply_to_id": 1200117089,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Well I was right in saying \"I don't understand this logic\" -- it's just about reserving the \"final\" slot for the outbound peer.",
      "created_at": "2023-05-22T11:09:16Z",
      "updated_at": "2023-05-22T11:09:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1200362883",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200362883"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4398,
      "original_line": 4398,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200426349",
      "pull_request_review_id": 1436489956,
      "id": 1200426349,
      "node_id": "PRRC_kwDOABII585HjQ1t",
      "diff_hunk": "@@ -4338,9 +4386,24 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     txn.blockhash = blockhash;\n                     blockTxnMsg << txn;\n                     fProcessBLOCKTXN = true;\n-                } else {\n+                } else if (first_in_flight) {\n+                    // We will try to round-trip any compact blocks we get on failure,\n+                    // as long as it's first...\n                     req.blockhash = pindex->GetBlockHash();\n                     m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETBLOCKTXN, req));\n+                } else if (pfrom.m_bip152_highbandwidth_to &&\n+                    (!nodestate->m_is_inbound ||\n+                    IsBlockRequestedFromOutbound(blockhash) ||\n+                    already_in_flight < MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK - 1)) {\n+                    // ... or it's a hb relay peer and:\n+                    // - peer is outbound, or\n+                    // - we already have an outbound attempt in flight(so we'll take what we can get), or\n+                    // - it's not the final parallel download slot (which we may reserve for first outbound)",
      "path": "src/net_processing.cpp",
      "position": 295,
      "original_position": 281,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "in_reply_to_id": 1200117089,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I guess I think it might be better to not do multiple parallel requests to outbound peers (on the one hand hopefully your outbounds are trustworthy and will respond quickly; on the other hand it's undesirable if listening nodes end up having to send up to 3x as much data when non-listening nodes request blocktxns from all their hb peers), but otherwise this makes sense.",
      "created_at": "2023-05-22T12:08:42Z",
      "updated_at": "2023-05-22T12:08:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1200426349",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200426349"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4398,
      "original_line": 4398,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200499146",
      "pull_request_review_id": 1436604617,
      "id": 1200499146,
      "node_id": "PRRC_kwDOABII585HjinK",
      "diff_hunk": "@@ -823,12 +827,100 @@ def assert_highbandwidth_states(node, hb_to, hb_from):\n         hb_test_node.send_and_ping(msg_sendcmpct(announce=False, version=2))\n         assert_highbandwidth_states(self.nodes[0], hb_to=True, hb_from=False)\n \n+    def test_compactblock_reconstruction_parallel_reconstruction(self, stalling_peer, delivery_peer, inbound_peer, outbound_peer):\n+        \"\"\" All p2p connections are inbound except outbound_peer. We test that ultimate parallel slot\n+            can only be taken by an outbound node unless prior attempts were done by an outbound\n+        \"\"\"\n+        node = self.nodes[0]\n+        assert len(self.utxos)\n+\n+        def announce_cmpct_block(node, peer, txn_count):\n+            utxo = self.utxos.pop(0)\n+            block = self.build_block_with_transactions(node, utxo, txn_count)\n+\n+            cmpct_block = HeaderAndShortIDs()\n+            cmpct_block.initialize_from_block(block)\n+            msg = msg_cmpctblock(cmpct_block.to_p2p())\n+            peer.send_and_ping(msg)\n+            with p2p_lock:\n+                assert \"getblocktxn\" in peer.last_message\n+            return block, cmpct_block\n+\n+        # First, make delivery_peer, inbound_peer, and outbound_peer high bandwidth\n+        block, cmpct_block = announce_cmpct_block(node, delivery_peer, 1)",
      "path": "test/functional/p2p_compactblocks.py",
      "position": null,
      "original_position": 44,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "in_reply_to_id": 1198247881,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "done",
      "created_at": "2023-05-22T13:11:40Z",
      "updated_at": "2023-05-22T13:11:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1200499146",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200499146"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 850,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200499309",
      "pull_request_review_id": 1436604864,
      "id": 1200499309,
      "node_id": "PRRC_kwDOABII585Hjipt",
      "diff_hunk": "@@ -4338,9 +4386,24 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     txn.blockhash = blockhash;\n                     blockTxnMsg << txn;\n                     fProcessBLOCKTXN = true;\n-                } else {\n+                } else if (first_in_flight) {\n+                    // We will try to round-trip any compact blocks we get on failure,\n+                    // as long as it's first...\n                     req.blockhash = pindex->GetBlockHash();\n                     m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETBLOCKTXN, req));\n+                } else if (pfrom.m_bip152_highbandwidth_to &&\n+                    (!nodestate->m_is_inbound ||",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 275,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "in_reply_to_id": 1198642367,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "took @ajtowns suggestion",
      "created_at": "2023-05-22T13:11:48Z",
      "updated_at": "2023-05-22T13:11:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1200499309",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200499309"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4395,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200499376",
      "pull_request_review_id": 1436604974,
      "id": 1200499376,
      "node_id": "PRRC_kwDOABII585Hjiqw",
      "diff_hunk": "@@ -1117,40 +1121,57 @@ std::chrono::microseconds PeerManagerImpl::NextInvToInbounds(std::chrono::micros\n \n bool PeerManagerImpl::IsBlockRequested(const uint256& hash)\n {\n-    return mapBlocksInFlight.find(hash) != mapBlocksInFlight.end();\n+    return mapBlocksInFlight.count(hash);\n }\n \n-void PeerManagerImpl::RemoveBlockRequest(const uint256& hash, std::optional<NodeId> from_peer)\n+bool PeerManagerImpl::IsBlockRequestedFromOutbound(const uint256& hash)\n {\n-    auto it = mapBlocksInFlight.find(hash);\n-    if (it == mapBlocksInFlight.end()) {\n-        // Block was not requested\n-        return;\n+    for (auto range = mapBlocksInFlight.equal_range(hash); range.first != range.second; range.first++) {\n+        auto [nodeid, block_it] = range.first->second;\n+        CNodeState *nodestate = State(nodeid);\n+        assert(nodestate);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 47,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "in_reply_to_id": 1198645480,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "done",
      "created_at": "2023-05-22T13:11:52Z",
      "updated_at": "2023-05-22T13:11:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1200499376",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200499376"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": 1131,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1132,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200499431",
      "pull_request_review_id": 1436605069,
      "id": 1200499431,
      "node_id": "PRRC_kwDOABII585Hjirn",
      "diff_hunk": "@@ -1117,40 +1121,57 @@ std::chrono::microseconds PeerManagerImpl::NextInvToInbounds(std::chrono::micros\n \n bool PeerManagerImpl::IsBlockRequested(const uint256& hash)\n {\n-    return mapBlocksInFlight.find(hash) != mapBlocksInFlight.end();\n+    return mapBlocksInFlight.count(hash);\n }\n \n-void PeerManagerImpl::RemoveBlockRequest(const uint256& hash, std::optional<NodeId> from_peer)\n+bool PeerManagerImpl::IsBlockRequestedFromOutbound(const uint256& hash)\n {\n-    auto it = mapBlocksInFlight.find(hash);\n-    if (it == mapBlocksInFlight.end()) {\n-        // Block was not requested\n-        return;\n+    for (auto range = mapBlocksInFlight.equal_range(hash); range.first != range.second; range.first++) {\n+        auto [nodeid, block_it] = range.first->second;\n+        CNodeState *nodestate = State(nodeid);\n+        assert(nodestate);\n+        if (!nodestate->m_is_inbound) return true;\n     }\n \n-    auto [node_id, list_it] = it->second;\n+    return false;\n+}\n \n-    if (from_peer && node_id != *from_peer) {\n-        // Block was requested by another peer\n+void PeerManagerImpl::RemoveBlockRequest(const uint256& hash, std::optional<NodeId> from_peer)\n+{\n+    auto range = mapBlocksInFlight.equal_range(hash);\n+    if (range.first == range.second) {\n+        // Block was not requested from any peer\n         return;\n     }\n \n-    CNodeState *state = State(node_id);\n-    assert(state != nullptr);\n+    // We should not have requested too many of this block\n+    Assume(mapBlocksInFlight.count(hash) <= MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK);\n \n-    if (state->vBlocksInFlight.begin() == list_it) {\n-        // First block on the queue was received, update the start download time for the next one\n-        state->m_downloading_since = std::max(state->m_downloading_since, GetTime<std::chrono::microseconds>());\n-    }\n-    state->vBlocksInFlight.erase(list_it);\n+    while (range.first != range.second) {\n+        auto [node_id, list_it] = range.first->second;\n+\n+        if (from_peer && *from_peer != node_id) {\n+            range.first++;\n+            continue;\n+        }\n \n-    state->nBlocksInFlight--;\n-    if (state->nBlocksInFlight == 0) {\n-        // Last validated block on the queue was received.\n-        m_peers_downloading_from--;\n+        CNodeState *state = State(node_id);\n+        assert(state != nullptr);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 88,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "in_reply_to_id": 1198646710,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "done",
      "created_at": "2023-05-22T13:11:54Z",
      "updated_at": "2023-05-22T13:11:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1200499431",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200499431"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": 1158,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1159,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200499502",
      "pull_request_review_id": 1436605199,
      "id": 1200499502,
      "node_id": "PRRC_kwDOABII585Hjisu",
      "diff_hunk": "@@ -823,12 +827,100 @@ def assert_highbandwidth_states(node, hb_to, hb_from):\n         hb_test_node.send_and_ping(msg_sendcmpct(announce=False, version=2))\n         assert_highbandwidth_states(self.nodes[0], hb_to=True, hb_from=False)\n \n+    def test_compactblock_reconstruction_parallel_reconstruction(self, stalling_peer, delivery_peer, inbound_peer, outbound_peer):\n+        \"\"\" All p2p connections are inbound except outbound_peer. We test that ultimate parallel slot\n+            can only be taken by an outbound node unless prior attempts were done by an outbound\n+        \"\"\"\n+        node = self.nodes[0]\n+        assert len(self.utxos)\n+\n+        def announce_cmpct_block(node, peer, txn_count):\n+            utxo = self.utxos.pop(0)\n+            block = self.build_block_with_transactions(node, utxo, txn_count)\n+\n+            cmpct_block = HeaderAndShortIDs()\n+            cmpct_block.initialize_from_block(block)\n+            msg = msg_cmpctblock(cmpct_block.to_p2p())\n+            peer.send_and_ping(msg)\n+            with p2p_lock:\n+                assert \"getblocktxn\" in peer.last_message\n+            return block, cmpct_block\n+\n+        # First, make delivery_peer, inbound_peer, and outbound_peer high bandwidth\n+        block, cmpct_block = announce_cmpct_block(node, delivery_peer, 1)\n+        msg = msg_blocktxn()\n+        msg.block_transactions.blockhash = block.sha256\n+        msg.block_transactions.transactions = block.vtx[1:]\n+        delivery_peer.send_and_ping(msg)\n+        assert_equal(int(node.getbestblockhash(), 16), block.sha256)\n+        delivery_peer.clear_getblocktxn()\n+\n+        block, cmpct_block = announce_cmpct_block(node, inbound_peer, 1)\n+        msg = msg_blocktxn()\n+        msg.block_transactions.blockhash = block.sha256\n+        msg.block_transactions.transactions = block.vtx[1:]\n+        inbound_peer.send_and_ping(msg)\n+        assert_equal(int(node.getbestblockhash(), 16), block.sha256)\n+        inbound_peer.clear_getblocktxn()\n+\n+        block, cmpct_block = announce_cmpct_block(node, outbound_peer, 1)\n+        msg = msg_blocktxn()\n+        msg.block_transactions.blockhash = block.sha256\n+        msg.block_transactions.transactions = block.vtx[1:]\n+        outbound_peer.send_and_ping(msg)\n+        assert_equal(int(node.getbestblockhash(), 16), block.sha256)\n+        outbound_peer.clear_getblocktxn()\n+\n+        # Test the simple parallel download case...\n+        for num_missing in [1, 5, 20]:\n+\n+            # Remaining low-bandwidth peer is stalling_peer, who announces first\n+            [peer['bip152_hb_to'] for peer in node.getpeerinfo()] == [False, True, True, True]",
      "path": "test/functional/p2p_compactblocks.py",
      "position": null,
      "original_position": 72,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "in_reply_to_id": 1199689963,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "fixed",
      "created_at": "2023-05-22T13:11:58Z",
      "updated_at": "2023-05-22T13:11:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1200499502",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200499502"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 878,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200499579",
      "pull_request_review_id": 1436605315,
      "id": 1200499579,
      "node_id": "PRRC_kwDOABII585Hjit7",
      "diff_hunk": "@@ -4456,18 +4496,23 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         {\n             LOCK(cs_main);\n \n-            bool expected_blocktxn = false;\n             auto range_flight = mapBlocksInFlight.equal_range(resp.blockhash);\n+            size_t already_in_flight = std::distance(range_flight.first, range_flight.second);",
      "path": "src/net_processing.cpp",
      "position": 321,
      "original_position": 170,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "620b3f54830579ef48a2374e5b0bc4b2fba9dcc4",
      "in_reply_to_id": 1199822582,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "leaving as-is, reads more naturally to me",
      "created_at": "2023-05-22T13:12:01Z",
      "updated_at": "2023-05-22T13:12:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1200499579",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200499579"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4497,
      "original_line": 4497,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200500047",
      "pull_request_review_id": 1436606101,
      "id": 1200500047,
      "node_id": "PRRC_kwDOABII585Hji1P",
      "diff_hunk": "@@ -4338,9 +4386,24 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     txn.blockhash = blockhash;\n                     blockTxnMsg << txn;\n                     fProcessBLOCKTXN = true;\n-                } else {\n+                } else if (first_in_flight) {\n+                    // We will try to round-trip any compact blocks we get on failure,\n+                    // as long as it's first...\n                     req.blockhash = pindex->GetBlockHash();\n                     m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETBLOCKTXN, req));\n+                } else if (pfrom.m_bip152_highbandwidth_to &&\n+                    (!nodestate->m_is_inbound ||\n+                    IsBlockRequestedFromOutbound(blockhash) ||\n+                    already_in_flight < MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK - 1)) {\n+                    // ... or it's a hb relay peer and:\n+                    // - peer is outbound, or\n+                    // - we already have an outbound attempt in flight(so we'll take what we can get), or\n+                    // - it's not the final parallel download slot (which we may reserve for first outbound)",
      "path": "src/net_processing.cpp",
      "position": 295,
      "original_position": 281,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "in_reply_to_id": 1200117089,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "added more clarifying comment and an `Assume` for now",
      "created_at": "2023-05-22T13:12:26Z",
      "updated_at": "2023-05-22T13:12:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1200500047",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200500047"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4398,
      "original_line": 4398,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200509401",
      "pull_request_review_id": 1436621880,
      "id": 1200509401,
      "node_id": "PRRC_kwDOABII585HjlHZ",
      "diff_hunk": "@@ -4338,9 +4386,24 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     txn.blockhash = blockhash;\n                     blockTxnMsg << txn;\n                     fProcessBLOCKTXN = true;\n-                } else {\n+                } else if (first_in_flight) {\n+                    // We will try to round-trip any compact blocks we get on failure,\n+                    // as long as it's first...\n                     req.blockhash = pindex->GetBlockHash();\n                     m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETBLOCKTXN, req));\n+                } else if (pfrom.m_bip152_highbandwidth_to &&\n+                    (!nodestate->m_is_inbound ||\n+                    IsBlockRequestedFromOutbound(blockhash) ||\n+                    already_in_flight < MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK - 1)) {\n+                    // ... or it's a hb relay peer and:\n+                    // - peer is outbound, or\n+                    // - we already have an outbound attempt in flight(so we'll take what we can get), or\n+                    // - it's not the final parallel download slot (which we may reserve for first outbound)",
      "path": "src/net_processing.cpp",
      "position": 295,
      "original_position": 281,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "in_reply_to_id": 1200117089,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> I guess I think it might be better to not do multiple parallel requests to outbound peers\r\n\r\nThat makes some sense since using an outbound is mostly for the anti-sybil portion of the reasoning. Once we have an outbound hb peer, they're likely highly reliable, and we probably don't need to try so hard for other connections. Maybe even allow only up to two attempts if we already have an outbound in flight.",
      "created_at": "2023-05-22T13:20:12Z",
      "updated_at": "2023-05-22T13:20:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1200509401",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200509401"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4398,
      "original_line": 4398,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1201730942",
      "pull_request_review_id": 1438918136,
      "id": 1201730942,
      "node_id": "PRRC_kwDOABII585HoPV-",
      "diff_hunk": "@@ -1176,8 +1191,8 @@ bool PeerManagerImpl::BlockRequested(NodeId nodeid, const CBlockIndex& block, st\n         }\n     }\n \n-    // Make sure it's not listed somewhere already.\n-    RemoveBlockRequest(hash, std::nullopt);\n+    // Make sure it's not being fetched already from same peer.",
      "path": "src/net_processing.cpp",
      "position": 130,
      "original_position": 81,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "ac054de305244ea4d0518a48973156feed4cad67",
      "in_reply_to_id": null,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "You just iterated over all the peers requesting this block, and returned early if one of them was this node. What's the benefit of looping again?",
      "created_at": "2023-05-23T08:00:39Z",
      "updated_at": "2023-05-23T09:42:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1201730942",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1201730942"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1194,
      "original_line": 1194,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202561710",
      "pull_request_review_id": 1440008906,
      "id": 1202561710,
      "node_id": "PRRC_kwDOABII585HraKu",
      "diff_hunk": "@@ -1176,8 +1191,8 @@ bool PeerManagerImpl::BlockRequested(NodeId nodeid, const CBlockIndex& block, st\n         }\n     }\n \n-    // Make sure it's not listed somewhere already.\n-    RemoveBlockRequest(hash, std::nullopt);\n+    // Make sure it's not being fetched already from same peer.",
      "path": "src/net_processing.cpp",
      "position": 130,
      "original_position": 81,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "ac054de305244ea4d0518a48973156feed4cad67",
      "in_reply_to_id": 1201730942,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Hmm right, this is now completely redundant and can be removed.",
      "created_at": "2023-05-23T15:36:54Z",
      "updated_at": "2023-05-23T15:36:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1202561710",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202561710"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1194,
      "original_line": 1194,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202565711",
      "pull_request_review_id": 1440012745,
      "id": 1202565711,
      "node_id": "PRRC_kwDOABII585HrbJP",
      "diff_hunk": "@@ -1511,7 +1519,15 @@ void PeerManagerImpl::FinalizeNode(const CNode& node)\n         nSyncStarted--;\n \n     for (const QueuedBlock& entry : state->vBlocksInFlight) {\n-        mapBlocksInFlight.erase(entry.pindex->GetBlockHash());\n+        auto range = mapBlocksInFlight.equal_range(entry.pindex->GetBlockHash());",
      "path": "src/net_processing.cpp",
      "position": 161,
      "original_position": 113,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "cce96182ba2457335868c65dc16b081c3dee32ee",
      "in_reply_to_id": null,
      "user": {
        "login": "theuni",
        "id": 417043,
        "node_id": "MDQ6VXNlcjQxNzA0Mw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theuni",
        "html_url": "https://github.com/theuni",
        "followers_url": "https://api.github.com/users/theuni/followers",
        "following_url": "https://api.github.com/users/theuni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theuni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theuni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
        "organizations_url": "https://api.github.com/users/theuni/orgs",
        "repos_url": "https://api.github.com/users/theuni/repos",
        "events_url": "https://api.github.com/users/theuni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theuni/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Nit: it took me a minute to parse this. It'd be easier to read as a static function with a name imo.",
      "created_at": "2023-05-23T15:38:44Z",
      "updated_at": "2023-05-23T16:01:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1202565711",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202565711"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1537,
      "original_line": 1522,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202566303",
      "pull_request_review_id": 1440013273,
      "id": 1202566303,
      "node_id": "PRRC_kwDOABII585HrbSf",
      "diff_hunk": "@@ -4338,9 +4386,24 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     txn.blockhash = blockhash;\n                     blockTxnMsg << txn;\n                     fProcessBLOCKTXN = true;\n-                } else {\n+                } else if (first_in_flight) {\n+                    // We will try to round-trip any compact blocks we get on failure,\n+                    // as long as it's first...\n                     req.blockhash = pindex->GetBlockHash();\n                     m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETBLOCKTXN, req));\n+                } else if (pfrom.m_bip152_highbandwidth_to &&\n+                    (!nodestate->m_is_inbound ||",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 275,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "in_reply_to_id": 1198642367,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This doesn't result in a behavior change, does it?  As far as I can tell `nodestate->m_is_inbound` is initialized to the value of `pfrom.IsInboundConn()` when the `CNodeState()` is constructed -- is that understanding correct?\r\n\r\nI'm good with avoiding the use of CNodeState where possible though, if that is the reason for this change.\r\n\r\nIf these are different somehow, then perhaps we'd want to change the logic in `IsBlockRequestedFromOutbound` to match it.",
      "created_at": "2023-05-23T15:39:00Z",
      "updated_at": "2023-05-23T15:39:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1202566303",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202566303"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4395,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202580653",
      "pull_request_review_id": 1440012745,
      "id": 1202580653,
      "node_id": "PRRC_kwDOABII585Hreyt",
      "diff_hunk": "@@ -4431,14 +4456,23 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         {\n             LOCK(cs_main);\n \n-            BlockDownloadMap::iterator it = mapBlocksInFlight.find(resp.blockhash);\n-            if (it == mapBlocksInFlight.end() || !it->second.second->partialBlock ||\n-                    it->second.first != pfrom.GetId()) {\n+            bool expected_blocktxn = false;\n+            auto range_flight = mapBlocksInFlight.equal_range(resp.blockhash);\n+            while (range_flight.first != range_flight.second) {\n+                auto [node_id, block_it] = range_flight.first->second;\n+                if (node_id == pfrom.GetId() && block_it->partialBlock) {\n+                    expected_blocktxn = true;\n+                    break;\n+                }\n+                range_flight.first++;\n+            }\n+\n+            if (!expected_blocktxn) {\n                 LogPrint(BCLog::NET, \"Peer %d sent us block transactions for block we weren't expecting\\n\", pfrom.GetId());\n                 return;\n             }\n \n-            PartiallyDownloadedBlock& partialBlock = *it->second.second->partialBlock;\n+            PartiallyDownloadedBlock& partialBlock = *range_flight.first->second.second->partialBlock;",
      "path": "src/net_processing.cpp",
      "position": 342,
      "original_position": 183,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "cce96182ba2457335868c65dc16b081c3dee32ee",
      "in_reply_to_id": null,
      "user": {
        "login": "theuni",
        "id": 417043,
        "node_id": "MDQ6VXNlcjQxNzA0Mw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theuni",
        "html_url": "https://github.com/theuni",
        "followers_url": "https://api.github.com/users/theuni/followers",
        "following_url": "https://api.github.com/users/theuni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theuni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theuni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
        "organizations_url": "https://api.github.com/users/theuni/orgs",
        "repos_url": "https://api.github.com/users/theuni/repos",
        "events_url": "https://api.github.com/users/theuni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theuni/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Too much. This one is just too much :p\r\n\r\n(Call it a)Nit: Could you please break this up with a temp const ref or so for the sake of readability?",
      "created_at": "2023-05-23T15:45:13Z",
      "updated_at": "2023-05-23T16:01:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1202580653",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202580653"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4517,
      "original_line": 4475,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202592163",
      "pull_request_review_id": 1440048043,
      "id": 1202592163,
      "node_id": "PRRC_kwDOABII585Hrhmj",
      "diff_hunk": "@@ -4338,9 +4386,24 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     txn.blockhash = blockhash;\n                     blockTxnMsg << txn;\n                     fProcessBLOCKTXN = true;\n-                } else {\n+                } else if (first_in_flight) {\n+                    // We will try to round-trip any compact blocks we get on failure,\n+                    // as long as it's first...\n                     req.blockhash = pindex->GetBlockHash();\n                     m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETBLOCKTXN, req));\n+                } else if (pfrom.m_bip152_highbandwidth_to &&\n+                    (!nodestate->m_is_inbound ||",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 275,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "in_reply_to_id": 1198642367,
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> This doesn't result in a behavior change, does it? As far as I can tell nodestate->m_is_inbound is initialized to the value of pfrom.IsInboundConn() when the CNodeState() is constructed -- is that understanding correct?\r\n\r\nYes that is correct, it does not change behavior (my original suggestion would have changed it slightly, as it would exclude manual conns but that wasn't intentional).\r\n\r\n> I'm good with avoiding the use of CNodeState where possible though, if that is the reason for this change.\r\n\r\nThat was the only reason for this nit from my side. ",
      "created_at": "2023-05-23T15:48:48Z",
      "updated_at": "2023-05-23T15:48:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1202592163",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202592163"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4395,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202606662",
      "pull_request_review_id": 1439962692,
      "id": 1202606662,
      "node_id": "PRRC_kwDOABII585HrlJG",
      "diff_hunk": "@@ -1166,6 +1179,8 @@ bool PeerManagerImpl::BlockRequested(NodeId nodeid, const CBlockIndex& block, st\n     CNodeState *state = State(nodeid);\n     assert(state != nullptr);\n \n+    Assume(mapBlocksInFlight.count(hash) <= MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK);",
      "path": "src/net_processing.cpp",
      "position": 111,
      "original_position": 70,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "ac054de305244ea4d0518a48973156feed4cad67",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think that this can currently be broken by `FetchBlock()` / `getblockfrompeer`, which would now allow multiple block requests in parallel, breaking the `MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK` limit. We could probably make sure in `FetchBlock()` that `MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK` isn't breached (or maybe disallow all parallel request).",
      "created_at": "2023-05-23T15:53:04Z",
      "updated_at": "2023-05-23T15:53:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1202606662",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202606662"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1182,
      "original_line": 1182,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202685072",
      "pull_request_review_id": 1440166315,
      "id": 1202685072,
      "node_id": "PRRC_kwDOABII585Hr4SQ",
      "diff_hunk": "@@ -1166,6 +1179,8 @@ bool PeerManagerImpl::BlockRequested(NodeId nodeid, const CBlockIndex& block, st\n     CNodeState *state = State(nodeid);\n     assert(state != nullptr);\n \n+    Assume(mapBlocksInFlight.count(hash) <= MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK);",
      "path": "src/net_processing.cpp",
      "position": 111,
      "original_position": 70,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "ac054de305244ea4d0518a48973156feed4cad67",
      "in_reply_to_id": 1202606662,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "ah, good catch! I think the only sensible change here is to restrict parallel fetches, but that seems like a more serious API change? @Sjors ?",
      "created_at": "2023-05-23T16:35:18Z",
      "updated_at": "2023-05-23T16:35:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1202685072",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202685072"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1182,
      "original_line": 1182,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202698973",
      "pull_request_review_id": 1440183219,
      "id": 1202698973,
      "node_id": "PRRC_kwDOABII585Hr7rd",
      "diff_hunk": "@@ -1166,6 +1179,8 @@ bool PeerManagerImpl::BlockRequested(NodeId nodeid, const CBlockIndex& block, st\n     CNodeState *state = State(nodeid);\n     assert(state != nullptr);\n \n+    Assume(mapBlocksInFlight.count(hash) <= MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK);",
      "path": "src/net_processing.cpp",
      "position": 111,
      "original_position": 70,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "ac054de305244ea4d0518a48973156feed4cad67",
      "in_reply_to_id": 1202606662,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "restricted it to a single invocation per block at a time. Alternative seems more difficult to think about.",
      "created_at": "2023-05-23T16:45:00Z",
      "updated_at": "2023-05-23T16:45:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1202698973",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202698973"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1182,
      "original_line": 1182,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202712706",
      "pull_request_review_id": 1440199322,
      "id": 1202712706,
      "node_id": "PRRC_kwDOABII585Hr_CC",
      "diff_hunk": "@@ -1166,6 +1179,8 @@ bool PeerManagerImpl::BlockRequested(NodeId nodeid, const CBlockIndex& block, st\n     CNodeState *state = State(nodeid);\n     assert(state != nullptr);\n \n+    Assume(mapBlocksInFlight.count(hash) <= MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK);",
      "path": "src/net_processing.cpp",
      "position": 111,
      "original_position": 70,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "ac054de305244ea4d0518a48973156feed4cad67",
      "in_reply_to_id": 1202606662,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It's fine by me, though currently we have no way of telling whether a request is in progress. Maybe bring this up in #27652 too.",
      "created_at": "2023-05-23T16:55:20Z",
      "updated_at": "2023-05-23T16:55:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1202712706",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202712706"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1182,
      "original_line": 1182,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202730525",
      "pull_request_review_id": 1440221077,
      "id": 1202730525,
      "node_id": "PRRC_kwDOABII585HsDYd",
      "diff_hunk": "@@ -1166,6 +1179,8 @@ bool PeerManagerImpl::BlockRequested(NodeId nodeid, const CBlockIndex& block, st\n     CNodeState *state = State(nodeid);\n     assert(state != nullptr);\n \n+    Assume(mapBlocksInFlight.count(hash) <= MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK);",
      "path": "src/net_processing.cpp",
      "position": 111,
      "original_position": 70,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "ac054de305244ea4d0518a48973156feed4cad67",
      "in_reply_to_id": 1202606662,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "After talking offline with @Sjors , his use-case does involve asking multiple peers the same block to detect stale tips.\r\n\r\nInstead, any call of `getblockbypeer` will cause all of the same block requests to be forgotten. It's up to the user of the RPC to not have this interfere with syncing of their own node.",
      "created_at": "2023-05-23T17:09:16Z",
      "updated_at": "2023-05-23T17:19:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1202730525",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202730525"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1182,
      "original_line": 1182,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202751434",
      "pull_request_review_id": 1440245898,
      "id": 1202751434,
      "node_id": "PRRC_kwDOABII585HsIfK",
      "diff_hunk": "@@ -1166,6 +1179,8 @@ bool PeerManagerImpl::BlockRequested(NodeId nodeid, const CBlockIndex& block, st\n     CNodeState *state = State(nodeid);\n     assert(state != nullptr);\n \n+    Assume(mapBlocksInFlight.count(hash) <= MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK);",
      "path": "src/net_processing.cpp",
      "position": 111,
      "original_position": 70,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "ac054de305244ea4d0518a48973156feed4cad67",
      "in_reply_to_id": 1202606662,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "That works for me.",
      "created_at": "2023-05-23T17:25:45Z",
      "updated_at": "2023-05-23T17:25:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1202751434",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202751434"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1182,
      "original_line": 1182,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202794974",
      "pull_request_review_id": 1440297516,
      "id": 1202794974,
      "node_id": "PRRC_kwDOABII585HsTHe",
      "diff_hunk": "@@ -1166,6 +1179,8 @@ bool PeerManagerImpl::BlockRequested(NodeId nodeid, const CBlockIndex& block, st\n     CNodeState *state = State(nodeid);\n     assert(state != nullptr);\n \n+    Assume(mapBlocksInFlight.count(hash) <= MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK);\n+",
      "path": "src/net_processing.cpp",
      "position": 112,
      "original_position": 71,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "03423f8bd12b95a06a4a9d8377e781625dd38aae",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Another nit  - I think that this should this be `<` instead of `<=` because it is the responsibility of the caller to call `BlockRequested` only if there is room for one more request.",
      "created_at": "2023-05-23T18:00:50Z",
      "updated_at": "2023-05-23T18:10:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1202794974",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202794974"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1183,
      "original_line": 1183,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202811629",
      "pull_request_review_id": 1440317882,
      "id": 1202811629,
      "node_id": "PRRC_kwDOABII585HsXLt",
      "diff_hunk": "@@ -1166,6 +1179,8 @@ bool PeerManagerImpl::BlockRequested(NodeId nodeid, const CBlockIndex& block, st\n     CNodeState *state = State(nodeid);\n     assert(state != nullptr);\n \n+    Assume(mapBlocksInFlight.count(hash) <= MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK);\n+",
      "path": "src/net_processing.cpp",
      "position": 112,
      "original_position": 71,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "03423f8bd12b95a06a4a9d8377e781625dd38aae",
      "in_reply_to_id": 1202794974,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "caller may call it when it's already requested by this peer, see a few lines below at https://github.com/bitcoin/bitcoin/pull/27626/files/13f9b20b4cb2f3f26e81184a77e9cf1f626d4f57..03423f8bd12b95a06a4a9d8377e781625dd38aae#diff-6875de769e90cec84d2e8a9c1b962cdbcda44d870d42e4215827e599e11e90e3L1175",
      "created_at": "2023-05-23T18:14:52Z",
      "updated_at": "2023-05-23T18:14:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1202811629",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202811629"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1183,
      "original_line": 1183,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202830069",
      "pull_request_review_id": 1440339124,
      "id": 1202830069,
      "node_id": "PRRC_kwDOABII585Hsbr1",
      "diff_hunk": "@@ -1166,6 +1179,8 @@ bool PeerManagerImpl::BlockRequested(NodeId nodeid, const CBlockIndex& block, st\n     CNodeState *state = State(nodeid);\n     assert(state != nullptr);\n \n+    Assume(mapBlocksInFlight.count(hash) <= MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK);\n+",
      "path": "src/net_processing.cpp",
      "position": 112,
      "original_position": 71,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "03423f8bd12b95a06a4a9d8377e781625dd38aae",
      "in_reply_to_id": 1202794974,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Hmm, is the case where we are at `MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK` but `BlockRequested()` is still called one something that can actually happen? Because in that case that caller would need to have previously checked that one of the existing requests is for the same nodeId, otherwise the limit would be breached. ",
      "created_at": "2023-05-23T18:30:12Z",
      "updated_at": "2023-05-23T18:30:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1202830069",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202830069"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1183,
      "original_line": 1183,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202844909",
      "pull_request_review_id": 1440355908,
      "id": 1202844909,
      "node_id": "PRRC_kwDOABII585HsfTt",
      "diff_hunk": "@@ -1166,6 +1179,8 @@ bool PeerManagerImpl::BlockRequested(NodeId nodeid, const CBlockIndex& block, st\n     CNodeState *state = State(nodeid);\n     assert(state != nullptr);\n \n+    Assume(mapBlocksInFlight.count(hash) <= MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK);\n+",
      "path": "src/net_processing.cpp",
      "position": 112,
      "original_position": 71,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "03423f8bd12b95a06a4a9d8377e781625dd38aae",
      "in_reply_to_id": 1202794974,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "make sure to check the other call locations, but they aren't supposed to",
      "created_at": "2023-05-23T18:42:27Z",
      "updated_at": "2023-05-23T18:42:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1202844909",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202844909"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1183,
      "original_line": 1183,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1203951678",
      "pull_request_review_id": 1441610483,
      "id": 1203951678,
      "node_id": "PRRC_kwDOABII585Hwtg-",
      "diff_hunk": "@@ -1122,34 +1123,40 @@ bool PeerManagerImpl::IsBlockRequested(const uint256& hash)\n \n void PeerManagerImpl::RemoveBlockRequest(const uint256& hash, std::optional<NodeId> from_peer)\n {\n-    auto it = mapBlocksInFlight.find(hash);\n-    if (it == mapBlocksInFlight.end()) {\n-        // Block was not requested\n+    auto range = mapBlocksInFlight.equal_range(hash);\n+    if (range.first == range.second) {",
      "path": "src/net_processing.cpp",
      "position": 59,
      "original_position": 18,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "cce96182ba2457335868c65dc16b081c3dee32ee",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "cce96182ba2457335868c65dc16b081c3dee32ee: maybe do `if (!mapBlocksInFlight.count(hash) {` first and then construct the range after the `Assume` below?\r\n\r\n(for a followup)",
      "created_at": "2023-05-24T11:35:59Z",
      "updated_at": "2023-05-24T14:40:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1203951678",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1203951678"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1141,
      "original_line": 1127,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1203997112",
      "pull_request_review_id": 1441610483,
      "id": 1203997112,
      "node_id": "PRRC_kwDOABII585Hw4m4",
      "diff_hunk": "@@ -1117,40 +1121,57 @@ std::chrono::microseconds PeerManagerImpl::NextInvToInbounds(std::chrono::micros\n \n bool PeerManagerImpl::IsBlockRequested(const uint256& hash)\n {\n-    return mapBlocksInFlight.find(hash) != mapBlocksInFlight.end();\n+    return mapBlocksInFlight.count(hash);\n }\n \n-void PeerManagerImpl::RemoveBlockRequest(const uint256& hash, std::optional<NodeId> from_peer)\n+bool PeerManagerImpl::IsBlockRequestedFromOutbound(const uint256& hash)\n {\n-    auto it = mapBlocksInFlight.find(hash);\n-    if (it == mapBlocksInFlight.end()) {\n-        // Block was not requested\n-        return;\n+    for (auto range = mapBlocksInFlight.equal_range(hash); range.first != range.second; range.first++) {\n+        auto [nodeid, block_it] = range.first->second;\n+        CNodeState *nodestate = State(nodeid);\n+        assert(nodestate);\n+        if (!nodestate->m_is_inbound) return true;\n     }\n \n-    auto [node_id, list_it] = it->second;\n+    return false;\n+}\n \n-    if (from_peer && node_id != *from_peer) {\n-        // Block was requested by another peer\n+void PeerManagerImpl::RemoveBlockRequest(const uint256& hash, std::optional<NodeId> from_peer)\n+{\n+    auto range = mapBlocksInFlight.equal_range(hash);\n+    if (range.first == range.second) {\n+        // Block was not requested from any peer\n         return;\n     }\n \n-    CNodeState *state = State(node_id);\n-    assert(state != nullptr);\n+    // We should not have requested too many of this block\n+    Assume(mapBlocksInFlight.count(hash) <= MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK);\n \n-    if (state->vBlocksInFlight.begin() == list_it) {\n-        // First block on the queue was received, update the start download time for the next one\n-        state->m_downloading_since = std::max(state->m_downloading_since, GetTime<std::chrono::microseconds>());\n-    }\n-    state->vBlocksInFlight.erase(list_it);\n+    while (range.first != range.second) {\n+        auto [node_id, list_it] = range.first->second;\n+\n+        if (from_peer && *from_peer != node_id) {\n+            range.first++;\n+            continue;\n+        }\n \n-    state->nBlocksInFlight--;\n-    if (state->nBlocksInFlight == 0) {\n-        // Last validated block on the queue was received.\n-        m_peers_downloading_from--;\n+        CNodeState *state = State(node_id);\n+        assert(state != nullptr);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 88,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "in_reply_to_id": 1198646710,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Lost in rebase?",
      "created_at": "2023-05-24T12:06:59Z",
      "updated_at": "2023-05-24T14:35:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1203997112",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1203997112"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": 1158,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1159,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204276234",
      "pull_request_review_id": 1441610483,
      "id": 1204276234,
      "node_id": "PRRC_kwDOABII585Hx8wK",
      "diff_hunk": "@@ -1122,34 +1123,40 @@ bool PeerManagerImpl::IsBlockRequested(const uint256& hash)\n \n void PeerManagerImpl::RemoveBlockRequest(const uint256& hash, std::optional<NodeId> from_peer)\n {\n-    auto it = mapBlocksInFlight.find(hash);\n-    if (it == mapBlocksInFlight.end()) {\n-        // Block was not requested\n+    auto range = mapBlocksInFlight.equal_range(hash);\n+    if (range.first == range.second) {\n+        // Block was not requested from any peer\n         return;\n     }\n \n-    auto [node_id, list_it] = it->second;\n+    // Currently we don't request more than one peer for same block\n+    Assume(mapBlocksInFlight.count(hash) == 1);\n \n-    if (from_peer && node_id != *from_peer) {\n-        // Block was requested by another peer\n-        return;\n-    }\n+    while (range.first != range.second) {\n+        auto [node_id, list_it] = range.first->second;\n \n-    CNodeState *state = State(node_id);\n-    assert(state != nullptr);\n+        if (from_peer && *from_peer != node_id) {",
      "path": "src/net_processing.cpp",
      "position": 77,
      "original_position": 36,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "cce96182ba2457335868c65dc16b081c3dee32ee",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This is the line valgrind trips over. Adding something like `fprintf(stderr, \"from_peer=%ld\\n\", *from_peer);` above it makes it stop complaining. Maybe this is just a valgrind a bug?\r\n\r\nTracking in #27741",
      "created_at": "2023-05-24T14:35:29Z",
      "updated_at": "2023-05-24T15:24:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1204276234",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204276234"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1152,
      "original_line": 1138,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204280315",
      "pull_request_review_id": 1442069704,
      "id": 1204280315,
      "node_id": "PRRC_kwDOABII585Hx9v7",
      "diff_hunk": "@@ -1117,40 +1121,57 @@ std::chrono::microseconds PeerManagerImpl::NextInvToInbounds(std::chrono::micros\n \n bool PeerManagerImpl::IsBlockRequested(const uint256& hash)\n {\n-    return mapBlocksInFlight.find(hash) != mapBlocksInFlight.end();\n+    return mapBlocksInFlight.count(hash);\n }\n \n-void PeerManagerImpl::RemoveBlockRequest(const uint256& hash, std::optional<NodeId> from_peer)\n+bool PeerManagerImpl::IsBlockRequestedFromOutbound(const uint256& hash)\n {\n-    auto it = mapBlocksInFlight.find(hash);\n-    if (it == mapBlocksInFlight.end()) {\n-        // Block was not requested\n-        return;\n+    for (auto range = mapBlocksInFlight.equal_range(hash); range.first != range.second; range.first++) {\n+        auto [nodeid, block_it] = range.first->second;\n+        CNodeState *nodestate = State(nodeid);\n+        assert(nodestate);\n+        if (!nodestate->m_is_inbound) return true;\n     }\n \n-    auto [node_id, list_it] = it->second;\n+    return false;\n+}\n \n-    if (from_peer && node_id != *from_peer) {\n-        // Block was requested by another peer\n+void PeerManagerImpl::RemoveBlockRequest(const uint256& hash, std::optional<NodeId> from_peer)\n+{\n+    auto range = mapBlocksInFlight.equal_range(hash);\n+    if (range.first == range.second) {\n+        // Block was not requested from any peer\n         return;\n     }\n \n-    CNodeState *state = State(node_id);\n-    assert(state != nullptr);\n+    // We should not have requested too many of this block\n+    Assume(mapBlocksInFlight.count(hash) <= MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK);\n \n-    if (state->vBlocksInFlight.begin() == list_it) {\n-        // First block on the queue was received, update the start download time for the next one\n-        state->m_downloading_since = std::max(state->m_downloading_since, GetTime<std::chrono::microseconds>());\n-    }\n-    state->vBlocksInFlight.erase(list_it);\n+    while (range.first != range.second) {\n+        auto [node_id, list_it] = range.first->second;\n+\n+        if (from_peer && *from_peer != node_id) {\n+            range.first++;\n+            continue;\n+        }\n \n-    state->nBlocksInFlight--;\n-    if (state->nBlocksInFlight == 0) {\n-        // Last validated block on the queue was received.\n-        m_peers_downloading_from--;\n+        CNodeState *state = State(node_id);\n+        assert(state != nullptr);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 88,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "in_reply_to_id": 1198646710,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "hmmm appears so",
      "created_at": "2023-05-24T14:37:33Z",
      "updated_at": "2023-05-24T14:37:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1204280315",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204280315"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": 1158,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1159,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204429122",
      "pull_request_review_id": 1442250064,
      "id": 1204429122,
      "node_id": "PRRC_kwDOABII585HyiFC",
      "diff_hunk": "@@ -1122,34 +1123,40 @@ bool PeerManagerImpl::IsBlockRequested(const uint256& hash)\n \n void PeerManagerImpl::RemoveBlockRequest(const uint256& hash, std::optional<NodeId> from_peer)\n {\n-    auto it = mapBlocksInFlight.find(hash);\n-    if (it == mapBlocksInFlight.end()) {\n-        // Block was not requested\n+    auto range = mapBlocksInFlight.equal_range(hash);\n+    if (range.first == range.second) {\n+        // Block was not requested from any peer\n         return;\n     }\n \n-    auto [node_id, list_it] = it->second;\n+    // Currently we don't request more than one peer for same block\n+    Assume(mapBlocksInFlight.count(hash) == 1);\n \n-    if (from_peer && node_id != *from_peer) {\n-        // Block was requested by another peer\n-        return;\n-    }\n+    while (range.first != range.second) {\n+        auto [node_id, list_it] = range.first->second;\n \n-    CNodeState *state = State(node_id);\n-    assert(state != nullptr);\n+        if (from_peer && *from_peer != node_id) {\n+            range.first++;\n+            continue;\n+        }\n \n-    if (state->vBlocksInFlight.begin() == list_it) {\n-        // First block on the queue was received, update the start download time for the next one\n-        state->m_downloading_since = std::max(state->m_downloading_since, GetTime<std::chrono::microseconds>());\n-    }\n-    state->vBlocksInFlight.erase(list_it);\n+        CNodeState *state = State(node_id);\n+        assert(state != nullptr);\n \n-    if (state->vBlocksInFlight.empty()) {\n-        // Last validated block on the queue was received.\n-        m_peers_downloading_from--;\n+        if (state->vBlocksInFlight.begin() == list_it) {\n+            // First block on the queue was received, update the start download time for the next one\n+            state->m_downloading_since = std::max(state->m_downloading_since, GetTime<std::chrono::microseconds>());\n+        }\n+        state->vBlocksInFlight.erase(list_it);\n+\n+        if (state->vBlocksInFlight.empty()) {\n+            // Last validated block on the queue for this peer was received.\n+            m_peers_downloading_from--;\n+        }\n+        state->m_stalling_since = 0us;\n+\n+        range.first = mapBlocksInFlight.erase(range.first);\n     }",
      "path": "src/net_processing.cpp",
      "position": 101,
      "original_position": 65,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "cce96182ba2457335868c65dc16b081c3dee32ee",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "cce96182ba2457335868c65dc16b081c3dee32ee: the goal of the above loop seems to be to find one entry: the `vBlocksInFlight` entry for this particular block and `from_peer`. A followup could move that into its own function, and/or have the subsequent operations on the entry live _outside_ the loop.",
      "created_at": "2023-05-24T15:52:26Z",
      "updated_at": "2023-05-24T16:22:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1204429122",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204429122"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1172,
      "original_line": 1159,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204472811",
      "pull_request_review_id": 1442250064,
      "id": 1204472811,
      "node_id": "PRRC_kwDOABII585Hysvr",
      "diff_hunk": "@@ -1117,40 +1121,57 @@ std::chrono::microseconds PeerManagerImpl::NextInvToInbounds(std::chrono::micros\n \n bool PeerManagerImpl::IsBlockRequested(const uint256& hash)\n {\n-    return mapBlocksInFlight.find(hash) != mapBlocksInFlight.end();\n+    return mapBlocksInFlight.count(hash);\n }\n \n-void PeerManagerImpl::RemoveBlockRequest(const uint256& hash, std::optional<NodeId> from_peer)\n+bool PeerManagerImpl::IsBlockRequestedFromOutbound(const uint256& hash)\n {\n-    auto it = mapBlocksInFlight.find(hash);\n-    if (it == mapBlocksInFlight.end()) {\n-        // Block was not requested\n-        return;\n+    for (auto range = mapBlocksInFlight.equal_range(hash); range.first != range.second; range.first++) {\n+        auto [nodeid, block_it] = range.first->second;\n+        CNodeState *nodestate = State(nodeid);\n+        assert(nodestate);\n+        if (!nodestate->m_is_inbound) return true;\n     }\n \n-    auto [node_id, list_it] = it->second;\n+    return false;\n+}\n \n-    if (from_peer && node_id != *from_peer) {\n-        // Block was requested by another peer\n+void PeerManagerImpl::RemoveBlockRequest(const uint256& hash, std::optional<NodeId> from_peer)\n+{\n+    auto range = mapBlocksInFlight.equal_range(hash);\n+    if (range.first == range.second) {\n+        // Block was not requested from any peer\n         return;\n     }\n \n-    CNodeState *state = State(node_id);\n-    assert(state != nullptr);\n+    // We should not have requested too many of this block\n+    Assume(mapBlocksInFlight.count(hash) <= MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK);\n \n-    if (state->vBlocksInFlight.begin() == list_it) {\n-        // First block on the queue was received, update the start download time for the next one\n-        state->m_downloading_since = std::max(state->m_downloading_since, GetTime<std::chrono::microseconds>());\n-    }\n-    state->vBlocksInFlight.erase(list_it);\n+    while (range.first != range.second) {\n+        auto [node_id, list_it] = range.first->second;\n+\n+        if (from_peer && *from_peer != node_id) {\n+            range.first++;\n+            continue;\n+        }\n \n-    state->nBlocksInFlight--;\n-    if (state->nBlocksInFlight == 0) {\n-        // Last validated block on the queue was received.\n-        m_peers_downloading_from--;\n+        CNodeState *state = State(node_id);\n+        assert(state != nullptr);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 88,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "42c2696ae58e07de005edf1dda952761f8c9008e",
      "in_reply_to_id": 1198646710,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It ended up in 03423f8bd12b95a06a4a9d8377e781625dd38aae",
      "created_at": "2023-05-24T16:22:28Z",
      "updated_at": "2023-05-24T16:22:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1204472811",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204472811"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": 1158,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1159,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204478988",
      "pull_request_review_id": 1442325175,
      "id": 1204478988,
      "node_id": "PRRC_kwDOABII585HyuQM",
      "diff_hunk": "@@ -1774,11 +1789,10 @@ std::optional<std::string> PeerManagerImpl::FetchBlock(NodeId peer_id, const CBl\n \n     LOCK(cs_main);\n \n-    // Mark block as in-flight unless it already is (for this peer).\n-    // If the peer does not send us a block, vBlocksInFlight remains non-empty,\n-    // causing us to timeout and disconnect.\n-    // If a block was already in-flight for a different peer, its BLOCKTXN\n-    // response will be dropped.\n+    // Forget about all prior requests\n+    RemoveBlockRequest(block_index.GetBlockHash(), std::nullopt);\n+\n+    // Mark block as in-flight",
      "path": "src/net_processing.cpp",
      "position": 192,
      "original_position": 98,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "03423f8bd12b95a06a4a9d8377e781625dd38aae",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "03423f8bd12b95a06a4a9d8377e781625dd38aae: some of the above deleted comment is still relevant.\r\n\r\n```cpp\r\n  // If the peer does not send us a block, vBlocksInFlight remains non-empty,\r\n  // causing us to timeout and disconnect.\r\n```",
      "created_at": "2023-05-24T16:28:04Z",
      "updated_at": "2023-05-24T17:30:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1204478988",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204478988"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1795,
      "original_line": 1795,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204480914",
      "pull_request_review_id": 1442325175,
      "id": 1204480914,
      "node_id": "PRRC_kwDOABII585HyuuS",
      "diff_hunk": "@@ -1774,11 +1789,10 @@ std::optional<std::string> PeerManagerImpl::FetchBlock(NodeId peer_id, const CBl\n \n     LOCK(cs_main);\n \n-    // Mark block as in-flight unless it already is (for this peer).\n-    // If the peer does not send us a block, vBlocksInFlight remains non-empty,\n-    // causing us to timeout and disconnect.\n-    // If a block was already in-flight for a different peer, its BLOCKTXN\n-    // response will be dropped.\n+    // Forget about all prior requests",
      "path": "src/net_processing.cpp",
      "position": 189,
      "original_position": 95,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "03423f8bd12b95a06a4a9d8377e781625dd38aae",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "03423f8bd12b95a06a4a9d8377e781625dd38aae  This deleted comment line is still relevant when deleting the request: \r\n\r\n```cpp\r\n// Forget about all prior requests. If a block was already in-flight\r\n// for a different peer, its BLOCKTXN response will be dropped.\r\n```\r\n",
      "created_at": "2023-05-24T16:29:25Z",
      "updated_at": "2023-05-24T17:30:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1204480914",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204480914"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1792,
      "original_line": 1792,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204491894",
      "pull_request_review_id": 1442325175,
      "id": 1204491894,
      "node_id": "PRRC_kwDOABII585HyxZ2",
      "diff_hunk": "@@ -4343,11 +4360,16 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     Misbehaving(*peer, 100, \"invalid compact block\");\n                     return;\n                 } else if (status == READ_STATUS_FAILED) {\n-                    // Duplicate txindexes, the block is now in-flight, so just request it\n-                    std::vector<CInv> vInv(1);\n-                    vInv[0] = CInv(MSG_BLOCK | GetFetchFlags(*peer), blockhash);\n-                    m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETDATA, vInv));\n-                    return;\n+                    if (first_in_flight)  {\n+                        // Duplicate txindexes, the block is now in-flight, so just request it\n+                        std::vector<CInv> vInv(1);\n+                        vInv[0] = CInv(MSG_BLOCK | GetFetchFlags(*peer), blockhash);\n+                        m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETDATA, vInv));\n+                        return;\n+                    } else {\n+                        // Give up for this peer and wait for other peer(s)\n+                        RemoveBlockRequest(pindex->GetBlockHash(), pfrom.GetId());",
      "path": "src/net_processing.cpp",
      "position": 273,
      "original_position": 166,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "03423f8bd12b95a06a4a9d8377e781625dd38aae",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "03423f8bd12b95a06a4a9d8377e781625dd38aae: why not `return`?",
      "created_at": "2023-05-24T16:40:00Z",
      "updated_at": "2023-05-24T17:30:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1204491894",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204491894"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4371,
      "original_line": 4371,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204495961",
      "pull_request_review_id": 1442325175,
      "id": 1204495961,
      "node_id": "PRRC_kwDOABII585HyyZZ",
      "diff_hunk": "@@ -4361,9 +4383,24 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     txn.blockhash = blockhash;\n                     blockTxnMsg << txn;\n                     fProcessBLOCKTXN = true;\n-                } else {\n+                } else if (first_in_flight) {\n+                    // We will try to round-trip any compact blocks we get on failure,",
      "path": "src/net_processing.cpp",
      "position": 284,
      "original_position": 177,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "03423f8bd12b95a06a4a9d8377e781625dd38aae",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "03423f8bd12b95a06a4a9d8377e781625dd38aae \"on failure\" -> \"when missing transactions\" (the word failure is ambiguous, this is different from `READ_STATUS_FAILED`)",
      "created_at": "2023-05-24T16:43:59Z",
      "updated_at": "2023-05-24T17:30:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1204495961",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204495961"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4387,
      "original_line": 4387,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204497452",
      "pull_request_review_id": 1442325175,
      "id": 1204497452,
      "node_id": "PRRC_kwDOABII585Hyyws",
      "diff_hunk": "@@ -4361,9 +4383,24 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     txn.blockhash = blockhash;\n                     blockTxnMsg << txn;\n                     fProcessBLOCKTXN = true;\n-                } else {\n+                } else if (first_in_flight) {\n+                    // We will try to round-trip any compact blocks we get on failure,\n+                    // as long as it's first...\n+                    req.blockhash = pindex->GetBlockHash();\n+                    m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETBLOCKTXN, req));\n+                } else if (pfrom.m_bip152_highbandwidth_to &&\n+                    (!pfrom.IsInboundConn() ||\n+                    IsBlockRequestedFromOutbound(blockhash) ||\n+                    already_in_flight < MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK - 1)) {",
      "path": "src/net_processing.cpp",
      "position": 291,
      "original_position": 184,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "03423f8bd12b95a06a4a9d8377e781625dd38aae",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "03423f8bd12b95a06a4a9d8377e781625dd38aae could add a static assert `MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK > 1` in a followup.",
      "created_at": "2023-05-24T16:45:30Z",
      "updated_at": "2023-05-24T17:30:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1204497452",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204497452"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4394,
      "original_line": 4394,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204506528",
      "pull_request_review_id": 1442325175,
      "id": 1204506528,
      "node_id": "PRRC_kwDOABII585Hy0-g",
      "diff_hunk": "@@ -4361,9 +4383,24 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     txn.blockhash = blockhash;\n                     blockTxnMsg << txn;\n                     fProcessBLOCKTXN = true;\n-                } else {\n+                } else if (first_in_flight) {\n+                    // We will try to round-trip any compact blocks we get on failure,\n+                    // as long as it's first...\n+                    req.blockhash = pindex->GetBlockHash();\n+                    m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETBLOCKTXN, req));\n+                } else if (pfrom.m_bip152_highbandwidth_to &&\n+                    (!pfrom.IsInboundConn() ||\n+                    IsBlockRequestedFromOutbound(blockhash) ||\n+                    already_in_flight < MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK - 1)) {\n+                    // ... or it's a hb relay peer and:\n+                    // - peer is outbound, or\n+                    // - we already have an outbound attempt in flight(so we'll take what we can get), or\n+                    // - it's not the final parallel download slot (which we may reserve for first outbound)\n                     req.blockhash = pindex->GetBlockHash();\n                     m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETBLOCKTXN, req));\n+                } else {\n+                    // Give up for this peer and wait for other peer(s)",
      "path": "src/net_processing.cpp",
      "position": 299,
      "original_position": 192,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "03423f8bd12b95a06a4a9d8377e781625dd38aae",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "03423f8bd12b95a06a4a9d8377e781625dd38aae: \"Give up\" implies that this peer could have done something to prevent this, but that's often not the case (`Nodes sending cmpctblock messages SHOULD limit prefilledtxn to 10KB of transactions.` - BIP152 footnote 5).\r\n\r\n```cpp\r\n// Do not followup with `GETBLOCKTXN` to this peer,\r\n// wait for an outbound peer to announce the compact block instead.",
      "created_at": "2023-05-24T16:52:19Z",
      "updated_at": "2023-05-24T17:30:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1204506528",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204506528"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4402,
      "original_line": 4402,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204514939",
      "pull_request_review_id": 1442325175,
      "id": 1204514939,
      "node_id": "PRRC_kwDOABII585Hy3B7",
      "diff_hunk": "@@ -823,12 +827,85 @@ def assert_highbandwidth_states(node, hb_to, hb_from):\n         hb_test_node.send_and_ping(msg_sendcmpct(announce=False, version=2))\n         assert_highbandwidth_states(self.nodes[0], hb_to=True, hb_from=False)\n \n+    def test_compactblock_reconstruction_parallel_reconstruction(self, stalling_peer, delivery_peer, inbound_peer, outbound_peer):\n+        \"\"\" All p2p connections are inbound except outbound_peer. We test that ultimate parallel slot\n+            can only be taken by an outbound node unless prior attempts were done by an outbound\n+        \"\"\"\n+        node = self.nodes[0]\n+        assert len(self.utxos)\n+\n+        def announce_cmpct_block(node, peer, txn_count):\n+            utxo = self.utxos.pop(0)\n+            block = self.build_block_with_transactions(node, utxo, txn_count)\n+\n+            cmpct_block = HeaderAndShortIDs()\n+            cmpct_block.initialize_from_block(block)\n+            msg = msg_cmpctblock(cmpct_block.to_p2p())\n+            peer.send_and_ping(msg)\n+            with p2p_lock:\n+                assert \"getblocktxn\" in peer.last_message\n+            return block, cmpct_block\n+\n+        for name, peer in [(\"delivery\", delivery_peer), (\"inbound\", inbound_peer), (\"outbound\", outbound_peer)]:\n+            self.log.info(f\"Setting {name} as high bandwidth peer\")",
      "path": "test/functional/p2p_compactblocks.py",
      "position": 44,
      "original_position": 44,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83: maybe explain what's going on here. We send an unsolicited compact block from these peers to our node. Because the block adds to our tip the message doesn't get ignored. Once the block is successfully processed we mark the peer as high bandwidth. This is done on a first-come-first-serve basis. This results in the `[False, True, True, True]` pattern below.",
      "created_at": "2023-05-24T16:59:13Z",
      "updated_at": "2023-05-24T17:30:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1204514939",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204514939"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 850,
      "original_line": 850,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204554984",
      "pull_request_review_id": 1442441562,
      "id": 1204554984,
      "node_id": "PRRC_kwDOABII585HzAzo",
      "diff_hunk": "@@ -1774,11 +1789,10 @@ std::optional<std::string> PeerManagerImpl::FetchBlock(NodeId peer_id, const CBl\n \n     LOCK(cs_main);\n \n-    // Mark block as in-flight unless it already is (for this peer).\n-    // If the peer does not send us a block, vBlocksInFlight remains non-empty,\n-    // causing us to timeout and disconnect.\n-    // If a block was already in-flight for a different peer, its BLOCKTXN\n-    // response will be dropped.\n+    // Forget about all prior requests\n+    RemoveBlockRequest(block_index.GetBlockHash(), std::nullopt);\n+\n+    // Mark block as in-flight",
      "path": "src/net_processing.cpp",
      "position": 192,
      "original_position": 98,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "03423f8bd12b95a06a4a9d8377e781625dd38aae",
      "in_reply_to_id": 1204478988,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Not anymore, we completely forget we expect it from a peer now. No disconnect should occur.",
      "created_at": "2023-05-24T17:36:59Z",
      "updated_at": "2023-05-24T17:37:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1204554984",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204554984"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1795,
      "original_line": 1795,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204558056",
      "pull_request_review_id": 1442446082,
      "id": 1204558056,
      "node_id": "PRRC_kwDOABII585HzBjo",
      "diff_hunk": "@@ -4361,9 +4383,24 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     txn.blockhash = blockhash;\n                     blockTxnMsg << txn;\n                     fProcessBLOCKTXN = true;\n-                } else {\n+                } else if (first_in_flight) {\n+                    // We will try to round-trip any compact blocks we get on failure,\n+                    // as long as it's first...\n+                    req.blockhash = pindex->GetBlockHash();\n+                    m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETBLOCKTXN, req));\n+                } else if (pfrom.m_bip152_highbandwidth_to &&\n+                    (!pfrom.IsInboundConn() ||\n+                    IsBlockRequestedFromOutbound(blockhash) ||\n+                    already_in_flight < MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK - 1)) {",
      "path": "src/net_processing.cpp",
      "position": 291,
      "original_position": 184,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "03423f8bd12b95a06a4a9d8377e781625dd38aae",
      "in_reply_to_id": 1204497452,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "if it's 1, that's fine, it just won't allow additional slots",
      "created_at": "2023-05-24T17:40:03Z",
      "updated_at": "2023-05-24T17:40:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1204558056",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204558056"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4394,
      "original_line": 4394,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204561198",
      "pull_request_review_id": 1442451055,
      "id": 1204561198,
      "node_id": "PRRC_kwDOABII585HzCUu",
      "diff_hunk": "@@ -4343,11 +4360,16 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     Misbehaving(*peer, 100, \"invalid compact block\");\n                     return;\n                 } else if (status == READ_STATUS_FAILED) {\n-                    // Duplicate txindexes, the block is now in-flight, so just request it\n-                    std::vector<CInv> vInv(1);\n-                    vInv[0] = CInv(MSG_BLOCK | GetFetchFlags(*peer), blockhash);\n-                    m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETDATA, vInv));\n-                    return;\n+                    if (first_in_flight)  {\n+                        // Duplicate txindexes, the block is now in-flight, so just request it\n+                        std::vector<CInv> vInv(1);\n+                        vInv[0] = CInv(MSG_BLOCK | GetFetchFlags(*peer), blockhash);\n+                        m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETDATA, vInv));\n+                        return;\n+                    } else {\n+                        // Give up for this peer and wait for other peer(s)\n+                        RemoveBlockRequest(pindex->GetBlockHash(), pfrom.GetId());",
      "path": "src/net_processing.cpp",
      "position": 273,
      "original_position": 166,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "03423f8bd12b95a06a4a9d8377e781625dd38aae",
      "in_reply_to_id": 1204491894,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "oops, indeed, looks like we'll send off bogus getblocktxns here, if it comes from a preferred peer that's not first. needs a fix. Wasted bandwidth and should result in \"Peer %d sent us block transactions for block we weren't expecting\\n\"",
      "created_at": "2023-05-24T17:42:59Z",
      "updated_at": "2023-05-24T17:43:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1204561198",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204561198"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4371,
      "original_line": 4371,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204563081",
      "pull_request_review_id": 1442453933,
      "id": 1204563081,
      "node_id": "PRRC_kwDOABII585HzCyJ",
      "diff_hunk": "@@ -1774,11 +1789,10 @@ std::optional<std::string> PeerManagerImpl::FetchBlock(NodeId peer_id, const CBl\n \n     LOCK(cs_main);\n \n-    // Mark block as in-flight unless it already is (for this peer).\n-    // If the peer does not send us a block, vBlocksInFlight remains non-empty,\n-    // causing us to timeout and disconnect.\n-    // If a block was already in-flight for a different peer, its BLOCKTXN\n-    // response will be dropped.\n+    // Forget about all prior requests\n+    RemoveBlockRequest(block_index.GetBlockHash(), std::nullopt);\n+\n+    // Mark block as in-flight",
      "path": "src/net_processing.cpp",
      "position": 192,
      "original_position": 98,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "03423f8bd12b95a06a4a9d8377e781625dd38aae",
      "in_reply_to_id": 1204478988,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "That was already the case. The comment is there to point out that the current request will result in a disconnect (unless a new request is made on time).",
      "created_at": "2023-05-24T17:45:00Z",
      "updated_at": "2023-05-24T17:45:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1204563081",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204563081"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1795,
      "original_line": 1795,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204590378",
      "pull_request_review_id": 1442494494,
      "id": 1204590378,
      "node_id": "PRRC_kwDOABII585HzJcq",
      "diff_hunk": "@@ -4343,11 +4360,16 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     Misbehaving(*peer, 100, \"invalid compact block\");\n                     return;\n                 } else if (status == READ_STATUS_FAILED) {\n-                    // Duplicate txindexes, the block is now in-flight, so just request it\n-                    std::vector<CInv> vInv(1);\n-                    vInv[0] = CInv(MSG_BLOCK | GetFetchFlags(*peer), blockhash);\n-                    m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETDATA, vInv));\n-                    return;\n+                    if (first_in_flight)  {\n+                        // Duplicate txindexes, the block is now in-flight, so just request it\n+                        std::vector<CInv> vInv(1);\n+                        vInv[0] = CInv(MSG_BLOCK | GetFetchFlags(*peer), blockhash);\n+                        m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETDATA, vInv));\n+                        return;\n+                    } else {\n+                        // Give up for this peer and wait for other peer(s)\n+                        RemoveBlockRequest(pindex->GetBlockHash(), pfrom.GetId());",
      "path": "src/net_processing.cpp",
      "position": 273,
      "original_position": 166,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "03423f8bd12b95a06a4a9d8377e781625dd38aae",
      "in_reply_to_id": 1204491894,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "#27743",
      "created_at": "2023-05-24T18:09:53Z",
      "updated_at": "2023-05-24T18:09:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1204590378",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1204590378"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4371,
      "original_line": 4371,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1207968175",
      "pull_request_review_id": 1447376491,
      "id": 1207968175,
      "node_id": "PRRC_kwDOABII585IACGv",
      "diff_hunk": "@@ -4361,9 +4383,24 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     txn.blockhash = blockhash;\n                     blockTxnMsg << txn;\n                     fProcessBLOCKTXN = true;\n-                } else {\n+                } else if (first_in_flight) {\n+                    // We will try to round-trip any compact blocks we get on failure,\n+                    // as long as it's first...\n+                    req.blockhash = pindex->GetBlockHash();\n+                    m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::GETBLOCKTXN, req));\n+                } else if (pfrom.m_bip152_highbandwidth_to &&\n+                    (!pfrom.IsInboundConn() ||\n+                    IsBlockRequestedFromOutbound(blockhash) ||\n+                    already_in_flight < MAX_CMPCTBLOCKS_INFLIGHT_PER_BLOCK - 1)) {",
      "path": "src/net_processing.cpp",
      "position": 291,
      "original_position": 184,
      "commit_id": "d7f359b35e8b1e9acc4d397de262cd9ba9bbcb83",
      "original_commit_id": "03423f8bd12b95a06a4a9d8377e781625dd38aae",
      "in_reply_to_id": 1204497452,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`> 0` is fine too, but I guess nobody will this to zero accidentally.",
      "created_at": "2023-05-27T13:18:32Z",
      "updated_at": "2023-05-27T13:18:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27626#discussion_r1207968175",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1207968175"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4394,
      "original_line": 4394,
      "side": "RIGHT"
    }
  ]
}