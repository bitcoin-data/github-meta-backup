{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952",
    "id": 917166280,
    "node_id": "PR_kwDOABII5842qtjI",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/24952",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/24952.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/24952.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/c5506ac2988469d4961af27f20b0f6fc887b179d",
    "number": 24952,
    "state": "closed",
    "locked": false,
    "maintainer_can_modify": false,
    "title": "rpc: Add sqlite format option for dumptxoutset",
    "user": {
      "login": "dunxen",
      "id": 3072149,
      "node_id": "MDQ6VXNlcjMwNzIxNDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dunxen",
      "html_url": "https://github.com/dunxen",
      "followers_url": "https://api.github.com/users/dunxen/followers",
      "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
      "organizations_url": "https://api.github.com/users/dunxen/orgs",
      "repos_url": "https://api.github.com/users/dunxen/repos",
      "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/dunxen/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This allows RPC users of the `dumptxoutset` command to output to a SQLite DB format with human-readable fields.\r\nThis approach allows for trivial export to JSON and CSV by using `sqlite3` (detailed in #24628).\r\n\r\nThere is a new optional 'format' parameter for `dumptxoutset` that can take on the values of either 'compact' or 'sqlite'\r\nwith 'compact' as the default. This allows for backward compatibility.\r\n\r\nCloses #24628",
    "labels": [
      {
        "id": 98279177,
        "node_id": "MDU6TGFiZWw5ODI3OTE3Nw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ",
        "name": "RPC/REST/ZMQ",
        "color": "0052cc",
        "default": false
      },
      {
        "id": 955867938,
        "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
        "name": "Needs rebase",
        "description": "",
        "color": "cccccc",
        "default": false
      }
    ],
    "created_at": "2022-04-23T09:30:43Z",
    "updated_at": "2022-11-10T17:15:28Z",
    "closed_at": "2022-11-10T17:15:27Z",
    "mergeable": false,
    "mergeable_state": "dirty",
    "merge_commit_sha": "a9678a3367003dcc77372256c907bfb8810f0b2c",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": false,
    "head": {
      "label": "dunxen:2022-04-sqlite-dumptxoutset",
      "ref": "2022-04-sqlite-dumptxoutset",
      "sha": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 273975057,
        "node_id": "MDEwOlJlcG9zaXRvcnkyNzM5NzUwNTc=",
        "name": "bitcoin",
        "full_name": "dunxen/bitcoin",
        "owner": {
          "login": "dunxen",
          "id": 3072149,
          "node_id": "MDQ6VXNlcjMwNzIxNDk=",
          "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/dunxen",
          "html_url": "https://github.com/dunxen",
          "followers_url": "https://api.github.com/users/dunxen/followers",
          "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
          "organizations_url": "https://api.github.com/users/dunxen/orgs",
          "repos_url": "https://api.github.com/users/dunxen/repos",
          "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/dunxen/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/dunxen/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/dunxen/bitcoin",
        "archive_url": "https://api.github.com/repos/dunxen/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/dunxen/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/dunxen/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/dunxen/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/dunxen/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/dunxen/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/dunxen/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/dunxen/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/dunxen/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/dunxen/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/dunxen/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/dunxen/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/dunxen/bitcoin/events",
        "forks_url": "https://api.github.com/repos/dunxen/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/dunxen/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/dunxen/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/dunxen/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/dunxen/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/dunxen/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/dunxen/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/dunxen/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/dunxen/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/dunxen/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/dunxen/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/dunxen/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/dunxen/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/dunxen/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/dunxen/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/dunxen/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:dunxen/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/dunxen/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/dunxen/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/dunxen/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/dunxen/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/dunxen/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/dunxen/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/dunxen/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/dunxen/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/dunxen/bitcoin/hooks",
        "svn_url": "https://github.com/dunxen/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 0,
        "watchers_count": 0,
        "size": 201098,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2022-05-17T14:41:54Z",
        "created_at": "2020-06-21T20:01:25Z",
        "updated_at": "2022-04-22T20:59:13Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "29d540b7ada890dd588c4825d40c27c5e6f20061",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 34324,
        "stargazers_count": 69819,
        "watchers_count": 69819,
        "size": 233879,
        "default_branch": "master",
        "open_issues_count": 627,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-07T05:35:10Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-06-07T04:47:18Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 234,
    "deletions": 28,
    "changed_files": 7,
    "commits": 2,
    "review_comments": 43,
    "comments": 42
  },
  "events": [
    {
      "event": "commented",
      "id": 1107441666,
      "node_id": "IC_kwDOABII585CAjgC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1107441666",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-23T09:33:57Z",
      "updated_at": "2022-04-23T09:33:57Z",
      "author_association": "CONTRIBUTOR",
      "body": "Some basic timings for mainnet on my (admittedly not so amazing iMac), comparing to the existing compact format.\r\n\r\n## Time\r\n<img width=\"628\" alt=\"Screenshot 2022-04-23 at 09 09 57\" src=\"https://user-images.githubusercontent.com/3072149/164888919-ee4e8e8a-de15-41cb-8a71-9722c19208ed.png\">\r\n\r\n## Size\r\n<img width=\"324\" alt=\"Screenshot 2022-04-23 at 09 10 31\" src=\"https://user-images.githubusercontent.com/3072149/164888920-33c25d2b-e1a6-45b2-9f21-965f2aeab691.png\">\r\n\r\n---\r\n\r\nRoughly around twice as long and twice as big.\r\n",
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1107441666",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "reviewed",
      "id": 950948827,
      "node_id": "PRR_kwDOABII5844rlPb",
      "url": null,
      "actor": null,
      "commit_id": "eaa4e63dac2bfd32a6457f6bea1dd3d81b0e77ec",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#pullrequestreview-950948827",
      "submitted_at": "2022-04-23T09:36:01Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
    },
    {
      "event": "labeled",
      "id": 6483871651,
      "node_id": "LE_lADOABII585IUMv_zwAAAAGCeAej",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6483871651",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-23T09:51:05Z",
      "label": {
        "name": "RPC/REST/ZMQ",
        "color": "0052cc"
      }
    },
    {
      "event": "commented",
      "id": 1107706464,
      "node_id": "IC_kwDOABII585CBkJg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1107706464",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-24T04:21:13Z",
      "updated_at": "2022-05-24T00:03:15Z",
      "author_association": "MEMBER",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25191](https://github.com/bitcoin/bitcoin/pull/25191) (build: Make `--with-gui=qt6` configure option available on macOS by hebasto)\n* [#24923](https://github.com/bitcoin/bitcoin/pull/24923) (Rework logging timer by MarcoFalke)\n* [#24798](https://github.com/bitcoin/bitcoin/pull/24798) ([POC] build: Hello Qt 6 by hebasto)\n* [#24410](https://github.com/bitcoin/bitcoin/pull/24410) ([kernel 2a/n] Split hashing/index `GetUTXOStats` codepaths, decouple from `coinstatsindex` by dongcarl)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1107706464",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "reviewed",
      "id": 951166654,
      "node_id": "PRR_kwDOABII5844saa-",
      "url": null,
      "actor": null,
      "commit_id": "eaa4e63dac2bfd32a6457f6bea1dd3d81b0e77ec",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "0xB10C",
        "id": 19157360,
        "node_id": "MDQ6VXNlcjE5MTU3MzYw",
        "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/0xB10C",
        "html_url": "https://github.com/0xB10C",
        "followers_url": "https://api.github.com/users/0xB10C/followers",
        "following_url": "https://api.github.com/users/0xB10C/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/0xB10C/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/0xB10C/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
        "organizations_url": "https://api.github.com/users/0xB10C/orgs",
        "repos_url": "https://api.github.com/users/0xB10C/repos",
        "events_url": "https://api.github.com/users/0xB10C/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/0xB10C/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#pullrequestreview-951166654",
      "submitted_at": "2022-04-24T07:55:11Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 6485717824,
      "node_id": "HRFPE_lADOABII585IUMv_zwAAAAGClDNA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6485717824",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-24T11:16:55Z"
    },
    {
      "event": "reviewed",
      "id": 951174036,
      "node_id": "PRR_kwDOABII5844scOU",
      "url": null,
      "actor": null,
      "commit_id": "21ee90dda3daed0bc3d7063dfc2118537df08273",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "",
      "user": {
        "login": "prusnak",
        "id": 42201,
        "node_id": "MDQ6VXNlcjQyMjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/prusnak",
        "html_url": "https://github.com/prusnak",
        "followers_url": "https://api.github.com/users/prusnak/followers",
        "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
        "organizations_url": "https://api.github.com/users/prusnak/orgs",
        "repos_url": "https://api.github.com/users/prusnak/repos",
        "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/prusnak/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#pullrequestreview-951174036",
      "submitted_at": "2022-04-24T11:30:34Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
    },
    {
      "event": "reviewed",
      "id": 951192349,
      "node_id": "PRR_kwDOABII5844sgsd",
      "url": null,
      "actor": null,
      "commit_id": "21ee90dda3daed0bc3d7063dfc2118537df08273",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "prusnak",
        "id": 42201,
        "node_id": "MDQ6VXNlcjQyMjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/prusnak",
        "html_url": "https://github.com/prusnak",
        "followers_url": "https://api.github.com/users/prusnak/followers",
        "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
        "organizations_url": "https://api.github.com/users/prusnak/orgs",
        "repos_url": "https://api.github.com/users/prusnak/repos",
        "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/prusnak/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#pullrequestreview-951192349",
      "submitted_at": "2022-04-24T11:34:06Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
    },
    {
      "event": "reviewed",
      "id": 951192636,
      "node_id": "PRR_kwDOABII5844sgw8",
      "url": null,
      "actor": null,
      "commit_id": "21ee90dda3daed0bc3d7063dfc2118537df08273",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "prusnak",
        "id": 42201,
        "node_id": "MDQ6VXNlcjQyMjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/prusnak",
        "html_url": "https://github.com/prusnak",
        "followers_url": "https://api.github.com/users/prusnak/followers",
        "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
        "organizations_url": "https://api.github.com/users/prusnak/orgs",
        "repos_url": "https://api.github.com/users/prusnak/repos",
        "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/prusnak/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#pullrequestreview-951192636",
      "submitted_at": "2022-04-24T11:36:30Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
    },
    {
      "event": "commented",
      "id": 1107823511,
      "node_id": "IC_kwDOABII585CCAuX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1107823511",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-24T11:40:32Z",
      "updated_at": "2022-04-24T19:02:14Z",
      "author_association": "CONTRIBUTOR",
      "body": "~~Some other failures related to string type conversions in Windows I'm not so familiar with here. Will have a closer look when I'm back home.~~\r\n\r\nEDIT: Never mind. I can't read...",
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1107823511",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 6486219972,
      "node_id": "HRFPE_lADOABII585IUMv_zwAAAAGCm9zE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6486219972",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-24T18:47:02Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 6486225697,
      "node_id": "HRFPE_lADOABII585IUMv_zwAAAAGCm_Mh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6486225697",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-24T18:52:27Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 6486275332,
      "node_id": "HRFPE_lADOABII585IUMv_zwAAAAGCnLUE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6486275332",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-24T19:34:14Z"
    },
    {
      "event": "reviewed",
      "id": 951249602,
      "node_id": "PRR_kwDOABII5844surC",
      "url": null,
      "actor": null,
      "commit_id": "889f6c719dbd2bca5f38a6a5a89f39fb4639558f",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "tACK 889f6c719dbd2bca5f38a6a5a89f39fb4639558f. Manually inspected a few random rows from the first 100 in the outputted db, which looked good. I left a few additional comments inline.\r\n\r\nI also see twice the time and speed on my side: \r\n\r\n<img width=\"1274\" alt=\"Screenshot 2022-04-24 at 20 55 09\" src=\"https://user-images.githubusercontent.com/6606587/164997310-d941fc08-f414-4968-bc41-465d0e83487e.png\">\r\n",
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#pullrequestreview-951249602",
      "submitted_at": "2022-04-24T21:38:39Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
    },
    {
      "event": "reviewed",
      "id": 951291562,
      "node_id": "PRR_kwDOABII5844s46q",
      "url": null,
      "actor": null,
      "commit_id": "889f6c719dbd2bca5f38a6a5a89f39fb4639558f",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "tACK 889f6c7",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#pullrequestreview-951291562",
      "submitted_at": "2022-04-25T02:24:24Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
    },
    {
      "event": "reviewed",
      "id": 951459500,
      "node_id": "PRR_kwDOABII5844th6s",
      "url": null,
      "actor": null,
      "commit_id": "889f6c719dbd2bca5f38a6a5a89f39fb4639558f",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "",
      "user": {
        "login": "prusnak",
        "id": 42201,
        "node_id": "MDQ6VXNlcjQyMjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/prusnak",
        "html_url": "https://github.com/prusnak",
        "followers_url": "https://api.github.com/users/prusnak/followers",
        "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
        "organizations_url": "https://api.github.com/users/prusnak/orgs",
        "repos_url": "https://api.github.com/users/prusnak/repos",
        "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/prusnak/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#pullrequestreview-951459500",
      "submitted_at": "2022-04-25T07:43:48Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 6489245571,
      "node_id": "HRFPE_lADOABII585IUMv_zwAAAAGCygeD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6489245571",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-25T10:24:41Z"
    },
    {
      "event": "reviewed",
      "id": 951640797,
      "node_id": "PRR_kwDOABII5844uOLd",
      "url": null,
      "actor": null,
      "commit_id": "2d95dbb489ba32d4965dd42e87d9e899bd52a01d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Approach ACK",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#pullrequestreview-951640797",
      "submitted_at": "2022-04-25T10:35:27Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 6490715148,
      "node_id": "HRFPE_lADOABII585IUMv_zwAAAAGC4HQM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6490715148",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-25T13:54:59Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 6490812098,
      "node_id": "HRFPE_lADOABII585IUMv_zwAAAAGC4e7C",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6490812098",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-25T14:07:02Z"
    },
    {
      "event": "reviewed",
      "id": 952102140,
      "node_id": "PRR_kwDOABII5844v-z8",
      "url": null,
      "actor": null,
      "commit_id": "2d95f24c358cfea7bd7cb11c14e26954560c651d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Concept ACK\r\n\r\nI first thought creating an external tool to convert from compact-serialized format to SQLite was a viable alternative to implement this directly in bitcoind, but it turned out to be bad idea; one of the reasons is that the decompression logic has to be implemented again, which in one part even needs secp256k1 (https://github.com/bitcoin/bitcoin/issues/24628#issuecomment-1108469715).\r\n\r\nSome initial thoughts:\r\n- Is there any reason why we store prevoutHash and scriptPubKey with type TEXT rather than a BLOB? Using the latter should reduce the size of the resulting database by almost 2x, and SQLite supports `select hex(column)` in case the hex representation is needed by the user\r\n- Not sure if it helps in this scenario or is worthy to investigate, but in some cases I've made good experiences by tuning the `cache_size` parameter (https://www.sqlite.org/pragma.html#pragma_cache_size) in order to have less frequent writes (the default is 2 MB)",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#pullrequestreview-952102140",
      "submitted_at": "2022-04-25T15:51:18Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
    },
    {
      "event": "commented",
      "id": 1108758629,
      "node_id": "IC_kwDOABII585CFlBl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1108758629",
      "actor": {
        "login": "prusnak",
        "id": 42201,
        "node_id": "MDQ6VXNlcjQyMjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/prusnak",
        "html_url": "https://github.com/prusnak",
        "followers_url": "https://api.github.com/users/prusnak/followers",
        "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
        "organizations_url": "https://api.github.com/users/prusnak/orgs",
        "repos_url": "https://api.github.com/users/prusnak/repos",
        "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/prusnak/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-25T16:00:50Z",
      "updated_at": "2022-04-25T16:06:33Z",
      "author_association": "CONTRIBUTOR",
      "body": "> * Is there any reason why we store prevoutHash and scriptPubKey with type TEXT rather than a BLOB?\r\n\r\nOne of the goals of this change is to enable trivial creation of JSON/CSV files with the data. This can be achieved simply by using one of the following:\r\n\r\n* `sqlite3 -header -csv utxo.db \"SELECT * FROM utxos\" > utxo.csv`\r\n* `sqlite3 -json utxo.db \"SELECT * FROM utxos\" > utxo.json`\r\n\r\nIf BLOB was used instead of hex stored in TEXT, this conversion step could not have been done trivially as one would have to specify a more complex SQL query such as:\r\n\r\n`SELECT hex(txid), vout, value, coinbase, height, hex(scriptpubkey) FROM utxos`\r\n\r\nHowever, it might still be worth a shot to require more complicated SQL query if we really gain 2x the performance and decrease the disk space to 50%.",
      "user": {
        "login": "prusnak",
        "id": 42201,
        "node_id": "MDQ6VXNlcjQyMjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/prusnak",
        "html_url": "https://github.com/prusnak",
        "followers_url": "https://api.github.com/users/prusnak/followers",
        "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
        "organizations_url": "https://api.github.com/users/prusnak/orgs",
        "repos_url": "https://api.github.com/users/prusnak/repos",
        "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/prusnak/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1108758629",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "commented",
      "id": 1108765388,
      "node_id": "IC_kwDOABII585CFmrM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1108765388",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-25T16:06:42Z",
      "updated_at": "2022-04-25T16:06:42Z",
      "author_association": "CONTRIBUTOR",
      "body": "> - Not sure if it helps in this scenario or is worthy to investigate, but in some cases I've made good experiences by tuning the `cache_size` parameter (https://www.sqlite.org/pragma.html#pragma_cache_size) in order to have less frequent writes (the default is 2 MB)\n\nThanks! I'm happy to investigate tuning this. We're currently roughly getting it to be double the time of a compact dump.\n",
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1108765388",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "commented",
      "id": 1108768814,
      "node_id": "IC_kwDOABII585CFngu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1108768814",
      "actor": {
        "login": "prusnak",
        "id": 42201,
        "node_id": "MDQ6VXNlcjQyMjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/prusnak",
        "html_url": "https://github.com/prusnak",
        "followers_url": "https://api.github.com/users/prusnak/followers",
        "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
        "organizations_url": "https://api.github.com/users/prusnak/orgs",
        "repos_url": "https://api.github.com/users/prusnak/repos",
        "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/prusnak/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-25T16:09:36Z",
      "updated_at": "2022-04-25T16:09:53Z",
      "author_association": "CONTRIBUTOR",
      "body": "> We're currently roughly getting it to be double the time of a compact dump.\r\n\r\nI think you can't get much better than this. You are writing approx 2x the data (because of hex representation of `txid` and `scriptpubkey` and my guess is that the whole operation is I/O bound and not CPU bound.\r\n\r\nIMO the only way how to make the process fast is to use BLOB type as suggested by @theStack above at the expense of requiring more complex query when working with the data.",
      "user": {
        "login": "prusnak",
        "id": 42201,
        "node_id": "MDQ6VXNlcjQyMjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/prusnak",
        "html_url": "https://github.com/prusnak",
        "followers_url": "https://api.github.com/users/prusnak/followers",
        "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
        "organizations_url": "https://api.github.com/users/prusnak/orgs",
        "repos_url": "https://api.github.com/users/prusnak/repos",
        "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/prusnak/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1108768814",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "mentioned",
      "id": 6491814293,
      "node_id": "MEE_lADOABII585IUMv_zwAAAAGC8TmV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6491814293",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-25T16:09:36Z"
    },
    {
      "event": "subscribed",
      "id": 6491814302,
      "node_id": "SE_lADOABII585IUMv_zwAAAAGC8Tme",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6491814302",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-25T16:09:36Z"
    },
    {
      "event": "commented",
      "id": 1108770480,
      "node_id": "IC_kwDOABII585CFn6w",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1108770480",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-25T16:10:59Z",
      "updated_at": "2022-04-25T16:10:59Z",
      "author_association": "CONTRIBUTOR",
      "body": "> However, it might still be worth a shot to require more complicated SQL query if we really gain 2x the performance and decrease the disk space to 50%.\n\nI think that's a fair trade-off. Also should not be all that more complicated of a query.\n\n",
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1108770480",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "commented",
      "id": 1108794823,
      "node_id": "IC_kwDOABII585CFt3H",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1108794823",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-25T16:34:57Z",
      "updated_at": "2022-04-25T16:34:57Z",
      "author_association": "MEMBER",
      "body": "@prusnak: Thanks for elaborating, easy conversion to CSV/JSON etc. makes sense!\r\n\r\nOne thing that has to be taken care of is the endianness of the txid hash. Unfortunately Bitcoin displays (and accepts, in case of user input for RPCs) txids and block hashes as little endian, but they are stored internally as big endian: https://bitcoin.stackexchange.com/a/2069\r\nThat means, if we decide to store in TEXT, then the txid has already the typical form as we know them from wallets, block explorers, debug outputs etc. (`hash.GetHex()` takes care of that), but on the other hand if we want to use that prevout for e.g. constructing a transaction in a raw byte-by-byte way, then it would need to be reversed first.\r\nIf we store it as a BLOB though, it has the internal big endian format, but `hex(txid)` doesn't show it in the right way, as it would need to be reversed first. Unfortunately, there is no built-in \"reverse\" operator in SQLite :/ If there was, we could simply do something like the following for the conversion script:\r\n`SELECT hex(reverse(txid)), vout, value, coinbase, height, hex(scriptpubkey) FROM utxos`\r\n\r\n(For the scriptPubKey, there is no such endianness problem as it is simply a sequence of bytes)\r\n\r\nSo as far as I can see, we have to decide between either easy-conversion or ~2x performance / 50% size (though the latter is still just an assumption). One possible idea would be to store the BLOB already reversed, but this is kind of a something in-between solution that possibly is even more confusing for users.",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1108794823",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "mentioned",
      "id": 6492009466,
      "node_id": "MEE_lADOABII585IUMv_zwAAAAGC9DP6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6492009466",
      "actor": {
        "login": "prusnak",
        "id": 42201,
        "node_id": "MDQ6VXNlcjQyMjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/prusnak",
        "html_url": "https://github.com/prusnak",
        "followers_url": "https://api.github.com/users/prusnak/followers",
        "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
        "organizations_url": "https://api.github.com/users/prusnak/orgs",
        "repos_url": "https://api.github.com/users/prusnak/repos",
        "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/prusnak/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-25T16:34:57Z"
    },
    {
      "event": "subscribed",
      "id": 6492009472,
      "node_id": "SE_lADOABII585IUMv_zwAAAAGC9DQA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6492009472",
      "actor": {
        "login": "prusnak",
        "id": 42201,
        "node_id": "MDQ6VXNlcjQyMjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/prusnak",
        "html_url": "https://github.com/prusnak",
        "followers_url": "https://api.github.com/users/prusnak/followers",
        "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
        "organizations_url": "https://api.github.com/users/prusnak/orgs",
        "repos_url": "https://api.github.com/users/prusnak/repos",
        "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/prusnak/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-25T16:34:57Z"
    },
    {
      "event": "reviewed",
      "id": 952573290,
      "node_id": "PRR_kwDOABII5844xx1q",
      "url": null,
      "actor": null,
      "commit_id": "2d95f24c358cfea7bd7cb11c14e26954560c651d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Concept ACK",
      "user": {
        "login": "brunoerg",
        "id": 19480819,
        "node_id": "MDQ6VXNlcjE5NDgwODE5",
        "avatar_url": "https://avatars.githubusercontent.com/u/19480819?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/brunoerg",
        "html_url": "https://github.com/brunoerg",
        "followers_url": "https://api.github.com/users/brunoerg/followers",
        "following_url": "https://api.github.com/users/brunoerg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/brunoerg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/brunoerg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/brunoerg/subscriptions",
        "organizations_url": "https://api.github.com/users/brunoerg/orgs",
        "repos_url": "https://api.github.com/users/brunoerg/repos",
        "events_url": "https://api.github.com/users/brunoerg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/brunoerg/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#pullrequestreview-952573290",
      "submitted_at": "2022-04-26T00:21:03Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
    },
    {
      "event": "reviewed",
      "id": 952583827,
      "node_id": "PRR_kwDOABII5844x0aT",
      "url": null,
      "actor": null,
      "commit_id": "2d95f24c358cfea7bd7cb11c14e26954560c651d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "brunoerg",
        "id": 19480819,
        "node_id": "MDQ6VXNlcjE5NDgwODE5",
        "avatar_url": "https://avatars.githubusercontent.com/u/19480819?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/brunoerg",
        "html_url": "https://github.com/brunoerg",
        "followers_url": "https://api.github.com/users/brunoerg/followers",
        "following_url": "https://api.github.com/users/brunoerg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/brunoerg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/brunoerg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/brunoerg/subscriptions",
        "organizations_url": "https://api.github.com/users/brunoerg/orgs",
        "repos_url": "https://api.github.com/users/brunoerg/repos",
        "events_url": "https://api.github.com/users/brunoerg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/brunoerg/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#pullrequestreview-952583827",
      "submitted_at": "2022-04-26T00:46:01Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
    },
    {
      "event": "reviewed",
      "id": 952585250,
      "node_id": "PRR_kwDOABII5844x0wi",
      "url": null,
      "actor": null,
      "commit_id": "2d95f24c358cfea7bd7cb11c14e26954560c651d",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "re-ACK https://github.com/bitcoin/bitcoin/pull/24952/commits/2d95f24c358cfea7bd7cb11c14e26954560c651d",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#pullrequestreview-952585250",
      "submitted_at": "2022-04-26T00:49:10Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
    },
    {
      "event": "commented",
      "id": 1109449844,
      "node_id": "IC_kwDOABII585CINx0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1109449844",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-26T07:33:25Z",
      "updated_at": "2022-04-26T07:33:25Z",
      "author_association": "CONTRIBUTOR",
      "body": "So I did try with blobs and managed to get the db down from 11 GB to 7 GB (about 2 GB more than the compact format). There was only really around a 15% increase in performance for me (but I possibly have other bottlenecks on my machine).",
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1109449844",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "commented",
      "id": 1109701021,
      "node_id": "IC_kwDOABII585CJLGd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1109701021",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-26T11:52:27Z",
      "updated_at": "2022-04-26T11:53:06Z",
      "author_association": "MEMBER",
      "body": "> So I did try with blobs and managed to get the db down from 11 GB to 7 GB (about 2 GB more than the compact format). There was only really around a 15% increase in performance for me (but I possibly have other bottlenecks on my machine).\r\n\r\nThanks for testing. Considering these results, it seems more reasonable to store the txid-hashes as text (like it is done currently in the PR), in order to have an easy conversion. Two more thoughts:\r\n- The compact-serialized output contains metadata, namely the blockhash of the snapshot and the number of UTXOs. Should we also at least include the blockhash (possibly also block height)? I think the SQLite output shouldn't contain _less_ information than the old format. (Storing the number of UTXOs seems unnecessary though, as it can simply be determined by `select count(*) from utxos`).\r\n- Do we want to add indices in the course of the conversion, or is that left to the user? Right now, the potential of having the UTXOs in a database is not fully unleashed, since it would still need to linearly search through all ~80 million rows. An index on nValue, nHeight and scriptPubKey probably would make sense, in order to quickly yield results e.g. for UTXOs with a certain amount or block range. Personally I don't have experience with indices on the TEXT type, but I believe this would help for quickly getting UTXOs with certain output types, e.g. one could query all P2WPKH coins by searching on scriptPubKeys with a prefix of `0014`.",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1109701021",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "commented",
      "id": 1109787611,
      "node_id": "IC_kwDOABII585CJgPb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1109787611",
      "actor": {
        "login": "prusnak",
        "id": 42201,
        "node_id": "MDQ6VXNlcjQyMjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/prusnak",
        "html_url": "https://github.com/prusnak",
        "followers_url": "https://api.github.com/users/prusnak/followers",
        "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
        "organizations_url": "https://api.github.com/users/prusnak/orgs",
        "repos_url": "https://api.github.com/users/prusnak/repos",
        "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/prusnak/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-26T13:18:46Z",
      "updated_at": "2022-04-26T13:18:46Z",
      "author_association": "CONTRIBUTOR",
      "body": "> * The compact-serialized output contains metadata,\r\n\r\nWe can create another table called `metadata` with `blockhash` and `blockheight` columns.\r\n\r\n> * Do we want to add indices in the course of the conversion\r\n\r\nI don't think we want to push indices on all users that want this feature. They can still create indices afterwards via `sqlite3 utxo.db \"CREATE INDEX idx_script ON utxo(scriptpubkey)\"`",
      "user": {
        "login": "prusnak",
        "id": 42201,
        "node_id": "MDQ6VXNlcjQyMjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/prusnak",
        "html_url": "https://github.com/prusnak",
        "followers_url": "https://api.github.com/users/prusnak/followers",
        "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
        "organizations_url": "https://api.github.com/users/prusnak/orgs",
        "repos_url": "https://api.github.com/users/prusnak/repos",
        "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/prusnak/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1109787611",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "commented",
      "id": 1109817440,
      "node_id": "IC_kwDOABII585CJnhg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1109817440",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-26T13:45:00Z",
      "updated_at": "2022-04-26T13:45:00Z",
      "author_association": "CONTRIBUTOR",
      "body": "> I don't think we want to push indices on all users that want this feature. They can still create indices afterwards via `sqlite3 utxo.db \"CREATE INDEX idx_script ON utxo(scriptpubkey)\"`\n\nI can maybe check the extra resource requirements and we can have a clearer picture on whether it would be worth it? The one thing is that without any indices then a simple `SELECT COUNT(*) FROM utxos` takes a while. Of course, it is a ROWID table so doing `SELECT MAX(rowid) FROM utxos` is constant time and works out the box. \n\nOtherwise, happy to keep indices out of it. I'll create the `metadata` table in my next push.",
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1109817440",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "commented",
      "id": 1110206522,
      "node_id": "IC_kwDOABII585CLGg6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1110206522",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-26T20:13:53Z",
      "updated_at": "2022-04-26T20:14:48Z",
      "author_association": "CONTRIBUTOR",
      "body": "> I can maybe check the extra resource requirements and we can have a clearer picture on whether it would be worth it? The one thing is that without any indices then a simple `SELECT COUNT(*) FROM utxos` takes a while. Of course, it is a ROWID table so doing `SELECT MAX(rowid) FROM utxos` is constant time and works out the box.\r\n\r\nSo dumping with indices will take _significantly_ longer. On my iMac it takes longer than the default `rpcclienttimeout` (so I have to disable timeout). The index for the `height` column alone adds about 1 GB to the overall size (but this is not really the main issue).\r\n\r\nI think it's fair to leave it to the user to create the indices they are most interested in. For now I think I'll just push the `metadata` table and test changes and then we can decide from there.\r\n\r\n",
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1110206522",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 6501790999,
      "node_id": "HRFPE_lADOABII585IUMv_zwAAAAGDiXUX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6501790999",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-26T20:26:35Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 6501837737,
      "node_id": "HRFPE_lADOABII585IUMv_zwAAAAGDiiup",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6501837737",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-26T20:35:10Z"
    },
    {
      "event": "reviewed",
      "id": 956290477,
      "node_id": "PRR_kwDOABII5844_9Wt",
      "url": null,
      "actor": null,
      "commit_id": "39c392af35b22807ca53cbe3b9218bc055236ccd",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "> I don't think we want to push indices on all users that want this feature. They can still create indices afterwards via sqlite3 utxo.db \"CREATE INDEX idx_script ON utxo(scriptpubkey)\"\r\n\r\nAgreed, seems to be the right decision to not create any indices and leave that up to the user, considering the significant performance loss for dumping.\r\n\r\nDid some testing and everything seems to work fine so far. Creating the SQLite format takes a little more than 2x longer than the compact-serialized format on my machine, but that's not really surprising and actually quite okay I would say, considering one gets a nice database format.\r\n```\r\n$ time ./src/bitcoin-cli dumptxoutset utxo.dat\r\n{\r\n  \"coins_written\": 81976086,\r\n  \"base_hash\": \"00000000000000000004f5b8fa74921f24ac154e2725f7cdc8b0542568064308\",\r\n  \"base_height\": 733945,\r\n  \"path\": \"/home/honeybadger/.bitcoin/utxo.dat\",\r\n  \"txoutset_hash\": \"5b6936caddd3fa8e5e9ef55843c4d8cf5069ad3e56e415f963776f06fdc097c7\",\r\n  \"nchaintx\": 729190514\r\n}\r\n\r\nreal    4m13.964s\r\nuser    0m0.001s\r\nsys     0m0.004s\r\n```\r\n\r\n```\r\n$ time ./src/bitcoin-cli dumptxoutset utxo.sqlite sqlite\r\n{\r\n  \"coins_written\": 81976086,\r\n  \"base_hash\": \"00000000000000000004f5b8fa74921f24ac154e2725f7cdc8b0542568064308\",\r\n  \"base_height\": 733945,\r\n  \"path\": \"/home/honeybadger/.bitcoin/utxo.sqlite\",\r\n  \"txoutset_hash\": \"5b6936caddd3fa8e5e9ef55843c4d8cf5069ad3e56e415f963776f06fdc097c7\",\r\n  \"nchaintx\": 729190514\r\n}\r\n\r\nreal    9m17.225s\r\nuser    0m0.003s\r\nsys     0m0.002s\r\n```\r\nSome playing around with the database in the SQLite interpreter. Of the few queries I tried, only `select(*) from utxos` took terribly long (actually longer than the time needed to _create_ the database!), so `select max(rowid) from utxos` definitely is the better alternative here (works only as long as no rows have been deleted though):\r\n```\r\n$ sqlite3 ~/.bitcoin/utxo.sqlite\r\nSQLite version 3.38.2 2022-03-26 13:51:10\r\nEnter \".help\" for usage hints.\r\nsqlite> .headers on\r\nsqlite> .mode column\r\nsqlite> .timer on\r\nsqlite>\r\nsqlite> select * from metadata;\r\nblockhash                                                     blockheight\r\n------------------------------------------------------------  -----------\r\n00000000000000000004f5b8fa74921f24ac154e2725f7cdc8b054256806  733945\r\n4308\r\nRun Time: real 0.000 user 0.000483 sys 0.000000\r\n\r\nsqlite> select count(*) from utxos;\r\ncount(*)\r\n--------\r\n81976086\r\nRun Time: real 721.525 user 2.416016 sys 71.367933\r\n\r\nsqlite> .schema\r\nCREATE TABLE metadata(blockhash TEXT, blockheight INT);\r\nCREATE TABLE utxos(txid TEXT, vout INT, value INT, coinbase INT, height INT, scriptpubkey TEXT);\r\n\r\n\r\nsqlite> create index value_idx on utxos(value);\r\nRun Time: real 242.699 user 84.718367 sys 106.091081\r\n\r\nsqlite> select sum(value) from utxos;\r\nsum(value)\r\n----------------\r\n1902444842955153\r\n\r\nsqlite> select value, scriptpubkey from utxos where value = 666666666;\r\nvalue      scriptpubkey\r\n---------  --------------------------------------------------\r\n666666666  76a9149adfb7afb0d1727c30bd774b4c2a3bd30eda402b88ac\r\n666666666  0014874270f22e6e68c5f1bfdac7a1d2b10c55766b0d\r\n666666666  76a914292797f0e2e6d80902f34ec4743a31c0fb020dde88ac\r\nRun Time: real 0.002 user 0.000396 sys 0.000000\r\n\r\nsqlite> select count(*) from utxos where value = 100000000;\r\ncount(*)\r\n--------\r\n123871\r\nRun Time: real 0.007 user 0.004100 sys 0.002324\r\n\r\nsqlite> select max(rowid) from utxos;\r\nmax(rowid)\r\n----------\r\n81976086\r\nRun Time: real 0.002 user 0.000221 sys 0.000000\r\n\r\nsqlite> select height, count(*) as c from utxos group by height order by c desc limit 10;\r\nheight  c\r\n------  -----\r\n365056  18151\r\n506320  18017\r\n364809  17668\r\n365083  17636\r\n475099  17629\r\n364853  17558\r\n364882  17547\r\n364962  17221\r\n364798  16942\r\n364858  16835\r\nRun Time: real 7.230 user 6.362504 sys 0.577103\r\n```\r\nTIL that currently most of the entries in the UTXO set originated in block 365056 :)\r\n\r\nLeft two review comments below. I think this feature is nice enough to also deserve a small release note?",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#pullrequestreview-956290477",
      "submitted_at": "2022-04-28T12:04:39Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
    },
    {
      "event": "commented",
      "id": 1112422700,
      "node_id": "IC_kwDOABII585CTjks",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112422700",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-28T16:36:57Z",
      "updated_at": "2022-04-28T16:36:57Z",
      "author_association": "CONTRIBUTOR",
      "body": "> so `select max(rowid) from utxos` definitely is the better alternative here (works only as long as no rows have been deleted though)\r\n\r\nYes, the one caveat with that! Thanks for running a few nice examples :D",
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1112422700",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 6516740294,
      "node_id": "HRFPE_lADOABII585IUMv_zwAAAAGEbZDG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6516740294",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-28T16:48:08Z"
    },
    {
      "event": "commented",
      "id": 1112502316,
      "node_id": "IC_kwDOABII585CT3As",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112502316",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-28T17:56:42Z",
      "updated_at": "2022-04-28T17:56:42Z",
      "author_association": "MEMBER",
      "body": "Concept ACK. I was slightly surprised at first to see sqlite used as a format outside the wallet, but I think it makes sense, it's a flexible and efficient data format, all languages worth their salt have bindings for it, without need for writing custom parsers. We also don't need to introduce a new dependency which we'd have to for another compact format like BSON.\r\n\r\nWhat I wonder, does this need special handling in the build system? E.g. would this need some use-sqlite-but-no-wallet flag?\r\n\r\n> Agreed, seems to be the right decision to not create any indices and leave that up to the user, considering the significant performance loss for dumping.\r\n\r\nI agree. Not adding indices makes the RPC call less complex, and if you know when you're done putting data in a database, I would think it's more efficient to create the indices afterward (processing the data in one go) anyway.",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1112502316",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "commented",
      "id": 1112512241,
      "node_id": "IC_kwDOABII585CT5bx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112512241",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-28T18:08:28Z",
      "updated_at": "2022-04-28T18:08:42Z",
      "author_association": "CONTRIBUTOR",
      "body": "> What I wonder, does this need special handling in the build system? E.g. would this need some use-sqlite-but-no-wallet flag?\r\n\r\nAh, yes. This is a good point! `--with-sqlite`'s `auto` option just checks for wallet being enabled and sqlite being available. It might be weird for this functionality to work if wallet is enabled and then not working if it's disabled if `--with-sqlite=yes` is not passed.",
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1112512241",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "commented",
      "id": 1112515203,
      "node_id": "IC_kwDOABII585CT6KD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1112515203",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-28T18:12:02Z",
      "updated_at": "2022-04-28T18:12:02Z",
      "author_association": "CONTRIBUTOR",
      "body": "Also see I need to rebase and update `ValidAsCString()`: https://github.com/bitcoin/bitcoin/commit/fa7078d84fc2858a466bc1a85404f821df682538",
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1112515203",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 6517552182,
      "node_id": "HRFPE_lADOABII585IUMv_zwAAAAGEefQ2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6517552182",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-28T18:55:05Z"
    },
    {
      "event": "commented",
      "id": 1113118232,
      "node_id": "IC_kwDOABII585CWNYY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1113118232",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-29T09:43:36Z",
      "updated_at": "2022-04-29T09:43:36Z",
      "author_association": "MEMBER",
      "body": "@laanwj wrote:\r\n> What I wonder, does this need special handling in the build system? E.g. would this need some use-sqlite-but-no-wallet flag?\r\n\r\nI think we just need to document that this feature only works when compiled with the wallet or configured with Sqlite support. Inside `configure.ac` it would make sense to move `use_sqlite` outside of the wallet conditional:\r\n\r\n```\r\nif test \"$enable_wallet\" != \"no\"; then\r\n    echo \"    with sqlite   = $use_sqlite\"\r\n    echo \"    with bdb      = $use_bdb\"\r\nfi\r\n```",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1113118232",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "mentioned",
      "id": 6521749007,
      "node_id": "MEE_lADOABII585IUMv_zwAAAAGEuf4P",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6521749007",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-29T09:43:36Z"
    },
    {
      "event": "subscribed",
      "id": 6521749021,
      "node_id": "SE_lADOABII585IUMv_zwAAAAGEuf4d",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6521749021",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-29T09:43:36Z"
    },
    {
      "event": "referenced",
      "id": 6529692947,
      "node_id": "REFE_lADOABII585IUMv_zwAAAAGFMzUT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6529692947",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "bc23bd133f51eebfaca68405eac074e1e7025cc2",
      "commit_url": "https://api.github.com/repos/theStack/utxo_dump_tools/commits/bc23bd133f51eebfaca68405eac074e1e7025cc2",
      "created_at": "2022-05-01T15:37:00Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 6534881390,
      "node_id": "HRFPE_lADOABII585IUMv_zwAAAAGFgmBu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6534881390",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-05-02T16:57:27Z"
    },
    {
      "event": "commented",
      "id": 1119085415,
      "node_id": "IC_kwDOABII585Cs-Nn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1119085415",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-05-05T22:02:03Z",
      "updated_at": "2022-05-05T22:02:03Z",
      "author_association": "MEMBER",
      "body": "reACK `git range-diff 889f6c719dbd2bca5f38a6a5a89f39fb4639558f...8fe0e7c48e651fdf981675d0dd1542ec49ea91b7`",
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1119085415",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "reviewed",
      "id": 965223224,
      "node_id": "PRR_kwDOABII5845iCM4",
      "url": null,
      "actor": null,
      "commit_id": "8fe0e7c48e651fdf981675d0dd1542ec49ea91b7",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#pullrequestreview-965223224",
      "submitted_at": "2022-05-06T22:15:21Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
    },
    {
      "event": "commented",
      "id": 1120187377,
      "node_id": "IC_kwDOABII585CxLPx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1120187377",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-05-07T10:59:51Z",
      "updated_at": "2022-05-07T10:59:51Z",
      "author_association": "MEMBER",
      "body": "> What I wonder, does this need special handling in the build system? E.g. would this need some use-sqlite-but-no-wallet flag?\r\n\r\nYes I think it does. However this change is done, it should not be adding an auto-detected/enabled by default dependency on sqlite, for a \"nice to have\" RPC feature.",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1120187377",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "reviewed",
      "id": 967942062,
      "node_id": "PRR_kwDOABII5845sZ-u",
      "url": null,
      "actor": null,
      "commit_id": "8fe0e7c48e651fdf981675d0dd1542ec49ea91b7",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Lightly tested ACK 8fe0e7c48e651fdf981675d0dd1542ec49ea91b7 🗄️  (modulo needed build system changes w.r.t. sqlite)\r\n\r\nIn the course of researching possible alternatives for this PR I created a tool for converting an UTXO set dump from compact-serialized format to SQLite format (see https://github.com/theStack/utxo_dump_tools). Of course the tool will be obsolete after this PR is merged, but having it available enables a first step to lightly test the integrity of the created data (and also the correctness of conversion tool) for now by\r\n\r\n1. dumping UTXO set in legacy format -> convert it to SQLite\r\n2. dumping UTXO set directly in SQLite format (as introduced in this PR)\r\n3. comparing the contents of these two databases\r\n    \r\nThe SQLite files are not equal on a byte-by-byte basis after dropping the `metadata` table (I guess there is possibly some internal metadata for SQLite as well that could differ), but their dumped data in e.g. CSV format is exactly equal.\r\n\r\nNote that since dozens of gigabytes are converted and processed several times in this testing scenario, it takes quite a while, it was about ~2 hours in total on my machine (on testnet or signet it should be significantly faster, of course). If anyone wants to follow the steps:\r\n\r\n```\r\n<run bitcoind of #24952>\r\n$ bitcoin-cli dumptxoutset utxos.compact compact\r\n$ bitcoin-cli dumptxoutset utxos.sqlite sqlite\r\n(make sure that both dumptxoutset calls happen at the same block height!)\r\n$ git clone https://github.com/theStack/utxo_dump_tools\r\n$ cd utxo_dump_tools/utxo_to_sqlite\r\n$ go run utxo_to_sqlite ~/.bitcoin/utxos.compact ~/.bitcoin/utxos_from_compact.sqlite\r\n$ sqlite3 -header -csv ~/.bitcoin/utxos.sqlite \"SELECT * FROM utxos\" > utxos.csv\r\n$ sqlite3 -header -csv ~/.bitcoin/utxos_from_compact.sqlite \"SELECT * FROM utxos\" > utxos_from_compact.csv\r\n$ sha256sum utxos.csv utxos_from_compact.csv\r\n< hashes of both files should match >\r\n```\r\n\r\nFor mainnet, block height 735763 (00000000000000000000104512ae0ed032068ee654c328b524b6d1a743472509):\r\n```\r\n$ sha256sum *.csv\r\n20dd68ae4986735692e9109b49572f08240bd8637d663008e6ad7924df4b8bac  utxos.csv\r\n20dd68ae4986735692e9109b49572f08240bd8637d663008e6ad7924df4b8bac  utxos_from_compact.csv\r\n```\r\n\r\nEven nicer would be the possibility to calculate the UTXO set hash of a SQLite database (which can be easily compared to the output of a call to the `gettxoutsetinfo` RPC), I'm working on a verification tool implementation using MuHash which should be ready soon.",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#pullrequestreview-967942062",
      "submitted_at": "2022-05-10T15:00:20Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
    },
    {
      "event": "commented",
      "id": 1122540760,
      "node_id": "IC_kwDOABII585C6JzY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1122540760",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-05-10T15:24:19Z",
      "updated_at": "2022-05-10T15:24:19Z",
      "author_association": "CONTRIBUTOR",
      "body": "> (modulo needed build system changes w.r.t. sqlite)\r\n\r\nWorking on that today. Apologies for the delay!\r\n\r\n> In the course of researching possible alternatives for this PR I created a tool for converting an UTXO set dump from compact-serialized format to SQLite format (see https://github.com/theStack/utxo_dump_tools). Of course the tool will be obsolete after this PR is merged, but having it available enables a first step to lightly test the integrity of the created data (and also the correctness of conversion tool) for now by\r\n\r\nThank you! This is pretty helpful for testing.\r\n\r\n> The SQLite files are not equal on a byte-by-byte basis after dropping the `metadata` table (I guess there is possibly some internal metadata for SQLite as well that could differ), but their dumped data in e.g. CSV format is exactly equal.\r\n\r\nYeah, I'd imagine something of the sort w.r.t. the actual SQLite file metadata.\r\n\r\n> Even nicer would be the possibility to calculate the UTXO set hash of a SQLite database (which can be easily compared to the output of a call to the `gettxoutsetinfo` RPC), I'm working on a verification tool implementation using MuHash which should be ready soon.\r\n\r\nWould definitely be keen to try it out when ready!",
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1122540760",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "commented",
      "id": 1122612749,
      "node_id": "IC_kwDOABII585C6bYN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1122612749",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-05-10T16:22:41Z",
      "updated_at": "2022-05-10T16:22:41Z",
      "author_association": "MEMBER",
      "body": "> Of course the tool will be obsolete after this PR is merged,\r\n\r\nAlternatively, the existence of the tool may make the PR obsolete. If it's possible for Core to just maintain a single, compact, dependency-less output format, and it's easy for devs or power users to write & use tools that can convert that compact format into whichever other formats they need, that seems superior to introducing more code (to maintain) into Core, and a new non-wallet sqlite dependency.",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1122612749",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "commented",
      "id": 1122906748,
      "node_id": "IC_kwDOABII585C7jJ8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1122906748",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-05-10T21:43:45Z",
      "updated_at": "2022-05-10T21:43:45Z",
      "author_association": "MEMBER",
      "body": "> > Of course the tool will be obsolete after this PR is merged,\r\n> \r\n> Alternatively, the existence of the tool may make the PR obsolete. If it's possible for Core to just maintain a single, compact, dependency-less output format, and it's easy for devs or power users to write & use tools that can convert that compact format into whichever other formats they need, that seems superior to introducing more code (to maintain) into Core, and a new non-wallet sqlite dependency.\r\n\r\nThat's a valid counter-argument for sure and was also the initial reason I started writing this tool, as I wasn't convinced whether adding a second dump format with a dependency is really worth the additional code and maintenance burden (see https://github.com/bitcoin/bitcoin/issues/24628#issuecomment-1108469715 for more details). The grave drawback of the current UTXO dump format though is that it's solely designed for being compact but nothing else, i.e. it's not useful for inspection at all and unusable without further processing; too many fields are compressed in a non-trivial way. As the worst example, you even need elliptic curve math (modular field arithmetics on large integers, basically a subset of the secp256k1 library) to restore the scriptPubKeys for P2PK outputs, so it is unfortunately not really \"dependency-less\".\r\n\r\nA good dump format should IMHO contain only the pure data without trying to encode things in a smart non-standardized way that forces users to process it further to do even basic inspection. Since handling those huge amounts of data (>80 million rows on mainnet, currently) barely makes sense without having _some basic form_ of database, using a very widespread and stable single-file format like SQLite seems still like a good choice to me.",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1122906748",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "commented",
      "id": 1122968661,
      "node_id": "IC_kwDOABII585C7yRV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1122968661",
      "actor": {
        "login": "pk-b2",
        "id": 91447896,
        "node_id": "MDQ6VXNlcjkxNDQ3ODk2",
        "avatar_url": "https://avatars.githubusercontent.com/u/91447896?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pk-b2",
        "html_url": "https://github.com/pk-b2",
        "followers_url": "https://api.github.com/users/pk-b2/followers",
        "following_url": "https://api.github.com/users/pk-b2/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pk-b2/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pk-b2/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pk-b2/subscriptions",
        "organizations_url": "https://api.github.com/users/pk-b2/orgs",
        "repos_url": "https://api.github.com/users/pk-b2/repos",
        "events_url": "https://api.github.com/users/pk-b2/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pk-b2/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-05-10T22:34:45Z",
      "updated_at": "2022-05-10T22:40:10Z",
      "author_association": "NONE",
      "body": "Is it worth to consider to just write it to stdout while iterating all utxos?\r\n\r\nThat would make it easy for a consumer to bring it into any required format for further processing or analyzing without having Core to make that decision.\r\n\r\nsqlite3 is able to capture from stdin as an import source and most other formats like csv or json can already be processed via the command line. You could even already apply filtering while dumping all records.\r\n\r\n\r\n",
      "user": {
        "login": "pk-b2",
        "id": 91447896,
        "node_id": "MDQ6VXNlcjkxNDQ3ODk2",
        "avatar_url": "https://avatars.githubusercontent.com/u/91447896?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pk-b2",
        "html_url": "https://github.com/pk-b2",
        "followers_url": "https://api.github.com/users/pk-b2/followers",
        "following_url": "https://api.github.com/users/pk-b2/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pk-b2/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pk-b2/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pk-b2/subscriptions",
        "organizations_url": "https://api.github.com/users/pk-b2/orgs",
        "repos_url": "https://api.github.com/users/pk-b2/repos",
        "events_url": "https://api.github.com/users/pk-b2/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pk-b2/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1122968661",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "commented",
      "id": 1123302632,
      "node_id": "IC_kwDOABII585C9Dzo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1123302632",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-05-11T07:45:16Z",
      "updated_at": "2022-05-11T07:45:16Z",
      "author_association": "MEMBER",
      "body": "> The grave drawback of the current UTXO dump format though is that it's solely designed for being compact but nothing else, i.e. it's not useful for inspection at all and unusable without further processing; too many fields are compressed in a non-trivial way.\r\n\r\nIt really sounds like we should be improving the current format (I don't think we need to worry about backwards compatibility too much), given the issues you've outlined, rather than adding a new format, more code, and a dependency we don't want. Otherwise we've still got to maintain the old format, which is compressed (convenient), but not really useful unless you write your own parser (clearly doable), and also maintain the new format, which is seemingly only being introduced because the current format isn't really usable for what everyone wants.",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1123302632",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 6588476233,
      "node_id": "HRFPE_lADOABII585IUMv_zwAAAAGItCtJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6588476233",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-05-11T09:28:57Z"
    },
    {
      "event": "commented",
      "id": 1123587321,
      "node_id": "IC_kwDOABII585C-JT5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1123587321",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-05-11T11:09:38Z",
      "updated_at": "2022-05-11T11:09:38Z",
      "author_association": "MEMBER",
      "body": "> It really sounds like we should be improving the current format (I don't think we need to worry about backwards compatibility too much), given the issues you've outlined, rather than adding a new format, more code, and a dependency we don't want. Otherwise we've still got to maintain the old format, which is compressed (convenient), but not really useful unless you write your own parser (clearly doable), and also maintain the new format, which is seemingly only being introduced because the current format isn't really usable for what everyone wants.\r\n\r\nThe compact-serialized format was introduced as part of the AssumeUTXO project (see https://github.com/bitcoin/bitcoin/pull/16899) for creating and loading UTXO snapshots. Not sure if at this point changing the specification is desired/needed, I guess for this specific use-case the format is just fine (maybe @jamesob can comment on this?). So it seems that we really have two different goals here: on the one hand a snapshot format to be saved/loaded by bitcoind  or even other clients (and that in the most space-efficient way possible), on the other hand providing a neutral easy-to-process dump-format that can be inspected by users. I agree that it would be the best solution if both of these goals could be met by a single format.",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1123587321",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "mentioned",
      "id": 6589251222,
      "node_id": "MEE_lADOABII585IUMv_zwAAAAGIv_6W",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6589251222",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-05-11T11:09:38Z"
    },
    {
      "event": "subscribed",
      "id": 6589251234,
      "node_id": "SE_lADOABII585IUMv_zwAAAAGIv_6i",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6589251234",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-05-11T11:09:38Z"
    },
    {
      "event": "commented",
      "id": 1124016843,
      "node_id": "IC_kwDOABII585C_yLL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1124016843",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-05-11T16:55:17Z",
      "updated_at": "2022-05-11T16:55:17Z",
      "author_association": "CONTRIBUTOR",
      "body": "There's an issue in the latest push with configuring with `--disable-wallet --with-sqlite=yes` with the build system. I'll take a look in the morning. `USE_SQLITE` comes out true as expected, though. Maybe something that the wallet flag is guarding.",
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1124016843",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDFkYjNhNTJjNWIxMWI2M2Q2Yjk2N2Q2ZTVkYjJjZjQ2YWM1NzA4NTI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1db3a52c5b11b63d6b967d6e5db2cf46ac570852",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/1db3a52c5b11b63d6b967d6e5db2cf46ac570852",
      "tree": {
        "sha": "688ba1552c1d893b7cdb910c63fa0400e860aa59",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/688ba1552c1d893b7cdb910c63fa0400e860aa59"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 688ba1552c1d893b7cdb910c63fa0400e860aa59\nparent 1ab389b1bac1378e17b13a4c4a81c24b92745cfb\nauthor Duncan Dean <duncangleeddean@gmail.com> 1650704206 +0200\ncommitter Duncan Dean <duncangleeddean@gmail.com> 1652797774 +0200\n\nrpc: Add sqlite format option for dumptxoutset\n\nThis allows RPC users of the `dumptxoutset` command to output to a SQLite DB format with human-readable fields.\nThis approach allows for trivial export to JSON and CSV by using `sqlite3` (detailed in #24628).\n\nThere is a new optional 'format' parameter for `dumptxoutset` that can take on the values of either 'compact' or 'sqlite'\nwith 'compact' as the default. This allows for backward compatibility.\n\nCloses #24628\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEKPWQCxu10aS2ttGp7TVwFShqMz0FAmKDsVYACgkQ7TVwFShq\nMz3PTQ/8DzsF2rOmlXilKrEFHMeJfS9b9gSBC+xspk/5alSbg7nuLJeDB3r0z0ms\nizHTvK9qhIBDYi76jSdByb3MeeXAxJK6Hd25FlL879k6Zv22hCR/busj4iZKs8pT\nR5UkVy4w+V5Pily6Gam5tVqwFt593jrIOtdmjsOlmYU96PO9Gzd2PJcpa+b5OzcF\nAdhWtpgMZTbVt07lqWsVtyYh6X0l6ROORT9PAsTBhZlH//+bTB4E50gDuOLvgNiV\nrWGBLZ4qXSyOBaZpBIk8IXyQbIo5OBTTIiPE5X7ECQjPc5+BuYOSPHRrTcFDYdjb\naffjgAGSTXjcMZ/jxWes9fGfrGcLPRsGyB4ze7yZfGEIWykRKs9aFs6nUav543gB\n93TmEvI38FNi43hzb3VNkU9mgo7zQu+mz4M73HDJ6ck6tBv80Xnx2k5CbZX3OBHw\nCCe2R9IkkDadZZTXa7canisQq+tEQ2lNlcXNk+28nQVTp+SXL1cKE7OxRxRpc5Rc\nVa4ZbBYevHF/65+rfUcdqZ4iX5m9XSki/oDEC3SRNlBxzdy29tDsw7y9zOHvgEOj\nqD8wknhpaRw1p8W0asMTKHxmgKUE7GMC8KmZ6SE0nXhqEybU6bQxY5VIwDG1zz0N\ne4RPoyJkZAQJ521SVjLMEj97P/JRC2tlemTD+ncRzJyLRRmSY7s=\n=WvRx\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1ab389b1bac1378e17b13a4c4a81c24b92745cfb",
          "sha": "1ab389b1bac1378e17b13a4c4a81c24b92745cfb",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/1ab389b1bac1378e17b13a4c4a81c24b92745cfb"
        }
      ],
      "message": "rpc: Add sqlite format option for dumptxoutset\n\nThis allows RPC users of the `dumptxoutset` command to output to a SQLite DB format with human-readable fields.\nThis approach allows for trivial export to JSON and CSV by using `sqlite3` (detailed in #24628).\n\nThere is a new optional 'format' parameter for `dumptxoutset` that can take on the values of either 'compact' or 'sqlite'\nwith 'compact' as the default. This allows for backward compatibility.\n\nCloses #24628",
      "committer": {
        "name": "Duncan Dean",
        "email": "duncangleeddean@gmail.com",
        "date": "2022-05-17T14:29:34Z"
      },
      "author": {
        "name": "Duncan Dean",
        "email": "duncangleeddean@gmail.com",
        "date": "2022-04-23T08:56:46Z"
      },
      "sha": "1db3a52c5b11b63d6b967d6e5db2cf46ac570852"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGM1NTA2YWMyOTg4NDY5ZDQ5NjFhZjI3ZjIwYjBmNmZjODg3YjE3OWQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c5506ac2988469d4961af27f20b0f6fc887b179d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/c5506ac2988469d4961af27f20b0f6fc887b179d",
      "tree": {
        "sha": "bc24b7c11b9681e2a56b2831b40855fe2964c26c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/bc24b7c11b9681e2a56b2831b40855fe2964c26c"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree bc24b7c11b9681e2a56b2831b40855fe2964c26c\nparent 1db3a52c5b11b63d6b967d6e5db2cf46ac570852\nauthor Duncan Dean <duncangleeddean@gmail.com> 1651163301 +0200\ncommitter Duncan Dean <duncangleeddean@gmail.com> 1652797783 +0200\n\ndoc: Add dumptxoutset format parameter to release notes\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEKPWQCxu10aS2ttGp7TVwFShqMz0FAmKDsVcACgkQ7TVwFShq\nMz2Ulw/+I4hUDs+Y6Vu3gpFdMgpQoBPW+cF4qCE8AtozQJxOGg00dSr5jC65eCOw\nApwtQ2rlZug7AK1EAypsWjXt2Fwcgv6ltvrvNQpGnv/Z9GYg0oU4Pf8SVBKER30Y\npJm6e54vcNEAJbimwHXq69bcxOXOFO6L0OBJeDHZSMSmbLL27n0BDaqZiJdvBBU/\nBNV8aS4LKb+iCycYU3qtFHQdCZG2Vkxv8h7vmhMGvPmTCSct9bIde6TOlMLUpnUc\n/EkvmhpEY/QzLuyOjijjpldgIg/rgdkViFfbAqfctPHVeFkvA85LDFP8BOFz9Lia\nHVJ4QzxsHBEJXwamNmL28X0SKYAvBo+7CLSCo/s32unZUXwe6LqXTwBbAjoNcJJO\nJkCevXi8VFnQdJTntX0qbMfRi8eL4xbZTXI0MNRCZmphsDK2+v7cv1EYU0zRdyDb\nn/yU61DR4Lc2XWimD+TQmtvx/GAgFVR+aFQG8ArifZ/Wd6IsmtO3EjULjmYWTQo9\n88nqjCIYvHg2D+5t+6/2uZXicLsQkVfXpXiC8i6bh42LeMWMggvsztvtwJZs7MmT\n3s79+zT+vZWzQhMp2z+/3ZIT1Q7BkknTuzio2VZ3KYwOHSb5FHvbp1L7tbYivabp\nGiiXDK71nkWkYmKZ/lxKDva9XyFQZdJXSl0fCEgXqHfNe/Qtu88=\n=s5rQ\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1db3a52c5b11b63d6b967d6e5db2cf46ac570852",
          "sha": "1db3a52c5b11b63d6b967d6e5db2cf46ac570852",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/1db3a52c5b11b63d6b967d6e5db2cf46ac570852"
        }
      ],
      "message": "doc: Add dumptxoutset format parameter to release notes",
      "committer": {
        "name": "Duncan Dean",
        "email": "duncangleeddean@gmail.com",
        "date": "2022-05-17T14:29:43Z"
      },
      "author": {
        "name": "Duncan Dean",
        "email": "duncangleeddean@gmail.com",
        "date": "2022-04-28T16:28:21Z"
      },
      "sha": "c5506ac2988469d4961af27f20b0f6fc887b179d"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 6625157110,
      "node_id": "HRFPE_lADOABII585IUMv_zwAAAAGK49_2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6625157110",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-05-17T14:42:08Z"
    },
    {
      "event": "labeled",
      "id": 6669211157,
      "node_id": "LE_lADOABII585IUMv_zwAAAAGNhBYV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6669211157",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-05-24T13:39:20Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1135937103,
      "node_id": "IC_kwDOABII585DtQZP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1135937103",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-05-24T13:39:21Z",
      "updated_at": "2022-05-24T13:39:21Z",
      "author_association": "MEMBER",
      "body": "<!--cf906140f33d8803c4a75a2196329ecb-->\n🐙 This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1135937103",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "commented",
      "id": 1142185714,
      "node_id": "IC_kwDOABII585EFF7y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1142185714",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-05-31T14:08:12Z",
      "updated_at": "2022-05-31T14:09:05Z",
      "author_association": "MEMBER",
      "body": "> . I agree that it would be the best solution if both of these goals could be met by a single format.\r\n\r\nThis could be argued the other way around too: maybe it's good to have an internal and an external format. The internal format could be changed more easily when necessary for our internal purposes. It's like the block index, the utxo index, etc. Someone can write a perser but there are no guarantees of compatibility. Also, it only needs the data we need to reconstruct from a snapshot, nothing more, nothing less.\r\n\r\nHowever, changes in the external format, a documented API, have to take external clients into account.",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1142185714",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "commented",
      "id": 1147690348,
      "node_id": "IC_kwDOABII585EaF1s",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1147690348",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-06T17:20:17Z",
      "updated_at": "2022-06-06T17:20:17Z",
      "author_association": "MEMBER",
      "body": "> Alternatively, the existence of the tool may make the PR obsolete. If it's possible for Core to just maintain a single, compact, dependency-less output format, and it's easy for devs or power users to write & use tools that can convert that compact format into whichever other formats they need, that seems superior to introducing more code (to maintain) into Core, and a new non-wallet sqlite dependency.\r\n\r\n> So it seems that we really have two different goals here: on the one hand a snapshot format to be saved/loaded by bitcoind or even other clients (and that in the most space-efficient way possible), on the other hand providing a neutral easy-to-process dump-format that can be inspected by users.\r\n\r\n@fanquake @theStack yeah, the existing format is intended to be as space efficient as possible since, ideally, that output will be commonly shared across network to help get nodes going. That consideration, in conjunction with \r\n\r\n- external tools needing libsecp to render the compressed data, and\r\n- the obligation that would be introduced by making a previously opaque data blob \"publicly\" consumable\r\n\r\nmakes me sympathetic to this changeset. I think as long as this feature gracefully degrades when sqlite support isn't compiled in, I'm concept ACK and will be happy to review this soon.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1147690348",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "mentioned",
      "id": 6754753273,
      "node_id": "MEE_lADOABII585IUMv_zwAAAAGSnVr5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6754753273",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-06T17:20:17Z"
    },
    {
      "event": "subscribed",
      "id": 6754753281,
      "node_id": "SE_lADOABII585IUMv_zwAAAAGSnVsB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6754753281",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-06T17:20:17Z"
    },
    {
      "event": "mentioned",
      "id": 6754753290,
      "node_id": "MEE_lADOABII585IUMv_zwAAAAGSnVsK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6754753290",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-06T17:20:17Z"
    },
    {
      "event": "subscribed",
      "id": 6754753298,
      "node_id": "SE_lADOABII585IUMv_zwAAAAGSnVsS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6754753298",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-06T17:20:17Z"
    },
    {
      "event": "commented",
      "id": 1163377303,
      "node_id": "IC_kwDOABII585FV7qX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1163377303",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-22T16:52:37Z",
      "updated_at": "2022-06-22T17:23:21Z",
      "author_association": "MEMBER",
      "body": "Needs a trivial rebase for #24410:\r\n```\r\nSnapshotMetadata metadata{tip->GetBlockHash(), maybe_stats->coins_count, tip->nChainTx};\r\n```\r\n\r\nEdit: i get the following error locally while running the `rpc_dumptxoutset.py` test:\r\n```\r\n test  2022-06-22T17:09:26.669000Z TestFramework (ERROR): Assertion failed\r\n                                   Traceback (most recent call last):\r\n                                     File \"/store/user/projects/bitcoin/bitcoin/test/functional/test_framework/util.py\", line 134, in try_rpc\r\n                                       fun(*args, **kwds)\r\n                                     File \"/home/user/projects/bitcoin/bitcoin/test/functional/rpc_dumptxoutset.py\", line 95, in <lambda>\r\n                                       assert_raises_rpc_error(-32603, 'Unable to open database file', lambda: node.dumptxoutset('bad_path/' + FILENAME, 'sqlite'))\r\n                                     File \"/store/user/projects/bitcoin/bitcoin/test/functional/test_framework/coverage.py\", line 49, in __call__\r\n                                       return_val = self.auth_service_proxy_instance.__call__(*args, **kwargs)\r\n                                     File \"/store/user/projects/bitcoin/bitcoin/test/functional/test_framework/authproxy.py\", line 144, in __call__\r\n                                       raise JSONRPCException(response['error'], status)\r\n                                   test_framework.authproxy.JSONRPCException: Couldn't open file /tmp/test_runner_₿_🏃_20220622_190924/rpc_dumptxoutset_0/node0/regtest/bad_path/txoutset.db.incomplete for writing. (-8)\r\n\r\n```\r\nLooks like it expects error code `-32603` but gets `-8`.",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1163377303",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "commented",
      "id": 1163551060,
      "node_id": "IC_kwDOABII585FWmFU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1163551060",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-22T20:07:06Z",
      "updated_at": "2022-06-22T20:07:06Z",
      "author_association": "MEMBER",
      "body": "Concept NACK - I hope we don't go down this route. We've spent years trying to reduce the number of external dependencies in Bitcoin Core; especially in the option-less build. At this point in the project, I think adding new, or expanding the scope of, dependencies in this code base, should be reserved for things that are actually important/mission critical, i.e libsecp256k1, not for nice-to-have features, that are going to be used by a (relatively) small number of developers and enthusiasts, and not actually by the majority of nodes running this peice of software.\r\n\r\nIf anything, Bitcoin Core should be removing more code, and creating external tooling for new features, rather than continuing to accumulate functionality in this codebase because it's convenient. In this case, an external tool even exists already (I don't really understand why it needing libsecp as a dependency is a problem). My longer term conern is that if something like this is merged, in 3 months time, we'll have a new pull-request, to add support for using sqlite to dump out logs in json format, or some other thing, that clearly shouldn't be a concern/maintenance burnden of Bitcoin Core.\r\n\r\nThis PR also gives us somewhat awkward build logic, where an RPC feature is enabled if a user compiles with a certain dependency, that previously, only controlled whether or not you got a certain type of wallet.\r\n\r\nHow is this going to work with https://github.com/bitcoin/bitcoin/pull/24202? Are we abandoning that PR in favour of this, or will we end up with a trifecta of output formats?\r\n\r\nIn any case, this PR (rebased) is currently broken on arm64 macOS, when building with `--disable-wallet --with-sqlite`. sqlite is available, and building master with the same options works as expected:\r\n```bash\r\n  CXXLD    bitcoin-cli\r\n  CXXLD    minisketch/test\r\n  CXXLD    bitcoin-tx\r\n  CXXLD    bitcoin-util\r\nar: -L/opt/homebrew/Cellar/sqlite/3.38.5/lib: No such file or directory\r\nar: -lsqlite3: No such file or directory\r\ngmake[2]: *** [Makefile:5897: libbitcoin_node.a] Error 1\r\n```",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1163551060",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "commented",
      "id": 1163658248,
      "node_id": "IC_kwDOABII585FXAQI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1163658248",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-22T22:08:16Z",
      "updated_at": "2022-06-22T22:08:16Z",
      "author_association": "MEMBER",
      "body": "@fanquake: Great points raised that should be considered, I agree that an additional external dependency definitely has its drawbacks. Still, the somewhat uncomfortable fact is that right now we don't have a proper \"dumb\" (sic!) dump format for the UTXO set that only contains pure information and thus can easily be searched/processed. I think there should be one, as [the current compact-serialized format has a different purpose and won't change](https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1147690348), and considering that the UTXO set is one of the (if not _the_) most important data-structures on all nodes (be it pruned or non-pruned), as it reflects the current state / distribution of funds with all (visible) spending conditions, I would argue it's worth to make an exception here to the \"we don't add convenience features if the same result can also be achieved somehow with external tools\" rule. This enables the user to easily inspect that state without the need for further fiddling around between different formats and investing extra time and disk space.\r\n\r\n> How is this going to work with https://github.com/bitcoin/bitcoin/pull/24202? Are we abandoning that PR in favour of this, or will we end up with a trifecta of output formats?\r\n\r\nI think it's pretty obvious that this PR would obsolete #24202, at least I can't come up with a good reason why anyone would still be interested in a text format if you can already have a superset in the form of a simple but still powerful database (converting from SQLite to CSV format is not a big deal)? Though, if this PR is too controversial, it's probably still better to have #24202 instead of no proper UTXO set dump format at all. A compromise could be #24202 plus as follow-up a trivial tool (e.g. in contrib/ or external) that converts the text output to a SQLite database? (Would maybe still be faster than the current approach of emiting a compact-serialized dump + converting that to SQLite format via [utxo_to_sqlite](https://github.com/theStack/utxo_dump_tools)). Very curious to hear others opinions.",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1163658248",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "mentioned",
      "id": 6860454653,
      "node_id": "MEE_lADOABII585IUMv_zwAAAAGY6jr9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6860454653",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-22T22:08:16Z"
    },
    {
      "event": "subscribed",
      "id": 6860454662,
      "node_id": "SE_lADOABII585IUMv_zwAAAAGY6jsG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6860454662",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-22T22:08:16Z"
    },
    {
      "event": "commented",
      "id": 1164090027,
      "node_id": "IC_kwDOABII585FYpqr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1164090027",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-23T08:06:34Z",
      "updated_at": "2022-06-23T08:17:57Z",
      "author_association": "MEMBER",
      "body": "> How is this going to work with https://github.com/bitcoin/bitcoin/pull/24202? Are we abandoning that PR in favour of this, or will we end up with a trifecta of output formats?\r\n\r\nI think we should settle on two formats. The format for internal use and a format for external use. From there on, it's for people with custom scripts to analyze it or convert it into anything they want (it's not like end users have a use for an UTXO dump anyway). As external format I think sqlite is a [surprisingly good choice](https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1112502316) for these kind of huge data dumps (better than say, JSON, or formats that require writing custom parsers). It should still be possible to compile the node without sqlite though for people (most) who don't need external UTXO exports.\r\n\r\n> Though, if this PR is too controversial, it's probably still better to have https://github.com/bitcoin/bitcoin/pull/24202 instead of no proper UTXO set dump format at all. A compromise could be https://github.com/bitcoin/bitcoin/pull/24202 plus as follow-up a trivial tool (e.g. in contrib/ or external) that converts the text output to a SQLite database? (Would maybe still be faster than the current approach of emiting a compact-serialized dump + converting that to SQLite format via [utxo_to_sqlite](https://github.com/theStack/utxo_dump_tools)). Very curious to hear others opinions.\r\n\r\nI agree.\r\n",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1164090027",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "commented",
      "id": 1164592237,
      "node_id": "IC_kwDOABII585FakRt",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1164592237",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-23T15:56:58Z",
      "updated_at": "2022-06-23T15:56:58Z",
      "author_association": "MEMBER",
      "body": "I think answers to these questions would be illuminating for comparison to #24202:\r\n- is there a considerable difference in final output size for CSV vs. sqlite? is one more space efficient than the other?\r\n- what is the code complexity and runtime of, say, a Python script that writes streaming CSV input into sqlite?\r\n\r\nIf space is comparable between the two options, and a script that adapts CSV -> sqlite is easy (I think it would be) and relatively quick (not sure here), I would say that #24202 is preferable, since it would ship with all builds. We could even bundle such a script in `contrib/`.\r\n\r\nThat said, I think dependency considerations aside, sqlite is probably a much more practical output format for actual consumption. Reading sqlite into, say, `pandas` for further analysis is as trivial CSV - in fact, based on the function signatures of [`pandas.read_csv`](https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html) vs. [`pandas.read_sql_table`](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_sql_table.html#pandas.read_sql_table), sqlite is probably the easier choice.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1164592237",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "commented",
      "id": 1164699018,
      "node_id": "IC_kwDOABII585Fa-WK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1164699018",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-23T17:47:20Z",
      "updated_at": "2022-06-23T17:47:20Z",
      "author_association": "MEMBER",
      "body": "> is there a considerable difference in final output size for CSV vs. sqlite? is one more space efficient than the other?\r\n\r\nDid a quick comparison between a SQLite output that I created with this PR ~3 weeks ago (82401330 UTXO entries) and a text output with #24202 that I created just a few minutes ago (82801821 UTXO entries):\r\n```\r\n$ ls -l ~/.bitcoin/utxos.sqlite ~/.bitcoin/utxo_set.txt\r\n[...] 11009749503 Jun 23 19:20 /home/honeybadger/.bitcoin/utxo_set.txt\r\n[...] 12445270016 Jun  3 15:44 /home/honeybadger/.bitcoin/utxos.sqlite\r\n```\r\nBoth seem to take roughly ~2x of the size of the compact-serialized format, with the text output even being a bit smaller (~10.25 GB vs ~11.59 GB). The vast majority of the space per entry is taken by txid and scriptPubKey, and since we store them as hex-encoded strings (both in this PR and in #24202), it makes sense that the sizes are in a similar area.\r\n\r\n> what is the code complexity and runtime of, say, a Python script that writes streaming CSV input into sqlite?\r\n\r\nPretty sure that the code complexity is low (seems like sqlite3 can even directly import CSV files and it could be a very simple shell-script? https://stackoverflow.com/a/1045961), while the runtime could be a bit of a show-stopper here. Will try to write such a script within the next days and report the results then.",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1164699018",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "commented",
      "id": 1164733346,
      "node_id": "IC_kwDOABII585FbGui",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1164733346",
      "actor": {
        "login": "JeremyRubin",
        "id": 886523,
        "node_id": "MDQ6VXNlcjg4NjUyMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/JeremyRubin",
        "html_url": "https://github.com/JeremyRubin",
        "followers_url": "https://api.github.com/users/JeremyRubin/followers",
        "following_url": "https://api.github.com/users/JeremyRubin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/JeremyRubin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/JeremyRubin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
        "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
        "repos_url": "https://api.github.com/users/JeremyRubin/repos",
        "events_url": "https://api.github.com/users/JeremyRubin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-23T18:24:48Z",
      "updated_at": "2022-06-23T18:24:48Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Unfortunately, there is no built-in \"reverse\" operator in SQLite :/ If there was, we could simply do something like the following for the conversion script: `SELECT hex(reverse(txid)), vout, value, coinbase, height, hex(scriptpubkey) FROM utxos`\r\n\r\nActually, you can use the SUBSTR and LENGTH https://www.sqlite.org/lang_corefunc.html#substr \r\n\r\n> The substr(X,Y,Z) function returns a substring of input string X that begins with the Y-th character and which is Z characters long. If Z is omitted then substr(X,Y) returns all characters through the end of the string X beginning with the Y-th. The left-most character of X is number 1. If Y is negative then the first character of the substring is found by counting from the right rather than the left. If Z is negative then the abs(Z) characters preceding the Y-th character are returned. If X is a string then characters indices refer to actual UTF-8 characters. If X is a BLOB then the indices refer to bytes.\r\n\r\nso in theory:\r\n\r\n```sql\r\nSELECT hex(SUBSTR(txid, -1, -LENGTH(txid))), vout, value, coinbase, height, hex(scriptpubkey) FROM utxos\r\n```\r\n\r\nworks.\r\n\r\n\r\n\r\n\r\n----------\r\n\r\n\r\nIn general I think dumping to sqlite sounds like a fine idea. One point of contention though is it would be nice if we could return the SQLITE file over the network _somehow_, since not all RPC users have local filesystem access.\r\n",
      "user": {
        "login": "JeremyRubin",
        "id": 886523,
        "node_id": "MDQ6VXNlcjg4NjUyMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/JeremyRubin",
        "html_url": "https://github.com/JeremyRubin",
        "followers_url": "https://api.github.com/users/JeremyRubin/followers",
        "following_url": "https://api.github.com/users/JeremyRubin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/JeremyRubin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/JeremyRubin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
        "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
        "repos_url": "https://api.github.com/users/JeremyRubin/repos",
        "events_url": "https://api.github.com/users/JeremyRubin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1164733346",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "commented",
      "id": 1165499803,
      "node_id": "IC_kwDOABII585FeB2b",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1165499803",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-24T11:54:04Z",
      "updated_at": "2022-06-24T11:54:04Z",
      "author_association": "MEMBER",
      "body": "> > Unfortunately, there is no built-in \"reverse\" operator in SQLite :/ If there was, we could simply do something like the following for the conversion script: `SELECT hex(reverse(txid)), vout, value, coinbase, height, hex(scriptpubkey) FROM utxos`\r\n> \r\n> Actually, you can use the SUBSTR and LENGTH https://www.sqlite.org/lang_corefunc.html#substr\r\n> \r\n> [...]\r\n> \r\n> so in theory:\r\n> \r\n> ```sql\r\n> SELECT hex(SUBSTR(txid, -1, -LENGTH(txid))), vout, value, coinbase, height, hex(scriptpubkey) FROM utxos\r\n> ```\r\n> \r\n> works.\r\n\r\nUnfortunately that doesn't work. The substring is still extracted from left to right without any reversing operation involved, the only thing possible is to specify the start and end offsets by counting from right to left:\r\n```\r\n$ sqlite3\r\nSQLite version 3.38.2 2022-03-26 13:51:10\r\nEnter \".help\" for usage hints.\r\nConnected to a transient in-memory database.\r\nUse \".open FILENAME\" to reopen on a persistent database.\r\nsqlite> select hex(substr(x'11223344', -1, -4));\r\n112233\r\n\r\n```\r\nIf reversing in SQLite was possible, it would be very tempting to store the txid and scriptPubkey as BLOBs [to have more compact dumps that are created faster](https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1109449844).",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1165499803",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "commented",
      "id": 1165804095,
      "node_id": "IC_kwDOABII585FfMI_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1165804095",
      "actor": {
        "login": "JeremyRubin",
        "id": 886523,
        "node_id": "MDQ6VXNlcjg4NjUyMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/JeremyRubin",
        "html_url": "https://github.com/JeremyRubin",
        "followers_url": "https://api.github.com/users/JeremyRubin/followers",
        "following_url": "https://api.github.com/users/JeremyRubin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/JeremyRubin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/JeremyRubin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
        "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
        "repos_url": "https://api.github.com/users/JeremyRubin/repos",
        "events_url": "https://api.github.com/users/JeremyRubin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-24T17:55:01Z",
      "updated_at": "2022-06-24T17:55:01Z",
      "author_association": "CONTRIBUTOR",
      "body": "ah interesting... since we know TXIDs are 32 bytes, one option would be to do a 32 byte expansion of something like:\r\n\r\nsubstr('abc',3, 1) || substr('abc', 2, 1) || substr('abc', 1,1)\r\n\r\nas a generated virtual table. this would have no storage overhead, but would have some overhead on retrieval.",
      "user": {
        "login": "JeremyRubin",
        "id": 886523,
        "node_id": "MDQ6VXNlcjg4NjUyMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/JeremyRubin",
        "html_url": "https://github.com/JeremyRubin",
        "followers_url": "https://api.github.com/users/JeremyRubin/followers",
        "following_url": "https://api.github.com/users/JeremyRubin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/JeremyRubin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/JeremyRubin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
        "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
        "repos_url": "https://api.github.com/users/JeremyRubin/repos",
        "events_url": "https://api.github.com/users/JeremyRubin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1165804095",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "commented",
      "id": 1276627715,
      "node_id": "IC_kwDOABII585MF8sD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1276627715",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-12T19:14:21Z",
      "updated_at": "2022-10-12T19:14:21Z",
      "author_association": "MEMBER",
      "body": "Are you still working on this?\r\n\r\ncc @jamesob",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1276627715",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "mentioned",
      "id": 7574634793,
      "node_id": "MEE_lADOABII585IUMv_zwAAAAHDe8Ep",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7574634793",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-12T19:14:21Z"
    },
    {
      "event": "subscribed",
      "id": 7574634799,
      "node_id": "SE_lADOABII585IUMv_zwAAAAHDe8Ev",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7574634799",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-12T19:14:21Z"
    },
    {
      "event": "commented",
      "id": 1276638886,
      "node_id": "IC_kwDOABII585MF_am",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1276638886",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-12T19:25:02Z",
      "updated_at": "2022-10-12T19:25:02Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Are you still working on this?\n> \n> \n> \n> cc @jamesob\n\nWill get back to it this week, been busy with other work :)",
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1276638886",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "mentioned",
      "id": 7574700599,
      "node_id": "MEE_lADOABII585IUMv_zwAAAAHDfMI3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7574700599",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-12T19:25:02Z"
    },
    {
      "event": "subscribed",
      "id": 7574700610,
      "node_id": "SE_lADOABII585IUMv_zwAAAAHDfMJC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7574700610",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-12T19:25:02Z"
    },
    {
      "event": "commented",
      "id": 1310623462,
      "node_id": "IC_kwDOABII585OHobm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1310623462",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-10T17:15:27Z",
      "updated_at": "2022-11-10T17:15:27Z",
      "author_association": "MEMBER",
      "body": "> Will get back to it this week, been busy with other work :)\r\n\r\nIt's been several weeks since this comment with no additional updates, so I'm going to close this for now. If you do get around to working on this, please leave a comment so that it can be reopened.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1310623462",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24952"
    },
    {
      "event": "closed",
      "id": 7785433870,
      "node_id": "CE_lADOABII585IUMv_zwAAAAHQDEsO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7785433870",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-10T17:15:27Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/856872979",
      "pull_request_review_id": 950948827,
      "id": 856872979,
      "node_id": "PRRC_kwDOABII584zEtgT",
      "diff_hunk": "@@ -2260,50 +2261,66 @@ static RPCHelpMan dumptxoutset()\n         \"Write the serialized UTXO set to disk.\",\n         {\n             {\"path\", RPCArg::Type::STR, RPCArg::Optional::NO, \"Path to the output file. If relative, will be prefixed by datadir.\"},\n+            {\"format\", RPCArg::Type::STR, RPCArg::Default{\"compact\"}, \"'compact' to output a compact binary serialized format, 'sqlite' to output a SQLite database with table 'txoutset' (requires sqlite3)\", \"format\"},\n         },\n         RPCResult{\n-            RPCResult::Type::OBJ, \"\", \"\",\n-                {\n-                    {RPCResult::Type::NUM, \"coins_written\", \"the number of coins written in the snapshot\"},\n-                    {RPCResult::Type::STR_HEX, \"base_hash\", \"the hash of the base of the snapshot\"},\n-                    {RPCResult::Type::NUM, \"base_height\", \"the height of the base of the snapshot\"},\n-                    {RPCResult::Type::STR, \"path\", \"the absolute path that the snapshot was written to\"},\n-                    {RPCResult::Type::STR_HEX, \"txoutset_hash\", \"the hash of the UTXO set contents\"},\n-                    {RPCResult::Type::NUM, \"nchaintx\", \"the number of transactions in the chain up to and including the base block\"},\n-                }\n-        },\n-        RPCExamples{\n-            HelpExampleCli(\"dumptxoutset\", \"utxo.dat\")\n-        },\n-        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n-{\n-    const ArgsManager& args{EnsureAnyArgsman(request.context)};\n-    const fs::path path = fsbridge::AbsPathJoin(args.GetDataDirNet(), fs::u8path(request.params[0].get_str()));\n-    // Write to a temporary path and then move into `path` on completion\n-    // to avoid confusion due to an interruption.\n-    const fs::path temppath = fsbridge::AbsPathJoin(args.GetDataDirNet(), fs::u8path(request.params[0].get_str() + \".incomplete\"));",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 34,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "eaa4e63dac2bfd32a6457f6bea1dd3d81b0e77ec",
      "in_reply_to_id": null,
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "clang-format-diff.py formatted this and there are some changes. Not ideal for review, but let me know if I should remove the formatting.",
      "created_at": "2022-04-23T09:36:01Z",
      "updated_at": "2022-04-23T09:36:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r856872979",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/856872979"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": 2265,
      "start_side": "LEFT",
      "line": null,
      "original_line": 2252,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857084136",
      "pull_request_review_id": 951166654,
      "id": 857084136,
      "node_id": "PRRC_kwDOABII584zFhDo",
      "diff_hunk": "@@ -31,6 +31,7 @@\n #include <rpc/server_util.h>\n #include <rpc/util.h>\n #include <script/descriptor.h>\n+#include <sqlite3.h>",
      "path": "src/rpc/blockchain.cpp",
      "position": 5,
      "original_position": 4,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "eaa4e63dac2bfd32a6457f6bea1dd3d81b0e77ec",
      "in_reply_to_id": null,
      "user": {
        "login": "0xB10C",
        "id": 19157360,
        "node_id": "MDQ6VXNlcjE5MTU3MzYw",
        "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/0xB10C",
        "html_url": "https://github.com/0xB10C",
        "followers_url": "https://api.github.com/users/0xB10C/followers",
        "following_url": "https://api.github.com/users/0xB10C/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/0xB10C/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/0xB10C/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
        "organizations_url": "https://api.github.com/users/0xB10C/orgs",
        "repos_url": "https://api.github.com/users/0xB10C/repos",
        "events_url": "https://api.github.com/users/0xB10C/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/0xB10C/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think this makes sqlite3 a required dependency for building Bitcoin Core, right?\r\n\r\nSome CI tasks are failing because they don't have `sqlite3.h`.\r\n\r\nhttps://github.com/bitcoin/bitcoin/pull/24952/checks?check_run_id=6139350735\r\n\r\n```\r\nrpc/blockchain.cpp:34:10: fatal error: 'sqlite3.h' file not found\r\n#include <sqlite3.h>\r\n         ^~~~~~~~~~~\r\n```",
      "created_at": "2022-04-24T07:55:11Z",
      "updated_at": "2022-04-24T07:55:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857084136",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857084136"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 35,
      "original_line": 35,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857084596",
      "pull_request_review_id": 951167049,
      "id": 857084596,
      "node_id": "PRRC_kwDOABII584zFhK0",
      "diff_hunk": "@@ -31,6 +31,7 @@\n #include <rpc/server_util.h>\n #include <rpc/util.h>\n #include <script/descriptor.h>\n+#include <sqlite3.h>",
      "path": "src/rpc/blockchain.cpp",
      "position": 5,
      "original_position": 4,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "eaa4e63dac2bfd32a6457f6bea1dd3d81b0e77ec",
      "in_reply_to_id": 857084136,
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Ah, right! Will fix up",
      "created_at": "2022-04-24T07:58:14Z",
      "updated_at": "2022-04-24T07:58:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857084596",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857084596"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 35,
      "original_line": 35,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857092327",
      "pull_request_review_id": 951174036,
      "id": 857092327,
      "node_id": "PRRC_kwDOABII584zFjDn",
      "diff_hunk": "@@ -2340,30 +2357,107 @@ UniValue CreateUTXOSnapshot(\n         CHECK_NONFATAL(tip);\n     }\n \n-    LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n-        tip->nHeight, tip->GetBlockHash().ToString(),\n-        fs::PathToString(path), fs::PathToString(temppath)));\n+    if (is_compact) {\n+        LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n+                                   tip->nHeight, tip->GetBlockHash().ToString(),\n+                                   fs::PathToString(path), fs::PathToString(temppath)));\n+        SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n \n-    SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n+        afile << metadata;\n \n-    afile << metadata;\n+        COutPoint key;\n+        Coin coin;\n+        unsigned int iter{0};\n+\n+        while (pcursor->Valid()) {\n+            if (iter % 5000 == 0) node.rpc_interruption_point();\n+            ++iter;\n+            if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n+                afile << key;\n+                afile << coin;\n+            }\n \n-    COutPoint key;\n-    Coin coin;\n-    unsigned int iter{0};\n-\n-    while (pcursor->Valid()) {\n-        if (iter % 5000 == 0) node.rpc_interruption_point();\n-        ++iter;\n-        if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n-            afile << key;\n-            afile << coin;\n+            pcursor->Next();\n         }\n \n-        pcursor->Next();\n-    }\n+        afile.fclose();\n+    } else {\n+        LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to sqlite DB file %s\",\n+                                   tip->nHeight, tip->GetBlockHash().ToString(), fs::PathToString(path)));\n+\n+        sqlite3* db;\n+        int ret;\n+\n+        if (!ValidAsCString(path)) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid path\");\n+        }\n+\n+        ret = sqlite3_open(path.c_str(), &db);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"Unable to open database file %s\", path.u8string()));\n+        }\n+\n+        ret = sqlite3_exec(db, \"PRAGMA journal_mode=wal2;\", nullptr, nullptr, nullptr);",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 172,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "eaa4e63dac2bfd32a6457f6bea1dd3d81b0e77ec",
      "in_reply_to_id": null,
      "user": {
        "login": "prusnak",
        "id": 42201,
        "node_id": "MDQ6VXNlcjQyMjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/prusnak",
        "html_url": "https://github.com/prusnak",
        "followers_url": "https://api.github.com/users/prusnak/followers",
        "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
        "organizations_url": "https://api.github.com/users/prusnak/orgs",
        "repos_url": "https://api.github.com/users/prusnak/repos",
        "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/prusnak/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Please add comment explaining why we want `journal_mode` set to `wal2` and ideally add a link to SQLite documentation: https://www.sqlite.org/cgi/src/doc/wal2/doc/wal2.md",
      "created_at": "2022-04-24T08:55:46Z",
      "updated_at": "2022-04-24T11:30:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857092327",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857092327"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2397,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857111827",
      "pull_request_review_id": 951192093,
      "id": 857111827,
      "node_id": "PRRC_kwDOABII584zFn0T",
      "diff_hunk": "@@ -2260,50 +2261,66 @@ static RPCHelpMan dumptxoutset()\n         \"Write the serialized UTXO set to disk.\",\n         {\n             {\"path\", RPCArg::Type::STR, RPCArg::Optional::NO, \"Path to the output file. If relative, will be prefixed by datadir.\"},\n+            {\"format\", RPCArg::Type::STR, RPCArg::Default{\"compact\"}, \"'compact' to output a compact binary serialized format, 'sqlite' to output a SQLite database with table 'txoutset' (requires sqlite3)\", \"format\"},\n         },\n         RPCResult{\n-            RPCResult::Type::OBJ, \"\", \"\",\n-                {\n-                    {RPCResult::Type::NUM, \"coins_written\", \"the number of coins written in the snapshot\"},\n-                    {RPCResult::Type::STR_HEX, \"base_hash\", \"the hash of the base of the snapshot\"},\n-                    {RPCResult::Type::NUM, \"base_height\", \"the height of the base of the snapshot\"},\n-                    {RPCResult::Type::STR, \"path\", \"the absolute path that the snapshot was written to\"},\n-                    {RPCResult::Type::STR_HEX, \"txoutset_hash\", \"the hash of the UTXO set contents\"},\n-                    {RPCResult::Type::NUM, \"nchaintx\", \"the number of transactions in the chain up to and including the base block\"},\n-                }\n-        },\n-        RPCExamples{\n-            HelpExampleCli(\"dumptxoutset\", \"utxo.dat\")\n-        },\n-        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n-{\n-    const ArgsManager& args{EnsureAnyArgsman(request.context)};\n-    const fs::path path = fsbridge::AbsPathJoin(args.GetDataDirNet(), fs::u8path(request.params[0].get_str()));\n-    // Write to a temporary path and then move into `path` on completion\n-    // to avoid confusion due to an interruption.\n-    const fs::path temppath = fsbridge::AbsPathJoin(args.GetDataDirNet(), fs::u8path(request.params[0].get_str() + \".incomplete\"));",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 34,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "eaa4e63dac2bfd32a6457f6bea1dd3d81b0e77ec",
      "in_reply_to_id": 856872979,
      "user": {
        "login": "prusnak",
        "id": 42201,
        "node_id": "MDQ6VXNlcjQyMjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/prusnak",
        "html_url": "https://github.com/prusnak",
        "followers_url": "https://api.github.com/users/prusnak/followers",
        "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
        "organizations_url": "https://api.github.com/users/prusnak/orgs",
        "repos_url": "https://api.github.com/users/prusnak/repos",
        "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/prusnak/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The review would be so much easier if you reverted the formatting changes.",
      "created_at": "2022-04-24T11:32:03Z",
      "updated_at": "2022-04-24T11:32:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857111827",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857111827"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": 2265,
      "start_side": "LEFT",
      "line": null,
      "original_line": 2252,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857112165",
      "pull_request_review_id": 951192349,
      "id": 857112165,
      "node_id": "PRRC_kwDOABII584zFn5l",
      "diff_hunk": "@@ -27,6 +27,7 @@ struct NodeContext;\n } // namespace node\n \n static constexpr int NUM_GETBLOCKSTATS_PERCENTILES = 5;\n+using coinsqlite_cb_t = std::function<std::string(const COutPoint&, const Coin&)>;",
      "path": "src/rpc/blockchain.h",
      "position": null,
      "original_position": 4,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "21ee90dda3daed0bc3d7063dfc2118537df08273",
      "in_reply_to_id": null,
      "user": {
        "login": "prusnak",
        "id": 42201,
        "node_id": "MDQ6VXNlcjQyMjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/prusnak",
        "html_url": "https://github.com/prusnak",
        "followers_url": "https://api.github.com/users/prusnak/followers",
        "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
        "organizations_url": "https://api.github.com/users/prusnak/orgs",
        "repos_url": "https://api.github.com/users/prusnak/repos",
        "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/prusnak/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Is this used anywhere?",
      "created_at": "2022-04-24T11:34:06Z",
      "updated_at": "2022-04-24T11:34:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857112165",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857112165"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 30,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857112469",
      "pull_request_review_id": 951192617,
      "id": 857112469,
      "node_id": "PRRC_kwDOABII584zFn-V",
      "diff_hunk": "@@ -27,6 +27,7 @@ struct NodeContext;\n } // namespace node\n \n static constexpr int NUM_GETBLOCKSTATS_PERCENTILES = 5;\n+using coinsqlite_cb_t = std::function<std::string(const COutPoint&, const Coin&)>;",
      "path": "src/rpc/blockchain.h",
      "position": null,
      "original_position": 4,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "21ee90dda3daed0bc3d7063dfc2118537df08273",
      "in_reply_to_id": 857112165,
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Ah, not anymore. Was going to have configurable fields like in the CSV PR, but decided against it otherwise things would get a little too complex here.\n\nWill remove 👍",
      "created_at": "2022-04-24T11:36:19Z",
      "updated_at": "2022-04-24T11:36:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857112469",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857112469"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 30,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857112482",
      "pull_request_review_id": 951192636,
      "id": 857112482,
      "node_id": "PRRC_kwDOABII584zFn-i",
      "diff_hunk": "@@ -53,6 +54,7 @@ void CalculatePercentilesByWeight(CAmount result[NUM_GETBLOCKSTATS_PERCENTILES],\n  * @return a UniValue map containing metadata about the snapshot.\n  */\n UniValue CreateUTXOSnapshot(\n+    const bool is_compact,",
      "path": "src/rpc/blockchain.h",
      "position": null,
      "original_position": 12,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "21ee90dda3daed0bc3d7063dfc2118537df08273",
      "in_reply_to_id": null,
      "user": {
        "login": "prusnak",
        "id": 42201,
        "node_id": "MDQ6VXNlcjQyMjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/prusnak",
        "html_url": "https://github.com/prusnak",
        "followers_url": "https://api.github.com/users/prusnak/followers",
        "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
        "organizations_url": "https://api.github.com/users/prusnak/orgs",
        "repos_url": "https://api.github.com/users/prusnak/repos",
        "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/prusnak/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "maybe `enum UTXOSnapshotFormat { FORMAT_COMPACT = 0, FORMAT_SQLITE = 1 };` instead of `bool` would be nicer and more explicit?",
      "created_at": "2022-04-24T11:36:29Z",
      "updated_at": "2022-04-24T11:38:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857112482",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857112482"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 57,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857112721",
      "pull_request_review_id": 951192878,
      "id": 857112721,
      "node_id": "PRRC_kwDOABII584zFoCR",
      "diff_hunk": "@@ -53,6 +54,7 @@ void CalculatePercentilesByWeight(CAmount result[NUM_GETBLOCKSTATS_PERCENTILES],\n  * @return a UniValue map containing metadata about the snapshot.\n  */\n UniValue CreateUTXOSnapshot(\n+    const bool is_compact,",
      "path": "src/rpc/blockchain.h",
      "position": null,
      "original_position": 12,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "21ee90dda3daed0bc3d7063dfc2118537df08273",
      "in_reply_to_id": 857112482,
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yes, I agree. I was going back and forth between them but I think explicit is better here. Would be easier to introduce another format in the future too. Will change 👍",
      "created_at": "2022-04-24T11:38:26Z",
      "updated_at": "2022-04-24T11:38:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857112721",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857112721"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 57,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857113355",
      "pull_request_review_id": 951193390,
      "id": 857113355,
      "node_id": "PRRC_kwDOABII584zFoML",
      "diff_hunk": "@@ -2340,30 +2357,107 @@ UniValue CreateUTXOSnapshot(\n         CHECK_NONFATAL(tip);\n     }\n \n-    LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n-        tip->nHeight, tip->GetBlockHash().ToString(),\n-        fs::PathToString(path), fs::PathToString(temppath)));\n+    if (is_compact) {\n+        LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n+                                   tip->nHeight, tip->GetBlockHash().ToString(),\n+                                   fs::PathToString(path), fs::PathToString(temppath)));\n+        SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n \n-    SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n+        afile << metadata;\n \n-    afile << metadata;\n+        COutPoint key;\n+        Coin coin;\n+        unsigned int iter{0};\n+\n+        while (pcursor->Valid()) {\n+            if (iter % 5000 == 0) node.rpc_interruption_point();\n+            ++iter;\n+            if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n+                afile << key;\n+                afile << coin;\n+            }\n \n-    COutPoint key;\n-    Coin coin;\n-    unsigned int iter{0};\n-\n-    while (pcursor->Valid()) {\n-        if (iter % 5000 == 0) node.rpc_interruption_point();\n-        ++iter;\n-        if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n-            afile << key;\n-            afile << coin;\n+            pcursor->Next();\n         }\n \n-        pcursor->Next();\n-    }\n+        afile.fclose();\n+    } else {\n+        LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to sqlite DB file %s\",\n+                                   tip->nHeight, tip->GetBlockHash().ToString(), fs::PathToString(path)));\n+\n+        sqlite3* db;\n+        int ret;\n+\n+        if (!ValidAsCString(path)) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid path\");\n+        }\n+\n+        ret = sqlite3_open(path.c_str(), &db);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"Unable to open database file %s\", path.u8string()));\n+        }\n+\n+        ret = sqlite3_exec(db, \"PRAGMA journal_mode=wal2;\", nullptr, nullptr, nullptr);",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 172,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "eaa4e63dac2bfd32a6457f6bea1dd3d81b0e77ec",
      "in_reply_to_id": 857092327,
      "user": {
        "login": "prusnak",
        "id": 42201,
        "node_id": "MDQ6VXNlcjQyMjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/prusnak",
        "html_url": "https://github.com/prusnak",
        "followers_url": "https://api.github.com/users/prusnak/followers",
        "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
        "organizations_url": "https://api.github.com/users/prusnak/orgs",
        "repos_url": "https://api.github.com/users/prusnak/repos",
        "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/prusnak/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Btw, isn't `journal_mode = off` even better match for what we want? I think that not using journal might significantly improve write performance.",
      "created_at": "2022-04-24T11:43:17Z",
      "updated_at": "2022-04-24T11:48:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857113355",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857113355"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2397,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857113983",
      "pull_request_review_id": 951193961,
      "id": 857113983,
      "node_id": "PRRC_kwDOABII584zFoV_",
      "diff_hunk": "@@ -2340,30 +2357,107 @@ UniValue CreateUTXOSnapshot(\n         CHECK_NONFATAL(tip);\n     }\n \n-    LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n-        tip->nHeight, tip->GetBlockHash().ToString(),\n-        fs::PathToString(path), fs::PathToString(temppath)));\n+    if (is_compact) {\n+        LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n+                                   tip->nHeight, tip->GetBlockHash().ToString(),\n+                                   fs::PathToString(path), fs::PathToString(temppath)));\n+        SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n \n-    SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n+        afile << metadata;\n \n-    afile << metadata;\n+        COutPoint key;\n+        Coin coin;\n+        unsigned int iter{0};\n+\n+        while (pcursor->Valid()) {\n+            if (iter % 5000 == 0) node.rpc_interruption_point();\n+            ++iter;\n+            if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n+                afile << key;\n+                afile << coin;\n+            }\n \n-    COutPoint key;\n-    Coin coin;\n-    unsigned int iter{0};\n-\n-    while (pcursor->Valid()) {\n-        if (iter % 5000 == 0) node.rpc_interruption_point();\n-        ++iter;\n-        if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n-            afile << key;\n-            afile << coin;\n+            pcursor->Next();\n         }\n \n-        pcursor->Next();\n-    }\n+        afile.fclose();\n+    } else {\n+        LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to sqlite DB file %s\",\n+                                   tip->nHeight, tip->GetBlockHash().ToString(), fs::PathToString(path)));\n+\n+        sqlite3* db;\n+        int ret;\n+\n+        if (!ValidAsCString(path)) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid path\");\n+        }\n+\n+        ret = sqlite3_open(path.c_str(), &db);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"Unable to open database file %s\", path.u8string()));\n+        }\n+\n+        ret = sqlite3_exec(db, \"PRAGMA journal_mode=wal2;\", nullptr, nullptr, nullptr);",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 172,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "eaa4e63dac2bfd32a6457f6bea1dd3d81b0e77ec",
      "in_reply_to_id": 857092327,
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yeah, we don't need/use rollbacks. It's just an export so that makes sense.",
      "created_at": "2022-04-24T11:48:03Z",
      "updated_at": "2022-04-24T11:48:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857113983",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857113983"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2397,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857116269",
      "pull_request_review_id": 951196090,
      "id": 857116269,
      "node_id": "PRRC_kwDOABII584zFo5t",
      "diff_hunk": "@@ -31,6 +31,7 @@\n #include <rpc/server_util.h>\n #include <rpc/util.h>\n #include <script/descriptor.h>\n+#include <sqlite3.h>",
      "path": "src/rpc/blockchain.cpp",
      "position": 5,
      "original_position": 4,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "eaa4e63dac2bfd32a6457f6bea1dd3d81b0e77ec",
      "in_reply_to_id": 857084136,
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Forgot to handle the SQLITE_* constants too. Will fix up.",
      "created_at": "2022-04-24T12:06:27Z",
      "updated_at": "2022-04-24T12:06:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857116269",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857116269"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 35,
      "original_line": 35,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857165124",
      "pull_request_review_id": 951238457,
      "id": 857165124,
      "node_id": "PRRC_kwDOABII584zF01E",
      "diff_hunk": "@@ -2340,30 +2357,107 @@ UniValue CreateUTXOSnapshot(\n         CHECK_NONFATAL(tip);\n     }\n \n-    LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n-        tip->nHeight, tip->GetBlockHash().ToString(),\n-        fs::PathToString(path), fs::PathToString(temppath)));\n+    if (is_compact) {\n+        LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n+                                   tip->nHeight, tip->GetBlockHash().ToString(),\n+                                   fs::PathToString(path), fs::PathToString(temppath)));\n+        SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n \n-    SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n+        afile << metadata;\n \n-    afile << metadata;\n+        COutPoint key;\n+        Coin coin;\n+        unsigned int iter{0};\n+\n+        while (pcursor->Valid()) {\n+            if (iter % 5000 == 0) node.rpc_interruption_point();\n+            ++iter;\n+            if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n+                afile << key;\n+                afile << coin;\n+            }\n \n-    COutPoint key;\n-    Coin coin;\n-    unsigned int iter{0};\n-\n-    while (pcursor->Valid()) {\n-        if (iter % 5000 == 0) node.rpc_interruption_point();\n-        ++iter;\n-        if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n-            afile << key;\n-            afile << coin;\n+            pcursor->Next();\n         }\n \n-        pcursor->Next();\n-    }\n+        afile.fclose();\n+    } else {\n+        LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to sqlite DB file %s\",\n+                                   tip->nHeight, tip->GetBlockHash().ToString(), fs::PathToString(path)));\n+\n+        sqlite3* db;\n+        int ret;\n+\n+        if (!ValidAsCString(path)) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid path\");\n+        }\n+\n+        ret = sqlite3_open(path.c_str(), &db);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"Unable to open database file %s\", path.u8string()));\n+        }\n+\n+        ret = sqlite3_exec(db, \"PRAGMA journal_mode=wal2;\", nullptr, nullptr, nullptr);",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 172,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "eaa4e63dac2bfd32a6457f6bea1dd3d81b0e77ec",
      "in_reply_to_id": 857092327,
      "user": {
        "login": "prusnak",
        "id": 42201,
        "node_id": "MDQ6VXNlcjQyMjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/prusnak",
        "html_url": "https://github.com/prusnak",
        "followers_url": "https://api.github.com/users/prusnak/followers",
        "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
        "organizations_url": "https://api.github.com/users/prusnak/orgs",
        "repos_url": "https://api.github.com/users/prusnak/repos",
        "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/prusnak/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I see this is now addressed in 84a6e28a8536fdc79796856e36be86a3bffe1848, thanks!",
      "created_at": "2022-04-24T18:52:45Z",
      "updated_at": "2022-04-24T18:52:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857165124",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857165124"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2397,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857165246",
      "pull_request_review_id": 951238544,
      "id": 857165246,
      "node_id": "PRRC_kwDOABII584zF02-",
      "diff_hunk": "@@ -27,6 +27,7 @@ struct NodeContext;\n } // namespace node\n \n static constexpr int NUM_GETBLOCKSTATS_PERCENTILES = 5;\n+using coinsqlite_cb_t = std::function<std::string(const COutPoint&, const Coin&)>;",
      "path": "src/rpc/blockchain.h",
      "position": null,
      "original_position": 4,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "21ee90dda3daed0bc3d7063dfc2118537df08273",
      "in_reply_to_id": 857112165,
      "user": {
        "login": "prusnak",
        "id": 42201,
        "node_id": "MDQ6VXNlcjQyMjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/prusnak",
        "html_url": "https://github.com/prusnak",
        "followers_url": "https://api.github.com/users/prusnak/followers",
        "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
        "organizations_url": "https://api.github.com/users/prusnak/orgs",
        "repos_url": "https://api.github.com/users/prusnak/repos",
        "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/prusnak/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I see this is now addressed in 84a6e28a8536fdc79796856e36be86a3bffe1848, thanks!",
      "created_at": "2022-04-24T18:53:42Z",
      "updated_at": "2022-04-24T18:53:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857165246",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857165246"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 30,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857165249",
      "pull_request_review_id": 951238549,
      "id": 857165249,
      "node_id": "PRRC_kwDOABII584zF03B",
      "diff_hunk": "@@ -53,6 +54,7 @@ void CalculatePercentilesByWeight(CAmount result[NUM_GETBLOCKSTATS_PERCENTILES],\n  * @return a UniValue map containing metadata about the snapshot.\n  */\n UniValue CreateUTXOSnapshot(\n+    const bool is_compact,",
      "path": "src/rpc/blockchain.h",
      "position": null,
      "original_position": 12,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "21ee90dda3daed0bc3d7063dfc2118537df08273",
      "in_reply_to_id": 857112482,
      "user": {
        "login": "prusnak",
        "id": 42201,
        "node_id": "MDQ6VXNlcjQyMjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/prusnak",
        "html_url": "https://github.com/prusnak",
        "followers_url": "https://api.github.com/users/prusnak/followers",
        "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
        "organizations_url": "https://api.github.com/users/prusnak/orgs",
        "repos_url": "https://api.github.com/users/prusnak/repos",
        "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/prusnak/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I see this is now addressed in 84a6e28a8536fdc79796856e36be86a3bffe1848, thanks!",
      "created_at": "2022-04-24T18:53:48Z",
      "updated_at": "2022-04-24T18:53:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857165249",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857165249"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 57,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857165927",
      "pull_request_review_id": 951239009,
      "id": 857165927,
      "node_id": "PRRC_kwDOABII584zF1Bn",
      "diff_hunk": "@@ -2260,50 +2261,66 @@ static RPCHelpMan dumptxoutset()\n         \"Write the serialized UTXO set to disk.\",\n         {\n             {\"path\", RPCArg::Type::STR, RPCArg::Optional::NO, \"Path to the output file. If relative, will be prefixed by datadir.\"},\n+            {\"format\", RPCArg::Type::STR, RPCArg::Default{\"compact\"}, \"'compact' to output a compact binary serialized format, 'sqlite' to output a SQLite database with table 'txoutset' (requires sqlite3)\", \"format\"},\n         },\n         RPCResult{\n-            RPCResult::Type::OBJ, \"\", \"\",\n-                {\n-                    {RPCResult::Type::NUM, \"coins_written\", \"the number of coins written in the snapshot\"},\n-                    {RPCResult::Type::STR_HEX, \"base_hash\", \"the hash of the base of the snapshot\"},\n-                    {RPCResult::Type::NUM, \"base_height\", \"the height of the base of the snapshot\"},\n-                    {RPCResult::Type::STR, \"path\", \"the absolute path that the snapshot was written to\"},\n-                    {RPCResult::Type::STR_HEX, \"txoutset_hash\", \"the hash of the UTXO set contents\"},\n-                    {RPCResult::Type::NUM, \"nchaintx\", \"the number of transactions in the chain up to and including the base block\"},\n-                }\n-        },\n-        RPCExamples{\n-            HelpExampleCli(\"dumptxoutset\", \"utxo.dat\")\n-        },\n-        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n-{\n-    const ArgsManager& args{EnsureAnyArgsman(request.context)};\n-    const fs::path path = fsbridge::AbsPathJoin(args.GetDataDirNet(), fs::u8path(request.params[0].get_str()));\n-    // Write to a temporary path and then move into `path` on completion\n-    // to avoid confusion due to an interruption.\n-    const fs::path temppath = fsbridge::AbsPathJoin(args.GetDataDirNet(), fs::u8path(request.params[0].get_str() + \".incomplete\"));",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 34,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "eaa4e63dac2bfd32a6457f6bea1dd3d81b0e77ec",
      "in_reply_to_id": 856872979,
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Hmm, sorry. This comment missed my eye. I can revert this. Will push with the Win64 errors I figured out.",
      "created_at": "2022-04-24T18:59:51Z",
      "updated_at": "2022-04-24T19:00:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857165927",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857165927"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": 2265,
      "start_side": "LEFT",
      "line": null,
      "original_line": 2252,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857169783",
      "pull_request_review_id": 951242023,
      "id": 857169783,
      "node_id": "PRRC_kwDOABII584zF193",
      "diff_hunk": "@@ -2260,50 +2261,66 @@ static RPCHelpMan dumptxoutset()\n         \"Write the serialized UTXO set to disk.\",\n         {\n             {\"path\", RPCArg::Type::STR, RPCArg::Optional::NO, \"Path to the output file. If relative, will be prefixed by datadir.\"},\n+            {\"format\", RPCArg::Type::STR, RPCArg::Default{\"compact\"}, \"'compact' to output a compact binary serialized format, 'sqlite' to output a SQLite database with table 'txoutset' (requires sqlite3)\", \"format\"},\n         },\n         RPCResult{\n-            RPCResult::Type::OBJ, \"\", \"\",\n-                {\n-                    {RPCResult::Type::NUM, \"coins_written\", \"the number of coins written in the snapshot\"},\n-                    {RPCResult::Type::STR_HEX, \"base_hash\", \"the hash of the base of the snapshot\"},\n-                    {RPCResult::Type::NUM, \"base_height\", \"the height of the base of the snapshot\"},\n-                    {RPCResult::Type::STR, \"path\", \"the absolute path that the snapshot was written to\"},\n-                    {RPCResult::Type::STR_HEX, \"txoutset_hash\", \"the hash of the UTXO set contents\"},\n-                    {RPCResult::Type::NUM, \"nchaintx\", \"the number of transactions in the chain up to and including the base block\"},\n-                }\n-        },\n-        RPCExamples{\n-            HelpExampleCli(\"dumptxoutset\", \"utxo.dat\")\n-        },\n-        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n-{\n-    const ArgsManager& args{EnsureAnyArgsman(request.context)};\n-    const fs::path path = fsbridge::AbsPathJoin(args.GetDataDirNet(), fs::u8path(request.params[0].get_str()));\n-    // Write to a temporary path and then move into `path` on completion\n-    // to avoid confusion due to an interruption.\n-    const fs::path temppath = fsbridge::AbsPathJoin(args.GetDataDirNet(), fs::u8path(request.params[0].get_str() + \".incomplete\"));",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 34,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "eaa4e63dac2bfd32a6457f6bea1dd3d81b0e77ec",
      "in_reply_to_id": 856872979,
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Reverted formatting. Should be much clearer now :)",
      "created_at": "2022-04-24T19:35:17Z",
      "updated_at": "2022-04-24T19:35:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857169783",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857169783"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": 2265,
      "start_side": "LEFT",
      "line": null,
      "original_line": 2252,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857179874",
      "pull_request_review_id": 951249602,
      "id": 857179874,
      "node_id": "PRRC_kwDOABII584zF4bi",
      "diff_hunk": "@@ -2334,30 +2362,117 @@ UniValue CreateUTXOSnapshot(\n         tip = CHECK_NONFATAL(chainstate.m_blockman.LookupBlockIndex(stats.hashBlock));\n     }\n \n-    LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n-        tip->nHeight, tip->GetBlockHash().ToString(),\n-        fs::PathToString(path), fs::PathToString(temppath)));\n-\n-    SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n+    switch (format) {\n+    case UTXOSnapshotFormat::COMPACT:\n+        {\n+            LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n+                                    tip->nHeight, tip->GetBlockHash().ToString(),\n+                                    fs::PathToString(path), fs::PathToString(temppath)));\n+            SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n+\n+            afile << metadata;\n+\n+            COutPoint key;\n+            Coin coin;\n+            unsigned int iter{0};\n+\n+            while (pcursor->Valid()) {\n+                if (iter % 5000 == 0) node.rpc_interruption_point();\n+                ++iter;\n+                if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n+                    afile << key;\n+                    afile << coin;\n+                }\n \n-    afile << metadata;\n+                pcursor->Next();\n+            }\n \n-    COutPoint key;\n-    Coin coin;\n-    unsigned int iter{0};\n-\n-    while (pcursor->Valid()) {\n-        if (iter % 5000 == 0) node.rpc_interruption_point();\n-        ++iter;\n-        if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n-            afile << key;\n-            afile << coin;\n+            afile.fclose();\n+            break;\n         }\n+    case UTXOSnapshotFormat::SQLITE:\n+        {\n+#ifdef USE_SQLITE\n+            LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to sqlite DB file %s\",\n+                                    tip->nHeight, tip->GetBlockHash().ToString(), fs::PathToString(path)));\n \n-        pcursor->Next();\n-    }\n+            sqlite3* db;\n+            int ret;\n+\n+            if (!ValidAsCString(fs::PathToString(path))) {\n+                throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid path\");\n+            }\n+\n+            ret = sqlite3_open(fs::PathToString(path).c_str(), &db);\n+            if (ret != SQLITE_OK) {\n+                sqlite3_close(db);\n+                throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"Unable to open database file %s\", path.u8string()));\n+            }\n \n-    afile.fclose();\n+            // We have no need for rollbacks here, so we can set the `journal_mode` to 'off'. See: https://www.sqlite.org/pragma.html#pragma_journal_mode\n+            ret = sqlite3_exec(db, \"PRAGMA journal_mode=off;\", nullptr, nullptr, nullptr);\n+            if (ret != SQLITE_OK) {\n+                throw std::runtime_error(strprintf(\"SQLiteDatabase: Failed to set wal2: %s\\n\", sqlite3_errstr(ret)));",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 147,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "889f6c719dbd2bca5f38a6a5a89f39fb4639558f",
      "in_reply_to_id": null,
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think wal2 is a hangover from a previous version here",
      "created_at": "2022-04-24T21:12:38Z",
      "updated_at": "2022-04-24T21:38:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857179874",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857179874"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2415,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857180920",
      "pull_request_review_id": 951249602,
      "id": 857180920,
      "node_id": "PRRC_kwDOABII584zF4r4",
      "diff_hunk": "@@ -2289,8 +2308,16 @@ static RPCHelpMan dumptxoutset()\n     CAutoFile afile{file, SER_DISK, CLIENT_VERSION};\n     NodeContext& node = EnsureAnyNodeContext(request.context);\n     UniValue result = CreateUTXOSnapshot(\n-        node, node.chainman->ActiveChainstate(), afile, path, temppath);\n-    fs::rename(temppath, path);\n+        format, node, node.chainman->ActiveChainstate(), afile, path, temppath);\n+\n+    switch (format) {\n+    case UTXOSnapshotFormat::COMPACT:\n+        fs::rename(temppath, path);\n+        break;\n+    case UTXOSnapshotFormat::SQLITE:\n+        fs::remove(temppath);",
      "path": "src/rpc/blockchain.cpp",
      "position": 65,
      "original_position": 60,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "889f6c719dbd2bca5f38a6a5a89f39fb4639558f",
      "in_reply_to_id": null,
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "curious why we don't use the temppath for sqlite like we do on compact?",
      "created_at": "2022-04-24T21:24:41Z",
      "updated_at": "2022-04-24T21:38:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857180920",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857180920"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2300,
      "original_line": 2300,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857223170",
      "pull_request_review_id": 951297236,
      "id": 857223170,
      "node_id": "PRRC_kwDOABII584zGDAC",
      "diff_hunk": "@@ -2289,8 +2308,16 @@ static RPCHelpMan dumptxoutset()\n     CAutoFile afile{file, SER_DISK, CLIENT_VERSION};\n     NodeContext& node = EnsureAnyNodeContext(request.context);\n     UniValue result = CreateUTXOSnapshot(\n-        node, node.chainman->ActiveChainstate(), afile, path, temppath);\n-    fs::rename(temppath, path);\n+        format, node, node.chainman->ActiveChainstate(), afile, path, temppath);\n+\n+    switch (format) {\n+    case UTXOSnapshotFormat::COMPACT:\n+        fs::rename(temppath, path);\n+        break;\n+    case UTXOSnapshotFormat::SQLITE:\n+        fs::remove(temppath);",
      "path": "src/rpc/blockchain.cpp",
      "position": 65,
      "original_position": 60,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "889f6c719dbd2bca5f38a6a5a89f39fb4639558f",
      "in_reply_to_id": 857180920,
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`temppath` adds \".incomplete\" to the end of the filename.\r\n`path` is the path entered by the user, so the database is created using this parameter.\r\n\r\n`temppath` can eventually be removed from `CreateUTXOSnapshot()` as this parameter is used only once and for logging purposes. I think the same information can be obtained from `afile` as it is created from `temppath`.\r\n\r\n\r\n\r\n",
      "created_at": "2022-04-25T02:39:35Z",
      "updated_at": "2022-04-25T02:40:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857223170",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857223170"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2300,
      "original_line": 2300,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857340250",
      "pull_request_review_id": 951459500,
      "id": 857340250,
      "node_id": "PRRC_kwDOABII584zGfla",
      "diff_hunk": "@@ -2269,6 +2273,7 @@ static RPCHelpMan dumptxoutset()\n         },\n         RPCExamples{\n             HelpExampleCli(\"dumptxoutset\", \"utxo.dat\")\n+    + HelpExampleCli(\"dumptxoutset\", \"\\\"utxo.db\\\" \\\"sqlite\\\"\")",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 22,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "889f6c719dbd2bca5f38a6a5a89f39fb4639558f",
      "in_reply_to_id": null,
      "user": {
        "login": "prusnak",
        "id": 42201,
        "node_id": "MDQ6VXNlcjQyMjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/prusnak",
        "html_url": "https://github.com/prusnak",
        "followers_url": "https://api.github.com/users/prusnak/followers",
        "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
        "organizations_url": "https://api.github.com/users/prusnak/orgs",
        "repos_url": "https://api.github.com/users/prusnak/repos",
        "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/prusnak/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Formatting nit-pick:\r\n```suggestion\r\n            HelpExampleCli(\"dumptxoutset\", \"utxo.dat\") +\r\n            HelpExampleCli(\"dumptxoutset\", \"\\\"utxo.db\\\" \\\"sqlite\\\"\")\r\n```",
      "created_at": "2022-04-25T07:40:55Z",
      "updated_at": "2022-04-25T07:43:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857340250",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857340250"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": 2275,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2276,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857428712",
      "pull_request_review_id": 951582746,
      "id": 857428712,
      "node_id": "PRRC_kwDOABII584zG1Lo",
      "diff_hunk": "@@ -2289,8 +2308,16 @@ static RPCHelpMan dumptxoutset()\n     CAutoFile afile{file, SER_DISK, CLIENT_VERSION};\n     NodeContext& node = EnsureAnyNodeContext(request.context);\n     UniValue result = CreateUTXOSnapshot(\n-        node, node.chainman->ActiveChainstate(), afile, path, temppath);\n-    fs::rename(temppath, path);\n+        format, node, node.chainman->ActiveChainstate(), afile, path, temppath);\n+\n+    switch (format) {\n+    case UTXOSnapshotFormat::COMPACT:\n+        fs::rename(temppath, path);\n+        break;\n+    case UTXOSnapshotFormat::SQLITE:\n+        fs::remove(temppath);",
      "path": "src/rpc/blockchain.cpp",
      "position": 65,
      "original_position": 60,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "889f6c719dbd2bca5f38a6a5a89f39fb4639558f",
      "in_reply_to_id": 857180920,
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yes, it's not used in SQLite branch (nothing actually gets written to it), but it is somewhat tightly coupled, and since we need to do the USE_SQLITE check, it makes it a little difficult to completely decouple. So I just thought to remove it at the end. Acts as a decent indicator that nothing bad happened too (although redundant).\r\n\r\nMaybe this can be refactored in the future if we don't want it.",
      "created_at": "2022-04-25T09:25:23Z",
      "updated_at": "2022-04-25T09:25:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857428712",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857428712"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2300,
      "original_line": 2300,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857429350",
      "pull_request_review_id": 951583527,
      "id": 857429350,
      "node_id": "PRRC_kwDOABII584zG1Vm",
      "diff_hunk": "@@ -2334,30 +2362,117 @@ UniValue CreateUTXOSnapshot(\n         tip = CHECK_NONFATAL(chainstate.m_blockman.LookupBlockIndex(stats.hashBlock));\n     }\n \n-    LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n-        tip->nHeight, tip->GetBlockHash().ToString(),\n-        fs::PathToString(path), fs::PathToString(temppath)));\n-\n-    SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n+    switch (format) {\n+    case UTXOSnapshotFormat::COMPACT:\n+        {\n+            LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n+                                    tip->nHeight, tip->GetBlockHash().ToString(),\n+                                    fs::PathToString(path), fs::PathToString(temppath)));\n+            SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n+\n+            afile << metadata;\n+\n+            COutPoint key;\n+            Coin coin;\n+            unsigned int iter{0};\n+\n+            while (pcursor->Valid()) {\n+                if (iter % 5000 == 0) node.rpc_interruption_point();\n+                ++iter;\n+                if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n+                    afile << key;\n+                    afile << coin;\n+                }\n \n-    afile << metadata;\n+                pcursor->Next();\n+            }\n \n-    COutPoint key;\n-    Coin coin;\n-    unsigned int iter{0};\n-\n-    while (pcursor->Valid()) {\n-        if (iter % 5000 == 0) node.rpc_interruption_point();\n-        ++iter;\n-        if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n-            afile << key;\n-            afile << coin;\n+            afile.fclose();\n+            break;\n         }\n+    case UTXOSnapshotFormat::SQLITE:\n+        {\n+#ifdef USE_SQLITE\n+            LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to sqlite DB file %s\",\n+                                    tip->nHeight, tip->GetBlockHash().ToString(), fs::PathToString(path)));\n \n-        pcursor->Next();\n-    }\n+            sqlite3* db;\n+            int ret;\n+\n+            if (!ValidAsCString(fs::PathToString(path))) {\n+                throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid path\");\n+            }\n+\n+            ret = sqlite3_open(fs::PathToString(path).c_str(), &db);\n+            if (ret != SQLITE_OK) {\n+                sqlite3_close(db);\n+                throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"Unable to open database file %s\", path.u8string()));\n+            }\n \n-    afile.fclose();\n+            // We have no need for rollbacks here, so we can set the `journal_mode` to 'off'. See: https://www.sqlite.org/pragma.html#pragma_journal_mode\n+            ret = sqlite3_exec(db, \"PRAGMA journal_mode=off;\", nullptr, nullptr, nullptr);\n+            if (ret != SQLITE_OK) {\n+                throw std::runtime_error(strprintf(\"SQLiteDatabase: Failed to set wal2: %s\\n\", sqlite3_errstr(ret)));",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 147,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "889f6c719dbd2bca5f38a6a5a89f39fb4639558f",
      "in_reply_to_id": 857179874,
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Indeed, thanks!",
      "created_at": "2022-04-25T09:26:05Z",
      "updated_at": "2022-04-25T09:26:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857429350",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857429350"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2415,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857471771",
      "pull_request_review_id": 951640797,
      "id": 857471771,
      "node_id": "PRRC_kwDOABII584zG_sb",
      "diff_hunk": "@@ -2334,30 +2362,117 @@ UniValue CreateUTXOSnapshot(\n         tip = CHECK_NONFATAL(chainstate.m_blockman.LookupBlockIndex(stats.hashBlock));\n     }\n \n-    LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n-        tip->nHeight, tip->GetBlockHash().ToString(),\n-        fs::PathToString(path), fs::PathToString(temppath)));\n-\n-    SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n+    switch (format) {\n+    case UTXOSnapshotFormat::COMPACT:\n+        {\n+            LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n+                                    tip->nHeight, tip->GetBlockHash().ToString(),\n+                                    fs::PathToString(path), fs::PathToString(temppath)));",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 88,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "889f6c719dbd2bca5f38a6a5a89f39fb4639558f",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "indentation nit (or just run clang-format on the diff)\r\n```diff\r\n--- a/src/rpc/blockchain.cpp\r\n+++ b/src/rpc/blockchain.cpp\r\n@@ -2366,8 +2366,8 @@ UniValue CreateUTXOSnapshot(\r\n     case UTXOSnapshotFormat::COMPACT:\r\n         {\r\n             LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\r\n-                                    tip->nHeight, tip->GetBlockHash().ToString(),\r\n-                                    fs::PathToString(path), fs::PathToString(temppath)));\r\n+                                       tip->nHeight, tip->GetBlockHash().ToString(),\r\n+                                       fs::PathToString(path), fs::PathToString(temppath)));\r\n             SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\r\n ```\r\n",
      "created_at": "2022-04-25T10:15:51Z",
      "updated_at": "2022-04-25T10:37:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857471771",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857471771"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2370,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857472277",
      "pull_request_review_id": 951640797,
      "id": 857472277,
      "node_id": "PRRC_kwDOABII584zG_0V",
      "diff_hunk": "@@ -2334,30 +2362,117 @@ UniValue CreateUTXOSnapshot(\n         tip = CHECK_NONFATAL(chainstate.m_blockman.LookupBlockIndex(stats.hashBlock));\n     }\n \n-    LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n-        tip->nHeight, tip->GetBlockHash().ToString(),\n-        fs::PathToString(path), fs::PathToString(temppath)));\n-\n-    SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n+    switch (format) {\n+    case UTXOSnapshotFormat::COMPACT:\n+        {\n+            LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n+                                    tip->nHeight, tip->GetBlockHash().ToString(),\n+                                    fs::PathToString(path), fs::PathToString(temppath)));\n+            SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n+\n+            afile << metadata;\n+\n+            COutPoint key;\n+            Coin coin;\n+            unsigned int iter{0};\n+\n+            while (pcursor->Valid()) {\n+                if (iter % 5000 == 0) node.rpc_interruption_point();\n+                ++iter;\n+                if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n+                    afile << key;\n+                    afile << coin;\n+                }\n \n-    afile << metadata;\n+                pcursor->Next();\n+            }\n \n-    COutPoint key;\n-    Coin coin;\n-    unsigned int iter{0};\n-\n-    while (pcursor->Valid()) {\n-        if (iter % 5000 == 0) node.rpc_interruption_point();\n-        ++iter;\n-        if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n-            afile << key;\n-            afile << coin;\n+            afile.fclose();\n+            break;\n         }\n+    case UTXOSnapshotFormat::SQLITE:\n+        {\n+#ifdef USE_SQLITE\n+            LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to sqlite DB file %s\",\n+                                    tip->nHeight, tip->GetBlockHash().ToString(), fs::PathToString(path)));",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 126,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "889f6c719dbd2bca5f38a6a5a89f39fb4639558f",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "indentation nit\r\n```suggestion\r\n                                       tip->nHeight, tip->GetBlockHash().ToString(), fs::PathToString(path)));\r\n```\r\n",
      "created_at": "2022-04-25T10:16:31Z",
      "updated_at": "2022-04-25T10:35:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857472277",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857472277"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2397,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857475674",
      "pull_request_review_id": 951640797,
      "id": 857475674,
      "node_id": "PRRC_kwDOABII584zHApa",
      "diff_hunk": "@@ -2334,30 +2362,117 @@ UniValue CreateUTXOSnapshot(\n         tip = CHECK_NONFATAL(chainstate.m_blockman.LookupBlockIndex(stats.hashBlock));\n     }\n \n-    LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n-        tip->nHeight, tip->GetBlockHash().ToString(),\n-        fs::PathToString(path), fs::PathToString(temppath)));\n-\n-    SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n+    switch (format) {\n+    case UTXOSnapshotFormat::COMPACT:",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 84,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "889f6c719dbd2bca5f38a6a5a89f39fb4639558f",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The code blocks below each case are indented 4 spaces too deeply (don't hesitate to run clang-format on the diff).\r\n```suggestion\r\n    case UTXOSnapshotFormat::COMPACT: {\r\n```",
      "created_at": "2022-04-25T10:20:49Z",
      "updated_at": "2022-04-25T10:35:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857475674",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857475674"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2366,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857482529",
      "pull_request_review_id": 951640797,
      "id": 857482529,
      "node_id": "PRRC_kwDOABII584zHCUh",
      "diff_hunk": "@@ -53,5 +54,41 @@ def run_test(self):\n         assert_raises_rpc_error(\n             -8, '{} already exists'.format(FILENAME),  node.dumptxoutset, FILENAME)\n \n+    def test_sqlite_format(self):\n+        node = self.nodes[1]\n+        mocktime = node.getblockheader(node.getblockhash(0))['time'] + 1\n+        node.setmocktime(mocktime)\n+\n+        FILENAME = 'txoutset.db'\n+        out = node.dumptxoutset(FILENAME, 'sqlite')\n+        expected_path = Path(node.datadir) / self.chain / FILENAME\n+\n+        assert expected_path.is_file()\n+\n+        assert_equal(out['coins_written'], 100)\n+        assert_equal(out['base_height'], 100)\n+        assert_equal(out['path'], str(expected_path))\n+        # Blockhash should be deterministic based on mocked time.\n+        assert_equal(\n+            out['base_hash'],\n+            '09abf0e7b510f61ca6cf33bab104e9ee99b3528b371d27a2d4b39abb800fba7e')\n+\n+        assert_equal(\n+            out['txoutset_hash'], '1f7e3befd45dc13ae198dfbb22869a9c5c4196f8e9ef9735831af1288033f890')\n+        assert_equal(out['nchaintx'], 101)\n+\n+        # Checking that no temporary file remains for a sqlite dump.\n+        assert not os.path.exists(Path(node.datadir) / self.chain / (FILENAME + '.incomplete'))\n+\n+        # Specifying a path to an existing file will fail.\n+        assert_raises_rpc_error(\n+            -8, '{} already exists'.format(FILENAME),  node.dumptxoutset, FILENAME)\n+\n+    def run_test(self):\n+        \"\"\"Test trivial usage of the dumptxoutset RPC command.\"\"\"\n+        self.test_compact_format()\n+        if self.is_sqlite_compiled():\n+            self.test_sqlite_format()\n+",
      "path": "test/functional/rpc_dumptxoutset.py",
      "position": 64,
      "original_position": 61,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "2d95dbb489ba32d4965dd42e87d9e899bd52a01d",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "suggestions\r\n```diff\r\n+++ b/test/functional/rpc_dumptxoutset.py\r\n@@ -21,6 +21,7 @@ class DumptxoutsetTest(BitcoinTestFramework):\r\n         self.num_nodes = 1\r\n \r\n     def test_compact_format(self):\r\n+        self.log.info(\"Test compact format\")\r\n         node = self.nodes[0]\r\n@@ -55,8 +56,8 @@ class DumptxoutsetTest(BitcoinTestFramework):\r\n \r\n     def test_sqlite_format(self):\r\n+        self.log.info(\"Test sqlite format\")\r\n         node = self.nodes[0]\r\n-\r\n         FILENAME = 'txoutset.db'\r\n@@ -83,10 +84,10 @@ class DumptxoutsetTest(BitcoinTestFramework):\r\n     def run_test(self):\r\n-        \"\"\"Test trivial usage of the dumptxoutset RPC command.\"\"\"\r\n         self.test_compact_format()\r\n         if self.is_sqlite_compiled():\r\n             self.test_sqlite_format()\r\n \r\n+\r\n if __name__ == '__main__':\r\n     DumptxoutsetTest().main()\r\n```\r\n",
      "created_at": "2022-04-25T10:29:38Z",
      "updated_at": "2022-04-25T10:36:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857482529",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857482529"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 102,
      "original_line": 102,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857486251",
      "pull_request_review_id": 951640797,
      "id": 857486251,
      "node_id": "PRRC_kwDOABII584zHDOr",
      "diff_hunk": "@@ -2255,6 +2258,7 @@ static RPCHelpMan dumptxoutset()\n         \"Write the serialized UTXO set to disk.\",\n         {\n             {\"path\", RPCArg::Type::STR, RPCArg::Optional::NO, \"Path to the output file. If relative, will be prefixed by datadir.\"},\n+            {\"format\", RPCArg::Type::STR, RPCArg::Default{\"compact\"}, \"'compact' to output a compact binary serialized format, 'sqlite' to output a SQLite database with table 'txoutset' (requires sqlite3)\", \"format\"},",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "2d95dbb489ba32d4965dd42e87d9e899bd52a01d",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This outputs the following:\r\n```\r\n2. format    (string, optional, default=\"compact\") 'compact' to output a compact binary serialized format, 'sqlite' to output a SQLite database with table 'txoutset' (requires sqlite3)\r\n```\r\nMaybe use quotes the same as the default.\r\n```suggestion\r\n            {\"format\", RPCArg::Type::STR, RPCArg::Default{\"compact\"}, \"\\\"compact\\\" to output a compact binary serialized format, \\\"sqlite\\\" to output a SQLite database with table \\\"txoutset\\\" (requires sqlite3)\", \"format\"},\r\n```",
      "created_at": "2022-04-25T10:34:26Z",
      "updated_at": "2022-04-25T10:35:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857486251",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857486251"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2261,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857500861",
      "pull_request_review_id": 951680276,
      "id": 857500861,
      "node_id": "PRRC_kwDOABII584zHGy9",
      "diff_hunk": "@@ -2334,30 +2362,117 @@ UniValue CreateUTXOSnapshot(\n         tip = CHECK_NONFATAL(chainstate.m_blockman.LookupBlockIndex(stats.hashBlock));\n     }\n \n-    LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n-        tip->nHeight, tip->GetBlockHash().ToString(),\n-        fs::PathToString(path), fs::PathToString(temppath)));\n-\n-    SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n+    switch (format) {\n+    case UTXOSnapshotFormat::COMPACT:",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 84,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "889f6c719dbd2bca5f38a6a5a89f39fb4639558f",
      "in_reply_to_id": 857475674,
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks. I had removed a formatting change to make review a bit easier and then was not running it on subsequent changes.",
      "created_at": "2022-04-25T10:53:38Z",
      "updated_at": "2022-04-25T10:53:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r857500861",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/857500861"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2366,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/858129535",
      "pull_request_review_id": 952583827,
      "id": 858129535,
      "node_id": "PRRC_kwDOABII584zJgR_",
      "diff_hunk": "@@ -2334,30 +2362,115 @@ UniValue CreateUTXOSnapshot(\n         tip = CHECK_NONFATAL(chainstate.m_blockman.LookupBlockIndex(stats.hashBlock));\n     }\n \n-    LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n-        tip->nHeight, tip->GetBlockHash().ToString(),\n-        fs::PathToString(path), fs::PathToString(temppath)));\n+    switch (format) {\n+    case UTXOSnapshotFormat::COMPACT: {\n+        LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n+                                   tip->nHeight, tip->GetBlockHash().ToString(),\n+                                   fs::PathToString(path), fs::PathToString(temppath)));\n+        SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n \n-    SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n+        afile << metadata;\n \n-    afile << metadata;\n+        COutPoint key;\n+        Coin coin;\n+        unsigned int iter{0};\n+\n+        while (pcursor->Valid()) {\n+            if (iter % 5000 == 0) node.rpc_interruption_point();\n+            ++iter;\n+            if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n+                afile << key;\n+                afile << coin;\n+            }\n \n-    COutPoint key;\n-    Coin coin;\n-    unsigned int iter{0};\n-\n-    while (pcursor->Valid()) {\n-        if (iter % 5000 == 0) node.rpc_interruption_point();\n-        ++iter;\n-        if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n-            afile << key;\n-            afile << coin;\n+            pcursor->Next();\n         }\n \n-        pcursor->Next();\n+        afile.fclose();\n+        break;\n     }\n+    case UTXOSnapshotFormat::SQLITE: {\n+#ifdef USE_SQLITE\n+        LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to sqlite DB file %s\",\n+                                   tip->nHeight, tip->GetBlockHash().ToString(), fs::PathToString(path)));\n+\n+        sqlite3* db;\n+        int ret;\n+\n+        if (!ValidAsCString(fs::PathToString(path))) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid path\");\n+        }\n+\n+        ret = sqlite3_open(fs::PathToString(path).c_str(), &db);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"Unable to open database file %s\", path.u8string()));",
      "path": "src/rpc/blockchain.cpp",
      "position": 142,
      "original_position": 165,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "2d95f24c358cfea7bd7cb11c14e26954560c651d",
      "in_reply_to_id": null,
      "user": {
        "login": "brunoerg",
        "id": 19480819,
        "node_id": "MDQ6VXNlcjE5NDgwODE5",
        "avatar_url": "https://avatars.githubusercontent.com/u/19480819?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/brunoerg",
        "html_url": "https://github.com/brunoerg",
        "followers_url": "https://api.github.com/users/brunoerg/followers",
        "following_url": "https://api.github.com/users/brunoerg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/brunoerg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/brunoerg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/brunoerg/subscriptions",
        "organizations_url": "https://api.github.com/users/brunoerg/orgs",
        "repos_url": "https://api.github.com/users/brunoerg/repos",
        "events_url": "https://api.github.com/users/brunoerg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/brunoerg/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "maybe we could cover this error in the functional test, passing a wrong path.",
      "created_at": "2022-04-26T00:46:01Z",
      "updated_at": "2022-04-26T00:46:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r858129535",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/858129535"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2390,
      "original_line": 2390,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/858130507",
      "pull_request_review_id": 952585250,
      "id": 858130507,
      "node_id": "PRRC_kwDOABII584zJghL",
      "diff_hunk": "@@ -48,11 +48,18 @@ UniValue blockheaderToJSON(const CBlockIndex* tip, const CBlockIndex* blockindex\n /** Used by getblockstats to get feerates at different percentiles by weight  */\n void CalculatePercentilesByWeight(CAmount result[NUM_GETBLOCKSTATS_PERCENTILES], std::vector<std::pair<CAmount, int64_t>>& scores, int64_t total_weight);\n \n+/** File format type for CreateUTXOSnapshot() */\n+enum class UTXOSnapshotFormat {\n+    COMPACT,",
      "path": "src/rpc/blockchain.h",
      "position": 6,
      "original_position": 6,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "2d95f24c358cfea7bd7cb11c14e26954560c651d",
      "in_reply_to_id": null,
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: is there a reason to call the original format `COMPACT` ?\r\nSomething like `BINARY` might be more accurate.\r\n\r\n```suggestion\r\n    BINARY,\r\n```",
      "created_at": "2022-04-26T00:48:27Z",
      "updated_at": "2022-04-26T00:49:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r858130507",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/858130507"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 53,
      "original_line": 53,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/858429422",
      "pull_request_review_id": 952969983,
      "id": 858429422,
      "node_id": "PRRC_kwDOABII584zKpfu",
      "diff_hunk": "@@ -48,11 +48,18 @@ UniValue blockheaderToJSON(const CBlockIndex* tip, const CBlockIndex* blockindex\n /** Used by getblockstats to get feerates at different percentiles by weight  */\n void CalculatePercentilesByWeight(CAmount result[NUM_GETBLOCKSTATS_PERCENTILES], std::vector<std::pair<CAmount, int64_t>>& scores, int64_t total_weight);\n \n+/** File format type for CreateUTXOSnapshot() */\n+enum class UTXOSnapshotFormat {\n+    COMPACT,",
      "path": "src/rpc/blockchain.h",
      "position": 6,
      "original_position": 6,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "2d95f24c358cfea7bd7cb11c14e26954560c651d",
      "in_reply_to_id": 858130507,
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "No fundamental reason. I just used nomenclature from the CSV attempt: #18689.\r\nHappy to change if we think it's clearer and people have strong opinions about it.",
      "created_at": "2022-04-26T08:24:06Z",
      "updated_at": "2022-04-26T08:24:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r858429422",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/858429422"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 53,
      "original_line": 53,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/858697167",
      "pull_request_review_id": 953355662,
      "id": 858697167,
      "node_id": "PRRC_kwDOABII584zLq3P",
      "diff_hunk": "@@ -48,11 +48,18 @@ UniValue blockheaderToJSON(const CBlockIndex* tip, const CBlockIndex* blockindex\n /** Used by getblockstats to get feerates at different percentiles by weight  */\n void CalculatePercentilesByWeight(CAmount result[NUM_GETBLOCKSTATS_PERCENTILES], std::vector<std::pair<CAmount, int64_t>>& scores, int64_t total_weight);\n \n+/** File format type for CreateUTXOSnapshot() */\n+enum class UTXOSnapshotFormat {\n+    COMPACT,",
      "path": "src/rpc/blockchain.h",
      "position": 6,
      "original_position": 6,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "2d95f24c358cfea7bd7cb11c14e26954560c651d",
      "in_reply_to_id": 858130507,
      "user": {
        "login": "prusnak",
        "id": 42201,
        "node_id": "MDQ6VXNlcjQyMjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/42201?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/prusnak",
        "html_url": "https://github.com/prusnak",
        "followers_url": "https://api.github.com/users/prusnak/followers",
        "following_url": "https://api.github.com/users/prusnak/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/prusnak/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/prusnak/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/prusnak/subscriptions",
        "organizations_url": "https://api.github.com/users/prusnak/orgs",
        "repos_url": "https://api.github.com/users/prusnak/repos",
        "events_url": "https://api.github.com/users/prusnak/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/prusnak/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I like compact more than binary.",
      "created_at": "2022-04-26T13:12:50Z",
      "updated_at": "2022-04-26T13:12:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r858697167",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/858697167"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 53,
      "original_line": 53,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/859115914",
      "pull_request_review_id": 953960554,
      "id": 859115914,
      "node_id": "PRRC_kwDOABII584zNRGK",
      "diff_hunk": "@@ -2334,30 +2362,115 @@ UniValue CreateUTXOSnapshot(\n         tip = CHECK_NONFATAL(chainstate.m_blockman.LookupBlockIndex(stats.hashBlock));\n     }\n \n-    LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n-        tip->nHeight, tip->GetBlockHash().ToString(),\n-        fs::PathToString(path), fs::PathToString(temppath)));\n+    switch (format) {\n+    case UTXOSnapshotFormat::COMPACT: {\n+        LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n+                                   tip->nHeight, tip->GetBlockHash().ToString(),\n+                                   fs::PathToString(path), fs::PathToString(temppath)));\n+        SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n \n-    SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n+        afile << metadata;\n \n-    afile << metadata;\n+        COutPoint key;\n+        Coin coin;\n+        unsigned int iter{0};\n+\n+        while (pcursor->Valid()) {\n+            if (iter % 5000 == 0) node.rpc_interruption_point();\n+            ++iter;\n+            if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n+                afile << key;\n+                afile << coin;\n+            }\n \n-    COutPoint key;\n-    Coin coin;\n-    unsigned int iter{0};\n-\n-    while (pcursor->Valid()) {\n-        if (iter % 5000 == 0) node.rpc_interruption_point();\n-        ++iter;\n-        if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n-            afile << key;\n-            afile << coin;\n+            pcursor->Next();\n         }\n \n-        pcursor->Next();\n+        afile.fclose();\n+        break;\n     }\n+    case UTXOSnapshotFormat::SQLITE: {\n+#ifdef USE_SQLITE\n+        LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to sqlite DB file %s\",\n+                                   tip->nHeight, tip->GetBlockHash().ToString(), fs::PathToString(path)));\n+\n+        sqlite3* db;\n+        int ret;\n+\n+        if (!ValidAsCString(fs::PathToString(path))) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid path\");\n+        }\n+\n+        ret = sqlite3_open(fs::PathToString(path).c_str(), &db);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"Unable to open database file %s\", path.u8string()));",
      "path": "src/rpc/blockchain.cpp",
      "position": 142,
      "original_position": 165,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "2d95f24c358cfea7bd7cb11c14e26954560c651d",
      "in_reply_to_id": 858129535,
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks. Have added one!",
      "created_at": "2022-04-26T20:27:18Z",
      "updated_at": "2022-04-26T20:27:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r859115914",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/859115914"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2390,
      "original_line": 2390,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/860788596",
      "pull_request_review_id": 956290477,
      "id": 860788596,
      "node_id": "PRRC_kwDOABII584zTpd0",
      "diff_hunk": "@@ -2329,30 +2358,126 @@ UniValue CreateUTXOSnapshot(\n         tip = CHECK_NONFATAL(chainstate.m_blockman.LookupBlockIndex(stats.hashBlock));\n     }\n \n-    LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n-        tip->nHeight, tip->GetBlockHash().ToString(),\n-        fs::PathToString(path), fs::PathToString(temppath)));\n+    switch (format) {\n+    case UTXOSnapshotFormat::COMPACT: {\n+        LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n+                                   tip->nHeight, tip->GetBlockHash().ToString(),\n+                                   fs::PathToString(path), fs::PathToString(temppath)));\n+        SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n \n-    SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n+        afile << metadata;\n \n-    afile << metadata;\n+        COutPoint key;\n+        Coin coin;\n+        unsigned int iter{0};\n+\n+        while (pcursor->Valid()) {\n+            if (iter % 5000 == 0) node.rpc_interruption_point();\n+            ++iter;\n+            if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n+                afile << key;\n+                afile << coin;\n+            }\n \n-    COutPoint key;\n-    Coin coin;\n-    unsigned int iter{0};\n-\n-    while (pcursor->Valid()) {\n-        if (iter % 5000 == 0) node.rpc_interruption_point();\n-        ++iter;\n-        if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n-            afile << key;\n-            afile << coin;\n+            pcursor->Next();\n         }\n \n-        pcursor->Next();\n+        afile.fclose();\n+        break;\n     }\n+    case UTXOSnapshotFormat::SQLITE: {\n+#ifdef USE_SQLITE\n+        LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to sqlite DB file %s\",\n+                                   tip->nHeight, tip->GetBlockHash().ToString(), fs::PathToString(path)));\n+\n+        sqlite3* db;\n+        int ret;\n+\n+        if (!ValidAsCString(fs::PathToString(path))) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid path\");\n+        }\n+\n+        ret = sqlite3_open(fs::PathToString(path).c_str(), &db);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"Unable to open database file %s\", path.u8string()));\n+        }\n+\n+        // We have no need for rollbacks here, so we can set the `journal_mode` to 'off'. See: https://www.sqlite.org/pragma.html#pragma_journal_mode\n+        ret = sqlite3_exec(db, \"PRAGMA journal_mode=off;\", nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            throw std::runtime_error(strprintf(\"SQLiteDatabase: Failed to set 'journal_mode=off': %s\\n\", sqlite3_errstr(ret)));\n+        }\n \n-    afile.fclose();\n+        // Create and populate 'metadata' table\n+        ret = sqlite3_exec(db, \"CREATE TABLE metadata(blockhash TEXT, blockheight INT);\", nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"SQLiteDatabase: Failed to create 'metadata' table: %s\\n\", sqlite3_errstr(ret)));\n+        }\n+        ret = sqlite3_exec(db, strprintf(\"INSERT INTO metadata VALUES ('%s', %d)\", tip->GetBlockHash().ToString(), tip->nHeight).c_str(), nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"SQLiteDatabase: Failed to insert into 'metadata' table: %s\\n\", sqlite3_errstr(ret)));\n+        }\n+\n+        const char* sql = \"CREATE TABLE utxos(txid TEXT, vout INT, value INT, coinbase INT, height INT, scriptpubkey TEXT);\";\n+        ret = sqlite3_exec(db, sql, nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"SQLiteDatabase: Failed to create 'utxos' table: %s\\n\", sqlite3_errstr(ret)));\n+        }\n+\n+        COutPoint key;\n+        Coin coin;\n+        unsigned int iter{0};\n+\n+        sqlite3_stmt* stmt;\n+        sqlite3_prepare_v2(db, \"INSERT INTO utxos VALUES (?, ?, ?, ?, ?, ?);\", -1, &stmt, nullptr);\n+\n+        // Begin a transaction to wrap all INSERTs\n+        ret = sqlite3_exec(db, \"BEGIN TRANSACTION;\", nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"SQLiteDatabase: Failed to begin transaction: %s\\n\", sqlite3_errstr(ret)));\n+        }\n+\n+        while (pcursor->Valid()) {\n+            if (iter % 5000 == 0) node.rpc_interruption_point();\n+            ++iter;\n+            if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n+                sqlite3_bind_text(stmt, 1, key.hash.GetHex().c_str(), strlen(key.hash.GetHex().c_str()), SQLITE_TRANSIENT);",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 191,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "39c392af35b22807ca53cbe3b9218bc055236ccd",
      "in_reply_to_id": null,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Rather than calling `uint256.GetHex()` twice per iteration and determining its size via `strlen`, could create the string once and use its `.size()` method:\r\n```suggestion\r\n                std::string prevouthash_hex{key.hash.GetHex()};\r\n                sqlite3_bind_text(stmt, 1, prevouthash_hex.c_str(), prevouthash_hex.size(), SQLITE_TRANSIENT);\r\n```\r\nIn theory one could even pass the length directly as constant (64) since `GetHex()` results always have that size (then the string variable is not even needed).",
      "created_at": "2022-04-28T11:42:50Z",
      "updated_at": "2022-04-28T12:04:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r860788596",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/860788596"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2449,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/860793884",
      "pull_request_review_id": 956290477,
      "id": 860793884,
      "node_id": "PRRC_kwDOABII584zTqwc",
      "diff_hunk": "@@ -2329,30 +2358,126 @@ UniValue CreateUTXOSnapshot(\n         tip = CHECK_NONFATAL(chainstate.m_blockman.LookupBlockIndex(stats.hashBlock));\n     }\n \n-    LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n-        tip->nHeight, tip->GetBlockHash().ToString(),\n-        fs::PathToString(path), fs::PathToString(temppath)));\n+    switch (format) {\n+    case UTXOSnapshotFormat::COMPACT: {\n+        LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n+                                   tip->nHeight, tip->GetBlockHash().ToString(),\n+                                   fs::PathToString(path), fs::PathToString(temppath)));\n+        SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n \n-    SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n+        afile << metadata;\n \n-    afile << metadata;\n+        COutPoint key;\n+        Coin coin;\n+        unsigned int iter{0};\n+\n+        while (pcursor->Valid()) {\n+            if (iter % 5000 == 0) node.rpc_interruption_point();\n+            ++iter;\n+            if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n+                afile << key;\n+                afile << coin;\n+            }\n \n-    COutPoint key;\n-    Coin coin;\n-    unsigned int iter{0};\n-\n-    while (pcursor->Valid()) {\n-        if (iter % 5000 == 0) node.rpc_interruption_point();\n-        ++iter;\n-        if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n-            afile << key;\n-            afile << coin;\n+            pcursor->Next();\n         }\n \n-        pcursor->Next();\n+        afile.fclose();\n+        break;\n     }\n+    case UTXOSnapshotFormat::SQLITE: {\n+#ifdef USE_SQLITE\n+        LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to sqlite DB file %s\",\n+                                   tip->nHeight, tip->GetBlockHash().ToString(), fs::PathToString(path)));\n+\n+        sqlite3* db;\n+        int ret;\n+\n+        if (!ValidAsCString(fs::PathToString(path))) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid path\");\n+        }\n+\n+        ret = sqlite3_open(fs::PathToString(path).c_str(), &db);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"Unable to open database file %s\", path.u8string()));\n+        }\n+\n+        // We have no need for rollbacks here, so we can set the `journal_mode` to 'off'. See: https://www.sqlite.org/pragma.html#pragma_journal_mode\n+        ret = sqlite3_exec(db, \"PRAGMA journal_mode=off;\", nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            throw std::runtime_error(strprintf(\"SQLiteDatabase: Failed to set 'journal_mode=off': %s\\n\", sqlite3_errstr(ret)));\n+        }\n \n-    afile.fclose();\n+        // Create and populate 'metadata' table\n+        ret = sqlite3_exec(db, \"CREATE TABLE metadata(blockhash TEXT, blockheight INT);\", nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"SQLiteDatabase: Failed to create 'metadata' table: %s\\n\", sqlite3_errstr(ret)));\n+        }\n+        ret = sqlite3_exec(db, strprintf(\"INSERT INTO metadata VALUES ('%s', %d)\", tip->GetBlockHash().ToString(), tip->nHeight).c_str(), nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"SQLiteDatabase: Failed to insert into 'metadata' table: %s\\n\", sqlite3_errstr(ret)));\n+        }\n+\n+        const char* sql = \"CREATE TABLE utxos(txid TEXT, vout INT, value INT, coinbase INT, height INT, scriptpubkey TEXT);\";\n+        ret = sqlite3_exec(db, sql, nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"SQLiteDatabase: Failed to create 'utxos' table: %s\\n\", sqlite3_errstr(ret)));\n+        }\n+\n+        COutPoint key;\n+        Coin coin;\n+        unsigned int iter{0};\n+\n+        sqlite3_stmt* stmt;\n+        sqlite3_prepare_v2(db, \"INSERT INTO utxos VALUES (?, ?, ?, ?, ?, ?);\", -1, &stmt, nullptr);\n+\n+        // Begin a transaction to wrap all INSERTs\n+        ret = sqlite3_exec(db, \"BEGIN TRANSACTION;\", nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"SQLiteDatabase: Failed to begin transaction: %s\\n\", sqlite3_errstr(ret)));\n+        }\n+\n+        while (pcursor->Valid()) {\n+            if (iter % 5000 == 0) node.rpc_interruption_point();\n+            ++iter;\n+            if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n+                sqlite3_bind_text(stmt, 1, key.hash.GetHex().c_str(), strlen(key.hash.GetHex().c_str()), SQLITE_TRANSIENT);\n+                sqlite3_bind_int(stmt, 2, key.n);\n+                sqlite3_bind_int64(stmt, 3, coin.out.nValue);\n+                sqlite3_bind_int(stmt, 4, coin.fCoinBase);\n+                sqlite3_bind_int(stmt, 5, coin.nHeight);\n+                sqlite3_bind_text(stmt, 6, HexStr(coin.out.scriptPubKey).c_str(), strlen(HexStr(coin.out.scriptPubKey).c_str()), SQLITE_TRANSIENT);",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 196,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "39c392af35b22807ca53cbe3b9218bc055236ccd",
      "in_reply_to_id": null,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Similar to the above suggestion:\r\n```suggestion\r\n                std::string scriptpubkey_hex{HexStr(coin.out.scriptPubKey)};\r\n                sqlite3_bind_text(stmt, 6, scriptpubkey_hex.c_str(), scriptpubkey_hex.size(), SQLITE_TRANSIENT);\r\n```",
      "created_at": "2022-04-28T11:47:21Z",
      "updated_at": "2022-04-28T12:04:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r860793884",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/860793884"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2454,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/861079604",
      "pull_request_review_id": 956713149,
      "id": 861079604,
      "node_id": "PRRC_kwDOABII584zUwg0",
      "diff_hunk": "@@ -2329,30 +2358,126 @@ UniValue CreateUTXOSnapshot(\n         tip = CHECK_NONFATAL(chainstate.m_blockman.LookupBlockIndex(stats.hashBlock));\n     }\n \n-    LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n-        tip->nHeight, tip->GetBlockHash().ToString(),\n-        fs::PathToString(path), fs::PathToString(temppath)));\n+    switch (format) {\n+    case UTXOSnapshotFormat::COMPACT: {\n+        LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n+                                   tip->nHeight, tip->GetBlockHash().ToString(),\n+                                   fs::PathToString(path), fs::PathToString(temppath)));\n+        SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n \n-    SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n+        afile << metadata;\n \n-    afile << metadata;\n+        COutPoint key;\n+        Coin coin;\n+        unsigned int iter{0};\n+\n+        while (pcursor->Valid()) {\n+            if (iter % 5000 == 0) node.rpc_interruption_point();\n+            ++iter;\n+            if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n+                afile << key;\n+                afile << coin;\n+            }\n \n-    COutPoint key;\n-    Coin coin;\n-    unsigned int iter{0};\n-\n-    while (pcursor->Valid()) {\n-        if (iter % 5000 == 0) node.rpc_interruption_point();\n-        ++iter;\n-        if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n-            afile << key;\n-            afile << coin;\n+            pcursor->Next();\n         }\n \n-        pcursor->Next();\n+        afile.fclose();\n+        break;\n     }\n+    case UTXOSnapshotFormat::SQLITE: {\n+#ifdef USE_SQLITE\n+        LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to sqlite DB file %s\",\n+                                   tip->nHeight, tip->GetBlockHash().ToString(), fs::PathToString(path)));\n+\n+        sqlite3* db;\n+        int ret;\n+\n+        if (!ValidAsCString(fs::PathToString(path))) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid path\");\n+        }\n+\n+        ret = sqlite3_open(fs::PathToString(path).c_str(), &db);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"Unable to open database file %s\", path.u8string()));\n+        }\n+\n+        // We have no need for rollbacks here, so we can set the `journal_mode` to 'off'. See: https://www.sqlite.org/pragma.html#pragma_journal_mode\n+        ret = sqlite3_exec(db, \"PRAGMA journal_mode=off;\", nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            throw std::runtime_error(strprintf(\"SQLiteDatabase: Failed to set 'journal_mode=off': %s\\n\", sqlite3_errstr(ret)));\n+        }\n \n-    afile.fclose();\n+        // Create and populate 'metadata' table\n+        ret = sqlite3_exec(db, \"CREATE TABLE metadata(blockhash TEXT, blockheight INT);\", nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"SQLiteDatabase: Failed to create 'metadata' table: %s\\n\", sqlite3_errstr(ret)));\n+        }\n+        ret = sqlite3_exec(db, strprintf(\"INSERT INTO metadata VALUES ('%s', %d)\", tip->GetBlockHash().ToString(), tip->nHeight).c_str(), nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"SQLiteDatabase: Failed to insert into 'metadata' table: %s\\n\", sqlite3_errstr(ret)));\n+        }\n+\n+        const char* sql = \"CREATE TABLE utxos(txid TEXT, vout INT, value INT, coinbase INT, height INT, scriptpubkey TEXT);\";\n+        ret = sqlite3_exec(db, sql, nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"SQLiteDatabase: Failed to create 'utxos' table: %s\\n\", sqlite3_errstr(ret)));\n+        }\n+\n+        COutPoint key;\n+        Coin coin;\n+        unsigned int iter{0};\n+\n+        sqlite3_stmt* stmt;\n+        sqlite3_prepare_v2(db, \"INSERT INTO utxos VALUES (?, ?, ?, ?, ?, ?);\", -1, &stmt, nullptr);\n+\n+        // Begin a transaction to wrap all INSERTs\n+        ret = sqlite3_exec(db, \"BEGIN TRANSACTION;\", nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"SQLiteDatabase: Failed to begin transaction: %s\\n\", sqlite3_errstr(ret)));\n+        }\n+\n+        while (pcursor->Valid()) {\n+            if (iter % 5000 == 0) node.rpc_interruption_point();\n+            ++iter;\n+            if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n+                sqlite3_bind_text(stmt, 1, key.hash.GetHex().c_str(), strlen(key.hash.GetHex().c_str()), SQLITE_TRANSIENT);",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 191,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "39c392af35b22807ca53cbe3b9218bc055236ccd",
      "in_reply_to_id": 860788596,
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think I'll stick to the creating the string as you mentioned, just so it's clearer.",
      "created_at": "2022-04-28T16:13:28Z",
      "updated_at": "2022-04-28T16:13:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r861079604",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/861079604"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2449,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867241253",
      "pull_request_review_id": 965223224,
      "id": 867241253,
      "node_id": "PRRC_kwDOABII584zsQ0l",
      "diff_hunk": "@@ -1999,9 +1999,9 @@ echo \"  with experimental syscall sandbox support = $use_syscall_sandbox\"\n echo \"  with libs       = $build_bitcoin_libs\"\n echo \"  with wallet     = $enable_wallet\"\n if test \"$enable_wallet\" != \"no\"; then\n-    echo \"    with sqlite   = $use_sqlite\"\n     echo \"    with bdb      = $use_bdb\"\n fi\n+echo \"  with sqlite     = $use_sqlite\"",
      "path": "configure.ac",
      "position": 51,
      "original_position": 7,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "8fe0e7c48e651fdf981675d0dd1542ec49ea91b7",
      "in_reply_to_id": null,
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Also need to actually check for and enable sqlite without wallet build",
      "created_at": "2022-05-06T22:04:08Z",
      "updated_at": "2022-05-06T22:15:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r867241253",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867241253"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2019,
      "original_line": 2019,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867241801",
      "pull_request_review_id": 965223224,
      "id": 867241801,
      "node_id": "PRRC_kwDOABII584zsQ9J",
      "diff_hunk": "@@ -2273,19 +2280,42 @@ static RPCHelpMan dumptxoutset()\n     // to avoid confusion due to an interruption.\n     const fs::path temppath = fsbridge::AbsPathJoin(args.GetDataDirNet(), fs::u8path(request.params[0].get_str() + \".incomplete\"));\n \n+    UTXOSnapshotFormat format;\n+    if (request.params[1].isNull() || request.params[1].get_str() == \"compact\") {\n+        format = UTXOSnapshotFormat::COMPACT;\n+    } else if (request.params[1].get_str() == \"sqlite\") {\n+#ifndef USE_SQLITE\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, \"Compiled without sqlite support (required for dumptxoutset 'sqlite' format)\");\n+#endif\n+        format = UTXOSnapshotFormat::SQLITE;\n+    } else {\n+        throw JSONRPCError(\n+            RPC_INVALID_PARAMETER,\n+            request.params[1].get_str() + \" is not a valid format.\");\n+    }\n+\n     if (fs::exists(path)) {\n         throw JSONRPCError(\n             RPC_INVALID_PARAMETER,\n             path.u8string() + \" already exists. If you are sure this is what you want, \"\n-            \"move it out of the way first\");\n+                                \"move it out of the way first\");",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 53,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "8fe0e7c48e651fdf981675d0dd1542ec49ea91b7",
      "in_reply_to_id": null,
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "wrong indentation",
      "created_at": "2022-05-06T22:05:52Z",
      "updated_at": "2022-05-06T22:15:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r867241801",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867241801"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2301,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867244494",
      "pull_request_review_id": 965223224,
      "id": 867244494,
      "node_id": "PRRC_kwDOABII584zsRnO",
      "diff_hunk": "@@ -2329,30 +2360,130 @@ UniValue CreateUTXOSnapshot(\n         tip = CHECK_NONFATAL(chainstate.m_blockman.LookupBlockIndex(stats.hashBlock));\n     }\n \n-    LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n-        tip->nHeight, tip->GetBlockHash().ToString(),\n-        fs::PathToString(path), fs::PathToString(temppath)));\n+    switch (format) {\n+    case UTXOSnapshotFormat::COMPACT: {\n+        LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n+                                   tip->nHeight, tip->GetBlockHash().ToString(),\n+                                   fs::PathToString(path), fs::PathToString(temppath)));\n+        SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n \n-    SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n+        afile << metadata;\n \n-    afile << metadata;\n+        COutPoint key;\n+        Coin coin;\n+        unsigned int iter{0};\n+\n+        while (pcursor->Valid()) {\n+            if (iter % 5000 == 0) node.rpc_interruption_point();\n+            ++iter;\n+            if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n+                afile << key;\n+                afile << coin;\n+            }\n \n-    COutPoint key;\n-    Coin coin;\n-    unsigned int iter{0};\n-\n-    while (pcursor->Valid()) {\n-        if (iter % 5000 == 0) node.rpc_interruption_point();\n-        ++iter;\n-        if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n-            afile << key;\n-            afile << coin;\n+            pcursor->Next();\n         }\n \n-        pcursor->Next();\n+        afile.fclose();\n+        break;\n     }\n+    case UTXOSnapshotFormat::SQLITE: {\n+#ifdef USE_SQLITE\n+        LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to sqlite DB file %s\",\n+                                   tip->nHeight, tip->GetBlockHash().ToString(), fs::PathToString(path)));\n+\n+        sqlite3* db;\n+        int ret;\n+        std::string path_string = fs::PathToString(path);\n+\n+        if (!ContainsNoNUL(path_string)) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid path\");\n+        }\n+\n+        ret = sqlite3_open(path_string.c_str(), &db);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"Unable to open database file %s\", path.u8string()));\n+        }\n+\n+        // We have no need for rollbacks here, so we can set the `journal_mode` to 'off'. See: https://www.sqlite.org/pragma.html#pragma_journal_mode\n+        ret = sqlite3_exec(db, \"PRAGMA journal_mode=off;\", nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            throw std::runtime_error(strprintf(\"SQLiteDatabase: Failed to set 'journal_mode=off': %s\\n\", sqlite3_errstr(ret)));\n+        }\n \n-    afile.fclose();\n+        // Create and populate 'metadata' table\n+        ret = sqlite3_exec(db, \"CREATE TABLE metadata(blockhash TEXT, blockheight INT);\", nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"SQLiteDatabase: Failed to create 'metadata' table: %s\\n\", sqlite3_errstr(ret)));\n+        }\n+        ret = sqlite3_exec(db, strprintf(\"INSERT INTO metadata VALUES ('%s', %d)\", tip->GetBlockHash().ToString(), tip->nHeight).c_str(), nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"SQLiteDatabase: Failed to insert into 'metadata' table: %s\\n\", sqlite3_errstr(ret)));\n+        }\n+\n+        const char* sql = \"CREATE TABLE utxos(txid TEXT, vout INT, value INT, coinbase INT, height INT, scriptpubkey TEXT);\";",
      "path": "src/rpc/blockchain.cpp",
      "position": 164,
      "original_position": 169,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "8fe0e7c48e651fdf981675d0dd1542ec49ea91b7",
      "in_reply_to_id": null,
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`vout` is the wrong term",
      "created_at": "2022-05-06T22:13:31Z",
      "updated_at": "2022-05-06T22:15:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r867244494",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867244494"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2411,
      "original_line": 2411,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867244987",
      "pull_request_review_id": 965223224,
      "id": 867244987,
      "node_id": "PRRC_kwDOABII584zsRu7",
      "diff_hunk": "@@ -2329,30 +2360,130 @@ UniValue CreateUTXOSnapshot(\n         tip = CHECK_NONFATAL(chainstate.m_blockman.LookupBlockIndex(stats.hashBlock));\n     }\n \n-    LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n-        tip->nHeight, tip->GetBlockHash().ToString(),\n-        fs::PathToString(path), fs::PathToString(temppath)));\n+    switch (format) {\n+    case UTXOSnapshotFormat::COMPACT: {\n+        LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n+                                   tip->nHeight, tip->GetBlockHash().ToString(),\n+                                   fs::PathToString(path), fs::PathToString(temppath)));\n+        SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n \n-    SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n+        afile << metadata;\n \n-    afile << metadata;\n+        COutPoint key;\n+        Coin coin;\n+        unsigned int iter{0};\n+\n+        while (pcursor->Valid()) {\n+            if (iter % 5000 == 0) node.rpc_interruption_point();\n+            ++iter;\n+            if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n+                afile << key;\n+                afile << coin;\n+            }\n \n-    COutPoint key;\n-    Coin coin;\n-    unsigned int iter{0};\n-\n-    while (pcursor->Valid()) {\n-        if (iter % 5000 == 0) node.rpc_interruption_point();\n-        ++iter;\n-        if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n-            afile << key;\n-            afile << coin;\n+            pcursor->Next();\n         }\n \n-        pcursor->Next();\n+        afile.fclose();\n+        break;\n     }\n+    case UTXOSnapshotFormat::SQLITE: {\n+#ifdef USE_SQLITE\n+        LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to sqlite DB file %s\",\n+                                   tip->nHeight, tip->GetBlockHash().ToString(), fs::PathToString(path)));\n+\n+        sqlite3* db;\n+        int ret;\n+        std::string path_string = fs::PathToString(path);\n+\n+        if (!ContainsNoNUL(path_string)) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid path\");\n+        }\n+\n+        ret = sqlite3_open(path_string.c_str(), &db);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"Unable to open database file %s\", path.u8string()));\n+        }\n+\n+        // We have no need for rollbacks here, so we can set the `journal_mode` to 'off'. See: https://www.sqlite.org/pragma.html#pragma_journal_mode\n+        ret = sqlite3_exec(db, \"PRAGMA journal_mode=off;\", nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            throw std::runtime_error(strprintf(\"SQLiteDatabase: Failed to set 'journal_mode=off': %s\\n\", sqlite3_errstr(ret)));\n+        }\n \n-    afile.fclose();\n+        // Create and populate 'metadata' table\n+        ret = sqlite3_exec(db, \"CREATE TABLE metadata(blockhash TEXT, blockheight INT);\", nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"SQLiteDatabase: Failed to create 'metadata' table: %s\\n\", sqlite3_errstr(ret)));\n+        }\n+        ret = sqlite3_exec(db, strprintf(\"INSERT INTO metadata VALUES ('%s', %d)\", tip->GetBlockHash().ToString(), tip->nHeight).c_str(), nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"SQLiteDatabase: Failed to insert into 'metadata' table: %s\\n\", sqlite3_errstr(ret)));\n+        }\n+\n+        const char* sql = \"CREATE TABLE utxos(txid TEXT, vout INT, value INT, coinbase INT, height INT, scriptpubkey TEXT);\";",
      "path": "src/rpc/blockchain.cpp",
      "position": 164,
      "original_position": 169,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "8fe0e7c48e651fdf981675d0dd1542ec49ea91b7",
      "in_reply_to_id": null,
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "At least scriptpubkey should probably be a binary BLOB?",
      "created_at": "2022-05-06T22:15:00Z",
      "updated_at": "2022-05-06T22:15:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r867244987",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867244987"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2411,
      "original_line": 2411,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867351518",
      "pull_request_review_id": 965331089,
      "id": 867351518,
      "node_id": "PRRC_kwDOABII584zsrve",
      "diff_hunk": "@@ -2329,30 +2360,130 @@ UniValue CreateUTXOSnapshot(\n         tip = CHECK_NONFATAL(chainstate.m_blockman.LookupBlockIndex(stats.hashBlock));\n     }\n \n-    LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n-        tip->nHeight, tip->GetBlockHash().ToString(),\n-        fs::PathToString(path), fs::PathToString(temppath)));\n+    switch (format) {\n+    case UTXOSnapshotFormat::COMPACT: {\n+        LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n+                                   tip->nHeight, tip->GetBlockHash().ToString(),\n+                                   fs::PathToString(path), fs::PathToString(temppath)));\n+        SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n \n-    SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n+        afile << metadata;\n \n-    afile << metadata;\n+        COutPoint key;\n+        Coin coin;\n+        unsigned int iter{0};\n+\n+        while (pcursor->Valid()) {\n+            if (iter % 5000 == 0) node.rpc_interruption_point();\n+            ++iter;\n+            if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n+                afile << key;\n+                afile << coin;\n+            }\n \n-    COutPoint key;\n-    Coin coin;\n-    unsigned int iter{0};\n-\n-    while (pcursor->Valid()) {\n-        if (iter % 5000 == 0) node.rpc_interruption_point();\n-        ++iter;\n-        if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n-            afile << key;\n-            afile << coin;\n+            pcursor->Next();\n         }\n \n-        pcursor->Next();\n+        afile.fclose();\n+        break;\n     }\n+    case UTXOSnapshotFormat::SQLITE: {\n+#ifdef USE_SQLITE\n+        LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to sqlite DB file %s\",\n+                                   tip->nHeight, tip->GetBlockHash().ToString(), fs::PathToString(path)));\n+\n+        sqlite3* db;\n+        int ret;\n+        std::string path_string = fs::PathToString(path);\n+\n+        if (!ContainsNoNUL(path_string)) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid path\");\n+        }\n+\n+        ret = sqlite3_open(path_string.c_str(), &db);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"Unable to open database file %s\", path.u8string()));\n+        }\n+\n+        // We have no need for rollbacks here, so we can set the `journal_mode` to 'off'. See: https://www.sqlite.org/pragma.html#pragma_journal_mode\n+        ret = sqlite3_exec(db, \"PRAGMA journal_mode=off;\", nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            throw std::runtime_error(strprintf(\"SQLiteDatabase: Failed to set 'journal_mode=off': %s\\n\", sqlite3_errstr(ret)));\n+        }\n \n-    afile.fclose();\n+        // Create and populate 'metadata' table\n+        ret = sqlite3_exec(db, \"CREATE TABLE metadata(blockhash TEXT, blockheight INT);\", nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"SQLiteDatabase: Failed to create 'metadata' table: %s\\n\", sqlite3_errstr(ret)));\n+        }\n+        ret = sqlite3_exec(db, strprintf(\"INSERT INTO metadata VALUES ('%s', %d)\", tip->GetBlockHash().ToString(), tip->nHeight).c_str(), nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"SQLiteDatabase: Failed to insert into 'metadata' table: %s\\n\", sqlite3_errstr(ret)));\n+        }\n+\n+        const char* sql = \"CREATE TABLE utxos(txid TEXT, vout INT, value INT, coinbase INT, height INT, scriptpubkey TEXT);\";",
      "path": "src/rpc/blockchain.cpp",
      "position": 164,
      "original_position": 169,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "8fe0e7c48e651fdf981675d0dd1542ec49ea91b7",
      "in_reply_to_id": 867244494,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "What would be a better alternative? Simply `n`? Right now `vout` is already used in quite some RPC calls to refer to an outpoint's index (e.g. in the resut of `scantxoutset`).",
      "created_at": "2022-05-07T13:18:18Z",
      "updated_at": "2022-05-07T13:18:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r867351518",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867351518"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2411,
      "original_line": 2411,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867351949",
      "pull_request_review_id": 965331436,
      "id": 867351949,
      "node_id": "PRRC_kwDOABII584zsr2N",
      "diff_hunk": "@@ -2329,30 +2360,130 @@ UniValue CreateUTXOSnapshot(\n         tip = CHECK_NONFATAL(chainstate.m_blockman.LookupBlockIndex(stats.hashBlock));\n     }\n \n-    LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n-        tip->nHeight, tip->GetBlockHash().ToString(),\n-        fs::PathToString(path), fs::PathToString(temppath)));\n+    switch (format) {\n+    case UTXOSnapshotFormat::COMPACT: {\n+        LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to file %s (via %s)\",\n+                                   tip->nHeight, tip->GetBlockHash().ToString(),\n+                                   fs::PathToString(path), fs::PathToString(temppath)));\n+        SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n \n-    SnapshotMetadata metadata{tip->GetBlockHash(), stats.coins_count, tip->nChainTx};\n+        afile << metadata;\n \n-    afile << metadata;\n+        COutPoint key;\n+        Coin coin;\n+        unsigned int iter{0};\n+\n+        while (pcursor->Valid()) {\n+            if (iter % 5000 == 0) node.rpc_interruption_point();\n+            ++iter;\n+            if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n+                afile << key;\n+                afile << coin;\n+            }\n \n-    COutPoint key;\n-    Coin coin;\n-    unsigned int iter{0};\n-\n-    while (pcursor->Valid()) {\n-        if (iter % 5000 == 0) node.rpc_interruption_point();\n-        ++iter;\n-        if (pcursor->GetKey(key) && pcursor->GetValue(coin)) {\n-            afile << key;\n-            afile << coin;\n+            pcursor->Next();\n         }\n \n-        pcursor->Next();\n+        afile.fclose();\n+        break;\n     }\n+    case UTXOSnapshotFormat::SQLITE: {\n+#ifdef USE_SQLITE\n+        LOG_TIME_SECONDS(strprintf(\"writing UTXO snapshot at height %s (%s) to sqlite DB file %s\",\n+                                   tip->nHeight, tip->GetBlockHash().ToString(), fs::PathToString(path)));\n+\n+        sqlite3* db;\n+        int ret;\n+        std::string path_string = fs::PathToString(path);\n+\n+        if (!ContainsNoNUL(path_string)) {\n+            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid path\");\n+        }\n+\n+        ret = sqlite3_open(path_string.c_str(), &db);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"Unable to open database file %s\", path.u8string()));\n+        }\n+\n+        // We have no need for rollbacks here, so we can set the `journal_mode` to 'off'. See: https://www.sqlite.org/pragma.html#pragma_journal_mode\n+        ret = sqlite3_exec(db, \"PRAGMA journal_mode=off;\", nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            throw std::runtime_error(strprintf(\"SQLiteDatabase: Failed to set 'journal_mode=off': %s\\n\", sqlite3_errstr(ret)));\n+        }\n \n-    afile.fclose();\n+        // Create and populate 'metadata' table\n+        ret = sqlite3_exec(db, \"CREATE TABLE metadata(blockhash TEXT, blockheight INT);\", nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"SQLiteDatabase: Failed to create 'metadata' table: %s\\n\", sqlite3_errstr(ret)));\n+        }\n+        ret = sqlite3_exec(db, strprintf(\"INSERT INTO metadata VALUES ('%s', %d)\", tip->GetBlockHash().ToString(), tip->nHeight).c_str(), nullptr, nullptr, nullptr);\n+        if (ret != SQLITE_OK) {\n+            sqlite3_close(db);\n+            throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"SQLiteDatabase: Failed to insert into 'metadata' table: %s\\n\", sqlite3_errstr(ret)));\n+        }\n+\n+        const char* sql = \"CREATE TABLE utxos(txid TEXT, vout INT, value INT, coinbase INT, height INT, scriptpubkey TEXT);\";",
      "path": "src/rpc/blockchain.cpp",
      "position": 164,
      "original_position": 169,
      "commit_id": "c5506ac2988469d4961af27f20b0f6fc887b179d",
      "original_commit_id": "8fe0e7c48e651fdf981675d0dd1542ec49ea91b7",
      "in_reply_to_id": 867244987,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "One drawback with changing it to a BLOB is that the simply query `select * from utxos` doesn't yield a readable result anymore (see also https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1108758629). On the other hand the dumps would be a bit smaller 🤔 ",
      "created_at": "2022-05-07T13:23:38Z",
      "updated_at": "2022-05-07T13:23:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24952#discussion_r867351949",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/867351949"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24952"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2411,
      "original_line": 2411,
      "side": "RIGHT"
    }
  ]
}