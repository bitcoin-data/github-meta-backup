{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295",
    "id": 1083008361,
    "node_id": "PR_kwDOABII585AjWVp",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/26295",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/26295.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/26295.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26295",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26295/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/7082ce3e88d77456d60a5a66bd38807fbd66f311",
    "number": 26295,
    "state": "closed",
    "locked": false,
    "maintainer_can_modify": false,
    "title": "Replace global g_cs_orphans lock with local",
    "user": {
      "login": "ajtowns",
      "id": 127186,
      "node_id": "MDQ6VXNlcjEyNzE4Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajtowns",
      "html_url": "https://github.com/ajtowns",
      "followers_url": "https://api.github.com/users/ajtowns/followers",
      "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
      "organizations_url": "https://api.github.com/users/ajtowns/orgs",
      "repos_url": "https://api.github.com/users/ajtowns/repos",
      "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/ajtowns/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Moves extra transactions to be under the `m_msgproc_mutex` lock rather than `g_cs_orphans` and refactors orphan handling so that the lock can be internal to the `TxOrphange` class.",
    "labels": [],
    "created_at": "2022-10-11T09:09:32Z",
    "updated_at": "2022-11-29T10:39:07Z",
    "closed_at": "2022-11-28T11:00:00Z",
    "mergeable_state": "unknown",
    "merged_at": "2022-11-28T11:00:00Z",
    "merge_commit_sha": "a79b720092b6ce4134d386e95b3473a290f3c127",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "head": {
      "label": "ajtowns:202210-cs_orphans",
      "ref": "202210-cs_orphans",
      "sha": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 53941525,
        "node_id": "MDEwOlJlcG9zaXRvcnk1Mzk0MTUyNQ==",
        "name": "bitcoin",
        "full_name": "ajtowns/bitcoin",
        "owner": {
          "login": "ajtowns",
          "id": 127186,
          "node_id": "MDQ6VXNlcjEyNzE4Ng==",
          "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/ajtowns",
          "html_url": "https://github.com/ajtowns",
          "followers_url": "https://api.github.com/users/ajtowns/followers",
          "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
          "organizations_url": "https://api.github.com/users/ajtowns/orgs",
          "repos_url": "https://api.github.com/users/ajtowns/repos",
          "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/ajtowns/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/ajtowns/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/ajtowns/bitcoin",
        "archive_url": "https://api.github.com/repos/ajtowns/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/ajtowns/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/ajtowns/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/ajtowns/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/ajtowns/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/ajtowns/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/ajtowns/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/ajtowns/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/ajtowns/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/ajtowns/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/ajtowns/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/ajtowns/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/ajtowns/bitcoin/events",
        "forks_url": "https://api.github.com/repos/ajtowns/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/ajtowns/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/ajtowns/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/ajtowns/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/ajtowns/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/ajtowns/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/ajtowns/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/ajtowns/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/ajtowns/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/ajtowns/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/ajtowns/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/ajtowns/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/ajtowns/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/ajtowns/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/ajtowns/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/ajtowns/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:ajtowns/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/ajtowns/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/ajtowns/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/ajtowns/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/ajtowns/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/ajtowns/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/ajtowns/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/ajtowns/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/ajtowns/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/ajtowns/bitcoin/hooks",
        "svn_url": "https://github.com/ajtowns/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 2,
        "stargazers_count": 7,
        "watchers_count": 7,
        "size": 262427,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-05T19:54:41Z",
        "created_at": "2016-03-15T12:11:24Z",
        "updated_at": "2023-03-19T19:22:46Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "2e77dff7449af6b46b284c75ce6e1d53a134bc8e",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 34324,
        "stargazers_count": 69818,
        "watchers_count": 69818,
        "size": 233879,
        "default_branch": "master",
        "open_issues_count": 627,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-07T07:15:46Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-06-07T06:49:43Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 126,
    "deletions": 99,
    "changed_files": 8,
    "commits": 9,
    "review_comments": 21,
    "comments": 8
  },
  "events": [
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGZmOGQ0NGQxOTY3ZDhmZjlmYjliOWVhMGI4N2MwNDcwZDhjYzI1NTA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ff8d44d1967d8ff9fb9b9ea0b87c0470d8cc2550",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/ff8d44d1967d8ff9fb9b9ea0b87c0470d8cc2550",
      "tree": {
        "sha": "121fdfdfae0da81de11786b5c231834219b4779c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/121fdfdfae0da81de11786b5c231834219b4779c"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/73b61717a977fc9d23f1bae3f8620641a9dee1f3",
          "sha": "73b61717a977fc9d23f1bae3f8620641a9dee1f3",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/73b61717a977fc9d23f1bae3f8620641a9dee1f3"
        }
      ],
      "message": "Remove unnecessary includes of txorphange.h",
      "committer": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2022-10-07T04:39:40Z"
      },
      "author": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2022-10-05T08:50:33Z"
      },
      "sha": "ff8d44d1967d8ff9fb9b9ea0b87c0470d8cc2550"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDg5ZTJlMGRhMGJjZDBiMDc1N2Q3YjQyOTA3ZTJkMjIxNGRhOWY2OGI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/89e2e0da0bcd0b0757d7b42907e2d2214da9f68b",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/89e2e0da0bcd0b0757d7b42907e2d2214da9f68b",
      "tree": {
        "sha": "b5d91c8347817caeb2f32e6f2046cf6b62f896b9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b5d91c8347817caeb2f32e6f2046cf6b62f896b9"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ff8d44d1967d8ff9fb9b9ea0b87c0470d8cc2550",
          "sha": "ff8d44d1967d8ff9fb9b9ea0b87c0470d8cc2550",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/ff8d44d1967d8ff9fb9b9ea0b87c0470d8cc2550"
        }
      ],
      "message": "net_processing: move extra transactions to msgproc mutex\n\nPreviously vExtraTxnForCompact and vExtraTxnForCompactIt were protected\nby g_cs_orphans; protect them by g_msgproc_mutex instead, as they\nare only used during message processing.",
      "committer": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2022-10-07T04:40:03Z"
      },
      "author": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2022-10-05T08:54:14Z"
      },
      "sha": "89e2e0da0bcd0b0757d7b42907e2d2214da9f68b"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDk5MTBlZDc1NWMzZGZkNzY2OTcwN2I0NGQ5OTNhMjAwMzBkZDc0Nzc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9910ed755c3dfd7669707b44d993a20030dd7477",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/9910ed755c3dfd7669707b44d993a20030dd7477",
      "tree": {
        "sha": "bc3dfb7b1eeb5e61fcecb8fbfbb04e6d158747c9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/bc3dfb7b1eeb5e61fcecb8fbfbb04e6d158747c9"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/89e2e0da0bcd0b0757d7b42907e2d2214da9f68b",
          "sha": "89e2e0da0bcd0b0757d7b42907e2d2214da9f68b",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/89e2e0da0bcd0b0757d7b42907e2d2214da9f68b"
        }
      ],
      "message": "net_processing: Pass a Peer& to ProcessOrphanTx",
      "committer": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2022-10-07T04:40:26Z"
      },
      "author": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2022-10-05T08:58:53Z"
      },
      "sha": "9910ed755c3dfd7669707b44d993a20030dd7477"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDAwMjcxNzRiMzk2Y2FjYmFhYzVmZDUyZjEzYmUzZGNhOWZjYmJmYjg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0027174b396cacbaac5fd52f13be3dca9fcbbfb8",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0027174b396cacbaac5fd52f13be3dca9fcbbfb8",
      "tree": {
        "sha": "65c81d0e3d305c8376e752c75b3cb469b8130ab6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/65c81d0e3d305c8376e752c75b3cb469b8130ab6"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9910ed755c3dfd7669707b44d993a20030dd7477",
          "sha": "9910ed755c3dfd7669707b44d993a20030dd7477",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/9910ed755c3dfd7669707b44d993a20030dd7477"
        }
      ],
      "message": "net_processing: move ProcessOrphanTx docs to declaration",
      "committer": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2022-10-07T04:40:50Z"
      },
      "author": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2022-10-05T09:02:55Z"
      },
      "sha": "0027174b396cacbaac5fd52f13be3dca9fcbbfb8"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDZmOGU0NDJiYTYxMzc4NDg5YTZlMmUyYWI1YmNmYmNjY2ExYTI5ZWM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6f8e442ba61378489a6e2e2ab5bcfbccca1a29ec",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/6f8e442ba61378489a6e2e2ab5bcfbccca1a29ec",
      "tree": {
        "sha": "6b3eb90fbc1451848e1c9cc344a658f8ba7f53d3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6b3eb90fbc1451848e1c9cc344a658f8ba7f53d3"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0027174b396cacbaac5fd52f13be3dca9fcbbfb8",
          "sha": "0027174b396cacbaac5fd52f13be3dca9fcbbfb8",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/0027174b396cacbaac5fd52f13be3dca9fcbbfb8"
        }
      ],
      "message": "net_processing: Localise orphan_work_set handling to ProcessOrphanTx",
      "committer": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2022-10-07T04:41:24Z"
      },
      "author": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2022-10-05T09:12:14Z"
      },
      "sha": "6f8e442ba61378489a6e2e2ab5bcfbccca1a29ec"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDM2MTQ4MTk4NjRhODRhYzMyZjZkNTNjNmFjZTc5YjVlNzFiYzE3NGE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3614819864a84ac32f6d53c6ace79b5e71bc174a",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/3614819864a84ac32f6d53c6ace79b5e71bc174a",
      "tree": {
        "sha": "94cf6c60a71d3da7cb7ed1a6f9e4d0a763cc843e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/94cf6c60a71d3da7cb7ed1a6f9e4d0a763cc843e"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6f8e442ba61378489a6e2e2ab5bcfbccca1a29ec",
          "sha": "6f8e442ba61378489a6e2e2ab5bcfbccca1a29ec",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/6f8e442ba61378489a6e2e2ab5bcfbccca1a29ec"
        }
      ],
      "message": "txorphange: move orphan workset to txorphanage",
      "committer": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2022-10-11T04:04:49Z"
      },
      "author": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2021-02-24T14:03:23Z"
      },
      "sha": "3614819864a84ac32f6d53c6ace79b5e71bc174a"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGE5MzZmNDFhNWQ1ZjdiYjk3NDI1ZjgyZWM2NGRmYWU2MmU4NDBhNTY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a936f41a5d5f7bb97425f82ec64dfae62e840a56",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a936f41a5d5f7bb97425f82ec64dfae62e840a56",
      "tree": {
        "sha": "a7d8e962139d566375a83ee191af3c204a7e8f0f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a7d8e962139d566375a83ee191af3c204a7e8f0f"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3614819864a84ac32f6d53c6ace79b5e71bc174a",
          "sha": "3614819864a84ac32f6d53c6ace79b5e71bc174a",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/3614819864a84ac32f6d53c6ace79b5e71bc174a"
        }
      ],
      "message": "txorphanage: make m_peer_work_set private",
      "committer": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2022-10-11T04:05:09Z"
      },
      "author": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2021-02-24T14:28:16Z"
      },
      "sha": "a936f41a5d5f7bb97425f82ec64dfae62e840a56"
    },
    {
      "event": "commented",
      "id": 1274367087,
      "node_id": "IC_kwDOABII585L9Uxv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1274367087",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-11T09:10:14Z",
      "updated_at": "2022-10-11T09:10:14Z",
      "author_association": "MEMBER",
      "body": "Resurrects #21527",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#issuecomment-1274367087",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26295"
    },
    {
      "event": "reviewed",
      "id": 1137209946,
      "node_id": "PRR_kwDOABII585DyHJa",
      "url": null,
      "actor": null,
      "commit_id": "5d59755168fa4c47cd709775a0ca764a28c352d4",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#pullrequestreview-1137209946",
      "submitted_at": "2022-10-11T10:17:29Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
    },
    {
      "event": "commented",
      "id": 1274522306,
      "node_id": "IC_kwDOABII585L96rC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1274522306",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-11T11:15:57Z",
      "updated_at": "2022-10-11T11:15:57Z",
      "author_association": "MEMBER",
      "body": "Concept ACK",
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#issuecomment-1274522306",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26295"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDczM2Q4NWY3OWNkZTM1M2Q4YzliNTQzNzBmMjk2YjEwMzFmYTMzZDk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/733d85f79cde353d8c9b54370f296b1031fa33d9",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/733d85f79cde353d8c9b54370f296b1031fa33d9",
      "tree": {
        "sha": "d82f4afe95a9e61ff84eeac104d118013c44a372",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d82f4afe95a9e61ff84eeac104d118013c44a372"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a936f41a5d5f7bb97425f82ec64dfae62e840a56",
          "sha": "a936f41a5d5f7bb97425f82ec64dfae62e840a56",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a936f41a5d5f7bb97425f82ec64dfae62e840a56"
        }
      ],
      "message": "Move all g_cs_orphans locking to txorphanage",
      "committer": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2022-10-11T13:35:32Z"
      },
      "author": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2022-10-07T04:25:47Z"
      },
      "sha": "733d85f79cde353d8c9b54370f296b1031fa33d9"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDcwODJjZTNlODhkNzc0NTZkNjBhNWE2NmJkMzg4MDdmYmQ2NmYzMTE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "tree": {
        "sha": "37777ad15de0baacd63d1fa4a9272481a7086307",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/37777ad15de0baacd63d1fa4a9272481a7086307"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/733d85f79cde353d8c9b54370f296b1031fa33d9",
          "sha": "733d85f79cde353d8c9b54370f296b1031fa33d9",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/733d85f79cde353d8c9b54370f296b1031fa33d9"
        }
      ],
      "message": "scripted-diff: rename and de-globalise g_cs_orphans\n\n-BEGIN VERIFY SCRIPT-\nsed -i -e 's/static RecursiveMutex/mutable Mutex/' src/txorphanage.h\nsed -i -e '/RecursiveMutex/d' src/txorphanage.cpp\nsed -i -e 's/g_cs_orphans/m_mutex/g' $(git grep -l g_cs_orphans src/)\n-END VERIFY SCRIPT-",
      "committer": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2022-10-11T13:35:37Z"
      },
      "author": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2022-10-07T04:32:19Z"
      },
      "sha": "7082ce3e88d77456d60a5a66bd38807fbd66f311"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7562977012,
      "node_id": "HRFPE_lADOABII585Ts7urzwAAAAHCyd70",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7562977012",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-11T13:45:23Z"
    },
    {
      "event": "commented",
      "id": 1275034740,
      "node_id": "IC_kwDOABII585L_3x0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1275034740",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-11T17:23:29Z",
      "updated_at": "2022-11-21T19:45:16Z",
      "author_association": "MEMBER",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [dergoegge](https://github.com/bitcoin/bitcoin/pull/26295#pullrequestreview-1146120937), [glozow](https://github.com/bitcoin/bitcoin/pull/26295#pullrequestreview-1184568433) |\n| Concept ACK | [hebasto](https://github.com/bitcoin/bitcoin/pull/26295#issuecomment-1276018107), [chinggg](https://github.com/bitcoin/bitcoin/pull/26295#issuecomment-1296253339) |\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#26151](https://github.com/bitcoin/bitcoin/pull/26151) (refactor: Guard TxRequestTracker by its own lock instead of cs_main by dergoegge)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#issuecomment-1275034740",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26295"
    },
    {
      "event": "commented",
      "id": 1276018107,
      "node_id": "IC_kwDOABII585MDn27",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1276018107",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-12T11:37:26Z",
      "updated_at": "2022-10-12T11:37:26Z",
      "author_association": "MEMBER",
      "body": "Concept ACK.",
      "user": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#issuecomment-1276018107",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26295"
    },
    {
      "event": "reviewed",
      "id": 1139045515,
      "node_id": "PRR_kwDOABII585D5HSL",
      "url": null,
      "actor": null,
      "commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "89e2e0da0bcd0b0757d7b42907e2d2214da9f68b\r\n\r\n> ... protect them by `g_msgproc_mutex` instead, as they\r\nare only used during message processing.\r\n\r\nIt does not look like a justification. An access to the extra txs ring buffer should be synced with its own mutex. It could be locked only within `PeerManagerImpl::AddToCompactExtraTransactions` and `PeerManagerImpl::ProcessMessage` functions. The fact that \"they\r\nare only used during message processing\" will guarantee no performance loss.\r\n\r\n6f8e442ba61378489a6e2e2ab5bcfbccca1a29ec \"net_processing: Localise orphan_work_set handling to ProcessOrphanTx\" looks behavior changing. Do we have tests which cover it?\r\n\r\nTbh, I'd be happy if 4 or 5 first commits could be split into a separated PR.",
      "user": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#pullrequestreview-1139045515",
      "submitted_at": "2022-10-12T13:18:46Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
    },
    {
      "event": "reviewed",
      "id": 1139643003,
      "node_id": "PRR_kwDOABII585D7ZJ7",
      "url": null,
      "actor": null,
      "commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Big Concept ACK",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#pullrequestreview-1139643003",
      "submitted_at": "2022-10-12T19:59:25Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
    },
    {
      "event": "commented",
      "id": 1280302316,
      "node_id": "IC_kwDOABII585MT9zs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1280302316",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-17T05:19:38Z",
      "updated_at": "2022-10-17T05:19:38Z",
      "author_association": "MEMBER",
      "body": "> It does not look like a justification. An access to the extra txs ring buffer should be synced with its own mutex\r\n\r\nNo, it shouldn't have its own mutex: it's always better to have fewer locks than more, as that uses fewer resources and means there are fewer things to keep in your head when following the logic. The only time when more locks are better is when that enables more parallelism, and improves performance -- that is, a justification is needed when introducing new locks.",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#issuecomment-1280302316",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26295"
    },
    {
      "event": "commented",
      "id": 1280739195,
      "node_id": "IC_kwDOABII585MVod7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1280739195",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-17T11:55:25Z",
      "updated_at": "2022-10-17T11:55:25Z",
      "author_association": "MEMBER",
      "body": "> > It does not look like a justification. An access to the extra txs ring buffer should be synced with its own mutex\r\n> \r\n> No, it shouldn't have its own mutex... The only time when more locks are better is when that enables more parallelism, and improves performance -- that is, a justification is needed when introducing new locks.\r\n\r\nThis implies that in future design changes the `vExtraTxnForCompact` cannot be processed by any other thread except for the message processing one. Do we really want such a restriction for an ideal networking code?\r\n\r\n> it's always better to have fewer locks than more, as that uses fewer resources and means there are fewer things to keep in your head when following the logic.\r\n\r\nI cannot agree with \"it's always better\".\r\n\r\nMaking it use \"fewer resources\" is a kind of optimization, and \"premature optimization is the root of all evil”.\r\n\r\n> it's always better to have fewer locks than more, as ... there are fewer things to keep in your head when following the logic.\r\n\r\nPerhaps, we are talking about personal biases, but, when following the logic, it's better to keep things structured, to have small classes which implement data structures with internal locking and thread-safe interfaces.",
      "user": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#issuecomment-1280739195",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26295"
    },
    {
      "event": "commented",
      "id": 1281743152,
      "node_id": "IC_kwDOABII585MZdkw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1281743152",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-18T02:47:11Z",
      "updated_at": "2022-10-18T02:47:11Z",
      "author_association": "MEMBER",
      "body": "> This implies that in future design changes the `vExtraTxnForCompact` cannot be processed by any other thread except for the message processing one.\r\n\r\nWhat are you talking about? If we can put extra transactions under a different lock now, we certainly can in the future. This isn't an API that we have to support indefinitely.",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#issuecomment-1281743152",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26295"
    },
    {
      "event": "reviewed",
      "id": 1146120937,
      "node_id": "PRR_kwDOABII585EUGrp",
      "url": null,
      "actor": null,
      "commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Code review ACK 7082ce3e88d77456d60a5a66bd38807fbd66f311\r\n\r\nAll comments are non-blocking (could also be done in a follow up)",
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#pullrequestreview-1146120937",
      "submitted_at": "2022-10-18T16:32:13Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
    },
    {
      "event": "commented",
      "id": 1296253339,
      "node_id": "IC_kwDOABII585NQ0Gb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1296253339",
      "actor": {
        "login": "chinggg",
        "id": 24590067,
        "node_id": "MDQ6VXNlcjI0NTkwMDY3",
        "avatar_url": "https://avatars.githubusercontent.com/u/24590067?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/chinggg",
        "html_url": "https://github.com/chinggg",
        "followers_url": "https://api.github.com/users/chinggg/followers",
        "following_url": "https://api.github.com/users/chinggg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/chinggg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/chinggg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/chinggg/subscriptions",
        "organizations_url": "https://api.github.com/users/chinggg/orgs",
        "repos_url": "https://api.github.com/users/chinggg/repos",
        "events_url": "https://api.github.com/users/chinggg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/chinggg/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-30T13:01:33Z",
      "updated_at": "2022-10-30T13:01:33Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK",
      "user": {
        "login": "chinggg",
        "id": 24590067,
        "node_id": "MDQ6VXNlcjI0NTkwMDY3",
        "avatar_url": "https://avatars.githubusercontent.com/u/24590067?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/chinggg",
        "html_url": "https://github.com/chinggg",
        "followers_url": "https://api.github.com/users/chinggg/followers",
        "following_url": "https://api.github.com/users/chinggg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/chinggg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/chinggg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/chinggg/subscriptions",
        "organizations_url": "https://api.github.com/users/chinggg/orgs",
        "repos_url": "https://api.github.com/users/chinggg/repos",
        "events_url": "https://api.github.com/users/chinggg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/chinggg/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#issuecomment-1296253339",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26295"
    },
    {
      "event": "reviewed",
      "id": 1161143708,
      "node_id": "PRR_kwDOABII585FNaWc",
      "url": null,
      "actor": null,
      "commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "chinggg",
        "id": 24590067,
        "node_id": "MDQ6VXNlcjI0NTkwMDY3",
        "avatar_url": "https://avatars.githubusercontent.com/u/24590067?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/chinggg",
        "html_url": "https://github.com/chinggg",
        "followers_url": "https://api.github.com/users/chinggg/followers",
        "following_url": "https://api.github.com/users/chinggg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/chinggg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/chinggg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/chinggg/subscriptions",
        "organizations_url": "https://api.github.com/users/chinggg/orgs",
        "repos_url": "https://api.github.com/users/chinggg/repos",
        "events_url": "https://api.github.com/users/chinggg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/chinggg/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#pullrequestreview-1161143708",
      "submitted_at": "2022-10-30T14:18:57Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
    },
    {
      "event": "reviewed",
      "id": 1184568433,
      "node_id": "PRR_kwDOABII585GmxRx",
      "url": null,
      "actor": null,
      "commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK 7082ce3e88d77456d60a5a66bd38807fbd66f311 via code review and some [basic testing](https://github.com/glozow/bitcoin/blob/review-26295/src/test/orphanage_tests.cpp#L150). I think putting txorphanage in charge of handling peer work sets is the right direction.",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#pullrequestreview-1184568433",
      "submitted_at": "2022-11-17T18:52:37Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
    },
    {
      "event": "merged",
      "id": 7901732989,
      "node_id": "ME_lADOABII585Ts7urzwAAAAHW-uB9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7901732989",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "a79b720092b6ce4134d386e95b3473a290f3c127",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a79b720092b6ce4134d386e95b3473a290f3c127",
      "created_at": "2022-11-28T11:00:00Z"
    },
    {
      "event": "closed",
      "id": 7901733026,
      "node_id": "CE_lADOABII585Ts7urzwAAAAHW-uCi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7901733026",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-28T11:00:00Z"
    },
    {
      "event": "referenced",
      "id": 7932959539,
      "node_id": "REFE_lADOABII585Ts7urzwAAAAHY11sz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7932959539",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "395a6c70f10fd2833be44b5f7a32f35e3bb3cc77",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/395a6c70f10fd2833be44b5f7a32f35e3bb3cc77",
      "created_at": "2022-12-01T15:19:57Z"
    },
    {
      "event": "referenced",
      "id": 8362805559,
      "node_id": "REFE_lADOABII585Ts7urzwAAAAHydkk3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8362805559",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "77a36033b5ecbf8dedb917d680f4116786fd7375",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/77a36033b5ecbf8dedb917d680f4116786fd7375",
      "created_at": "2023-01-26T10:37:14Z"
    },
    {
      "event": "referenced",
      "id": 8365739307,
      "node_id": "REFE_lADOABII585Ts7urzwAAAAHyow0r",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8365739307",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "09be5d2ccc4d1fc6972a2f899b67a557ddaf78b3",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/09be5d2ccc4d1fc6972a2f899b67a557ddaf78b3",
      "created_at": "2023-01-26T16:26:44Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/992131947",
      "pull_request_review_id": 1137209946,
      "id": 992131947,
      "node_id": "PRRC_kwDOABII5847Irtr",
      "diff_hunk": "@@ -589,8 +586,17 @@ class PeerManagerImpl final : public PeerManager\n      */\n     bool MaybeDiscourageAndDisconnect(CNode& pnode, Peer& peer);\n \n-    void ProcessOrphanTx(std::set<uint256>& orphan_work_set) EXCLUSIVE_LOCKS_REQUIRED(cs_main, g_cs_orphans)\n-        EXCLUSIVE_LOCKS_REQUIRED(!m_peer_mutex);\n+    /**\n+     * Reconsider orphan transactions after a parent has been accepted to the mempool.\n+     *\n+     * @peer[in]  peer     The peer whose orphan transactions we will reconsider. Generally only one\n+     *                     orphan will be reconsidered on each call of this function. This set\n+     *                     may be added to if accepting an orphan causes its children to be\n+     *                     reconsidered.\n+     * @return             True if there are still orphans in this peer's work set.\n+     */\n+    bool ProcessOrphanTx(Peer& peer) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+        EXCLUSIVE_LOCKS_REQUIRED(!m_peer_mutex, g_msgproc_mutex);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 26,
      "commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "original_commit_id": "5d59755168fa4c47cd709775a0ca764a28c352d4",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Is it intentional to split the annotations on two different lines?",
      "created_at": "2022-10-11T10:17:29Z",
      "updated_at": "2022-10-11T10:17:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#discussion_r992131947",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/992131947"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 599,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/992348696",
      "pull_request_review_id": 1137526683,
      "id": 992348696,
      "node_id": "PRRC_kwDOABII5847JgoY",
      "diff_hunk": "@@ -589,8 +586,17 @@ class PeerManagerImpl final : public PeerManager\n      */\n     bool MaybeDiscourageAndDisconnect(CNode& pnode, Peer& peer);\n \n-    void ProcessOrphanTx(std::set<uint256>& orphan_work_set) EXCLUSIVE_LOCKS_REQUIRED(cs_main, g_cs_orphans)\n-        EXCLUSIVE_LOCKS_REQUIRED(!m_peer_mutex);\n+    /**\n+     * Reconsider orphan transactions after a parent has been accepted to the mempool.\n+     *\n+     * @peer[in]  peer     The peer whose orphan transactions we will reconsider. Generally only one\n+     *                     orphan will be reconsidered on each call of this function. This set\n+     *                     may be added to if accepting an orphan causes its children to be\n+     *                     reconsidered.\n+     * @return             True if there are still orphans in this peer's work set.\n+     */\n+    bool ProcessOrphanTx(Peer& peer) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+        EXCLUSIVE_LOCKS_REQUIRED(!m_peer_mutex, g_msgproc_mutex);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 26,
      "commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "original_commit_id": "5d59755168fa4c47cd709775a0ca764a28c352d4",
      "in_reply_to_id": 992131947,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It wasn't, I just keep not noticing it. Fixed.",
      "created_at": "2022-10-11T13:45:42Z",
      "updated_at": "2022-10-11T13:45:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#discussion_r992348696",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/992348696"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 599,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/993429250",
      "pull_request_review_id": 1139045515,
      "id": 993429250,
      "node_id": "PRRC_kwDOABII5847NocC",
      "diff_hunk": "@@ -924,14 +930,14 @@ class PeerManagerImpl final : public PeerManager\n     /** Storage for orphan information */\n     TxOrphanage m_orphanage;\n \n-    void AddToCompactExtraTransactions(const CTransactionRef& tx) EXCLUSIVE_LOCKS_REQUIRED(g_cs_orphans);\n+    void AddToCompactExtraTransactions(const CTransactionRef& tx) EXCLUSIVE_LOCKS_REQUIRED(g_msgproc_mutex);",
      "path": "src/net_processing.cpp",
      "position": 35,
      "original_position": 35,
      "commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "original_commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "in_reply_to_id": null,
      "user": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "89e2e0da0bcd0b0757d7b42907e2d2214da9f68b\r\n\r\nAdd `AssertLockHeld(g_msgproc_mutex);` into implementation code?",
      "created_at": "2022-10-12T12:58:38Z",
      "updated_at": "2022-10-12T13:18:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#discussion_r993429250",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/993429250"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 933,
      "original_line": 933,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998436721",
      "pull_request_review_id": 1146120937,
      "id": 998436721,
      "node_id": "PRRC_kwDOABII5847gu9x",
      "diff_hunk": "@@ -21,40 +21,46 @@ extern RecursiveMutex g_cs_orphans;\n class TxOrphanage {\n public:\n     /** Add a new orphan transaction */\n-    bool AddTx(const CTransactionRef& tx, NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(g_cs_orphans);\n+    bool AddTx(const CTransactionRef& tx, NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n \n     /** Check if we already have an orphan transaction (by txid or wtxid) */\n-    bool HaveTx(const GenTxid& gtxid) const LOCKS_EXCLUDED(::g_cs_orphans);\n-\n-    /** Get an orphan transaction and its originating peer\n-     * (Transaction ref will be nullptr if not found)\n+    bool HaveTx(const GenTxid& gtxid) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n+\n+    /** Extract a transaction from a peer's work set\n+     *  Returns nullptr and sets more to false if there are no transactions\n+     *  to work on. Otherwise returns the transaction reference, removes\n+     *  the transaction from the work set, and populates its arguments with\n+     *  the originating peer, and whether there are more orphans for this peer\n+     *  to work on after this tx.\n      */\n-    std::pair<CTransactionRef, NodeId> GetTx(const uint256& txid) const EXCLUSIVE_LOCKS_REQUIRED(g_cs_orphans);\n+    CTransactionRef GetTxToReconsider(NodeId peer, NodeId& originator, bool& more) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);",
      "path": "src/txorphanage.h",
      "position": 33,
      "original_position": 33,
      "commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "original_commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "in_reply_to_id": null,
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```suggestion\r\n    std::optional<TxToReconsider> GetTxToReconsider(NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\r\n```\r\nWith `TxToReconsider` being:\r\n```c++\r\nstruct TxToReconsider {\r\n    const CTransactionRef tx;\r\n    const NodeId originator;\r\n    const bool more;\r\n};\r\n```\r\n\r\nThat would seem a little cleaner  to me because `originator` and `more` only have meaning if the returned transaction is not `nullptr`, so bundling the three would make sense imo. ",
      "created_at": "2022-10-18T16:03:25Z",
      "updated_at": "2022-10-18T16:32:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#discussion_r998436721",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998436721"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 36,
      "original_line": 36,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998443622",
      "pull_request_review_id": 1146120937,
      "id": 998443622,
      "node_id": "PRRC_kwDOABII5847gwpm",
      "diff_hunk": "@@ -4767,28 +4766,24 @@ bool PeerManagerImpl::ProcessMessages(CNode* pfrom, std::atomic<bool>& interrupt\n         }\n     }\n \n+    bool has_more_orphans;\n     {\n-        LOCK2(cs_main, g_cs_orphans);\n-        if (!peer->m_orphan_work_set.empty()) {\n-            ProcessOrphanTx(peer->m_orphan_work_set);\n-        }\n+        LOCK(cs_main);\n+        has_more_orphans = ProcessOrphanTx(*peer);\n     }\n \n     if (pfrom->fDisconnect)\n         return false;\n \n+    if (has_more_orphans) return true;",
      "path": "src/net_processing.cpp",
      "position": 161,
      "original_position": 161,
      "commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "original_commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "in_reply_to_id": null,
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Just wanted to note that you moved this check above the `m_getdata_requests.empty()` check. Any reason behind that? (Don't see how this changes anything, so feel free to just mark as resolved if there was no reason.)",
      "created_at": "2022-10-18T16:10:07Z",
      "updated_at": "2022-10-18T16:32:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#discussion_r998443622",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998443622"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4778,
      "original_line": 4778,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998447598",
      "pull_request_review_id": 1146120937,
      "id": 998447598,
      "node_id": "PRRC_kwDOABII5847gxnu",
      "diff_hunk": "@@ -132,15 +139,19 @@ void TxOrphanage::LimitOrphans(unsigned int max_orphans)\n     {\n         // Evict a random orphan:\n         size_t randompos = rng.randrange(m_orphan_list.size());\n-        EraseTx(m_orphan_list[randompos]->first);\n+        _EraseTx(m_orphan_list[randompos]->first);\n         ++nEvicted;\n     }\n     if (nEvicted > 0) LogPrint(BCLog::MEMPOOL, \"orphanage overflow, removed %u tx\\n\", nEvicted);\n }\n \n-void TxOrphanage::AddChildrenToWorkSet(const CTransaction& tx, std::set<uint256>& orphan_work_set) const\n+void TxOrphanage::AddChildrenToWorkSet(const CTransaction& tx, NodeId peer)\n {\n-    AssertLockHeld(g_cs_orphans);\n+    LOCK(m_mutex);\n+\n+    // Get this peer's work set, emplacing an empty set it didn't exist",
      "path": "src/txorphanage.cpp",
      "position": 83,
      "original_position": 83,
      "commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "original_commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "in_reply_to_id": null,
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```suggestion\r\n    // Get this peer's work set, emplacing an empty set if it didn't exist\r\n```",
      "created_at": "2022-10-18T16:13:55Z",
      "updated_at": "2022-10-18T16:32:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#discussion_r998447598",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998447598"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 152,
      "original_line": 152,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998456864",
      "pull_request_review_id": 1146120937,
      "id": 998456864,
      "node_id": "PRRC_kwDOABII5847gz4g",
      "diff_hunk": "@@ -2878,20 +2878,20 @@ void PeerManagerImpl::ProcessHeadersMessage(CNode& pfrom, Peer& peer,\n /**\n  * Reconsider orphan transactions after a parent has been accepted to the mempool.\n  *\n- * @param[in,out]  orphan_work_set  The set of orphan transactions to reconsider. Generally only one\n+ * @peer[in]  peer                  The peer whose orphan transactions we will reconsider. Generally only one\n  *                                  orphan will be reconsidered on each call of this function. This set\n  *                                  may be added to if accepting an orphan causes its children to be\n  *                                  reconsidered.\n  */\n-void PeerManagerImpl::ProcessOrphanTx(std::set<uint256>& orphan_work_set)\n+void PeerManagerImpl::ProcessOrphanTx(Peer& peer)",
      "path": "src/net_processing.cpp",
      "position": 20,
      "original_position": 20,
      "commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "original_commit_id": "9910ed755c3dfd7669707b44d993a20030dd7477",
      "in_reply_to_id": null,
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "After the work set is moved to the orphanage, `ProcessOrphanTx` really only needs the id of the peer not the entire `Peer`.\r\n\r\nMaybe pass `NodeId` to `ProcessOrphanTx` instead of `Peer` in 9910ed755c3dfd7669707b44d993a20030dd7477 and have it look up the needed `Peer`.",
      "created_at": "2022-10-18T16:22:54Z",
      "updated_at": "2022-10-18T16:32:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#discussion_r998456864",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998456864"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2886,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998968477",
      "pull_request_review_id": 1146883944,
      "id": 998968477,
      "node_id": "PRRC_kwDOABII5847iwyd",
      "diff_hunk": "@@ -4767,28 +4766,24 @@ bool PeerManagerImpl::ProcessMessages(CNode* pfrom, std::atomic<bool>& interrupt\n         }\n     }\n \n+    bool has_more_orphans;\n     {\n-        LOCK2(cs_main, g_cs_orphans);\n-        if (!peer->m_orphan_work_set.empty()) {\n-            ProcessOrphanTx(peer->m_orphan_work_set);\n-        }\n+        LOCK(cs_main);\n+        has_more_orphans = ProcessOrphanTx(*peer);\n     }\n \n     if (pfrom->fDisconnect)\n         return false;\n \n+    if (has_more_orphans) return true;",
      "path": "src/net_processing.cpp",
      "position": 161,
      "original_position": 161,
      "commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "original_commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "in_reply_to_id": 998443622,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It avoids taking the `m_getdata_requests_mutex` without changing the behaviour otherwise.",
      "created_at": "2022-10-19T05:52:36Z",
      "updated_at": "2022-10-19T05:52:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#discussion_r998968477",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998968477"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4778,
      "original_line": 4778,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008872657",
      "pull_request_review_id": 1161143708,
      "id": 1008872657,
      "node_id": "PRRC_kwDOABII5848IizR",
      "diff_hunk": "@@ -21,40 +21,46 @@ extern RecursiveMutex g_cs_orphans;\n class TxOrphanage {\n public:\n     /** Add a new orphan transaction */\n-    bool AddTx(const CTransactionRef& tx, NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(g_cs_orphans);\n+    bool AddTx(const CTransactionRef& tx, NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n \n     /** Check if we already have an orphan transaction (by txid or wtxid) */\n-    bool HaveTx(const GenTxid& gtxid) const LOCKS_EXCLUDED(::g_cs_orphans);\n-\n-    /** Get an orphan transaction and its originating peer\n-     * (Transaction ref will be nullptr if not found)\n+    bool HaveTx(const GenTxid& gtxid) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);",
      "path": "src/txorphanage.h",
      "position": 23,
      "original_position": 23,
      "commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "original_commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "in_reply_to_id": null,
      "user": {
        "login": "chinggg",
        "id": 24590067,
        "node_id": "MDQ6VXNlcjI0NTkwMDY3",
        "avatar_url": "https://avatars.githubusercontent.com/u/24590067?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/chinggg",
        "html_url": "https://github.com/chinggg",
        "followers_url": "https://api.github.com/users/chinggg/followers",
        "following_url": "https://api.github.com/users/chinggg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/chinggg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/chinggg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/chinggg/subscriptions",
        "organizations_url": "https://api.github.com/users/chinggg/orgs",
        "repos_url": "https://api.github.com/users/chinggg/repos",
        "events_url": "https://api.github.com/users/chinggg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/chinggg/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I used to be confused about the different lock granularity for these methods. Thanks for moving all the locks inside the function. \r\nBut can we use `LOCKS_EXCLUDED(m_mutex)` as this line used to be instead of `EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)` for these methods?\r\nsee https://clang.llvm.org/docs/ThreadSafetyAnalysis.html#excludes",
      "created_at": "2022-10-30T14:18:56Z",
      "updated_at": "2022-10-30T14:19:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#discussion_r1008872657",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008872657"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 27,
      "original_line": 27,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008977187",
      "pull_request_review_id": 1161253409,
      "id": 1008977187,
      "node_id": "PRRC_kwDOABII5848I8Uj",
      "diff_hunk": "@@ -21,40 +21,46 @@ extern RecursiveMutex g_cs_orphans;\n class TxOrphanage {\n public:\n     /** Add a new orphan transaction */\n-    bool AddTx(const CTransactionRef& tx, NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(g_cs_orphans);\n+    bool AddTx(const CTransactionRef& tx, NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n \n     /** Check if we already have an orphan transaction (by txid or wtxid) */\n-    bool HaveTx(const GenTxid& gtxid) const LOCKS_EXCLUDED(::g_cs_orphans);\n-\n-    /** Get an orphan transaction and its originating peer\n-     * (Transaction ref will be nullptr if not found)\n+    bool HaveTx(const GenTxid& gtxid) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);",
      "path": "src/txorphanage.h",
      "position": 23,
      "original_position": 23,
      "commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "original_commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "in_reply_to_id": 1008872657,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Using a negative annotation (`EXCLUSIVE_LOCKS_REQUIRED(!foo)`) is preferable in order to avoid \"false negatives in some cases\" that that link warns about (ie, the compiler not giving warnings about code that could result in double locking occurring), and `Mutex` is set up to require the use of negative annotations. That means making the change you suggest results in the error:\r\n\r\n```\r\ntxorphanage.cpp:167:5: error: calling function 'MaybeCheckNotHeld' requires negative capability '!m_mutex' [-Werror,-Wthread-safety-analysis]\r\n    LOCK(m_mutex);\r\n```",
      "created_at": "2022-10-31T02:05:41Z",
      "updated_at": "2022-10-31T02:05:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#discussion_r1008977187",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1008977187"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 27,
      "original_line": 27,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1022392642",
      "pull_request_review_id": 1180302492,
      "id": 1022392642,
      "node_id": "PRRC_kwDOABII58488HlC",
      "diff_hunk": "@@ -2878,20 +2878,20 @@ void PeerManagerImpl::ProcessHeadersMessage(CNode& pfrom, Peer& peer,\n /**\n  * Reconsider orphan transactions after a parent has been accepted to the mempool.\n  *\n- * @param[in,out]  orphan_work_set  The set of orphan transactions to reconsider. Generally only one\n+ * @peer[in]  peer                  The peer whose orphan transactions we will reconsider. Generally only one\n  *                                  orphan will be reconsidered on each call of this function. This set\n  *                                  may be added to if accepting an orphan causes its children to be\n  *                                  reconsidered.\n  */\n-void PeerManagerImpl::ProcessOrphanTx(std::set<uint256>& orphan_work_set)\n+void PeerManagerImpl::ProcessOrphanTx(Peer& peer)",
      "path": "src/net_processing.cpp",
      "position": 20,
      "original_position": 20,
      "commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "original_commit_id": "9910ed755c3dfd7669707b44d993a20030dd7477",
      "in_reply_to_id": 998456864,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "If you already have a `Peer`, I don't think there's really any reason not to pass in.",
      "created_at": "2022-11-15T07:11:34Z",
      "updated_at": "2022-11-15T07:11:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#discussion_r1022392642",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1022392642"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2886,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1025364390",
      "pull_request_review_id": 1184568433,
      "id": 1025364390,
      "node_id": "PRRC_kwDOABII5849HdGm",
      "diff_hunk": "@@ -589,6 +589,14 @@ class PeerManagerImpl final : public PeerManager\n      */\n     bool MaybeDiscourageAndDisconnect(CNode& pnode, Peer& peer);\n \n+    /**\n+     * Reconsider orphan transactions after a parent has been accepted to the mempool.\n+     *\n+     * @peer[in]  peer     The peer whose orphan transactions we will reconsider. Generally only one\n+     *                     orphan will be reconsidered on each call of this function. This set",
      "path": "src/net_processing.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "original_commit_id": "0027174b396cacbaac5fd52f13be3dca9fcbbfb8",
      "in_reply_to_id": null,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit in 0027174b396cacbaac5fd52f13be3dca9fcbbfb8:\r\n\r\nIt's a bit confusing what \"This set\" refers to.\r\n\r\n```suggestion\r\n     *                     orphan will be reconsidered on each call of this function. The peer's orphan work set\r\n```",
      "created_at": "2022-11-17T15:43:38Z",
      "updated_at": "2022-11-17T18:52:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#discussion_r1025364390",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1025364390"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 593,
      "original_line": 596,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1025481949",
      "pull_request_review_id": 1184568433,
      "id": 1025481949,
      "node_id": "PRRC_kwDOABII5849H5zd",
      "diff_hunk": "@@ -2885,7 +2885,6 @@ bool PeerManagerImpl::ProcessOrphanTx(Peer& peer)\n {\n     AssertLockHeld(g_msgproc_mutex);\n     AssertLockHeld(cs_main);\n-    AssertLockHeld(g_cs_orphans);",
      "path": "src/net_processing.cpp",
      "position": 24,
      "original_position": 24,
      "commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "original_commit_id": "733d85f79cde353d8c9b54370f296b1031fa33d9",
      "in_reply_to_id": null,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "in 733d85f79cde353d8c9b54370f296b1031fa33d9 Note to self, my understanding here is:\r\n\r\n- The two threads that may access orphanage are (1) msg proc and (2) scheduler for calling `m_orphanage.EraseForBlock()` in `BlockConnected()`.\r\n- Previously, we held `g_cs_orphans` through the entirety of `ProcessOrphanTx`, and now we are grabbing the lock for each call here (`AddChildrenToWorkSet(*porphanTx, peer.m_id)`, `EraseTx(orphanHash)`).\r\n\r\nAnd this is fine. The \"problem\" would be if we called `BlockConnected` and e.g. evicted an orphan that was just confirmed. It's fine since `EraseTx()` handles if a tx is already gone, and `AddChildrenToworkSet()` will wait on `g_cs_orphans` for `EraseForBlock()` to be done updating `m_outpoint_to_orphan_it`.",
      "created_at": "2022-11-17T17:24:37Z",
      "updated_at": "2022-11-17T18:52:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#discussion_r1025481949",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1025481949"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2889,
      "original_line": 2888,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1025498339",
      "pull_request_review_id": 1184568433,
      "id": 1025498339,
      "node_id": "PRRC_kwDOABII5849H9zj",
      "diff_hunk": "@@ -21,40 +21,46 @@ extern RecursiveMutex g_cs_orphans;\n class TxOrphanage {\n public:\n     /** Add a new orphan transaction */\n-    bool AddTx(const CTransactionRef& tx, NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(g_cs_orphans);\n+    bool AddTx(const CTransactionRef& tx, NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n \n     /** Check if we already have an orphan transaction (by txid or wtxid) */\n-    bool HaveTx(const GenTxid& gtxid) const LOCKS_EXCLUDED(::g_cs_orphans);\n-\n-    /** Get an orphan transaction and its originating peer\n-     * (Transaction ref will be nullptr if not found)\n+    bool HaveTx(const GenTxid& gtxid) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n+\n+    /** Extract a transaction from a peer's work set\n+     *  Returns nullptr and sets more to false if there are no transactions\n+     *  to work on. Otherwise returns the transaction reference, removes\n+     *  the transaction from the work set, and populates its arguments with\n+     *  the originating peer, and whether there are more orphans for this peer\n+     *  to work on after this tx.\n      */\n-    std::pair<CTransactionRef, NodeId> GetTx(const uint256& txid) const EXCLUSIVE_LOCKS_REQUIRED(g_cs_orphans);\n+    CTransactionRef GetTxToReconsider(NodeId peer, NodeId& originator, bool& more) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);",
      "path": "src/txorphanage.h",
      "position": 33,
      "original_position": 33,
      "commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "original_commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "in_reply_to_id": 998436721,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Was going to comment the same thing, this seems like a better interface given that we only want `originator`/`more` if there is a tx to work on, and generally avoiding in-out params is cleaner. (non-blocking)",
      "created_at": "2022-11-17T17:41:06Z",
      "updated_at": "2022-11-17T18:52:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#discussion_r1025498339",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1025498339"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 36,
      "original_line": 36,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1025513432",
      "pull_request_review_id": 1184568433,
      "id": 1025513432,
      "node_id": "PRRC_kwDOABII5849IBfY",
      "diff_hunk": "@@ -2875,33 +2881,24 @@ void PeerManagerImpl::ProcessHeadersMessage(CNode& pfrom, Peer& peer,\n     return;\n }\n \n-/**\n- * Reconsider orphan transactions after a parent has been accepted to the mempool.\n- *\n- * @param[in,out]  orphan_work_set  The set of orphan transactions to reconsider. Generally only one\n- *                                  orphan will be reconsidered on each call of this function. This set\n- *                                  may be added to if accepting an orphan causes its children to be\n- *                                  reconsidered.\n- */\n-void PeerManagerImpl::ProcessOrphanTx(std::set<uint256>& orphan_work_set)\n+bool PeerManagerImpl::ProcessOrphanTx(Peer& peer)\n {\n+    AssertLockHeld(g_msgproc_mutex);\n     AssertLockHeld(cs_main);\n-    AssertLockHeld(g_cs_orphans);\n-\n-    while (!orphan_work_set.empty()) {\n-        const uint256 orphanHash = *orphan_work_set.begin();\n-        orphan_work_set.erase(orphan_work_set.begin());\n \n-        const auto [porphanTx, from_peer] = m_orphanage.GetTx(orphanHash);\n-        if (porphanTx == nullptr) continue;\n+    CTransactionRef porphanTx = nullptr;\n+    NodeId from_peer = -1;\n+    bool more = false;\n \n+    while (CTransactionRef porphanTx = m_orphanage.GetTxToReconsider(peer.m_id, from_peer, more)) {",
      "path": "src/net_processing.cpp",
      "position": 86,
      "original_position": 86,
      "commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "original_commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "in_reply_to_id": null,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Since you're touching this, I think it's quite strange that we do this in a `while(!work_set.empty())` loop when we're trying to make sure that we only ever process 1 orphan at a time. Perhaps a remnant of pre-#15644 code? My suggestion is to take this out of the while loop and replace the `break`s with returns... but non-blocking of course, can do in another PR.",
      "created_at": "2022-11-17T17:54:12Z",
      "updated_at": "2022-11-17T18:52:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#discussion_r1025513432",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1025513432"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2893,
      "original_line": 2893,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1026077087",
      "pull_request_review_id": 1185569972,
      "id": 1026077087,
      "node_id": "PRRC_kwDOABII5849KLGf",
      "diff_hunk": "@@ -2875,33 +2881,24 @@ void PeerManagerImpl::ProcessHeadersMessage(CNode& pfrom, Peer& peer,\n     return;\n }\n \n-/**\n- * Reconsider orphan transactions after a parent has been accepted to the mempool.\n- *\n- * @param[in,out]  orphan_work_set  The set of orphan transactions to reconsider. Generally only one\n- *                                  orphan will be reconsidered on each call of this function. This set\n- *                                  may be added to if accepting an orphan causes its children to be\n- *                                  reconsidered.\n- */\n-void PeerManagerImpl::ProcessOrphanTx(std::set<uint256>& orphan_work_set)\n+bool PeerManagerImpl::ProcessOrphanTx(Peer& peer)\n {\n+    AssertLockHeld(g_msgproc_mutex);\n     AssertLockHeld(cs_main);\n-    AssertLockHeld(g_cs_orphans);\n-\n-    while (!orphan_work_set.empty()) {\n-        const uint256 orphanHash = *orphan_work_set.begin();\n-        orphan_work_set.erase(orphan_work_set.begin());\n \n-        const auto [porphanTx, from_peer] = m_orphanage.GetTx(orphanHash);\n-        if (porphanTx == nullptr) continue;\n+    CTransactionRef porphanTx = nullptr;\n+    NodeId from_peer = -1;\n+    bool more = false;\n \n+    while (CTransactionRef porphanTx = m_orphanage.GetTxToReconsider(peer.m_id, from_peer, more)) {",
      "path": "src/net_processing.cpp",
      "position": 86,
      "original_position": 86,
      "commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "original_commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "in_reply_to_id": 1025513432,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "There's three \"loops\" I guess:\r\n\r\n * ThreadMessageHandler repeatedly calls ProcessMessages calls ProcessMessage calls ProcessOrphanTx; if ProcessOrphanTx returns true, ProcessMessage exits early so the next run of the ThreadMessageHandler loop for this peer immediately goes back to ProcessOrphanTx\r\n * `while (GetTxToReconsider)` here loops until it actually does some work (ProcessTransaction returns VALID or something other than TX_MISSING_INPUTS, returning `true` if the `while` loop could have continued\r\n * `GetTxToReconsider` loops over the peer's workset, returning the first entry in the workset that still exists as an orphan\r\n\r\nRemoving the `while (GetTxToReconsider)` loop would mean that we'd immediately switch to the next peer anytime we came across an orphan that needed two parents, rather than just one, despite that not taking much time to determine (it's part of MemPoolAccept::PreChecks). I don't think that would be wrong, but the way it is seems better to me.\r\n\r\nRemoving the internal loop for `GetTxToReconsider` would mean you'd need to return a new result: \"there's more work to do, but the first bit of work was a no-op\", and you'd be re-querying `m_peer_work_set.find(peer)` repeatedly.",
      "created_at": "2022-11-18T06:42:49Z",
      "updated_at": "2022-11-18T06:42:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#discussion_r1026077087",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1026077087"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2893,
      "original_line": 2893,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1026084766",
      "pull_request_review_id": 1185581292,
      "id": 1026084766,
      "node_id": "PRRC_kwDOABII5849KM-e",
      "diff_hunk": "@@ -21,40 +21,46 @@ extern RecursiveMutex g_cs_orphans;\n class TxOrphanage {\n public:\n     /** Add a new orphan transaction */\n-    bool AddTx(const CTransactionRef& tx, NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(g_cs_orphans);\n+    bool AddTx(const CTransactionRef& tx, NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n \n     /** Check if we already have an orphan transaction (by txid or wtxid) */\n-    bool HaveTx(const GenTxid& gtxid) const LOCKS_EXCLUDED(::g_cs_orphans);\n-\n-    /** Get an orphan transaction and its originating peer\n-     * (Transaction ref will be nullptr if not found)\n+    bool HaveTx(const GenTxid& gtxid) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n+\n+    /** Extract a transaction from a peer's work set\n+     *  Returns nullptr and sets more to false if there are no transactions\n+     *  to work on. Otherwise returns the transaction reference, removes\n+     *  the transaction from the work set, and populates its arguments with\n+     *  the originating peer, and whether there are more orphans for this peer\n+     *  to work on after this tx.\n      */\n-    std::pair<CTransactionRef, NodeId> GetTx(const uint256& txid) const EXCLUSIVE_LOCKS_REQUIRED(g_cs_orphans);\n+    CTransactionRef GetTxToReconsider(NodeId peer, NodeId& originator, bool& more) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);",
      "path": "src/txorphanage.h",
      "position": 33,
      "original_position": 33,
      "commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "original_commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "in_reply_to_id": 998436721,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "There was some other followup ideas in the previous PR, particularly https://github.com/bitcoin/bitcoin/pull/21527#discussion_r601221165 -- the idea there is that if Alice sends orphan tx Y which has a missing parent X, instead of immediately processing Y when X arrives (which might have arrived from Bob), just put it in Alice's workset, and delay processing of the orphan until it's Alice's turn. Then you'd have `peer == originator` and not need it to be returned as a result. At least last time I looked at this (the 202104-whohandlesorphans branch), it ended up simplifying the function to just `CTransactionRef GetTxToReconsider(NodeId peer)` (using `nullptr` as the \"there's nothing to consider\" indicator).",
      "created_at": "2022-11-18T06:57:58Z",
      "updated_at": "2022-11-18T06:58:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#discussion_r1026084766",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1026084766"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 36,
      "original_line": 36,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028455143",
      "pull_request_review_id": 1188849544,
      "id": 1028455143,
      "node_id": "PRRC_kwDOABII5849TPrn",
      "diff_hunk": "@@ -21,40 +21,46 @@ extern RecursiveMutex g_cs_orphans;\n class TxOrphanage {\n public:\n     /** Add a new orphan transaction */\n-    bool AddTx(const CTransactionRef& tx, NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(g_cs_orphans);\n+    bool AddTx(const CTransactionRef& tx, NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n \n     /** Check if we already have an orphan transaction (by txid or wtxid) */\n-    bool HaveTx(const GenTxid& gtxid) const LOCKS_EXCLUDED(::g_cs_orphans);\n-\n-    /** Get an orphan transaction and its originating peer\n-     * (Transaction ref will be nullptr if not found)\n+    bool HaveTx(const GenTxid& gtxid) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n+\n+    /** Extract a transaction from a peer's work set\n+     *  Returns nullptr and sets more to false if there are no transactions\n+     *  to work on. Otherwise returns the transaction reference, removes\n+     *  the transaction from the work set, and populates its arguments with\n+     *  the originating peer, and whether there are more orphans for this peer\n+     *  to work on after this tx.\n      */\n-    std::pair<CTransactionRef, NodeId> GetTx(const uint256& txid) const EXCLUSIVE_LOCKS_REQUIRED(g_cs_orphans);\n+    CTransactionRef GetTxToReconsider(NodeId peer, NodeId& originator, bool& more) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);",
      "path": "src/txorphanage.h",
      "position": 33,
      "original_position": 33,
      "commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "original_commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "in_reply_to_id": 998436721,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Opened this as a draft at #26551",
      "created_at": "2022-11-21T19:45:13Z",
      "updated_at": "2022-11-21T19:45:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#discussion_r1028455143",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028455143"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 36,
      "original_line": 36,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028459267",
      "pull_request_review_id": 1188855198,
      "id": 1028459267,
      "node_id": "PRRC_kwDOABII5849TQsD",
      "diff_hunk": "@@ -589,6 +589,14 @@ class PeerManagerImpl final : public PeerManager\n      */\n     bool MaybeDiscourageAndDisconnect(CNode& pnode, Peer& peer);\n \n+    /**\n+     * Reconsider orphan transactions after a parent has been accepted to the mempool.\n+     *\n+     * @peer[in]  peer     The peer whose orphan transactions we will reconsider. Generally only one\n+     *                     orphan will be reconsidered on each call of this function. This set",
      "path": "src/net_processing.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "original_commit_id": "0027174b396cacbaac5fd52f13be3dca9fcbbfb8",
      "in_reply_to_id": 1025364390,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Comment updated in #26551",
      "created_at": "2022-11-21T19:50:32Z",
      "updated_at": "2022-11-21T19:50:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#discussion_r1028459267",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028459267"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 593,
      "original_line": 596,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028459421",
      "pull_request_review_id": 1188855411,
      "id": 1028459421,
      "node_id": "PRRC_kwDOABII5849TQud",
      "diff_hunk": "@@ -132,15 +139,19 @@ void TxOrphanage::LimitOrphans(unsigned int max_orphans)\n     {\n         // Evict a random orphan:\n         size_t randompos = rng.randrange(m_orphan_list.size());\n-        EraseTx(m_orphan_list[randompos]->first);\n+        _EraseTx(m_orphan_list[randompos]->first);\n         ++nEvicted;\n     }\n     if (nEvicted > 0) LogPrint(BCLog::MEMPOOL, \"orphanage overflow, removed %u tx\\n\", nEvicted);\n }\n \n-void TxOrphanage::AddChildrenToWorkSet(const CTransaction& tx, std::set<uint256>& orphan_work_set) const\n+void TxOrphanage::AddChildrenToWorkSet(const CTransaction& tx, NodeId peer)\n {\n-    AssertLockHeld(g_cs_orphans);\n+    LOCK(m_mutex);\n+\n+    // Get this peer's work set, emplacing an empty set it didn't exist",
      "path": "src/txorphanage.cpp",
      "position": 83,
      "original_position": 83,
      "commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "original_commit_id": "7082ce3e88d77456d60a5a66bd38807fbd66f311",
      "in_reply_to_id": 998447598,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Comment updated in #26551",
      "created_at": "2022-11-21T19:50:44Z",
      "updated_at": "2022-11-21T19:50:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26295#discussion_r1028459421",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1028459421"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26295"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 152,
      "original_line": 152,
      "side": "RIGHT"
    }
  ]
}