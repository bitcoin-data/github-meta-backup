{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683",
    "id": 795785953,
    "node_id": "PR_kwDOABII584vbrrh",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/23683",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/23683.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/23683.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23683",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23683/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
    "number": 23683,
    "state": "closed",
    "locked": true,
    "maintainer_can_modify": false,
    "title": "bug fix: valid but different LockPoints after a reorg",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I introduced a bug in #22677 (sorry! :sweat_smile:)\r\n\r\nMempool entries cache `LockPoints`, containing the first height/blockhash/`CBlockIndex*` at which the transaction becomes valid. During a reorg, we re-check timelocks on all mempool entries using `CheckSequenceLocks(useExistingLockPoints=false)` and remove any now-invalid entries. `CheckSequenceLocks()` also mutates the `LockPoints` passed in, and we update valid entries' `LockPoints` using `update_lock_points`. Thus, `update_lock_points(lp)` needs to be called right after `CheckSequenceLocks(lp)`, otherwise we lose the data in `lp`. I incorrectly assumed they could be called in separate loops.\r\n\r\nThe incorrect behavior introduced is: if we have a reorg in which a timelocked mempool transaction is still valid but becomes valid at a different block, the cached `LockPoints` will be incorrect.\r\n\r\nThis PR fixes the bug, adds a test, and adds an assertion at the end of `removeForReorg()` to check that all mempool entries' lockpoints are valid. You can reproduce the bug by running the test added in the [test] commit on the code before the [bugfix] commit.",
    "labels": [
      {
        "id": 64585,
        "node_id": "MDU6TGFiZWw2NDU4NQ==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug",
        "name": "Bug",
        "color": "FBBAAB",
        "default": false
      },
      {
        "id": 164208572,
        "node_id": "MDU6TGFiZWwxNjQyMDg1NzI=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Mempool",
        "name": "Mempool",
        "color": "fef2c0",
        "default": false
      }
    ],
    "milestone": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/52",
      "html_url": "https://github.com/bitcoin/bitcoin/milestone/52",
      "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/52/labels",
      "id": 6179837,
      "node_id": "MDk6TWlsZXN0b25lNjE3OTgzNw==",
      "number": 52,
      "state": "closed",
      "title": "23.0",
      "description": "",
      "creator": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "open_issues": 0,
      "closed_issues": 123,
      "created_at": "2020-12-04T08:54:20Z",
      "updated_at": "2022-04-25T20:51:00Z",
      "closed_at": "2022-04-22T18:08:30Z"
    },
    "created_at": "2021-12-06T11:26:34Z",
    "updated_at": "2023-03-21T10:19:59Z",
    "closed_at": "2022-01-03T13:37:42Z",
    "mergeable_state": "unknown",
    "merged_at": "2022-01-03T13:37:42Z",
    "merge_commit_sha": "75a227e39e37d475d6088209f24f32c070071219",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "head": {
      "label": "glozow:2021-12-lockpoints-fix",
      "ref": "2021-12-lockpoints-fix",
      "sha": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 244262754,
        "node_id": "MDEwOlJlcG9zaXRvcnkyNDQyNjI3NTQ=",
        "name": "bitcoin",
        "full_name": "glozow/bitcoin",
        "owner": {
          "login": "glozow",
          "id": 25183001,
          "node_id": "MDQ6VXNlcjI1MTgzMDAx",
          "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/glozow",
          "html_url": "https://github.com/glozow",
          "followers_url": "https://api.github.com/users/glozow/followers",
          "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
          "organizations_url": "https://api.github.com/users/glozow/orgs",
          "repos_url": "https://api.github.com/users/glozow/repos",
          "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/glozow/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/glozow/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/glozow/bitcoin",
        "archive_url": "https://api.github.com/repos/glozow/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/glozow/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/glozow/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/glozow/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/glozow/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/glozow/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/glozow/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/glozow/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/glozow/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/glozow/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/glozow/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/glozow/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/glozow/bitcoin/events",
        "forks_url": "https://api.github.com/repos/glozow/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/glozow/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/glozow/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/glozow/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/glozow/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/glozow/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/glozow/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/glozow/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/glozow/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/glozow/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/glozow/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/glozow/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/glozow/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/glozow/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/glozow/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/glozow/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:glozow/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/glozow/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/glozow/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/glozow/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/glozow/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/glozow/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/glozow/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/glozow/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/glozow/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/glozow/bitcoin/hooks",
        "svn_url": "https://github.com/glozow/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 1,
        "stargazers_count": 7,
        "watchers_count": 7,
        "size": 225090,
        "default_branch": "master",
        "open_issues_count": 1,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-02T10:00:34Z",
        "created_at": "2020-03-02T02:31:56Z",
        "updated_at": "2022-01-07T17:55:23Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "8c0bd871fcf6c5ff5851ccb18a7bc7554a0484b0",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 34324,
        "stargazers_count": 69819,
        "watchers_count": 69819,
        "size": 233879,
        "default_branch": "master",
        "open_issues_count": 627,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-07T05:35:10Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-06-07T04:47:18Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 13,
    "deletions": 14,
    "changed_files": 3,
    "commits": 2,
    "review_comments": 50,
    "comments": 14
  },
  "events": [
    {
      "event": "commented",
      "id": 986688016,
      "node_id": "IC_kwDOABII5846z6oQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/986688016",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-06T11:27:25Z",
      "updated_at": "2021-12-06T11:27:25Z",
      "author_association": "MEMBER",
      "body": "cc @MarcoFalke, thanks for catching my bug :bug:",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#issuecomment-986688016",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23683"
    },
    {
      "event": "mentioned",
      "id": 5719929988,
      "node_id": "MEE_lADOABII584_5ggHzwAAAAFU7zSE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5719929988",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-06T11:27:25Z"
    },
    {
      "event": "subscribed",
      "id": 5719929994,
      "node_id": "SE_lADOABII584_5ggHzwAAAAFU7zSK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5719929994",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-06T11:27:25Z"
    },
    {
      "event": "reviewed",
      "id": 823847626,
      "node_id": "PRR_kwDOABII584xGurK",
      "url": null,
      "actor": null,
      "commit_id": "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Concept ACK. Left some questions on the test.",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#pullrequestreview-823847626",
      "submitted_at": "2021-12-06T11:43:07Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 5720271450,
      "node_id": "HRFPE_lADOABII584_5ggHzwAAAAFU9Gpa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5720271450",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-06T12:32:22Z"
    },
    {
      "event": "milestoned",
      "id": 5720308467,
      "node_id": "MIE_lADOABII584_5ggHzwAAAAFU9Prz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5720308467",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-06T12:39:36Z",
      "milestone": {
        "title": "23.0"
      }
    },
    {
      "event": "labeled",
      "id": 5720474703,
      "node_id": "LE_lADOABII584_5ggHzwAAAAFU94RP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5720474703",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-06T13:10:03Z",
      "label": {
        "name": "Bug",
        "color": "FBBAAB"
      }
    },
    {
      "event": "labeled",
      "id": 5720474706,
      "node_id": "LE_lADOABII584_5ggHzwAAAAFU94RS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5720474706",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-06T13:10:03Z",
      "label": {
        "name": "Mempool",
        "color": "fef2c0"
      }
    },
    {
      "event": "labeled",
      "id": 5720474710,
      "node_id": "LE_lADOABII584_5ggHzwAAAAFU94RW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5720474710",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-06T13:10:03Z",
      "label": {
        "name": "Tests",
        "color": "d4c5f9"
      }
    },
    {
      "event": "reviewed",
      "id": 823962604,
      "node_id": "PRR_kwDOABII584xHKvs",
      "url": null,
      "actor": null,
      "commit_id": "034f13a14a180ee5c060879b686972230d748a22",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Too bad this can't properly be tested on regtest. I guess the only way is via a pre-mined main-chain?\r\n\r\nConcept ACK bd716bf774d21956ec7ae616d06a2a896568ed18 🙆\r\n\r\n<details><summary>Show signature</summary>\r\n\r\nSignature:\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA512\r\n\r\nConcept ACK bd716bf774d21956ec7ae616d06a2a896568ed18 🙆\r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\r\npUjr2gwAqMWws2MpZHhtGe0UDOPIk0PKWrc/Xbg991hVwlMwmHv2ZdgTm0aeYa15\r\nzI0/9PVfKF7P1mTn5iWjJGaoAzsWPyRQAO7imfKwiYOUQnqBBP8s4qpjZxAyE+y4\r\nn9CtBkoDxJd6FBY3/PaC+A/TQCXqrfoefLXMqkCjkFl5aF85YRyAvB69xpKDwMp0\r\nKJLqSga6ThHVkHJOXPoD09yjCEOkT/2K7z2XMTyzGMkzmTBJnhBaLd50Lfy31Ioj\r\nEQz4G7wEskfJkQBATIDzvy0nbwbH38hL30GEVolasAYLUdlxnRQr1QnZEnEUEoV1\r\nMrdzGtQYuBIUyEoaqJyvL/WVb+WEPy1XL/R3VmHf8vWbhAJK2W8RkGW1auE7WZwP\r\nW8HubXwO/dqmXqGd2A9QUaRN1RtYRKL7QwA5ffym++tJQRtpqT4/htuFH4BaIfv/\r\n+Z4d4NPkP8ySa1fhwWvMvLf2JM+5V9572LPInHka1B7t9z9DRjVCN3fb/nMOBzUp\r\nA2NkaSsm\r\n=9LGj\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\n\r\n</details>\r\n",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#pullrequestreview-823962604",
      "submitted_at": "2021-12-06T14:56:15Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGI2MDAyYjA3YTM2ZjBkNThkYzZiZWNkMDRiZmNmNzg1OTkwNTZiN2M",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b6002b07a36f0d58dc6becd04bfcf78599056b7c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b6002b07a36f0d58dc6becd04bfcf78599056b7c",
      "tree": {
        "sha": "cea819b0b8513da2761e194c39b90afb989e360a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/cea819b0b8513da2761e194c39b90afb989e360a"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d20d6ac545159fb98bd9ac828678ddf20f5d016d",
          "sha": "d20d6ac545159fb98bd9ac828678ddf20f5d016d",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/d20d6ac545159fb98bd9ac828678ddf20f5d016d"
        }
      ],
      "message": "MOVEONLY: update_lock_points to txmempool.h",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2021-12-06T15:29:59Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2021-12-03T18:00:00Z"
      },
      "sha": "b6002b07a36f0d58dc6becd04bfcf78599056b7c"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGI0YWRjNWFkNjc2OWU0YTVhNjE3OWRmZmYyNzFjZDRjOWRjNDdhNWI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "tree": {
        "sha": "f1480b9141908f2299d160790de098bc7590159b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f1480b9141908f2299d160790de098bc7590159b"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b6002b07a36f0d58dc6becd04bfcf78599056b7c",
          "sha": "b6002b07a36f0d58dc6becd04bfcf78599056b7c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b6002b07a36f0d58dc6becd04bfcf78599056b7c"
        }
      ],
      "message": "[bugfix] update lockpoints correctly during reorg\n\nDuring a reorg, we re-check timelocks on all mempool entries using\nCheckSequenceLocks(useExistingLockPoints=false) and remove any\nnow-invalid entries. CheckSequenceLocks() also mutates the LockPoints\npassed in, and we update valid entries' LockPoints using\nupdate_lock_points. Thus, update_lock_points(lp) needs to be called\nright after CheckSequenceLocks(lp), otherwise we lose the data in lp.\ncommit bedf246 introduced a bug by separating those two loops.",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2021-12-06T15:30:06Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2021-12-03T18:03:16Z"
      },
      "sha": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 5721411387,
      "node_id": "HRFPE_lADOABII584_5ggHzwAAAAFVBc87",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5721411387",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-06T15:32:10Z"
    },
    {
      "event": "unlabeled",
      "id": 5725837367,
      "node_id": "UNLE_lADOABII584_5ggHzwAAAAFVSVg3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5725837367",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-07T08:45:56Z",
      "label": {
        "name": "Tests",
        "color": "d4c5f9"
      }
    },
    {
      "event": "reviewed",
      "id": 824999003,
      "node_id": "PRR_kwDOABII584xLHxb",
      "url": null,
      "actor": null,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#pullrequestreview-824999003",
      "submitted_at": "2021-12-07T09:21:40Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
    },
    {
      "event": "commented",
      "id": 987752880,
      "node_id": "IC_kwDOABII58463-mw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987752880",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-07T09:53:08Z",
      "updated_at": "2021-12-07T09:53:08Z",
      "author_association": "MEMBER",
      "body": "utACK 28b60ce3122b29ffad2c60790d3bfe9a2ede2471\r\n\r\nThe bug is pretty scary, good thing we found it this soon, and the fix is straightforward.\r\nThe test looks correct.",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#issuecomment-987752880",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23683"
    },
    {
      "event": "commented",
      "id": 987771707,
      "node_id": "IC_kwDOABII58464DM7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987771707",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-07T10:13:32Z",
      "updated_at": "2021-12-07T10:13:32Z",
      "author_association": "MEMBER",
      "body": "> Too bad this can't properly be tested on regtest. I guess the only way is via a pre-mined main-chain?\r\n\r\nAh no. I don't think this is possible to test at all. The lockpoints are just a cache and if it is outdated, evaluating it will always return false, in which case the lockpoints are re-evaluated. So this is not fixing a behaviour bug, but potentially improving performance a bit?",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#issuecomment-987771707",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23683"
    },
    {
      "event": "commented",
      "id": 987829408,
      "node_id": "IC_kwDOABII58464RSg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987829408",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-07T11:18:07Z",
      "updated_at": "2021-12-07T11:18:07Z",
      "author_association": "MEMBER",
      "body": "> > Too bad this can't properly be tested on regtest. I guess the only way is via a pre-mined main-chain?\r\n\r\n> Ah no. I don't think this is possible to test at all. The lockpoints are just a cache and if it is outdated, evaluating it will always return false, in which case the lockpoints are re-evaluated. So this is not fixing a behaviour bug, but potentially improving performance a bit?\r\n\r\nThe \"natural reorg to a new chain that is shorter (but has more work)\" is probably not possible without significant changes to regtest chainparams, I think. Since this PR adds assertions for the lockpoints, making sure they're updated is testable. And true, I suppose outdated lockpoints are not _that_ bad, though now I'm wondering if it's worth adding the assertions if it's relatively harmless.",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#issuecomment-987829408",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23683"
    },
    {
      "event": "reviewed",
      "id": 825381249,
      "node_id": "PRR_kwDOABII584xMlGB",
      "url": null,
      "actor": null,
      "commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "ACK 28b60ce3122b29ffad2c60790d3bfe9a2ede2471\r\n\r\nThe updates look good to me, and they seem to fix the bug introduced in #22677.\r\n\r\nI was able to run the test successfully on the master branch. Thanks for fixing this quickly, @glozow!\r\n\r\n**p.s.** While I ran all the tests on the PR branch using `test/functional/test_runner.py` the following tests failed:\r\n\r\n```\r\nfeature_coinstatsindex.py                          | ✖ Failed  | 2 s\r\nfeature_rbf.py --legacy-wallet                     | ✖ Failed  | 2 s\r\ninterface_bitcoin_cli.py                           | ✖ Failed  | 3 s\r\nwallet_transactiontime_rescan.py                   | ✖ Failed  | 6 s\r\n\r\n```\r\n\r\nThough it is not probably related to this PR. I still wanted to bring it to other contributors' attention. I shall also try running these tests on the master branch to check if the error persists.\r\n\r\nUpdate: The same tests fails with the master too (with top commit d20d6ac545159fb98bd9ac828678ddf20f5d016d). I am not sure what the reason is, though.",
      "user": {
        "login": "shaavan",
        "id": 85434418,
        "node_id": "MDQ6VXNlcjg1NDM0NDE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/85434418?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shaavan",
        "html_url": "https://github.com/shaavan",
        "followers_url": "https://api.github.com/users/shaavan/followers",
        "following_url": "https://api.github.com/users/shaavan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shaavan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shaavan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shaavan/subscriptions",
        "organizations_url": "https://api.github.com/users/shaavan/orgs",
        "repos_url": "https://api.github.com/users/shaavan/repos",
        "events_url": "https://api.github.com/users/shaavan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shaavan/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#pullrequestreview-825381249",
      "submitted_at": "2021-12-07T14:49:02Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
    },
    {
      "event": "commented",
      "id": 987998795,
      "node_id": "IC_kwDOABII584646pL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/987998795",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-07T14:52:28Z",
      "updated_at": "2021-12-07T16:28:36Z",
      "author_association": "MEMBER",
      "body": "> Since this PR adds assertions for the lockpoints\r\n\r\nI was hoping there was a way to test this on current master without modifying the code or looking at the process internal memory, but yeah...",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#issuecomment-987998795",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23683"
    },
    {
      "event": "reviewed",
      "id": 825519204,
      "node_id": "PRR_kwDOABII584xNGxk",
      "url": null,
      "actor": null,
      "commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Concept ACK 28b60ce3122b29ffad2c60790d3bfe9a2ede2471\r\n\r\nI verified that this PR reverts bedf246f1e2497a3641093c6e8fa11fb34dddac4 modulo some code reorganization that happened in the mean time. Also, it adds an assert that was not present before and a test (that always passes?).",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#pullrequestreview-825519204",
      "submitted_at": "2021-12-07T16:39:11Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
    },
    {
      "event": "comment_deleted",
      "id": 5730579505,
      "node_id": "CDE_lADOABII584_5ggHzwAAAAFVkbQx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5730579505",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-07T23:50:03Z"
    },
    {
      "event": "commented",
      "id": 988431074,
      "node_id": "IC_kwDOABII58466kLi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/988431074",
      "actor": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-08T02:09:47Z",
      "updated_at": "2021-12-08T02:09:47Z",
      "author_association": "MEMBER",
      "body": "Concept ACK a64078e\r\n\r\n> Ah no. I don't think this is possible to test at all. The lockpoints are just a cache and if it is outdated, evaluating it will always return false, in which case the lockpoints are re-evaluated. So this is not fixing a behaviour bug, but potentially improving performance a bit?\r\n\r\nYes, I don't think this is a bug introducing invalid transactions in the mempool. Just a perf regression.\r\n\r\nIf you have a reorg from chain H to chain H'' and the lockpoints are not valid anymore on H'', the cache is not going be updated accordingly.\r\n\r\nLet's say you have one more reorg from chain H'' to chain H'''. If H''' includes the max `CBlockIndex` (tested in `TestLockPointValidity`), the lockpoints are _anew_ valid. If H''' does not include the max `CBlockIndex`, the lockpoints are going to be recomputed by `CheckSequenceLocks` to determine if the transaction is final.\r\n\r\nSo if this reasoning is correct, I also agree that caching lockpoints is a perf improvement, in the sense they save few coins fetches and block index walkes ?",
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#issuecomment-988431074",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23683"
    },
    {
      "event": "commented",
      "id": 988606067,
      "node_id": "IC_kwDOABII58467O5z",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/988606067",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-08T08:37:34Z",
      "updated_at": "2021-12-08T08:37:34Z",
      "author_association": "MEMBER",
      "body": "> cc @MarcoFalke, thanks for catching my bug\r\n\r\nHow did you catch this? It looks pretty obscure to me.",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#issuecomment-988606067",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23683"
    },
    {
      "event": "mentioned",
      "id": 5732273044,
      "node_id": "MEE_lADOABII584_5ggHzwAAAAFVq4uU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5732273044",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-08T08:37:35Z"
    },
    {
      "event": "subscribed",
      "id": 5732273060,
      "node_id": "SE_lADOABII584_5ggHzwAAAAFVq4uk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5732273060",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-08T08:37:35Z"
    },
    {
      "event": "commented",
      "id": 988611606,
      "node_id": "IC_kwDOABII58467QQW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/988611606",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-08T08:46:00Z",
      "updated_at": "2021-12-08T08:46:00Z",
      "author_association": "MEMBER",
      "body": "> > cc @MarcoFalke, thanks for catching my bug\r\n> \r\n> How did you catch this? It looks pretty obscure to me.\r\n\r\nThrough code review, basically. Though, it was a bit tricky because there was never an externally observable logic bug, at most the performance difference. For a few hours I even thought the code could be removed (#23660) :sweat_smile: ",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#issuecomment-988611606",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23683"
    },
    {
      "event": "mentioned",
      "id": 5732316516,
      "node_id": "MEE_lADOABII584_5ggHzwAAAAFVrDVk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5732316516",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-08T08:46:01Z"
    },
    {
      "event": "subscribed",
      "id": 5732316523,
      "node_id": "SE_lADOABII584_5ggHzwAAAAFVrDVr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5732316523",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-08T08:46:01Z"
    },
    {
      "event": "commented",
      "id": 989741186,
      "node_id": "IC_kwDOABII5846_kCC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/989741186",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-09T10:56:18Z",
      "updated_at": "2021-12-09T10:56:18Z",
      "author_association": "MEMBER",
      "body": "Change looks good to me. I agree it fixes the lockpoint invalidity bug introduced in #22677.\r\n\r\nA few suggestions for the `check_final_and_mature` lambda:\r\n\r\n- A contributing factor to the the bug being introduced was misleading naming (of `update_lock_points()`) and a lack of documentation. Therefore, we should be extra explicit about what's going on in these functions by adding plenty of code documentation.\r\n- the return value is the inverse of what I'd expect. I'd expect a `check_blah()` function to return `true` if the check passes and `false` if it fails.\r\n- the local `should_remove` variable seems unnecessary. The function can just return immediately if one of the checks fails.\r\n\r\nI've included a suggested patch below. Feel free to take whatever you think is an improvement.\r\n\r\n<details>\r\n<summary>Suggested patch</summary>\r\n\r\n```diff\r\ndiff --git a/src/txmempool.cpp b/src/txmempool.cpp\r\nindex 26cb2ff4b4..c742548875 100644\r\n--- a/src/txmempool.cpp\r\n+++ b/src/txmempool.cpp\r\n@@ -631,7 +631,7 @@ void CTxMemPool::removeForReorg(CChain& chain, std::function<bool(txiter)> check\r\n \r\n     setEntries txToRemove;\r\n     for (indexed_transaction_set::const_iterator it = mapTx.begin(); it != mapTx.end(); it++) {\r\n-        if (check_final_and_mature(it)) txToRemove.insert(it);\r\n+        if (!check_final_and_mature(it)) txToRemove.insert(it);\r\n     }\r\n     setEntries setAllRemoves;\r\n     for (txiter it : txToRemove) {\r\ndiff --git a/src/validation.cpp b/src/validation.cpp\r\nindex f53641e786..8da2e80510 100644\r\n--- a/src/validation.cpp\r\n+++ b/src/validation.cpp\r\n@@ -350,21 +350,38 @@ void CChainState::MaybeUpdateMempoolForReorg(\r\n     // the disconnectpool that were added back and cleans up the mempool state.\r\n     m_mempool->UpdateTransactionsFromBlock(vHashUpdate);\r\n \r\n-    const auto check_final_and_mature = [this, flags=STANDARD_LOCKTIME_VERIFY_FLAGS](CTxMemPool::txiter it)\r\n+    // Check whether the transaction is still final/mature, and update\r\n+    // the transaction's cached lockpoints if necessary.\r\n+    // If this returns false, the mempool *must* remove the transaction, since\r\n+    // it is no longer valid for inclusion in the next block (and its cached\r\n+    // lockpoints may be invalid).\r\n+    const auto check_final_and_mature = [this, flags=STANDARD_LOCKTIME_VERIFY_FLAGS](CTxMemPool::txiter it) -> bool\r\n         EXCLUSIVE_LOCKS_REQUIRED(m_mempool->cs, ::cs_main) {\r\n-        bool should_remove = false;\r\n         AssertLockHeld(m_mempool->cs);\r\n         AssertLockHeld(::cs_main);\r\n         const CTransaction& tx = it->GetTx();\r\n+\r\n+        // Check transaction finality\r\n+        if (!CheckFinalTx(m_chain.Tip(), tx, flags)) {\r\n+            return false;\r\n+        }\r\n+\r\n+        // Check sequence locks\r\n         LockPoints lp = it->GetLockPoints();\r\n         const bool validLP{TestLockPointValidity(m_chain, lp)};\r\n         CCoinsViewMemPool view_mempool(&CoinsTip(), *m_mempool);\r\n-        if (!CheckFinalTx(m_chain.Tip(), tx, flags)\r\n-            || !CheckSequenceLocks(m_chain.Tip(), view_mempool, tx, flags, &lp, validLP)) {\r\n-            // Note if CheckSequenceLocks fails the LockPoints may still be invalid\r\n-            // So it's critical that we remove the tx and not depend on the LockPoints.\r\n-            should_remove = true;\r\n-        } else if (it->GetSpendsCoinbase()) {\r\n+\r\n+        if (!CheckSequenceLocks(m_chain.Tip(), view_mempool, tx, flags, &lp, validLP)) {\r\n+            // Sequence locks fail. The mempool *must* remove this transaction since\r\n+            // we're not going to update its cached lockpoints.\r\n+            return false;\r\n+        } else if (!validLP) {\r\n+            // CheckSequenceLocks has modified lp. Update the cached lockpoints.\r\n+             m_mempool->mapTx.modify(it, update_lock_points(lp));\r\n+        }\r\n+\r\n+        // Check coinbase spend maturity\r\n+        if (it->GetSpendsCoinbase()) {\r\n             for (const CTxIn& txin : tx.vin) {\r\n                 auto it2 = m_mempool->mapTx.find(txin.prevout.hash);\r\n                 if (it2 != m_mempool->mapTx.end())\r\n@@ -373,18 +390,19 @@ void CChainState::MaybeUpdateMempoolForReorg(\r\n                 assert(!coin.IsSpent());\r\n                 const auto mempool_spend_height{m_chain.Tip()->nHeight + 1};\r\n                 if (coin.IsSpent() || (coin.IsCoinBase() && mempool_spend_height - coin.nHeight < COINBASE_MATURITY)) {\r\n-                    should_remove = true;\r\n-                    break;\r\n+                    // Coinbase spend is now immature. Remove tx from mempool.\r\n+                    return false;\r\n                 }\r\n             }\r\n         }\r\n-        // CheckSequenceLocks updates lp. Update the mempool entry LockPoints.\r\n-        if (!validLP) m_mempool->mapTx.modify(it, update_lock_points(lp));\r\n-        return should_remove;\r\n+\r\n+        // Transaction is still final and mature. Cached lockpoints have been updated.\r\n+        return true;\r\n     };\r\n \r\n-    // We also need to remove any now-immature transactions\r\n+    // Remove any transactions that are no longer final/mature, and update cached lockpoints.\r\n     m_mempool->removeForReorg(m_chain, check_final_and_mature);\r\n+\r\n     // Re-limit mempool size, in case we added any transactions\r\n     LimitMempoolSize(\r\n         *m_mempool,\r\n```\r\n\r\n</details>",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#issuecomment-989741186",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23683"
    },
    {
      "event": "reviewed",
      "id": 828733809,
      "node_id": "PRR_kwDOABII584xZXlx",
      "url": null,
      "actor": null,
      "commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b\r\n\r\nNotice - the ACKed commit is the `HEAD~` of this PR, without the topmost commit which adds a test which I do not think is harmful and I do not object. But I don't see what value it adds because:\r\n\r\n* It passes with and without the fix\r\n* If an [assert](https://github.com/bitcoin/bitcoin/pull/23683#discussion_r765731520) is added to the code to make the test fail, then `mempool_reorg.py` fails even without the extension added in this PR\r\n* The extension from this PR does [not increase the code coverage](https://github.com/bitcoin/bitcoin/pull/23683#discussion_r766553409)\r\n\r\nThis is not an objection to the added test snippet, rather ~0 on it. I am happy if it gathers enough ACKs from other devs and gets merged.",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#pullrequestreview-828733809",
      "submitted_at": "2021-12-10T10:28:39Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 5763839607,
      "node_id": "HRFPE_lADOABII584_5ggHzwAAAAFXjTZ3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5763839607",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-14T12:39:32Z"
    },
    {
      "event": "commented",
      "id": 993508250,
      "node_id": "IC_kwDOABII5847N7ua",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/993508250",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-14T12:51:27Z",
      "updated_at": "2021-12-14T12:51:27Z",
      "author_association": "MEMBER",
      "body": "> Notice - the ACKed commit is the HEAD~ of this PR, without the topmost commit which adds a test which I do not think is harmful and I do not object. But I don't see what value it adds \r\n\r\nI've removed the test. Perhaps a followup dedicated to test improvements can convert the `invalidateblock`s to natural reorgs.\r\n\r\n> A few suggestions for the check_final_and_mature lambda:\r\n\r\nThanks, I've applied (most of) your diff. I see what you mean by the return results being unexpected for something called \"check.\" My wish is to follow the convention of a unary predicate that returns `true` if something needs to be removed. I've renamed check to filter.",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#issuecomment-993508250",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23683"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 5763933441,
      "node_id": "HRFPE_lADOABII584_5ggHzwAAAAFXjqUB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5763933441",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-14T12:55:31Z"
    },
    {
      "event": "reviewed",
      "id": 831775988,
      "node_id": "PRR_kwDOABII584xk-T0",
      "url": null,
      "actor": null,
      "commit_id": "2586226ec20a97f9ab9f3b7eae8a5c7fb6a7806b",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#pullrequestreview-831775988",
      "submitted_at": "2021-12-14T17:22:57Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 5780024099,
      "node_id": "HRFPE_lADOABII584_5ggHzwAAAAFYhCsj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5780024099",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-16T17:42:08Z"
    },
    {
      "event": "commented",
      "id": 996039695,
      "node_id": "IC_kwDOABII5847XlwP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/996039695",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-16T17:44:35Z",
      "updated_at": "2021-12-16T17:44:35Z",
      "author_association": "MEMBER",
      "body": "Sorry for the churn. I had wanted to incorporate the suggestions in https://github.com/bitcoin/bitcoin/pull/23683#issuecomment-989741186 for the lambda, but I now think it's best saved for a different PR.",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#issuecomment-996039695",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23683"
    },
    {
      "event": "commented",
      "id": 998529602,
      "node_id": "IC_kwDOABII5847hFpC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/998529602",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-21T07:14:05Z",
      "updated_at": "2021-12-21T07:14:05Z",
      "author_association": "MEMBER",
      "body": "> Sorry for the churn. I had wanted to incorporate the suggestions in #23683 (comment) for the lambda, but I now think it's best saved for a different PR.\r\n\r\nI think it's very important that the comments are updated to clarify what this function is doing. A bug was introduced in this code because the code was unclear, so we should take the opportunity to clarify it to prevent a similar regression being added again.\r\n\r\nThis branch does fix the recent regression, but I think it's significantly worse than the previous version since good tests and clarifying code comments have been removed.",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#issuecomment-998529602",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23683"
    },
    {
      "event": "reviewed",
      "id": 840529959,
      "node_id": "PRR_kwDOABII584yGXgn",
      "url": null,
      "actor": null,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Code Review ACK b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b\r\n\r\nI agree that this fixes the \"bug\", and verified that `mempool_reorg.py` fails if only the assert from b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b is added but not the fix. \r\nCan't comment on any of the older versions/tests - I think that the refactoring/doc proposed by @jnewbery looks sensible, but could also be a follow-up PR.\r\n\r\n\r\nCommit message nit:\r\n\r\n> During a reorg, we re-check timelocks on all mempool entries using\r\nCheckSequenceLocks(useExistingLockPoints=false) and remove any\r\nnow-invalid entries.\r\n\r\nThat sounds as if we call `CheckSequenceLocks(useExistingLockPoints=false)` for all entries, but we call `TestLockPointValidity()` for all mempool entries, and call \r\n`CheckSequenceLocks(useExistingLockPoints=false)` only for those with invalid lockpoints.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#pullrequestreview-840529959",
      "submitted_at": "2021-12-27T19:16:26Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
    },
    {
      "event": "commented",
      "id": 1002034913,
      "node_id": "IC_kwDOABII5847udbh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1002034913",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-28T11:23:15Z",
      "updated_at": "2021-12-28T11:23:15Z",
      "author_association": "MEMBER",
      "body": "Concept ACK.",
      "user": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#issuecomment-1002034913",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23683"
    },
    {
      "event": "reviewed",
      "id": 841408330,
      "node_id": "PRR_kwDOABII584yJt9K",
      "url": null,
      "actor": null,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "user": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#pullrequestreview-841408330",
      "submitted_at": "2021-12-29T13:36:53Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
    },
    {
      "event": "commented",
      "id": 1002662617,
      "node_id": "IC_kwDOABII5847w2rZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1002662617",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-29T15:58:16Z",
      "updated_at": "2021-12-29T15:59:04Z",
      "author_association": "MEMBER",
      "body": "ACK b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b\r\n\r\nBut please do update the comments and add a test in a follow-up.",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#issuecomment-1002662617",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23683"
    },
    {
      "event": "reviewed",
      "id": 842729728,
      "node_id": "PRR_kwDOABII584yOwkA",
      "url": null,
      "actor": null,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "re-ACK b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b 🏁\r\n\r\nOnly changes:\r\n* Remove commit that adds test (bd716bf774)\r\n* Remove useless doxygen comment on struct update_lock_points\r\n* Expand the commit message of commit b4adc5ad67 \"[bugfix] update lockpoints correctly during reorg\"\r\n\r\n<details><summary>Show signature</summary>\r\n\r\nSignature:\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA512\r\n\r\nre-ACK b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b 🏁\r\n\r\nOnly changes:\r\n* Remove commit that adds test (bd716bf774)\r\n* Remove useless doxygen comment on struct update_lock_points\r\n* Expand the commit message of commit b4adc5ad67 \"[bugfix] update lockpoints correctly during reorg\"\r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\r\npUjyJgwAiIcxIULHGXbeJdpJrr/yTOIL9za7KmSpiwuFZgB5alGaxZHVwNXz5tMs\r\nJgREgzSCQyGFl6otzezJKQ4ZwZ3+m6Xkjlop9DGQNgVXlRPs0hAUwePLj0c1a0Y7\r\nXpJaCS8U3Ovi/av/eTXBaAAVZ/tH/ngqiSo1Y7E41e4c12IGtE4JlgXaaI8+vaC8\r\n4oF29XugN/FWuoY8WXqXGHwnRyxyhid9QR7uLfmQC+0tcEUW2bu9yDH+hWuFeNs1\r\n8gu6mb76OuMqRQR/PRA7Jx+vN2WlN9eCua+TFVWvxS9vl06jOOrz2Yw4qC8gisgz\r\nJ5rzAH8y5aMnztO9I2//smKojsxtierk2dIe2BXBGsgoo8GqxsbLocCHuTrvlt56\r\neBJuUZLFYc3G5WtxD55cc6WpPGMVJJ/5sfptnYYNiaaca6bIYk1dmBklAQDdeyGg\r\nGtwDfvZIbYFMU2Aq+cAta59oo7Xtw9tSWS6Kp1sKJOQxQfhB39XBxjgc5qwZ7L1z\r\nhSX5amzs\r\n=W5Xo\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\n\r\n</details>\r\n",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#pullrequestreview-842729728",
      "submitted_at": "2022-01-03T13:29:59Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
    },
    {
      "event": "merged",
      "id": 5835336324,
      "node_id": "ME_lADOABII584_5ggHzwAAAAFb0CqE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5835336324",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "75a227e39e37d475d6088209f24f32c070071219",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/75a227e39e37d475d6088209f24f32c070071219",
      "created_at": "2022-01-03T13:37:42Z"
    },
    {
      "event": "closed",
      "id": 5835336342,
      "node_id": "CE_lADOABII584_5ggHzwAAAAFb0CqW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5835336342",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-01-03T13:37:43Z"
    },
    {
      "event": "referenced",
      "id": 5837683569,
      "node_id": "REFE_lADOABII584_5ggHzwAAAAFb8_tx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5837683569",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "f76bc09f0e21aa11eddf4c5c2a0e003f5ddbe64b",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/f76bc09f0e21aa11eddf4c5c2a0e003f5ddbe64b",
      "created_at": "2022-01-04T00:14:03Z"
    },
    {
      "event": "head_ref_deleted",
      "id": 5841251972,
      "node_id": "HRDE_lADOABII584_5ggHzwAAAAFcKm6E",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5841251972",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-01-04T15:50:20Z"
    },
    {
      "event": "referenced",
      "id": 5918135406,
      "node_id": "REFE_lADOABII584_5ggHzwAAAAFgv5Ru",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5918135406",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "06b6369766137756648b3cb62c8f385cca234e69",
      "commit_url": "https://api.github.com/repos/bitcoin-core/gui/commits/06b6369766137756648b3cb62c8f385cca234e69",
      "created_at": "2022-01-19T14:32:52Z"
    },
    {
      "event": "referenced",
      "id": 7780980219,
      "node_id": "REFE_lADOABII584_5ggHzwAAAAHPyFX7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7780980219",
      "actor": {
        "login": "Fabcien",
        "id": 44533924,
        "node_id": "MDQ6VXNlcjQ0NTMzOTI0",
        "avatar_url": "https://avatars.githubusercontent.com/u/44533924?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Fabcien",
        "html_url": "https://github.com/Fabcien",
        "followers_url": "https://api.github.com/users/Fabcien/followers",
        "following_url": "https://api.github.com/users/Fabcien/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Fabcien/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Fabcien/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Fabcien/subscriptions",
        "organizations_url": "https://api.github.com/users/Fabcien/orgs",
        "repos_url": "https://api.github.com/users/Fabcien/repos",
        "events_url": "https://api.github.com/users/Fabcien/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Fabcien/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "848f2f48c23f5625818917ed4f7d19a6c6651a7f",
      "commit_url": "https://api.github.com/repos/Bitcoin-ABC/bitcoin-abc/commits/848f2f48c23f5625818917ed4f7d19a6c6651a7f",
      "created_at": "2022-11-10T08:54:25Z"
    },
    {
      "event": "referenced",
      "id": 7784243865,
      "node_id": "REFE_lADOABII584_5ggHzwAAAAHP-iKZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7784243865",
      "actor": {
        "login": "Fabcien",
        "id": 44533924,
        "node_id": "MDQ6VXNlcjQ0NTMzOTI0",
        "avatar_url": "https://avatars.githubusercontent.com/u/44533924?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Fabcien",
        "html_url": "https://github.com/Fabcien",
        "followers_url": "https://api.github.com/users/Fabcien/followers",
        "following_url": "https://api.github.com/users/Fabcien/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Fabcien/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Fabcien/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Fabcien/subscriptions",
        "organizations_url": "https://api.github.com/users/Fabcien/orgs",
        "repos_url": "https://api.github.com/users/Fabcien/repos",
        "events_url": "https://api.github.com/users/Fabcien/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Fabcien/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "3b8d42aff6aee95eb5019c3e50e563e6460bda34",
      "commit_url": "https://api.github.com/repos/Bitcoin-ABC/bitcoin-abc/commits/3b8d42aff6aee95eb5019c3e50e563e6460bda34",
      "created_at": "2022-11-10T15:08:17Z"
    },
    {
      "event": "referenced",
      "id": 7784243880,
      "node_id": "REFE_lADOABII584_5ggHzwAAAAHP-iKo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7784243880",
      "actor": {
        "login": "Fabcien",
        "id": 44533924,
        "node_id": "MDQ6VXNlcjQ0NTMzOTI0",
        "avatar_url": "https://avatars.githubusercontent.com/u/44533924?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Fabcien",
        "html_url": "https://github.com/Fabcien",
        "followers_url": "https://api.github.com/users/Fabcien/followers",
        "following_url": "https://api.github.com/users/Fabcien/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Fabcien/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Fabcien/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Fabcien/subscriptions",
        "organizations_url": "https://api.github.com/users/Fabcien/orgs",
        "repos_url": "https://api.github.com/users/Fabcien/repos",
        "events_url": "https://api.github.com/users/Fabcien/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Fabcien/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "096a1319b8825a77e5a5bf17173d4c909459725f",
      "commit_url": "https://api.github.com/repos/Bitcoin-ABC/bitcoin-abc/commits/096a1319b8825a77e5a5bf17173d4c909459725f",
      "created_at": "2022-11-10T15:08:17Z"
    },
    {
      "event": "referenced",
      "id": 8629223981,
      "node_id": "REFE_lADOABII584_5ggHzwAAAAICV4It",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8629223981",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "a8080c0def0be59b98fe418d1e8efaf502a20062",
      "commit_url": "https://api.github.com/repos/bitcoin-core/gui/commits/a8080c0def0be59b98fe418d1e8efaf502a20062",
      "created_at": "2023-02-28T16:53:35Z"
    },
    {
      "event": "locked",
      "id": 8803655262,
      "node_id": "LOE_lADOABII584_5ggHzwAAAAIMvR5e",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8803655262",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-21T10:19:59Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762930383",
      "pull_request_review_id": 823847626,
      "id": 762930383,
      "node_id": "PRRC_kwDOABII584teWTP",
      "diff_hunk": "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 4,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: Why is this needed? The `self.sync_all()` in the next line should take care of that already. I think it should be fine to remove either this line or the next.",
      "created_at": "2021-12-06T11:39:47Z",
      "updated_at": "2021-12-06T11:43:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762930383",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762930383"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 109,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762930557",
      "pull_request_review_id": 823847626,
      "id": 762930557,
      "node_id": "PRRC_kwDOABII584teWV9",
      "diff_hunk": "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 9,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: Why is this needed? Are they not connected already?",
      "created_at": "2021-12-06T11:40:05Z",
      "updated_at": "2021-12-06T11:43:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762930557",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762930557"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 112,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762931172",
      "pull_request_review_id": 823847626,
      "id": 762931172,
      "node_id": "PRRC_kwDOABII584teWfk",
      "diff_hunk": "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)\n+        assert_equal(self.nodes[0].getblockcount(), self.nodes[1].getblockcount())\n+        assert_equal(set(self.nodes[0].getrawmempool()), set(self.nodes[0].getrawmempool()))",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 11,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: Why are the asserts needed? The implicit `self.sync_all` in the next line should assert this already.",
      "created_at": "2021-12-06T11:41:02Z",
      "updated_at": "2021-12-06T11:43:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762931172",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762931172"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 116,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762931588",
      "pull_request_review_id": 823847626,
      "id": 762931588,
      "node_id": "PRRC_kwDOABII584teWmE",
      "diff_hunk": "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)\n+        assert_equal(self.nodes[0].getblockcount(), self.nodes[1].getblockcount())\n+        assert_equal(set(self.nodes[0].getrawmempool()), set(self.nodes[0].getrawmempool()))\n+        self.generate(self.nodes[0], 3)\n+        # Create another transaction which is time-locked to two blocks in the future\n+        utxo = wallet.get_utxo()\n+        timelock_tx_2 = wallet.create_self_transfer(\n+            from_node=self.nodes[0],\n+            utxo_to_spend=utxo,",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 17,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: Why is this needed? The wallet will pick a utxo by itself.",
      "created_at": "2021-12-06T11:41:37Z",
      "updated_at": "2021-12-06T11:43:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762931588",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762931588"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 122,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762931929",
      "pull_request_review_id": 823847626,
      "id": 762931929,
      "node_id": "PRRC_kwDOABII584teWrZ",
      "diff_hunk": "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)\n+        assert_equal(self.nodes[0].getblockcount(), self.nodes[1].getblockcount())\n+        assert_equal(set(self.nodes[0].getrawmempool()), set(self.nodes[0].getrawmempool()))\n+        self.generate(self.nodes[0], 3)\n+        # Create another transaction which is time-locked to two blocks in the future\n+        utxo = wallet.get_utxo()\n+        timelock_tx_2 = wallet.create_self_transfer(\n+            from_node=self.nodes[0],\n+            utxo_to_spend=utxo,\n+            mempool_valid=False,\n+            locktime=self.nodes[0].getblockcount() + 2\n+        )['hex']\n+        # Check that the time-locked transaction is too immature to spend\n+        assert_raises_rpc_error(-26, \"non-final\", self.nodes[0].sendrawtransaction, timelock_tx_2)\n+        assert_raises_rpc_error(-26, \"non-final\", self.nodes[1].sendrawtransaction, timelock_tx_2)\n+\n+        self.log.info(\"Disconnect nodes and mine separate forks\")\n+        self.disconnect_nodes(0, 1)\n+        # Don't try to sync nodes because they are disconnected\n+        no_sync_func = lambda: True",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 28,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: Why is this needed? You can use `self.no_op`",
      "created_at": "2021-12-06T11:42:08Z",
      "updated_at": "2021-12-06T11:43:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762931929",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762931929"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 133,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965682",
      "pull_request_review_id": 823895457,
      "id": 762965682,
      "node_id": "PRRC_kwDOABII584tee6y",
      "diff_hunk": "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 9,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
      "in_reply_to_id": 762930557,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "They don't stay in sync if I don't call `connect_nodes` here... it also doesn't work if I call `connect_nodes(1, 0)` instead. So my guess is that this creation of a manual connection from node0 to node1 adds a permission that we need.",
      "created_at": "2021-12-06T12:32:45Z",
      "updated_at": "2021-12-06T12:32:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762965682",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965682"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 112,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965737",
      "pull_request_review_id": 823895535,
      "id": 762965737,
      "node_id": "PRRC_kwDOABII584tee7p",
      "diff_hunk": "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)\n+        assert_equal(self.nodes[0].getblockcount(), self.nodes[1].getblockcount())\n+        assert_equal(set(self.nodes[0].getrawmempool()), set(self.nodes[0].getrawmempool()))",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 11,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
      "in_reply_to_id": 762931172,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "removed",
      "created_at": "2021-12-06T12:32:50Z",
      "updated_at": "2021-12-06T12:32:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762965737",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965737"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 116,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965821",
      "pull_request_review_id": 823895638,
      "id": 762965821,
      "node_id": "PRRC_kwDOABII584tee89",
      "diff_hunk": "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)\n+        assert_equal(self.nodes[0].getblockcount(), self.nodes[1].getblockcount())\n+        assert_equal(set(self.nodes[0].getrawmempool()), set(self.nodes[0].getrawmempool()))\n+        self.generate(self.nodes[0], 3)\n+        # Create another transaction which is time-locked to two blocks in the future\n+        utxo = wallet.get_utxo()\n+        timelock_tx_2 = wallet.create_self_transfer(\n+            from_node=self.nodes[0],\n+            utxo_to_spend=utxo,",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 17,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
      "in_reply_to_id": 762931588,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "removed",
      "created_at": "2021-12-06T12:32:57Z",
      "updated_at": "2021-12-06T12:32:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762965821",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965821"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 122,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965966",
      "pull_request_review_id": 823895859,
      "id": 762965966,
      "node_id": "PRRC_kwDOABII584tee_O",
      "diff_hunk": "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)\n+        assert_equal(self.nodes[0].getblockcount(), self.nodes[1].getblockcount())\n+        assert_equal(set(self.nodes[0].getrawmempool()), set(self.nodes[0].getrawmempool()))\n+        self.generate(self.nodes[0], 3)\n+        # Create another transaction which is time-locked to two blocks in the future\n+        utxo = wallet.get_utxo()\n+        timelock_tx_2 = wallet.create_self_transfer(\n+            from_node=self.nodes[0],\n+            utxo_to_spend=utxo,\n+            mempool_valid=False,\n+            locktime=self.nodes[0].getblockcount() + 2\n+        )['hex']\n+        # Check that the time-locked transaction is too immature to spend\n+        assert_raises_rpc_error(-26, \"non-final\", self.nodes[0].sendrawtransaction, timelock_tx_2)\n+        assert_raises_rpc_error(-26, \"non-final\", self.nodes[1].sendrawtransaction, timelock_tx_2)\n+\n+        self.log.info(\"Disconnect nodes and mine separate forks\")\n+        self.disconnect_nodes(0, 1)\n+        # Don't try to sync nodes because they are disconnected\n+        no_sync_func = lambda: True",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 28,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
      "in_reply_to_id": 762931929,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "ahh, didn't know about that - fixed",
      "created_at": "2021-12-06T12:33:11Z",
      "updated_at": "2021-12-06T12:33:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762965966",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762965966"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 133,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762966229",
      "pull_request_review_id": 823896117,
      "id": 762966229,
      "node_id": "PRRC_kwDOABII584tefDV",
      "diff_hunk": "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 4,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
      "in_reply_to_id": 762930383,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "removed",
      "created_at": "2021-12-06T12:33:28Z",
      "updated_at": "2021-12-06T12:33:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r762966229",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/762966229"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 109,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763013572",
      "pull_request_review_id": 823962604,
      "id": 763013572,
      "node_id": "PRRC_kwDOABII584teqnE",
      "diff_hunk": "@@ -312,6 +312,19 @@ class CompareTxMemPoolEntryByAncestorFee\n     }\n };\n \n+/**\n+ * Update LockPoints in a mempool entry for which the caller only has a const iterator to.",
      "path": "src/txmempool.h",
      "position": null,
      "original_position": 5,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "034f13a14a180ee5c060879b686972230d748a22",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think this comment can be removed. Mutable iterators in the mempool don't exist and the function name is self-explanatory.",
      "created_at": "2021-12-06T13:38:44Z",
      "updated_at": "2021-12-06T14:56:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763013572",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763013572"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 316,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763015410",
      "pull_request_review_id": 823962604,
      "id": 763015410,
      "node_id": "PRRC_kwDOABII584terDy",
      "diff_hunk": "@@ -378,6 +378,8 @@ void CChainState::MaybeUpdateMempoolForReorg(\n                 }",
      "path": "src/validation.cpp",
      "position": 1,
      "original_position": 1,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "f1f3f19f84da6bc5a157d9bf2e5c0500f53ae614",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "in the second commit: Maybe mention that the bug was introduces in commit  bedf246 ?",
      "created_at": "2021-12-06T13:41:05Z",
      "updated_at": "2021-12-06T14:56:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763015410",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763015410"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 378,
      "original_line": 378,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763037472",
      "pull_request_review_id": 823962604,
      "id": 763037472,
      "node_id": "PRRC_kwDOABII584tewcg",
      "diff_hunk": "@@ -108,6 +108,37 @@ def run_test(self):\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n         self.sync_all()\n \n+        self.log.info(\"Simulate a natural reorg where mempool transaction stays valid but on a different block\")\n+        self.connect_nodes(0, 1)\n+        # Mine a block to create mature coinbase\n+        self.generate(self.nodes[0], 2)\n+        # Create another transaction which is time-locked to two blocks in the future\n+        timelock_tx_2 = wallet.create_self_transfer(\n+            from_node=self.nodes[0],\n+            mempool_valid=False,\n+            locktime=self.nodes[0].getblockcount() + 2",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 12,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "bd716bf774d21956ec7ae616d06a2a896568ed18",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: missing trailing `,`.",
      "created_at": "2021-12-06T14:07:54Z",
      "updated_at": "2021-12-06T14:56:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763037472",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763037472"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 119,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763051867",
      "pull_request_review_id": 823962604,
      "id": 763051867,
      "node_id": "PRRC_kwDOABII584tez9b",
      "diff_hunk": "@@ -106,8 +106,45 @@ def run_test(self):\n \n         self.log.info(\"Check that the mempool is empty\")\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n+        assert_equal(set(self.nodes[1].getrawmempool()), set())\n         self.sync_all()\n \n \n+        self.log.info(\"Simulate natural reorg\")\n+        self.connect_nodes(0, 1)",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 9,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "48d1b46f3ee27a909ed06cd020c5e6c33a63feeb",
      "in_reply_to_id": 762930557,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Ah ok, it is not possible to use compact blocks during IBD",
      "created_at": "2021-12-06T14:24:09Z",
      "updated_at": "2021-12-06T14:56:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763051867",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763051867"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 112,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763115678",
      "pull_request_review_id": 824105584,
      "id": 763115678,
      "node_id": "PRRC_kwDOABII584tfDie",
      "diff_hunk": "@@ -378,6 +378,8 @@ void CChainState::MaybeUpdateMempoolForReorg(\n                 }",
      "path": "src/validation.cpp",
      "position": 1,
      "original_position": 1,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "f1f3f19f84da6bc5a157d9bf2e5c0500f53ae614",
      "in_reply_to_id": 763015410,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "added",
      "created_at": "2021-12-06T15:32:13Z",
      "updated_at": "2021-12-06T15:32:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763115678",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763115678"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 378,
      "original_line": 378,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763115781",
      "pull_request_review_id": 824105729,
      "id": 763115781,
      "node_id": "PRRC_kwDOABII584tfDkF",
      "diff_hunk": "@@ -108,6 +108,37 @@ def run_test(self):\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n         self.sync_all()\n \n+        self.log.info(\"Simulate a natural reorg where mempool transaction stays valid but on a different block\")\n+        self.connect_nodes(0, 1)\n+        # Mine a block to create mature coinbase\n+        self.generate(self.nodes[0], 2)\n+        # Create another transaction which is time-locked to two blocks in the future\n+        timelock_tx_2 = wallet.create_self_transfer(\n+            from_node=self.nodes[0],\n+            mempool_valid=False,\n+            locktime=self.nodes[0].getblockcount() + 2",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 12,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "bd716bf774d21956ec7ae616d06a2a896568ed18",
      "in_reply_to_id": 763037472,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "added",
      "created_at": "2021-12-06T15:32:20Z",
      "updated_at": "2021-12-06T15:32:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763115781",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763115781"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 119,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763115892",
      "pull_request_review_id": 824105858,
      "id": 763115892,
      "node_id": "PRRC_kwDOABII584tfDl0",
      "diff_hunk": "@@ -312,6 +312,19 @@ class CompareTxMemPoolEntryByAncestorFee\n     }\n };\n \n+/**\n+ * Update LockPoints in a mempool entry for which the caller only has a const iterator to.",
      "path": "src/txmempool.h",
      "position": null,
      "original_position": 5,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "034f13a14a180ee5c060879b686972230d748a22",
      "in_reply_to_id": 763013572,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "removed",
      "created_at": "2021-12-06T15:32:25Z",
      "updated_at": "2021-12-06T15:32:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763115892",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763115892"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 316,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763794040",
      "pull_request_review_id": 824999003,
      "id": 763794040,
      "node_id": "PRRC_kwDOABII584thpJ4",
      "diff_hunk": "@@ -378,6 +378,8 @@ void CChainState::MaybeUpdateMempoolForReorg(\n                 }\n             }\n         }\n+        // CheckSequenceLocks updates lp. Update the mempool entry LockPoints.\n+        if (!validLP) m_mempool->mapTx.modify(it, update_lock_points(lp));",
      "path": "src/validation.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "in_reply_to_id": null,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I was thinking \"what if we skip those transactions with `should_remove=true` here?\". I guess, we'll have the same original problem: they won't be cleared because we would mistakenly think they have valid `lp` in `removeForReorg`?\r\n\r\nPerhaps this deserves a comment extension, saying that txs to be removed must be updated here.",
      "created_at": "2021-12-07T09:21:39Z",
      "updated_at": "2021-12-07T09:22:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763794040",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763794040"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 382,
      "original_line": 382,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763810771",
      "pull_request_review_id": 825021997,
      "id": 763810771,
      "node_id": "PRRC_kwDOABII584thtPT",
      "diff_hunk": "@@ -378,6 +378,8 @@ void CChainState::MaybeUpdateMempoolForReorg(\n                 }\n             }\n         }\n+        // CheckSequenceLocks updates lp. Update the mempool entry LockPoints.\n+        if (!validLP) m_mempool->mapTx.modify(it, update_lock_points(lp));",
      "path": "src/validation.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "in_reply_to_id": 763794040,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "No, they'll still be cleared - `removeForReorg` just applies `check_final_and_mature` on all entries and removes them if it returns true, it doesn't check whether the `lp` is valid. I'm not 100% sure if we could skip the `should_remove=true` ones, but I think it would be fine. The `CheckSequenceLocks` function doesn't guarantee `lp` to be reliable if it returns false, and the function doesn't even get executed if `CheckFinalTx` returns false.",
      "created_at": "2021-12-07T09:41:07Z",
      "updated_at": "2021-12-07T09:41:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763810771",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763810771"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 382,
      "original_line": 382,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763836593",
      "pull_request_review_id": 825058969,
      "id": 763836593,
      "node_id": "PRRC_kwDOABII584thzix",
      "diff_hunk": "@@ -378,6 +378,8 @@ void CChainState::MaybeUpdateMempoolForReorg(\n                 }\n             }\n         }\n+        // CheckSequenceLocks updates lp. Update the mempool entry LockPoints.\n+        if (!validLP) m_mempool->mapTx.modify(it, update_lock_points(lp));",
      "path": "src/validation.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "in_reply_to_id": 763794040,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I agree that it is safe to skip if the tx will be removed anyway. When this was introduced in commit 14d6324a248df50cb79fbeb5b60a978687a3b64e it updates unconditionally.",
      "created_at": "2021-12-07T10:09:13Z",
      "updated_at": "2021-12-07T10:09:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r763836593",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/763836593"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 382,
      "original_line": 382,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764162261",
      "pull_request_review_id": 825510685,
      "id": 764162261,
      "node_id": "PRRC_kwDOABII584tjDDV",
      "diff_hunk": "@@ -378,6 +378,8 @@ void CChainState::MaybeUpdateMempoolForReorg(\n                 }\n             }\n         }\n+        // CheckSequenceLocks updates lp. Update the mempool entry LockPoints.\n+        if (!validLP) m_mempool->mapTx.modify(it, update_lock_points(lp));",
      "path": "src/validation.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "in_reply_to_id": 763794040,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I was just about to post the same optimization suggestion: change this to `if (!validLP && !should_remove)`.\r\n\r\n> I guess, we'll have the same original problem: they won't be cleared because we would mistakenly think they have valid lp in removeForReorg\r\n\r\nI don't see it that way - the tx will be removed if this lambda `check_final_and_mature()` returns `true`, so why bother updating that tx data? (I see no reason).",
      "created_at": "2021-12-07T16:24:51Z",
      "updated_at": "2021-12-07T16:24:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r764162261",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764162261"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 382,
      "original_line": 382,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764168506",
      "pull_request_review_id": 825519204,
      "id": 764168506,
      "node_id": "PRRC_kwDOABII584tjEk6",
      "diff_hunk": "@@ -649,10 +639,7 @@ void CTxMemPool::removeForReorg(CChain& chain, std::function<bool(txiter)> check\n     }\n     RemoveStaged(setAllRemoves, false, MemPoolRemovalReason::REORG);\n     for (indexed_transaction_set::const_iterator it = mapTx.begin(); it != mapTx.end(); it++) {\n-        const LockPoints lp{it->GetLockPoints()};\n-        if (!TestLockPointValidity(chain, lp)) {\n-            mapTx.modify(it, update_lock_points(lp));\n-        }\n+        assert(TestLockPointValidity(chain, it->GetLockPoints()));",
      "path": "src/txmempool.cpp",
      "position": 25,
      "original_position": 25,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Is it not better to add this assert as soon as the data is updated? That is, something like this:\r\n\r\n<details>\r\n<summary>patch</summary>\r\n\r\n```diff\r\ndiff --git i/src/txmempool.cpp w/src/txmempool.cpp\r\nindex 26cb2ff4b4..8149c6dcd7 100644\r\n--- i/src/txmempool.cpp\r\n+++ w/src/txmempool.cpp\r\n@@ -635,15 +635,12 @@ void CTxMemPool::removeForReorg(CChain& chain, std::function<bool(txiter)> check\r\n     }\r\n     setEntries setAllRemoves;\r\n     for (txiter it : txToRemove) {\r\n         CalculateDescendants(it, setAllRemoves);\r\n     }\r\n     RemoveStaged(setAllRemoves, false, MemPoolRemovalReason::REORG);\r\n-    for (indexed_transaction_set::const_iterator it = mapTx.begin(); it != mapTx.end(); it++) {\r\n-        assert(TestLockPointValidity(chain, it->GetLockPoints()));\r\n-    }\r\n }\r\n \r\n void CTxMemPool::removeConflicts(const CTransaction &tx)\r\n {\r\n     // Remove transactions which depend on inputs of tx, recursively\r\n     AssertLockHeld(cs);\r\ndiff --git i/src/validation.cpp w/src/validation.cpp\r\nindex 68729e4863..541b7be499 100644\r\n--- i/src/validation.cpp\r\n+++ w/src/validation.cpp\r\n@@ -377,12 +377,15 @@ void CChainState::MaybeUpdateMempoolForReorg(\r\n                     break;\r\n                 }\r\n             }\r\n         }\r\n         // CheckSequenceLocks updates lp. Update the mempool entry LockPoints.\r\n         if (!validLP) m_mempool->mapTx.modify(it, update_lock_points(lp));\r\n+        if (!should_remove) {\r\n+            assert(TestLockPointValidity(m_chain, it->GetLockPoints()));\r\n+        }\r\n         return should_remove;\r\n     };\r\n \r\n     // We also need to remove any now-immature transactions\r\n     m_mempool->removeForReorg(m_chain, check_final_and_mature);\r\n     // Re-limit mempool size, in case we added any transactions\r\n```\r\n</details>",
      "created_at": "2021-12-07T16:31:46Z",
      "updated_at": "2021-12-07T16:39:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r764168506",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764168506"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 642,
      "original_line": 642,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764171819",
      "pull_request_review_id": 825519204,
      "id": 764171819,
      "node_id": "PRRC_kwDOABII584tjFYr",
      "diff_hunk": "@@ -108,6 +108,37 @@ def run_test(self):\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n         self.sync_all()\n \n+        self.log.info(\"Simulate a natural reorg where mempool transaction stays valid but on a different block\")\n+        self.connect_nodes(0, 1)\n+        # Mine a block to create mature coinbase",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 6,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This test passes also if the fix is missing. Is this expected? If yes, then what is the point of the test? I think tests should fail if the bug resurfaces.\r\n\r\nOn top of this PR:\r\n* `git show b4adc5ad67 |git apply -R`\r\n* recompile\r\n* run `test/functional/mempool_reorg.py` - it passes",
      "created_at": "2021-12-07T16:35:30Z",
      "updated_at": "2021-12-07T16:39:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r764171819",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764171819"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764196876",
      "pull_request_review_id": 825557043,
      "id": 764196876,
      "node_id": "PRRC_kwDOABII584tjLgM",
      "diff_hunk": "@@ -108,6 +108,37 @@ def run_test(self):\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n         self.sync_all()\n \n+        self.log.info(\"Simulate a natural reorg where mempool transaction stays valid but on a different block\")\n+        self.connect_nodes(0, 1)\n+        # Mine a block to create mature coinbase",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 6,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
      "in_reply_to_id": 764171819,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't think it is possible to test this without modifying the source code (e.g. addding an assert) or inspecting the process internal memory.",
      "created_at": "2021-12-07T17:04:43Z",
      "updated_at": "2021-12-07T17:04:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r764196876",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764196876"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764197601",
      "pull_request_review_id": 825557986,
      "id": 764197601,
      "node_id": "PRRC_kwDOABII584tjLrh",
      "diff_hunk": "@@ -649,10 +639,7 @@ void CTxMemPool::removeForReorg(CChain& chain, std::function<bool(txiter)> check\n     }\n     RemoveStaged(setAllRemoves, false, MemPoolRemovalReason::REORG);\n     for (indexed_transaction_set::const_iterator it = mapTx.begin(); it != mapTx.end(); it++) {\n-        const LockPoints lp{it->GetLockPoints()};\n-        if (!TestLockPointValidity(chain, lp)) {\n-            mapTx.modify(it, update_lock_points(lp));\n-        }\n+        assert(TestLockPointValidity(chain, it->GetLockPoints()));",
      "path": "src/txmempool.cpp",
      "position": 25,
      "original_position": 25,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
      "in_reply_to_id": 764168506,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Seems better to run it on all remaining txs unconditionally before returning as a sanity check.",
      "created_at": "2021-12-07T17:05:33Z",
      "updated_at": "2021-12-07T17:05:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r764197601",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764197601"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 642,
      "original_line": 642,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764641715",
      "pull_request_review_id": 826133026,
      "id": 764641715,
      "node_id": "PRRC_kwDOABII584tk4Gz",
      "diff_hunk": "@@ -378,6 +378,8 @@ void CChainState::MaybeUpdateMempoolForReorg(\n                 }\n             }\n         }\n+        // CheckSequenceLocks updates lp. Update the mempool entry LockPoints.\n+        if (!validLP) m_mempool->mapTx.modify(it, update_lock_points(lp));",
      "path": "src/validation.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "in_reply_to_id": 763794040,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Sleeping over this, now I think that it is better to leave it as is - just `if (!validLP)` because skipping update for the to-be-removed transactions will spare some CPU cycles but will increase the coupling between `check_final_and_mature()` and `removeForReorg()` - the former will assume the later will remove the transactions and the later must be aware that some transactions have invalid lock points in case it decides to do something else before removal. Plus more complex code. Not worth it.",
      "created_at": "2021-12-08T08:26:39Z",
      "updated_at": "2021-12-08T08:26:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r764641715",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764641715"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 382,
      "original_line": 382,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764648616",
      "pull_request_review_id": 826142587,
      "id": 764648616,
      "node_id": "PRRC_kwDOABII584tk5yo",
      "diff_hunk": "@@ -108,6 +108,37 @@ def run_test(self):\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n         self.sync_all()\n \n+        self.log.info(\"Simulate a natural reorg where mempool transaction stays valid but on a different block\")\n+        self.connect_nodes(0, 1)\n+        # Mine a block to create mature coinbase",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 6,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
      "in_reply_to_id": 764171819,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "So, what is the purpose of this test? It should be removed?",
      "created_at": "2021-12-08T08:36:25Z",
      "updated_at": "2021-12-08T08:36:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r764648616",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764648616"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764649275",
      "pull_request_review_id": 826143510,
      "id": 764649275,
      "node_id": "PRRC_kwDOABII584tk587",
      "diff_hunk": "@@ -108,6 +108,37 @@ def run_test(self):\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n         self.sync_all()\n \n+        self.log.info(\"Simulate a natural reorg where mempool transaction stays valid but on a different block\")\n+        self.connect_nodes(0, 1)\n+        # Mine a block to create mature coinbase",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 6,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
      "in_reply_to_id": 764171819,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think the goal is to do a reorg in this test without using `invalidateblock`",
      "created_at": "2021-12-08T08:37:25Z",
      "updated_at": "2021-12-08T08:37:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r764649275",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764649275"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764671759",
      "pull_request_review_id": 826173853,
      "id": 764671759,
      "node_id": "PRRC_kwDOABII584tk_cP",
      "diff_hunk": "@@ -108,6 +108,37 @@ def run_test(self):\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n         self.sync_all()\n \n+        self.log.info(\"Simulate a natural reorg where mempool transaction stays valid but on a different block\")\n+        self.connect_nodes(0, 1)\n+        # Mine a block to create mature coinbase",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 6,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
      "in_reply_to_id": 764171819,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The test is supposed to fail without the bugfix if the asserts are there",
      "created_at": "2021-12-08T09:07:29Z",
      "updated_at": "2021-12-08T09:07:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r764671759",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764671759"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764679260",
      "pull_request_review_id": 826184027,
      "id": 764679260,
      "node_id": "PRRC_kwDOABII584tlBRc",
      "diff_hunk": "@@ -108,6 +108,37 @@ def run_test(self):\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n         self.sync_all()\n \n+        self.log.info(\"Simulate a natural reorg where mempool transaction stays valid but on a different block\")\n+        self.connect_nodes(0, 1)\n+        # Mine a block to create mature coinbase",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 6,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
      "in_reply_to_id": 764171819,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I recall adding the assert and saw this and one other test failing already",
      "created_at": "2021-12-08T09:17:17Z",
      "updated_at": "2021-12-08T09:17:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r764679260",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764679260"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764719351",
      "pull_request_review_id": 826237817,
      "id": 764719351,
      "node_id": "PRRC_kwDOABII584tlLD3",
      "diff_hunk": "@@ -108,6 +108,37 @@ def run_test(self):\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n         self.sync_all()\n \n+        self.log.info(\"Simulate a natural reorg where mempool transaction stays valid but on a different block\")\n+        self.connect_nodes(0, 1)\n+        # Mine a block to create mature coinbase",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 6,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
      "in_reply_to_id": 764171819,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "What assert? Something extra, that is not in the PR?",
      "created_at": "2021-12-08T10:05:55Z",
      "updated_at": "2021-12-08T10:05:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r764719351",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764719351"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764741205",
      "pull_request_review_id": 826267061,
      "id": 764741205,
      "node_id": "PRRC_kwDOABII584tlQZV",
      "diff_hunk": "@@ -108,6 +108,37 @@ def run_test(self):\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n         self.sync_all()\n \n+        self.log.info(\"Simulate a natural reorg where mempool transaction stays valid but on a different block\")\n+        self.connect_nodes(0, 1)\n+        # Mine a block to create mature coinbase",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 6,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
      "in_reply_to_id": 764171819,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yes, assert.\r\n\r\nAs mentioned previously it is not possible to test this without modifying the source code or looking at internal memory.\r\n\r\nAdding an assert is one way to modify the source code. Another way would be to return the struct over rpc, or log it to the debug log, or ...",
      "created_at": "2021-12-08T10:33:43Z",
      "updated_at": "2021-12-08T10:33:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r764741205",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/764741205"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765731520",
      "pull_request_review_id": 827600133,
      "id": 765731520,
      "node_id": "PRRC_kwDOABII584tpCLA",
      "diff_hunk": "@@ -108,6 +108,37 @@ def run_test(self):\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n         self.sync_all()\n \n+        self.log.info(\"Simulate a natural reorg where mempool transaction stays valid but on a different block\")\n+        self.connect_nodes(0, 1)\n+        # Mine a block to create mature coinbase",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 6,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
      "in_reply_to_id": 764171819,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> What assert?\r\n\r\nThis one: https://github.com/bitcoin/bitcoin/pull/23683/files#diff-c065d4cd2398ad0dbcef393c5dfc53f465bf44723348892395fffd2fb3bac522R642",
      "created_at": "2021-12-09T12:13:42Z",
      "updated_at": "2021-12-09T12:14:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r765731520",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765731520"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765732191",
      "pull_request_review_id": 827600133,
      "id": 765732191,
      "node_id": "PRRC_kwDOABII584tpCVf",
      "diff_hunk": "@@ -378,6 +378,8 @@ void CChainState::MaybeUpdateMempoolForReorg(\n                 }\n             }\n         }\n+        // CheckSequenceLocks updates lp. Update the mempool entry LockPoints.\n+        if (!validLP) m_mempool->mapTx.modify(it, update_lock_points(lp));",
      "path": "src/validation.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "in_reply_to_id": 763794040,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> skipping update for the to-be-removed transactions will spare some CPU cycles but will increase the coupling between check_final_and_mature() and removeForReorg()\r\n\r\nAgreed 👍 ",
      "created_at": "2021-12-09T12:14:35Z",
      "updated_at": "2021-12-09T12:14:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r765732191",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765732191"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 382,
      "original_line": 382,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765733944",
      "pull_request_review_id": 827603493,
      "id": 765733944,
      "node_id": "PRRC_kwDOABII584tpCw4",
      "diff_hunk": "@@ -108,6 +108,37 @@ def run_test(self):\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n         self.sync_all()\n \n+        self.log.info(\"Simulate a natural reorg where mempool transaction stays valid but on a different block\")\n+        self.connect_nodes(0, 1)\n+        # Mine a block to create mature coinbase",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 6,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
      "in_reply_to_id": 764171819,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In a previous version of this PR I think I had added the assert in a separate commit from the bugfix.",
      "created_at": "2021-12-09T12:17:11Z",
      "updated_at": "2021-12-09T12:17:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r765733944",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765733944"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765734924",
      "pull_request_review_id": 827604812,
      "id": 765734924,
      "node_id": "PRRC_kwDOABII584tpDAM",
      "diff_hunk": "@@ -649,10 +639,7 @@ void CTxMemPool::removeForReorg(CChain& chain, std::function<bool(txiter)> check\n     }\n     RemoveStaged(setAllRemoves, false, MemPoolRemovalReason::REORG);\n     for (indexed_transaction_set::const_iterator it = mapTx.begin(); it != mapTx.end(); it++) {\n-        const LockPoints lp{it->GetLockPoints()};\n-        if (!TestLockPointValidity(chain, lp)) {\n-            mapTx.modify(it, update_lock_points(lp));\n-        }\n+        assert(TestLockPointValidity(chain, it->GetLockPoints()));",
      "path": "src/txmempool.cpp",
      "position": 25,
      "original_position": 25,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
      "in_reply_to_id": 764168506,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I agree it seems like a better sanity check to run at the end of `removeForReorg`, once all of the entries have been processed",
      "created_at": "2021-12-09T12:18:32Z",
      "updated_at": "2021-12-09T12:18:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r765734924",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765734924"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 642,
      "original_line": 642,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765806365",
      "pull_request_review_id": 827706213,
      "id": 765806365,
      "node_id": "PRRC_kwDOABII584tpUcd",
      "diff_hunk": "@@ -108,6 +108,37 @@ def run_test(self):\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n         self.sync_all()\n \n+        self.log.info(\"Simulate a natural reorg where mempool transaction stays valid but on a different block\")\n+        self.connect_nodes(0, 1)\n+        # Mine a block to create mature coinbase",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 6,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
      "in_reply_to_id": 764171819,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I see (which assert). So I took latest `master` (7629efcc2c3a8a8a7c17b1300cd466ec6c8c1f3f) and applied this patch:\r\n\r\n```diff\r\n--- i/src/txmempool.cpp\r\n+++ w/src/txmempool.cpp\r\n@@ -653,6 +653,7 @@ void CTxMemPool::removeForReorg(CChain& chain, std::function<bool(txiter)> check\r\n         if (!TestLockPointValidity(chain, lp)) {\r\n             mapTx.modify(it, update_lock_points(lp));\r\n         }\r\n+        assert(TestLockPointValidity(chain, lp));\r\n     }\r\n }\r\n```\r\n\r\n`test/functional/mempool_reorg.py` then fails because the added assert is hit. This is unmodified `mempool_reorg.py`, without the extension from this PR. If the bug can be reproduced by adding an assert + unmodified `mempool_reorg.py`, then why bother to change (extend) the test?\r\n\r\n> I think the goal is to do a reorg in this test without using `invalidateblock`\r\n\r\nWhy bother if the test fails even without that?",
      "created_at": "2021-12-09T13:50:39Z",
      "updated_at": "2021-12-09T13:50:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r765806365",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765806365"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765820262",
      "pull_request_review_id": 827725792,
      "id": 765820262,
      "node_id": "PRRC_kwDOABII584tpX1m",
      "diff_hunk": "@@ -108,6 +108,37 @@ def run_test(self):\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n         self.sync_all()\n \n+        self.log.info(\"Simulate a natural reorg where mempool transaction stays valid but on a different block\")\n+        self.connect_nodes(0, 1)\n+        # Mine a block to create mature coinbase",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 6,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
      "in_reply_to_id": 764171819,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "reorgs in the real network happen without `invalidateblock`, so I think we should attempt to not use the call",
      "created_at": "2021-12-09T14:05:57Z",
      "updated_at": "2021-12-09T14:05:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r765820262",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765820262"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765908448",
      "pull_request_review_id": 827851302,
      "id": 765908448,
      "node_id": "PRRC_kwDOABII584tptXg",
      "diff_hunk": "@@ -108,6 +108,37 @@ def run_test(self):\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n         self.sync_all()\n \n+        self.log.info(\"Simulate a natural reorg where mempool transaction stays valid but on a different block\")\n+        self.connect_nodes(0, 1)\n+        # Mine a block to create mature coinbase",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 6,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
      "in_reply_to_id": 764171819,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The new test is not strictly necessary in order to hit this, but it's not pointless. We didn't have any natural reorgs. We used `invalidateblock` as a shortcut to do it manually. I can remove it if you insist, but I don't really see why it's problematic?",
      "created_at": "2021-12-09T15:38:26Z",
      "updated_at": "2021-12-09T15:38:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r765908448",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/765908448"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/766553409",
      "pull_request_review_id": 828725082,
      "id": 766553409,
      "node_id": "PRRC_kwDOABII584tsK1B",
      "diff_hunk": "@@ -108,6 +108,37 @@ def run_test(self):\n         assert_equal(set(self.nodes[0].getrawmempool()), set())\n         self.sync_all()\n \n+        self.log.info(\"Simulate a natural reorg where mempool transaction stays valid but on a different block\")\n+        self.connect_nodes(0, 1)\n+        # Mine a block to create mature coinbase",
      "path": "test/functional/mempool_reorg.py",
      "position": null,
      "original_position": 6,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "28b60ce3122b29ffad2c60790d3bfe9a2ede2471",
      "in_reply_to_id": 764171819,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Alright, I agree that for the test the natural reorg is better than `invalidateblock`. But the change in this PR just adds a natural reorg, without removing the `invalidateblock` one. Shouldn't it replace `invalidateblock` with a natural reorg?\r\n\r\nI checked the code coverage with and without the extension of the test from this PR (28b60ce3122b29ffad2c60790d3bfe9a2ede2471) and it is the same. In other words, the newly added snippet does not extend the coverage. It exercises code that has already been exercised by preceding parts of `mempool_reorg.py`.\r\n\r\n<details>\r\n<summary>commands to compare coverage with/without test extension</summary>\r\n\r\n```sh\r\n# compile\r\nF=\"-fprofile-instr-generate -fcoverage-mapping\" CXXFLAGS=${F} LDFLAGS=${F} ./configure and make as usual\r\n\r\n# run test and gather coverage data\r\nLLVM_PROFILE_FILE=\"/tmp/coverage1/%m-%p.profraw\" test/functional/mempool_reorg.py\r\nllvm-profdata13 merge /tmp/coverage1/*.profraw -o /tmp/coverage1/all.profdata\r\n\r\n# remove topmost commit (test extension)\r\ngit show |git apply -R\r\n\r\n# run test and gather coverage data\r\nLLVM_PROFILE_FILE=\"/tmp/coverage2/%m-%p.profraw\" test/functional/mempool_reorg.py\r\nllvm-profdata13 merge /tmp/coverage2/*.profraw -o /tmp/coverage2/all.profdata\r\n\r\n# compare the coverage (both are identical)\r\nmd5 -r /tmp/coverage*/all.profdata\r\n14196d89227bc6028834aeff32b79ff5 /tmp/coverage1/all.profdata\r\n14196d89227bc6028834aeff32b79ff5 /tmp/coverage2/all.profdata\r\n```\r\n</details>\r\n\r\nI don't insist on removing the test snippet. I am just trying to understand the point of it. So far, with my understanding, I am ~0 on it because I fail to see what value it adds. If the `invalidate` block reorg is removed and replaced by a natural reorg without reducing code coverage, then that would be a definite +1.",
      "created_at": "2021-12-10T10:19:59Z",
      "updated_at": "2021-12-10T10:19:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r766553409",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/766553409"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/768858811",
      "pull_request_review_id": 831775988,
      "id": 768858811,
      "node_id": "PRRC_kwDOABII584t09q7",
      "diff_hunk": "@@ -649,10 +639,7 @@ void CTxMemPool::removeForReorg(CChain& chain, std::function<bool(txiter)> check\n     }\n     RemoveStaged(setAllRemoves, false, MemPoolRemovalReason::REORG);\n     for (indexed_transaction_set::const_iterator it = mapTx.begin(); it != mapTx.end(); it++) {",
      "path": "src/txmempool.cpp",
      "position": 20,
      "original_position": 20,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "2586226ec20a97f9ab9f3b7eae8a5c7fb6a7806b",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This `for` is removed in commit `[bugfix] update lockpoints during reorg` only to be re-added later in commit `[mempool] check that all LockPoints are valid reorg removals`. I think the latter should be squashed into the former. It was like this in a previous incarnation of this PR and it made sense to me because the added `assert` is logically related to the rest of the changes:\r\n\r\n```diff\r\n     for (indexed_transaction_set::const_iterator it = mapTx.begin(); it != mapTx.end(); it++) {\r\n-        const LockPoints lp{it->GetLockPoints()};\r\n-        if (!TestLockPointValidity(chain, lp)) {\r\n-            mapTx.modify(it, update_lock_points(lp));\r\n-        }\r\n+        assert(TestLockPointValidity(chain, it->GetLockPoints()));\r\n     }\r\n```",
      "created_at": "2021-12-14T16:50:29Z",
      "updated_at": "2021-12-14T17:22:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r768858811",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/768858811"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 641,
      "original_line": 641,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/768873591",
      "pull_request_review_id": 831775988,
      "id": 768873591,
      "node_id": "PRRC_kwDOABII584t1BR3",
      "diff_hunk": "@@ -350,21 +350,29 @@ void CChainState::MaybeUpdateMempoolForReorg(\n     // the disconnectpool that were added back and cleans up the mempool state.\n     m_mempool->UpdateTransactionsFromBlock(vHashUpdate);\n \n-    const auto check_final_and_mature = [this, flags=STANDARD_LOCKTIME_VERIFY_FLAGS](CTxMemPool::txiter it)\n+    // Check whether the transaction is still final and, if it spends a coinbase output, mature.\n+    // Update the entry's cached LockPoints if needed. If this returns true, the tx would be invalid\n+    // in the next block, so the mempool must remove this entry and all of its descendants.\n+    const auto filter_final_and_mature = [this, flags=STANDARD_LOCKTIME_VERIFY_FLAGS](CTxMemPool::txiter it)\n         EXCLUSIVE_LOCKS_REQUIRED(m_mempool->cs, ::cs_main) {\n-        bool should_remove = false;\n         AssertLockHeld(m_mempool->cs);\n         AssertLockHeld(::cs_main);\n         const CTransaction& tx = it->GetTx();\n         LockPoints lp = it->GetLockPoints();\n         const bool validLP{TestLockPointValidity(m_chain, lp)};\n         CCoinsViewMemPool view_mempool(&CoinsTip(), *m_mempool);\n-        if (!CheckFinalTx(m_chain.Tip(), tx, flags)\n-            || !CheckSequenceLocks(m_chain.Tip(), view_mempool, tx, flags, &lp, validLP)) {\n-            // Note if CheckSequenceLocks fails the LockPoints may still be invalid\n-            // So it's critical that we remove the tx and not depend on the LockPoints.\n-            should_remove = true;\n-        } else if (it->GetSpendsCoinbase()) {\n+        // The transaction must be final.\n+        if (!CheckFinalTx(m_chain.Tip(), tx, flags)) return true;\n+        // Note if CheckSequenceLocks fails the LockPoints may still be invalid\n+        // So it's critical that we remove the tx and not depend on the LockPoints.\n+        if (!CheckSequenceLocks(m_chain.Tip(), view_mempool, tx, flags, &lp, validLP)) {\n+            return true;\n+        } else if (!validLP) {",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 29,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "2586226ec20a97f9ab9f3b7eae8a5c7fb6a7806b",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: `else` is not necessary after `return`. May as well remove it also for consistency with the above `if (!CheckFinalTx...` (which does not include `else` after `return`).\r\n\r\n```suggestion\r\n        }\r\n        if (!validLP) {\r\n```",
      "created_at": "2021-12-14T17:07:33Z",
      "updated_at": "2021-12-14T17:22:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r768873591",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/768873591"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 370,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/768876739",
      "pull_request_review_id": 831775988,
      "id": 768876739,
      "node_id": "PRRC_kwDOABII584t1CDD",
      "diff_hunk": "@@ -350,21 +350,29 @@ void CChainState::MaybeUpdateMempoolForReorg(\n     // the disconnectpool that were added back and cleans up the mempool state.\n     m_mempool->UpdateTransactionsFromBlock(vHashUpdate);\n \n-    const auto check_final_and_mature = [this, flags=STANDARD_LOCKTIME_VERIFY_FLAGS](CTxMemPool::txiter it)\n+    // Check whether the transaction is still final and, if it spends a coinbase output, mature.\n+    // Update the entry's cached LockPoints if needed. If this returns true, the tx would be invalid\n+    // in the next block, so the mempool must remove this entry and all of its descendants.\n+    const auto filter_final_and_mature = [this, flags=STANDARD_LOCKTIME_VERIFY_FLAGS](CTxMemPool::txiter it)\n         EXCLUSIVE_LOCKS_REQUIRED(m_mempool->cs, ::cs_main) {\n-        bool should_remove = false;\n         AssertLockHeld(m_mempool->cs);\n         AssertLockHeld(::cs_main);\n         const CTransaction& tx = it->GetTx();\n         LockPoints lp = it->GetLockPoints();\n         const bool validLP{TestLockPointValidity(m_chain, lp)};\n         CCoinsViewMemPool view_mempool(&CoinsTip(), *m_mempool);\n-        if (!CheckFinalTx(m_chain.Tip(), tx, flags)\n-            || !CheckSequenceLocks(m_chain.Tip(), view_mempool, tx, flags, &lp, validLP)) {\n-            // Note if CheckSequenceLocks fails the LockPoints may still be invalid\n-            // So it's critical that we remove the tx and not depend on the LockPoints.\n-            should_remove = true;\n-        } else if (it->GetSpendsCoinbase()) {\n+        // The transaction must be final.\n+        if (!CheckFinalTx(m_chain.Tip(), tx, flags)) return true;\n+        // Note if CheckSequenceLocks fails the LockPoints may still be invalid\n+        // So it's critical that we remove the tx and not depend on the LockPoints.\n+        if (!CheckSequenceLocks(m_chain.Tip(), view_mempool, tx, flags, &lp, validLP)) {\n+            return true;\n+        } else if (!validLP) {\n+            // CheckSequenceLocks updates lp. Update the mempool entry LockPoints.\n+            m_mempool->mapTx.modify(it, update_lock_points(lp));",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 31,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "2586226ec20a97f9ab9f3b7eae8a5c7fb6a7806b",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In a previous incarnation of this PR, this `modify()` would have been executed regardless of the outcome of `CheckFinalTx()` and `CheckSequenceLocks()`. Not so anymore. From https://github.com/bitcoin/bitcoin/pull/23683#discussion_r765732191 I got the impression that it is better to update for all transactions, even the to-be-removed ones.",
      "created_at": "2021-12-14T17:11:12Z",
      "updated_at": "2021-12-14T17:22:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r768876739",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/768876739"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 372,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/768879750",
      "pull_request_review_id": 831775988,
      "id": 768879750,
      "node_id": "PRRC_kwDOABII584t1CyG",
      "diff_hunk": "@@ -350,21 +350,29 @@ void CChainState::MaybeUpdateMempoolForReorg(\n     // the disconnectpool that were added back and cleans up the mempool state.\n     m_mempool->UpdateTransactionsFromBlock(vHashUpdate);\n \n-    const auto check_final_and_mature = [this, flags=STANDARD_LOCKTIME_VERIFY_FLAGS](CTxMemPool::txiter it)\n+    // Check whether the transaction is still final and, if it spends a coinbase output, mature.\n+    // Update the entry's cached LockPoints if needed. If this returns true, the tx would be invalid\n+    // in the next block, so the mempool must remove this entry and all of its descendants.\n+    const auto filter_final_and_mature = [this, flags=STANDARD_LOCKTIME_VERIFY_FLAGS](CTxMemPool::txiter it)\n         EXCLUSIVE_LOCKS_REQUIRED(m_mempool->cs, ::cs_main) {\n-        bool should_remove = false;\n         AssertLockHeld(m_mempool->cs);\n         AssertLockHeld(::cs_main);\n         const CTransaction& tx = it->GetTx();\n         LockPoints lp = it->GetLockPoints();\n         const bool validLP{TestLockPointValidity(m_chain, lp)};\n         CCoinsViewMemPool view_mempool(&CoinsTip(), *m_mempool);\n-        if (!CheckFinalTx(m_chain.Tip(), tx, flags)\n-            || !CheckSequenceLocks(m_chain.Tip(), view_mempool, tx, flags, &lp, validLP)) {\n-            // Note if CheckSequenceLocks fails the LockPoints may still be invalid\n-            // So it's critical that we remove the tx and not depend on the LockPoints.\n-            should_remove = true;\n-        } else if (it->GetSpendsCoinbase()) {\n+        // The transaction must be final.\n+        if (!CheckFinalTx(m_chain.Tip(), tx, flags)) return true;\n+        // Note if CheckSequenceLocks fails the LockPoints may still be invalid\n+        // So it's critical that we remove the tx and not depend on the LockPoints.\n+        if (!CheckSequenceLocks(m_chain.Tip(), view_mempool, tx, flags, &lp, validLP)) {\n+            return true;\n+        } else if (!validLP) {\n+            // CheckSequenceLocks updates lp. Update the mempool entry LockPoints.\n+            m_mempool->mapTx.modify(it, update_lock_points(lp));\n+        }\n+        // If the transaction spends any coinbase outputs, check maturity.\n+        if (it->GetSpendsCoinbase()) {",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 34,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "2586226ec20a97f9ab9f3b7eae8a5c7fb6a7806b",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Previously, this check and the body of the `if` would have been executed before updating the lock points. Now the order is reversed. Could the updated lock points change the outcome of any of this code, e.g. the `mapTx.find()` call?",
      "created_at": "2021-12-14T17:14:47Z",
      "updated_at": "2021-12-14T17:22:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r768879750",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/768879750"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 375,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/768882217",
      "pull_request_review_id": 831775988,
      "id": 768882217,
      "node_id": "PRRC_kwDOABII584t1DYp",
      "diff_hunk": "@@ -350,21 +350,29 @@ void CChainState::MaybeUpdateMempoolForReorg(\n     // the disconnectpool that were added back and cleans up the mempool state.\n     m_mempool->UpdateTransactionsFromBlock(vHashUpdate);\n \n-    const auto check_final_and_mature = [this, flags=STANDARD_LOCKTIME_VERIFY_FLAGS](CTxMemPool::txiter it)\n+    // Check whether the transaction is still final and, if it spends a coinbase output, mature.\n+    // Update the entry's cached LockPoints if needed. If this returns true, the tx would be invalid",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "2586226ec20a97f9ab9f3b7eae8a5c7fb6a7806b",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Update the entry's cached LockPoints if needed\r\n\r\nThis is a bit vague with the current code. The lock points may or may not be updated if this function returns `true` and will be updated for sure if it returns `false`. I think it is better to update them in all cases or change this comment to say \"Update the entry's cached LockPoints if false is returned (and also in some cases if true is returned :disappointed:)\".",
      "created_at": "2021-12-14T17:17:52Z",
      "updated_at": "2021-12-14T17:22:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r768882217",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/768882217"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 354,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/770776035",
      "pull_request_review_id": 834417459,
      "id": 770776035,
      "node_id": "PRRC_kwDOABII584t8Rvj",
      "diff_hunk": "@@ -649,10 +639,7 @@ void CTxMemPool::removeForReorg(CChain& chain, std::function<bool(txiter)> check\n     }\n     RemoveStaged(setAllRemoves, false, MemPoolRemovalReason::REORG);\n     for (indexed_transaction_set::const_iterator it = mapTx.begin(); it != mapTx.end(); it++) {",
      "path": "src/txmempool.cpp",
      "position": 20,
      "original_position": 20,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "2586226ec20a97f9ab9f3b7eae8a5c7fb6a7806b",
      "in_reply_to_id": 768858811,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "reverted back to original, squashed commit",
      "created_at": "2021-12-16T17:45:25Z",
      "updated_at": "2021-12-16T17:45:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r770776035",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/770776035"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 641,
      "original_line": 641,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772879178",
      "pull_request_review_id": 837084631,
      "id": 772879178,
      "node_id": "PRRC_kwDOABII584uETNK",
      "diff_hunk": "@@ -350,21 +350,29 @@ void CChainState::MaybeUpdateMempoolForReorg(\n     // the disconnectpool that were added back and cleans up the mempool state.\n     m_mempool->UpdateTransactionsFromBlock(vHashUpdate);\n \n-    const auto check_final_and_mature = [this, flags=STANDARD_LOCKTIME_VERIFY_FLAGS](CTxMemPool::txiter it)\n+    // Check whether the transaction is still final and, if it spends a coinbase output, mature.\n+    // Update the entry's cached LockPoints if needed. If this returns true, the tx would be invalid\n+    // in the next block, so the mempool must remove this entry and all of its descendants.\n+    const auto filter_final_and_mature = [this, flags=STANDARD_LOCKTIME_VERIFY_FLAGS](CTxMemPool::txiter it)\n         EXCLUSIVE_LOCKS_REQUIRED(m_mempool->cs, ::cs_main) {\n-        bool should_remove = false;\n         AssertLockHeld(m_mempool->cs);\n         AssertLockHeld(::cs_main);\n         const CTransaction& tx = it->GetTx();\n         LockPoints lp = it->GetLockPoints();\n         const bool validLP{TestLockPointValidity(m_chain, lp)};\n         CCoinsViewMemPool view_mempool(&CoinsTip(), *m_mempool);\n-        if (!CheckFinalTx(m_chain.Tip(), tx, flags)\n-            || !CheckSequenceLocks(m_chain.Tip(), view_mempool, tx, flags, &lp, validLP)) {\n-            // Note if CheckSequenceLocks fails the LockPoints may still be invalid\n-            // So it's critical that we remove the tx and not depend on the LockPoints.\n-            should_remove = true;\n-        } else if (it->GetSpendsCoinbase()) {\n+        // The transaction must be final.\n+        if (!CheckFinalTx(m_chain.Tip(), tx, flags)) return true;\n+        // Note if CheckSequenceLocks fails the LockPoints may still be invalid\n+        // So it's critical that we remove the tx and not depend on the LockPoints.\n+        if (!CheckSequenceLocks(m_chain.Tip(), view_mempool, tx, flags, &lp, validLP)) {\n+            return true;\n+        } else if (!validLP) {",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 29,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "2586226ec20a97f9ab9f3b7eae8a5c7fb6a7806b",
      "in_reply_to_id": 768873591,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The `!validLP` check here is logically associated with the `!CheckSequenceLocks()` check, so it makes sense to have it in an `else` branch. Logically the two things are the same since the if branch contains an early return, but structuring it as if/else signals to the developer that the two things are connected.",
      "created_at": "2021-12-21T07:11:29Z",
      "updated_at": "2021-12-21T07:11:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r772879178",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/772879178"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 370,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/776328259",
      "pull_request_review_id": 841408330,
      "id": 776328259,
      "node_id": "PRRC_kwDOABII584uRdRD",
      "diff_hunk": "@@ -649,10 +639,7 @@ void CTxMemPool::removeForReorg(CChain& chain, std::function<bool(txiter)> check\n     }\n     RemoveStaged(setAllRemoves, false, MemPoolRemovalReason::REORG);\n     for (indexed_transaction_set::const_iterator it = mapTx.begin(); it != mapTx.end(); it++) {\n-        const LockPoints lp{it->GetLockPoints()};\n-        if (!TestLockPointValidity(chain, lp)) {\n-            mapTx.modify(it, update_lock_points(lp));\n-        }",
      "path": "src/txmempool.cpp",
      "position": 24,
      "original_position": 24,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "in_reply_to_id": null,
      "user": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The removed code is no-op actually. After the `if` statement, `it->GetLockPoints()` returns the same value as `lp`.",
      "created_at": "2021-12-29T13:33:34Z",
      "updated_at": "2021-12-29T13:36:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r776328259",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/776328259"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": 652,
      "original_start_line": 652,
      "start_side": "LEFT",
      "line": 655,
      "original_line": 655,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/776329493",
      "pull_request_review_id": 841408330,
      "id": 776329493,
      "node_id": "PRRC_kwDOABII584uRdkV",
      "diff_hunk": "@@ -312,6 +312,16 @@ class CompareTxMemPoolEntryByAncestorFee\n     }\n };\n \n+struct update_lock_points\n+{\n+    explicit update_lock_points(const LockPoints& _lp) : lp(_lp) { }\n+\n+    void operator() (CTxMemPoolEntry &e) { e.UpdateLockPoints(lp); }\n+\n+private:\n+    const LockPoints& lp;\n+};\n+",
      "path": "src/txmempool.h",
      "position": 13,
      "original_position": 13,
      "commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "original_commit_id": "b4adc5ad6769e4a5a6179dfff271cd4c9dc47a5b",
      "in_reply_to_id": null,
      "user": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Maybe drop `update_lock_points` altogether:\r\n```diff\r\ndiff --git a/src/txmempool.h b/src/txmempool.h\r\nindex ba1d381a5..f87ecc9cd 100644\r\n--- a/src/txmempool.h\r\n+++ b/src/txmempool.h\r\n@@ -312,16 +312,6 @@ public:\r\n     }\r\n };\r\n \r\n-struct update_lock_points\r\n-{\r\n-    explicit update_lock_points(const LockPoints& _lp) : lp(_lp) { }\r\n-\r\n-    void operator() (CTxMemPoolEntry &e) { e.UpdateLockPoints(lp); }\r\n-\r\n-private:\r\n-    const LockPoints& lp;\r\n-};\r\n-\r\n // Multi_index tag names\r\n struct descendant_score {};\r\n struct entry_time {};\r\ndiff --git a/src/validation.cpp b/src/validation.cpp\r\nindex 68729e486..a42e1f52a 100644\r\n--- a/src/validation.cpp\r\n+++ b/src/validation.cpp\r\n@@ -379,7 +379,7 @@ void CChainState::MaybeUpdateMempoolForReorg(\r\n             }\r\n         }\r\n         // CheckSequenceLocks updates lp. Update the mempool entry LockPoints.\r\n-        if (!validLP) m_mempool->mapTx.modify(it, update_lock_points(lp));\r\n+        if (!validLP) m_mempool->mapTx.modify(it, [lp](CTxMemPoolEntry& e) { e.UpdateLockPoints(lp); });\r\n         return should_remove;\r\n     };\r\n \r\n```\r\n?",
      "created_at": "2021-12-29T13:36:35Z",
      "updated_at": "2021-12-29T13:36:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/23683#discussion_r776329493",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/776329493"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23683"
        }
      },
      "start_line": 315,
      "original_start_line": 315,
      "start_side": "RIGHT",
      "line": 324,
      "original_line": 324,
      "side": "RIGHT"
    }
  ]
}