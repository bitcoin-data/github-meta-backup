{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187",
    "id": 506200586,
    "node_id": "MDExOlB1bGxSZXF1ZXN0NTA2MjAwNTg2",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20187",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/20187.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/20187.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20187",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20187/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
    "number": 20187,
    "state": "closed",
    "locked": true,
    "maintainer_can_modify": false,
    "title": "Addrman: test-before-evict bugfix and improvements for block-relay-only peers",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This PR does two things:\r\n\r\n* Block-relay-only interaction with addrman.  \r\n  * Calling `CAddrMan::Connected()` on an address that was a block-relay-only peer causes the time we report in `addr` messages containing that peer to be updated; particularly now that we use anchor connections with a our block-relay-only peers, this risks leaking information about those peers.  So, stop this.\r\n  * Avoiding calling `CAddrMan::Good()` on block-relay-only peer addresses causes the addrman logic around maintaining the new and tried table to be less good, and in particular makes it so that block-relay-only peer addresses are more likely to be evicted from the addrman (for no good reason I can think of).  So, mark those addresses as good when we connect.\r\n\r\n* Fix test-before-evict bug. There's a bug where if we get a collision in the tried table with an existing address that is one of our current peers, and the connection is long-lived enough, then `SelectTriedCollisions()` might return that existing peer address to us as a test-before-evict connection candidate. However, our logic for new outbound connections would later prevent us from actually making a connection; the result would be that when we get a collision with a long-lived current peer, that peer's address is likely to get evicted from the tried table.  Fix this by checking to see if a test-before-evict candidate is a peer we're currently connected to, and if so, mark it as `Good()`.\r\n",
    "labels": [
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      }
    ],
    "milestone": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/45",
      "html_url": "https://github.com/bitcoin/bitcoin/milestone/45",
      "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/45/labels",
      "id": 4914019,
      "node_id": "MDk6TWlsZXN0b25lNDkxNDAxOQ==",
      "number": 45,
      "state": "closed",
      "title": "0.21.0",
      "description": "",
      "creator": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "open_issues": 0,
      "closed_issues": 132,
      "created_at": "2019-12-09T08:39:58Z",
      "updated_at": "2021-01-15T19:50:53Z",
      "closed_at": "2021-01-15T19:50:53Z"
    },
    "active_lock_reason": "resolved",
    "created_at": "2020-10-19T18:38:38Z",
    "updated_at": "2022-08-16T17:01:57Z",
    "closed_at": "2020-11-03T01:39:58Z",
    "mergeable_state": "unknown",
    "merged_at": "2020-11-03T01:39:58Z",
    "merge_commit_sha": "8387f832d6932d72adb86eaa4aecfd0c35341acc",
    "assignees": [],
    "requested_reviewers": [
      {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      }
    ],
    "requested_teams": [],
    "head": {
      "label": "sdaftuar:2020-10-addrman-block-relay",
      "ref": "2020-10-addrman-block-relay",
      "sha": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 28761781,
        "node_id": "MDEwOlJlcG9zaXRvcnkyODc2MTc4MQ==",
        "name": "bitcoin",
        "full_name": "sdaftuar/bitcoin",
        "owner": {
          "login": "sdaftuar",
          "id": 7463573,
          "node_id": "MDQ6VXNlcjc0NjM1NzM=",
          "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/sdaftuar",
          "html_url": "https://github.com/sdaftuar",
          "followers_url": "https://api.github.com/users/sdaftuar/followers",
          "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
          "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
          "repos_url": "https://api.github.com/users/sdaftuar/repos",
          "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/sdaftuar/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/sdaftuar/bitcoin",
        "archive_url": "https://api.github.com/repos/sdaftuar/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/sdaftuar/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/sdaftuar/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/sdaftuar/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/sdaftuar/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/sdaftuar/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/sdaftuar/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/sdaftuar/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/sdaftuar/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/sdaftuar/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/sdaftuar/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/sdaftuar/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/sdaftuar/bitcoin/events",
        "forks_url": "https://api.github.com/repos/sdaftuar/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/sdaftuar/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/sdaftuar/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/sdaftuar/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/sdaftuar/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/sdaftuar/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/sdaftuar/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/sdaftuar/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/sdaftuar/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/sdaftuar/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/sdaftuar/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/sdaftuar/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/sdaftuar/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/sdaftuar/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/sdaftuar/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/sdaftuar/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:sdaftuar/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/sdaftuar/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/sdaftuar/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/sdaftuar/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/sdaftuar/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/sdaftuar/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/sdaftuar/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/sdaftuar/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/sdaftuar/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/sdaftuar/bitcoin/hooks",
        "svn_url": "https://github.com/sdaftuar/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 1,
        "stargazers_count": 3,
        "watchers_count": 3,
        "size": 245665,
        "default_branch": "master",
        "open_issues_count": 1,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-06T22:41:53Z",
        "created_at": "2015-01-04T02:52:13Z",
        "updated_at": "2023-02-11T10:16:01Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "55b1ffcd259cc64139dad646a52fab5c597c95c2",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 34324,
        "stargazers_count": 69818,
        "watchers_count": 69818,
        "size": 233879,
        "default_branch": "master",
        "open_issues_count": 627,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-06T22:42:00Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-06-07T03:51:27Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 65,
    "deletions": 25,
    "changed_files": 5,
    "commits": 4,
    "review_comments": 46,
    "comments": 15
  },
  "events": [
    {
      "event": "commented",
      "id": 712367742,
      "node_id": "MDEyOklzc3VlQ29tbWVudDcxMjM2Nzc0Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/712367742",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-19T18:40:31Z",
      "updated_at": "2020-10-19T18:40:31Z",
      "author_association": "MEMBER",
      "body": "I'm still trying to verify that the bug being fixed relating to test-before-evict is in fact a bug (and I'm not just misunderstanding the logic); but if my understanding is correct I think we should fix all these issues in the next release.",
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#issuecomment-712367742",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20187"
    },
    {
      "event": "commented",
      "id": 712389721,
      "node_id": "MDEyOklzc3VlQ29tbWVudDcxMjM4OTcyMQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/712389721",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-19T19:21:38Z",
      "updated_at": "2020-11-02T22:21:06Z",
      "author_association": "MEMBER",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20233 (addrman: Make consistency checks a runtime option by jnewbery)\n* #20228 (addrman: Make addrman a top-level component by jnewbery)\n* #20158 (tree-wide: De-globalize ChainstateManager by dongcarl)\n* #19843 (Refactoring and minor improvement for self-advertisements by naumenkogs)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#issuecomment-712389721",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20187"
    },
    {
      "event": "labeled",
      "id": 3895207600,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDM4OTUyMDc2MDA=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3895207600",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-19T19:40:42Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    },
    {
      "event": "review_requested",
      "id": 3895759943,
      "node_id": "MDIwOlJldmlld1JlcXVlc3RlZEV2ZW50Mzg5NTc1OTk0Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3895759943",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-19T22:23:39Z",
      "requested_reviewer": {
        "login": "amitiuttarwar",
        "id": 1500952,
        "node_id": "MDQ6VXNlcjE1MDA5NTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/amitiuttarwar",
        "html_url": "https://github.com/amitiuttarwar",
        "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
        "following_url": "https://api.github.com/users/amitiuttarwar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/amitiuttarwar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/amitiuttarwar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
        "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
        "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
        "events_url": "https://api.github.com/users/amitiuttarwar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "review_requested",
      "id": 3895759944,
      "node_id": "MDIwOlJldmlld1JlcXVlc3RlZEV2ZW50Mzg5NTc1OTk0NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3895759944",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-19T22:23:39Z",
      "requested_reviewer": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "milestoned",
      "id": 3896823853,
      "node_id": "MDE1Ok1pbGVzdG9uZWRFdmVudDM4OTY4MjM4NTM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3896823853",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-20T06:20:39Z",
      "milestone": {
        "title": "0.21.0"
      }
    },
    {
      "event": "commented",
      "id": 712626312,
      "node_id": "MDEyOklzc3VlQ29tbWVudDcxMjYyNjMxMg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/712626312",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-20T06:31:28Z",
      "updated_at": "2020-10-20T06:31:28Z",
      "author_association": "MEMBER",
      "body": "Concept ACK.\r\n\r\nThe former issues are worth addressing.\r\nSeems like the latter bug is real, even though the chance of hitting it is rather low.",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#issuecomment-712626312",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20187"
    },
    {
      "event": "commented",
      "id": 716164872,
      "node_id": "MDEyOklzc3VlQ29tbWVudDcxNjE2NDg3Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/716164872",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-25T15:20:02Z",
      "updated_at": "2020-10-25T15:20:02Z",
      "author_association": "MEMBER",
      "body": "I was able to verify the test-before-evict bug by modifying the tried table to be very small, making collisions with existing peers likely.  The patch here appears to fix it as well.",
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#issuecomment-716164872",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20187"
    },
    {
      "event": "reviewed",
      "id": 516562733,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2NTYyNzMz",
      "url": null,
      "actor": null,
      "commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#pullrequestreview-516562733",
      "submitted_at": "2020-10-26T10:11:27Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 3921648872,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MzkyMTY0ODg3Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3921648872",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-26T16:24:48Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 3921785498,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MzkyMTc4NTQ5OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3921785498",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-26T16:51:44Z"
    },
    {
      "event": "reviewed",
      "id": 516970642,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2OTcwNjQy",
      "url": null,
      "actor": null,
      "commit_id": "266d22a3d18c89a3b74d81bcdcc9750a9f8a056f",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Concept ACK.\r\n\r\nAn alternative approach could be to just periodically refresh the `info.nLastSuccess` for all active connections. If I'm understanding the addrman code correctly, as long as we're refreshing that value every 4 hours, we'll never evict that peer.\r\n\r\nAdding a `StillGood()` (with a better name) method to CAddrMan which simply updates `nLastSuccess` and calling it either globally or per-peer every three hours would avoid adding more logic to the already-too-complicated `ThreadOpenConnections()`",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#pullrequestreview-516970642",
      "submitted_at": "2020-10-26T17:10:12Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
    },
    {
      "event": "commented",
      "id": 716728387,
      "node_id": "MDEyOklzc3VlQ29tbWVudDcxNjcyODM4Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/716728387",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-26T18:05:35Z",
      "updated_at": "2020-10-26T18:05:35Z",
      "author_association": "MEMBER",
      "body": "> An alternative approach could be to just periodically refresh the info.nLastSuccess for all active connections. If I'm understanding the addrman code correctly, as long as we're refreshing that value every 4 hours, we'll never evict that peer.\r\n\r\n> Adding a StillGood() (with a better name) method to CAddrMan which simply updates nLastSuccess and calling it either globally or per-peer every three hours would avoid adding more logic to the already-too-complicated ThreadOpenConnections()\r\n\r\nI think the best thing would be if addrman just detected the collision with an existing peer immediately, and avoided the whole tried-collision logic itself.  If we had a good way to do that (by changing the interface between addrman and connman) then I think that could make sense. \r\n\r\nShort of addrman being smart enough to avoid this problem, having `net.cpp` detect this condition and fix it directly seems next simplest to me; relying on `Good()` or a `StillGood()` being called at the right times to avoid this problem as a consequence of how and when those variables get updated just seems unnecessarily complex...?  The next time someone wonders if it's possible for an existing peer to be evicted from the tried table, I think it'll be much easier to reason about my proposed change than the alternative you're suggesting.",
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#issuecomment-716728387",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20187"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 3922221541,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MzkyMjIyMTU0MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3922221541",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-26T18:29:16Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 3922227869,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MzkyMjIyNzg2OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3922227869",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-26T18:30:49Z"
    },
    {
      "event": "commented",
      "id": 716756846,
      "node_id": "MDEyOklzc3VlQ29tbWVudDcxNjc1Njg0Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/716756846",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-26T18:57:45Z",
      "updated_at": "2020-10-26T18:57:45Z",
      "author_association": "MEMBER",
      "body": "> relying on Good() or a StillGood() being called at the right times to avoid this problem as a consequence of how and when those variables get updated just seems unnecessarily complex...? The next time someone wonders if it's possible for an existing peer to be evicted from the tried table, I think it'll be much easier to reason about my proposed change than the alternative you're suggesting.\r\n\r\nI disagree, but perhaps it's just a matter of taste. To me, making addrman always aware of existing connections and keeping `nLastSuccess` fresh by periodic notifications from net_processing or net seems much cleaner than only finding out at the point that we attempt to reconnect.",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#issuecomment-716756846",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20187"
    },
    {
      "event": "commented",
      "id": 716802555,
      "node_id": "MDEyOklzc3VlQ29tbWVudDcxNjgwMjU1NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/716802555",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-26T20:25:50Z",
      "updated_at": "2020-10-26T20:27:53Z",
      "author_association": "MEMBER",
      "body": "> I disagree, but perhaps it's just a matter of taste. To me, making addrman always aware of existing connections and keeping nLastSuccess fresh by periodic notifications from net_processing or net seems much cleaner than only finding out at the point that we attempt to reconnect.\r\n\r\nWe could add an interface to addrman so that it explicitly keeps track of currently connected peers, by notifying it when we successfully make new connections and again when a peer disconnects, and then use that to prevent tried collisions with current peers from ever making it into the tried-collision list for later resolution.",
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#issuecomment-716802555",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20187"
    },
    {
      "event": "commented",
      "id": 716861647,
      "node_id": "MDEyOklzc3VlQ29tbWVudDcxNjg2MTY0Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/716861647",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-26T22:36:51Z",
      "updated_at": "2020-10-26T22:36:51Z",
      "author_association": "MEMBER",
      "body": "> We could add an interface to addrman so that it explicitly keeps track of currently connected peers, by notifying it when we successfully make new connections and again when a peer disconnects, and then use that to prevent tried collisions with current peers from ever making it into the tried-collision list for later resolution.\r\n\r\nYes, that seems like another reasonable approach.\r\n\r\nTo be clear, I'm not NACKing the approach in this PR. I wanted to offer an alternative suggestion, but what you're doing here seems fine, and this actually cleans up and clarifies some of the code.\r\n\r\nThanks for being so responsive to review. I plan to do another pass of the latest changes tomorrow.",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#issuecomment-716861647",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20187"
    },
    {
      "event": "reviewed",
      "id": 517501586,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NTAxNTg2",
      "url": null,
      "actor": null,
      "commit_id": "430c8b6c0f9381f039d83066aa2cbd70c1d1414b",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#pullrequestreview-517501586",
      "submitted_at": "2020-10-27T09:46:52Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
    },
    {
      "event": "commented",
      "id": 717198192,
      "node_id": "MDEyOklzc3VlQ29tbWVudDcxNzE5ODE5Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/717198192",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-27T12:06:24Z",
      "updated_at": "2020-10-27T12:06:24Z",
      "author_association": "MEMBER",
      "body": "If you squashed the last commit (_Eliminate unnecessary parameter from FinalizeNode()_) with the first commit (_Avoid calling CAddrMan::Connected() on block-relay-only peer addresses_), or even just moved it to be the first commit, you'd avoid having to touch other lines of code (e.g. in denialofservice_tests.cpp) multiple times.",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#issuecomment-717198192",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20187"
    },
    {
      "event": "commented",
      "id": 717307740,
      "node_id": "MDEyOklzc3VlQ29tbWVudDcxNzMwNzc0MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/717307740",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-27T15:05:00Z",
      "updated_at": "2020-10-27T15:05:00Z",
      "author_association": "MEMBER",
      "body": "utACK 430c8b6c0f9381f039d83066aa2cbd70c1d1414b\r\n\r\nI think moving the last commit to the beginning would make this easier for other reviewers. Very happy to reACK if you decide to do that while you just have my ACK.",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#issuecomment-717307740",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20187"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzpkYWY1NTUzMTI2MDgzM2Q1OTdlZTU5OWUyZDI4OWVhMWJlMGIxZDlj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/daf55531260833d597ee599e2d289ea1be0b1d9c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/daf55531260833d597ee599e2d289ea1be0b1d9c",
      "tree": {
        "sha": "11c9097434ce1645353d6094419f384ae5d65c2e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/11c9097434ce1645353d6094419f384ae5d65c2e"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d67883d01e507dd22d1281f4a4860e79d6a46a47",
          "sha": "d67883d01e507dd22d1281f4a4860e79d6a46a47",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/d67883d01e507dd22d1281f4a4860e79d6a46a47"
        }
      ],
      "message": "Avoid calling CAddrMan::Connected() on block-relay-only peer addresses\n\nConnected() updates the time we serve in addr messages, so avoid leaking\nblock-relay-only peer connections by avoiding these calls.",
      "committer": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2020-10-27T15:14:58Z"
      },
      "author": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2020-10-24T07:16:04Z"
      },
      "sha": "daf55531260833d597ee599e2d289ea1be0b1d9c"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0ZmUzMzhhYjNlZDczYjNmZmIyMGVlZGY5NTUwMGM1NmVjMjkyMGUx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4fe338ab3ed73b3ffb20eedf95500c56ec2920e1",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/4fe338ab3ed73b3ffb20eedf95500c56ec2920e1",
      "tree": {
        "sha": "bf31b79769476a8ff767d4168e07089e5e2777d4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/bf31b79769476a8ff767d4168e07089e5e2777d4"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/daf55531260833d597ee599e2d289ea1be0b1d9c",
          "sha": "daf55531260833d597ee599e2d289ea1be0b1d9c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/daf55531260833d597ee599e2d289ea1be0b1d9c"
        }
      ],
      "message": "Call CAddrMan::Good() on block-relay-only peer addresses\n\nBeing able to invoke Good() is important for address management (new vs tried\ntable, tried table eviction via test-before-evict). We mitigate potential\ninformation leaks by not calling Connected() on these peer addresses.",
      "committer": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2020-10-27T15:15:21Z"
      },
      "author": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2020-10-19T13:31:51Z"
      },
      "sha": "4fe338ab3ed73b3ffb20eedf95500c56ec2920e1"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzplOGIyMTVhMDg2ZDkxYTg3NzQyMTBiYjZjZThkMTU2MGFhYWYwNzg5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e8b215a086d91a8774210bb6ce8d1560aaaf0789",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/e8b215a086d91a8774210bb6ce8d1560aaaf0789",
      "tree": {
        "sha": "9d4018c2fde49bf922ef39b7accdcec067ea0d74",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9d4018c2fde49bf922ef39b7accdcec067ea0d74"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4fe338ab3ed73b3ffb20eedf95500c56ec2920e1",
          "sha": "4fe338ab3ed73b3ffb20eedf95500c56ec2920e1",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/4fe338ab3ed73b3ffb20eedf95500c56ec2920e1"
        }
      ],
      "message": "Refactor test for existing peer connection into own function",
      "committer": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2020-10-27T15:15:21Z"
      },
      "author": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2020-10-16T15:10:17Z"
      },
      "sha": "e8b215a086d91a8774210bb6ce8d1560aaaf0789"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxNmQ5YmZjNDE3MmI0ZjZjZTI0YTNjZDFhMWNmYTM5MzNjZDI2NzUx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "tree": {
        "sha": "78ab57787329a7b58c7b80a38384bdb3856aa067",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/78ab57787329a7b58c7b80a38384bdb3856aa067"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e8b215a086d91a8774210bb6ce8d1560aaaf0789",
          "sha": "e8b215a086d91a8774210bb6ce8d1560aaaf0789",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/e8b215a086d91a8774210bb6ce8d1560aaaf0789"
        }
      ],
      "message": "Avoid test-before-evict evictions of current peers\n\nOutbound peer logic prevents connecting to addresses that we're already\nconnected to, so prevent inadvertent eviction of current peers via\ntest-before-evict by checking this condition and marking current peer's\naddresses as Good().\n\nCo-authored-by: John Newbery <john@johnnewbery.com>",
      "committer": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2020-10-27T15:15:21Z"
      },
      "author": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2020-10-16T18:05:09Z"
      },
      "sha": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 3926512474,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MzkyNjUxMjQ3NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3926512474",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-27T15:15:39Z"
    },
    {
      "event": "commented",
      "id": 717332799,
      "node_id": "MDEyOklzc3VlQ29tbWVudDcxNzMzMjc5OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/717332799",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-27T15:42:24Z",
      "updated_at": "2020-10-27T15:42:24Z",
      "author_association": "MEMBER",
      "body": "Thanks for the review @jnewbery -- I went ahead and squashed that last commit into the first one, so that the `FinalizeNode` interface changes are all together now.",
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#issuecomment-717332799",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20187"
    },
    {
      "event": "mentioned",
      "id": 3926671149,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzkyNjY3MTE0OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3926671149",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-27T15:42:24Z"
    },
    {
      "event": "subscribed",
      "id": 3926671157,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDM5MjY2NzExNTc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3926671157",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-27T15:42:25Z"
    },
    {
      "event": "commented",
      "id": 717343706,
      "node_id": "MDEyOklzc3VlQ29tbWVudDcxNzM0MzcwNg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/717343706",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-27T15:58:11Z",
      "updated_at": "2020-10-27T15:58:11Z",
      "author_association": "MEMBER",
      "body": "utACK 16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#issuecomment-717343706",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20187"
    },
    {
      "event": "reviewed",
      "id": 518911437,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4OTExNDM3",
      "url": null,
      "actor": null,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Tested ACK 16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#pullrequestreview-518911437",
      "submitted_at": "2020-10-28T17:24:13Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
    },
    {
      "event": "commented",
      "id": 718261810,
      "node_id": "MDEyOklzc3VlQ29tbWVudDcxODI2MTgxMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/718261810",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-28T23:15:50Z",
      "updated_at": "2020-10-29T00:09:39Z",
      "author_association": "MEMBER",
      "body": "I haven't looked at the code here, but just tried to verify the test-before-evict bug you mention. I believe it is indeed there, and will result in the conncted node being forgotten. Consider the following scenario:\r\n* Addrman has a `tried` entry A and a `new` entry B that would collide with A if moved to the `tried` table. There is a (long term) ongoining outbound connection to A currently.\r\n* An outbound connection to B succeeds (`VERSION` is received) as a non-block-only connection, calling `Good(B)`. Due to the collision, B is not marked `tried`, but instead recorded in the `m_tried_collisions` set.\r\n* `ConnectionType::FEELER` connections during this state have a high chance of returning A from `SelectTriedCollision()` now. However, `OpenNetworkConnection` on those will fail, as an existing connection to A exists. No addrman state changes result from this (neither `nLastSuccess` or `nLastTry` are updated).\r\n* The first time `ResolveCollisions` is called at least 4 hours after the connection to A was opened, and after successfully connecting to B, it will see all connections to A as over `ADDRMAN_REPLACEMENT_HOURS` old. Assuming the last connection to B at this point is also at least 40 minutes ago (which seems likely), B will take A's place in the `tried` table.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#issuecomment-718261810",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20187"
    },
    {
      "event": "reviewed",
      "id": 519184547,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5MTg0NTQ3",
      "url": null,
      "actor": null,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "utACK 16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#pullrequestreview-519184547",
      "submitted_at": "2020-10-29T00:08:06Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
    },
    {
      "event": "commented",
      "id": 718362016,
      "node_id": "MDEyOklzc3VlQ29tbWVudDcxODM2MjAxNg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/718362016",
      "actor": {
        "login": "amitiuttarwar",
        "id": 1500952,
        "node_id": "MDQ6VXNlcjE1MDA5NTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/amitiuttarwar",
        "html_url": "https://github.com/amitiuttarwar",
        "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
        "following_url": "https://api.github.com/users/amitiuttarwar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/amitiuttarwar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/amitiuttarwar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
        "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
        "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
        "events_url": "https://api.github.com/users/amitiuttarwar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-29T05:05:06Z",
      "updated_at": "2020-10-30T01:13:06Z",
      "author_association": "CONTRIBUTOR",
      "body": "approach ACK - I've read through the code, understand the proposed changes, and think they make sense. \r\n\r\nthe update to `Connected` looks good & I agree that the test-before-evict logic was bugged & this patch fixes it. I also appreciate the refactoring to `ThreadOpenConnections`, I've looked at that code before but wasn't able to fully retain the pieces to understand the big picture, but with this patch its both fixed and makes sense to me now. \r\n\r\nonly thing holding me back from a code review ACK is wanting to better understand the full implications of `Good` to verify that there are no other problems by calling it for block-relay-only connections in both places. I think we are _good_ 😏 but I'm going to continue digging to fully convince myself.\r\n\r\n_also- the travis failure is bizarre ! https://travis-ci.org/github/bitcoin/bitcoin/jobs/739321630\r\nno error, no logs, nothing. doesn't even look like a timeout!_\r\n\r\nupdate: its been restarted",
      "user": {
        "login": "amitiuttarwar",
        "id": 1500952,
        "node_id": "MDQ6VXNlcjE1MDA5NTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/amitiuttarwar",
        "html_url": "https://github.com/amitiuttarwar",
        "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
        "following_url": "https://api.github.com/users/amitiuttarwar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/amitiuttarwar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/amitiuttarwar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
        "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
        "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
        "events_url": "https://api.github.com/users/amitiuttarwar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#issuecomment-718362016",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20187"
    },
    {
      "event": "reviewed",
      "id": 520249261,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMjQ5MjYx",
      "url": null,
      "actor": null,
      "commit_id": "daf55531260833d597ee599e2d289ea1be0b1d9c",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Code Review ACK 16d9bfc.\r\n\r\nAFAIU this privacy fix it's a worthy one as it masks the addr of our hidden peers among the wider set of all our known addrs. After this PR, an adversary observing our addr-relay traffic shouldn't be able to dissociate them.",
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#pullrequestreview-520249261",
      "submitted_at": "2020-10-30T02:20:56Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
    },
    {
      "event": "reviewed",
      "id": 520852711,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwODUyNzEx",
      "url": null,
      "actor": null,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Code-Review ACK 16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751.\r\n\r\nI'm not entirely convinced that calling `Good` for blocks-only peers leaks strictly no information at all (e.g. it updates internal state such as `nLastSuccess`, which influence `IsTerrible()`, which influences `GetAddr` Response selection), but I couldn't think of a way to use that, especially after GetAddr caching (18991).  ",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#pullrequestreview-520852711",
      "submitted_at": "2020-10-30T17:10:38Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
    },
    {
      "event": "commented",
      "id": 719709075,
      "node_id": "MDEyOklzc3VlQ29tbWVudDcxOTcwOTA3NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/719709075",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-30T17:59:36Z",
      "updated_at": "2020-10-30T17:59:36Z",
      "author_association": "MEMBER",
      "body": ">I'm not entirely convinced that calling Good for blocks-only peers leaks strictly no information at all (e.g. it updates internal state such as nLastSuccess, which influence IsTerrible(), which influences GetAddr Response selection), but I couldn't think of a way to use that, especially after GetAddr caching (18991).\r\n\r\n@mzumsande I agree that it's unlikely we're leaking no information by calling `Good()`; my previous approach in #15759 was to try to  avoid calling any addrman functions for block-relay-only peers, but my conclusion is that addrman-eviction is a worse outcome than the effects of calling `Good()` (which I estimate as reducing the anonymity set of our block-relay-only peers to the set of addresses in our tried table -- hopefully it's not meaningfully worse than that).\r\n\r\nHowever if we were to structure the addrman differently in the future so that eviction isn't a concern (as I mention here https://github.com/bitcoin/bitcoin/pull/20187#discussion_r515137714), I might suggest that we reverse course again and avoid any interaction between block-relay-only peers and addrman at all.",
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#issuecomment-719709075",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20187"
    },
    {
      "event": "mentioned",
      "id": 3942473368,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50Mzk0MjQ3MzM2OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3942473368",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-30T17:59:36Z"
    },
    {
      "event": "subscribed",
      "id": 3942473371,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDM5NDI0NzMzNzE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3942473371",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-30T17:59:36Z"
    },
    {
      "event": "reviewed",
      "id": 521189824,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMTg5ODI0",
      "url": null,
      "actor": null,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "code review ACK 16d9bfc417\r\n\r\n- agree with the prior conversation that we can't have 100% guarantee we're not leaking any information, but that not evicting the peers is more important. & I spent some time and can't figure out any concrete way to exploit any information leak, so I'm comfortable with these changes\r\n\r\nthoughts for future improvements: \r\n- also saw some mentions along these lines, but I think the code around `fUpdateConnectionTime`, `fCurrentlyConnected`, and comment or function name of `CAddrMan::Connected` could be simplified and made easier to parse. `Connected` is only invoked when stopping or disconnecting the nodes, but the comment says \"Mark an entry as currently-connected-to.\" `fUpdateConnectionTime` is used as an in/out param when `FinalizeNode` could just directly call `Connected`. but to reiterate, these are all tangential to this PR. just thoughts that came up as I was trying to understand relevant code paths. ",
      "user": {
        "login": "amitiuttarwar",
        "id": 1500952,
        "node_id": "MDQ6VXNlcjE1MDA5NTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/amitiuttarwar",
        "html_url": "https://github.com/amitiuttarwar",
        "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
        "following_url": "https://api.github.com/users/amitiuttarwar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/amitiuttarwar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/amitiuttarwar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
        "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
        "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
        "events_url": "https://api.github.com/users/amitiuttarwar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#pullrequestreview-521189824",
      "submitted_at": "2020-11-02T19:00:27Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
    },
    {
      "event": "merged",
      "id": 3950767849,
      "node_id": "MDExOk1lcmdlZEV2ZW50Mzk1MDc2Nzg0OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3950767849",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "8387f832d6932d72adb86eaa4aecfd0c35341acc",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8387f832d6932d72adb86eaa4aecfd0c35341acc",
      "created_at": "2020-11-03T01:39:58Z"
    },
    {
      "event": "closed",
      "id": 3950767862,
      "node_id": "MDExOkNsb3NlZEV2ZW50Mzk1MDc2Nzg2Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3950767862",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-11-03T01:39:58Z"
    },
    {
      "event": "referenced",
      "id": 3953872044,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDM5NTM4NzIwNDQ=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3953872044",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "7ea7d069c9a00c42361128b38b14dcf93be43564",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/7ea7d069c9a00c42361128b38b14dcf93be43564",
      "created_at": "2020-11-03T16:54:33Z"
    },
    {
      "event": "referenced",
      "id": 3954100217,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDM5NTQxMDAyMTc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3954100217",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "402829ed13dcedc00f83f0975688ac2a1b933dc8",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/402829ed13dcedc00f83f0975688ac2a1b933dc8",
      "created_at": "2020-11-03T17:47:05Z"
    },
    {
      "event": "referenced",
      "id": 5797046531,
      "node_id": "REFE_lADOABII584rNNhizwAAAAFZh-kD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5797046531",
      "actor": {
        "login": "deadalnix",
        "id": 854121,
        "node_id": "MDQ6VXNlcjg1NDEyMQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/854121?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/deadalnix",
        "html_url": "https://github.com/deadalnix",
        "followers_url": "https://api.github.com/users/deadalnix/followers",
        "following_url": "https://api.github.com/users/deadalnix/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/deadalnix/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/deadalnix/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/deadalnix/subscriptions",
        "organizations_url": "https://api.github.com/users/deadalnix/orgs",
        "repos_url": "https://api.github.com/users/deadalnix/repos",
        "events_url": "https://api.github.com/users/deadalnix/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/deadalnix/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "70bbd9b11321f26ec91e43ede3bc91ab8f4659e3",
      "commit_url": "https://api.github.com/repos/Bitcoin-ABC/bitcoin-abc/commits/70bbd9b11321f26ec91e43ede3bc91ab8f4659e3",
      "created_at": "2021-12-21T07:20:06Z"
    },
    {
      "event": "referenced",
      "id": 5797046535,
      "node_id": "REFE_lADOABII584rNNhizwAAAAFZh-kH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5797046535",
      "actor": {
        "login": "deadalnix",
        "id": 854121,
        "node_id": "MDQ6VXNlcjg1NDEyMQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/854121?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/deadalnix",
        "html_url": "https://github.com/deadalnix",
        "followers_url": "https://api.github.com/users/deadalnix/followers",
        "following_url": "https://api.github.com/users/deadalnix/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/deadalnix/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/deadalnix/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/deadalnix/subscriptions",
        "organizations_url": "https://api.github.com/users/deadalnix/orgs",
        "repos_url": "https://api.github.com/users/deadalnix/repos",
        "events_url": "https://api.github.com/users/deadalnix/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/deadalnix/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "d924bd2a89e2c5bf0f552ca2f8ac64435989a100",
      "commit_url": "https://api.github.com/repos/Bitcoin-ABC/bitcoin-abc/commits/d924bd2a89e2c5bf0f552ca2f8ac64435989a100",
      "created_at": "2021-12-21T07:20:06Z"
    },
    {
      "event": "referenced",
      "id": 5797046538,
      "node_id": "REFE_lADOABII584rNNhizwAAAAFZh-kK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5797046538",
      "actor": {
        "login": "deadalnix",
        "id": 854121,
        "node_id": "MDQ6VXNlcjg1NDEyMQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/854121?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/deadalnix",
        "html_url": "https://github.com/deadalnix",
        "followers_url": "https://api.github.com/users/deadalnix/followers",
        "following_url": "https://api.github.com/users/deadalnix/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/deadalnix/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/deadalnix/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/deadalnix/subscriptions",
        "organizations_url": "https://api.github.com/users/deadalnix/orgs",
        "repos_url": "https://api.github.com/users/deadalnix/repos",
        "events_url": "https://api.github.com/users/deadalnix/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/deadalnix/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "811f79967ee252ca32fcfb89f6ace73f2ae1f9b9",
      "commit_url": "https://api.github.com/repos/Bitcoin-ABC/bitcoin-abc/commits/811f79967ee252ca32fcfb89f6ace73f2ae1f9b9",
      "created_at": "2021-12-21T07:20:06Z"
    },
    {
      "event": "referenced",
      "id": 5797046544,
      "node_id": "REFE_lADOABII584rNNhizwAAAAFZh-kQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5797046544",
      "actor": {
        "login": "deadalnix",
        "id": 854121,
        "node_id": "MDQ6VXNlcjg1NDEyMQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/854121?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/deadalnix",
        "html_url": "https://github.com/deadalnix",
        "followers_url": "https://api.github.com/users/deadalnix/followers",
        "following_url": "https://api.github.com/users/deadalnix/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/deadalnix/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/deadalnix/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/deadalnix/subscriptions",
        "organizations_url": "https://api.github.com/users/deadalnix/orgs",
        "repos_url": "https://api.github.com/users/deadalnix/repos",
        "events_url": "https://api.github.com/users/deadalnix/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/deadalnix/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "82d88e35d6d3621141607b758b394435e4665207",
      "commit_url": "https://api.github.com/repos/Bitcoin-ABC/bitcoin-abc/commits/82d88e35d6d3621141607b758b394435e4665207",
      "created_at": "2021-12-21T07:20:06Z"
    },
    {
      "event": "locked",
      "id": 7199001888,
      "node_id": "LOE_lADOABII584rNNhizwAAAAGtGA0g",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7199001888",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-16T17:01:57Z",
      "lock_reason": "resolved"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511795306",
      "pull_request_review_id": 516562733,
      "id": 511795306,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTc5NTMwNg==",
      "diff_hunk": "@@ -2571,7 +2587,8 @@ void CConnman::DeleteNode(CNode* pnode)\n     assert(pnode);\n     bool fUpdateConnectionTime = false;\n     m_msgproc->FinalizeNode(pnode->GetId(), fUpdateConnectionTime);\n-    if (fUpdateConnectionTime) {\n+    if (fUpdateConnectionTime && !pnode->IsBlockOnlyConn()) {",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 46,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This further splits the logic about whether to call `Connected()` for a node. Now there are three three places that you need to look:\r\n\r\n- Is the peer an outbound (https://github.com/bitcoin/bitcoin/blob/dafde15cc04fbeb5851fa98fec34dd9f2a7e8420/src/net_processing.cpp#L2475-L2478)\r\n- Does the peer have any misbehavior points (https://github.com/bitcoin/bitcoin/blob/dafde15cc04fbeb5851fa98fec34dd9f2a7e8420/src/net_processing.cpp#L849-L851)\r\n- Is the peer a block only connection (here)\r\n\r\nI'd rather place this new logic in one of the existing places and eventually consolidate them, rather than add another place for people to look.",
      "created_at": "2020-10-26T08:44:13Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r511795306",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511795306"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2590,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511799043",
      "pull_request_review_id": 516562733,
      "id": 511799043,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTc5OTA0Mw==",
      "diff_hunk": "@@ -2421,9 +2415,22 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n             // Get recent addresses\n             m_connman.PushMessage(&pfrom, CNetMsgMaker(greatest_common_version).Make(NetMsgType::GETADDR));",
      "path": "src/net_processing.cpp",
      "position": 39,
      "original_position": 19,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Is there any reason to net send a `getaddr` message to block relay only peers? See the comment above \"If we're starting up for the first time, our addrman may be pretty empty...\". Since #17428, the first peers we connect to on startup will be anchor connections, which are block relay only peers. I can't see any downside to asking them for addrs.",
      "created_at": "2020-10-26T08:50:45Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r511799043",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511799043"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2428,
      "original_line": 2428,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511800034",
      "pull_request_review_id": 516562733,
      "id": 511800034,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTgwMDAzNA==",
      "diff_hunk": "@@ -445,6 +445,10 @@ class CConnman\n     CNode* FindNode(const std::string& addrName);\n     CNode* FindNode(const CService& addr);\n \n+    // Determine whether we're already connected to a given peer, in order to",
      "path": "src/net.h",
      "position": null,
      "original_position": 4,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Make this a doxygen format comment (starting with `/**`, so that doxygen docs can be generated from it: https://doxygen.bitcoincore.org/)",
      "created_at": "2020-10-26T08:52:27Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r511800034",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511800034"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 448,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511842475",
      "pull_request_review_id": 516562733,
      "id": 511842475,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg0MjQ3NQ==",
      "diff_hunk": "@@ -1967,7 +1972,18 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             CAddrInfo addr = addrman.SelectTriedCollision();\n \n             // SelectTriedCollision returns an invalid address if it is empty.\n-            if (!fFeeler || !addr.IsValid()) {\n+            bool test_before_evict = fFeeler && addr.IsValid();",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 17,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This logic is already very convoluted, and I think this change makes it even more difficult to follow. The mainline case (connecting to a new outbound beer), currently calls `SelectedTriedCollision()`, then sets `test_before_evict` to false, and then throws away the return value from `SelectedTriedCollision()` in the `if (!test_before_evict)` block below.\r\n\r\nThe logic for feeler connections and non-feeler connections has diverged to the point where it'd make this code a lot easier to follow if it were refactored to a GetFeelerConnectionAddress() and GetOutboundConnectionAddress() function. For now, I think the following is easier to read:\r\n\r\n```\r\n            if (fFeeler) {\r\n                // First, try to get a tried table collision address. This returns\r\n                // an empty (invalid) address if there are no collisions to try.\r\n                addr = addrman.SelectTriedCollision();\r\n\r\n                if (!addr.IsValid()) {\r\n                    // No tried table collisions. Select a new table address\r\n                    // for our feeler.\r\n                    addr = addrman.Select(true);\r\n                } else if (AlreadyConnectedToPeer(addr)) {\r\n                    // If test-before-evict logic would have us connect to a\r\n                    // peer that we're already connected to, just mark that\r\n                    // address as Good(). We won't be able to initiate the\r\n                    // connection anyway, so this avoids inadvertently evicting\r\n                    // a currently-connected peer.\r\n                    addrman.Good(addr);\r\n                    addr = addrman.Select(true);\r\n                }\r\n            } else {\r\n                // Not a feeler\r\n                addr = addrman.Select();\r\n            }\r\n```\r\n\r\n",
      "created_at": "2020-10-26T10:02:25Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r511842475",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511842475"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1975,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511842695",
      "pull_request_review_id": 516562733,
      "id": 511842695,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg0MjY5NQ==",
      "diff_hunk": "@@ -1967,7 +1972,18 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             CAddrInfo addr = addrman.SelectTriedCollision();\n \n             // SelectTriedCollision returns an invalid address if it is empty.\n-            if (!fFeeler || !addr.IsValid()) {\n+            bool test_before_evict = fFeeler && addr.IsValid();\n+\n+            // If test-before-evict logic would have us connect to a peer that\n+            // we're already connected to, just mark that address as Good(). We\n+            // won't be able to initiate the connection anyway, so this avoids\n+            // inadvertently evicting a currently-connected peer.\n+            if (test_before_evict && AlreadyConnectedToPeer(addr)) {\n+                MarkAddressGood(addr);",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 24,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "No need to call this CConnman forwarding function. Just call `addrman.Good()` directly.",
      "created_at": "2020-10-26T10:02:49Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r511842695",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511842695"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1982,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511843620",
      "pull_request_review_id": 516562733,
      "id": 511843620,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg0MzYyMA==",
      "diff_hunk": "@@ -2421,9 +2415,22 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n             // Get recent addresses\n             m_connman.PushMessage(&pfrom, CNetMsgMaker(greatest_common_version).Make(NetMsgType::GETADDR));\n             pfrom.fGetAddr = true;\n+        }\n \n-            // Moves address from New to Tried table in Addrman, resolves\n-            // tried-table collisions, etc.\n+        if (!pfrom.IsInboundConn()) {\n+            // For non-inbound connections, we also update the addrman to",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 26,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Remove the word 'also'. Comments have a habit of migrating around in the codebase, and joining words like also lose their meaning if additional code/comments are added around the existing comments.",
      "created_at": "2020-10-26T10:04:27Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r511843620",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511843620"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2421,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511845721",
      "pull_request_review_id": 516562733,
      "id": 511845721,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg0NTcyMQ==",
      "diff_hunk": "@@ -348,6 +348,11 @@ CNode* CConnman::FindNode(const CService& addr)\n     return nullptr;\n }\n \n+bool CConnman::AlreadyConnectedToPeer(const CAddress& addr)\n+{\n+    return FindNode(static_cast<CNetAddr>(addr)) || FindNode(addr.ToStringIPPort());",
      "path": "src/net.cpp",
      "position": 6,
      "original_position": 6,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Note that this is inefficient (lock cs_vNodes, iterate through nodes, unlock, lock, iterate, unlock), but that was a problem with the existing code. It could be made more efficient by converting this to a `ForEachNode()` call with a lambda returning if the address matches the `CNetAddr` or string.",
      "created_at": "2020-10-26T10:07:51Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r511845721",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511845721"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 359,
      "original_line": 359,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511846688",
      "pull_request_review_id": 516562733,
      "id": 511846688,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg0NjY4OA==",
      "diff_hunk": "@@ -348,6 +348,11 @@ CNode* CConnman::FindNode(const CService& addr)\n     return nullptr;\n }\n \n+bool CConnman::AlreadyConnectedToPeer(const CAddress& addr)",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: `AlreadyConnectedToAddress()` would be a more accurate name.",
      "created_at": "2020-10-26T10:09:31Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r511846688",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511846688"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 351,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511847746",
      "pull_request_review_id": 516562733,
      "id": 511847746,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg0Nzc0Ng==",
      "diff_hunk": "@@ -348,6 +348,11 @@ CNode* CConnman::FindNode(const CService& addr)\n     return nullptr;\n }\n \n+bool CConnman::AlreadyConnectedToPeer(const CAddress& addr)\n+{\n+    return FindNode(static_cast<CNetAddr>(addr)) || FindNode(addr.ToStringIPPort());",
      "path": "src/net.cpp",
      "position": 6,
      "original_position": 6,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It might be worth adding a comment about why we search both for the `CNetAddr` _and_ the ip/port string. It was added here: https://github.com/bitcoin/bitcoin/commit/9bab521df895c149579b9e64931405c56b008afb#diff-00021eed586a482abdb09d6cdada1d90115abe988a91421851960e26658bed02R1416 in the PR to add support for SOCKS5.",
      "created_at": "2020-10-26T10:11:15Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r511847746",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511847746"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 359,
      "original_line": 359,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511933800",
      "pull_request_review_id": 516741591,
      "id": 511933800,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkzMzgwMA==",
      "diff_hunk": "@@ -2421,9 +2415,22 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n             // Get recent addresses\n             m_connman.PushMessage(&pfrom, CNetMsgMaker(greatest_common_version).Make(NetMsgType::GETADDR));",
      "path": "src/net_processing.cpp",
      "position": 39,
      "original_position": 19,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": 511799043,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Well if you have anchor connections to connect to, you likely have a useful `peers.dat` as well (you must have been running before), so I don't think that reasoning applies.\r\n\r\nIf we process an `addr` message from a peer by adding entries to addrman, we then will leak that information in at least two ways I can think of -- feeler connections will be attempted to addresses we learn that are in the new table, and we sample from our addrman to respond to other peers who send us `getaddr` messages.  I don't know if there might be additional sources of information leak about what is in our addrman besides those, but those both seem like ways an attacker could at least probabilistically test whether two nodes on the network might be connected.",
      "created_at": "2020-10-26T12:49:12Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r511933800",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511933800"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2428,
      "original_line": 2428,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511934522",
      "pull_request_review_id": 516742480,
      "id": 511934522,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkzNDUyMg==",
      "diff_hunk": "@@ -348,6 +348,11 @@ CNode* CConnman::FindNode(const CService& addr)\n     return nullptr;\n }\n \n+bool CConnman::AlreadyConnectedToPeer(const CAddress& addr)\n+{\n+    return FindNode(static_cast<CNetAddr>(addr)) || FindNode(addr.ToStringIPPort());",
      "path": "src/net.cpp",
      "position": 6,
      "original_position": 6,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": 511845721,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Agreed, but I didn't want to rewrite this.",
      "created_at": "2020-10-26T12:50:21Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r511934522",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511934522"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 359,
      "original_line": 359,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511935957",
      "pull_request_review_id": 516744353,
      "id": 511935957,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkzNTk1Nw==",
      "diff_hunk": "@@ -2571,7 +2587,8 @@ void CConnman::DeleteNode(CNode* pnode)\n     assert(pnode);\n     bool fUpdateConnectionTime = false;\n     m_msgproc->FinalizeNode(pnode->GetId(), fUpdateConnectionTime);\n-    if (fUpdateConnectionTime) {\n+    if (fUpdateConnectionTime && !pnode->IsBlockOnlyConn()) {",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 46,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": 511795306,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Agreed that this is confusing.  Originally I was contemplating have code in `net.cpp` that wouldn't call `CAddrMan::Attempt()` on block-relay-only peers, and so having this logic also be in `net.cpp` made more sense to me; but now I think it's fine to move into `net_processing`/`FinalizeNode()`.",
      "created_at": "2020-10-26T12:52:49Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r511935957",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511935957"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2590,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511998003",
      "pull_request_review_id": 516827655,
      "id": 511998003,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk5ODAwMw==",
      "diff_hunk": "@@ -2421,9 +2415,22 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n             // Get recent addresses\n             m_connman.PushMessage(&pfrom, CNetMsgMaker(greatest_common_version).Make(NetMsgType::GETADDR));",
      "path": "src/net_processing.cpp",
      "position": 39,
      "original_position": 19,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": 511799043,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Ah, I see that we ignore all `addr` messages from block-relay-only peers anyway, in the addr message processing (https://github.com/bitcoin/bitcoin/blob/d67883d01e507dd22d1281f4a4860e79d6a46a47/src/net_processing.cpp#L2549), so this seems fine.",
      "created_at": "2020-10-26T14:23:01Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r511998003",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/511998003"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2428,
      "original_line": 2428,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512004982",
      "pull_request_review_id": 516837035,
      "id": 512004982,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAwNDk4Mg==",
      "diff_hunk": "@@ -2571,7 +2587,8 @@ void CConnman::DeleteNode(CNode* pnode)\n     assert(pnode);\n     bool fUpdateConnectionTime = false;\n     m_msgproc->FinalizeNode(pnode->GetId(), fUpdateConnectionTime);\n-    if (fUpdateConnectionTime) {\n+    if (fUpdateConnectionTime && !pnode->IsBlockOnlyConn()) {",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 46,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": 511795306,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I'd suggest going further and removing `fCurrentlyConnected`, and then changing `FinalizeNode()` to check whether the peer is:\r\n- `fSuccessfullyConnected`\r\n- not inbound and not block relay only\r\n- has 0 misbehavior score\r\nand then directly call `CAddrMan.Connected()` directly, so that all the logic around calling `Connected()` is in one place.\r\n\r\nIf you agree, perhaps you could take a look at 1755f08b4dba34b483a401c6098d5df549219ce7 in PR #20228, which does some of that. For this PR, just putting the block relay only check inside `FinalizeNode()` at least doesn't make the situation any worse.",
      "created_at": "2020-10-26T14:31:39Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r512004982",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512004982"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2590,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512106253",
      "pull_request_review_id": 516970642,
      "id": 512106253,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjEwNjI1Mw==",
      "diff_hunk": "@@ -829,7 +829,7 @@ void PeerManager::ReattemptInitialBroadcast(CScheduler& scheduler) const\n     scheduler.scheduleFromNow([&] { ReattemptInitialBroadcast(scheduler); }, delta);\n }\n \n-void PeerManager::FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) {\n+void PeerManager::FinalizeNode(NodeId nodeid, const bool is_block_relay_only_peer, bool& fUpdateConnectionTime) {",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "266d22a3d18c89a3b74d81bcdcc9750a9f8a056f",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think it'd be cleaner to pass in a `const CNode&` and get the id and block relay only state from the CNode.",
      "created_at": "2020-10-26T16:42:38Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r512106253",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512106253"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 840,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512106972",
      "pull_request_review_id": 516970642,
      "id": 512106972,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjEwNjk3Mg==",
      "diff_hunk": "@@ -2421,9 +2416,22 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n             // Get recent addresses\n             m_connman.PushMessage(&pfrom, CNetMsgMaker(greatest_common_version).Make(NetMsgType::GETADDR));\n             pfrom.fGetAddr = true;\n+        }\n \n-            // Moves address from New to Tried table in Addrman, resolves\n-            // tried-table collisions, etc.\n+        if (!pfrom.IsInboundConn()) {\n+            // For non-inbound connections, we update the addrman to record\n+            // connection success so that addrman will have an up-to-date\n+            // notion of which peers are online and available.\n+            //\n+            // While we strive to not leak information about block-relay-only\n+            // connections via the addrman, not moving an address to the tried\n+            // table is also potentially detrimental because new-table entries\n+            // are subject to eviction in the event of addrman collisions.  We\n+            // mitigate the information-leak by never calling\n+            // CAddrMan::Connected() on block-relay-only peers; see net.cpp",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 54,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "266d22a3d18c89a3b74d81bcdcc9750a9f8a056f",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This is now in FinalizeNode, not net.cpp :)",
      "created_at": "2020-10-26T16:43:46Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r512106972",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512106972"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2441,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512116986",
      "pull_request_review_id": 516983409,
      "id": 512116986,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjExNjk4Ng==",
      "diff_hunk": "@@ -445,6 +445,10 @@ class CConnman\n     CNode* FindNode(const std::string& addrName);\n     CNode* FindNode(const CService& addr);\n \n+    // Determine whether we're already connected to a given peer, in order to",
      "path": "src/net.h",
      "position": null,
      "original_position": 4,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": 511800034,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2020-10-26T16:53:33Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r512116986",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512116986"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 448,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512118406",
      "pull_request_review_id": 516984643,
      "id": 512118406,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjExODQwNg==",
      "diff_hunk": "@@ -2571,7 +2587,8 @@ void CConnman::DeleteNode(CNode* pnode)\n     assert(pnode);\n     bool fUpdateConnectionTime = false;\n     m_msgproc->FinalizeNode(pnode->GetId(), fUpdateConnectionTime);\n-    if (fUpdateConnectionTime) {\n+    if (fUpdateConnectionTime && !pnode->IsBlockOnlyConn()) {",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 46,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": 511795306,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I just did the simple thing of moving this to `FinalizeNode()`.  Because there's no good way to get a `CNode` from a `NodeId` while it's in the process of being deleted (as far as I can tell!), I had to change the interface to accommodate this move.",
      "created_at": "2020-10-26T16:54:49Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r512118406",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512118406"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2590,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512118798",
      "pull_request_review_id": 516985051,
      "id": 512118798,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjExODc5OA==",
      "diff_hunk": "@@ -1967,7 +1972,18 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             CAddrInfo addr = addrman.SelectTriedCollision();\n \n             // SelectTriedCollision returns an invalid address if it is empty.\n-            if (!fFeeler || !addr.IsValid()) {\n+            bool test_before_evict = fFeeler && addr.IsValid();",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 17,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": 511842475,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I'm indifferent, so taking your patch.",
      "created_at": "2020-10-26T16:55:12Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r512118798",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512118798"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1975,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512118929",
      "pull_request_review_id": 516985213,
      "id": 512118929,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjExODkyOQ==",
      "diff_hunk": "@@ -1967,7 +1972,18 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             CAddrInfo addr = addrman.SelectTriedCollision();\n \n             // SelectTriedCollision returns an invalid address if it is empty.\n-            if (!fFeeler || !addr.IsValid()) {\n+            bool test_before_evict = fFeeler && addr.IsValid();\n+\n+            // If test-before-evict logic would have us connect to a peer that\n+            // we're already connected to, just mark that address as Good(). We\n+            // won't be able to initiate the connection anyway, so this avoids\n+            // inadvertently evicting a currently-connected peer.\n+            if (test_before_evict && AlreadyConnectedToPeer(addr)) {\n+                MarkAddressGood(addr);",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 24,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": 511842695,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I took this change as part of your patch for rewriting the loop.",
      "created_at": "2020-10-26T16:55:22Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r512118929",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512118929"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1982,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512119008",
      "pull_request_review_id": 516985318,
      "id": 512119008,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjExOTAwOA==",
      "diff_hunk": "@@ -2421,9 +2415,22 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n             // Get recent addresses\n             m_connman.PushMessage(&pfrom, CNetMsgMaker(greatest_common_version).Make(NetMsgType::GETADDR));\n             pfrom.fGetAddr = true;\n+        }\n \n-            // Moves address from New to Tried table in Addrman, resolves\n-            // tried-table collisions, etc.\n+        if (!pfrom.IsInboundConn()) {\n+            // For non-inbound connections, we also update the addrman to",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 26,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": 511843620,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2020-10-26T16:55:29Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r512119008",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512119008"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2421,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512119091",
      "pull_request_review_id": 516985428,
      "id": 512119091,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjExOTA5MQ==",
      "diff_hunk": "@@ -348,6 +348,11 @@ CNode* CConnman::FindNode(const CService& addr)\n     return nullptr;\n }\n \n+bool CConnman::AlreadyConnectedToPeer(const CAddress& addr)",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": 511846688,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Agreed, done.",
      "created_at": "2020-10-26T16:55:37Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r512119091",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512119091"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 351,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512119159",
      "pull_request_review_id": 516985519,
      "id": 512119159,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjExOTE1OQ==",
      "diff_hunk": "@@ -348,6 +348,11 @@ CNode* CConnman::FindNode(const CService& addr)\n     return nullptr;\n }\n \n+bool CConnman::AlreadyConnectedToPeer(const CAddress& addr)\n+{\n+    return FindNode(static_cast<CNetAddr>(addr)) || FindNode(addr.ToStringIPPort());",
      "path": "src/net.cpp",
      "position": 6,
      "original_position": 6,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": 511847746,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Care to suggest a comment?  I'm not sure my understanding of when we might be looking up by `CNetAddr` versus string is precise enough to say the right thing here.",
      "created_at": "2020-10-26T16:55:43Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r512119159",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512119159"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 359,
      "original_line": 359,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512130998",
      "pull_request_review_id": 517001419,
      "id": 512130998,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjEzMDk5OA==",
      "diff_hunk": "@@ -348,6 +348,11 @@ CNode* CConnman::FindNode(const CService& addr)\n     return nullptr;\n }\n \n+bool CConnman::AlreadyConnectedToPeer(const CAddress& addr)\n+{\n+    return FindNode(static_cast<CNetAddr>(addr)) || FindNode(addr.ToStringIPPort());",
      "path": "src/net.cpp",
      "position": 6,
      "original_position": 6,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": 511847746,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I was hoping you might have a better understanding of this than me :grin: . My understanding of how hostnames/proxies work in Bitcoin Core is certainly too hazy to suggest any wording here.\r\n\r\nI'm going to mark this as resolved. It'd be good to document why we're doing this, but this PR isn't changing the behavior, so it's certainly not a blocker.",
      "created_at": "2020-10-26T17:12:59Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r512130998",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512130998"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 359,
      "original_line": 359,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512131320",
      "pull_request_review_id": 517001871,
      "id": 512131320,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjEzMTMyMA==",
      "diff_hunk": "@@ -348,6 +348,11 @@ CNode* CConnman::FindNode(const CService& addr)\n     return nullptr;\n }\n \n+bool CConnman::AlreadyConnectedToPeer(const CAddress& addr)\n+{\n+    return FindNode(static_cast<CNetAddr>(addr)) || FindNode(addr.ToStringIPPort());",
      "path": "src/net.cpp",
      "position": 6,
      "original_position": 6,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": 511845721,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "That's reasonable. It's not a change in behaviour. Marking resolved.",
      "created_at": "2020-10-26T17:13:31Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r512131320",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512131320"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 359,
      "original_line": 359,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512133129",
      "pull_request_review_id": 517004097,
      "id": 512133129,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjEzMzEyOQ==",
      "diff_hunk": "@@ -2571,7 +2587,8 @@ void CConnman::DeleteNode(CNode* pnode)\n     assert(pnode);\n     bool fUpdateConnectionTime = false;\n     m_msgproc->FinalizeNode(pnode->GetId(), fUpdateConnectionTime);\n-    if (fUpdateConnectionTime) {\n+    if (fUpdateConnectionTime && !pnode->IsBlockOnlyConn()) {",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 46,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": 511795306,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`DeleteNode()` is holding a reference to the `CNode`, so you should just be able to pass a const reference to that CNode down to `FinalizeNode()`. That'd be more symmetrical with the other `NetEventsInterface` interface functions (you could also pass a pointer like the other functions, but they should all be const references really)",
      "created_at": "2020-10-26T17:16:02Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r512133129",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512133129"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2590,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512179647",
      "pull_request_review_id": 517063951,
      "id": 512179647,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE3OTY0Nw==",
      "diff_hunk": "@@ -829,7 +829,7 @@ void PeerManager::ReattemptInitialBroadcast(CScheduler& scheduler) const\n     scheduler.scheduleFromNow([&] { ReattemptInitialBroadcast(scheduler); }, delta);\n }\n \n-void PeerManager::FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) {\n+void PeerManager::FinalizeNode(NodeId nodeid, const bool is_block_relay_only_peer, bool& fUpdateConnectionTime) {",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "266d22a3d18c89a3b74d81bcdcc9750a9f8a056f",
      "in_reply_to_id": 512106253,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2020-10-26T18:28:31Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r512179647",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512179647"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 840,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512179793",
      "pull_request_review_id": 517064130,
      "id": 512179793,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE3OTc5Mw==",
      "diff_hunk": "@@ -2421,9 +2416,22 @@ void PeerManager::ProcessMessage(CNode& pfrom, const std::string& msg_type, CDat\n             // Get recent addresses\n             m_connman.PushMessage(&pfrom, CNetMsgMaker(greatest_common_version).Make(NetMsgType::GETADDR));\n             pfrom.fGetAddr = true;\n+        }\n \n-            // Moves address from New to Tried table in Addrman, resolves\n-            // tried-table collisions, etc.\n+        if (!pfrom.IsInboundConn()) {\n+            // For non-inbound connections, we update the addrman to record\n+            // connection success so that addrman will have an up-to-date\n+            // notion of which peers are online and available.\n+            //\n+            // While we strive to not leak information about block-relay-only\n+            // connections via the addrman, not moving an address to the tried\n+            // table is also potentially detrimental because new-table entries\n+            // are subject to eviction in the event of addrman collisions.  We\n+            // mitigate the information-leak by never calling\n+            // CAddrMan::Connected() on block-relay-only peers; see net.cpp",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 54,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "266d22a3d18c89a3b74d81bcdcc9750a9f8a056f",
      "in_reply_to_id": 512106972,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Oops, thanks for catching that. Fixed.",
      "created_at": "2020-10-26T18:28:44Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r512179793",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512179793"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2441,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512192998",
      "pull_request_review_id": 517080202,
      "id": 512192998,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE5Mjk5OA==",
      "diff_hunk": "@@ -829,7 +829,7 @@ void PeerManager::ReattemptInitialBroadcast(CScheduler& scheduler) const\n     scheduler.scheduleFromNow([&] { ReattemptInitialBroadcast(scheduler); }, delta);\n }\n \n-void PeerManager::FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) {\n+void PeerManager::FinalizeNode(NodeId nodeid, const bool is_block_relay_only_peer, bool& fUpdateConnectionTime) {",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "266d22a3d18c89a3b74d81bcdcc9750a9f8a056f",
      "in_reply_to_id": 512106253,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Sorry I wasn't clear here, but you can also drop the `NodeId` argument from the function signature, and then call `GetId()` from within `FinalizeNode()`. Passing both CNode& and NodeId is somewhat redundant.",
      "created_at": "2020-10-26T18:50:11Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r512192998",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512192998"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 840,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512230086",
      "pull_request_review_id": 517127015,
      "id": 512230086,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjIzMDA4Ng==",
      "diff_hunk": "@@ -829,7 +829,7 @@ void PeerManager::ReattemptInitialBroadcast(CScheduler& scheduler) const\n     scheduler.scheduleFromNow([&] { ReattemptInitialBroadcast(scheduler); }, delta);\n }\n \n-void PeerManager::FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) {\n+void PeerManager::FinalizeNode(NodeId nodeid, const bool is_block_relay_only_peer, bool& fUpdateConnectionTime) {",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "266d22a3d18c89a3b74d81bcdcc9750a9f8a056f",
      "in_reply_to_id": 512106253,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done in 430c8b6c0f9381f039d83066aa2cbd70c1d1414b.",
      "created_at": "2020-10-26T19:56:02Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r512230086",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512230086"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 840,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512536970",
      "pull_request_review_id": 517501586,
      "id": 512536970,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUzNjk3MA==",
      "diff_hunk": "@@ -837,7 +837,8 @@ void PeerManager::ReattemptInitialBroadcast(CScheduler& scheduler) const\n     scheduler.scheduleFromNow([&] { ReattemptInitialBroadcast(scheduler); }, delta);\n }\n \n-void PeerManager::FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) {\n+void PeerManager::FinalizeNode(const CNode& node, bool& fUpdateConnectionTime) {\n+    NodeId nodeid = node.GetId();",
      "path": "src/net_processing.cpp",
      "position": 6,
      "original_position": 6,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "430c8b6c0f9381f039d83066aa2cbd70c1d1414b",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: if you have to retouch the branch, you could make this const.",
      "created_at": "2020-10-27T09:32:02Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r512536970",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512536970"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 841,
      "original_line": 841,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512546431",
      "pull_request_review_id": 517501586,
      "id": 512546431,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU0NjQzMQ==",
      "diff_hunk": "@@ -1994,11 +1999,30 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             if (nTries > 100)\n                 break;\n \n-            CAddrInfo addr = addrman.SelectTriedCollision();\n+            CAddrInfo addr;\n \n-            // SelectTriedCollision returns an invalid address if it is empty.\n-            if (!fFeeler || !addr.IsValid()) {\n-                addr = addrman.Select(fFeeler);\n+            if (fFeeler) {\n+                // First, try to get a tried table collision address. This returns\n+                // an empty (invalid) address if there are no collisions to try.\n+                addr = addrman.SelectTriedCollision();\n+\n+                if (!addr.IsValid()) {\n+                    // No tried table collisions. Select a new table address\n+                    // for our feeler.\n+                    addr = addrman.Select(true);\n+                } else if (AlreadyConnectedToAddress(addr)) {\n+                    // If test-before-evict logic would have us connect to a\n+                    // peer that we're already connected to, just mark that\n+                    // address as Good(). We won't be able to initiate the\n+                    // connection anyway, so this avoids inadvertently evicting\n+                    // a currently-connected peer.\n+                    addrman.Good(addr);",
      "path": "src/net.cpp",
      "position": 37,
      "original_position": 37,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "430c8b6c0f9381f039d83066aa2cbd70c1d1414b",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This will call `Good()` for any address that we're connected to, including inbound peers. That's different from the current behavior, where we're careful to not call `Good()` for inbounds. The result of that is we'll move addresses of inbound peers to the tried table, even though we've never actually successfully connected out to them.\r\n\r\nDoes this open up a gap where an attacker can get addresses added to your tried table by opening lots of inbound connections to try to trigger this logic?",
      "created_at": "2020-10-27T09:46:44Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r512546431",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512546431"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2019,
      "original_line": 2019,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512658215",
      "pull_request_review_id": 517657423,
      "id": 512658215,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY1ODIxNQ==",
      "diff_hunk": "@@ -1994,11 +1999,30 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             if (nTries > 100)\n                 break;\n \n-            CAddrInfo addr = addrman.SelectTriedCollision();\n+            CAddrInfo addr;\n \n-            // SelectTriedCollision returns an invalid address if it is empty.\n-            if (!fFeeler || !addr.IsValid()) {\n-                addr = addrman.Select(fFeeler);\n+            if (fFeeler) {\n+                // First, try to get a tried table collision address. This returns\n+                // an empty (invalid) address if there are no collisions to try.\n+                addr = addrman.SelectTriedCollision();\n+\n+                if (!addr.IsValid()) {\n+                    // No tried table collisions. Select a new table address\n+                    // for our feeler.\n+                    addr = addrman.Select(true);\n+                } else if (AlreadyConnectedToAddress(addr)) {\n+                    // If test-before-evict logic would have us connect to a\n+                    // peer that we're already connected to, just mark that\n+                    // address as Good(). We won't be able to initiate the\n+                    // connection anyway, so this avoids inadvertently evicting\n+                    // a currently-connected peer.\n+                    addrman.Good(addr);",
      "path": "src/net.cpp",
      "position": 37,
      "original_position": 37,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "430c8b6c0f9381f039d83066aa2cbd70c1d1414b",
      "in_reply_to_id": 512546431,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "That can only happen if there's a tried-table collision with the address of the inbound peer -- so that inbound peer's address is already in our tried-table anyway...  I don't think calling `Good()` on an address already in our tried-table can be all that detrimental?  I think there are two cases to consider:\r\n- If we were to initiate an outbound connection to the address, it would accept it, and we would therefore mark it `Good()`.  In this case, marking it `Good()` because it's a current peer is correct.\r\n- If we initiated an outbound connection to the address, it would not accept it.  In this case, it's sort of unclear what is going on; we must have been able to connect to it as an outbound in the past in order to get it into the tried table in the first place.  So perhaps the peer isn't accepting inbound connections at this time (or is full), or there's something funny going on with the networking/address that we're trying to use to reach it?  However, keeping it in our tried table doesn't seem detrimental; at most, about 115 addresses in our tried table could be reserved for us by inbound peers who no longer are taking incoming connections but were in the past...  An attacker could just keep listening on those addresses anyway and maintain those tried-table entries (tried-table collisions are rare anyway), so I don't know that we're giving an attacker much more power or reducing the costs of an eclipse attack all that much by failing to detect this case.\r\n\r\nAnother option would be to (a) change our outbound peer logic to allow feeler connections to inbound peers, and (b) change this logic to mark outbound peers' addresses as `Good()` in the event of a tried table collision.  I am not sure if there's some reason that would be a bad idea, but I'm also not sure that it's necessary.",
      "created_at": "2020-10-27T12:40:39Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r512658215",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512658215"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2019,
      "original_line": 2019,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512729365",
      "pull_request_review_id": 517753282,
      "id": 512729365,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjcyOTM2NQ==",
      "diff_hunk": "@@ -1994,11 +1999,30 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             if (nTries > 100)\n                 break;\n \n-            CAddrInfo addr = addrman.SelectTriedCollision();\n+            CAddrInfo addr;\n \n-            // SelectTriedCollision returns an invalid address if it is empty.\n-            if (!fFeeler || !addr.IsValid()) {\n-                addr = addrman.Select(fFeeler);\n+            if (fFeeler) {\n+                // First, try to get a tried table collision address. This returns\n+                // an empty (invalid) address if there are no collisions to try.\n+                addr = addrman.SelectTriedCollision();\n+\n+                if (!addr.IsValid()) {\n+                    // No tried table collisions. Select a new table address\n+                    // for our feeler.\n+                    addr = addrman.Select(true);\n+                } else if (AlreadyConnectedToAddress(addr)) {\n+                    // If test-before-evict logic would have us connect to a\n+                    // peer that we're already connected to, just mark that\n+                    // address as Good(). We won't be able to initiate the\n+                    // connection anyway, so this avoids inadvertently evicting\n+                    // a currently-connected peer.\n+                    addrman.Good(addr);",
      "path": "src/net.cpp",
      "position": 37,
      "original_position": 37,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "430c8b6c0f9381f039d83066aa2cbd70c1d1414b",
      "in_reply_to_id": 512546431,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Ah yes, of course you're right. Anything returned from `SelectTriedCollision()` must by definition already be in the tried table.",
      "created_at": "2020-10-27T14:16:30Z",
      "updated_at": "2020-10-27T15:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r512729365",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/512729365"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2019,
      "original_line": 2019,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/513627928",
      "pull_request_review_id": 518911437,
      "id": 513627928,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzYyNzkyOA==",
      "diff_hunk": "@@ -1994,11 +1999,30 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             if (nTries > 100)\n                 break;\n \n-            CAddrInfo addr = addrman.SelectTriedCollision();\n+            CAddrInfo addr;\n \n-            // SelectTriedCollision returns an invalid address if it is empty.\n-            if (!fFeeler || !addr.IsValid()) {\n-                addr = addrman.Select(fFeeler);\n+            if (fFeeler) {\n+                // First, try to get a tried table collision address. This returns\n+                // an empty (invalid) address if there are no collisions to try.\n+                addr = addrman.SelectTriedCollision();\n+\n+                if (!addr.IsValid()) {\n+                    // No tried table collisions. Select a new table address\n+                    // for our feeler.\n+                    addr = addrman.Select(true);\n+                } else if (AlreadyConnectedToAddress(addr)) {\n+                    // If test-before-evict logic would have us connect to a\n+                    // peer that we're already connected to, just mark that\n+                    // address as Good(). We won't be able to initiate the\n+                    // connection anyway, so this avoids inadvertently evicting\n+                    // a currently-connected peer.\n+                    addrman.Good(addr);\n+                    // Select a new table address for our feeler instead.\n+                    addr = addrman.Select(true);\n+                }",
      "path": "src/net.cpp",
      "position": 40,
      "original_position": 40,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Commented this here for my own understanding while parsing the changed logic in 16d9bfc4172b4f6ce2.\r\n```diff\r\n-                }\r\n+                } // Otherwise, keep the selected addr if we have a tried\r\n+                  // collision we're not already connected to.\r\n```\r\n",
      "created_at": "2020-10-28T17:23:11Z",
      "updated_at": "2020-10-28T17:24:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r513627928",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/513627928"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2022,
      "original_line": 2022,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/513833238",
      "pull_request_review_id": 519184547,
      "id": 513833238,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzgzMzIzOA==",
      "diff_hunk": "@@ -1999,11 +1999,30 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             if (nTries > 100)\n                 break;\n \n-            CAddrInfo addr = addrman.SelectTriedCollision();\n+            CAddrInfo addr;\n \n-            // SelectTriedCollision returns an invalid address if it is empty.\n-            if (!fFeeler || !addr.IsValid()) {\n-                addr = addrman.Select(fFeeler);",
      "path": "src/net.cpp",
      "position": 21,
      "original_position": 9,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Very happy to see this rewritten. The logic where we always called `SelectTriedCollision` and then throw out the result if `!fFeeler` was very confusing (and inefficient...).",
      "created_at": "2020-10-29T00:06:09Z",
      "updated_at": "2020-10-29T00:08:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r513833238",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/513833238"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2001,
      "original_line": 2006,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/514646785",
      "pull_request_review_id": 520249261,
      "id": 514646785,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDY0Njc4NQ==",
      "diff_hunk": "@@ -854,7 +855,8 @@ void PeerManager::FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) {\n     if (state->fSyncStarted)\n         nSyncStarted--;\n \n-    if (misbehavior == 0 && state->fCurrentlyConnected) {\n+    if (misbehavior == 0 && state->fCurrentlyConnected && !node.IsBlockOnlyConn()) {\n+        // Note: we avoid changing visible addrman state for block-relay-only peers",
      "path": "src/net_processing.cpp",
      "position": 16,
      "original_position": 16,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "daf55531260833d597ee599e2d289ea1be0b1d9c",
      "in_reply_to_id": null,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I would mention the reference to anchors you made in PR description. Otherwise, I don't think this change is that much valuable if we had only non-persistent block-relay peers. I don't see how learning a past connection would significantly help an attacker to disrupt them further in the future, `CAddrInfo.nTime` isn't considered by `AddrMan::Select` ?\r\n\r\nNote, maybe we should rename `AddrMan::Connected` to `HasBeenConnected`, current comment \"Mark an entry as _currently_-connected to\" is confusing.",
      "created_at": "2020-10-30T00:48:45Z",
      "updated_at": "2020-10-30T02:20:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r514646785",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/514646785"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 859,
      "original_line": 859,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/514692064",
      "pull_request_review_id": 520249261,
      "id": 514692064,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDY5MjA2NA==",
      "diff_hunk": "@@ -348,6 +348,11 @@ CNode* CConnman::FindNode(const CService& addr)\n     return nullptr;\n }\n \n+bool CConnman::AlreadyConnectedToPeer(const CAddress& addr)\n+{\n+    return FindNode(static_cast<CNetAddr>(addr)) || FindNode(addr.ToStringIPPort());",
      "path": "src/net.cpp",
      "position": 6,
      "original_position": 6,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": 511847746,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "If the peer connection is initiated based on hostname (e.g `-seednode`, `-addnode`) we have to resolve first the provided hostname to obtain the addr (in `ConnectNode`).  If we succeed this resolution, we store the hostname (`MaybeSetAddrName`). In case of future connection also from hostname (`OpenNetworkConnection` with `pszDest != null`), for already-open connection check step, search is done on this subset (L2191).\r\n\r\nBased on this observation,  the second lookup with string appears as redundant, as each connected peer must be in findable by `CNetAddr`. \r\n\r\nThat said, I agree it doesn't change behavior.",
      "created_at": "2020-10-30T01:56:16Z",
      "updated_at": "2020-10-30T02:20:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r514692064",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/514692064"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 359,
      "original_line": 359,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/514721020",
      "pull_request_review_id": 520337667,
      "id": 514721020,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDcyMTAyMA==",
      "diff_hunk": "@@ -348,6 +348,11 @@ CNode* CConnman::FindNode(const CService& addr)\n     return nullptr;\n }\n \n+bool CConnman::AlreadyConnectedToPeer(const CAddress& addr)\n+{\n+    return FindNode(static_cast<CNetAddr>(addr)) || FindNode(addr.ToStringIPPort());",
      "path": "src/net.cpp",
      "position": 6,
      "original_position": 6,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": 511847746,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@ariard If there is a name proxy, we never resolve ourselves, and instead make a proxy connection to the specified name (by asking the proxy to do the resolving for us). In that case there is no `CNetAddr` known.",
      "created_at": "2020-10-30T02:27:25Z",
      "updated_at": "2020-10-30T02:27:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r514721020",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/514721020"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 359,
      "original_line": 359,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/514746020",
      "pull_request_review_id": 520344955,
      "id": 514746020,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDc0NjAyMA==",
      "diff_hunk": "@@ -348,6 +348,11 @@ CNode* CConnman::FindNode(const CService& addr)\n     return nullptr;\n }\n \n+bool CConnman::AlreadyConnectedToPeer(const CAddress& addr)\n+{\n+    return FindNode(static_cast<CNetAddr>(addr)) || FindNode(addr.ToStringIPPort());",
      "path": "src/net.cpp",
      "position": 6,
      "original_position": 6,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": 511847746,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@sipa But `CAddress& addr` is a `CNetAddr` and `addr.ToStringIPPort()` generates a string from the `CNetAddr` member variables? As far as I can see there's no way to initialise `CNetAddr::m_addr` to something like `::1` or `0:0:0:0:0:0:0:1` which would be disambiguated by converting to a canonical string?",
      "created_at": "2020-10-30T02:53:17Z",
      "updated_at": "2020-10-30T02:53:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r514746020",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/514746020"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 359,
      "original_line": 359,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/514747385",
      "pull_request_review_id": 520345355,
      "id": 514747385,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDc0NzM4NQ==",
      "diff_hunk": "@@ -348,6 +348,11 @@ CNode* CConnman::FindNode(const CService& addr)\n     return nullptr;\n }\n \n+bool CConnman::AlreadyConnectedToPeer(const CAddress& addr)\n+{\n+    return FindNode(static_cast<CNetAddr>(addr)) || FindNode(addr.ToStringIPPort());",
      "path": "src/net.cpp",
      "position": 6,
      "original_position": 6,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": 511847746,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Oh, right. What I said isn't relevant here.",
      "created_at": "2020-10-30T02:54:41Z",
      "updated_at": "2020-10-30T02:54:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r514747385",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/514747385"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 359,
      "original_line": 359,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515137714",
      "pull_request_review_id": 520720764,
      "id": 515137714,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTEzNzcxNA==",
      "diff_hunk": "@@ -854,7 +855,8 @@ void PeerManager::FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) {\n     if (state->fSyncStarted)\n         nSyncStarted--;\n \n-    if (misbehavior == 0 && state->fCurrentlyConnected) {\n+    if (misbehavior == 0 && state->fCurrentlyConnected && !node.IsBlockOnlyConn()) {\n+        // Note: we avoid changing visible addrman state for block-relay-only peers",
      "path": "src/net_processing.cpp",
      "position": 16,
      "original_position": 16,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "daf55531260833d597ee599e2d289ea1be0b1d9c",
      "in_reply_to_id": 514646785,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> I would mention the reference to anchors you made in PR description. Otherwise, I don't think this change is that much valuable if we had only non-persistent block-relay peers. I don't see how learning a past connection would significantly help an attacker to disrupt them further in the future, CAddrInfo.nTime isn't considered by AddrMan::Select ?\r\n\r\nPerhaps it doesn't, but I think if we left addrman truly unchanged by block-relay-only peers then that would _definitely_ mean that we can't leak topology information via addrman.  I reversed my view on whether we should call `Good()` for these peers after realizing we didn't have machinery in place to prevent addrman eviction and it seemed like that could happen too easily (and actually more easily for long-lived block-relay-only peer connections, because their timestamps could never update), but if we did come up with an auxiliary data structure for remembering block-relay-only peers (perhaps, just by making the anchor connections data structure more robust to temporarily losing connectivity) then I might argue again that we should switch the way we do things in the future to try to make these connections not interact with addrman whatsoever.  You could imagine for instance having a separate, smaller \"block-relay-addrman\" that samples from the main addrman whenever it needs more addresses but otherwise has its own eviction rules and never shares its state through any externally probable interface.\r\n\r\nSo philosophically I still think no interaction should be our default way of thinking, and an exception to that is being proposed in this PR because I don't have a better alternative right now.  But I would hate for someone to later argue that it's somehow safe to make these addrman calls because we don't know of an information leak -- the point is to isolate this part of the p2p protocol so there can't be an information leak, even one we haven't thought of.  (Leaving this call to `Connected()` on these peer addresses in the first place was a big oversight in #15759, in my opinion.)",
      "created_at": "2020-10-30T14:27:50Z",
      "updated_at": "2020-10-30T14:27:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r515137714",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515137714"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 859,
      "original_line": 859,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515236277",
      "pull_request_review_id": 520852711,
      "id": 515236277,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIzNjI3Nw==",
      "diff_hunk": "@@ -854,7 +855,8 @@ void PeerManager::FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) {\n     if (state->fSyncStarted)\n         nSyncStarted--;\n \n-    if (misbehavior == 0 && state->fCurrentlyConnected) {\n+    if (misbehavior == 0 && state->fCurrentlyConnected && !node.IsBlockOnlyConn()) {",
      "path": "src/net_processing.cpp",
      "position": 15,
      "original_position": 15,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This line confused me into thinking that `addrman::Connected()` could also be called for inbound peers on disconnection - which would be not ideal, because then our peer might be leaking the information about our long-term blocks-only connections by updating `nTime` on their side of the connection.\r\n\r\nHowever, if I read the code correctly, `fCurrentlyConnected`, despite its name, actually rather tracks whether it is an sucessfully connected outbound connection, so that this is not an issue (although keeping a flag for that does not seem necessary).",
      "created_at": "2020-10-30T16:50:13Z",
      "updated_at": "2020-10-30T17:11:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r515236277",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515236277"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 858,
      "original_line": 858,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515276256",
      "pull_request_review_id": 520902161,
      "id": 515276256,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI3NjI1Ng==",
      "diff_hunk": "@@ -854,7 +855,8 @@ void PeerManager::FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) {\n     if (state->fSyncStarted)\n         nSyncStarted--;\n \n-    if (misbehavior == 0 && state->fCurrentlyConnected) {\n+    if (misbehavior == 0 && state->fCurrentlyConnected && !node.IsBlockOnlyConn()) {",
      "path": "src/net_processing.cpp",
      "position": 15,
      "original_position": 15,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "in_reply_to_id": 515236277,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yes, you're exactly right. See https://github.com/bitcoin/bitcoin/pull/20187#discussion_r511795306.\r\n\r\nIt'd be great to consolidate the `pfrom.IsInboundConn()` check here too. That could easily be done as a follow up, eliminating `fCurrentlyConnected` entirely (and using `fSuccessfullyConnected` to check that the version handshake is complete).",
      "created_at": "2020-10-30T17:47:26Z",
      "updated_at": "2020-10-30T17:47:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r515276256",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515276256"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 858,
      "original_line": 858,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515567688",
      "pull_request_review_id": 521188263,
      "id": 515567688,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU2NzY4OA==",
      "diff_hunk": "@@ -854,7 +855,8 @@ void PeerManager::FinalizeNode(NodeId nodeid, bool& fUpdateConnectionTime) {\n     if (state->fSyncStarted)\n         nSyncStarted--;\n \n-    if (misbehavior == 0 && state->fCurrentlyConnected) {\n+    if (misbehavior == 0 && state->fCurrentlyConnected && !node.IsBlockOnlyConn()) {\n+        // Note: we avoid changing visible addrman state for block-relay-only peers",
      "path": "src/net_processing.cpp",
      "position": 16,
      "original_position": 16,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "daf55531260833d597ee599e2d289ea1be0b1d9c",
      "in_reply_to_id": 514646785,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> So philosophically I still think no interaction should be our default way of thinking, and an exception to that is being proposed in this PR because I don't have a better alternative right now. But I would hate for someone to later argue that it's somehow safe to make these addrman calls because we don't know of an information leak\r\n\r\nRight, I concede fixing the information leak in itself is valuable even if it's not currently exploitable by an attacker to interfere with our non-persistent block-relay peer selection. This one might change in the future and turn this leak as a more exploitable, without the timestamp relation being recollected.\r\n\r\nI agree it's a more temporary fix waiting to remove timestamps from addr messages as discussed during last p2p meeting. Going further, even assuming a separate, smaller \"block-relay-addrman\", I'm still concerned about the block-relay peers not participating in addr-relay compared to other peers, this fact which might observable in itself to break the hiddeness property of block-relay peers. E.g I was thinking about an adversary tweaking nServices to create a unique fingerprint and observe the absence of propagation on a presumed block-relay link to victim node. I guess isolating addr-relay on its own would make us all more confident, though it's a more complex, long-term change.",
      "created_at": "2020-11-01T02:54:33Z",
      "updated_at": "2020-11-01T02:56:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r515567688",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515567688"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 859,
      "original_line": 859,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515570640",
      "pull_request_review_id": 521189824,
      "id": 515570640,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU3MDY0MA==",
      "diff_hunk": "@@ -348,6 +348,11 @@ CNode* CConnman::FindNode(const CService& addr)\n     return nullptr;\n }\n \n+bool CConnman::AlreadyConnectedToPeer(const CAddress& addr)\n+{\n+    return FindNode(static_cast<CNetAddr>(addr)) || FindNode(addr.ToStringIPPort());",
      "path": "src/net.cpp",
      "position": 6,
      "original_position": 6,
      "commit_id": "16d9bfc4172b4f6ce24a3cd1a1cfa3933cd26751",
      "original_commit_id": "dafde15cc04fbeb5851fa98fec34dd9f2a7e8420",
      "in_reply_to_id": 511847746,
      "user": {
        "login": "amitiuttarwar",
        "id": 1500952,
        "node_id": "MDQ6VXNlcjE1MDA5NTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/amitiuttarwar",
        "html_url": "https://github.com/amitiuttarwar",
        "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
        "following_url": "https://api.github.com/users/amitiuttarwar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/amitiuttarwar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/amitiuttarwar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
        "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
        "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
        "events_url": "https://api.github.com/users/amitiuttarwar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@sipa, so do you agree having the two lookups seems redundant? or am I missing something?",
      "created_at": "2020-11-01T03:39:05Z",
      "updated_at": "2020-11-02T19:00:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20187#discussion_r515570640",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/515570640"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20187"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 359,
      "original_line": 359,
      "side": "RIGHT"
    }
  ]
}