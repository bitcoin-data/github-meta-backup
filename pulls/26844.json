{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26844",
    "id": 1189469546,
    "node_id": "PR_kwDOABII585G5d1q",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/26844",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/26844.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/26844.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26844",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26844/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26844/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26844/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/691eaf8873fe2f189153ca637506a0291504c97a",
    "number": 26844,
    "state": "closed",
    "locked": false,
    "maintainer_can_modify": false,
    "title": "Net: Pass `MSG_MORE` flag when sending non-final network messages (round 2)",
    "user": {
      "login": "whitslack",
      "id": 797782,
      "node_id": "MDQ6VXNlcjc5Nzc4Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/797782?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/whitslack",
      "html_url": "https://github.com/whitslack",
      "followers_url": "https://api.github.com/users/whitslack/followers",
      "following_url": "https://api.github.com/users/whitslack/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/whitslack/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/whitslack/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/whitslack/subscriptions",
      "organizations_url": "https://api.github.com/users/whitslack/orgs",
      "repos_url": "https://api.github.com/users/whitslack/repos",
      "events_url": "https://api.github.com/users/whitslack/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/whitslack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "**N.B.:** This is my second attempt at introducing this optimization. #12519 (2018) was closed in deference to switching to doing gathering socket writes using `sendmsg(2)`, which I agree would have superior performance due to fewer syscalls, but that work was apparently abandoned in late 2018. Ever since, Bitcoin Core has continued writing tons of runt packets to the wire. Can we proceed with my halfway solution for now?\r\n\r\n----\r\n\r\nSince Nagle's algorithm is disabled, each and every call to `send(2)` can potentially generate a separate TCP segment on the wire. This is especially inefficient when sending the tiny header preceding each message payload.\r\n\r\nLinux implements a `MSG_MORE` flag that tells the kernel not to push the passed data immediately to the connected peer but rather to collect it in the socket's internal transmit buffer where it can be combined with data from successive calls to `send(2)`. Where available, specify this flag when calling `send(2)` in `CConnman::SocketSendData(CNode &)` if the data buffer being sent is not the last one in `node.vSendMsg`.",
    "labels": [
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      }
    ],
    "milestone": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/56",
      "html_url": "https://github.com/bitcoin/bitcoin/milestone/56",
      "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/56/labels",
      "id": 7733968,
      "node_id": "MI_kwDOABII584AdgLQ",
      "number": 56,
      "state": "closed",
      "title": "25.0",
      "description": "",
      "creator": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "open_issues": 0,
      "closed_issues": 38,
      "created_at": "2022-03-03T18:51:29Z",
      "updated_at": "2023-05-25T13:24:42Z",
      "closed_at": "2023-05-25T13:24:42Z"
    },
    "created_at": "2023-01-07T19:09:11Z",
    "updated_at": "2023-02-15T16:11:02Z",
    "closed_at": "2023-02-15T16:11:01Z",
    "mergeable_state": "unknown",
    "merged_at": "2023-02-15T16:11:01Z",
    "merge_commit_sha": "5ecd14a31cad496e58fbc4aca9af0e9a001689d5",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "head": {
      "label": "whitslack:MSG_MORE",
      "ref": "MSG_MORE",
      "sha": "691eaf8873fe2f189153ca637506a0291504c97a",
      "user": {
        "login": "whitslack",
        "id": 797782,
        "node_id": "MDQ6VXNlcjc5Nzc4Mg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/797782?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/whitslack",
        "html_url": "https://github.com/whitslack",
        "followers_url": "https://api.github.com/users/whitslack/followers",
        "following_url": "https://api.github.com/users/whitslack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/whitslack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/whitslack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/whitslack/subscriptions",
        "organizations_url": "https://api.github.com/users/whitslack/orgs",
        "repos_url": "https://api.github.com/users/whitslack/repos",
        "events_url": "https://api.github.com/users/whitslack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/whitslack/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 122662853,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMjI2NjI4NTM=",
        "name": "bitcoin",
        "full_name": "whitslack/bitcoin",
        "owner": {
          "login": "whitslack",
          "id": 797782,
          "node_id": "MDQ6VXNlcjc5Nzc4Mg==",
          "avatar_url": "https://avatars.githubusercontent.com/u/797782?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/whitslack",
          "html_url": "https://github.com/whitslack",
          "followers_url": "https://api.github.com/users/whitslack/followers",
          "following_url": "https://api.github.com/users/whitslack/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/whitslack/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/whitslack/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/whitslack/subscriptions",
          "organizations_url": "https://api.github.com/users/whitslack/orgs",
          "repos_url": "https://api.github.com/users/whitslack/repos",
          "events_url": "https://api.github.com/users/whitslack/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/whitslack/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/whitslack/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/whitslack/bitcoin",
        "archive_url": "https://api.github.com/repos/whitslack/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/whitslack/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/whitslack/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/whitslack/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/whitslack/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/whitslack/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/whitslack/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/whitslack/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/whitslack/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/whitslack/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/whitslack/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/whitslack/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/whitslack/bitcoin/events",
        "forks_url": "https://api.github.com/repos/whitslack/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/whitslack/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/whitslack/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/whitslack/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/whitslack/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/whitslack/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/whitslack/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/whitslack/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/whitslack/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/whitslack/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/whitslack/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/whitslack/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/whitslack/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/whitslack/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/whitslack/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/whitslack/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:whitslack/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/whitslack/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/whitslack/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/whitslack/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/whitslack/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/whitslack/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/whitslack/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/whitslack/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/whitslack/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/whitslack/bitcoin/hooks",
        "svn_url": "https://github.com/whitslack/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 0,
        "watchers_count": 0,
        "size": 180725,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-01-07T19:11:32Z",
        "created_at": "2018-02-23T19:18:18Z",
        "updated_at": "2018-08-21T19:00:07Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "adc41cf3b22f8f168e88ce3ad5f27c1130f12beb",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 34325,
        "stargazers_count": 69818,
        "watchers_count": 69818,
        "size": 233879,
        "default_branch": "master",
        "open_issues_count": 626,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-07T07:29:24Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-06-07T06:49:43Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26844"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 7,
    "deletions": 1,
    "changed_files": 1,
    "commits": 1,
    "review_comments": 16,
    "comments": 7
  },
  "events": [
    {
      "event": "commented",
      "id": 1374578364,
      "node_id": "IC_kwDOABII585R7ma8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1374578364",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-07T19:09:13Z",
      "updated_at": "2023-02-10T15:24:17Z",
      "author_association": "MEMBER",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [vasild](https://github.com/bitcoin/bitcoin/pull/26844#pullrequestreview-1291290148), [sipa](https://github.com/bitcoin/bitcoin/pull/26844#issuecomment-1425963524) |\n\nIf your review is incorrectly listed, please react with 👎 to this comment and the bot will ignore it on the next update.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26844#issuecomment-1374578364",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26844"
    },
    {
      "event": "labeled",
      "id": 8175258813,
      "node_id": "LE_lADOABII585a14TczwAAAAHnSIy9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8175258813",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-07T19:09:15Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDY5MWVhZjg4NzNmZTJmMTg5MTUzY2E2Mzc1MDZhMDI5MTUwNGM5N2E",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/691eaf8873fe2f189153ca637506a0291504c97a",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/691eaf8873fe2f189153ca637506a0291504c97a",
      "tree": {
        "sha": "5a84f6e19fc250d9d710630c300049b0cf50ce4f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5a84f6e19fc250d9d710630c300049b0cf50ce4f"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c41a1162ac4da437c5d755e8fe2bf636bed22b0f",
          "sha": "c41a1162ac4da437c5d755e8fe2bf636bed22b0f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/c41a1162ac4da437c5d755e8fe2bf636bed22b0f"
        }
      ],
      "message": "Pass MSG_MORE flag when sending non-final network messages\n\nSince Nagle's algorithm is disabled, each and every call to send(2) can potentially generate a separate TCP segment on the wire. This is especially inefficient when sending the tiny header preceding each message payload.\n\nLinux implements a MSG_MORE flag that tells the kernel not to push the passed data immediately to the connected peer but rather to collect it in the socket's internal transmit buffer where it can be combined with data from successive calls to send(2). Where available, specify this flag when calling send(2) in CConnman::SocketSendData(CNode &) if the data buffer being sent is not the last one in node.vSendMsg.",
      "committer": {
        "name": "Matt Whitlock",
        "email": "bitcoin@mattwhitlock.name",
        "date": "2023-01-07T19:11:07Z"
      },
      "author": {
        "name": "Matt Whitlock",
        "email": "bitcoin@mattwhitlock.name",
        "date": "2018-02-23T19:02:37Z"
      },
      "sha": "691eaf8873fe2f189153ca637506a0291504c97a"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 8175262489,
      "node_id": "HRFPE_lADOABII585a14TczwAAAAHnSJsZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8175262489",
      "actor": {
        "login": "whitslack",
        "id": 797782,
        "node_id": "MDQ6VXNlcjc5Nzc4Mg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/797782?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/whitslack",
        "html_url": "https://github.com/whitslack",
        "followers_url": "https://api.github.com/users/whitslack/followers",
        "following_url": "https://api.github.com/users/whitslack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/whitslack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/whitslack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/whitslack/subscriptions",
        "organizations_url": "https://api.github.com/users/whitslack/orgs",
        "repos_url": "https://api.github.com/users/whitslack/repos",
        "events_url": "https://api.github.com/users/whitslack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/whitslack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-07T19:11:36Z"
    },
    {
      "event": "commented",
      "id": 1384310255,
      "node_id": "IC_kwDOABII585SguXv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1384310255",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-16T16:44:05Z",
      "updated_at": "2023-01-16T16:44:05Z",
      "author_association": "MEMBER",
      "body": "At a first glance I would ask why we can't do what was suggested here: https://github.com/bitcoin/bitcoin/pull/12519#issuecomment-368118017, if that is preferable? At least back then, it sounded like we could just pick https://github.com/bitcoin/bitcoin/commit/77cee166e17e355306d2ca1a1d360e71c12d8350 without the more involved changes in https://github.com/bitcoin/bitcoin/pull/11227. (Not advocating against your change, just wondering why you have chosen to go with the less preferable version when both seem technically possible)\r\n\r\nAlso pinging @vasild who would likely be a good reviewer for this.",
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26844#issuecomment-1384310255",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26844"
    },
    {
      "event": "mentioned",
      "id": 8238637602,
      "node_id": "MEE_lADOABII585a14TczwAAAAHrD6Ii",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8238637602",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-16T16:44:05Z"
    },
    {
      "event": "subscribed",
      "id": 8238637612,
      "node_id": "SE_lADOABII585a14TczwAAAAHrD6Is",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8238637612",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-16T16:44:05Z"
    },
    {
      "event": "commented",
      "id": 1384532618,
      "node_id": "IC_kwDOABII585ShkqK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1384532618",
      "actor": {
        "login": "whitslack",
        "id": 797782,
        "node_id": "MDQ6VXNlcjc5Nzc4Mg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/797782?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/whitslack",
        "html_url": "https://github.com/whitslack",
        "followers_url": "https://api.github.com/users/whitslack/followers",
        "following_url": "https://api.github.com/users/whitslack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/whitslack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/whitslack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/whitslack/subscriptions",
        "organizations_url": "https://api.github.com/users/whitslack/orgs",
        "repos_url": "https://api.github.com/users/whitslack/repos",
        "events_url": "https://api.github.com/users/whitslack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/whitslack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-16T20:43:15Z",
      "updated_at": "2023-01-16T20:43:15Z",
      "author_association": "CONTRIBUTOR",
      "body": "> just wondering why you have chosen to go with the less preferable version when both seem technically possible\r\n\r\nBecause my change is tiny, and that other change is involved. I want the change to actually be merged, not bike-shedded indefinitely. Smaller changes are easier to validate.",
      "user": {
        "login": "whitslack",
        "id": 797782,
        "node_id": "MDQ6VXNlcjc5Nzc4Mg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/797782?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/whitslack",
        "html_url": "https://github.com/whitslack",
        "followers_url": "https://api.github.com/users/whitslack/followers",
        "following_url": "https://api.github.com/users/whitslack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/whitslack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/whitslack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/whitslack/subscriptions",
        "organizations_url": "https://api.github.com/users/whitslack/orgs",
        "repos_url": "https://api.github.com/users/whitslack/repos",
        "events_url": "https://api.github.com/users/whitslack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/whitslack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26844#issuecomment-1384532618",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26844"
    },
    {
      "event": "reviewed",
      "id": 1274703060,
      "node_id": "PRR_kwDOABII585L-mzU",
      "url": null,
      "actor": null,
      "commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Would be nice to demonstrate that this actually brings some benefit and is not just code clutter.\r\nMaybe compare `tcpdump` output with and without this patch?",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26844#pullrequestreview-1274703060",
      "submitted_at": "2023-01-30T08:59:50Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26844"
    },
    {
      "event": "commented",
      "id": 1409085758,
      "node_id": "IC_kwDOABII585T_PE-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1409085758",
      "actor": {
        "login": "whitslack",
        "id": 797782,
        "node_id": "MDQ6VXNlcjc5Nzc4Mg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/797782?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/whitslack",
        "html_url": "https://github.com/whitslack",
        "followers_url": "https://api.github.com/users/whitslack/followers",
        "following_url": "https://api.github.com/users/whitslack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/whitslack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/whitslack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/whitslack/subscriptions",
        "organizations_url": "https://api.github.com/users/whitslack/orgs",
        "repos_url": "https://api.github.com/users/whitslack/repos",
        "events_url": "https://api.github.com/users/whitslack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/whitslack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-30T18:09:06Z",
      "updated_at": "2023-01-30T18:09:06Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Would be nice to demonstrate that this actually brings some benefit and is not just code clutter. Maybe compare `tcpdump` output with and without this patch?\r\n\r\n`tcpdump` is what originally alerted me to the presence of this anti-pattern in Bitcoin Core years ago. It was the reason I looked into the code and opened my original PR to address the problem.\r\n\r\nI'd like someone else with experience in low-level network I/O programming to comment before I'd go to the effort to produce \"proof\" of the merits of using `MSG_MORE`. That flag does exist for good reason.",
      "user": {
        "login": "whitslack",
        "id": 797782,
        "node_id": "MDQ6VXNlcjc5Nzc4Mg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/797782?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/whitslack",
        "html_url": "https://github.com/whitslack",
        "followers_url": "https://api.github.com/users/whitslack/followers",
        "following_url": "https://api.github.com/users/whitslack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/whitslack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/whitslack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/whitslack/subscriptions",
        "organizations_url": "https://api.github.com/users/whitslack/orgs",
        "repos_url": "https://api.github.com/users/whitslack/repos",
        "events_url": "https://api.github.com/users/whitslack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/whitslack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26844#issuecomment-1409085758",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26844"
    },
    {
      "event": "commented",
      "id": 1409105351,
      "node_id": "IC_kwDOABII585T_T3H",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1409105351",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-30T18:21:34Z",
      "updated_at": "2023-01-30T18:21:34Z",
      "author_association": "MEMBER",
      "body": "Concept ACK.\r\n\r\nUnless someone is actively pursuing a PR to switch to gathering writes, I don't see any reason not to start using `MSG_MORE` if it's known to be beneficial.\r\n\r\nI also find the justification that this will never do something undesirable fairly convincing.\r\n\r\n",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26844#issuecomment-1409105351",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26844"
    },
    {
      "event": "commented",
      "id": 1410469072,
      "node_id": "IC_kwDOABII585UEgzQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1410469072",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-31T14:35:30Z",
      "updated_at": "2023-01-31T14:35:30Z",
      "author_association": "MEMBER",
      "body": "Concept ACK\r\n\r\nBelow is some basic demonstration of `MSG_MORE` (tldr - it works!). The logs show how `send(2)` is called and there is the relevant `tcpdump(1)` output. This is during the initial handshake up to and including `verack`.\r\n\r\nmaster\r\n---\r\n```\r\ncalling Send(24) without MSG_MORE\r\ncalling Send(103) without MSG_MORE\r\ncalling Send(24) without MSG_MORE\r\ncalling Send(24) without MSG_MORE\r\ncalling Send(24) without MSG_MORE\r\n```\r\n\r\ntcpdump:\r\n```\r\nIP master.17807 > random_node.8333: Flags [S], seq 950983330, win 64240, options [mss 1420,sackOK,TS val 4155972266 ecr 0,nop,wscale 7], length 0\r\nIP master.17807 > random_node.8333: Flags [.], ack 3334216285, win 502, options [nop,nop,TS val 4155972306 ecr 1548157682], length 0\r\n* IP master.17807 > random_node.8333: Flags [P.], seq 0:24, ack 1, win 502, options [nop,nop,TS val 4155972306 ecr 1548157682], length 24\r\n* IP master.17807 > random_node.8333: Flags [P.], seq 24:127, ack 1, win 502, options [nop,nop,TS val 4155972306 ecr 1548157682], length 103\r\nIP master.17807 > random_node.8333: Flags [.], ack 25, win 502, options [nop,nop,TS val 4155972356 ecr 1548157732], length 0\r\nIP master.17807 > random_node.8333: Flags [.], ack 128, win 502, options [nop,nop,TS val 4155972356 ecr 1548157732], length 0\r\nIP master.17807 > random_node.8333: Flags [.], ack 152, win 502, options [nop,nop,TS val 4155972356 ecr 1548157732], length 0\r\nIP master.17807 > random_node.8333: Flags [.], ack 176, win 502, options [nop,nop,TS val 4155972356 ecr 1548157732], length 0\r\nIP master.17807 > random_node.8333: Flags [P.], seq 127:151, ack 176, win 502, options [nop,nop,TS val 4155972356 ecr 1548157732], length 24\r\nIP master.17807 > random_node.8333: Flags [P.], seq 151:175, ack 176, win 502, options [nop,nop,TS val 4155972356 ecr 1548157732], length 24\r\nIP master.17807 > random_node.8333: Flags [P.], seq 175:199, ack 176, win 502, options [nop,nop,TS val 4155972357 ecr 1548157732], length 24\r\n```\r\n\r\nPR\r\n---\r\n```\r\n>>>> calling Send(24) with MSG_MORE\r\n>>>> calling Send(103) without MSG_MORE\r\n>>>> calling Send(24) without MSG_MORE\r\n>>>> calling Send(24) without MSG_MORE\r\n>>>> calling Send(24) without MSG_MORE\r\n```\r\n\r\ntcpdump:\r\n```\r\nIP pr.17827 > random_node.8333: Flags [S], seq 2038199236, win 64240, options [mss 1420,sackOK,TS val 4155323939 ecr 0,nop,wscale 7], length 0\r\nIP pr.17827 > random_node.8333: Flags [.], ack 3514299724, win 502, options [nop,nop,TS val 4155323980 ecr 4260101434], length 0\r\n* IP pr.17827 > random_node.8333: Flags [P.], seq 0:127, ack 1, win 502, options [nop,nop,TS val 4155324474 ecr 4260101434], length 127\r\nIP pr.17827 > random_node.8333: Flags [.], ack 128, win 502, options [nop,nop,TS val 4155324509 ecr 4260101964], length 0\r\nIP pr.17827 > random_node.8333: Flags [.], ack 152, win 502, options [nop,nop,TS val 4155324509 ecr 4260101964], length 0\r\nIP pr.17827 > random_node.8333: Flags [P.], seq 127:151, ack 152, win 502, options [nop,nop,TS val 4155324510 ecr 4260101964], length 24\r\nIP pr.17827 > random_node.8333: Flags [P.], seq 151:175, ack 176, win 502, options [nop,nop,TS val 4155324510 ecr 4260101964], length 24\r\nIP pr.17827 > random_node.8333: Flags [.], ack 200, win 502, options [nop,nop,TS val 4155324554 ecr 4260101974], length 0\r\nIP pr.17827 > random_node.8333: Flags [P.], seq 175:199, ack 200, win 502, options [nop,nop,TS val 4155324558 ecr 4260102014], length 24\r\n```\r\n\r\n(notice the `length` of the packets marked with *, at the end of each line).",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26844#issuecomment-1410469072",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26844"
    },
    {
      "event": "reviewed",
      "id": 1291290148,
      "node_id": "PRR_kwDOABII585M94Yk",
      "url": null,
      "actor": null,
      "commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK 691eaf8873fe2f189153ca637506a0291504c97a\r\n\r\nI think this is good to go as it is and the [above discussion](https://github.com/bitcoin/bitcoin/pull/26844#discussion_r1090324464) is not a blocker. It would be nice to get input from other reviewers on it.\r\n\r\nThanks!",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26844#pullrequestreview-1291290148",
      "submitted_at": "2023-02-09T14:41:55Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26844"
    },
    {
      "event": "commented",
      "id": 1425963524,
      "node_id": "IC_kwDOABII585U_noE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1425963524",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-10T15:24:14Z",
      "updated_at": "2023-02-10T16:15:22Z",
      "author_association": "MEMBER",
      "body": "ACK 691eaf8873fe2f189153ca637506a0291504c97a\r\n\r\nPost-BIP324 (#24545 etc), this is also a privacy issue (as hiding packet boundaries against passive observers is a design goal).",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26844#issuecomment-1425963524",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26844"
    },
    {
      "event": "milestoned",
      "id": 8504462359,
      "node_id": "MIE_lADOABII585a14TczwAAAAH658wX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8504462359",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-13T13:27:06Z",
      "milestone": {
        "title": "25.0"
      }
    },
    {
      "event": "merged",
      "id": 8527776408,
      "node_id": "ME_lADOABII585a14TczwAAAAH8S4qY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8527776408",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "5ecd14a31cad496e58fbc4aca9af0e9a001689d5",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5ecd14a31cad496e58fbc4aca9af0e9a001689d5",
      "created_at": "2023-02-15T16:11:01Z"
    },
    {
      "event": "closed",
      "id": 8527776484,
      "node_id": "CE_lADOABII585a14TczwAAAAH8S4rk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8527776484",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-15T16:11:01Z"
    },
    {
      "event": "referenced",
      "id": 8538462458,
      "node_id": "REFE_lADOABII585a14TczwAAAAH87pj6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8538462458",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "e7839eea4db4addc1f55bc50eb242cb453275635",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/e7839eea4db4addc1f55bc50eb242cb453275635",
      "created_at": "2023-02-16T15:47:04Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1090324464",
      "pull_request_review_id": 1274703060,
      "id": 1090324464,
      "node_id": "PRRC_kwDOABII585A_Qfw",
      "diff_hunk": "@@ -802,7 +802,13 @@ size_t CConnman::SocketSendData(CNode& node) const\n             if (!node.m_sock) {\n                 break;\n             }\n-            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, MSG_NOSIGNAL | MSG_DONTWAIT);\n+            int flags = MSG_NOSIGNAL | MSG_DONTWAIT;\n+#ifdef MSG_MORE\n+            if (it + 1 != node.vSendMsg.end()) {\n+                flags |= MSG_MORE;\n+            }\n+#endif\n+            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, flags);",
      "path": "src/net.cpp",
      "position": 11,
      "original_position": 11,
      "commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "original_commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "If this can't send the full message one of the two `break`s below will be executed which may result in this function returning with all `Send()` calls using `MSG_MORE`. For example: let there be 3 messages, 10 bytes each. `Send()` of the first one will use `MSG_MORE`, let it return 10 (full message sent). `Send()` of the second one will use `MSG_MORE`, let it return any number in [0..9]. Then this function will return, without ever calling `Send()` without `MSG_MORE` and the first message may remain buffered/unsent somewhere in the OS.\r\n\r\nI think this is unwanted effect, defeating `TCP_NODELAY` and the check `if (it + 1 != node.vSendMsg.end())`.\r\n\r\nI wonder if it is possible to tell the OS that we are done, without sending further data? Maybe `Send(nullptr, 0, MSG_NOSIGNAL | MSG_DONTWAIT); // without MSG_MORE` would do that?",
      "created_at": "2023-01-30T08:51:45Z",
      "updated_at": "2023-01-30T08:59:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26844#discussion_r1090324464",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1090324464"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26844"
        }
      },
      "start_line": 807,
      "original_start_line": 807,
      "start_side": "RIGHT",
      "line": 811,
      "original_line": 811,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1090965155",
      "pull_request_review_id": 1275670177,
      "id": 1090965155,
      "node_id": "PRRC_kwDOABII585BBs6j",
      "diff_hunk": "@@ -802,7 +802,13 @@ size_t CConnman::SocketSendData(CNode& node) const\n             if (!node.m_sock) {\n                 break;\n             }\n-            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, MSG_NOSIGNAL | MSG_DONTWAIT);\n+            int flags = MSG_NOSIGNAL | MSG_DONTWAIT;\n+#ifdef MSG_MORE\n+            if (it + 1 != node.vSendMsg.end()) {\n+                flags |= MSG_MORE;\n+            }\n+#endif\n+            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, flags);",
      "path": "src/net.cpp",
      "position": 11,
      "original_position": 11,
      "commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "original_commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "in_reply_to_id": 1090324464,
      "user": {
        "login": "whitslack",
        "id": 797782,
        "node_id": "MDQ6VXNlcjc5Nzc4Mg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/797782?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/whitslack",
        "html_url": "https://github.com/whitslack",
        "followers_url": "https://api.github.com/users/whitslack/followers",
        "following_url": "https://api.github.com/users/whitslack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/whitslack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/whitslack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/whitslack/subscriptions",
        "organizations_url": "https://api.github.com/users/whitslack/orgs",
        "repos_url": "https://api.github.com/users/whitslack/repos",
        "events_url": "https://api.github.com/users/whitslack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/whitslack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "If not all of our pending outgoing messages can fit in the socket's transmit buffer, then we *want* all of our calls to `send` to specify `MSG_MORE`. The kernel will immediately (without delay) transmit as many full segments as it can assemble and that will fit in the congestion window. It will not immediately transmit a partial segment but instead will call back to us (via returning a writable status from `select`, `poll`, `epoll`, etc.) to fetch more data to transmit. If we have no more data to transmit, then yes, calling `send` with a zero length and without `MSG_MORE` will tell the kernel that we have nothing left to send, and it will transmit a partial segment as soon as such segment will fit in the congestion window.\r\n\r\nIn your example, if the second of the three 10-byte messages can only partially be copied to the socket transmit buffer, then it must be the case that the transmit buffer is now full. The transmit buffer is always larger than MSS, the maximum segment size, meaning the kernel can now assemble a full segment, which it will transmit as soon as the window allows. It will then indicate the socket is writable again, and we will be called again to write more of the second message.\r\n\r\nSo, in short, your concern that we will unnecessarily delay transmitting data is unwarranted. The kernel never delays transmitting a full segment if it fits in the congestion window. The kernel does delay transmitting a partial segment that fits in the congestion window if the last call to `send` on that socket specified `MSG_MORE`, but that's exactly what we want, as we want the opportunity to write more data into the transmit buffer so the kernel will potentially transmit fewer and larger segments.",
      "created_at": "2023-01-30T17:58:35Z",
      "updated_at": "2023-01-30T17:58:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26844#discussion_r1090965155",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1090965155"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26844"
        }
      },
      "start_line": 807,
      "original_start_line": 807,
      "start_side": "RIGHT",
      "line": 811,
      "original_line": 811,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091828077",
      "pull_request_review_id": 1277036081,
      "id": 1091828077,
      "node_id": "PRRC_kwDOABII585BE_lt",
      "diff_hunk": "@@ -802,7 +802,13 @@ size_t CConnman::SocketSendData(CNode& node) const\n             if (!node.m_sock) {\n                 break;\n             }\n-            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, MSG_NOSIGNAL | MSG_DONTWAIT);\n+            int flags = MSG_NOSIGNAL | MSG_DONTWAIT;\n+#ifdef MSG_MORE\n+            if (it + 1 != node.vSendMsg.end()) {\n+                flags |= MSG_MORE;\n+            }\n+#endif\n+            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, flags);",
      "path": "src/net.cpp",
      "position": 11,
      "original_position": 11,
      "commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "original_commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "in_reply_to_id": 1090324464,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "If `send(2)` writes less bytes than requested, does it follow that the transmit buffer is full? I am not sure about that. Is it documented somewhere? What about a signal interrupting the send midway (or even before it started)? Is that not a case where `send(2)` writes less bytes than requested, but the transmit buffer is not full?",
      "created_at": "2023-01-31T12:00:24Z",
      "updated_at": "2023-01-31T12:00:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26844#discussion_r1091828077",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1091828077"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26844"
        }
      },
      "start_line": 807,
      "original_start_line": 807,
      "start_side": "RIGHT",
      "line": 811,
      "original_line": 811,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092388167",
      "pull_request_review_id": 1277887024,
      "id": 1092388167,
      "node_id": "PRRC_kwDOABII585BHIVH",
      "diff_hunk": "@@ -802,7 +802,13 @@ size_t CConnman::SocketSendData(CNode& node) const\n             if (!node.m_sock) {\n                 break;\n             }\n-            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, MSG_NOSIGNAL | MSG_DONTWAIT);\n+            int flags = MSG_NOSIGNAL | MSG_DONTWAIT;\n+#ifdef MSG_MORE\n+            if (it + 1 != node.vSendMsg.end()) {\n+                flags |= MSG_MORE;\n+            }\n+#endif\n+            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, flags);",
      "path": "src/net.cpp",
      "position": 11,
      "original_position": 11,
      "commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "original_commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "in_reply_to_id": 1090324464,
      "user": {
        "login": "whitslack",
        "id": 797782,
        "node_id": "MDQ6VXNlcjc5Nzc4Mg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/797782?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/whitslack",
        "html_url": "https://github.com/whitslack",
        "followers_url": "https://api.github.com/users/whitslack/followers",
        "following_url": "https://api.github.com/users/whitslack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/whitslack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/whitslack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/whitslack/subscriptions",
        "organizations_url": "https://api.github.com/users/whitslack/orgs",
        "repos_url": "https://api.github.com/users/whitslack/repos",
        "events_url": "https://api.github.com/users/whitslack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/whitslack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> What about a signal interrupting the send midway (or even before it started)?\r\n\r\nI'm pretty sure that's only possible if the socket is in blocking mode. But regardless, if `send` returns a short write due to invoking a signal handler, then the socket is still writable, and the user code will call `send` again without delay (i.e., on the next iteration of the I/O loop).",
      "created_at": "2023-01-31T19:31:22Z",
      "updated_at": "2023-01-31T19:31:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26844#discussion_r1092388167",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1092388167"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26844"
        }
      },
      "start_line": 807,
      "original_start_line": 807,
      "start_side": "RIGHT",
      "line": 811,
      "original_line": 811,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1094487011",
      "pull_request_review_id": 1280998131,
      "id": 1094487011,
      "node_id": "PRRC_kwDOABII585BPIvj",
      "diff_hunk": "@@ -802,7 +802,13 @@ size_t CConnman::SocketSendData(CNode& node) const\n             if (!node.m_sock) {\n                 break;\n             }\n-            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, MSG_NOSIGNAL | MSG_DONTWAIT);\n+            int flags = MSG_NOSIGNAL | MSG_DONTWAIT;\n+#ifdef MSG_MORE\n+            if (it + 1 != node.vSendMsg.end()) {\n+                flags |= MSG_MORE;\n+            }\n+#endif\n+            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, flags);",
      "path": "src/net.cpp",
      "position": 11,
      "original_position": 11,
      "commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "original_commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "in_reply_to_id": 1090324464,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "That would be after accepting new connections, sending, receiving and parsing messages from all other (possibly 100s) connections. I guess this would be rare and even when it happens would probably have no adverse effects on the communication, but I would feel more comfortable if this PR does not introduce that. If a dummy `Send()` without `MSG_MORE` before the two `break`s is a way to avoid that, then I think it should be added.",
      "created_at": "2023-02-02T12:50:52Z",
      "updated_at": "2023-02-02T12:50:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26844#discussion_r1094487011",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1094487011"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26844"
        }
      },
      "start_line": 807,
      "original_start_line": 807,
      "start_side": "RIGHT",
      "line": 811,
      "original_line": 811,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1094996625",
      "pull_request_review_id": 1281771404,
      "id": 1094996625,
      "node_id": "PRRC_kwDOABII585BRFKR",
      "diff_hunk": "@@ -802,7 +802,13 @@ size_t CConnman::SocketSendData(CNode& node) const\n             if (!node.m_sock) {\n                 break;\n             }\n-            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, MSG_NOSIGNAL | MSG_DONTWAIT);\n+            int flags = MSG_NOSIGNAL | MSG_DONTWAIT;\n+#ifdef MSG_MORE\n+            if (it + 1 != node.vSendMsg.end()) {\n+                flags |= MSG_MORE;\n+            }\n+#endif\n+            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, flags);",
      "path": "src/net.cpp",
      "position": 11,
      "original_position": 11,
      "commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "original_commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "in_reply_to_id": 1090324464,
      "user": {
        "login": "whitslack",
        "id": 797782,
        "node_id": "MDQ6VXNlcjc5Nzc4Mg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/797782?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/whitslack",
        "html_url": "https://github.com/whitslack",
        "followers_url": "https://api.github.com/users/whitslack/followers",
        "following_url": "https://api.github.com/users/whitslack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/whitslack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/whitslack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/whitslack/subscriptions",
        "organizations_url": "https://api.github.com/users/whitslack/orgs",
        "repos_url": "https://api.github.com/users/whitslack/repos",
        "events_url": "https://api.github.com/users/whitslack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/whitslack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In no case will the kernel hold onto a partial segment in the socket's transmit buffer for longer than 250 ms if the segment fits in the congestion window, so that's the maximum latency that could be introduced by writing a complete message with `MSG_MORE`, maxing out the transmit buffer while writing a subsequent message also with `MSG_MORE`, and then going off to do other things for a nigh eternity before coming back around.\r\n\r\nAnyway, I don't want to add *more* syscall overhead. I'd prefer to rewrite this to do gathering writes rather than adding yet another `send` call. If that's the only way you'll let this move forward, then I'll do that work, but then I'd expect that to be bike shedded for ages while people debate the merits of stack allocation versus heap allocation of the `struct iovec` array, platform agnosticism, abstraction leakage, readability and maintainability of code, and scope creep.",
      "created_at": "2023-02-02T19:31:41Z",
      "updated_at": "2023-02-02T19:31:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26844#discussion_r1094996625",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1094996625"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26844"
        }
      },
      "start_line": 807,
      "original_start_line": 807,
      "start_side": "RIGHT",
      "line": 811,
      "original_line": 811,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1101560639",
      "pull_request_review_id": 1291283955,
      "id": 1101560639,
      "node_id": "PRRC_kwDOABII585BqHs_",
      "diff_hunk": "@@ -802,7 +802,13 @@ size_t CConnman::SocketSendData(CNode& node) const\n             if (!node.m_sock) {\n                 break;\n             }\n-            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, MSG_NOSIGNAL | MSG_DONTWAIT);\n+            int flags = MSG_NOSIGNAL | MSG_DONTWAIT;\n+#ifdef MSG_MORE\n+            if (it + 1 != node.vSendMsg.end()) {\n+                flags |= MSG_MORE;\n+            }\n+#endif\n+            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, flags);",
      "path": "src/net.cpp",
      "position": 11,
      "original_position": 11,
      "commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "original_commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "in_reply_to_id": 1090324464,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> ... 250 ms ...\r\n\r\nThat seems like relying on an undocumented behavior (unless it is documented somewhere)? But anyway:\r\n\r\n> ... If that's the only way you'll let this move forward ...\r\n\r\nI am not blocking this. I did not NACK it. I guess if it gathers enough ACKs from other reviewers it will get merged. Actually, I do not think this is a blocker, it is more in the \"I would feel more comfortable\" category.\r\n\r\nI guess something like this would be nice:\r\n\r\n```diff\r\n--- i/src/net.cpp\r\n+++ w/src/net.cpp\r\n@@ -790,57 +790,67 @@ void V1TransportSerializer::prepareForTransport(CSerializedNetMsg& msg, std::vec\r\n \r\n size_t CConnman::SocketSendData(CNode& node) const\r\n {\r\n     auto it = node.vSendMsg.begin();\r\n     size_t nSentSize = 0;\r\n \r\n     while (it != node.vSendMsg.end()) {\r\n         const auto& data = *it;\r\n         assert(data.size() > node.nSendOffset);\r\n         int nBytes = 0;\r\n+        int flags = MSG_NOSIGNAL | MSG_DONTWAIT;\r\n         {\r\n             LOCK(node.cs_hSocket);\r\n             if (!node.m_sock) {\r\n                 break;\r\n             }\r\n-            int flags = MSG_NOSIGNAL | MSG_DONTWAIT;\r\n #ifdef MSG_MORE\r\n             if (it + 1 != node.vSendMsg.end()) {\r\n                 flags |= MSG_MORE;\r\n             }\r\n #endif\r\n             nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, flags);\r\n         }\r\n         if (nBytes > 0) {\r\n             node.m_last_send = GetTime<std::chrono::seconds>();\r\n             node.nSendBytes += nBytes;\r\n             node.nSendOffset += nBytes;\r\n             nSentSize += nBytes;\r\n             if (node.nSendOffset == data.size()) {\r\n                 node.nSendOffset = 0;\r\n                 node.nSendSize -= data.size();\r\n                 node.fPauseSend = node.nSendSize > nSendBufferMaxSize;\r\n                 it++;\r\n             } else {\r\n                 // could not send full message; stop sending more\r\n+#ifdef MSG_MORE\r\n+                if (flags & MSG_MORE) {\r\n+                    node.m_sock->Send(nullptr, 0, flags & ~MSG_MORE);\r\n+                }\r\n+#endif\r\n                 break;\r\n             }\r\n         } else {\r\n             if (nBytes < 0) {\r\n                 // error\r\n                 int nErr = WSAGetLastError();\r\n                 if (nErr != WSAEWOULDBLOCK && nErr != WSAEMSGSIZE && nErr != WSAEINTR && nErr != WSAEINPROGRESS) {\r\n                     LogPrint(BCLog::NET, \"socket send error for peer=%d: %s\\n\", node.GetId(), NetworkErrorString(nErr));\r\n                     node.CloseSocketDisconnect();\r\n                 }\r\n             }\r\n             // couldn't send anything at all\r\n+#ifdef MSG_MORE\r\n+            if (flags & MSG_MORE) {\r\n+                node.m_sock->Send(nullptr, 0, flags & ~MSG_MORE);\r\n+            }\r\n+#endif\r\n             break;\r\n         }\r\n     }\r\n \r\n     if (it == node.vSendMsg.end()) {\r\n         assert(node.nSendOffset == 0);\r\n         assert(node.nSendSize == 0);\r\n     }\r\n     node.vSendMsg.erase(node.vSendMsg.begin(), it);\r\n     return nSentSize;\r\n```",
      "created_at": "2023-02-09T14:39:04Z",
      "updated_at": "2023-02-09T14:39:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26844#discussion_r1101560639",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1101560639"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26844"
        }
      },
      "start_line": 807,
      "original_start_line": 807,
      "start_side": "RIGHT",
      "line": 811,
      "original_line": 811,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1101938318",
      "pull_request_review_id": 1291873225,
      "id": 1101938318,
      "node_id": "PRRC_kwDOABII585Brj6O",
      "diff_hunk": "@@ -802,7 +802,13 @@ size_t CConnman::SocketSendData(CNode& node) const\n             if (!node.m_sock) {\n                 break;\n             }\n-            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, MSG_NOSIGNAL | MSG_DONTWAIT);\n+            int flags = MSG_NOSIGNAL | MSG_DONTWAIT;\n+#ifdef MSG_MORE\n+            if (it + 1 != node.vSendMsg.end()) {\n+                flags |= MSG_MORE;\n+            }\n+#endif\n+            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, flags);",
      "path": "src/net.cpp",
      "position": 11,
      "original_position": 11,
      "commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "original_commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "in_reply_to_id": 1090324464,
      "user": {
        "login": "whitslack",
        "id": 797782,
        "node_id": "MDQ6VXNlcjc5Nzc4Mg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/797782?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/whitslack",
        "html_url": "https://github.com/whitslack",
        "followers_url": "https://api.github.com/users/whitslack/followers",
        "following_url": "https://api.github.com/users/whitslack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/whitslack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/whitslack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/whitslack/subscriptions",
        "organizations_url": "https://api.github.com/users/whitslack/orgs",
        "repos_url": "https://api.github.com/users/whitslack/repos",
        "events_url": "https://api.github.com/users/whitslack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/whitslack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> > ... 250 ms ...\r\n> \r\n> That seems like relying on an undocumented behavior (unless it is documented somewhere)?\r\n\r\nIt is documented. (It's actually 200 milliseconds. I misremembered.)\r\n\r\n[`sendmsg(2)`](https://linux.die.net/man/2/sendmsg) says:\r\n\r\n> **MSG_MORE** (Since Linux 2.4.4)\r\n> The caller has more data to send. This flag is used with TCP sockets to obtain the same effect as the **TCP_CORK** socket option (see `tcp(7)`), with the difference that this flag can be set on a per-call basis.\r\n\r\n[`tcp(7)`](https://linux.die.net/man/7/tcp) says:\r\n\r\n> **TCP_CORK** (since Linux 2.2)\r\n> If set, don't send out partial frames. All queued partial frames are sent when the option is cleared again. This is useful for prepending headers before calling `sendfile(2)`, or for throughput optimization. As currently implemented, there is a 200 millisecond ceiling on the time for which output is corked by **TCP_CORK**. If this ceiling is reached, then queued data is automatically transmitted.",
      "created_at": "2023-02-09T19:38:59Z",
      "updated_at": "2023-02-09T19:38:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26844#discussion_r1101938318",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1101938318"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26844"
        }
      },
      "start_line": 807,
      "original_start_line": 807,
      "start_side": "RIGHT",
      "line": 811,
      "original_line": 811,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1101955787",
      "pull_request_review_id": 1291905330,
      "id": 1101955787,
      "node_id": "PRRC_kwDOABII585BroLL",
      "diff_hunk": "@@ -802,7 +802,13 @@ size_t CConnman::SocketSendData(CNode& node) const\n             if (!node.m_sock) {\n                 break;\n             }\n-            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, MSG_NOSIGNAL | MSG_DONTWAIT);\n+            int flags = MSG_NOSIGNAL | MSG_DONTWAIT;\n+#ifdef MSG_MORE\n+            if (it + 1 != node.vSendMsg.end()) {\n+                flags |= MSG_MORE;\n+            }\n+#endif\n+            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, flags);",
      "path": "src/net.cpp",
      "position": 11,
      "original_position": 11,
      "commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "original_commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "in_reply_to_id": 1090324464,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I also can't imagine the timeout actually matters for us? The patch above (the one adding a send with empty non-`MSG_MORE`) only triggers in case a `send()` call managed to push fewer bytes than we tried to send. That must mean the send buffer is full, and thus there is no point why the kernel would need to wait anymore.",
      "created_at": "2023-02-09T19:58:55Z",
      "updated_at": "2023-02-09T19:58:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26844#discussion_r1101955787",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1101955787"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26844"
        }
      },
      "start_line": 807,
      "original_start_line": 807,
      "start_side": "RIGHT",
      "line": 811,
      "original_line": 811,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1101965025",
      "pull_request_review_id": 1291918735,
      "id": 1101965025,
      "node_id": "PRRC_kwDOABII585Brqbh",
      "diff_hunk": "@@ -802,7 +802,13 @@ size_t CConnman::SocketSendData(CNode& node) const\n             if (!node.m_sock) {\n                 break;\n             }\n-            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, MSG_NOSIGNAL | MSG_DONTWAIT);\n+            int flags = MSG_NOSIGNAL | MSG_DONTWAIT;\n+#ifdef MSG_MORE\n+            if (it + 1 != node.vSendMsg.end()) {\n+                flags |= MSG_MORE;\n+            }\n+#endif\n+            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, flags);",
      "path": "src/net.cpp",
      "position": 11,
      "original_position": 11,
      "commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "original_commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "in_reply_to_id": 1090324464,
      "user": {
        "login": "whitslack",
        "id": 797782,
        "node_id": "MDQ6VXNlcjc5Nzc4Mg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/797782?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/whitslack",
        "html_url": "https://github.com/whitslack",
        "followers_url": "https://api.github.com/users/whitslack/followers",
        "following_url": "https://api.github.com/users/whitslack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/whitslack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/whitslack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/whitslack/subscriptions",
        "organizations_url": "https://api.github.com/users/whitslack/orgs",
        "repos_url": "https://api.github.com/users/whitslack/repos",
        "events_url": "https://api.github.com/users/whitslack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/whitslack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The kernel will never wait to send full segments.  Vasil's concern is the case where we try to send a non-final message, run out of space in the kernel's transmit buffer (so only some of the message was copied in), then go off and do other things for a virtual eternity. If we haven't called `send` without `MSG_MORE`, then it is *possible* that there is a complete message sitting in the kernel's transmit buffer (ahead of the incomplete message that we failed to fully write) that will be delayed. That's true, but I'd say that's by design. If it's really taking us longer than 200 ms for the network I/O loop to make a full pass, we have much bigger problems!",
      "created_at": "2023-02-09T20:07:44Z",
      "updated_at": "2023-02-09T20:07:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26844#discussion_r1101965025",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1101965025"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26844"
        }
      },
      "start_line": 807,
      "original_start_line": 807,
      "start_side": "RIGHT",
      "line": 811,
      "original_line": 811,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1101976386",
      "pull_request_review_id": 1291930933,
      "id": 1101976386,
      "node_id": "PRRC_kwDOABII585BrtNC",
      "diff_hunk": "@@ -802,7 +802,13 @@ size_t CConnman::SocketSendData(CNode& node) const\n             if (!node.m_sock) {\n                 break;\n             }\n-            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, MSG_NOSIGNAL | MSG_DONTWAIT);\n+            int flags = MSG_NOSIGNAL | MSG_DONTWAIT;\n+#ifdef MSG_MORE\n+            if (it + 1 != node.vSendMsg.end()) {\n+                flags |= MSG_MORE;\n+            }\n+#endif\n+            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, flags);",
      "path": "src/net.cpp",
      "position": 11,
      "original_position": 11,
      "commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "original_commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "in_reply_to_id": 1090324464,
      "user": {
        "login": "whitslack",
        "id": 797782,
        "node_id": "MDQ6VXNlcjc5Nzc4Mg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/797782?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/whitslack",
        "html_url": "https://github.com/whitslack",
        "followers_url": "https://api.github.com/users/whitslack/followers",
        "following_url": "https://api.github.com/users/whitslack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/whitslack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/whitslack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/whitslack/subscriptions",
        "organizations_url": "https://api.github.com/users/whitslack/orgs",
        "repos_url": "https://api.github.com/users/whitslack/repos",
        "events_url": "https://api.github.com/users/whitslack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/whitslack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The (very reasonable) hope is that the network I/O loop comes back around to our socket to finish writing the incomplete message (and possibly more messages) before the kernel's transmit buffer has drained below the size of a full segment. In that case, there will be no artificial delay introduced to any message we've written to the socket.\r\n\r\nSo, basically, we want the network I/O loop to come back around to service our socket again in less time than the kernel's transmit buffer takes to drain.",
      "created_at": "2023-02-09T20:17:44Z",
      "updated_at": "2023-02-09T20:17:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26844#discussion_r1101976386",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1101976386"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26844"
        }
      },
      "start_line": 807,
      "original_start_line": 807,
      "start_side": "RIGHT",
      "line": 811,
      "original_line": 811,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1102403592",
      "pull_request_review_id": 1292588274,
      "id": 1102403592,
      "node_id": "PRRC_kwDOABII585BtVgI",
      "diff_hunk": "@@ -802,7 +802,13 @@ size_t CConnman::SocketSendData(CNode& node) const\n             if (!node.m_sock) {\n                 break;\n             }\n-            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, MSG_NOSIGNAL | MSG_DONTWAIT);\n+            int flags = MSG_NOSIGNAL | MSG_DONTWAIT;\n+#ifdef MSG_MORE\n+            if (it + 1 != node.vSendMsg.end()) {\n+                flags |= MSG_MORE;\n+            }\n+#endif\n+            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, flags);",
      "path": "src/net.cpp",
      "position": 11,
      "original_position": 11,
      "commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "original_commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "in_reply_to_id": 1090324464,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> It is documented\r\n\r\nEven better, thanks!",
      "created_at": "2023-02-10T08:01:40Z",
      "updated_at": "2023-02-10T08:01:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26844#discussion_r1102403592",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1102403592"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26844"
        }
      },
      "start_line": 807,
      "original_start_line": 807,
      "start_side": "RIGHT",
      "line": 811,
      "original_line": 811,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1102879526",
      "pull_request_review_id": 1293355514,
      "id": 1102879526,
      "node_id": "PRRC_kwDOABII585BvJsm",
      "diff_hunk": "@@ -802,7 +802,13 @@ size_t CConnman::SocketSendData(CNode& node) const\n             if (!node.m_sock) {\n                 break;\n             }\n-            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, MSG_NOSIGNAL | MSG_DONTWAIT);\n+            int flags = MSG_NOSIGNAL | MSG_DONTWAIT;\n+#ifdef MSG_MORE\n+            if (it + 1 != node.vSendMsg.end()) {\n+                flags |= MSG_MORE;\n+            }\n+#endif\n+            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, flags);",
      "path": "src/net.cpp",
      "position": 11,
      "original_position": 11,
      "commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "original_commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "in_reply_to_id": 1090324464,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks, I understand now.\r\n\r\nFWIW, I switched my (public, well-connected) node to (a rebased version of) this PR, together with @vasild's proposed patch above + logging whenever these empty non-`MSG_MORE` message would be sent.\r\n\r\nOn this node with ~250 connections, in 16 hours time, having uploaded 7.2 GB and downloaded 1.2 GB, 221 times a `MSG_MORE` was interrupted (always after sending some bytes, usually at least a few kB; never with having sent nothing).\r\n\r\n",
      "created_at": "2023-02-10T15:10:41Z",
      "updated_at": "2023-02-10T15:10:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26844#discussion_r1102879526",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1102879526"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26844"
        }
      },
      "start_line": 807,
      "original_start_line": 807,
      "start_side": "RIGHT",
      "line": 811,
      "original_line": 811,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1103046589",
      "pull_request_review_id": 1293694788,
      "id": 1103046589,
      "node_id": "PRRC_kwDOABII585Bvye9",
      "diff_hunk": "@@ -802,7 +802,13 @@ size_t CConnman::SocketSendData(CNode& node) const\n             if (!node.m_sock) {\n                 break;\n             }\n-            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, MSG_NOSIGNAL | MSG_DONTWAIT);\n+            int flags = MSG_NOSIGNAL | MSG_DONTWAIT;\n+#ifdef MSG_MORE\n+            if (it + 1 != node.vSendMsg.end()) {\n+                flags |= MSG_MORE;\n+            }\n+#endif\n+            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, flags);",
      "path": "src/net.cpp",
      "position": 11,
      "original_position": 11,
      "commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "original_commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "in_reply_to_id": 1090324464,
      "user": {
        "login": "whitslack",
        "id": 797782,
        "node_id": "MDQ6VXNlcjc5Nzc4Mg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/797782?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/whitslack",
        "html_url": "https://github.com/whitslack",
        "followers_url": "https://api.github.com/users/whitslack/followers",
        "following_url": "https://api.github.com/users/whitslack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/whitslack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/whitslack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/whitslack/subscriptions",
        "organizations_url": "https://api.github.com/users/whitslack/orgs",
        "repos_url": "https://api.github.com/users/whitslack/repos",
        "events_url": "https://api.github.com/users/whitslack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/whitslack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> 221 times a `MSG_MORE` was interrupted\r\n\r\nI think what you may have meant was that a `send` call indicated that fewer bytes were copied than were requested, not that the call was interrupted (by a signal handler).\r\n\r\nThe real test would be querying the `SIOCOUTQ` ioctl on the socket the *next* time the network I/O loop gets around to servicing it. That's the number of untransmitted bytes sitting in the kernel's transmit buffer. If that number is smaller than the connection's MSS, then the kernel exhausted its transmit buffer and started to delay sending the remaining bytes due to `MSG_MORE`.",
      "created_at": "2023-02-10T17:41:49Z",
      "updated_at": "2023-02-10T17:41:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26844#discussion_r1103046589",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1103046589"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26844"
        }
      },
      "start_line": 807,
      "original_start_line": 807,
      "start_side": "RIGHT",
      "line": 811,
      "original_line": 811,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1103053051",
      "pull_request_review_id": 1293710113,
      "id": 1103053051,
      "node_id": "PRRC_kwDOABII585Bv0D7",
      "diff_hunk": "@@ -802,7 +802,13 @@ size_t CConnman::SocketSendData(CNode& node) const\n             if (!node.m_sock) {\n                 break;\n             }\n-            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, MSG_NOSIGNAL | MSG_DONTWAIT);\n+            int flags = MSG_NOSIGNAL | MSG_DONTWAIT;\n+#ifdef MSG_MORE\n+            if (it + 1 != node.vSendMsg.end()) {\n+                flags |= MSG_MORE;\n+            }\n+#endif\n+            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, flags);",
      "path": "src/net.cpp",
      "position": 11,
      "original_position": 11,
      "commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "original_commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "in_reply_to_id": 1090324464,
      "user": {
        "login": "whitslack",
        "id": 797782,
        "node_id": "MDQ6VXNlcjc5Nzc4Mg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/797782?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/whitslack",
        "html_url": "https://github.com/whitslack",
        "followers_url": "https://api.github.com/users/whitslack/followers",
        "following_url": "https://api.github.com/users/whitslack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/whitslack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/whitslack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/whitslack/subscriptions",
        "organizations_url": "https://api.github.com/users/whitslack/orgs",
        "repos_url": "https://api.github.com/users/whitslack/repos",
        "events_url": "https://api.github.com/users/whitslack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/whitslack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> never with having sent nothing\r\n\r\n*N.B.:* It would be impossible for zero bytes to have been copied to a socket in non-blocking mode if that socket had indicated that it was writable and no other thread had written to it since such indication was made. Again, I'm pretty sure that even signal handlers won't interrupt a non-blocking write since the kernel only enters an interruptible wait state during a blocking write.\r\n\r\n(Edit: Actually, there may be an edge case where a socket indicates writable despite having no free space in its transmit buffer: specifically the case where the next write call would immediately return an error without copying any bytes. That would be a fatal error on the socket, though, such as \"connection reset.\")",
      "created_at": "2023-02-10T17:49:26Z",
      "updated_at": "2023-02-10T17:54:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26844#discussion_r1103053051",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1103053051"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26844"
        }
      },
      "start_line": 807,
      "original_start_line": 807,
      "start_side": "RIGHT",
      "line": 811,
      "original_line": 811,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1103065474",
      "pull_request_review_id": 1293740211,
      "id": 1103065474,
      "node_id": "PRRC_kwDOABII585Bv3GC",
      "diff_hunk": "@@ -802,7 +802,13 @@ size_t CConnman::SocketSendData(CNode& node) const\n             if (!node.m_sock) {\n                 break;\n             }\n-            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, MSG_NOSIGNAL | MSG_DONTWAIT);\n+            int flags = MSG_NOSIGNAL | MSG_DONTWAIT;\n+#ifdef MSG_MORE\n+            if (it + 1 != node.vSendMsg.end()) {\n+                flags |= MSG_MORE;\n+            }\n+#endif\n+            nBytes = node.m_sock->Send(reinterpret_cast<const char*>(data.data()) + node.nSendOffset, data.size() - node.nSendOffset, flags);",
      "path": "src/net.cpp",
      "position": 11,
      "original_position": 11,
      "commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "original_commit_id": "691eaf8873fe2f189153ca637506a0291504c97a",
      "in_reply_to_id": 1090324464,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> I think what you may have meant was that a send call indicated that fewer bytes were copied than were requested, not that the call was interrupted (by a signal handler).\r\n\r\nYes, exactly - I tried to be succinct, but that may have been confusing. Specifically, it refers to fewer bytes being accepted by `send()` than handed to it, while `MSG_MORE` was set.\r\n\r\n> N.B.: It would be impossible for zero bytes to have been copied to a socket in non-blocking mode if that socket had indicated that it was writable and no other thread had written to it since such indication was made.\r\n\r\nIndeed, so that sounds very much expected that 0 never happened (except when the socket errorred and the connected closed, but in that case, there is obviously no point in adding a non-`MSG_MORE` padding either).",
      "created_at": "2023-02-10T18:03:54Z",
      "updated_at": "2023-02-10T18:03:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26844#discussion_r1103065474",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1103065474"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26844"
        }
      },
      "start_line": 807,
      "original_start_line": 807,
      "start_side": "RIGHT",
      "line": 811,
      "original_line": 811,
      "side": "RIGHT"
    }
  ]
}