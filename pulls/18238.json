{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238",
    "id": 382210918,
    "node_id": "MDExOlB1bGxSZXF1ZXN0MzgyMjEwOTE4",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18238",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/18238.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/18238.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18238",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18238/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
    "number": 18238,
    "state": "closed",
    "locked": true,
    "maintainer_can_modify": false,
    "title": "net_processing: Retry notfounds with more urgency",
    "user": {
      "login": "ajtowns",
      "id": 127186,
      "node_id": "MDQ6VXNlcjEyNzE4Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajtowns",
      "html_url": "https://github.com/ajtowns",
      "followers_url": "https://api.github.com/users/ajtowns/followers",
      "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
      "organizations_url": "https://api.github.com/users/ajtowns/orgs",
      "repos_url": "https://api.github.com/users/ajtowns/repos",
      "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/ajtowns/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Anytime we see a NOTFOUND in response to a request for a tx, look through\r\neach of our peers for anyone else who announced the tx, find one who\r\ndoesn't already have its inflight tx count maxed out, and of those,\r\nmake the one who'd look at it first, look at it asap.",
    "labels": [
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      },
      {
        "id": 955867938,
        "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
        "name": "Needs rebase",
        "description": "",
        "color": "cccccc",
        "default": false
      }
    ],
    "active_lock_reason": "resolved",
    "created_at": "2020-03-02T07:04:50Z",
    "updated_at": "2022-02-15T11:03:44Z",
    "closed_at": "2020-06-15T03:37:52Z",
    "mergeable": false,
    "mergeable_state": "dirty",
    "merge_commit_sha": "9713d71eb2953a6e539e772c5c148d2d2a356257",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": false,
    "head": {
      "label": "ajtowns:202002-bump-notfound",
      "ref": "202002-bump-notfound",
      "sha": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 53941525,
        "node_id": "MDEwOlJlcG9zaXRvcnk1Mzk0MTUyNQ==",
        "name": "bitcoin",
        "full_name": "ajtowns/bitcoin",
        "owner": {
          "login": "ajtowns",
          "id": 127186,
          "node_id": "MDQ6VXNlcjEyNzE4Ng==",
          "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/ajtowns",
          "html_url": "https://github.com/ajtowns",
          "followers_url": "https://api.github.com/users/ajtowns/followers",
          "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
          "organizations_url": "https://api.github.com/users/ajtowns/orgs",
          "repos_url": "https://api.github.com/users/ajtowns/repos",
          "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/ajtowns/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/ajtowns/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/ajtowns/bitcoin",
        "archive_url": "https://api.github.com/repos/ajtowns/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/ajtowns/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/ajtowns/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/ajtowns/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/ajtowns/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/ajtowns/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/ajtowns/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/ajtowns/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/ajtowns/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/ajtowns/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/ajtowns/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/ajtowns/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/ajtowns/bitcoin/events",
        "forks_url": "https://api.github.com/repos/ajtowns/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/ajtowns/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/ajtowns/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/ajtowns/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/ajtowns/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/ajtowns/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/ajtowns/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/ajtowns/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/ajtowns/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/ajtowns/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/ajtowns/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/ajtowns/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/ajtowns/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/ajtowns/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/ajtowns/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/ajtowns/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:ajtowns/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/ajtowns/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/ajtowns/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/ajtowns/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/ajtowns/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/ajtowns/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/ajtowns/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/ajtowns/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/ajtowns/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/ajtowns/bitcoin/hooks",
        "svn_url": "https://github.com/ajtowns/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 2,
        "stargazers_count": 7,
        "watchers_count": 7,
        "size": 262427,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-05T19:54:41Z",
        "created_at": "2016-03-15T12:11:24Z",
        "updated_at": "2023-03-19T19:22:46Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "54a7ef612a3b69984d521432f8a694a682c76090",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 34324,
        "stargazers_count": 69817,
        "watchers_count": 69817,
        "size": 233879,
        "default_branch": "master",
        "open_issues_count": 627,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-06T22:42:00Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-06-07T01:13:41Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 42,
    "deletions": 3,
    "changed_files": 1,
    "commits": 1,
    "review_comments": 29,
    "comments": 10
  },
  "events": [
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzphMjA0ZDE1ODZjYTllOGYyZDdiMzk1MTM1OGZhNWU2M2ZhYTE4MTBi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "tree": {
        "sha": "c5109a8682a21c5dc524c06ceb1b6714a99c1178",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c5109a8682a21c5dc524c06ceb1b6714a99c1178"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/715dbbe9e8b64fd4b556a0b0720b44d68c3b5e32",
          "sha": "715dbbe9e8b64fd4b556a0b0720b44d68c3b5e32",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/715dbbe9e8b64fd4b556a0b0720b44d68c3b5e32"
        }
      ],
      "message": "net_processing: Retry notfounds with more urgency\n\nAnytime we see a NOTFOUND in response to a request for a tx, look through\neach of our peers for anyone else who announced the tx, find one who\ndoesn't already have its inflight tx count maxed out, and of those,\nmake the one who'd look at it first, look at it asap.",
      "committer": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2020-03-02T07:00:59Z"
      },
      "author": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2020-02-03T11:04:30Z"
      },
      "sha": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b"
    },
    {
      "event": "labeled",
      "id": 3086654785,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDMwODY2NTQ3ODU=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3086654785",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-02T07:05:24Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    },
    {
      "event": "commented",
      "id": 593254632,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU5MzI1NDYzMg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/593254632",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-02T07:13:05Z",
      "updated_at": "2020-03-02T07:13:05Z",
      "author_association": "MEMBER",
      "body": "This is an alternative approach to #15505 that's minimally invasive on the data structures. Doing something about this was suggested as a pre-req for #17303 in https://github.com/bitcoin/bitcoin/pull/17303#issuecomment-547589047\r\n\r\n@sdaftuar  expressed some concerns about how much of a CPU hit it could be in worst case scenarios, but it doesn't look too bad in testing:\r\n\r\n```diff\r\ndiff --git a/src/net_processing.cpp b/src/net_processing.cpp\r\nindex 3373f7f544..1b9e66456a 100644\r\n--- a/src/net_processing.cpp\r\n+++ b/src/net_processing.cpp\r\n@@ -735,8 +735,13 @@ std::chrono::microseconds CalculateTxGetDataTime(const uint256& txid, std::chron\r\n     return process_time;\r\n }\r\n \r\n+static uint64_t xxx_time_spent GUARDED_BY(cs_main) = 0;\r\n+static uint64_t xxx_invocations GUARDED_BY(cs_main) = 0;\r\n+\r\n static void RetryProcessTx(CConnman& connman, const uint256& txid, const std::chrono::microseconds current_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\r\n {\r\n+    uint64_t time_start = GetTimeMicros();\r\n+\r\n     CNodeState::TxDownloadState* best_d = nullptr;\r\n     std::chrono::microseconds best;\r\n \r\n@@ -764,6 +769,12 @@ static void RetryProcessTx(CConnman& connman, const uint256& txid, const std::ch\r\n             }\r\n         }\r\n     }\r\n+\r\n+    xxx_time_spent += GetTimeMicros() - time_start;\r\n+    ++xxx_invocations;\r\n+    if (xxx_invocations % 1000 == 0) {\r\n+        LogPrintf(\"Time spent in RetryProcessTx %d.%03ds, %d us per call (%d calls)\\n\", xxx_time_spent / 1000000, (xxx_time_spent / 1000) % 1000, xxx_time_spent/xxx_invocations, xxx_invocations);\r\n+    }\r\n }\r\n \r\n void RequestTx(CNodeState* state, const uint256& txid, std::chrono::microseconds current_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\r\ndiff --git a/test/functional/p2p_notfound_perf.py b/test/functional/p2p_notfound_perf.py\r\nnew file mode 100755\r\nindex 0000000000..970452696c\r\n--- /dev/null\r\n+++ b/test/functional/p2p_notfound_perf.py\r\n@@ -0,0 +1,63 @@\r\n+#!/usr/bin/env python3\r\n+# Copyright (c) 2017-2018 The Bitcoin Core developers\r\n+# Distributed under the MIT software license, see the accompanying\r\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\r\n+\"\"\"Test that we don't leak txs to inbound peers that we haven't yet announced to\"\"\"\r\n+\r\n+import time\r\n+from test_framework.messages import msg_notfound, msg_inv, CInv\r\n+from test_framework.mininode import P2PDataStore\r\n+from test_framework.test_framework import BitcoinTestFramework\r\n+from test_framework.util import (\r\n+    assert_equal,\r\n+)\r\n+\r\n+\r\n+class P2PNode(P2PDataStore):\r\n+    def on_inv(self, msg):\r\n+        pass\r\n+\r\n+    def on_getdata(self, msg):\r\n+        t = time.time()\r\n+        self.notfound_queue.extend(msg.inv)\r\n+        for inv in msg.inv:\r\n+            self.getdata[inv] = t\r\n+        while len(self.notfound_queue) >= 100:\r\n+            self.send_message(msg_notfound(vec=self.notfound_queue[:100]))\r\n+            self.notfound_queue = self.notfound_queue[100:]\r\n+\r\n+    def summary(self):\r\n+        return len(self.getdata), len(self.notfound_queue)\r\n+\r\n+class P2PNotFoundPerf(BitcoinTestFramework):\r\n+    def set_test_params(self):\r\n+        self.num_nodes = 1\r\n+\r\n+    def run_test(self):\r\n+        PEERS = 11\r\n+        TRANSACTIONS = 99000\r\n+\r\n+        gen_node = self.nodes[0]  # The block and tx generating node\r\n+        gen_node.generate(1)\r\n+\r\n+        inbound_peers = [ self.nodes[0].add_p2p_connection(P2PNode()) for _ in range(PEERS) ]\r\n+        for inbound in inbound_peers:\r\n+            inbound.getdata = {}\r\n+            inbound.notfound_queue = []\r\n+\r\n+        for txbatch in range(TRANSACTIONS//100):\r\n+            self.log.info(\"Doing batch %d\" % (txbatch+1))\r\n+            ann = [CInv(t=1, h=(txbatch*1000+i)) for i in range(100)]\r\n+            for inbound in inbound_peers:\r\n+                inbound.send_message(msg_inv(inv=ann))\r\n+\r\n+        #gen_node.logging(exclude=['net'])\r\n+\r\n+\r\n+        for i in range(60):\r\n+            self.log.info(\"State: \" + \" \".join(\"%d:%d\" % inbound.summary() for inbound in inbound_peers))\r\n+            time.sleep(15)\r\n+\r\n+\r\n+if __name__ == '__main__':\r\n+    P2PNotFoundPerf().main()\r\n```\r\n\r\nGives: `2020-03-02T06:58:54.778347Z [msghand] Time spent in RetryProcessTx 18.754s, 17 us per call (1089000 calls)` by the end for me, which doesn't seem too bad. It took about 12 minutes for all 99k transactions to get requested/notfound by all 11 peers, so 19 seconds total doesn't seem too bad. (The check for MAX_PEER_TX_IN_FLIGHT significantly cuts down on whether this actually does anything -- if there's lots of tx's announced by each peer, then most of them will always have most tx's in flight)",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#issuecomment-593254632",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18238"
    },
    {
      "event": "mentioned",
      "id": 3086671681,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzA4NjY3MTY4MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3086671681",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-02T07:13:06Z"
    },
    {
      "event": "subscribed",
      "id": 3086671684,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDMwODY2NzE2ODQ=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3086671684",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-02T07:13:06Z"
    },
    {
      "event": "commented",
      "id": 593348410,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU5MzM0ODQxMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/593348410",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-02T11:05:33Z",
      "updated_at": "2020-06-02T18:33:28Z",
      "author_association": "MEMBER",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19053 (refactor: replace CNode pointers by references within net_processing.{h,cpp} by theStack)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#issuecomment-593348410",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18238"
    },
    {
      "event": "commented",
      "id": 593526565,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU5MzUyNjU2NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/593526565",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-02T17:44:14Z",
      "updated_at": "2020-03-02T17:44:26Z",
      "author_association": "MEMBER",
      "body": "Concept ACK. Code looks good to me.\r\nCan you provide more context to understand the test? Are you basically trying to show that DoS-vector your PR opens is probably less than those which already exist?",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#issuecomment-593526565",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18238"
    },
    {
      "event": "commented",
      "id": 594325180,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU5NDMyNTE4MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/594325180",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-04T04:49:13Z",
      "updated_at": "2020-03-04T04:49:13Z",
      "author_association": "MEMBER",
      "body": "@naumenkogs Yeah; in a worst case scenario you could get 100 txids in a NOTFOUND message, have 125 peers to cycle through, and each peer could have announced 100k txs, so you end up with something like `O( 12,500 * log(100000) )` operations as a result of a single message (albeit with a fair chunk of setup). The test indicates that 11 peers on my hardware gives a time of about 20us per txid, so per NOTFOUND with 110 peers (so a factor of 100*10) that might result in 20ms processing time on a single message. That seemed low enough to be worth a PR to me.\r\n\r\nIf that's not good enough, could make it a bit lower in the worst case fairly easily by not retrying NOTFOUNDs as aggressively (eg, only do it for the first 10 txids in a NOTFOUND message, or ban peers if they often report a txid as NOTFOUND despite having INVed it recently, or change the retry delay from 0s-2s to 2s-4s, etc); but it'd need more rework of the data structures to get it to work efficiently, and then you have to ensure the new data structures don't introduce different DoS possibilities.",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#issuecomment-594325180",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18238"
    },
    {
      "event": "mentioned",
      "id": 3094965672,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzA5NDk2NTY3Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3094965672",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-04T04:49:14Z"
    },
    {
      "event": "subscribed",
      "id": 3094965673,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDMwOTQ5NjU2NzM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3094965673",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-04T04:49:14Z"
    },
    {
      "event": "commented",
      "id": 594645262,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU5NDY0NTI2Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/594645262",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-04T16:30:17Z",
      "updated_at": "2020-03-04T16:30:17Z",
      "author_association": "MEMBER",
      "body": "No, I think this sounds reasonable. I'd rather not introduce new data structures. As I said, we probably already have easier ways to DoS a node.",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#issuecomment-594645262",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18238"
    },
    {
      "event": "referenced",
      "id": 3101773639,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDMxMDE3NzM2Mzk=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3101773639",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "3f419029837d670722a898627f84cddeeee0d39c",
      "commit_url": "https://api.github.com/repos/bitcoinknots/bitcoin/commits/3f419029837d670722a898627f84cddeeee0d39c",
      "created_at": "2020-03-05T15:48:23Z"
    },
    {
      "event": "commented",
      "id": 601774053,
      "node_id": "MDEyOklzc3VlQ29tbWVudDYwMTc3NDA1Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/601774053",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-20T15:56:27Z",
      "updated_at": "2020-03-20T15:56:27Z",
      "author_association": "MEMBER",
      "body": "Concept ACK. \r\n\r\nOne difference to #15505 is that the retry-request there would be from outbound peers only, whereas this PR also includes inbound peers. \r\nIf I understand it correctly, this does not create any additional attack surface (e.g. for InvBlocks), because we keep the exact order of retries from the case where the peer does not answer at all (not even with NOTFOUND), just ask our next peer in line earlier than we would have otherwise.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#issuecomment-601774053",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18238"
    },
    {
      "event": "commented",
      "id": 602122496,
      "node_id": "MDEyOklzc3VlQ29tbWVudDYwMjEyMjQ5Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602122496",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-22T00:01:59Z",
      "updated_at": "2020-03-22T00:03:35Z",
      "author_association": "MEMBER",
      "body": "@mzumsande there's a little threat that, unlike with prior behavior, we won't have a 1 minute window between _first peer announced a tx and followed up with NOTFOUND_, and _we execute requests for the next peers_, during which more honest outbound peers can come with announcements and get prioritized against inbound dishonest peers.\r\n\r\nBut the only ways I think this can be exploited require dropping a transaction from an honest announcer's mempool, which is probably a more critical vulnerability anyway, so this doesn't reduce the overall security.",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#issuecomment-602122496",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18238"
    },
    {
      "event": "mentioned",
      "id": 3152209602,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzE1MjIwOTYwMg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3152209602",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-22T00:01:59Z"
    },
    {
      "event": "subscribed",
      "id": 3152209603,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDMxNTIyMDk2MDM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3152209603",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-22T00:01:59Z"
    },
    {
      "event": "reviewed",
      "id": 378961324,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4OTYxMzI0",
      "url": null,
      "actor": null,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#pullrequestreview-378961324",
      "submitted_at": "2020-03-22T00:05:12Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
    },
    {
      "event": "reviewed",
      "id": 380339215,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMzM5MjE1",
      "url": null,
      "actor": null,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#pullrequestreview-380339215",
      "submitted_at": "2020-03-24T14:03:30Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
    },
    {
      "event": "reviewed",
      "id": 380384599,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMzg0NTk5",
      "url": null,
      "actor": null,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#pullrequestreview-380384599",
      "submitted_at": "2020-03-24T14:48:54Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
    },
    {
      "event": "reviewed",
      "id": 380865364,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwODY1MzY0",
      "url": null,
      "actor": null,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Maybe commit message can be clearer and points to issue solved :\r\n\r\n\"Removing mapRelay would be a direct privacy improvement, but it may turn small-mempool peers as Dosers. If announced transactions are dropped from mempools and aren't available anymore in mapRelay, requesters will keep sending GETDATA until download expiration. By retrying requesting NOTFOUND transactions with different peers we avoid this issue. Note a dishonest peer can still withhold NOTFOUND to trigger same behavior from requester.\"?",
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#pullrequestreview-380865364",
      "submitted_at": "2020-03-25T06:22:05Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
    },
    {
      "event": "reviewed",
      "id": 381156849,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMTU2ODQ5",
      "url": null,
      "actor": null,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Concept ACK, but lots of questions.\r\n\r\nMy main concern is that `TxDownloadState` is becoming more complex, with data duplicated between member variables and only certain combinations being valid states. To reduce cognitive overload and risk of bugs, perhaps it should turned into a class with a well-defined interface for callers.",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#pullrequestreview-381156849",
      "submitted_at": "2020-03-25T15:09:21Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
    },
    {
      "event": "commented",
      "id": 603949033,
      "node_id": "MDEyOklzc3VlQ29tbWVudDYwMzk0OTAzMw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/603949033",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-25T16:38:32Z",
      "updated_at": "2020-03-25T16:38:32Z",
      "author_association": "MEMBER",
      "body": "Concept ACK but echoing jnewbery's feedback I also still have questions and agree with most of his code comments. I also think that code is currently not tested, so adding an explicit test would be very valuable. Additionally, comments in the `RetryProcessTx` code would be helpful for understanding.\r\n\r\nnit on the commit message: s/find one who doesn't already have its inflight/find all who don't already have their inflight/",
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#issuecomment-603949033",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18238"
    },
    {
      "event": "reviewed",
      "id": 381339908,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMzM5OTA4",
      "url": null,
      "actor": null,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK",
      "user": {
        "login": "jkczyz",
        "id": 4015903,
        "node_id": "MDQ6VXNlcjQwMTU5MDM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4015903?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jkczyz",
        "html_url": "https://github.com/jkczyz",
        "followers_url": "https://api.github.com/users/jkczyz/followers",
        "following_url": "https://api.github.com/users/jkczyz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jkczyz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jkczyz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jkczyz/subscriptions",
        "organizations_url": "https://api.github.com/users/jkczyz/orgs",
        "repos_url": "https://api.github.com/users/jkczyz/repos",
        "events_url": "https://api.github.com/users/jkczyz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jkczyz/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#pullrequestreview-381339908",
      "submitted_at": "2020-03-25T16:50:51Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
    },
    {
      "event": "reviewed",
      "id": 381579206,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNTc5MjA2",
      "url": null,
      "actor": null,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#pullrequestreview-381579206",
      "submitted_at": "2020-03-25T22:37:01Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
    },
    {
      "event": "reviewed",
      "id": 383559888,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNTU5ODg4",
      "url": null,
      "actor": null,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "rebroad",
        "id": 1530283,
        "node_id": "MDQ6VXNlcjE1MzAyODM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rebroad",
        "html_url": "https://github.com/rebroad",
        "followers_url": "https://api.github.com/users/rebroad/followers",
        "following_url": "https://api.github.com/users/rebroad/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rebroad/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rebroad/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
        "organizations_url": "https://api.github.com/users/rebroad/orgs",
        "repos_url": "https://api.github.com/users/rebroad/repos",
        "events_url": "https://api.github.com/users/rebroad/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rebroad/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#pullrequestreview-383559888",
      "submitted_at": "2020-03-30T06:27:35Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
    },
    {
      "event": "referenced",
      "id": 3182159181,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDMxODIxNTkxODE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3182159181",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "86284f69e8610e54c3b86354c2882f327b601dae",
      "commit_url": "https://api.github.com/repos/jnewbery/bitcoin/commits/86284f69e8610e54c3b86354c2882f327b601dae",
      "created_at": "2020-03-31T08:32:57Z"
    },
    {
      "event": "commented",
      "id": 639102646,
      "node_id": "MDEyOklzc3VlQ29tbWVudDYzOTEwMjY0Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/639102646",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-06-04T20:36:28Z",
      "updated_at": "2020-06-04T20:36:28Z",
      "author_association": "MEMBER",
      "body": "<!--cf906140f33d8803c4a75a2196329ecb-->\n🐙 This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#issuecomment-639102646",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18238"
    },
    {
      "event": "labeled",
      "id": 3408629215,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDM0MDg2MjkyMTU=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3408629215",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-06-04T20:36:28Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 643884901,
      "node_id": "MDEyOklzc3VlQ29tbWVudDY0Mzg4NDkwMQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/643884901",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-06-15T03:37:52Z",
      "updated_at": "2020-06-15T03:37:52Z",
      "author_association": "MEMBER",
      "body": "Obsoleted by #19184",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#issuecomment-643884901",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18238"
    },
    {
      "event": "closed",
      "id": 3442473978,
      "node_id": "MDExOkNsb3NlZEV2ZW50MzQ0MjQ3Mzk3OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3442473978",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-06-15T03:37:52Z"
    },
    {
      "event": "referenced",
      "id": 3541903888,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDM1NDE5MDM4ODg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3541903888",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "5550fa5983ea59e7ccef6540b7ec49a1770fb3ca",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5550fa5983ea59e7ccef6540b7ec49a1770fb3ca",
      "created_at": "2020-07-14T00:40:53Z"
    },
    {
      "event": "referenced",
      "id": 3542349565,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDM1NDIzNDk1NjU=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3542349565",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "0090059f609b9fe43153cf5cf01e25dc07876956",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/0090059f609b9fe43153cf5cf01e25dc07876956",
      "created_at": "2020-07-14T04:01:12Z"
    },
    {
      "event": "locked",
      "id": 6074011191,
      "node_id": "LOE_lADOABII584iMun7zwAAAAFqCg43",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6074011191",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-02-15T11:03:44Z",
      "lock_reason": "resolved"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/396040661",
      "pull_request_review_id": 378961324,
      "id": 396040661,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0MDY2MQ==",
      "diff_hunk": "@@ -731,6 +735,37 @@ std::chrono::microseconds CalculateTxGetDataTime(const uint256& txid, std::chron\n     return process_time;\n }\n \n+static void RetryProcessTx(CConnman& connman, const uint256& txid, const std::chrono::microseconds current_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    CNodeState::TxDownloadState* best_d = nullptr;\n+    std::chrono::microseconds best;\n+\n+    for (auto& el : mapNodeState) {\n+         CNodeState::TxDownloadState* d = &el.second.m_tx_download;\n+         if (d->m_tx_in_flight.size() >= MAX_PEER_TX_IN_FLIGHT) continue;\n+         auto it = d->m_tx_announced.find(txid);\n+         if (it != d->m_tx_announced.end()) {\n+             if (best_d == nullptr || (it->second != std::chrono::microseconds::zero() && it->second < best)) {\n+                 best_d = d;\n+                 best = it->second;\n+             }\n+         }\n+    }\n+\n+    std::chrono::microseconds process_time = current_time + GetRandMicros(MAX_NOTFOUND_RETRY_RANDOM_DELAY);",
      "path": "src/net_processing.cpp",
      "position": 43,
      "original_position": 43,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": null,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Why is 2-seconds random delay useful here? It can accidentally prioritize inbound nodes over outbound :)",
      "created_at": "2020-03-22T00:05:11Z",
      "updated_at": "2020-03-22T00:05:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r396040661",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/396040661"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 755,
      "original_line": 755,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/396884515",
      "pull_request_review_id": 379978515,
      "id": 396884515,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg4NDUxNQ==",
      "diff_hunk": "@@ -731,6 +735,37 @@ std::chrono::microseconds CalculateTxGetDataTime(const uint256& txid, std::chron\n     return process_time;\n }\n \n+static void RetryProcessTx(CConnman& connman, const uint256& txid, const std::chrono::microseconds current_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    CNodeState::TxDownloadState* best_d = nullptr;\n+    std::chrono::microseconds best;\n+\n+    for (auto& el : mapNodeState) {\n+         CNodeState::TxDownloadState* d = &el.second.m_tx_download;\n+         if (d->m_tx_in_flight.size() >= MAX_PEER_TX_IN_FLIGHT) continue;\n+         auto it = d->m_tx_announced.find(txid);\n+         if (it != d->m_tx_announced.end()) {\n+             if (best_d == nullptr || (it->second != std::chrono::microseconds::zero() && it->second < best)) {\n+                 best_d = d;\n+                 best = it->second;\n+             }\n+         }\n+    }\n+\n+    std::chrono::microseconds process_time = current_time + GetRandMicros(MAX_NOTFOUND_RETRY_RANDOM_DELAY);",
      "path": "src/net_processing.cpp",
      "position": 43,
      "original_position": 43,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": 396040661,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It already tests that `process_time < best` so the 2s delay will only bring a process time forward, not push it back past an inbound peer's process time.\r\n\r\nI think the scenario is likely to be:\r\n\r\n * bunch of peers announce a new tx, outbound connections get polled asap, inbound connections get polled after 2s\r\n * you pick one of those, likely an outbound, and send a GETDATA\r\n * other peers announce, get a 60s-64s delay\r\n * the early announcing peers get their process time rescheduled with an additional 60-64s delay\r\n * a NOTFOUND comes back, and you pick whoever's delay was shortest; if it came back in under 2s, you'll next ask an inbound connection who announced early; if it came back later, you'll probably ask an outbound connection who announced after you'd sent the first GETDATA\r\n\r\nWhich is to say, I don't think we're consistently prioritising outbounds after the first request anyway.\r\n\r\nI don't have a good rationale for the 2s random delay; instantly going from a NOTFOUND from one peer to a GETDATA to another peer seems risky to me though.",
      "created_at": "2020-03-24T03:33:28Z",
      "updated_at": "2020-03-24T03:33:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r396884515",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/396884515"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 755,
      "original_line": 755,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397167955",
      "pull_request_review_id": 380328631,
      "id": 397167955,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzE2Nzk1NQ==",
      "diff_hunk": "@@ -731,6 +735,37 @@ std::chrono::microseconds CalculateTxGetDataTime(const uint256& txid, std::chron\n     return process_time;\n }\n \n+static void RetryProcessTx(CConnman& connman, const uint256& txid, const std::chrono::microseconds current_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    CNodeState::TxDownloadState* best_d = nullptr;\n+    std::chrono::microseconds best;\n+\n+    for (auto& el : mapNodeState) {\n+         CNodeState::TxDownloadState* d = &el.second.m_tx_download;\n+         if (d->m_tx_in_flight.size() >= MAX_PEER_TX_IN_FLIGHT) continue;\n+         auto it = d->m_tx_announced.find(txid);\n+         if (it != d->m_tx_announced.end()) {\n+             if (best_d == nullptr || (it->second != std::chrono::microseconds::zero() && it->second < best)) {\n+                 best_d = d;\n+                 best = it->second;\n+             }\n+         }\n+    }\n+\n+    std::chrono::microseconds process_time = current_time + GetRandMicros(MAX_NOTFOUND_RETRY_RANDOM_DELAY);",
      "path": "src/net_processing.cpp",
      "position": 43,
      "original_position": 43,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": 396040661,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yeah, I was a bit confused, now what's on your mind makes sense to me.\r\nI'm probably fine with leaving your 2s random delay.\r\n\r\n>Which is to say, I don't think we're consistently prioritising outbounds after the first request anyway.\r\n\r\nI think we do? That's probably off-topic here, although i'd be curious why you think so.",
      "created_at": "2020-03-24T13:52:24Z",
      "updated_at": "2020-03-24T13:52:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r397167955",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397167955"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 755,
      "original_line": 755,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397176111",
      "pull_request_review_id": 380339215,
      "id": 397176111,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzE3NjExMQ==",
      "diff_hunk": "@@ -731,6 +735,37 @@ std::chrono::microseconds CalculateTxGetDataTime(const uint256& txid, std::chron\n     return process_time;\n }\n \n+static void RetryProcessTx(CConnman& connman, const uint256& txid, const std::chrono::microseconds current_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    CNodeState::TxDownloadState* best_d = nullptr;\n+    std::chrono::microseconds best;\n+\n+    for (auto& el : mapNodeState) {\n+         CNodeState::TxDownloadState* d = &el.second.m_tx_download;",
      "path": "src/net_processing.cpp",
      "position": 32,
      "original_position": 32,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": null,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Could we come up with a better variable name? :(\r\nMaybe \"tx_communication\" or something. Yeah it sucks, but probably nothing is worse than 1-letter name for something meaningful like this.",
      "created_at": "2020-03-24T14:03:30Z",
      "updated_at": "2020-03-24T14:03:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r397176111",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397176111"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 744,
      "original_line": 744,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397176897",
      "pull_request_review_id": 380340216,
      "id": 397176897,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzE3Njg5Nw==",
      "diff_hunk": "@@ -731,6 +735,37 @@ std::chrono::microseconds CalculateTxGetDataTime(const uint256& txid, std::chron\n     return process_time;\n }\n \n+static void RetryProcessTx(CConnman& connman, const uint256& txid, const std::chrono::microseconds current_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    CNodeState::TxDownloadState* best_d = nullptr;\n+    std::chrono::microseconds best;\n+\n+    for (auto& el : mapNodeState) {\n+         CNodeState::TxDownloadState* d = &el.second.m_tx_download;",
      "path": "src/net_processing.cpp",
      "position": 32,
      "original_position": 32,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": 397176111,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "also best->best_time",
      "created_at": "2020-03-24T14:04:33Z",
      "updated_at": "2020-03-24T14:04:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r397176897",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397176897"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 744,
      "original_line": 744,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397211419",
      "pull_request_review_id": 380384599,
      "id": 397211419,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxMTQxOQ==",
      "diff_hunk": "@@ -4039,6 +4076,7 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n             // Erase this entry from tx_process_time (it may be added back for\n             // processing at a later time, see below)\n             tx_process_time.erase(tx_process_time.begin());\n+            state.m_tx_download.m_tx_announced[txid] = std::chrono::microseconds::zero();",
      "path": "src/net_processing.cpp",
      "position": 94,
      "original_position": 94,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": null,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think this line handles a tricky corner case. Can we add comment to reduce the cognitive burned on code reviewer?\r\nWhat I think happens is (correct me if I'm wrong):\r\n- request from X1, not found\r\n- request from X2, ignores us for 1 minute\r\n- request from X3, notfound\r\n- this line prevents us from querying X2 again (we would if this line is deleted)\r\n\r\nNow that I wrote this, one could simply check the presence of m_tx_in_flight for that peer, and if it is in flight, not consider for re-query? ",
      "created_at": "2020-03-24T14:48:54Z",
      "updated_at": "2020-03-24T14:48:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r397211419",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397211419"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4079,
      "original_line": 4079,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397615753",
      "pull_request_review_id": 380865364,
      "id": 397615753,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzYxNTc1Mw==",
      "diff_hunk": "@@ -731,6 +735,37 @@ std::chrono::microseconds CalculateTxGetDataTime(const uint256& txid, std::chron\n     return process_time;\n }\n \n+static void RetryProcessTx(CConnman& connman, const uint256& txid, const std::chrono::microseconds current_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    CNodeState::TxDownloadState* best_d = nullptr;\n+    std::chrono::microseconds best;\n+\n+    for (auto& el : mapNodeState) {\n+         CNodeState::TxDownloadState* d = &el.second.m_tx_download;",
      "path": "src/net_processing.cpp",
      "position": 32,
      "original_position": 32,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": 397176111,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Or I renamed `best` to `lower_process_time` while reviewing, but I agree names can be more meaningful.",
      "created_at": "2020-03-25T05:24:14Z",
      "updated_at": "2020-03-25T06:22:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r397615753",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397615753"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 744,
      "original_line": 744,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397628040",
      "pull_request_review_id": 380865364,
      "id": 397628040,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzYyODA0MA==",
      "diff_hunk": "@@ -731,6 +735,37 @@ std::chrono::microseconds CalculateTxGetDataTime(const uint256& txid, std::chron\n     return process_time;\n }\n \n+static void RetryProcessTx(CConnman& connman, const uint256& txid, const std::chrono::microseconds current_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    CNodeState::TxDownloadState* best_d = nullptr;\n+    std::chrono::microseconds best;\n+\n+    for (auto& el : mapNodeState) {",
      "path": "src/net_processing.cpp",
      "position": 31,
      "original_position": 31,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": null,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Did you consider to filter by `nPreferredDownload` to favor outbound peers and lower DoS risk? Only querying outbound peers should be good enough to achieve goal of finding NOTFOUND transactions but even if we don't success due to bad-connectivity of our outbounds, worst-case scenario we hit the 1-min window (and a transaction not being announced by our outbounds is less likely to be a honest announcement?)",
      "created_at": "2020-03-25T06:13:20Z",
      "updated_at": "2020-03-25T06:22:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r397628040",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397628040"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 743,
      "original_line": 743,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397861849",
      "pull_request_review_id": 381156849,
      "id": 397861849,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg2MTg0OQ==",
      "diff_hunk": "@@ -731,6 +735,37 @@ std::chrono::microseconds CalculateTxGetDataTime(const uint256& txid, std::chron\n     return process_time;\n }\n \n+static void RetryProcessTx(CConnman& connman, const uint256& txid, const std::chrono::microseconds current_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    CNodeState::TxDownloadState* best_d = nullptr;\n+    std::chrono::microseconds best;",
      "path": "src/net_processing.cpp",
      "position": 29,
      "original_position": 29,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I get a compiler warning that `best` might be used before initialization:\r\n\r\n```\r\nnet_processing.cpp: In function ‘bool ProcessMessage(CNode*, const string&, CDataStream&, int64_t, const CChainParams&, CConnman*, BanMan*, const std::atomic<bool>&)’:\r\nnet_processing.cpp:756:27: warning: ‘best’ may be used uninitialized in this function [-Wmaybe-uninitialized]\r\n     if (best_d != nullptr && process_time < best) {\r\n         ~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~\r\nnet_processing.cpp:741:31: note: ‘best’ was declared here\r\n     std::chrono::microseconds best;\r\n                               ^~~~\r\n```\r\n\r\nThe logic below means that this can't be read before set, but I don't see any harm in initializing to 0 or `std::chrono::microseconds::max()`.",
      "created_at": "2020-03-25T13:41:58Z",
      "updated_at": "2020-03-25T15:09:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r397861849",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397861849"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 741,
      "original_line": 741,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397862854",
      "pull_request_review_id": 381156849,
      "id": 397862854,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg2Mjg1NA==",
      "diff_hunk": "@@ -344,8 +346,10 @@ struct CNodeState {\n          */\n         std::multimap<std::chrono::microseconds, uint256> m_tx_process_time;\n \n-        //! Store all the transactions a peer has recently announced\n-        std::set<uint256> m_tx_announced;\n+        /* Store all the transactions a peer has recently announced,\n+         * along with their process time\n+         */\n+        std::map<uint256, std::chrono::microseconds> m_tx_announced;",
      "path": "src/net_processing.cpp",
      "position": 18,
      "original_position": 18,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This can be an unordered map for average constant-time lookup:\r\n\r\n```diff\r\ndiff --git a/src/net_processing.cpp b/src/net_processing.cpp\r\nindex 3373f7f54..2e097d44e 100644\r\n--- a/src/net_processing.cpp\r\n+++ b/src/net_processing.cpp\r\n@@ -30,6 +30,7 @@\r\n \r\n #include <memory>\r\n #include <typeinfo>\r\n+#include <unordered_map>\r\n \r\n #if defined(NDEBUG)\r\n # error \"Bitcoin cannot be compiled without assertions.\"\r\n@@ -204,6 +205,11 @@ namespace {\r\n     static std::vector<std::pair<uint256, CTransactionRef>> vExtraTxnForCompact GUARDED_BY(g_cs_orphans);\r\n } // namespace\r\n \r\n+struct TxHasher\r\n+{\r\n+    size_t operator()(const uint256& hash) const { return ReadLE64(hash.begin()); }\r\n+};\r\n+\r\n namespace {\r\n /**\r\n  * Maintain validation-specific state about nodes, protected by cs_main, instead\r\n@@ -349,7 +355,7 @@ struct CNodeState {\r\n         /* Store all the transactions a peer has recently announced,\r\n          * along with their process time\r\n          */\r\n-        std::map<uint256, std::chrono::microseconds> m_tx_announced;\r\n+        std::unordered_map<uint256, std::chrono::microseconds, TxHasher> m_tx_announced;\r\n \r\n         //! Store transactions which were requested by us, with timestamp\r\n```",
      "created_at": "2020-03-25T13:43:26Z",
      "updated_at": "2020-03-25T15:09:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r397862854",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397862854"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 352,
      "original_line": 352,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397883915",
      "pull_request_review_id": 381156849,
      "id": 397883915,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg4MzkxNQ==",
      "diff_hunk": "@@ -344,8 +346,10 @@ struct CNodeState {\n          */\n         std::multimap<std::chrono::microseconds, uint256> m_tx_process_time;\n \n-        //! Store all the transactions a peer has recently announced\n-        std::set<uint256> m_tx_announced;\n+        /* Store all the transactions a peer has recently announced,\n+         * along with their process time",
      "path": "src/net_processing.cpp",
      "position": 16,
      "original_position": 16,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think this comment could be slightly improved. The time is set to:\r\n\r\n- `std::chrono::microseconds::zero()` if the transaction has been requested from this peer (ie exists in `m_tx_in_flight`)\r\n- the process time if the transaction has not yet been requested from this peer (ie exists in `m_tx_process_time`)\r\n",
      "created_at": "2020-03-25T14:11:00Z",
      "updated_at": "2020-03-25T15:09:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r397883915",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397883915"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 350,
      "original_line": 350,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397916687",
      "pull_request_review_id": 381156849,
      "id": 397916687,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkxNjY4Nw==",
      "diff_hunk": "@@ -3222,6 +3257,7 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n         std::vector<CInv> vInv;\n         vRecv >> vInv;\n         if (vInv.size() <= MAX_PEER_TX_IN_FLIGHT + MAX_BLOCKS_IN_TRANSIT_PER_PEER) {",
      "path": "src/net_processing.cpp",
      "position": 77,
      "original_position": 77,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Did you consider moving all of the `NOTFOUND` processing to its own function `ProcessNotFound()`? Splitting the logic between here and `RetryProcessTx()` makes it more difficult to follow than if it was all in one place.",
      "created_at": "2020-03-25T14:51:57Z",
      "updated_at": "2020-03-25T15:09:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r397916687",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397916687"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3259,
      "original_line": 3259,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397925056",
      "pull_request_review_id": 381156849,
      "id": 397925056,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkyNTA1Ng==",
      "diff_hunk": "@@ -731,6 +735,37 @@ std::chrono::microseconds CalculateTxGetDataTime(const uint256& txid, std::chron\n     return process_time;\n }\n \n+static void RetryProcessTx(CConnman& connman, const uint256& txid, const std::chrono::microseconds current_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    CNodeState::TxDownloadState* best_d = nullptr;\n+    std::chrono::microseconds best;\n+\n+    for (auto& el : mapNodeState) {\n+         CNodeState::TxDownloadState* d = &el.second.m_tx_download;\n+         if (d->m_tx_in_flight.size() >= MAX_PEER_TX_IN_FLIGHT) continue;\n+         auto it = d->m_tx_announced.find(txid);\n+         if (it != d->m_tx_announced.end()) {\n+             if (best_d == nullptr || (it->second != std::chrono::microseconds::zero() && it->second < best)) {\n+                 best_d = d;\n+                 best = it->second;\n+             }\n+         }\n+    }\n+\n+    std::chrono::microseconds process_time = current_time + GetRandMicros(MAX_NOTFOUND_RETRY_RANDOM_DELAY);\n+    if (best_d != nullptr && process_time < best) {\n+        auto end = best_d->m_tx_process_time.end();\n+        for (auto it = best_d->m_tx_process_time.lower_bound(best); it != end && it->first == best; ++it) {\n+            if (it->second == txid) {\n+                best_d->m_tx_process_time.erase(it);",
      "path": "src/net_processing.cpp",
      "position": 48,
      "original_position": 48,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Maybe I'm misunderstanding the logic here, but this will bring the `NodeState`'s `m_tx_process_time` forward (to now + ~1second), but does nothing to the global `g_already_asked_for` time, which means that next time we go round `SendMessages()`, we won't actually rerequest the transaction, since `last_request_time > current_time - GETDATA_TX_INTERVAL`. Am I missing something?\r\n\r\nIf I'm right, I think we need to do something like reset `g_already_asked_for` to one minute ago.",
      "created_at": "2020-03-25T15:02:03Z",
      "updated_at": "2020-03-25T15:09:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r397925056",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397925056"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 760,
      "original_line": 760,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397928486",
      "pull_request_review_id": 381156849,
      "id": 397928486,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkyODQ4Ng==",
      "diff_hunk": "@@ -3234,6 +3270,7 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n                     }\n                     state->m_tx_download.m_tx_in_flight.erase(in_flight_it);\n                     state->m_tx_download.m_tx_announced.erase(inv.hash);",
      "path": "src/net_processing.cpp",
      "position": 85,
      "original_position": 85,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Now that we're potentially rerequesting txs from different peers after receiving a NOTFOUND, I think we _shouldn't_ erase them from a peer's _m_tx_in_flight_ and _m_tx_announced_ structures in receipt of a `NOTFOUND`, and keep them there until the `TX_EXPIRY_INTERVAL` in `SendMessages()`, otherwise there might be an attack where an adversary has multiple connections to you, and then juggles you between them by sending an `INV` for a transaction, holding on to the `GETDATA`, and then sending a `NOTFOUND` immediately followed by an `INV` reannouncing the same tx.",
      "created_at": "2020-03-25T15:06:39Z",
      "updated_at": "2020-03-25T15:09:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r397928486",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397928486"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3272,
      "original_line": 3272,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398008657",
      "pull_request_review_id": 381339908,
      "id": 398008657,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAwODY1Nw==",
      "diff_hunk": "@@ -731,6 +735,37 @@ std::chrono::microseconds CalculateTxGetDataTime(const uint256& txid, std::chron\n     return process_time;\n }\n \n+static void RetryProcessTx(CConnman& connman, const uint256& txid, const std::chrono::microseconds current_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    CNodeState::TxDownloadState* best_d = nullptr;\n+    std::chrono::microseconds best;\n+\n+    for (auto& el : mapNodeState) {\n+         CNodeState::TxDownloadState* d = &el.second.m_tx_download;\n+         if (d->m_tx_in_flight.size() >= MAX_PEER_TX_IN_FLIGHT) continue;\n+         auto it = d->m_tx_announced.find(txid);\n+         if (it != d->m_tx_announced.end()) {\n+             if (best_d == nullptr || (it->second != std::chrono::microseconds::zero() && it->second < best)) {",
      "path": "src/net_processing.cpp",
      "position": 36,
      "original_position": 36,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": null,
      "user": {
        "login": "jkczyz",
        "id": 4015903,
        "node_id": "MDQ6VXNlcjQwMTU5MDM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4015903?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jkczyz",
        "html_url": "https://github.com/jkczyz",
        "followers_url": "https://api.github.com/users/jkczyz/followers",
        "following_url": "https://api.github.com/users/jkczyz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jkczyz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jkczyz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jkczyz/subscriptions",
        "organizations_url": "https://api.github.com/users/jkczyz/orgs",
        "repos_url": "https://api.github.com/users/jkczyz/repos",
        "events_url": "https://api.github.com/users/jkczyz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jkczyz/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This condition could probably be simplified considerably if (1) `best` is initialized appropriately and (2) the entry for the `txid` in `m_tx_announced` is removed on line 4079 rather than zeroed (like what is done on line 3272). Was zeroing chosen on line 4079 for a specific reason?",
      "created_at": "2020-03-25T16:48:18Z",
      "updated_at": "2020-03-25T16:50:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r398008657",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398008657"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 748,
      "original_line": 748,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398015110",
      "pull_request_review_id": 381347967,
      "id": 398015110,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAxNTExMA==",
      "diff_hunk": "@@ -731,6 +735,37 @@ std::chrono::microseconds CalculateTxGetDataTime(const uint256& txid, std::chron\n     return process_time;\n }\n \n+static void RetryProcessTx(CConnman& connman, const uint256& txid, const std::chrono::microseconds current_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    CNodeState::TxDownloadState* best_d = nullptr;\n+    std::chrono::microseconds best;\n+\n+    for (auto& el : mapNodeState) {\n+         CNodeState::TxDownloadState* d = &el.second.m_tx_download;\n+         if (d->m_tx_in_flight.size() >= MAX_PEER_TX_IN_FLIGHT) continue;\n+         auto it = d->m_tx_announced.find(txid);\n+         if (it != d->m_tx_announced.end()) {\n+             if (best_d == nullptr || (it->second != std::chrono::microseconds::zero() && it->second < best)) {",
      "path": "src/net_processing.cpp",
      "position": 36,
      "original_position": 36,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": 398008657,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "My guess for the reason is [here](https://github.com/bitcoin/bitcoin/pull/18238#discussion_r397211419) :)",
      "created_at": "2020-03-25T16:57:12Z",
      "updated_at": "2020-03-25T16:57:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r398015110",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398015110"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 748,
      "original_line": 748,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398205912",
      "pull_request_review_id": 381579206,
      "id": 398205912,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIwNTkxMg==",
      "diff_hunk": "@@ -731,6 +735,37 @@ std::chrono::microseconds CalculateTxGetDataTime(const uint256& txid, std::chron\n     return process_time;\n }\n \n+static void RetryProcessTx(CConnman& connman, const uint256& txid, const std::chrono::microseconds current_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    CNodeState::TxDownloadState* best_d = nullptr;\n+    std::chrono::microseconds best;\n+\n+    for (auto& el : mapNodeState) {",
      "path": "src/net_processing.cpp",
      "position": 31,
      "original_position": 31,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": 397628040,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think it'd be even better to change the 'best' definition to prefer outbound peers where we can, but fall back to inbound peers if there are no outbound peers that have announced the tx.",
      "created_at": "2020-03-25T22:21:23Z",
      "updated_at": "2020-03-25T22:37:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r398205912",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398205912"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 743,
      "original_line": 743,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398212938",
      "pull_request_review_id": 381579206,
      "id": 398212938,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIxMjkzOA==",
      "diff_hunk": "@@ -344,8 +346,10 @@ struct CNodeState {\n          */\n         std::multimap<std::chrono::microseconds, uint256> m_tx_process_time;\n \n-        //! Store all the transactions a peer has recently announced\n-        std::set<uint256> m_tx_announced;\n+        /* Store all the transactions a peer has recently announced,",
      "path": "src/net_processing.cpp",
      "position": 15,
      "original_position": 15,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "We discussed this in PR Review Club (https://bitcoincore.reviews/18238.html#l-115 and https://bitcoincore.reviews/18238.html#l-180), and there was some agreement that even for a small struct like this, the dependencies between the fields make it difficult to reason about and potentially bug-prone.\r\n\r\nI think from a high level, in the future we might want a `TxDownloadState` class which contains:\r\n\r\n- {txid, timestamp, state} objects where\r\n    - state can be 'announced' or 'requested'\r\n    - timestamp refers to 'when to request' if state is announced, and 'when requested' if state is requested\r\n- a way to lookup the object by txid\r\n- a way to iterate through the 'announced' objects sorted by timestamp\r\n- a way to iterate through the 'requested' objects (doesn't necessarily need to be sorted by timestamp since there can only be MAX_PEER_TX_IN_FLIGHT = 100 of them)\r\n- public functions to add, remove, refresh timestamps, etc\r\n    ",
      "created_at": "2020-03-25T22:36:57Z",
      "updated_at": "2020-03-25T22:37:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r398212938",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398212938"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 349,
      "original_line": 349,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398318859",
      "pull_request_review_id": 381703565,
      "id": 398318859,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODMxODg1OQ==",
      "diff_hunk": "@@ -344,8 +346,10 @@ struct CNodeState {\n          */\n         std::multimap<std::chrono::microseconds, uint256> m_tx_process_time;\n \n-        //! Store all the transactions a peer has recently announced\n-        std::set<uint256> m_tx_announced;\n+        /* Store all the transactions a peer has recently announced,",
      "path": "src/net_processing.cpp",
      "position": 15,
      "original_position": 15,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": 398212938,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I'm +1 on this, but maybe it'd be better to get wtxid relay #18044 in first?",
      "created_at": "2020-03-26T05:00:57Z",
      "updated_at": "2020-03-26T05:00:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r398318859",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398318859"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 349,
      "original_line": 349,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398327348",
      "pull_request_review_id": 381713265,
      "id": 398327348,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODMyNzM0OA==",
      "diff_hunk": "@@ -344,8 +346,10 @@ struct CNodeState {\n          */\n         std::multimap<std::chrono::microseconds, uint256> m_tx_process_time;\n \n-        //! Store all the transactions a peer has recently announced\n-        std::set<uint256> m_tx_announced;\n+        /* Store all the transactions a peer has recently announced,\n+         * along with their process time\n+         */\n+        std::map<uint256, std::chrono::microseconds> m_tx_announced;",
      "path": "src/net_processing.cpp",
      "position": 18,
      "original_position": 18,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": 397862854,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think you'd need that to remain constant/log time in worst-case/attack scenarios because the announced hash is completely under the control of an attacker.",
      "created_at": "2020-03-26T05:35:58Z",
      "updated_at": "2020-03-26T05:35:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r398327348",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/398327348"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 352,
      "original_line": 352,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399952805",
      "pull_request_review_id": 383559888,
      "id": 399952805,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk1MjgwNQ==",
      "diff_hunk": "@@ -75,6 +75,8 @@ static constexpr std::chrono::microseconds INBOUND_PEER_TX_DELAY{std::chrono::se\n static constexpr std::chrono::microseconds GETDATA_TX_INTERVAL{std::chrono::seconds{60}};\n /** Maximum delay (in microseconds) for transaction requests to avoid biasing some peers over others. */\n static constexpr std::chrono::microseconds MAX_GETDATA_RANDOM_DELAY{std::chrono::seconds{2}};\n+/** Delay between receiving a NOTFOUND and trying the next peer. */",
      "path": "src/net_processing.cpp",
      "position": 4,
      "original_position": 4,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": null,
      "user": {
        "login": "rebroad",
        "id": 1530283,
        "node_id": "MDQ6VXNlcjE1MzAyODM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rebroad",
        "html_url": "https://github.com/rebroad",
        "followers_url": "https://api.github.com/users/rebroad/followers",
        "following_url": "https://api.github.com/users/rebroad/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rebroad/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rebroad/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
        "organizations_url": "https://api.github.com/users/rebroad/orgs",
        "repos_url": "https://api.github.com/users/rebroad/repos",
        "events_url": "https://api.github.com/users/rebroad/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rebroad/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "why have any delay?",
      "created_at": "2020-03-30T06:27:35Z",
      "updated_at": "2020-03-30T06:27:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r399952805",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399952805"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 78,
      "original_line": 78,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400232009",
      "pull_request_review_id": 383906271,
      "id": 400232009,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIzMjAwOQ==",
      "diff_hunk": "@@ -75,6 +75,8 @@ static constexpr std::chrono::microseconds INBOUND_PEER_TX_DELAY{std::chrono::se\n static constexpr std::chrono::microseconds GETDATA_TX_INTERVAL{std::chrono::seconds{60}};\n /** Maximum delay (in microseconds) for transaction requests to avoid biasing some peers over others. */\n static constexpr std::chrono::microseconds MAX_GETDATA_RANDOM_DELAY{std::chrono::seconds{2}};\n+/** Delay between receiving a NOTFOUND and trying the next peer. */",
      "path": "src/net_processing.cpp",
      "position": 4,
      "original_position": 4,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": 399952805,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "We have some discussion [here](https://github.com/bitcoin/bitcoin/pull/18238#discussion_r396040661)",
      "created_at": "2020-03-30T14:23:12Z",
      "updated_at": "2020-03-30T14:23:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r400232009",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400232009"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 78,
      "original_line": 78,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400597100",
      "pull_request_review_id": 384351531,
      "id": 400597100,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU5NzEwMA==",
      "diff_hunk": "@@ -344,8 +346,10 @@ struct CNodeState {\n          */\n         std::multimap<std::chrono::microseconds, uint256> m_tx_process_time;\n \n-        //! Store all the transactions a peer has recently announced\n-        std::set<uint256> m_tx_announced;\n+        /* Store all the transactions a peer has recently announced,",
      "path": "src/net_processing.cpp",
      "position": 15,
      "original_position": 15,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": 398212938,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I've had a first attempt at this: https://github.com/jnewbery/bitcoin/tree/2020-03-tx-download-class\r\n\r\nNo tests or comments yet, and it could be tidied up, but do you think this is heading in the right direction?",
      "created_at": "2020-03-31T01:55:06Z",
      "updated_at": "2020-03-31T01:55:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r400597100",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400597100"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 349,
      "original_line": 349,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400649805",
      "pull_request_review_id": 384409301,
      "id": 400649805,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY0OTgwNQ==",
      "diff_hunk": "@@ -731,6 +735,37 @@ std::chrono::microseconds CalculateTxGetDataTime(const uint256& txid, std::chron\n     return process_time;\n }\n \n+static void RetryProcessTx(CConnman& connman, const uint256& txid, const std::chrono::microseconds current_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    CNodeState::TxDownloadState* best_d = nullptr;\n+    std::chrono::microseconds best;\n+\n+    for (auto& el : mapNodeState) {",
      "path": "src/net_processing.cpp",
      "position": 31,
      "original_position": 31,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": 397628040,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "We already prefer outbound peers when we bump the process time (in `CalculateTxGetDataTime()`), and this chooses the lowest process time which will reflect that preference. I don't think it makes sense to complicate this further unless someone wants to do some real world testing on how well/badly the process time preferencing works in practice when the first thing we try results in a notfound.",
      "created_at": "2020-03-31T05:21:07Z",
      "updated_at": "2020-03-31T05:21:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r400649805",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400649805"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 743,
      "original_line": 743,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400651358",
      "pull_request_review_id": 384411020,
      "id": 400651358,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY1MTM1OA==",
      "diff_hunk": "@@ -4039,6 +4076,7 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n             // Erase this entry from tx_process_time (it may be added back for\n             // processing at a later time, see below)\n             tx_process_time.erase(tx_process_time.begin());\n+            state.m_tx_download.m_tx_announced[txid] = std::chrono::microseconds::zero();",
      "path": "src/net_processing.cpp",
      "position": 94,
      "original_position": 94,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": 397211419,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think the idea was to stop you from doing `INV x; NOTFOUND x; INV x` repeatedly and making it harder for you to query other peers. But I think this introduces a bug -- the `zero` entry never gets cleared from `m_tx_announced`, because that's only cleared based on what's in `in_flight` and `process_time` and the txid isn't in either of those anymore.",
      "created_at": "2020-03-31T05:26:37Z",
      "updated_at": "2020-03-31T05:26:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r400651358",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400651358"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4079,
      "original_line": 4079,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400965176",
      "pull_request_review_id": 384798575,
      "id": 400965176,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk2NTE3Ng==",
      "diff_hunk": "@@ -3234,6 +3270,7 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n                     }\n                     state->m_tx_download.m_tx_in_flight.erase(in_flight_it);\n                     state->m_tx_download.m_tx_announced.erase(inv.hash);",
      "path": "src/net_processing.cpp",
      "position": 85,
      "original_position": 85,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": 397928486,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Hmm, that means a peer that sends a NOTFOUND is treated exactly the same as one that just ignores the request; so NOTFOUND is just a \"fyi, I'm never going to respond, so feel free to try someone else\". That... seems like it makes a lot of sense? If we were to ever start punishing peers for (frequently) not responding to tx requests, maybe it would make sense to punish them for (equally frequently) sending notfounds too?",
      "created_at": "2020-03-31T14:36:50Z",
      "updated_at": "2020-03-31T14:36:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r400965176",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400965176"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3272,
      "original_line": 3272,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400967015",
      "pull_request_review_id": 384800998,
      "id": 400967015,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk2NzAxNQ==",
      "diff_hunk": "@@ -344,8 +346,10 @@ struct CNodeState {\n          */\n         std::multimap<std::chrono::microseconds, uint256> m_tx_process_time;\n \n-        //! Store all the transactions a peer has recently announced\n-        std::set<uint256> m_tx_announced;\n+        /* Store all the transactions a peer has recently announced,",
      "path": "src/net_processing.cpp",
      "position": 15,
      "original_position": 15,
      "commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "original_commit_id": "a204d1586ca9e8f2d7b3951358fa5e63faa1810b",
      "in_reply_to_id": 398212938,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I was having a go at it too when I saw your comment, https://github.com/ajtowns/bitcoin/commits/202002-bump-notfound-wip -- separates out the current code into the class first, before changing it, which I think works better. Might be good to have some comments/style nits on the refactor?",
      "created_at": "2020-03-31T14:39:10Z",
      "updated_at": "2020-03-31T14:39:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18238#discussion_r400967015",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400967015"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18238"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 349,
      "original_line": 349,
      "side": "RIGHT"
    }
  ]
}