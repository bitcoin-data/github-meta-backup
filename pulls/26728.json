{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728",
    "id": 1171436909,
    "node_id": "PR_kwDOABII585F0rVt",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/26728",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/26728.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/26728.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26728",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26728/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
    "number": 26728,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "wallet: Have the wallet store the key for automatically generated descriptors",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The wallet currently does not know the master key that was used to generate the automatically generated descriptors. This makes it difficult to add new automatically generated descriptors when new ones are introduced. So instead of losing this information after the descriptors are created, have `CWallet` store it.\r\n\r\nThis allows us to have a `getxpub` command which is useful for those who need a simple way to get an xpub from a wallet. `getxpub` can also take a boolean parameter to indicate whether it should also output the corresponding xprv.\r\n\r\nSupercedes #23417",
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "created_at": "2022-12-19T22:31:05Z",
    "updated_at": "2023-06-07T16:52:24Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "3eb34666278ea8b94b558f762f93894460d50bec",
    "assignees": [],
    "requested_reviewers": [
      {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      }
    ],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "achow101:wallet-knows-master-key",
      "ref": "wallet-knows-master-key",
      "sha": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 45006379,
        "node_id": "MDEwOlJlcG9zaXRvcnk0NTAwNjM3OQ==",
        "name": "bitcoin",
        "full_name": "achow101/bitcoin",
        "owner": {
          "login": "achow101",
          "id": 3782274,
          "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/achow101",
          "html_url": "https://github.com/achow101",
          "followers_url": "https://api.github.com/users/achow101/followers",
          "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
          "organizations_url": "https://api.github.com/users/achow101/orgs",
          "repos_url": "https://api.github.com/users/achow101/repos",
          "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/achow101/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/achow101/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/achow101/bitcoin",
        "archive_url": "https://api.github.com/repos/achow101/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/achow101/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/achow101/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/achow101/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/achow101/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/achow101/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/achow101/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/achow101/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/achow101/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/achow101/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/achow101/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/achow101/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/achow101/bitcoin/events",
        "forks_url": "https://api.github.com/repos/achow101/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/achow101/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/achow101/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/achow101/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/achow101/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/achow101/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/achow101/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/achow101/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/achow101/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/achow101/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/achow101/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/achow101/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/achow101/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/achow101/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/achow101/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/achow101/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:achow101/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/achow101/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/achow101/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/achow101/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/achow101/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/achow101/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/achow101/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/achow101/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/achow101/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/achow101/bitcoin/hooks",
        "svn_url": "https://github.com/achow101/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 10,
        "stargazers_count": 34,
        "watchers_count": 34,
        "size": 239097,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-07T07:15:28Z",
        "created_at": "2015-10-27T00:20:28Z",
        "updated_at": "2023-05-16T00:18:41Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "da9f62f912294de07a595df0b4898aba4be6b69c",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 34342,
        "stargazers_count": 69825,
        "watchers_count": 69825,
        "size": 234259,
        "default_branch": "master",
        "open_issues_count": 627,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-07T15:59:50Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-06-07T15:20:57Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 584,
    "deletions": 28,
    "changed_files": 14,
    "commits": 14,
    "review_comments": 82,
    "comments": 7
  },
  "events": [
    {
      "event": "commented",
      "id": 1358496197,
      "node_id": "IC_kwDOABII585Q-QHF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1358496197",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-12-19T22:31:08Z",
      "updated_at": "2023-06-07T07:16:04Z",
      "author_association": "MEMBER",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [Sjors](https://github.com/bitcoin/bitcoin/pull/26728#pullrequestreview-1462675329), [S3RK](https://github.com/bitcoin/bitcoin/pull/26728#issuecomment-1580076237) |\n| Approach ACK | [w0xlt](https://github.com/bitcoin/bitcoin/pull/26728#pullrequestreview-1242740987) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27827](https://github.com/bitcoin/bitcoin/pull/27827) ([Silent Payments]: Base functionality by josibake)\n* [#27286](https://github.com/bitcoin/bitcoin/pull/27286) (wallet: Keep track of the wallet's own transaction outputs in memory by achow101)\n* [#26008](https://github.com/bitcoin/bitcoin/pull/26008) (wallet: cache IsMine scriptPubKeys to improve performance of descriptor wallets by achow101)\n* [#25907](https://github.com/bitcoin/bitcoin/pull/25907) (wallet: rpc to add automatically generated descriptors by achow101)\n* [#24914](https://github.com/bitcoin/bitcoin/pull/24914) (wallet: Load database records in a particular order by achow101)\n* [#22838](https://github.com/bitcoin/bitcoin/pull/22838) (descriptors: Be able to specify change and receiving in a single descriptor string by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#issuecomment-1358496197",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26728"
    },
    {
      "event": "labeled",
      "id": 8073446369,
      "node_id": "LE_lADOABII585ZoLDCzwAAAAHhNwPh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8073446369",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-12-19T22:31:09Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "ready_for_review",
      "id": 8073447216,
      "node_id": "RFRE_lADOABII585ZoLDCzwAAAAHhNwcw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8073447216",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-12-19T22:31:21Z"
    },
    {
      "event": "review_requested",
      "id": 8073447845,
      "node_id": "RRE_lADOABII585ZoLDCzwAAAAHhNwml",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8073447845",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-12-19T22:31:31Z",
      "requested_reviewer": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 8073487114,
      "node_id": "HRFPE_lADOABII585ZoLDCzwAAAAHhN6MK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8073487114",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-12-19T22:41:16Z"
    },
    {
      "event": "reviewed",
      "id": 1224244919,
      "node_id": "PRR_kwDOABII585I-H63",
      "url": null,
      "actor": null,
      "commit_id": "4b9ac3e12ba834a4d346fce7a2b23ffcbb854183",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "aureleoules",
        "id": 22493292,
        "node_id": "MDQ6VXNlcjIyNDkzMjky",
        "avatar_url": "https://avatars.githubusercontent.com/u/22493292?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/aureleoules",
        "html_url": "https://github.com/aureleoules",
        "followers_url": "https://api.github.com/users/aureleoules/followers",
        "following_url": "https://api.github.com/users/aureleoules/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/aureleoules/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/aureleoules/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/aureleoules/subscriptions",
        "organizations_url": "https://api.github.com/users/aureleoules/orgs",
        "repos_url": "https://api.github.com/users/aureleoules/repos",
        "events_url": "https://api.github.com/users/aureleoules/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/aureleoules/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#pullrequestreview-1224244919",
      "submitted_at": "2022-12-20T10:46:16Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 8081286715,
      "node_id": "HRFPE_lADOABII585ZoLDCzwAAAAHhrqY7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8081286715",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-12-20T19:35:24Z"
    },
    {
      "event": "reviewed",
      "id": 1242740987,
      "node_id": "PRR_kwDOABII585KErj7",
      "url": null,
      "actor": null,
      "commit_id": "b756f221ccf9885ee08e6a7d20ed54364c6dda93",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Approach ACK",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#pullrequestreview-1242740987",
      "submitted_at": "2023-01-10T18:08:56Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
    },
    {
      "event": "reviewed",
      "id": 1253050078,
      "node_id": "PRR_kwDOABII585KsAbe",
      "url": null,
      "actor": null,
      "commit_id": "b756f221ccf9885ee08e6a7d20ed54364c6dda93",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Thank you for taking your time to rework #23417. It looks like a great improvement\r\nI left some high-level comments inline and will continue with more in depth review.",
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#pullrequestreview-1253050078",
      "submitted_at": "2023-01-18T08:57:47Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
    },
    {
      "event": "reviewed",
      "id": 1261822920,
      "node_id": "PRR_kwDOABII585LNePI",
      "url": null,
      "actor": null,
      "commit_id": "b756f221ccf9885ee08e6a7d20ed54364c6dda93",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Concept ACK. Here's my initial code review (b756f221ccf9885ee08e6a7d20ed54364c6dda93).",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#pullrequestreview-1261822920",
      "submitted_at": "2023-01-19T18:00:59Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 8349213734,
      "node_id": "HRFPE_lADOABII585ZoLDCzwAAAAHxpuQm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8349213734",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-24T22:02:03Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 8357174002,
      "node_id": "HRFPE_lADOABII585ZoLDCzwAAAAHyIFry",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8357174002",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-25T17:37:25Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 8367073730,
      "node_id": "HRFPE_lADOABII585ZoLDCzwAAAAHyt2nC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8367073730",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-26T19:13:50Z"
    },
    {
      "event": "reviewed",
      "id": 1273008737,
      "node_id": "PRR_kwDOABII585L4JJh",
      "url": null,
      "actor": null,
      "commit_id": "0c4b2bc6878b0928e545a8f0468818e98e4aae33",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Changes look good, but I still have to study 8f9c7b90bc0971bc48f3fc655267078650e0cbbd and 9ec69417b3ac88ebf6dc719b7571ea0cdb327e13 more. Thanks for the clarification via IRC. ",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#pullrequestreview-1273008737",
      "submitted_at": "2023-01-27T17:45:37Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
    },
    {
      "event": "commented",
      "id": 1426336389,
      "node_id": "IC_kwDOABII585VBCqF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1426336389",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-10T20:57:55Z",
      "updated_at": "2023-02-10T20:57:55Z",
      "author_association": "MEMBER",
      "body": "At the 2023-01-27 IRC meeting, we discussed the key rotation aspect of this PR. The conclusion was that we could not think of a use case for key rotation that is not sufficiently covered by creating a new wallet.\r\n\r\nSince this PR does not introduce the ability for users to explicitly rotate keys, I don't think there's anything to change to meet this conclusion. Those updates will be in #25907.\r\n\r\nIt's currently possible to rotate keys by encrypting the wallet. Since this is a longstanding behavior that has several tests expecting this behavior, I've decided to leave it in. Removing this behavior has more issues than not introducing explicit key rotation in descriptor wallets. So I've decided to leave the PR as is.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#issuecomment-1426336389",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26728"
    },
    {
      "event": "commented",
      "id": 1426688833,
      "node_id": "IC_kwDOABII585VCYtB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1426688833",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-11T10:29:17Z",
      "updated_at": "2023-02-11T10:29:17Z",
      "author_association": "MEMBER",
      "body": "We should add a warning in the release notes that, although you can safely downgrade the node, you should _not_ encrypt the wallet while using that older version. And add a test that shows what happens.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#issuecomment-1426688833",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26728"
    },
    {
      "event": "reviewed",
      "id": 1296430598,
      "node_id": "PRR_kwDOABII585NRfYG",
      "url": null,
      "actor": null,
      "commit_id": "0c4b2bc6878b0928e545a8f0468818e98e4aae33",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "john-moffett",
        "id": 116917595,
        "node_id": "U_kgDOBvgFWw",
        "avatar_url": "https://avatars.githubusercontent.com/u/116917595?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/john-moffett",
        "html_url": "https://github.com/john-moffett",
        "followers_url": "https://api.github.com/users/john-moffett/followers",
        "following_url": "https://api.github.com/users/john-moffett/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/john-moffett/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/john-moffett/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/john-moffett/subscriptions",
        "organizations_url": "https://api.github.com/users/john-moffett/orgs",
        "repos_url": "https://api.github.com/users/john-moffett/repos",
        "events_url": "https://api.github.com/users/john-moffett/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/john-moffett/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#pullrequestreview-1296430598",
      "submitted_at": "2023-02-13T20:59:53Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
    },
    {
      "event": "labeled",
      "id": 8619003113,
      "node_id": "LE_lADOABII585ZoLDCzwAAAAIBu4zp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8619003113",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-27T18:32:28Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 8638530647,
      "node_id": "HRFPE_lADOABII585ZoLDCzwAAAAIC5YRX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8638530647",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-01T13:57:06Z"
    },
    {
      "event": "commented",
      "id": 1450281652,
      "node_id": "IC_kwDOABII585WcYq0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1450281652",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-01T14:54:08Z",
      "updated_at": "2023-03-01T14:54:08Z",
      "author_association": "MEMBER",
      "body": "Checked the rebase to 3d50555ec6d47f7ebdd1b74739f00a0385be1fab. I still have to study a14a7554a6 and 6bb3bee37e more.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#issuecomment-1450281652",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26728"
    },
    {
      "event": "unlabeled",
      "id": 8639408351,
      "node_id": "UNLE_lADOABII585ZoLDCzwAAAAIC8ujf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8639408351",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-01T15:14:54Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1320105973,
      "node_id": "PRR_kwDOABII585Orzf1",
      "url": null,
      "actor": null,
      "commit_id": "6bb3bee37e90160155bed94d628648134fe40ef9",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#pullrequestreview-1320105973",
      "submitted_at": "2023-03-01T15:37:06Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 8759868193,
      "node_id": "HRFPE_lADOABII585ZoLDCzwAAAAIKIPsh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8759868193",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-15T20:10:47Z"
    },
    {
      "event": "commented",
      "id": 1489825161,
      "node_id": "IC_kwDOABII585YzO2J",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1489825161",
      "actor": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-30T07:27:15Z",
      "updated_at": "2023-03-30T07:27:15Z",
      "author_association": "MEMBER",
      "body": "Approach ACK.\r\n\r\nDoing a proper code review now. Have a question about the upgrade. What do you think we should do in the following situation?\r\n\r\n- Create a blank wallet with master branch\r\n- import 6 descriptors derived from the same key. `WALLET_FLAG_GLOBAL_HD_KEY` is not set and no master key \r\n- `getxpub` reports \"This wallet does not have an active xpub\"\r\n- reload the wallet. Upgrade code is triggered, it sets the flag and the master key\r\n\r\nThis will become even more confusing when/if we later introduce `addedseed` and/or `manual` wallets. I think it's better to reduce the amount of magic and only trigger upgrades for wallets created with older versions. Maybe we can set `WALLET_FLAG_GLOBAL_HD_KEY` for all new wallets even those that are blank?",
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#issuecomment-1489825161",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26728"
    },
    {
      "event": "reviewed",
      "id": 1368451328,
      "node_id": "PRR_kwDOABII585RkOkA",
      "url": null,
      "actor": null,
      "commit_id": "5c14ed0fcebb829d6b232220e78fbf1fcbbd54c1",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Did some review of 0571caf6324549e2b840e58d8b11c3d31973a7c4",
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#pullrequestreview-1368451328",
      "submitted_at": "2023-04-03T08:15:15Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 8964625878,
      "node_id": "HRFPE_lADOABII585ZoLDCzwAAAAIWVVXW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8964625878",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-10T15:16:58Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9148385311,
      "node_id": "HRFPE_lADOABII585ZoLDCzwAAAAIhSUgf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9148385311",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-02T17:59:22Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDFhMzFhN2E3MjUwZDIzMDczYTFmMTM3MWRmMTM4MTQwMjgwOTE3Y2U",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1a31a7a7250d23073a1f1371df138140280917ce",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/1a31a7a7250d23073a1f1371df138140280917ce",
      "tree": {
        "sha": "98923aef070ad8727cbf11dfdf2c12cf0b11a6bb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/98923aef070ad8727cbf11dfdf2c12cf0b11a6bb"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/da9f62f912294de07a595df0b4898aba4be6b69c",
          "sha": "da9f62f912294de07a595df0b4898aba4be6b69c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/da9f62f912294de07a595df0b4898aba4be6b69c"
        }
      ],
      "message": "walletdb: Refactor privkey checksum calc",
      "committer": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2023-05-02T18:13:10Z"
      },
      "author": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2023-01-24T21:06:40Z"
      },
      "sha": "1a31a7a7250d23073a1f1371df138140280917ce"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDU1ODUwZjVhYzJmOGMzYjRiZWZmMDBmMzlhZjljN2U1MDJkNGQxNmI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/55850f5ac2f8c3b4beff00f39af9c7e502d4d16b",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/55850f5ac2f8c3b4beff00f39af9c7e502d4d16b",
      "tree": {
        "sha": "eed43b22b3fb8e0719318d2259940ac2b6775c6c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/eed43b22b3fb8e0719318d2259940ac2b6775c6c"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1a31a7a7250d23073a1f1371df138140280917ce",
          "sha": "1a31a7a7250d23073a1f1371df138140280917ce",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/1a31a7a7250d23073a1f1371df138140280917ce"
        }
      ],
      "message": "walletdb: Add writing activehdkey, hdkey, and hdckey records",
      "committer": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2023-05-02T18:13:10Z"
      },
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2022-12-19T19:26:06Z"
      },
      "sha": "55850f5ac2f8c3b4beff00f39af9c7e502d4d16b"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGIxMDBkZGI3ZmM3ZjJlNTcxZWJjNWQ1ZTJjODJlNGNkYjU1MWQwMzI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b100ddb7fc7f2e571ebc5d5e2c82e4cdb551d032",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b100ddb7fc7f2e571ebc5d5e2c82e4cdb551d032",
      "tree": {
        "sha": "beae50c1cfa4fd67fa6db232fdc8eb51c25a6fa0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/beae50c1cfa4fd67fa6db232fdc8eb51c25a6fa0"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/55850f5ac2f8c3b4beff00f39af9c7e502d4d16b",
          "sha": "55850f5ac2f8c3b4beff00f39af9c7e502d4d16b",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/55850f5ac2f8c3b4beff00f39af9c7e502d4d16b"
        }
      ],
      "message": "walletdb: Read activehdkey, hdkey, and hdckey records",
      "committer": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2023-05-02T18:13:10Z"
      },
      "author": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2022-12-19T19:41:32Z"
      },
      "sha": "b100ddb7fc7f2e571ebc5d5e2c82e4cdb551d032"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDgxZjUzNWY3NDFmYWJhOGJiZDExNTk4NDA3ZDNhN2JhMjgxZWI2MDA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/81f535f741faba8bbd11598407d3a7ba281eb600",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/81f535f741faba8bbd11598407d3a7ba281eb600",
      "tree": {
        "sha": "03c11a3031b2e97256ccb830cc83b2382abf551b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/03c11a3031b2e97256ccb830cc83b2382abf551b"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b100ddb7fc7f2e571ebc5d5e2c82e4cdb551d032",
          "sha": "b100ddb7fc7f2e571ebc5d5e2c82e4cdb551d032",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b100ddb7fc7f2e571ebc5d5e2c82e4cdb551d032"
        }
      ],
      "message": "wallet: Load activehdkey, hdkey, and hdckey",
      "committer": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2023-05-02T18:13:10Z"
      },
      "author": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2022-12-19T19:56:29Z"
      },
      "sha": "81f535f741faba8bbd11598407d3a7ba281eb600"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGU4OWZjMGI2MTU0MTIwYzkyNzIyMTAxNDk0MmY2ODQwOTBmMTcwMWM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e89fc0b6154120c927221014942f684090f1701c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/e89fc0b6154120c927221014942f684090f1701c",
      "tree": {
        "sha": "67b18d1e6928c2c03f7d9982c82cc3de2f265d02",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/67b18d1e6928c2c03f7d9982c82cc3de2f265d02"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/81f535f741faba8bbd11598407d3a7ba281eb600",
          "sha": "81f535f741faba8bbd11598407d3a7ba281eb600",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/81f535f741faba8bbd11598407d3a7ba281eb600"
        }
      ],
      "message": "wallet: Store master key used for automatically generated descriptors",
      "committer": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2023-05-02T18:13:10Z"
      },
      "author": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2022-12-19T20:12:08Z"
      },
      "sha": "e89fc0b6154120c927221014942f684090f1701c"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDVhZmNiMTQxZjA5ODJhNmY4YTJiYWNiYjFjOTkxOGQ1MjlmMTY2YjE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5afcb141f0982a6f8a2bacbb1c9918d529f166b1",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5afcb141f0982a6f8a2bacbb1c9918d529f166b1",
      "tree": {
        "sha": "2ddb308f43981835de6ea43637b6d91bec77b683",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2ddb308f43981835de6ea43637b6d91bec77b683"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e89fc0b6154120c927221014942f684090f1701c",
          "sha": "e89fc0b6154120c927221014942f684090f1701c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/e89fc0b6154120c927221014942f684090f1701c"
        }
      ],
      "message": "wallet: Encrypt HD keys too",
      "committer": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2023-05-02T18:13:10Z"
      },
      "author": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2022-12-19T20:24:19Z"
      },
      "sha": "5afcb141f0982a6f8a2bacbb1c9918d529f166b1"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDM2ZTgwODk1NDBlZmNlYTk3ZTRhNzMxMTkyNGJlYjg3YjBmOGZiOWU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/36e8089540efcea97e4a7311924beb87b0f8fb9e",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/36e8089540efcea97e4a7311924beb87b0f8fb9e",
      "tree": {
        "sha": "24884d77e0a105bd3b5c651a35afb4999f919e14",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/24884d77e0a105bd3b5c651a35afb4999f919e14"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5afcb141f0982a6f8a2bacbb1c9918d529f166b1",
          "sha": "5afcb141f0982a6f8a2bacbb1c9918d529f166b1",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5afcb141f0982a6f8a2bacbb1c9918d529f166b1"
        }
      ],
      "message": "wallet: Retrieve active hd pubkey",
      "committer": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2023-05-02T18:13:10Z"
      },
      "author": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2022-12-19T20:33:45Z"
      },
      "sha": "36e8089540efcea97e4a7311924beb87b0f8fb9e"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDFjYjJlNTI2ZWFhNDg0MWFjOTk5Njc4OWUzNjBjNzQxOWIwMTBlZWE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1cb2e526eaa4841ac9996789e360c7419b010eea",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/1cb2e526eaa4841ac9996789e360c7419b010eea",
      "tree": {
        "sha": "ef348bda18ae4e3593884d6fd25939ecd3560932",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ef348bda18ae4e3593884d6fd25939ecd3560932"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/36e8089540efcea97e4a7311924beb87b0f8fb9e",
          "sha": "36e8089540efcea97e4a7311924beb87b0f8fb9e",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/36e8089540efcea97e4a7311924beb87b0f8fb9e"
        }
      ],
      "message": "key: Add constructor for CExtKey that takes CExtPubKey and CKey\n\nWe often need to construct a CExtKey given an CExtPubKey and CKey, so\nimplement a constructor that does that for us.",
      "committer": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2023-05-02T18:13:10Z"
      },
      "author": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2022-12-19T21:17:04Z"
      },
      "sha": "1cb2e526eaa4841ac9996789e360c7419b010eea"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDQ5ZjU1ZWQyZDhhNjRkZTM3OTgxNjNjOTJiYjMzZWYwOTI1NTM1M2Q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/49f55ed2d8a64de3798163c92bb33ef09255353d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/49f55ed2d8a64de3798163c92bb33ef09255353d",
      "tree": {
        "sha": "9209545d1a0856c91e14eeeb50afe5a93feecca7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9209545d1a0856c91e14eeeb50afe5a93feecca7"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1cb2e526eaa4841ac9996789e360c7419b010eea",
          "sha": "1cb2e526eaa4841ac9996789e360c7419b010eea",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/1cb2e526eaa4841ac9996789e360c7419b010eea"
        }
      ],
      "message": "wallet: Implement GetHDKey to retrieve hd private keys",
      "committer": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2023-05-02T18:13:10Z"
      },
      "author": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2022-12-19T20:51:01Z"
      },
      "sha": "49f55ed2d8a64de3798163c92bb33ef09255353d"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGQyMjQ5ODQ3YzMxMTYwNDAxZTY0NTM4MDUxMjUxMTJmYTg5MjU5ZDE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d2249847c31160401e6453805125112fa89259d1",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/d2249847c31160401e6453805125112fa89259d1",
      "tree": {
        "sha": "b946656de548658cbae59ea895b800ff088fe020",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b946656de548658cbae59ea895b800ff088fe020"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/49f55ed2d8a64de3798163c92bb33ef09255353d",
          "sha": "49f55ed2d8a64de3798163c92bb33ef09255353d",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/49f55ed2d8a64de3798163c92bb33ef09255353d"
        }
      ],
      "message": "wallet, rpc: Add getxpub RPC",
      "committer": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2023-05-02T18:13:10Z"
      },
      "author": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2022-12-19T20:34:16Z"
      },
      "sha": "d2249847c31160401e6453805125112fa89259d1"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDcwYTJiYjc1NDQyZGFhZWY1Njg1NzI4YjRiMDNjN2IyZmU0OWZkMzg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/70a2bb75442daaef5685728b4b03c7b2fe49fd38",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/70a2bb75442daaef5685728b4b03c7b2fe49fd38",
      "tree": {
        "sha": "4c63fdfdb74d950cbf05c72271980d4e200fc3d1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4c63fdfdb74d950cbf05c72271980d4e200fc3d1"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d2249847c31160401e6453805125112fa89259d1",
          "sha": "d2249847c31160401e6453805125112fa89259d1",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/d2249847c31160401e6453805125112fa89259d1"
        }
      ],
      "message": "descriptor: Be able to get the pubkeys involved in a descriptor",
      "committer": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2023-05-02T18:13:11Z"
      },
      "author": {
        "name": "Andrew Chow",
        "email": "achow101-github@achow101.com",
        "date": "2021-08-02T20:53:25Z"
      },
      "sha": "70a2bb75442daaef5685728b4b03c7b2fe49fd38"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDk1ZDExZjA5YzJjMGQ0YWQ2NmJhMmU0Y2UyZDE1YmU0YzAwMmZiOTQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/95d11f09c2c0d4ad66ba2e4ce2d15be4c002fb94",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/95d11f09c2c0d4ad66ba2e4ce2d15be4c002fb94",
      "tree": {
        "sha": "3761f178ccae6cda474499624584fd733a976af5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3761f178ccae6cda474499624584fd733a976af5"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/70a2bb75442daaef5685728b4b03c7b2fe49fd38",
          "sha": "70a2bb75442daaef5685728b4b03c7b2fe49fd38",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/70a2bb75442daaef5685728b4b03c7b2fe49fd38"
        }
      ],
      "message": "wallet: Automatically upgrade a wallet to have global hd key",
      "committer": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2023-05-02T18:13:11Z"
      },
      "author": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2022-12-19T21:18:32Z"
      },
      "sha": "95d11f09c2c0d4ad66ba2e4ce2d15be4c002fb94"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDkxMmRlODgyYjkxNjhjN2MxODk5MTE4NjM2YWQ0NmRkMmRkMWM3ZmE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/912de882b9168c7c1899118636ad46dd2dd1c7fa",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/912de882b9168c7c1899118636ad46dd2dd1c7fa",
      "tree": {
        "sha": "2767defc5a2ddc22b7f40bed31b712b94e6d751f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2767defc5a2ddc22b7f40bed31b712b94e6d751f"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/95d11f09c2c0d4ad66ba2e4ce2d15be4c002fb94",
          "sha": "95d11f09c2c0d4ad66ba2e4ce2d15be4c002fb94",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/95d11f09c2c0d4ad66ba2e4ce2d15be4c002fb94"
        }
      ],
      "message": "tests: Test for getxpub",
      "committer": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2023-05-02T18:13:11Z"
      },
      "author": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2023-01-24T21:28:55Z"
      },
      "sha": "912de882b9168c7c1899118636ad46dd2dd1c7fa"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGM3OTUzOWZjMjBkOTAyYjVmOWUwOThjYzk5NmM0ZTI3YzhlNWI4YzU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "tree": {
        "sha": "db93e9290440b7697d05539b2a4be716c2485ba6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/db93e9290440b7697d05539b2a4be716c2485ba6"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/912de882b9168c7c1899118636ad46dd2dd1c7fa",
          "sha": "912de882b9168c7c1899118636ad46dd2dd1c7fa",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/912de882b9168c7c1899118636ad46dd2dd1c7fa"
        }
      ],
      "message": "test: Test automatic upgrade of descriptor wallets to have hd key",
      "committer": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2023-05-02T18:13:11Z"
      },
      "author": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2022-12-19T21:53:27Z"
      },
      "sha": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9148567471,
      "node_id": "HRFPE_lADOABII585ZoLDCzwAAAAIhTA-v",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9148567471",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-02T18:19:26Z"
    },
    {
      "event": "labeled",
      "id": 9148568253,
      "node_id": "LE_lADOABII585ZoLDCzwAAAAIhTBK9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9148568253",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-02T18:19:32Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 9150196778,
      "node_id": "UNLE_lADOABII585ZoLDCzwAAAAIhZOwq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9150196778",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-02T22:02:39Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1429990749,
      "node_id": "PRR_kwDOABII585VO-1d",
      "url": null,
      "actor": null,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#pullrequestreview-1429990749",
      "submitted_at": "2023-05-17T07:25:49Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
    },
    {
      "event": "commented",
      "id": 1550888614,
      "node_id": "IC_kwDOABII585ccK6m",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1550888614",
      "actor": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-17T07:26:28Z",
      "updated_at": "2023-05-17T07:26:28Z",
      "author_association": "MEMBER",
      "body": "Code review ACK c79539fc20d902b5f9e098cc996c4e27c8e5b8c5\r\n\r\nI plan to test this manually a bit later",
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#issuecomment-1550888614",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26728"
    },
    {
      "event": "reviewed",
      "id": 1462675329,
      "node_id": "PRR_kwDOABII585XLqeB",
      "url": null,
      "actor": null,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "utACK c79539fc20d902b5f9e098cc996c4e27c8e5b8c5\r\n\r\nEverything since my last review is a rebase, except 95d11f09c2c0d4ad66ba2e4ce2d15be4c002fb94, so I only re-reviewed that, plus 70a2bb75442daaef5685728b4b03c7b2fe49fd38.\r\n\r\nI'd still like to see a test and/or release note to cover the case where a user upgrades, then downgrades and encrypts their wallet and then upgrades. See https://github.com/bitcoin/bitcoin/pull/26728/commits/95d11f09c2c0d4ad66ba2e4ce2d15be4c002fb94#r1081289252 But it can wait for a followup, since it seems rare.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#pullrequestreview-1462675329",
      "submitted_at": "2023-06-05T15:06:15Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
    },
    {
      "event": "commented",
      "id": 1580076237,
      "node_id": "IC_kwDOABII585eLgzN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1580076237",
      "actor": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-07T07:16:01Z",
      "updated_at": "2023-06-07T07:16:01Z",
      "author_association": "MEMBER",
      "body": "tACK c79539fc20d902b5f9e098cc996c4e27c8e5b8c5\r\n\r\nI found one odd behaviour mentioned in https://github.com/bitcoin/bitcoin/pull/26728#issuecomment-1489825161\r\nEven if you create a wallet with the master branch you still have one opportunity to trigger upgrade procedure\r\n\r\nReproduction steps\r\n* create new blank wallet with master branch\r\n* import 6 descriptors derived from same HD key\r\n* call to `getxpub` says there is no HD key\r\n* reload wallet (this will trigger upgrade procedure)\r\n* call to `getxpub` shows HD key\r\n\r\nNote, if you reload the empty wallet before you imported anything - you lost your chance to upgrade\r\n\r\nMy proposed fix is to disallow upgrade procedure for wallets created with master by setting `WALLET_FLAG_GLOBAL_HD_KEY` for all newborn wallets. Later we want to add a separate method to change HD key anyway to cover that use case.\r\n",
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#issuecomment-1580076237",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26728"
    },
    {
      "event": "review_requested",
      "id": 9461868239,
      "node_id": "RRE_lADOABII585ZoLDCzwAAAAIz-KbP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9461868239",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-07T16:51:59Z",
      "requested_reviewer": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "review_request_removed",
      "id": 9461870950,
      "node_id": "RRRE_lADOABII585ZoLDCzwAAAAIz-LFm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9461870950",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-07T16:52:14Z",
      "requested_reviewer": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "review_requested",
      "id": 9461872620,
      "node_id": "RRE_lADOABII585ZoLDCzwAAAAIz-Lfs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9461872620",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-07T16:52:24Z",
      "requested_reviewer": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      }
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1053153953",
      "pull_request_review_id": 1224244919,
      "id": 1053153953,
      "node_id": "PRRC_kwDOABII584-xdqh",
      "diff_hunk": "@@ -200,6 +200,12 @@ struct PubkeyProvider\n \n     /** Derive a private key, if private data is available in arg. */\n     virtual bool GetPrivKey(int pos, const SigningProvider& arg, CKey& key) const = 0;\n+\n+    /** Return all (extended public keys for this PubkeyProvider\n+     * param[out] pubkeys Any public keys\n+     * param[out] ext_pubs Any extended public keys\n+     */\n+    virtual void GetRootPubkey(std::set<CPubKey>& pubkeys, std::set<CExtPubKey>& ext_pubs) const = 0;",
      "path": "src/script/descriptor.cpp",
      "position": null,
      "original_position": 9,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "3d4e3b9cf3801a93d1a4af62994900b4f69f2edd",
      "in_reply_to_id": null,
      "user": {
        "login": "aureleoules",
        "id": 22493292,
        "node_id": "MDQ6VXNlcjIyNDkzMjky",
        "avatar_url": "https://avatars.githubusercontent.com/u/22493292?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/aureleoules",
        "html_url": "https://github.com/aureleoules",
        "followers_url": "https://api.github.com/users/aureleoules/followers",
        "following_url": "https://api.github.com/users/aureleoules/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/aureleoules/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/aureleoules/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/aureleoules/subscriptions",
        "organizations_url": "https://api.github.com/users/aureleoules/orgs",
        "repos_url": "https://api.github.com/users/aureleoules/repos",
        "events_url": "https://api.github.com/users/aureleoules/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/aureleoules/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "3d4e3b9cf3801a93d1a4af62994900b4f69f2edd\r\nI suggest renaming instances of `Pubkey` to `PubKey` to be consistent with `*PrivKey` functions.\r\n```suggestion\r\n    virtual void GetRootPubKey(std::set<CPubKey>& pubkeys, std::set<CExtPubKey>& ext_pubs) const = 0;\r\n```",
      "created_at": "2022-12-20T10:23:50Z",
      "updated_at": "2022-12-20T10:46:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1053153953",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1053153953"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 208,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1053162065",
      "pull_request_review_id": 1224244919,
      "id": 1053162065,
      "node_id": "PRRC_kwDOABII584-xfpR",
      "diff_hunk": "@@ -332,6 +332,15 @@ bool CKey::Derive(CKey& keyChild, ChainCode &ccChild, unsigned int nChild, const\n     return ret;\n }\n \n+CExtKey::CExtKey(const CExtPubKey& xpub, const CKey& key_in)\n+{\n+    nDepth = xpub.nDepth;\n+    std::copy(xpub.vchFingerprint, xpub.vchFingerprint + sizeof(xpub.vchFingerprint), vchFingerprint);\n+    nChild = xpub.nChild;\n+    chaincode = xpub.chaincode;\n+    key = key_in;\n+}",
      "path": "src/key.cpp",
      "position": null,
      "original_position": 11,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "be4f46edd8c7199b72d3646a1d13cb66d092e43e",
      "in_reply_to_id": null,
      "user": {
        "login": "aureleoules",
        "id": 22493292,
        "node_id": "MDQ6VXNlcjIyNDkzMjky",
        "avatar_url": "https://avatars.githubusercontent.com/u/22493292?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/aureleoules",
        "html_url": "https://github.com/aureleoules",
        "followers_url": "https://api.github.com/users/aureleoules/followers",
        "following_url": "https://api.github.com/users/aureleoules/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/aureleoules/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/aureleoules/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/aureleoules/subscriptions",
        "organizations_url": "https://api.github.com/users/aureleoules/orgs",
        "repos_url": "https://api.github.com/users/aureleoules/repos",
        "events_url": "https://api.github.com/users/aureleoules/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/aureleoules/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "be4f46edd8c7199b72d3646a1d13cb66d092e43e\r\nI suggest using an initialization list.",
      "created_at": "2022-12-20T10:32:22Z",
      "updated_at": "2022-12-20T10:46:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1053162065",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1053162065"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": 335,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 342,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1053171243",
      "pull_request_review_id": 1224244919,
      "id": 1053171243,
      "node_id": "PRRC_kwDOABII584-xh4r",
      "diff_hunk": "@@ -971,6 +1087,106 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         }\n     }\n \n+    // Upgrade to having a wallet hd key\n+    // Find the keys which are used in single key internal and external descriptors with\n+    // the pre-taproot output types\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        std::map<CExtPubKey, std::pair<std::map<std::string, int>, uint64_t>> descs_keys;\n+        std::map<std::string, int> tmpl = {{\"pkh(\", 0}, {\"sh(wpkh(\", 0}, {\"wpkh(\", 0}};\n+\n+        // Find root xpubs used in pkh(), sh(wpkh()), and wpkh() descriptors\n+        for (const auto& spkm : pwallet->GetAllScriptPubKeyMans()) {\n+            const DescriptorScriptPubKeyMan* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+            assert(desc_spkm);\n+            LOCK(desc_spkm->cs_desc_man);\n+            WalletDescriptor w_desc = desc_spkm->GetWalletDescriptor();\n+\n+            if (!w_desc.descriptor->IsRange()) {\n+                continue;\n+            }\n+\n+            std::set<CPubKey> desc_pubkeys;\n+            std::set<CExtPubKey> desc_xpubs;\n+            w_desc.descriptor->GetPubkeys(desc_pubkeys, desc_xpubs);\n+            if (desc_xpubs.size() != 1) {\n+                continue;\n+            }\n+            const CExtPubKey& xpub = *desc_xpubs.begin();\n+\n+            if (descs_keys.count(xpub) == 0) {\n+                descs_keys.emplace(xpub, std::make_pair(tmpl, 0));\n+            }\n+\n+            const std::string desc = w_desc.descriptor->ToString();\n+            if (desc.find(\"pkh(\") == 0) {\n+                descs_keys[xpub].first[\"pkh(\"]++;\n+            } else if (desc.find(\"sh(wpkh(\") == 0) {\n+                descs_keys[xpub].first[\"sh(wpkh(\"]++;\n+            } else if (desc.find(\"wpkh(\") == 0) {\n+                descs_keys[xpub].first[\"wpkh(\"]++;\n+            } else {\n+                continue;\n+            }\n+            if (w_desc.creation_time > descs_keys[xpub].second) {\n+                descs_keys[xpub].second = w_desc.creation_time;\n+            }\n+        }\n+\n+        // Find candidate active xpubs\n+        // These are the ones that are used in 2 pkh(), 2 sh(wpkh()), and 2 wpkh() descriptors\n+        uint64_t best_time = 0;\n+        CExtPubKey best_xpub;\n+        std::map<CKeyID, CExtPubKey> xpubs;\n+        for (const auto& [xpub, info] : descs_keys) {\n+            const auto& [dtypes, desc_time] = info;\n+            bool ok = true;\n+            for (const auto& [dtype, count] : dtypes) {\n+                if (count != 2) {\n+                    ok = false;\n+                    break;\n+                }\n+            }",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 209,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "4b9ac3e12ba834a4d346fce7a2b23ffcbb854183",
      "in_reply_to_id": null,
      "user": {
        "login": "aureleoules",
        "id": 22493292,
        "node_id": "MDQ6VXNlcjIyNDkzMjky",
        "avatar_url": "https://avatars.githubusercontent.com/u/22493292?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/aureleoules",
        "html_url": "https://github.com/aureleoules",
        "followers_url": "https://api.github.com/users/aureleoules/followers",
        "following_url": "https://api.github.com/users/aureleoules/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/aureleoules/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/aureleoules/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/aureleoules/subscriptions",
        "organizations_url": "https://api.github.com/users/aureleoules/orgs",
        "repos_url": "https://api.github.com/users/aureleoules/repos",
        "events_url": "https://api.github.com/users/aureleoules/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/aureleoules/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "3e53cc298ca1037ad2f52c65934a5e71b76f82bd\r\nCould be reduced to:\r\n\r\n```suggestion\r\n            bool ok = std::all_of(dtypes.begin(), dtypes.end(), [](const auto& p) { return p.second == 2; });\r\n```",
      "created_at": "2022-12-20T10:41:34Z",
      "updated_at": "2022-12-20T10:46:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1053171243",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1053171243"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": 1145,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1151,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1053679048",
      "pull_request_review_id": 1225032676,
      "id": 1053679048,
      "node_id": "PRRC_kwDOABII584-zd3I",
      "diff_hunk": "@@ -200,6 +200,12 @@ struct PubkeyProvider\n \n     /** Derive a private key, if private data is available in arg. */\n     virtual bool GetPrivKey(int pos, const SigningProvider& arg, CKey& key) const = 0;\n+\n+    /** Return all (extended public keys for this PubkeyProvider\n+     * param[out] pubkeys Any public keys\n+     * param[out] ext_pubs Any extended public keys\n+     */\n+    virtual void GetRootPubkey(std::set<CPubKey>& pubkeys, std::set<CExtPubKey>& ext_pubs) const = 0;",
      "path": "src/script/descriptor.cpp",
      "position": null,
      "original_position": 9,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "3d4e3b9cf3801a93d1a4af62994900b4f69f2edd",
      "in_reply_to_id": 1053153953,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2022-12-20T19:35:23Z",
      "updated_at": "2022-12-20T19:35:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1053679048",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1053679048"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 208,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1053679088",
      "pull_request_review_id": 1225032750,
      "id": 1053679088,
      "node_id": "PRRC_kwDOABII584-zd3w",
      "diff_hunk": "@@ -332,6 +332,15 @@ bool CKey::Derive(CKey& keyChild, ChainCode &ccChild, unsigned int nChild, const\n     return ret;\n }\n \n+CExtKey::CExtKey(const CExtPubKey& xpub, const CKey& key_in)\n+{\n+    nDepth = xpub.nDepth;\n+    std::copy(xpub.vchFingerprint, xpub.vchFingerprint + sizeof(xpub.vchFingerprint), vchFingerprint);\n+    nChild = xpub.nChild;\n+    chaincode = xpub.chaincode;\n+    key = key_in;\n+}",
      "path": "src/key.cpp",
      "position": null,
      "original_position": 11,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "be4f46edd8c7199b72d3646a1d13cb66d092e43e",
      "in_reply_to_id": 1053162065,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2022-12-20T19:35:27Z",
      "updated_at": "2022-12-20T19:35:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1053679088",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1053679088"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": 335,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 342,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1053679126",
      "pull_request_review_id": 1225032805,
      "id": 1053679126,
      "node_id": "PRRC_kwDOABII584-zd4W",
      "diff_hunk": "@@ -971,6 +1087,106 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         }\n     }\n \n+    // Upgrade to having a wallet hd key\n+    // Find the keys which are used in single key internal and external descriptors with\n+    // the pre-taproot output types\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        std::map<CExtPubKey, std::pair<std::map<std::string, int>, uint64_t>> descs_keys;\n+        std::map<std::string, int> tmpl = {{\"pkh(\", 0}, {\"sh(wpkh(\", 0}, {\"wpkh(\", 0}};\n+\n+        // Find root xpubs used in pkh(), sh(wpkh()), and wpkh() descriptors\n+        for (const auto& spkm : pwallet->GetAllScriptPubKeyMans()) {\n+            const DescriptorScriptPubKeyMan* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+            assert(desc_spkm);\n+            LOCK(desc_spkm->cs_desc_man);\n+            WalletDescriptor w_desc = desc_spkm->GetWalletDescriptor();\n+\n+            if (!w_desc.descriptor->IsRange()) {\n+                continue;\n+            }\n+\n+            std::set<CPubKey> desc_pubkeys;\n+            std::set<CExtPubKey> desc_xpubs;\n+            w_desc.descriptor->GetPubkeys(desc_pubkeys, desc_xpubs);\n+            if (desc_xpubs.size() != 1) {\n+                continue;\n+            }\n+            const CExtPubKey& xpub = *desc_xpubs.begin();\n+\n+            if (descs_keys.count(xpub) == 0) {\n+                descs_keys.emplace(xpub, std::make_pair(tmpl, 0));\n+            }\n+\n+            const std::string desc = w_desc.descriptor->ToString();\n+            if (desc.find(\"pkh(\") == 0) {\n+                descs_keys[xpub].first[\"pkh(\"]++;\n+            } else if (desc.find(\"sh(wpkh(\") == 0) {\n+                descs_keys[xpub].first[\"sh(wpkh(\"]++;\n+            } else if (desc.find(\"wpkh(\") == 0) {\n+                descs_keys[xpub].first[\"wpkh(\"]++;\n+            } else {\n+                continue;\n+            }\n+            if (w_desc.creation_time > descs_keys[xpub].second) {\n+                descs_keys[xpub].second = w_desc.creation_time;\n+            }\n+        }\n+\n+        // Find candidate active xpubs\n+        // These are the ones that are used in 2 pkh(), 2 sh(wpkh()), and 2 wpkh() descriptors\n+        uint64_t best_time = 0;\n+        CExtPubKey best_xpub;\n+        std::map<CKeyID, CExtPubKey> xpubs;\n+        for (const auto& [xpub, info] : descs_keys) {\n+            const auto& [dtypes, desc_time] = info;\n+            bool ok = true;\n+            for (const auto& [dtype, count] : dtypes) {\n+                if (count != 2) {\n+                    ok = false;\n+                    break;\n+                }\n+            }",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 209,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "4b9ac3e12ba834a4d346fce7a2b23ffcbb854183",
      "in_reply_to_id": 1053171243,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2022-12-20T19:35:31Z",
      "updated_at": "2022-12-20T19:35:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1053679126",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1053679126"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": 1145,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1151,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073247236",
      "pull_request_review_id": 1253050078,
      "id": 1073247236,
      "node_id": "PRRC_kwDOABII584_-HQE",
      "diff_hunk": "@@ -250,6 +250,12 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     //! the current wallet version: clients below this version are not able to load the wallet\n     int nWalletVersion GUARDED_BY(cs_wallet){FEATURE_BASE};\n \n+    //! The extended public key to be used for new automatically generated descriptors\n+    CExtPubKey m_xpub GUARDED_BY(cs_wallet);\n+    //! The previous and current extended keys that are used for automatically generated descriptors\n+    std::map<CExtPubKey, CKey> m_hd_keys GUARDED_BY(cs_wallet);",
      "path": "src/wallet/wallet.h",
      "position": 7,
      "original_position": 7,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "abac3e3630aa6bdab825ff628fa9389c23eda417",
      "in_reply_to_id": null,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This presupposes that we will and should allow changing active HD key for a given wallet. I'd like to better understand for what use-cases this is needed. ",
      "created_at": "2023-01-18T08:47:57Z",
      "updated_at": "2023-01-18T08:57:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1073247236",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073247236"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 297,
      "original_line": 297,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073249883",
      "pull_request_review_id": 1253050078,
      "id": 1073249883,
      "node_id": "PRRC_kwDOABII584_-H5b",
      "diff_hunk": "@@ -1087,6 +1087,99 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         }\n     }\n \n+    // Upgrade to having a wallet hd key\n+    // Find the keys which are used in single key internal and external descriptors with\n+    // the pre-taproot output types\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        std::map<CExtPubKey, std::pair<std::map<std::string, int>, uint64_t>> descs_keys;\n+        std::map<std::string, int> tmpl = {{\"pkh(\", 0}, {\"sh(wpkh(\", 0}, {\"wpkh(\", 0}};\n+\n+        // Find root xpubs used in pkh(), sh(wpkh()), and wpkh() descriptors\n+        for (const auto& spkm : pwallet->GetAllScriptPubKeyMans()) {\n+            const DescriptorScriptPubKeyMan* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+            assert(desc_spkm);\n+            LOCK(desc_spkm->cs_desc_man);\n+            WalletDescriptor w_desc = desc_spkm->GetWalletDescriptor();\n+\n+            if (!w_desc.descriptor->IsRange()) {\n+                continue;\n+            }\n+\n+            std::set<CPubKey> desc_pubkeys;\n+            std::set<CExtPubKey> desc_xpubs;\n+            w_desc.descriptor->GetPubKeys(desc_pubkeys, desc_xpubs);\n+            if (desc_xpubs.size() != 1) {\n+                continue;\n+            }\n+            const CExtPubKey& xpub = *desc_xpubs.begin();\n+\n+            if (descs_keys.count(xpub) == 0) {\n+                descs_keys.emplace(xpub, std::make_pair(tmpl, 0));\n+            }\n+\n+            const std::string desc = w_desc.descriptor->ToString();\n+            if (desc.find(\"pkh(\") == 0) {\n+                descs_keys[xpub].first[\"pkh(\"]++;\n+            } else if (desc.find(\"sh(wpkh(\") == 0) {\n+                descs_keys[xpub].first[\"sh(wpkh(\"]++;\n+            } else if (desc.find(\"wpkh(\") == 0) {\n+                descs_keys[xpub].first[\"wpkh(\"]++;\n+            } else {\n+                continue;\n+            }\n+            if (w_desc.creation_time > descs_keys[xpub].second) {\n+                descs_keys[xpub].second = w_desc.creation_time;\n+            }\n+        }\n+\n+        // Find candidate active xpubs\n+        // These are the ones that are used in 2 pkh(), 2 sh(wpkh()), and 2 wpkh() descriptors\n+        uint64_t best_time = 0;\n+        CExtPubKey best_xpub;\n+        std::map<CKeyID, CExtPubKey> xpubs;\n+        for (const auto& [xpub, info] : descs_keys) {\n+            const auto& [dtypes, desc_time] = info;\n+            if (std::all_of(dtypes.begin(), dtypes.end(), [](const auto& p) { return p.second == 2; })) {\n+                xpubs.emplace(xpub.pubkey.GetID(), xpub);\n+                if (desc_time > best_time) {\n+                    best_time = desc_time;\n+                    best_xpub = xpub;\n+                }\n+            }\n+        }\n+        if (best_time > 0) {\n+            pwallet->SetActiveHDKey(best_xpub);\n+        }\n+\n+        // Add hd keys\n+        for (const auto& [id_pair, key] : wss.m_descriptor_keys) {\n+            const auto& [desc_id, keyid] = id_pair;\n+\n+            const auto& it = xpubs.find(keyid);\n+            if (it == xpubs.end()) {\n+                continue;\n+            }\n+\n+            CExtKey extkey(it->second, key);\n+            pwallet->AddHDKey(extkey);",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 81,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "9a173470864f44d494e80b1c155d8ebe8c87c406",
      "in_reply_to_id": null,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Probably I don't follow, but it seems we don't need to add all descriptor keys as HD keys to the wallet",
      "created_at": "2023-01-18T08:50:32Z",
      "updated_at": "2023-01-18T08:57:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1073249883",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073249883"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1133,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081278325",
      "pull_request_review_id": 1261822920,
      "id": 1081278325,
      "node_id": "PRRC_kwDOABII585Acv91",
      "diff_hunk": "@@ -250,6 +250,12 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     //! the current wallet version: clients below this version are not able to load the wallet\n     int nWalletVersion GUARDED_BY(cs_wallet){FEATURE_BASE};\n \n+    //! The extended public key to be used for new automatically generated descriptors\n+    CExtPubKey m_xpub GUARDED_BY(cs_wallet);\n+    //! The previous and current extended keys that are used for automatically generated descriptors\n+    std::map<CExtPubKey, CKey> m_hd_keys GUARDED_BY(cs_wallet);",
      "path": "src/wallet/wallet.h",
      "position": 7,
      "original_position": 7,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "abac3e3630aa6bdab825ff628fa9389c23eda417",
      "in_reply_to_id": 1073247236,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "abac3e3630aa6bdab825ff628fa9389c23eda417 There's also the scenario where we generate a new HD key and mark the existing one inactive. We could at that point delete the old `HD(C)KEY` record, in which case `m_hd_key` could just hold one key. Not sure if that's much better. ",
      "created_at": "2023-01-19T13:44:44Z",
      "updated_at": "2023-01-19T18:01:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1081278325",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081278325"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 297,
      "original_line": 297,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081289252",
      "pull_request_review_id": 1261822920,
      "id": 1081289252,
      "node_id": "PRRC_kwDOABII585Acyok",
      "diff_hunk": "@@ -47,6 +47,9 @@ enum WalletFlags : uint64_t {\n     // Indicates that the descriptor cache has been upgraded to cache last hardened xpubs\n     WALLET_FLAG_LAST_HARDENED_XPUB_CACHED = (1ULL << 2),\n \n+    // Indicates that the wallet is capable of having a wallet hd key\n+    WALLET_FLAG_GLOBAL_HD_KEY = (1ULL << 3),",
      "path": "src/wallet/walletutil.h",
      "position": 5,
      "original_position": 5,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "9a173470864f44d494e80b1c155d8ebe8c87c406",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "9a173470864f44d494e80b1c155d8ebe8c87c406: if the user downgrades the node, rotates the master key and then upgrades the node again, `ACTIVEHDKEY` would be pointing to the wrong place. So that's an argument to disallow opening in older wallets?",
      "created_at": "2023-01-19T13:52:09Z",
      "updated_at": "2023-01-19T18:00:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1081289252",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081289252"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 51,
      "original_line": 51,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081559201",
      "pull_request_review_id": 1261822920,
      "id": 1081559201,
      "node_id": "PRRC_kwDOABII585Ad0ih",
      "diff_hunk": "@@ -325,5 +326,35 @@ def run_test(self):\n             wallet = node_v19.get_wallet_rpc(\"w1_v19\")\n             assert wallet.getaddressinfo(address_18075)[\"solvable\"]\n \n+        if self.options.descriptors:\n+            self.log.info(\"Test background upgrading of descriptor wallets to have hd key\")\n+            for node in descriptor_nodes:",
      "path": "test/functional/wallet_backwards_compatibility.py",
      "position": null,
      "original_position": 14,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "b756f221ccf9885ee08e6a7d20ed54364c6dda93",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "b756f221ccf9885ee08e6a7d20ed54364c6dda93: this test will no longer work as advertised once this PR is in a release. Maybe drop the loop, define `node_23` and only use that one? (with a note to bump it to `node_24` if that's added).\r\n\r\nIf we drop the ability to downgrade (see my other comment), that reduces the need to test against multiple versions.",
      "created_at": "2023-01-19T16:59:00Z",
      "updated_at": "2023-01-19T18:00:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1081559201",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081559201"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 331,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081564640",
      "pull_request_review_id": 1261822920,
      "id": 1081564640,
      "node_id": "PRRC_kwDOABII585Ad13g",
      "diff_hunk": "@@ -325,5 +326,35 @@ def run_test(self):\n             wallet = node_v19.get_wallet_rpc(\"w1_v19\")\n             assert wallet.getaddressinfo(address_18075)[\"solvable\"]\n \n+        if self.options.descriptors:\n+            self.log.info(\"Test background upgrading of descriptor wallets to have hd key\")\n+            for node in descriptor_nodes:\n+                # Make the test wallet\n+                node.createwallet(wallet_name=\"hdkeyupgrade\", descriptors=True)",
      "path": "test/functional/wallet_backwards_compatibility.py",
      "position": null,
      "original_position": 16,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "b756f221ccf9885ee08e6a7d20ed54364c6dda93",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "b756f221ccf9885ee08e6a7d20ed54364c6dda93 can you also test the upgrade of a locked wallet?",
      "created_at": "2023-01-19T17:03:54Z",
      "updated_at": "2023-01-19T18:00:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1081564640",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081564640"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 333,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081565832",
      "pull_request_review_id": 1261822920,
      "id": 1081565832,
      "node_id": "PRRC_kwDOABII585Ad2KI",
      "diff_hunk": "@@ -297,6 +300,46 @@ bool WalletBatch::EraseLockedUTXO(const COutPoint& output)\n     return EraseIC(std::make_pair(DBKeys::LOCKED_UTXO, std::make_pair(output.hash, output.n)));\n }\n \n+bool WalletBatch::WriteHDKey(const CExtKey& extkey)\n+{\n+    std::vector<unsigned char> xpub(BIP32_EXTKEY_SIZE);\n+    extkey.Neuter().Encode(xpub.data());\n+\n+    CPrivKey privkey = extkey.key.GetPrivKey();\n+\n+    // hash pubkey/privkey to accelerate wallet load",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 28,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "21166afaa5106ff31aac3914ad117cff21a999d5",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "21166afaa5106ff31aac3914ad117cff21a999d5: maybe move this repetitive stuff into a helper?",
      "created_at": "2023-01-19T17:05:00Z",
      "updated_at": "2023-01-19T18:00:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1081565832",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081565832"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 310,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081585278",
      "pull_request_review_id": 1261822920,
      "id": 1081585278,
      "node_id": "PRRC_kwDOABII585Ad65-",
      "diff_hunk": "@@ -782,6 +782,79 @@ ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\n             ssKey >> hash;\n             ssKey >> n;\n             pwallet->LockCoin(COutPoint(hash, n));\n+        } else if (strType == DBKeys::ACTIVEHDKEY) {\n+            CExtPubKey extpub;\n+            std::vector<unsigned char> xpub(BIP32_EXTKEY_SIZE);\n+            ssValue >> xpub;\n+            extpub.Decode(xpub.data());\n+            if (!extpub.pubkey.IsValid())\n+            {\n+                strErr = \"Error reading wallet database: CExtPubKey corrupt\";\n+                return false;\n+            }\n+            // TODO: Load extpub into the wallet\n+        } else if (strType == DBKeys::HDKEY) {\n+            CExtPubKey extpub;\n+            std::vector<unsigned char> xpub(BIP32_EXTKEY_SIZE);\n+            ssKey >> xpub;\n+            extpub.Decode(xpub.data());\n+            if (!extpub.pubkey.IsValid())\n+            {\n+                strErr = \"Error reading wallet database: CExtPubKey corrupt\";\n+                return false;\n+            }\n+\n+            CKey key;\n+            CPrivKey pkey;\n+            uint256 hash;\n+\n+            wss.nKeys++;\n+            ssValue >> pkey;\n+            ssValue >> hash;\n+\n+            // hash pubkey/privkey to accelerate wallet load\n+            std::vector<unsigned char> to_hash;\n+            to_hash.reserve(xpub.size() + pkey.size());\n+            to_hash.insert(to_hash.end(), xpub.begin(), xpub.end());\n+            to_hash.insert(to_hash.end(), pkey.begin(), pkey.end());\n+\n+            if (Hash(to_hash) != hash)\n+            {\n+                strErr = \"Error reading wallet database: CPubKey/CPrivKey corrupt\";\n+                return false;\n+            }\n+\n+            if (!key.Load(pkey, extpub.pubkey, true))",
      "path": "src/wallet/walletdb.cpp",
      "position": 176,
      "original_position": 46,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "561a8043c6fa41c8f3cdfa57272ca512b6d8ebb2",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "561a8043c6fa41c8f3cdfa57272ca512b6d8ebb2: `CKey`'s `Load()` function already checks that the xpriv match the xpub (mostly). I think that makes the above hash check unnecessary. For good measure we could have a `Load()` function that takes a `CExtPubKey` instead of just a `CPubKey` so it can check the other data stored in the `xpub` too. ",
      "created_at": "2023-01-19T17:19:55Z",
      "updated_at": "2023-01-19T18:01:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1081585278",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081585278"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 821,
      "original_line": 821,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081590764",
      "pull_request_review_id": 1261822920,
      "id": 1081590764,
      "node_id": "PRRC_kwDOABII585Ad8Ps",
      "diff_hunk": "@@ -3573,6 +3573,10 @@ void CWallet::SetupDescriptorScriptPubKeyMans()\n         CExtKey master_key;\n         master_key.SetSeed(seed_key);\n \n+        // Store the master key as our active hd key\n+        SetActiveHDKey(master_key.Neuter());",
      "path": "src/wallet/wallet.cpp",
      "position": 156,
      "original_position": 5,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "8b0af8a56ffe31edcd2ed98d795a63fd302ae67a",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "8b0af8a56ffe31edcd2ed98d795a63fd302ae67a: a (future) sanity check may want to prevent calling `SetActiveHDKey` and `AddHDKey` in this order, especially since the latter can fail.",
      "created_at": "2023-01-19T17:23:06Z",
      "updated_at": "2023-01-19T18:01:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1081590764",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081590764"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3718,
      "original_line": 3718,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081592726",
      "pull_request_review_id": 1261822920,
      "id": 1081592726,
      "node_id": "PRRC_kwDOABII585Ad8uW",
      "diff_hunk": "@@ -3573,6 +3573,10 @@ void CWallet::SetupDescriptorScriptPubKeyMans()\n         CExtKey master_key;\n         master_key.SetSeed(seed_key);\n \n+        // Store the master key as our active hd key\n+        SetActiveHDKey(master_key.Neuter());\n+        AddHDKey(master_key);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "8b0af8a56ffe31edcd2ed98d795a63fd302ae67a",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "8b0af8a56ffe31edcd2ed98d795a63fd302ae67a: this function can fail, so let's not ignore the return value.",
      "created_at": "2023-01-19T17:24:45Z",
      "updated_at": "2023-01-19T18:01:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1081592726",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081592726"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3578,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081595596",
      "pull_request_review_id": 1261822920,
      "id": 1081595596,
      "node_id": "PRRC_kwDOABII585Ad9bM",
      "diff_hunk": "@@ -809,6 +809,25 @@ bool CWallet::EncryptWallet(const SecureString& strWalletPassphrase)\n             }\n         }\n \n+        // Encrypt the HD keys\n+        assert(m_hd_crypted_keys.empty());\n+        for (const auto& [xpub, key] : m_hd_keys) {\n+            std::vector<unsigned char> crypted_secret;\n+            CKeyingMaterial secret(key.begin(), key.end());\n+            if (!EncryptSecret(_vMasterKey, secret, xpub.pubkey.GetHash(), crypted_secret)) {\n+                encrypted_batch->TxnAbort();\n+                delete encrypted_batch;\n+                encrypted_batch = nullptr;\n+                // We now probably have half of our keys encrypted in memory, and half not...\n+                // die and let the user reload the unencrypted wallet.",
      "path": "src/wallet/wallet.cpp",
      "position": 136,
      "original_position": 14,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "95da2e9808c57a519023c017ca47d76ebd2632fd",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "95da2e9808c57a519023c017ca47d76ebd2632fd: Maybe log some final words...",
      "created_at": "2023-01-19T17:26:51Z",
      "updated_at": "2023-01-19T18:01:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1081595596",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081595596"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 931,
      "original_line": 931,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081598484",
      "pull_request_review_id": 1261822920,
      "id": 1081598484,
      "node_id": "PRRC_kwDOABII585Ad-IU",
      "diff_hunk": "@@ -953,6 +953,7 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     bool LoadHDKey(const CExtPubKey& xpub, const CKey& key) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n     bool LoadHDCryptedKey(const CExtPubKey& xpub, const std::vector<unsigned char>& crypted_key) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n     bool AddHDKey(const CExtKey& extkey) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n+    std::optional<CExtKey> GetHDKey(const CExtPubKey& xpub) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);",
      "path": "src/wallet/wallet.h",
      "position": 37,
      "original_position": 4,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "18ac74d29cf3f1a8c4f46c4d030968b5596e9b09",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "18ac74d29cf3f1a8c4f46c4d030968b5596e9b09: could use documentation, and clarification that this only works for master keys, not any regular xpub, since this function works by looking through `m_hd(_crypted)_keys` rather than perform derivations.\r\n\r\nAlternatively I might \"upgrade\" it in #22341 to perform derivation, since that's useful. But given the convention of \"hd key\" referring to a master key, a function that performs derivation should probably be called `GetExtendedKey()`",
      "created_at": "2023-01-19T17:29:36Z",
      "updated_at": "2023-01-19T18:01:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1081598484",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081598484"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1009,
      "original_line": 1009,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081603914",
      "pull_request_review_id": 1261822920,
      "id": 1081603914,
      "node_id": "PRRC_kwDOABII585Ad_dK",
      "diff_hunk": "@@ -756,6 +756,61 @@ static RPCHelpMan migratewallet()\n     };\n }\n \n+RPCHelpMan getxpub()",
      "path": "src/wallet/rpc/wallet.cpp",
      "position": 4,
      "original_position": 4,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "436eab602f7d27ad325ebed60e69acbb6dbf2ef5",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Any reason why you're putting this in `rpc/wallet.cpp` rather than `rpc/addresses.cpp` like in #23417?",
      "created_at": "2023-01-19T17:34:58Z",
      "updated_at": "2023-01-19T18:01:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1081603914",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081603914"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 815,
      "original_line": 815,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081605774",
      "pull_request_review_id": 1261822920,
      "id": 1081605774,
      "node_id": "PRRC_kwDOABII585Ad_6O",
      "diff_hunk": "@@ -1087,6 +1087,99 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         }\n     }\n \n+    // Upgrade to having a wallet hd key\n+    // Find the keys which are used in single key internal and external descriptors with\n+    // the pre-taproot output types\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        std::map<CExtPubKey, std::pair<std::map<std::string, int>, uint64_t>> descs_keys;\n+        std::map<std::string, int> tmpl = {{\"pkh(\", 0}, {\"sh(wpkh(\", 0}, {\"wpkh(\", 0}};\n+\n+        // Find root xpubs used in pkh(), sh(wpkh()), and wpkh() descriptors\n+        for (const auto& spkm : pwallet->GetAllScriptPubKeyMans()) {\n+            const DescriptorScriptPubKeyMan* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+            assert(desc_spkm);\n+            LOCK(desc_spkm->cs_desc_man);\n+            WalletDescriptor w_desc = desc_spkm->GetWalletDescriptor();\n+\n+            if (!w_desc.descriptor->IsRange()) {\n+                continue;\n+            }\n+\n+            std::set<CPubKey> desc_pubkeys;\n+            std::set<CExtPubKey> desc_xpubs;\n+            w_desc.descriptor->GetPubKeys(desc_pubkeys, desc_xpubs);\n+            if (desc_xpubs.size() != 1) {\n+                continue;\n+            }\n+            const CExtPubKey& xpub = *desc_xpubs.begin();\n+\n+            if (descs_keys.count(xpub) == 0) {\n+                descs_keys.emplace(xpub, std::make_pair(tmpl, 0));\n+            }\n+\n+            const std::string desc = w_desc.descriptor->ToString();\n+            if (desc.find(\"pkh(\") == 0) {\n+                descs_keys[xpub].first[\"pkh(\"]++;\n+            } else if (desc.find(\"sh(wpkh(\") == 0) {\n+                descs_keys[xpub].first[\"sh(wpkh(\"]++;\n+            } else if (desc.find(\"wpkh(\") == 0) {\n+                descs_keys[xpub].first[\"wpkh(\"]++;\n+            } else {\n+                continue;\n+            }\n+            if (w_desc.creation_time > descs_keys[xpub].second) {\n+                descs_keys[xpub].second = w_desc.creation_time;\n+            }\n+        }\n+\n+        // Find candidate active xpubs\n+        // These are the ones that are used in 2 pkh(), 2 sh(wpkh()), and 2 wpkh() descriptors\n+        uint64_t best_time = 0;\n+        CExtPubKey best_xpub;\n+        std::map<CKeyID, CExtPubKey> xpubs;\n+        for (const auto& [xpub, info] : descs_keys) {\n+            const auto& [dtypes, desc_time] = info;\n+            if (std::all_of(dtypes.begin(), dtypes.end(), [](const auto& p) { return p.second == 2; })) {\n+                xpubs.emplace(xpub.pubkey.GetID(), xpub);\n+                if (desc_time > best_time) {\n+                    best_time = desc_time;\n+                    best_xpub = xpub;\n+                }\n+            }\n+        }\n+        if (best_time > 0) {\n+            pwallet->SetActiveHDKey(best_xpub);\n+        }\n+\n+        // Add hd keys\n+        for (const auto& [id_pair, key] : wss.m_descriptor_keys) {\n+            const auto& [desc_id, keyid] = id_pair;\n+\n+            const auto& it = xpubs.find(keyid);\n+            if (it == xpubs.end()) {\n+                continue;\n+            }\n+\n+            CExtKey extkey(it->second, key);\n+            pwallet->AddHDKey(extkey);",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 81,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "9a173470864f44d494e80b1c155d8ebe8c87c406",
      "in_reply_to_id": 1073249883,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Duplicates are skipped (see 8b0af8a56ffe31edcd2ed98d795a63fd302ae67a).",
      "created_at": "2023-01-19T17:36:57Z",
      "updated_at": "2023-01-19T18:01:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1081605774",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081605774"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1133,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081607073",
      "pull_request_review_id": 1261822920,
      "id": 1081607073,
      "node_id": "PRRC_kwDOABII585AeAOh",
      "diff_hunk": "@@ -147,7 +147,28 @@ def run_test(self):\n         else:\n             assert_equal(keypath[0:7], \"m/0'/1'\")\n \n-        if not self.options.descriptors:\n+        if self.options.descriptors:",
      "path": "test/functional/wallet_hd.py",
      "position": null,
      "original_position": 5,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "1877da9fb564fc6fa7b6c6bc3bcf63bdb29ace7b",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "1877da9fb564fc6fa7b6c6bc3bcf63bdb29ace7b: I'd prefer a new `wallet_getxpub.py` test case that I can expand in #22341.",
      "created_at": "2023-01-19T17:38:16Z",
      "updated_at": "2023-01-19T18:01:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1081607073",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081607073"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 150,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081608280",
      "pull_request_review_id": 1261822920,
      "id": 1081608280,
      "node_id": "PRRC_kwDOABII585AeAhY",
      "diff_hunk": "@@ -200,6 +200,12 @@ struct PubkeyProvider\n \n     /** Derive a private key, if private data is available in arg. */\n     virtual bool GetPrivKey(int pos, const SigningProvider& arg, CKey& key) const = 0;\n+\n+    /** Return all (extended public keys for this PubkeyProvider",
      "path": "src/script/descriptor.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "6072b3964582e6883220f3af678675531299b444",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "6072b3964582e6883220f3af678675531299b444 nit: missing closing bracket",
      "created_at": "2023-01-19T17:39:32Z",
      "updated_at": "2023-01-19T18:01:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1081608280",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081608280"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 204,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081610989",
      "pull_request_review_id": 1261822920,
      "id": 1081610989,
      "node_id": "PRRC_kwDOABII585AeBLt",
      "diff_hunk": "@@ -200,6 +200,12 @@ struct PubkeyProvider\n \n     /** Derive a private key, if private data is available in arg. */\n     virtual bool GetPrivKey(int pos, const SigningProvider& arg, CKey& key) const = 0;\n+\n+    /** Return all (extended public keys for this PubkeyProvider\n+     * param[out] pubkeys Any public keys\n+     * param[out] ext_pubs Any extended public keys\n+     */\n+    virtual void GetRootPubKey(std::set<CPubKey>& pubkeys, std::set<CExtPubKey>& ext_pubs) const = 0;",
      "path": "src/script/descriptor.cpp",
      "position": null,
      "original_position": 9,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "6072b3964582e6883220f3af678675531299b444",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "6072b3964582e6883220f3af678675531299b444 Should this be plural `GetRootPubKeys`? Or maybe keep this function focussed and only return a single `CExtPubKey`?",
      "created_at": "2023-01-19T17:42:12Z",
      "updated_at": "2023-01-19T18:01:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1081610989",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081610989"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 208,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081614403",
      "pull_request_review_id": 1261822920,
      "id": 1081614403,
      "node_id": "PRRC_kwDOABII585AeCBD",
      "diff_hunk": "@@ -146,6 +146,13 @@ struct Descriptor {\n \n     /** @return The OutputType of the scriptPubKey(s) produced by this descriptor. Or nullopt if indeterminate (multiple or none) */\n     virtual std::optional<OutputType> GetOutputType() const = 0;\n+\n+    /** Return all (extended) public keys for this descriptor, including any from subdescriptors.\n+     *\n+     * @param[out] pubkeys Any public keys\n+     * @param[out] ext_pubs Any extended public keys\n+     */\n+    virtual void GetPubKeys(std::set<CPubKey>& pubkeys, std::set<CExtPubKey>& ext_pubs) const = 0;",
      "path": "src/script/descriptor.h",
      "position": 10,
      "original_position": 10,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "6072b3964582e6883220f3af678675531299b444",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "6072b3964582e6883220f3af678675531299b444: why do we care about this, vs only getting a root key?",
      "created_at": "2023-01-19T17:45:19Z",
      "updated_at": "2023-01-19T18:01:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1081614403",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081614403"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 155,
      "original_line": 155,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081620227",
      "pull_request_review_id": 1261822920,
      "id": 1081620227,
      "node_id": "PRRC_kwDOABII585AeDcD",
      "diff_hunk": "@@ -1087,6 +1087,99 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         }\n     }\n \n+    // Upgrade to having a wallet hd key\n+    // Find the keys which are used in single key internal and external descriptors with\n+    // the pre-taproot output types\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        std::map<CExtPubKey, std::pair<std::map<std::string, int>, uint64_t>> descs_keys;\n+        std::map<std::string, int> tmpl = {{\"pkh(\", 0}, {\"sh(wpkh(\", 0}, {\"wpkh(\", 0}};\n+\n+        // Find root xpubs used in pkh(), sh(wpkh()), and wpkh() descriptors\n+        for (const auto& spkm : pwallet->GetAllScriptPubKeyMans()) {\n+            const DescriptorScriptPubKeyMan* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+            assert(desc_spkm);\n+            LOCK(desc_spkm->cs_desc_man);\n+            WalletDescriptor w_desc = desc_spkm->GetWalletDescriptor();\n+\n+            if (!w_desc.descriptor->IsRange()) {\n+                continue;\n+            }\n+\n+            std::set<CPubKey> desc_pubkeys;\n+            std::set<CExtPubKey> desc_xpubs;\n+            w_desc.descriptor->GetPubKeys(desc_pubkeys, desc_xpubs);\n+            if (desc_xpubs.size() != 1) {\n+                continue;\n+            }\n+            const CExtPubKey& xpub = *desc_xpubs.begin();\n+\n+            if (descs_keys.count(xpub) == 0) {\n+                descs_keys.emplace(xpub, std::make_pair(tmpl, 0));\n+            }\n+\n+            const std::string desc = w_desc.descriptor->ToString();\n+            if (desc.find(\"pkh(\") == 0) {\n+                descs_keys[xpub].first[\"pkh(\"]++;\n+            } else if (desc.find(\"sh(wpkh(\") == 0) {\n+                descs_keys[xpub].first[\"sh(wpkh(\"]++;\n+            } else if (desc.find(\"wpkh(\") == 0) {\n+                descs_keys[xpub].first[\"wpkh(\"]++;\n+            } else {\n+                continue;\n+            }\n+            if (w_desc.creation_time > descs_keys[xpub].second) {\n+                descs_keys[xpub].second = w_desc.creation_time;\n+            }\n+        }\n+\n+        // Find candidate active xpubs\n+        // These are the ones that are used in 2 pkh(), 2 sh(wpkh()), and 2 wpkh() descriptors\n+        uint64_t best_time = 0;\n+        CExtPubKey best_xpub;\n+        std::map<CKeyID, CExtPubKey> xpubs;\n+        for (const auto& [xpub, info] : descs_keys) {\n+            const auto& [dtypes, desc_time] = info;\n+            if (std::all_of(dtypes.begin(), dtypes.end(), [](const auto& p) { return p.second == 2; })) {\n+                xpubs.emplace(xpub.pubkey.GetID(), xpub);\n+                if (desc_time > best_time) {\n+                    best_time = desc_time;\n+                    best_xpub = xpub;\n+                }\n+            }\n+        }\n+        if (best_time > 0) {\n+            pwallet->SetActiveHDKey(best_xpub);\n+        }\n+\n+        // Add hd keys\n+        for (const auto& [id_pair, key] : wss.m_descriptor_keys) {\n+            const auto& [desc_id, keyid] = id_pair;\n+\n+            const auto& it = xpubs.find(keyid);\n+            if (it == xpubs.end()) {\n+                continue;\n+            }\n+\n+            CExtKey extkey(it->second, key);\n+            pwallet->AddHDKey(extkey);",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 81,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "9a173470864f44d494e80b1c155d8ebe8c87c406",
      "in_reply_to_id": 1073249883,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "9a173470864f44d494e80b1c155d8ebe8c87c406: this function can fail, and `SetActiveHDKey` should probably called last.",
      "created_at": "2023-01-19T17:50:11Z",
      "updated_at": "2023-01-19T18:01:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1081620227",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081620227"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1133,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081622126",
      "pull_request_review_id": 1261822920,
      "id": 1081622126,
      "node_id": "PRRC_kwDOABII585AeD5u",
      "diff_hunk": "@@ -1087,6 +1087,99 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         }\n     }\n \n+    // Upgrade to having a wallet hd key\n+    // Find the keys which are used in single key internal and external descriptors with\n+    // the pre-taproot output types\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        std::map<CExtPubKey, std::pair<std::map<std::string, int>, uint64_t>> descs_keys;\n+        std::map<std::string, int> tmpl = {{\"pkh(\", 0}, {\"sh(wpkh(\", 0}, {\"wpkh(\", 0}};\n+\n+        // Find root xpubs used in pkh(), sh(wpkh()), and wpkh() descriptors\n+        for (const auto& spkm : pwallet->GetAllScriptPubKeyMans()) {\n+            const DescriptorScriptPubKeyMan* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+            assert(desc_spkm);\n+            LOCK(desc_spkm->cs_desc_man);\n+            WalletDescriptor w_desc = desc_spkm->GetWalletDescriptor();\n+\n+            if (!w_desc.descriptor->IsRange()) {\n+                continue;\n+            }\n+\n+            std::set<CPubKey> desc_pubkeys;\n+            std::set<CExtPubKey> desc_xpubs;\n+            w_desc.descriptor->GetPubKeys(desc_pubkeys, desc_xpubs);\n+            if (desc_xpubs.size() != 1) {\n+                continue;\n+            }\n+            const CExtPubKey& xpub = *desc_xpubs.begin();\n+\n+            if (descs_keys.count(xpub) == 0) {\n+                descs_keys.emplace(xpub, std::make_pair(tmpl, 0));\n+            }\n+\n+            const std::string desc = w_desc.descriptor->ToString();\n+            if (desc.find(\"pkh(\") == 0) {",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 38,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "9a173470864f44d494e80b1c155d8ebe8c87c406",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "9a173470864f44d494e80b1c155d8ebe8c87c406: instead of this string parsing stuff, can we add some method to `Descriptor` to directly get what we need? Even an `enum` with descriptor types seems more clean. \r\n\r\nIf all we need is to find the active HD master key, why not limit the search to `pkh(`? That has the nice benefit of there not potentially being manually inserted descriptors that could be ambiguous).",
      "created_at": "2023-01-19T17:51:55Z",
      "updated_at": "2023-01-19T18:01:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1081622126",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081622126"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1124,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081623995",
      "pull_request_review_id": 1261822920,
      "id": 1081623995,
      "node_id": "PRRC_kwDOABII585AeEW7",
      "diff_hunk": "@@ -1087,6 +1087,99 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         }\n     }\n \n+    // Upgrade to having a wallet hd key\n+    // Find the keys which are used in single key internal and external descriptors with\n+    // the pre-taproot output types",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "9a173470864f44d494e80b1c155d8ebe8c87c406",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "9a173470864f44d494e80b1c155d8ebe8c87c406: what do we do with `tr()` descriptors that have been generated since #22364?",
      "created_at": "2023-01-19T17:53:28Z",
      "updated_at": "2023-01-19T18:01:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1081623995",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081623995"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1064,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081631043",
      "pull_request_review_id": 1261822920,
      "id": 1081631043,
      "node_id": "PRRC_kwDOABII585AeGFD",
      "diff_hunk": "@@ -1087,6 +1087,99 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         }\n     }\n \n+    // Upgrade to having a wallet hd key\n+    // Find the keys which are used in single key internal and external descriptors with\n+    // the pre-taproot output types\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        std::map<CExtPubKey, std::pair<std::map<std::string, int>, uint64_t>> descs_keys;\n+        std::map<std::string, int> tmpl = {{\"pkh(\", 0}, {\"sh(wpkh(\", 0}, {\"wpkh(\", 0}};\n+\n+        // Find root xpubs used in pkh(), sh(wpkh()), and wpkh() descriptors\n+        for (const auto& spkm : pwallet->GetAllScriptPubKeyMans()) {",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 15,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "9a173470864f44d494e80b1c155d8ebe8c87c406",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "9a173470864f44d494e80b1c155d8ebe8c87c406: Why not limit ourselves to `GetActiveScriptPubKeyMans`? Not sure how useful it is to store older HD keys, and it does seem to add some complexity.",
      "created_at": "2023-01-19T17:59:24Z",
      "updated_at": "2023-01-19T18:01:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1081631043",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081631043"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1073,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081705702",
      "pull_request_review_id": 1262443284,
      "id": 1081705702,
      "node_id": "PRRC_kwDOABII585AeYTm",
      "diff_hunk": "@@ -250,6 +250,12 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     //! the current wallet version: clients below this version are not able to load the wallet\n     int nWalletVersion GUARDED_BY(cs_wallet){FEATURE_BASE};\n \n+    //! The extended public key to be used for new automatically generated descriptors\n+    CExtPubKey m_xpub GUARDED_BY(cs_wallet);\n+    //! The previous and current extended keys that are used for automatically generated descriptors\n+    std::map<CExtPubKey, CKey> m_hd_keys GUARDED_BY(cs_wallet);",
      "path": "src/wallet/wallet.h",
      "position": 7,
      "original_position": 7,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "abac3e3630aa6bdab825ff628fa9389c23eda417",
      "in_reply_to_id": 1073247236,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This is exactly what I'm curious about. Should we allow to generate a new HD key for existing wallet? I'm trying to understand why someone would like to generate new HD key for existing wallet instead of just creating a new wallet?\r\n\r\n Or should we make a rule 1 wallet = 1 HD key. Which is much simpler to understand and manage.",
      "created_at": "2023-01-19T19:10:01Z",
      "updated_at": "2023-01-19T19:10:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1081705702",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081705702"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 297,
      "original_line": 297,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081708489",
      "pull_request_review_id": 1262448072,
      "id": 1081708489,
      "node_id": "PRRC_kwDOABII585AeY_J",
      "diff_hunk": "@@ -47,6 +47,9 @@ enum WalletFlags : uint64_t {\n     // Indicates that the descriptor cache has been upgraded to cache last hardened xpubs\n     WALLET_FLAG_LAST_HARDENED_XPUB_CACHED = (1ULL << 2),\n \n+    // Indicates that the wallet is capable of having a wallet hd key\n+    WALLET_FLAG_GLOBAL_HD_KEY = (1ULL << 3),",
      "path": "src/wallet/walletutil.h",
      "position": 5,
      "original_position": 5,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "9a173470864f44d494e80b1c155d8ebe8c87c406",
      "in_reply_to_id": 1081289252,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Older node has no concept of master key for descriptors wallets, so it can't rotate the key. Can it?",
      "created_at": "2023-01-19T19:13:00Z",
      "updated_at": "2023-01-19T19:13:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1081708489",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1081708489"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 51,
      "original_line": 51,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1082319264",
      "pull_request_review_id": 1263267848,
      "id": 1082319264,
      "node_id": "PRRC_kwDOABII585AguGg",
      "diff_hunk": "@@ -47,6 +47,9 @@ enum WalletFlags : uint64_t {\n     // Indicates that the descriptor cache has been upgraded to cache last hardened xpubs\n     WALLET_FLAG_LAST_HARDENED_XPUB_CACHED = (1ULL << 2),\n \n+    // Indicates that the wallet is capable of having a wallet hd key\n+    WALLET_FLAG_GLOBAL_HD_KEY = (1ULL << 3),",
      "path": "src/wallet/walletutil.h",
      "position": 5,
      "original_position": 5,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "9a173470864f44d494e80b1c155d8ebe8c87c406",
      "in_reply_to_id": 1081289252,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "When it encrypts the wallet I think it generates a new set of descriptors based on a new master key.",
      "created_at": "2023-01-20T10:09:48Z",
      "updated_at": "2023-01-20T10:09:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1082319264",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1082319264"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 51,
      "original_line": 51,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085882714",
      "pull_request_review_id": 1268239082,
      "id": 1085882714,
      "node_id": "PRRC_kwDOABII585AuUFa",
      "diff_hunk": "@@ -47,6 +47,9 @@ enum WalletFlags : uint64_t {\n     // Indicates that the descriptor cache has been upgraded to cache last hardened xpubs\n     WALLET_FLAG_LAST_HARDENED_XPUB_CACHED = (1ULL << 2),\n \n+    // Indicates that the wallet is capable of having a wallet hd key\n+    WALLET_FLAG_GLOBAL_HD_KEY = (1ULL << 3),",
      "path": "src/wallet/walletutil.h",
      "position": 5,
      "original_position": 5,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "9a173470864f44d494e80b1c155d8ebe8c87c406",
      "in_reply_to_id": 1081289252,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yes, encrypting is the only way to rotate a master key currently.\r\n\r\nThe issue with changing this to a required flag is that it can no longer be an automatic upgrade. It will need to be an explicit upgrade.",
      "created_at": "2023-01-24T20:22:06Z",
      "updated_at": "2023-01-24T20:22:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1085882714",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085882714"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 51,
      "original_line": 51,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085927071",
      "pull_request_review_id": 1268306116,
      "id": 1085927071,
      "node_id": "PRRC_kwDOABII585Aue6f",
      "diff_hunk": "@@ -782,6 +782,79 @@ ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\n             ssKey >> hash;\n             ssKey >> n;\n             pwallet->LockCoin(COutPoint(hash, n));\n+        } else if (strType == DBKeys::ACTIVEHDKEY) {\n+            CExtPubKey extpub;\n+            std::vector<unsigned char> xpub(BIP32_EXTKEY_SIZE);\n+            ssValue >> xpub;\n+            extpub.Decode(xpub.data());\n+            if (!extpub.pubkey.IsValid())\n+            {\n+                strErr = \"Error reading wallet database: CExtPubKey corrupt\";\n+                return false;\n+            }\n+            // TODO: Load extpub into the wallet\n+        } else if (strType == DBKeys::HDKEY) {\n+            CExtPubKey extpub;\n+            std::vector<unsigned char> xpub(BIP32_EXTKEY_SIZE);\n+            ssKey >> xpub;\n+            extpub.Decode(xpub.data());\n+            if (!extpub.pubkey.IsValid())\n+            {\n+                strErr = \"Error reading wallet database: CExtPubKey corrupt\";\n+                return false;\n+            }\n+\n+            CKey key;\n+            CPrivKey pkey;\n+            uint256 hash;\n+\n+            wss.nKeys++;\n+            ssValue >> pkey;\n+            ssValue >> hash;\n+\n+            // hash pubkey/privkey to accelerate wallet load\n+            std::vector<unsigned char> to_hash;\n+            to_hash.reserve(xpub.size() + pkey.size());\n+            to_hash.insert(to_hash.end(), xpub.begin(), xpub.end());\n+            to_hash.insert(to_hash.end(), pkey.begin(), pkey.end());\n+\n+            if (Hash(to_hash) != hash)\n+            {\n+                strErr = \"Error reading wallet database: CPubKey/CPrivKey corrupt\";\n+                return false;\n+            }\n+\n+            if (!key.Load(pkey, extpub.pubkey, true))",
      "path": "src/wallet/walletdb.cpp",
      "position": 176,
      "original_position": 46,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "561a8043c6fa41c8f3cdfa57272ca512b6d8ebb2",
      "in_reply_to_id": 1081585278,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The third parameter in this call skips that check. We use the hash check instead because hashing is faster the ec mult.",
      "created_at": "2023-01-24T21:11:41Z",
      "updated_at": "2023-01-24T21:11:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1085927071",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085927071"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 821,
      "original_line": 821,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085935623",
      "pull_request_review_id": 1268318929,
      "id": 1085935623,
      "node_id": "PRRC_kwDOABII585AuhAH",
      "diff_hunk": "@@ -756,6 +756,61 @@ static RPCHelpMan migratewallet()\n     };\n }\n \n+RPCHelpMan getxpub()",
      "path": "src/wallet/rpc/wallet.cpp",
      "position": 4,
      "original_position": 4,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "436eab602f7d27ad325ebed60e69acbb6dbf2ef5",
      "in_reply_to_id": 1081603914,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Nothing in particular, just seems related more to wallet level information rather than addresses.",
      "created_at": "2023-01-24T21:22:31Z",
      "updated_at": "2023-01-24T21:22:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1085935623",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085935623"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 815,
      "original_line": 815,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085956443",
      "pull_request_review_id": 1268355604,
      "id": 1085956443,
      "node_id": "PRRC_kwDOABII585AumFb",
      "diff_hunk": "@@ -146,6 +146,13 @@ struct Descriptor {\n \n     /** @return The OutputType of the scriptPubKey(s) produced by this descriptor. Or nullopt if indeterminate (multiple or none) */\n     virtual std::optional<OutputType> GetOutputType() const = 0;\n+\n+    /** Return all (extended) public keys for this descriptor, including any from subdescriptors.\n+     *\n+     * @param[out] pubkeys Any public keys\n+     * @param[out] ext_pubs Any extended public keys\n+     */\n+    virtual void GetPubKeys(std::set<CPubKey>& pubkeys, std::set<CExtPubKey>& ext_pubs) const = 0;",
      "path": "src/script/descriptor.h",
      "position": 10,
      "original_position": 10,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "6072b3964582e6883220f3af678675531299b444",
      "in_reply_to_id": 1081614403,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "IIRC I had a use for this in a different PR and this behavior was imported from there.",
      "created_at": "2023-01-24T21:32:16Z",
      "updated_at": "2023-01-24T21:32:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1085956443",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085956443"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 155,
      "original_line": 155,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085968765",
      "pull_request_review_id": 1268379151,
      "id": 1085968765,
      "node_id": "PRRC_kwDOABII585AupF9",
      "diff_hunk": "@@ -1087,6 +1087,99 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         }\n     }\n \n+    // Upgrade to having a wallet hd key\n+    // Find the keys which are used in single key internal and external descriptors with\n+    // the pre-taproot output types\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        std::map<CExtPubKey, std::pair<std::map<std::string, int>, uint64_t>> descs_keys;\n+        std::map<std::string, int> tmpl = {{\"pkh(\", 0}, {\"sh(wpkh(\", 0}, {\"wpkh(\", 0}};\n+\n+        // Find root xpubs used in pkh(), sh(wpkh()), and wpkh() descriptors\n+        for (const auto& spkm : pwallet->GetAllScriptPubKeyMans()) {\n+            const DescriptorScriptPubKeyMan* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+            assert(desc_spkm);\n+            LOCK(desc_spkm->cs_desc_man);\n+            WalletDescriptor w_desc = desc_spkm->GetWalletDescriptor();\n+\n+            if (!w_desc.descriptor->IsRange()) {\n+                continue;\n+            }\n+\n+            std::set<CPubKey> desc_pubkeys;\n+            std::set<CExtPubKey> desc_xpubs;\n+            w_desc.descriptor->GetPubKeys(desc_pubkeys, desc_xpubs);\n+            if (desc_xpubs.size() != 1) {\n+                continue;\n+            }\n+            const CExtPubKey& xpub = *desc_xpubs.begin();\n+\n+            if (descs_keys.count(xpub) == 0) {\n+                descs_keys.emplace(xpub, std::make_pair(tmpl, 0));\n+            }\n+\n+            const std::string desc = w_desc.descriptor->ToString();\n+            if (desc.find(\"pkh(\") == 0) {",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 38,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "9a173470864f44d494e80b1c155d8ebe8c87c406",
      "in_reply_to_id": 1081622126,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> If all we need is to find the active HD master key, why not limit the search to `pkh(`? That has the nice benefit of there not potentially being manually inserted descriptors that could be ambiguous).\r\n\r\nUsers can still import `pkh(` descriptors. By checking all of the different types, we can be more sure about which key is active.",
      "created_at": "2023-01-24T21:43:00Z",
      "updated_at": "2023-01-24T21:43:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1085968765",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085968765"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1124,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085979072",
      "pull_request_review_id": 1268389963,
      "id": 1085979072,
      "node_id": "PRRC_kwDOABII585AurnA",
      "diff_hunk": "@@ -1087,6 +1087,99 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         }\n     }\n \n+    // Upgrade to having a wallet hd key\n+    // Find the keys which are used in single key internal and external descriptors with\n+    // the pre-taproot output types\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        std::map<CExtPubKey, std::pair<std::map<std::string, int>, uint64_t>> descs_keys;\n+        std::map<std::string, int> tmpl = {{\"pkh(\", 0}, {\"sh(wpkh(\", 0}, {\"wpkh(\", 0}};\n+\n+        // Find root xpubs used in pkh(), sh(wpkh()), and wpkh() descriptors\n+        for (const auto& spkm : pwallet->GetAllScriptPubKeyMans()) {",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 15,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "9a173470864f44d494e80b1c155d8ebe8c87c406",
      "in_reply_to_id": 1081631043,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The user may have imported other keys for some active spkms, so we'd be unable to determine the master if we only looked at the active ones.",
      "created_at": "2023-01-24T21:52:45Z",
      "updated_at": "2023-01-24T21:52:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1085979072",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085979072"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1073,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085987224",
      "pull_request_review_id": 1268399581,
      "id": 1085987224,
      "node_id": "PRRC_kwDOABII585AutmY",
      "diff_hunk": "@@ -325,5 +326,35 @@ def run_test(self):\n             wallet = node_v19.get_wallet_rpc(\"w1_v19\")\n             assert wallet.getaddressinfo(address_18075)[\"solvable\"]\n \n+        if self.options.descriptors:\n+            self.log.info(\"Test background upgrading of descriptor wallets to have hd key\")\n+            for node in descriptor_nodes:",
      "path": "test/functional/wallet_backwards_compatibility.py",
      "position": null,
      "original_position": 14,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "b756f221ccf9885ee08e6a7d20ed54364c6dda93",
      "in_reply_to_id": 1081559201,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Changed to test against node_v23",
      "created_at": "2023-01-24T22:01:35Z",
      "updated_at": "2023-01-24T22:01:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1085987224",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085987224"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 331,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085987277",
      "pull_request_review_id": 1268399686,
      "id": 1085987277,
      "node_id": "PRRC_kwDOABII585AutnN",
      "diff_hunk": "@@ -325,5 +326,35 @@ def run_test(self):\n             wallet = node_v19.get_wallet_rpc(\"w1_v19\")\n             assert wallet.getaddressinfo(address_18075)[\"solvable\"]\n \n+        if self.options.descriptors:\n+            self.log.info(\"Test background upgrading of descriptor wallets to have hd key\")\n+            for node in descriptor_nodes:\n+                # Make the test wallet\n+                node.createwallet(wallet_name=\"hdkeyupgrade\", descriptors=True)",
      "path": "test/functional/wallet_backwards_compatibility.py",
      "position": null,
      "original_position": 16,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "b756f221ccf9885ee08e6a7d20ed54364c6dda93",
      "in_reply_to_id": 1081564640,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2023-01-24T22:01:41Z",
      "updated_at": "2023-01-24T22:01:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1085987277",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085987277"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 333,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085987392",
      "pull_request_review_id": 1268399857,
      "id": 1085987392,
      "node_id": "PRRC_kwDOABII585AutpA",
      "diff_hunk": "@@ -297,6 +300,46 @@ bool WalletBatch::EraseLockedUTXO(const COutPoint& output)\n     return EraseIC(std::make_pair(DBKeys::LOCKED_UTXO, std::make_pair(output.hash, output.n)));\n }\n \n+bool WalletBatch::WriteHDKey(const CExtKey& extkey)\n+{\n+    std::vector<unsigned char> xpub(BIP32_EXTKEY_SIZE);\n+    extkey.Neuter().Encode(xpub.data());\n+\n+    CPrivKey privkey = extkey.key.GetPrivKey();\n+\n+    // hash pubkey/privkey to accelerate wallet load",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 28,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "21166afaa5106ff31aac3914ad117cff21a999d5",
      "in_reply_to_id": 1081565832,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done in a separate commit.",
      "created_at": "2023-01-24T22:01:51Z",
      "updated_at": "2023-01-24T22:01:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1085987392",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085987392"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 310,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085987678",
      "pull_request_review_id": 1268400240,
      "id": 1085987678,
      "node_id": "PRRC_kwDOABII585Autte",
      "diff_hunk": "@@ -3573,6 +3573,10 @@ void CWallet::SetupDescriptorScriptPubKeyMans()\n         CExtKey master_key;\n         master_key.SetSeed(seed_key);\n \n+        // Store the master key as our active hd key\n+        SetActiveHDKey(master_key.Neuter());",
      "path": "src/wallet/wallet.cpp",
      "position": 156,
      "original_position": 5,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "8b0af8a56ffe31edcd2ed98d795a63fd302ae67a",
      "in_reply_to_id": 1081590764,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Reordered and added an `Assume` to `SetActiveHDKey`.",
      "created_at": "2023-01-24T22:02:12Z",
      "updated_at": "2023-01-24T22:02:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1085987678",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085987678"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3718,
      "original_line": 3718,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085987787",
      "pull_request_review_id": 1268400409,
      "id": 1085987787,
      "node_id": "PRRC_kwDOABII585AutvL",
      "diff_hunk": "@@ -3573,6 +3573,10 @@ void CWallet::SetupDescriptorScriptPubKeyMans()\n         CExtKey master_key;\n         master_key.SetSeed(seed_key);\n \n+        // Store the master key as our active hd key\n+        SetActiveHDKey(master_key.Neuter());\n+        AddHDKey(master_key);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "8b0af8a56ffe31edcd2ed98d795a63fd302ae67a",
      "in_reply_to_id": 1081592726,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2023-01-24T22:02:21Z",
      "updated_at": "2023-01-24T22:02:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1085987787",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085987787"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3578,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085987983",
      "pull_request_review_id": 1268400717,
      "id": 1085987983,
      "node_id": "PRRC_kwDOABII585AutyP",
      "diff_hunk": "@@ -809,6 +809,25 @@ bool CWallet::EncryptWallet(const SecureString& strWalletPassphrase)\n             }\n         }\n \n+        // Encrypt the HD keys\n+        assert(m_hd_crypted_keys.empty());\n+        for (const auto& [xpub, key] : m_hd_keys) {\n+            std::vector<unsigned char> crypted_secret;\n+            CKeyingMaterial secret(key.begin(), key.end());\n+            if (!EncryptSecret(_vMasterKey, secret, xpub.pubkey.GetHash(), crypted_secret)) {\n+                encrypted_batch->TxnAbort();\n+                delete encrypted_batch;\n+                encrypted_batch = nullptr;\n+                // We now probably have half of our keys encrypted in memory, and half not...\n+                // die and let the user reload the unencrypted wallet.",
      "path": "src/wallet/wallet.cpp",
      "position": 136,
      "original_position": 14,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "95da2e9808c57a519023c017ca47d76ebd2632fd",
      "in_reply_to_id": 1081595596,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Perhaps something to do for a followup for all of the encrypt wallet failures.",
      "created_at": "2023-01-24T22:02:40Z",
      "updated_at": "2023-01-24T22:02:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1085987983",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085987983"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 931,
      "original_line": 931,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085988202",
      "pull_request_review_id": 1268401027,
      "id": 1085988202,
      "node_id": "PRRC_kwDOABII585Aut1q",
      "diff_hunk": "@@ -953,6 +953,7 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     bool LoadHDKey(const CExtPubKey& xpub, const CKey& key) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n     bool LoadHDCryptedKey(const CExtPubKey& xpub, const std::vector<unsigned char>& crypted_key) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n     bool AddHDKey(const CExtKey& extkey) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n+    std::optional<CExtKey> GetHDKey(const CExtPubKey& xpub) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);",
      "path": "src/wallet/wallet.h",
      "position": 37,
      "original_position": 4,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "18ac74d29cf3f1a8c4f46c4d030968b5596e9b09",
      "in_reply_to_id": 1081598484,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Added a bit more to the comment for this group of functions.",
      "created_at": "2023-01-24T22:02:57Z",
      "updated_at": "2023-01-24T22:02:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1085988202",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085988202"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1009,
      "original_line": 1009,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085988333",
      "pull_request_review_id": 1268401191,
      "id": 1085988333,
      "node_id": "PRRC_kwDOABII585Aut3t",
      "diff_hunk": "@@ -147,7 +147,28 @@ def run_test(self):\n         else:\n             assert_equal(keypath[0:7], \"m/0'/1'\")\n \n-        if not self.options.descriptors:\n+        if self.options.descriptors:",
      "path": "test/functional/wallet_hd.py",
      "position": null,
      "original_position": 5,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "1877da9fb564fc6fa7b6c6bc3bcf63bdb29ace7b",
      "in_reply_to_id": 1081607073,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2023-01-24T22:03:06Z",
      "updated_at": "2023-01-24T22:03:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1085988333",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085988333"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 150,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085988403",
      "pull_request_review_id": 1268401314,
      "id": 1085988403,
      "node_id": "PRRC_kwDOABII585Aut4z",
      "diff_hunk": "@@ -200,6 +200,12 @@ struct PubkeyProvider\n \n     /** Derive a private key, if private data is available in arg. */\n     virtual bool GetPrivKey(int pos, const SigningProvider& arg, CKey& key) const = 0;\n+\n+    /** Return all (extended public keys for this PubkeyProvider",
      "path": "src/script/descriptor.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "6072b3964582e6883220f3af678675531299b444",
      "in_reply_to_id": 1081608280,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2023-01-24T22:03:11Z",
      "updated_at": "2023-01-24T22:03:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1085988403",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085988403"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 204,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085988707",
      "pull_request_review_id": 1268401995,
      "id": 1085988707,
      "node_id": "PRRC_kwDOABII585Aut9j",
      "diff_hunk": "@@ -200,6 +200,12 @@ struct PubkeyProvider\n \n     /** Derive a private key, if private data is available in arg. */\n     virtual bool GetPrivKey(int pos, const SigningProvider& arg, CKey& key) const = 0;\n+\n+    /** Return all (extended public keys for this PubkeyProvider\n+     * param[out] pubkeys Any public keys\n+     * param[out] ext_pubs Any extended public keys\n+     */\n+    virtual void GetRootPubKey(std::set<CPubKey>& pubkeys, std::set<CExtPubKey>& ext_pubs) const = 0;",
      "path": "src/script/descriptor.cpp",
      "position": null,
      "original_position": 9,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "6072b3964582e6883220f3af678675531299b444",
      "in_reply_to_id": 1081610989,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Changed to plural.\r\n\r\nIt should return multiple to handle multisigs.",
      "created_at": "2023-01-24T22:03:30Z",
      "updated_at": "2023-01-24T22:03:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1085988707",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085988707"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 208,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085989103",
      "pull_request_review_id": 1268403147,
      "id": 1085989103,
      "node_id": "PRRC_kwDOABII585AuuDv",
      "diff_hunk": "@@ -1087,6 +1087,99 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         }\n     }\n \n+    // Upgrade to having a wallet hd key\n+    // Find the keys which are used in single key internal and external descriptors with\n+    // the pre-taproot output types\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        std::map<CExtPubKey, std::pair<std::map<std::string, int>, uint64_t>> descs_keys;\n+        std::map<std::string, int> tmpl = {{\"pkh(\", 0}, {\"sh(wpkh(\", 0}, {\"wpkh(\", 0}};\n+\n+        // Find root xpubs used in pkh(), sh(wpkh()), and wpkh() descriptors\n+        for (const auto& spkm : pwallet->GetAllScriptPubKeyMans()) {\n+            const DescriptorScriptPubKeyMan* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+            assert(desc_spkm);\n+            LOCK(desc_spkm->cs_desc_man);\n+            WalletDescriptor w_desc = desc_spkm->GetWalletDescriptor();\n+\n+            if (!w_desc.descriptor->IsRange()) {\n+                continue;\n+            }\n+\n+            std::set<CPubKey> desc_pubkeys;\n+            std::set<CExtPubKey> desc_xpubs;\n+            w_desc.descriptor->GetPubKeys(desc_pubkeys, desc_xpubs);\n+            if (desc_xpubs.size() != 1) {\n+                continue;\n+            }\n+            const CExtPubKey& xpub = *desc_xpubs.begin();\n+\n+            if (descs_keys.count(xpub) == 0) {\n+                descs_keys.emplace(xpub, std::make_pair(tmpl, 0));\n+            }\n+\n+            const std::string desc = w_desc.descriptor->ToString();\n+            if (desc.find(\"pkh(\") == 0) {",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 38,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "9a173470864f44d494e80b1c155d8ebe8c87c406",
      "in_reply_to_id": 1081622126,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> instead of this string parsing stuff, can we add some method to `Descriptor` to directly get what we need? Even an `enum` with descriptor types seems more clean.\r\n\r\nI've changed it to use `OutputType` that apparently descriptors can report.",
      "created_at": "2023-01-24T22:04:05Z",
      "updated_at": "2023-01-24T22:04:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1085989103",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085989103"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1124,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085989259",
      "pull_request_review_id": 1268403597,
      "id": 1085989259,
      "node_id": "PRRC_kwDOABII585AuuGL",
      "diff_hunk": "@@ -1087,6 +1087,99 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         }\n     }\n \n+    // Upgrade to having a wallet hd key\n+    // Find the keys which are used in single key internal and external descriptors with\n+    // the pre-taproot output types",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "9a173470864f44d494e80b1c155d8ebe8c87c406",
      "in_reply_to_id": 1081623995,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Added checking for `tr()` descriptors.",
      "created_at": "2023-01-24T22:04:18Z",
      "updated_at": "2023-01-24T22:04:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1085989259",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085989259"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1064,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085991531",
      "pull_request_review_id": 1268406631,
      "id": 1085991531,
      "node_id": "PRRC_kwDOABII585Auupr",
      "diff_hunk": "@@ -250,6 +250,12 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     //! the current wallet version: clients below this version are not able to load the wallet\n     int nWalletVersion GUARDED_BY(cs_wallet){FEATURE_BASE};\n \n+    //! The extended public key to be used for new automatically generated descriptors\n+    CExtPubKey m_xpub GUARDED_BY(cs_wallet);\n+    //! The previous and current extended keys that are used for automatically generated descriptors\n+    std::map<CExtPubKey, CKey> m_hd_keys GUARDED_BY(cs_wallet);",
      "path": "src/wallet/wallet.h",
      "position": 7,
      "original_position": 7,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "abac3e3630aa6bdab825ff628fa9389c23eda417",
      "in_reply_to_id": 1073247236,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I'm not entirely sure of the reasoning, but it's been requested as required feature.",
      "created_at": "2023-01-24T22:06:43Z",
      "updated_at": "2023-01-24T22:06:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1085991531",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1085991531"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 297,
      "original_line": 297,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086349157",
      "pull_request_review_id": 1268914851,
      "id": 1086349157,
      "node_id": "PRRC_kwDOABII585AwF9l",
      "diff_hunk": "@@ -782,6 +782,79 @@ ReadKeyValue(CWallet* pwallet, CDataStream& ssKey, CDataStream& ssValue,\n             ssKey >> hash;\n             ssKey >> n;\n             pwallet->LockCoin(COutPoint(hash, n));\n+        } else if (strType == DBKeys::ACTIVEHDKEY) {\n+            CExtPubKey extpub;\n+            std::vector<unsigned char> xpub(BIP32_EXTKEY_SIZE);\n+            ssValue >> xpub;\n+            extpub.Decode(xpub.data());\n+            if (!extpub.pubkey.IsValid())\n+            {\n+                strErr = \"Error reading wallet database: CExtPubKey corrupt\";\n+                return false;\n+            }\n+            // TODO: Load extpub into the wallet\n+        } else if (strType == DBKeys::HDKEY) {\n+            CExtPubKey extpub;\n+            std::vector<unsigned char> xpub(BIP32_EXTKEY_SIZE);\n+            ssKey >> xpub;\n+            extpub.Decode(xpub.data());\n+            if (!extpub.pubkey.IsValid())\n+            {\n+                strErr = \"Error reading wallet database: CExtPubKey corrupt\";\n+                return false;\n+            }\n+\n+            CKey key;\n+            CPrivKey pkey;\n+            uint256 hash;\n+\n+            wss.nKeys++;\n+            ssValue >> pkey;\n+            ssValue >> hash;\n+\n+            // hash pubkey/privkey to accelerate wallet load\n+            std::vector<unsigned char> to_hash;\n+            to_hash.reserve(xpub.size() + pkey.size());\n+            to_hash.insert(to_hash.end(), xpub.begin(), xpub.end());\n+            to_hash.insert(to_hash.end(), pkey.begin(), pkey.end());\n+\n+            if (Hash(to_hash) != hash)\n+            {\n+                strErr = \"Error reading wallet database: CPubKey/CPrivKey corrupt\";\n+                return false;\n+            }\n+\n+            if (!key.Load(pkey, extpub.pubkey, true))",
      "path": "src/wallet/walletdb.cpp",
      "position": 176,
      "original_position": 46,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "561a8043c6fa41c8f3cdfa57272ca512b6d8ebb2",
      "in_reply_to_id": 1081585278,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The speed benefit seems pretty marginal when dealing with at most a dozen extended keys. It made more sense in the legacy wallet where we deal with thousands of keys in a pool.",
      "created_at": "2023-01-25T08:46:00Z",
      "updated_at": "2023-01-25T08:46:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1086349157",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086349157"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 821,
      "original_line": 821,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086351854",
      "pull_request_review_id": 1268918654,
      "id": 1086351854,
      "node_id": "PRRC_kwDOABII585AwGnu",
      "diff_hunk": "@@ -146,6 +146,13 @@ struct Descriptor {\n \n     /** @return The OutputType of the scriptPubKey(s) produced by this descriptor. Or nullopt if indeterminate (multiple or none) */\n     virtual std::optional<OutputType> GetOutputType() const = 0;\n+\n+    /** Return all (extended) public keys for this descriptor, including any from subdescriptors.\n+     *\n+     * @param[out] pubkeys Any public keys\n+     * @param[out] ext_pubs Any extended public keys\n+     */\n+    virtual void GetPubKeys(std::set<CPubKey>& pubkeys, std::set<CExtPubKey>& ext_pubs) const = 0;",
      "path": "src/script/descriptor.h",
      "position": 10,
      "original_position": 10,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "6072b3964582e6883220f3af678675531299b444",
      "in_reply_to_id": 1081614403,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "If that's no longer the case I would prefer simplifying things. The Descriptor class is already a bit hard to read.",
      "created_at": "2023-01-25T08:48:45Z",
      "updated_at": "2023-01-25T08:48:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1086351854",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086351854"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 155,
      "original_line": 155,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086953840",
      "pull_request_review_id": 1269826389,
      "id": 1086953840,
      "node_id": "PRRC_kwDOABII585AyZlw",
      "diff_hunk": "@@ -146,6 +146,13 @@ struct Descriptor {\n \n     /** @return The OutputType of the scriptPubKey(s) produced by this descriptor. Or nullopt if indeterminate (multiple or none) */\n     virtual std::optional<OutputType> GetOutputType() const = 0;\n+\n+    /** Return all (extended) public keys for this descriptor, including any from subdescriptors.\n+     *\n+     * @param[out] pubkeys Any public keys\n+     * @param[out] ext_pubs Any extended public keys\n+     */\n+    virtual void GetPubKeys(std::set<CPubKey>& pubkeys, std::set<CExtPubKey>& ext_pubs) const = 0;",
      "path": "src/script/descriptor.h",
      "position": 10,
      "original_position": 10,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "6072b3964582e6883220f3af678675531299b444",
      "in_reply_to_id": 1081614403,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "We do actually use it in this PR to check whether a descriptor has any normal pubkeys in it. If it does, it cannot be a candidate for master hd key extraction.",
      "created_at": "2023-01-25T17:38:41Z",
      "updated_at": "2023-01-25T17:38:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1086953840",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086953840"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 155,
      "original_line": 155,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1089162369",
      "pull_request_review_id": 1273008737,
      "id": 1089162369,
      "node_id": "PRRC_kwDOABII585A60yB",
      "diff_hunk": "@@ -1062,6 +1062,100 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         }\n     }\n \n+    // Upgrade to having a wallet hd key\n+    // Find the keys which are used in single key internal and external descriptors with\n+    // the pre-taproot output types\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        std::map<CExtPubKey, std::pair<std::map<OutputType, int>, uint64_t>> descs_keys;\n+        std::map<OutputType, int> tmpl = {{OutputType::LEGACY, 0}, {OutputType::P2SH_SEGWIT, 0}, {OutputType::BECH32, 0}, {OutputType::BECH32M, 0}};\n+\n+        // Find root xpubs used in pkh(), sh(wpkh()), and wpkh() descriptors",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "9ec69417b3ac88ebf6dc719b7571ea0cdb327e13",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "6bb3bee nit: `and tr()`",
      "created_at": "2023-01-27T16:18:41Z",
      "updated_at": "2023-03-01T14:57:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1089162369",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1089162369"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1072,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1105010018",
      "pull_request_review_id": 1296430598,
      "id": 1105010018,
      "node_id": "PRRC_kwDOABII585B3R1i",
      "diff_hunk": "@@ -66,6 +69,17 @@ const std::unordered_set<std::string> LEGACY_TYPES{CRYPTED_KEY, CSCRIPT, DEFAULT\n // WalletBatch\n //\n \n+template <typename P>\n+static uint256 PrivKeyChecksum(const CPrivKey& privkey, const P& pubkey)\n+{\n+    // hash pubkey/privkey to accelerate wallet load\n+    std::vector<unsigned char> to_hash;",
      "path": "src/wallet/walletdb.cpp",
      "position": 25,
      "original_position": 25,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "0c4b2bc6878b0928e545a8f0468818e98e4aae33",
      "in_reply_to_id": null,
      "user": {
        "login": "john-moffett",
        "id": 116917595,
        "node_id": "U_kgDOBvgFWw",
        "avatar_url": "https://avatars.githubusercontent.com/u/116917595?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/john-moffett",
        "html_url": "https://github.com/john-moffett",
        "followers_url": "https://api.github.com/users/john-moffett/followers",
        "following_url": "https://api.github.com/users/john-moffett/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/john-moffett/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/john-moffett/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/john-moffett/subscriptions",
        "organizations_url": "https://api.github.com/users/john-moffett/orgs",
        "repos_url": "https://api.github.com/users/john-moffett/repos",
        "events_url": "https://api.github.com/users/john-moffett/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/john-moffett/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "While you're touching, maybe a good idea to change to `std::vector<unsigned char, secure_allocator<unsigned char>>`?",
      "created_at": "2023-02-13T20:59:52Z",
      "updated_at": "2023-02-13T20:59:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1105010018",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1105010018"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 76,
      "original_line": 76,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1121931215",
      "pull_request_review_id": 1320105973,
      "id": 1121931215,
      "node_id": "PRRC_kwDOABII585C30_P",
      "diff_hunk": "@@ -1059,6 +1059,100 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         }\n     }\n \n+    // Upgrade to having a wallet hd key\n+    // Find the keys which are used in single key internal and external descriptors with\n+    // the pre-taproot output types\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 10,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "6bb3bee37e90160155bed94d628648134fe40ef9",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Some suggestions after our chat:\r\n\r\n* let's move this into (a) helper function(s), so that `LoadWallet` remains somewhat readable\r\n  * `FindGlobalHDKeyAmongstDescriptors()`\r\n  * `SetGlobalHDKey()`\r\n* document this function, e.g. explain that it's trying to find the pattern of 3 or 4 descriptor pairs that use the same master key. Note how some might no longer be active because the user imported another descriptor and made it active. There might also be more than one set matching this pattern due to toggling encryption, so we pick the most recent one.\r\n* drop the `tr()` bit; it's not necessary, and it could cause a mismatch if a user did something like manually importing only the receive descriptor\r\n* document the meaning of `WALLET_FLAG_GLOBAL_HD_KEY`. It means we support the feature, but does not guarantee presence of an HD key.\r\n* add (a TODO for) method to the wallet tool to re-run the helper functions; this would be for advanced users who somehow ended up with a wallet not matching this pattern, but have repented, added the right descriptors, and now want the global HD key field set",
      "created_at": "2023-03-01T15:37:05Z",
      "updated_at": "2023-03-01T15:37:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1121931215",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1121931215"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1068,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1126052875",
      "pull_request_review_id": 1325672583,
      "id": 1126052875,
      "node_id": "PRRC_kwDOABII585DHjQL",
      "diff_hunk": "@@ -1059,6 +1059,100 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         }\n     }\n \n+    // Upgrade to having a wallet hd key\n+    // Find the keys which are used in single key internal and external descriptors with\n+    // the pre-taproot output types\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 10,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "6bb3bee37e90160155bed94d628648134fe40ef9",
      "in_reply_to_id": 1121931215,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> add (a TODO for) method to the wallet tool to re-run the helper functions; this would be for advanced users who somehow ended up with a wallet not matching this pattern, but have repented, added the right descriptors, and now want the global HD key field set\r\n\r\n\r\nIs this really needed if we add support for `sethdseed` later?",
      "created_at": "2023-03-06T07:58:09Z",
      "updated_at": "2023-03-06T07:58:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1126052875",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1126052875"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1068,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137722557",
      "pull_request_review_id": 1342352984,
      "id": 1137722557,
      "node_id": "PRRC_kwDOABII585D0ES9",
      "diff_hunk": "@@ -1059,6 +1059,100 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         }\n     }\n \n+    // Upgrade to having a wallet hd key\n+    // Find the keys which are used in single key internal and external descriptors with\n+    // the pre-taproot output types\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 10,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "6bb3bee37e90160155bed94d628648134fe40ef9",
      "in_reply_to_id": 1121931215,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Moved it to a separate function, although I did not split it up into multiple as that does not seem to be actually useful. Also added some additional comments.",
      "created_at": "2023-03-15T20:11:29Z",
      "updated_at": "2023-03-15T20:11:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1137722557",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137722557"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1068,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1152831466",
      "pull_request_review_id": 1364471606,
      "id": 1152831466,
      "node_id": "PRRC_kwDOABII585Ets_q",
      "diff_hunk": "@@ -1087,6 +1087,99 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         }\n     }\n \n+    // Upgrade to having a wallet hd key\n+    // Find the keys which are used in single key internal and external descriptors with\n+    // the pre-taproot output types\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) &&\n+        !pwallet->IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        std::map<CExtPubKey, std::pair<std::map<std::string, int>, uint64_t>> descs_keys;\n+        std::map<std::string, int> tmpl = {{\"pkh(\", 0}, {\"sh(wpkh(\", 0}, {\"wpkh(\", 0}};\n+\n+        // Find root xpubs used in pkh(), sh(wpkh()), and wpkh() descriptors\n+        for (const auto& spkm : pwallet->GetAllScriptPubKeyMans()) {\n+            const DescriptorScriptPubKeyMan* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+            assert(desc_spkm);\n+            LOCK(desc_spkm->cs_desc_man);\n+            WalletDescriptor w_desc = desc_spkm->GetWalletDescriptor();\n+\n+            if (!w_desc.descriptor->IsRange()) {\n+                continue;\n+            }\n+\n+            std::set<CPubKey> desc_pubkeys;\n+            std::set<CExtPubKey> desc_xpubs;\n+            w_desc.descriptor->GetPubKeys(desc_pubkeys, desc_xpubs);\n+            if (desc_xpubs.size() != 1) {\n+                continue;\n+            }\n+            const CExtPubKey& xpub = *desc_xpubs.begin();\n+\n+            if (descs_keys.count(xpub) == 0) {\n+                descs_keys.emplace(xpub, std::make_pair(tmpl, 0));\n+            }\n+\n+            const std::string desc = w_desc.descriptor->ToString();\n+            if (desc.find(\"pkh(\") == 0) {\n+                descs_keys[xpub].first[\"pkh(\"]++;\n+            } else if (desc.find(\"sh(wpkh(\") == 0) {\n+                descs_keys[xpub].first[\"sh(wpkh(\"]++;\n+            } else if (desc.find(\"wpkh(\") == 0) {\n+                descs_keys[xpub].first[\"wpkh(\"]++;\n+            } else {\n+                continue;\n+            }\n+            if (w_desc.creation_time > descs_keys[xpub].second) {\n+                descs_keys[xpub].second = w_desc.creation_time;\n+            }\n+        }\n+\n+        // Find candidate active xpubs\n+        // These are the ones that are used in 2 pkh(), 2 sh(wpkh()), and 2 wpkh() descriptors\n+        uint64_t best_time = 0;\n+        CExtPubKey best_xpub;\n+        std::map<CKeyID, CExtPubKey> xpubs;\n+        for (const auto& [xpub, info] : descs_keys) {\n+            const auto& [dtypes, desc_time] = info;\n+            if (std::all_of(dtypes.begin(), dtypes.end(), [](const auto& p) { return p.second == 2; })) {\n+                xpubs.emplace(xpub.pubkey.GetID(), xpub);\n+                if (desc_time > best_time) {\n+                    best_time = desc_time;\n+                    best_xpub = xpub;\n+                }\n+            }\n+        }\n+        if (best_time > 0) {\n+            pwallet->SetActiveHDKey(best_xpub);\n+        }\n+\n+        // Add hd keys\n+        for (const auto& [id_pair, key] : wss.m_descriptor_keys) {\n+            const auto& [desc_id, keyid] = id_pair;\n+\n+            const auto& it = xpubs.find(keyid);\n+            if (it == xpubs.end()) {\n+                continue;\n+            }\n+\n+            CExtKey extkey(it->second, key);\n+            pwallet->AddHDKey(extkey);",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 81,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "9a173470864f44d494e80b1c155d8ebe8c87c406",
      "in_reply_to_id": 1073249883,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I meant, that we can write only the key for `best_xpub`. Why do we need to write all the candidates as well?",
      "created_at": "2023-03-30T07:17:02Z",
      "updated_at": "2023-03-30T07:17:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1152831466",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1152831466"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1133,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1155586506",
      "pull_request_review_id": 1368451328,
      "id": 1155586506,
      "node_id": "PRRC_kwDOABII585E4NnK",
      "diff_hunk": "@@ -522,6 +522,121 @@ void CWallet::UpgradeDescriptorCache()\n     SetWalletFlag(WALLET_FLAG_LAST_HARDENED_XPUB_CACHED);\n }\n \n+/**\n+ * UpgradeToGlobalHDKey searches through the descriptors in a descriptor wallet and tries to find a CExtPubKey\n+ * which is likely to be the most recent one used to generate all of the automatically generated descriptors.\n+ * The automatically generated descriptors are guaranteed to be 2 p2pkh, 2 p2sh-segwit, and 2 p2wpkh. There may\n+ * be 2 p2tr descriptors, as well as imports. Those are ignored as they are not guaranteed to be present in all wallets.\n+ * Candidate CExtKeys are those that appear in the aforementioned descriptors as the only key. The best candidate is\n+ * selected as the one that was most recently used.\n+ *\n+ * The best candidate will be added to the wallet as the current active HD key. Any other candidates will be added as\n+ * HD keys that have been rotated out.\n+ *\n+ * WALLET_FLAG_GLOBAL_HD_KEY will be set in order to indicate that this upgrade has occurred.\n+ */\n+void CWallet::UpgradeToGlobalHDKey(WalletBatch& batch, const std::map<std::pair<uint256, CKeyID>, CKey>& desc_keys, const std::map<std::pair<uint256, CKeyID>, std::pair<CPubKey, std::vector<unsigned char>>>& desc_crypt_keys)\n+{\n+    if (!IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) ||\n+        IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) ||\n+        IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        return;\n+    }\n+\n+\n+    std::map<CExtPubKey, std::pair<std::map<OutputType, int>, uint64_t>> descs_keys;\n+    std::map<OutputType, int> tmpl = {{OutputType::LEGACY, 0}, {OutputType::P2SH_SEGWIT, 0}, {OutputType::BECH32, 0}};\n+\n+    for (const auto& spkm : GetAllScriptPubKeyMans()) {\n+        const DescriptorScriptPubKeyMan* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+        assert(desc_spkm);\n+        LOCK(desc_spkm->cs_desc_man);\n+        WalletDescriptor w_desc = desc_spkm->GetWalletDescriptor();\n+\n+        // Automatically generated descriptors are ranged\n+        if (!w_desc.descriptor->IsRange()) {\n+            continue;\n+        }\n+\n+        // Audotmatically generated descriptors have exactly 1 xpub and no other keys\n+        std::set<CPubKey> desc_pubkeys;\n+        std::set<CExtPubKey> desc_xpubs;\n+        w_desc.descriptor->GetPubKeys(desc_pubkeys, desc_xpubs);\n+        if (desc_xpubs.size() != 1 || desc_pubkeys.size() != 0) {\n+            continue;\n+        }\n+        const CExtPubKey& xpub = *desc_xpubs.begin();\n+\n+        if (descs_keys.count(xpub) == 0) {\n+            descs_keys.emplace(xpub, std::make_pair(tmpl, 0));\n+        }\n+\n+        // Automatically generated descriptors have an output type that is one of legacy, p2sh-segwit, or bech32\n+        std::optional<OutputType> output_type = w_desc.descriptor->GetOutputType();\n+        if (!output_type.has_value()) {\n+            continue;\n+        }\n+        if (LEGACY_OUTPUT_TYPES.count(output_type.value()) == 0) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 59,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "0571caf6324549e2b840e58d8b11c3d31973a7c4",
      "in_reply_to_id": null,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "better\r\n```diff\r\n- if (LEGACY_OUTPUT_TYPES.count(output_type.value()) == 0) {\r\n+ if (tmpl.count(output_type.value()) == 0) {\r\n```\r\nor\r\n```diff\r\n- if (LEGACY_OUTPUT_TYPES.count(output_type.value()) == 0) {\r\n+ if (descs_keys[xpub].first.count(output_type.value()) == 0) {\r\n```",
      "created_at": "2023-04-03T07:37:48Z",
      "updated_at": "2023-04-03T08:15:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1155586506",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1155586506"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 580,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1155604123",
      "pull_request_review_id": 1368451328,
      "id": 1155604123,
      "node_id": "PRRC_kwDOABII585E4R6b",
      "diff_hunk": "@@ -522,6 +522,121 @@ void CWallet::UpgradeDescriptorCache()\n     SetWalletFlag(WALLET_FLAG_LAST_HARDENED_XPUB_CACHED);\n }\n \n+/**\n+ * UpgradeToGlobalHDKey searches through the descriptors in a descriptor wallet and tries to find a CExtPubKey\n+ * which is likely to be the most recent one used to generate all of the automatically generated descriptors.\n+ * The automatically generated descriptors are guaranteed to be 2 p2pkh, 2 p2sh-segwit, and 2 p2wpkh. There may\n+ * be 2 p2tr descriptors, as well as imports. Those are ignored as they are not guaranteed to be present in all wallets.\n+ * Candidate CExtKeys are those that appear in the aforementioned descriptors as the only key. The best candidate is\n+ * selected as the one that was most recently used.\n+ *\n+ * The best candidate will be added to the wallet as the current active HD key. Any other candidates will be added as\n+ * HD keys that have been rotated out.\n+ *\n+ * WALLET_FLAG_GLOBAL_HD_KEY will be set in order to indicate that this upgrade has occurred.\n+ */\n+void CWallet::UpgradeToGlobalHDKey(WalletBatch& batch, const std::map<std::pair<uint256, CKeyID>, CKey>& desc_keys, const std::map<std::pair<uint256, CKeyID>, std::pair<CPubKey, std::vector<unsigned char>>>& desc_crypt_keys)\n+{\n+    if (!IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) ||\n+        IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) ||\n+        IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        return;\n+    }\n+\n+\n+    std::map<CExtPubKey, std::pair<std::map<OutputType, int>, uint64_t>> descs_keys;",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 27,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "0571caf6324549e2b840e58d8b11c3d31973a7c4",
      "in_reply_to_id": null,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "naming nit: `desc_keys` and `descs_keys` are very easy to mix",
      "created_at": "2023-04-03T07:54:57Z",
      "updated_at": "2023-04-03T08:15:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1155604123",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1155604123"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 548,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1155609607",
      "pull_request_review_id": 1368451328,
      "id": 1155609607,
      "node_id": "PRRC_kwDOABII585E4TQH",
      "diff_hunk": "@@ -522,6 +522,121 @@ void CWallet::UpgradeDescriptorCache()\n     SetWalletFlag(WALLET_FLAG_LAST_HARDENED_XPUB_CACHED);\n }\n \n+/**\n+ * UpgradeToGlobalHDKey searches through the descriptors in a descriptor wallet and tries to find a CExtPubKey\n+ * which is likely to be the most recent one used to generate all of the automatically generated descriptors.\n+ * The automatically generated descriptors are guaranteed to be 2 p2pkh, 2 p2sh-segwit, and 2 p2wpkh. There may",
      "path": "src/wallet/wallet.cpp",
      "position": 7,
      "original_position": 7,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "0571caf6324549e2b840e58d8b11c3d31973a7c4",
      "in_reply_to_id": null,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Do we want to check that we have exactly one `internal=true` and one `internal=false` descriptors?",
      "created_at": "2023-04-03T07:59:13Z",
      "updated_at": "2023-04-03T08:15:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1155609607",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1155609607"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 522,
      "original_line": 522,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1155610688",
      "pull_request_review_id": 1368451328,
      "id": 1155610688,
      "node_id": "PRRC_kwDOABII585E4ThA",
      "diff_hunk": "@@ -522,6 +522,121 @@ void CWallet::UpgradeDescriptorCache()\n     SetWalletFlag(WALLET_FLAG_LAST_HARDENED_XPUB_CACHED);\n }\n \n+/**\n+ * UpgradeToGlobalHDKey searches through the descriptors in a descriptor wallet and tries to find a CExtPubKey\n+ * which is likely to be the most recent one used to generate all of the automatically generated descriptors.\n+ * The automatically generated descriptors are guaranteed to be 2 p2pkh, 2 p2sh-segwit, and 2 p2wpkh. There may\n+ * be 2 p2tr descriptors, as well as imports. Those are ignored as they are not guaranteed to be present in all wallets.\n+ * Candidate CExtKeys are those that appear in the aforementioned descriptors as the only key. The best candidate is\n+ * selected as the one that was most recently used.\n+ *\n+ * The best candidate will be added to the wallet as the current active HD key. Any other candidates will be added as\n+ * HD keys that have been rotated out.\n+ *\n+ * WALLET_FLAG_GLOBAL_HD_KEY will be set in order to indicate that this upgrade has occurred.\n+ */\n+void CWallet::UpgradeToGlobalHDKey(WalletBatch& batch, const std::map<std::pair<uint256, CKeyID>, CKey>& desc_keys, const std::map<std::pair<uint256, CKeyID>, std::pair<CPubKey, std::vector<unsigned char>>>& desc_crypt_keys)",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 17,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "0571caf6324549e2b840e58d8b11c3d31973a7c4",
      "in_reply_to_id": null,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: maybe good time to add typedef. I had a very hard time reading the signature of the fuction",
      "created_at": "2023-04-03T08:00:18Z",
      "updated_at": "2023-04-03T08:15:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1155610688",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1155610688"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 538,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1155615459",
      "pull_request_review_id": 1368451328,
      "id": 1155615459,
      "node_id": "PRRC_kwDOABII585E4Urj",
      "diff_hunk": "@@ -522,6 +522,121 @@ void CWallet::UpgradeDescriptorCache()\n     SetWalletFlag(WALLET_FLAG_LAST_HARDENED_XPUB_CACHED);\n }\n \n+/**\n+ * UpgradeToGlobalHDKey searches through the descriptors in a descriptor wallet and tries to find a CExtPubKey\n+ * which is likely to be the most recent one used to generate all of the automatically generated descriptors.\n+ * The automatically generated descriptors are guaranteed to be 2 p2pkh, 2 p2sh-segwit, and 2 p2wpkh. There may\n+ * be 2 p2tr descriptors, as well as imports. Those are ignored as they are not guaranteed to be present in all wallets.\n+ * Candidate CExtKeys are those that appear in the aforementioned descriptors as the only key. The best candidate is\n+ * selected as the one that was most recently used.\n+ *\n+ * The best candidate will be added to the wallet as the current active HD key. Any other candidates will be added as\n+ * HD keys that have been rotated out.\n+ *\n+ * WALLET_FLAG_GLOBAL_HD_KEY will be set in order to indicate that this upgrade has occurred.\n+ */\n+void CWallet::UpgradeToGlobalHDKey(WalletBatch& batch, const std::map<std::pair<uint256, CKeyID>, CKey>& desc_keys, const std::map<std::pair<uint256, CKeyID>, std::pair<CPubKey, std::vector<unsigned char>>>& desc_crypt_keys)\n+{\n+    if (!IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) ||\n+        IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) ||\n+        IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        return;\n+    }\n+\n+\n+    std::map<CExtPubKey, std::pair<std::map<OutputType, int>, uint64_t>> descs_keys;\n+    std::map<OutputType, int> tmpl = {{OutputType::LEGACY, 0}, {OutputType::P2SH_SEGWIT, 0}, {OutputType::BECH32, 0}};\n+\n+    for (const auto& spkm : GetAllScriptPubKeyMans()) {\n+        const DescriptorScriptPubKeyMan* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+        assert(desc_spkm);\n+        LOCK(desc_spkm->cs_desc_man);\n+        WalletDescriptor w_desc = desc_spkm->GetWalletDescriptor();\n+\n+        // Automatically generated descriptors are ranged\n+        if (!w_desc.descriptor->IsRange()) {\n+            continue;\n+        }\n+\n+        // Audotmatically generated descriptors have exactly 1 xpub and no other keys\n+        std::set<CPubKey> desc_pubkeys;\n+        std::set<CExtPubKey> desc_xpubs;\n+        w_desc.descriptor->GetPubKeys(desc_pubkeys, desc_xpubs);\n+        if (desc_xpubs.size() != 1 || desc_pubkeys.size() != 0) {\n+            continue;\n+        }\n+        const CExtPubKey& xpub = *desc_xpubs.begin();\n+\n+        if (descs_keys.count(xpub) == 0) {\n+            descs_keys.emplace(xpub, std::make_pair(tmpl, 0));\n+        }\n+\n+        // Automatically generated descriptors have an output type that is one of legacy, p2sh-segwit, or bech32\n+        std::optional<OutputType> output_type = w_desc.descriptor->GetOutputType();\n+        if (!output_type.has_value()) {\n+            continue;\n+        }\n+        if (LEGACY_OUTPUT_TYPES.count(output_type.value()) == 0) {\n+            continue;\n+        }\n+        descs_keys[xpub].first[output_type.value()]++;\n+\n+        if (w_desc.creation_time > descs_keys[xpub].second) {\n+            descs_keys[xpub].second = w_desc.creation_time;\n+        }\n+    }\n+\n+    // Find candidate active xpubs",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 69,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "0571caf6324549e2b840e58d8b11c3d31973a7c4",
      "in_reply_to_id": null,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "they don't have to be active\r\n```diff\r\n- // Find candidate active xpubs\r\n+ // Find candidate xpubs\r\n```",
      "created_at": "2023-04-03T08:04:33Z",
      "updated_at": "2023-04-03T08:15:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1155615459",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1155615459"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 590,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1155618170",
      "pull_request_review_id": 1368451328,
      "id": 1155618170,
      "node_id": "PRRC_kwDOABII585E4VV6",
      "diff_hunk": "@@ -522,6 +522,121 @@ void CWallet::UpgradeDescriptorCache()\n     SetWalletFlag(WALLET_FLAG_LAST_HARDENED_XPUB_CACHED);\n }\n \n+/**\n+ * UpgradeToGlobalHDKey searches through the descriptors in a descriptor wallet and tries to find a CExtPubKey\n+ * which is likely to be the most recent one used to generate all of the automatically generated descriptors.\n+ * The automatically generated descriptors are guaranteed to be 2 p2pkh, 2 p2sh-segwit, and 2 p2wpkh. There may\n+ * be 2 p2tr descriptors, as well as imports. Those are ignored as they are not guaranteed to be present in all wallets.\n+ * Candidate CExtKeys are those that appear in the aforementioned descriptors as the only key. The best candidate is\n+ * selected as the one that was most recently used.\n+ *\n+ * The best candidate will be added to the wallet as the current active HD key. Any other candidates will be added as\n+ * HD keys that have been rotated out.\n+ *\n+ * WALLET_FLAG_GLOBAL_HD_KEY will be set in order to indicate that this upgrade has occurred.\n+ */\n+void CWallet::UpgradeToGlobalHDKey(WalletBatch& batch, const std::map<std::pair<uint256, CKeyID>, CKey>& desc_keys, const std::map<std::pair<uint256, CKeyID>, std::pair<CPubKey, std::vector<unsigned char>>>& desc_crypt_keys)\n+{\n+    if (!IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) ||\n+        IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) ||\n+        IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        return;\n+    }\n+\n+\n+    std::map<CExtPubKey, std::pair<std::map<OutputType, int>, uint64_t>> descs_keys;\n+    std::map<OutputType, int> tmpl = {{OutputType::LEGACY, 0}, {OutputType::P2SH_SEGWIT, 0}, {OutputType::BECH32, 0}};\n+\n+    for (const auto& spkm : GetAllScriptPubKeyMans()) {\n+        const DescriptorScriptPubKeyMan* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+        assert(desc_spkm);\n+        LOCK(desc_spkm->cs_desc_man);\n+        WalletDescriptor w_desc = desc_spkm->GetWalletDescriptor();\n+\n+        // Automatically generated descriptors are ranged\n+        if (!w_desc.descriptor->IsRange()) {\n+            continue;\n+        }\n+\n+        // Audotmatically generated descriptors have exactly 1 xpub and no other keys\n+        std::set<CPubKey> desc_pubkeys;\n+        std::set<CExtPubKey> desc_xpubs;\n+        w_desc.descriptor->GetPubKeys(desc_pubkeys, desc_xpubs);\n+        if (desc_xpubs.size() != 1 || desc_pubkeys.size() != 0) {\n+            continue;\n+        }\n+        const CExtPubKey& xpub = *desc_xpubs.begin();\n+\n+        if (descs_keys.count(xpub) == 0) {\n+            descs_keys.emplace(xpub, std::make_pair(tmpl, 0));\n+        }\n+\n+        // Automatically generated descriptors have an output type that is one of legacy, p2sh-segwit, or bech32\n+        std::optional<OutputType> output_type = w_desc.descriptor->GetOutputType();\n+        if (!output_type.has_value()) {\n+            continue;\n+        }\n+        if (LEGACY_OUTPUT_TYPES.count(output_type.value()) == 0) {\n+            continue;\n+        }\n+        descs_keys[xpub].first[output_type.value()]++;\n+\n+        if (w_desc.creation_time > descs_keys[xpub].second) {\n+            descs_keys[xpub].second = w_desc.creation_time;\n+        }\n+    }\n+\n+    // Find candidate active xpubs\n+    // These are the ones that are used in 2 pkh(), 2 sh(wpkh()), and 2 wpkh() descriptors\n+    uint64_t best_time = 0;\n+    std::optional<CExtPubKey> best_xpub;\n+    std::map<CKeyID, CExtPubKey> xpubs;\n+    for (const auto& [xpub, info] : descs_keys) {\n+        const auto& [dtypes, desc_time] = info;\n+        if (std::all_of(dtypes.begin(), dtypes.end(), [](const auto& p) { return p.second == 2;})) {\n+            xpubs.emplace(xpub.pubkey.GetID(), xpub);\n+            if (desc_time > best_time) {\n+                best_time = desc_time;\n+                best_xpub.emplace(xpub);\n+            }\n+        }\n+    }\n+\n+    // Add hd keys",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 85,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "0571caf6324549e2b840e58d8b11c3d31973a7c4",
      "in_reply_to_id": null,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Could clarify comment:\r\nFor all the candidate xpubs add corresponding private key if available",
      "created_at": "2023-04-03T08:07:10Z",
      "updated_at": "2023-04-03T08:15:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1155618170",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1155618170"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 606,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1155623853",
      "pull_request_review_id": 1368451328,
      "id": 1155623853,
      "node_id": "PRRC_kwDOABII585E4Wut",
      "diff_hunk": "@@ -522,6 +522,121 @@ void CWallet::UpgradeDescriptorCache()\n     SetWalletFlag(WALLET_FLAG_LAST_HARDENED_XPUB_CACHED);\n }\n \n+/**\n+ * UpgradeToGlobalHDKey searches through the descriptors in a descriptor wallet and tries to find a CExtPubKey\n+ * which is likely to be the most recent one used to generate all of the automatically generated descriptors.\n+ * The automatically generated descriptors are guaranteed to be 2 p2pkh, 2 p2sh-segwit, and 2 p2wpkh. There may\n+ * be 2 p2tr descriptors, as well as imports. Those are ignored as they are not guaranteed to be present in all wallets.\n+ * Candidate CExtKeys are those that appear in the aforementioned descriptors as the only key. The best candidate is\n+ * selected as the one that was most recently used.\n+ *\n+ * The best candidate will be added to the wallet as the current active HD key. Any other candidates will be added as\n+ * HD keys that have been rotated out.\n+ *\n+ * WALLET_FLAG_GLOBAL_HD_KEY will be set in order to indicate that this upgrade has occurred.\n+ */\n+void CWallet::UpgradeToGlobalHDKey(WalletBatch& batch, const std::map<std::pair<uint256, CKeyID>, CKey>& desc_keys, const std::map<std::pair<uint256, CKeyID>, std::pair<CPubKey, std::vector<unsigned char>>>& desc_crypt_keys)\n+{\n+    if (!IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) ||\n+        IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) ||\n+        IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        return;\n+    }\n+\n+\n+    std::map<CExtPubKey, std::pair<std::map<OutputType, int>, uint64_t>> descs_keys;\n+    std::map<OutputType, int> tmpl = {{OutputType::LEGACY, 0}, {OutputType::P2SH_SEGWIT, 0}, {OutputType::BECH32, 0}};\n+\n+    for (const auto& spkm : GetAllScriptPubKeyMans()) {\n+        const DescriptorScriptPubKeyMan* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+        assert(desc_spkm);\n+        LOCK(desc_spkm->cs_desc_man);\n+        WalletDescriptor w_desc = desc_spkm->GetWalletDescriptor();\n+\n+        // Automatically generated descriptors are ranged\n+        if (!w_desc.descriptor->IsRange()) {\n+            continue;\n+        }\n+\n+        // Audotmatically generated descriptors have exactly 1 xpub and no other keys\n+        std::set<CPubKey> desc_pubkeys;\n+        std::set<CExtPubKey> desc_xpubs;\n+        w_desc.descriptor->GetPubKeys(desc_pubkeys, desc_xpubs);\n+        if (desc_xpubs.size() != 1 || desc_pubkeys.size() != 0) {\n+            continue;\n+        }\n+        const CExtPubKey& xpub = *desc_xpubs.begin();\n+\n+        if (descs_keys.count(xpub) == 0) {\n+            descs_keys.emplace(xpub, std::make_pair(tmpl, 0));\n+        }\n+\n+        // Automatically generated descriptors have an output type that is one of legacy, p2sh-segwit, or bech32\n+        std::optional<OutputType> output_type = w_desc.descriptor->GetOutputType();\n+        if (!output_type.has_value()) {\n+            continue;\n+        }\n+        if (LEGACY_OUTPUT_TYPES.count(output_type.value()) == 0) {\n+            continue;\n+        }\n+        descs_keys[xpub].first[output_type.value()]++;\n+\n+        if (w_desc.creation_time > descs_keys[xpub].second) {\n+            descs_keys[xpub].second = w_desc.creation_time;\n+        }\n+    }\n+\n+    // Find candidate active xpubs\n+    // These are the ones that are used in 2 pkh(), 2 sh(wpkh()), and 2 wpkh() descriptors\n+    uint64_t best_time = 0;\n+    std::optional<CExtPubKey> best_xpub;\n+    std::map<CKeyID, CExtPubKey> xpubs;\n+    for (const auto& [xpub, info] : descs_keys) {\n+        const auto& [dtypes, desc_time] = info;\n+        if (std::all_of(dtypes.begin(), dtypes.end(), [](const auto& p) { return p.second == 2;})) {\n+            xpubs.emplace(xpub.pubkey.GetID(), xpub);\n+            if (desc_time > best_time) {\n+                best_time = desc_time;\n+                best_xpub.emplace(xpub);\n+            }\n+        }\n+    }\n+\n+    // Add hd keys\n+    for (const auto& [id_pair, key] : desc_keys) {\n+        const auto& [desc_id, keyid] = id_pair;\n+\n+        const auto& it = xpubs.find(keyid);\n+        if (it == xpubs.end()) {\n+            continue;\n+        }\n+\n+        CExtKey extkey(it->second, key);\n+        AddHDKey(extkey);\n+        xpubs.erase(it);",
      "path": "src/wallet/wallet.cpp",
      "position": 96,
      "original_position": 96,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "0571caf6324549e2b840e58d8b11c3d31973a7c4",
      "in_reply_to_id": null,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "why do we need to erase it?",
      "created_at": "2023-04-03T08:12:26Z",
      "updated_at": "2023-04-03T08:15:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1155623853",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1155623853"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 611,
      "original_line": 611,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1155626611",
      "pull_request_review_id": 1368451328,
      "id": 1155626611,
      "node_id": "PRRC_kwDOABII585E4XZz",
      "diff_hunk": "@@ -522,6 +522,121 @@ void CWallet::UpgradeDescriptorCache()\n     SetWalletFlag(WALLET_FLAG_LAST_HARDENED_XPUB_CACHED);\n }\n \n+/**\n+ * UpgradeToGlobalHDKey searches through the descriptors in a descriptor wallet and tries to find a CExtPubKey\n+ * which is likely to be the most recent one used to generate all of the automatically generated descriptors.\n+ * The automatically generated descriptors are guaranteed to be 2 p2pkh, 2 p2sh-segwit, and 2 p2wpkh. There may\n+ * be 2 p2tr descriptors, as well as imports. Those are ignored as they are not guaranteed to be present in all wallets.\n+ * Candidate CExtKeys are those that appear in the aforementioned descriptors as the only key. The best candidate is\n+ * selected as the one that was most recently used.\n+ *\n+ * The best candidate will be added to the wallet as the current active HD key. Any other candidates will be added as\n+ * HD keys that have been rotated out.\n+ *\n+ * WALLET_FLAG_GLOBAL_HD_KEY will be set in order to indicate that this upgrade has occurred.\n+ */\n+void CWallet::UpgradeToGlobalHDKey(WalletBatch& batch, const std::map<std::pair<uint256, CKeyID>, CKey>& desc_keys, const std::map<std::pair<uint256, CKeyID>, std::pair<CPubKey, std::vector<unsigned char>>>& desc_crypt_keys)\n+{\n+    if (!IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) ||\n+        IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) ||\n+        IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        return;\n+    }\n+\n+\n+    std::map<CExtPubKey, std::pair<std::map<OutputType, int>, uint64_t>> descs_keys;\n+    std::map<OutputType, int> tmpl = {{OutputType::LEGACY, 0}, {OutputType::P2SH_SEGWIT, 0}, {OutputType::BECH32, 0}};\n+\n+    for (const auto& spkm : GetAllScriptPubKeyMans()) {\n+        const DescriptorScriptPubKeyMan* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+        assert(desc_spkm);\n+        LOCK(desc_spkm->cs_desc_man);\n+        WalletDescriptor w_desc = desc_spkm->GetWalletDescriptor();\n+\n+        // Automatically generated descriptors are ranged\n+        if (!w_desc.descriptor->IsRange()) {\n+            continue;\n+        }\n+\n+        // Audotmatically generated descriptors have exactly 1 xpub and no other keys\n+        std::set<CPubKey> desc_pubkeys;\n+        std::set<CExtPubKey> desc_xpubs;\n+        w_desc.descriptor->GetPubKeys(desc_pubkeys, desc_xpubs);\n+        if (desc_xpubs.size() != 1 || desc_pubkeys.size() != 0) {\n+            continue;\n+        }\n+        const CExtPubKey& xpub = *desc_xpubs.begin();\n+\n+        if (descs_keys.count(xpub) == 0) {\n+            descs_keys.emplace(xpub, std::make_pair(tmpl, 0));\n+        }\n+\n+        // Automatically generated descriptors have an output type that is one of legacy, p2sh-segwit, or bech32\n+        std::optional<OutputType> output_type = w_desc.descriptor->GetOutputType();\n+        if (!output_type.has_value()) {\n+            continue;\n+        }\n+        if (LEGACY_OUTPUT_TYPES.count(output_type.value()) == 0) {\n+            continue;\n+        }\n+        descs_keys[xpub].first[output_type.value()]++;\n+\n+        if (w_desc.creation_time > descs_keys[xpub].second) {\n+            descs_keys[xpub].second = w_desc.creation_time;\n+        }\n+    }\n+\n+    // Find candidate active xpubs\n+    // These are the ones that are used in 2 pkh(), 2 sh(wpkh()), and 2 wpkh() descriptors\n+    uint64_t best_time = 0;\n+    std::optional<CExtPubKey> best_xpub;\n+    std::map<CKeyID, CExtPubKey> xpubs;\n+    for (const auto& [xpub, info] : descs_keys) {\n+        const auto& [dtypes, desc_time] = info;\n+        if (std::all_of(dtypes.begin(), dtypes.end(), [](const auto& p) { return p.second == 2;})) {\n+            xpubs.emplace(xpub.pubkey.GetID(), xpub);\n+            if (desc_time > best_time) {\n+                best_time = desc_time;\n+                best_xpub.emplace(xpub);\n+            }\n+        }\n+    }\n+\n+    // Add hd keys\n+    for (const auto& [id_pair, key] : desc_keys) {\n+        const auto& [desc_id, keyid] = id_pair;\n+\n+        const auto& it = xpubs.find(keyid);\n+        if (it == xpubs.end()) {\n+            continue;\n+        }\n+\n+        CExtKey extkey(it->second, key);\n+        AddHDKey(extkey);\n+        xpubs.erase(it);\n+    }\n+    for (const auto& [id_pair, key_pair] : desc_crypt_keys) {\n+        const auto& [desc_id, keyid] = id_pair;\n+        const auto& [pubkey, ckey] = key_pair;\n+\n+        const auto& it = xpubs.find(keyid);\n+        if (it == xpubs.end()) {\n+            continue;\n+        }\n+\n+        LoadHDCryptedKey(it->second, ckey);\n+        batch.WriteHDCryptedKey(it->second, ckey);",
      "path": "src/wallet/wallet.cpp",
      "position": 108,
      "original_position": 108,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "0571caf6324549e2b840e58d8b11c3d31973a7c4",
      "in_reply_to_id": null,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This requires compatibility between `WALLETDESCRIPTORCKEY` and `HDCKEY`. Should we document it somewhere?",
      "created_at": "2023-04-03T08:15:05Z",
      "updated_at": "2023-04-03T08:15:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1155626611",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1155626611"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 623,
      "original_line": 623,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161800943",
      "pull_request_review_id": 1377668644,
      "id": 1161800943,
      "node_id": "PRRC_kwDOABII585FP6zv",
      "diff_hunk": "@@ -522,6 +522,121 @@ void CWallet::UpgradeDescriptorCache()\n     SetWalletFlag(WALLET_FLAG_LAST_HARDENED_XPUB_CACHED);\n }\n \n+/**\n+ * UpgradeToGlobalHDKey searches through the descriptors in a descriptor wallet and tries to find a CExtPubKey\n+ * which is likely to be the most recent one used to generate all of the automatically generated descriptors.\n+ * The automatically generated descriptors are guaranteed to be 2 p2pkh, 2 p2sh-segwit, and 2 p2wpkh. There may",
      "path": "src/wallet/wallet.cpp",
      "position": 7,
      "original_position": 7,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "0571caf6324549e2b840e58d8b11c3d31973a7c4",
      "in_reply_to_id": 1155609607,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "If they're no longer active, we don't know internalness.",
      "created_at": "2023-04-10T15:05:23Z",
      "updated_at": "2023-04-10T15:05:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1161800943",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161800943"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 522,
      "original_line": 522,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161805097",
      "pull_request_review_id": 1377675194,
      "id": 1161805097,
      "node_id": "PRRC_kwDOABII585FP70p",
      "diff_hunk": "@@ -522,6 +522,121 @@ void CWallet::UpgradeDescriptorCache()\n     SetWalletFlag(WALLET_FLAG_LAST_HARDENED_XPUB_CACHED);\n }\n \n+/**\n+ * UpgradeToGlobalHDKey searches through the descriptors in a descriptor wallet and tries to find a CExtPubKey\n+ * which is likely to be the most recent one used to generate all of the automatically generated descriptors.\n+ * The automatically generated descriptors are guaranteed to be 2 p2pkh, 2 p2sh-segwit, and 2 p2wpkh. There may\n+ * be 2 p2tr descriptors, as well as imports. Those are ignored as they are not guaranteed to be present in all wallets.\n+ * Candidate CExtKeys are those that appear in the aforementioned descriptors as the only key. The best candidate is\n+ * selected as the one that was most recently used.\n+ *\n+ * The best candidate will be added to the wallet as the current active HD key. Any other candidates will be added as\n+ * HD keys that have been rotated out.\n+ *\n+ * WALLET_FLAG_GLOBAL_HD_KEY will be set in order to indicate that this upgrade has occurred.\n+ */\n+void CWallet::UpgradeToGlobalHDKey(WalletBatch& batch, const std::map<std::pair<uint256, CKeyID>, CKey>& desc_keys, const std::map<std::pair<uint256, CKeyID>, std::pair<CPubKey, std::vector<unsigned char>>>& desc_crypt_keys)\n+{\n+    if (!IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) ||\n+        IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) ||\n+        IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        return;\n+    }\n+\n+\n+    std::map<CExtPubKey, std::pair<std::map<OutputType, int>, uint64_t>> descs_keys;\n+    std::map<OutputType, int> tmpl = {{OutputType::LEGACY, 0}, {OutputType::P2SH_SEGWIT, 0}, {OutputType::BECH32, 0}};\n+\n+    for (const auto& spkm : GetAllScriptPubKeyMans()) {\n+        const DescriptorScriptPubKeyMan* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+        assert(desc_spkm);\n+        LOCK(desc_spkm->cs_desc_man);\n+        WalletDescriptor w_desc = desc_spkm->GetWalletDescriptor();\n+\n+        // Automatically generated descriptors are ranged\n+        if (!w_desc.descriptor->IsRange()) {\n+            continue;\n+        }\n+\n+        // Audotmatically generated descriptors have exactly 1 xpub and no other keys\n+        std::set<CPubKey> desc_pubkeys;\n+        std::set<CExtPubKey> desc_xpubs;\n+        w_desc.descriptor->GetPubKeys(desc_pubkeys, desc_xpubs);\n+        if (desc_xpubs.size() != 1 || desc_pubkeys.size() != 0) {\n+            continue;\n+        }\n+        const CExtPubKey& xpub = *desc_xpubs.begin();\n+\n+        if (descs_keys.count(xpub) == 0) {\n+            descs_keys.emplace(xpub, std::make_pair(tmpl, 0));\n+        }\n+\n+        // Automatically generated descriptors have an output type that is one of legacy, p2sh-segwit, or bech32\n+        std::optional<OutputType> output_type = w_desc.descriptor->GetOutputType();\n+        if (!output_type.has_value()) {\n+            continue;\n+        }\n+        if (LEGACY_OUTPUT_TYPES.count(output_type.value()) == 0) {\n+            continue;\n+        }\n+        descs_keys[xpub].first[output_type.value()]++;\n+\n+        if (w_desc.creation_time > descs_keys[xpub].second) {\n+            descs_keys[xpub].second = w_desc.creation_time;\n+        }\n+    }\n+\n+    // Find candidate active xpubs\n+    // These are the ones that are used in 2 pkh(), 2 sh(wpkh()), and 2 wpkh() descriptors\n+    uint64_t best_time = 0;\n+    std::optional<CExtPubKey> best_xpub;\n+    std::map<CKeyID, CExtPubKey> xpubs;\n+    for (const auto& [xpub, info] : descs_keys) {\n+        const auto& [dtypes, desc_time] = info;\n+        if (std::all_of(dtypes.begin(), dtypes.end(), [](const auto& p) { return p.second == 2;})) {\n+            xpubs.emplace(xpub.pubkey.GetID(), xpub);\n+            if (desc_time > best_time) {\n+                best_time = desc_time;\n+                best_xpub.emplace(xpub);\n+            }\n+        }\n+    }\n+\n+    // Add hd keys\n+    for (const auto& [id_pair, key] : desc_keys) {\n+        const auto& [desc_id, keyid] = id_pair;\n+\n+        const auto& it = xpubs.find(keyid);\n+        if (it == xpubs.end()) {\n+            continue;\n+        }\n+\n+        CExtKey extkey(it->second, key);\n+        AddHDKey(extkey);\n+        xpubs.erase(it);",
      "path": "src/wallet/wallet.cpp",
      "position": 96,
      "original_position": 96,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "0571caf6324549e2b840e58d8b11c3d31973a7c4",
      "in_reply_to_id": 1155623853,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "So they aren't repeatedly written when the same key shows up in multiple descriptors.",
      "created_at": "2023-04-10T15:10:19Z",
      "updated_at": "2023-04-10T15:10:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1161805097",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161805097"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 611,
      "original_line": 611,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161806010",
      "pull_request_review_id": 1377676657,
      "id": 1161806010,
      "node_id": "PRRC_kwDOABII585FP8C6",
      "diff_hunk": "@@ -522,6 +522,121 @@ void CWallet::UpgradeDescriptorCache()\n     SetWalletFlag(WALLET_FLAG_LAST_HARDENED_XPUB_CACHED);\n }\n \n+/**\n+ * UpgradeToGlobalHDKey searches through the descriptors in a descriptor wallet and tries to find a CExtPubKey\n+ * which is likely to be the most recent one used to generate all of the automatically generated descriptors.\n+ * The automatically generated descriptors are guaranteed to be 2 p2pkh, 2 p2sh-segwit, and 2 p2wpkh. There may\n+ * be 2 p2tr descriptors, as well as imports. Those are ignored as they are not guaranteed to be present in all wallets.\n+ * Candidate CExtKeys are those that appear in the aforementioned descriptors as the only key. The best candidate is\n+ * selected as the one that was most recently used.\n+ *\n+ * The best candidate will be added to the wallet as the current active HD key. Any other candidates will be added as\n+ * HD keys that have been rotated out.\n+ *\n+ * WALLET_FLAG_GLOBAL_HD_KEY will be set in order to indicate that this upgrade has occurred.\n+ */\n+void CWallet::UpgradeToGlobalHDKey(WalletBatch& batch, const std::map<std::pair<uint256, CKeyID>, CKey>& desc_keys, const std::map<std::pair<uint256, CKeyID>, std::pair<CPubKey, std::vector<unsigned char>>>& desc_crypt_keys)\n+{\n+    if (!IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) ||\n+        IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) ||\n+        IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        return;\n+    }\n+\n+\n+    std::map<CExtPubKey, std::pair<std::map<OutputType, int>, uint64_t>> descs_keys;\n+    std::map<OutputType, int> tmpl = {{OutputType::LEGACY, 0}, {OutputType::P2SH_SEGWIT, 0}, {OutputType::BECH32, 0}};\n+\n+    for (const auto& spkm : GetAllScriptPubKeyMans()) {\n+        const DescriptorScriptPubKeyMan* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+        assert(desc_spkm);\n+        LOCK(desc_spkm->cs_desc_man);\n+        WalletDescriptor w_desc = desc_spkm->GetWalletDescriptor();\n+\n+        // Automatically generated descriptors are ranged\n+        if (!w_desc.descriptor->IsRange()) {\n+            continue;\n+        }\n+\n+        // Audotmatically generated descriptors have exactly 1 xpub and no other keys\n+        std::set<CPubKey> desc_pubkeys;\n+        std::set<CExtPubKey> desc_xpubs;\n+        w_desc.descriptor->GetPubKeys(desc_pubkeys, desc_xpubs);\n+        if (desc_xpubs.size() != 1 || desc_pubkeys.size() != 0) {\n+            continue;\n+        }\n+        const CExtPubKey& xpub = *desc_xpubs.begin();\n+\n+        if (descs_keys.count(xpub) == 0) {\n+            descs_keys.emplace(xpub, std::make_pair(tmpl, 0));\n+        }\n+\n+        // Automatically generated descriptors have an output type that is one of legacy, p2sh-segwit, or bech32\n+        std::optional<OutputType> output_type = w_desc.descriptor->GetOutputType();\n+        if (!output_type.has_value()) {\n+            continue;\n+        }\n+        if (LEGACY_OUTPUT_TYPES.count(output_type.value()) == 0) {\n+            continue;\n+        }\n+        descs_keys[xpub].first[output_type.value()]++;\n+\n+        if (w_desc.creation_time > descs_keys[xpub].second) {\n+            descs_keys[xpub].second = w_desc.creation_time;\n+        }\n+    }\n+\n+    // Find candidate active xpubs\n+    // These are the ones that are used in 2 pkh(), 2 sh(wpkh()), and 2 wpkh() descriptors\n+    uint64_t best_time = 0;\n+    std::optional<CExtPubKey> best_xpub;\n+    std::map<CKeyID, CExtPubKey> xpubs;\n+    for (const auto& [xpub, info] : descs_keys) {\n+        const auto& [dtypes, desc_time] = info;\n+        if (std::all_of(dtypes.begin(), dtypes.end(), [](const auto& p) { return p.second == 2;})) {\n+            xpubs.emplace(xpub.pubkey.GetID(), xpub);\n+            if (desc_time > best_time) {\n+                best_time = desc_time;\n+                best_xpub.emplace(xpub);\n+            }\n+        }\n+    }\n+\n+    // Add hd keys\n+    for (const auto& [id_pair, key] : desc_keys) {\n+        const auto& [desc_id, keyid] = id_pair;\n+\n+        const auto& it = xpubs.find(keyid);\n+        if (it == xpubs.end()) {\n+            continue;\n+        }\n+\n+        CExtKey extkey(it->second, key);\n+        AddHDKey(extkey);\n+        xpubs.erase(it);\n+    }\n+    for (const auto& [id_pair, key_pair] : desc_crypt_keys) {\n+        const auto& [desc_id, keyid] = id_pair;\n+        const auto& [pubkey, ckey] = key_pair;\n+\n+        const auto& it = xpubs.find(keyid);\n+        if (it == xpubs.end()) {\n+            continue;\n+        }\n+\n+        LoadHDCryptedKey(it->second, ckey);\n+        batch.WriteHDCryptedKey(it->second, ckey);",
      "path": "src/wallet/wallet.cpp",
      "position": 108,
      "original_position": 108,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "0571caf6324549e2b840e58d8b11c3d31973a7c4",
      "in_reply_to_id": 1155626611,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The encrypted secrets are all in the same format for both legacy wallet keys, descriptor keys, and now hd ckeys. I suppose this could be documented somewhere, although it's not immediately obvious where.",
      "created_at": "2023-04-10T15:11:30Z",
      "updated_at": "2023-04-10T15:11:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1161806010",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161806010"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 623,
      "original_line": 623,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161810575",
      "pull_request_review_id": 1377683610,
      "id": 1161810575,
      "node_id": "PRRC_kwDOABII585FP9KP",
      "diff_hunk": "@@ -522,6 +522,121 @@ void CWallet::UpgradeDescriptorCache()\n     SetWalletFlag(WALLET_FLAG_LAST_HARDENED_XPUB_CACHED);\n }\n \n+/**\n+ * UpgradeToGlobalHDKey searches through the descriptors in a descriptor wallet and tries to find a CExtPubKey\n+ * which is likely to be the most recent one used to generate all of the automatically generated descriptors.\n+ * The automatically generated descriptors are guaranteed to be 2 p2pkh, 2 p2sh-segwit, and 2 p2wpkh. There may\n+ * be 2 p2tr descriptors, as well as imports. Those are ignored as they are not guaranteed to be present in all wallets.\n+ * Candidate CExtKeys are those that appear in the aforementioned descriptors as the only key. The best candidate is\n+ * selected as the one that was most recently used.\n+ *\n+ * The best candidate will be added to the wallet as the current active HD key. Any other candidates will be added as\n+ * HD keys that have been rotated out.\n+ *\n+ * WALLET_FLAG_GLOBAL_HD_KEY will be set in order to indicate that this upgrade has occurred.\n+ */\n+void CWallet::UpgradeToGlobalHDKey(WalletBatch& batch, const std::map<std::pair<uint256, CKeyID>, CKey>& desc_keys, const std::map<std::pair<uint256, CKeyID>, std::pair<CPubKey, std::vector<unsigned char>>>& desc_crypt_keys)\n+{\n+    if (!IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) ||\n+        IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) ||\n+        IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        return;\n+    }\n+\n+\n+    std::map<CExtPubKey, std::pair<std::map<OutputType, int>, uint64_t>> descs_keys;\n+    std::map<OutputType, int> tmpl = {{OutputType::LEGACY, 0}, {OutputType::P2SH_SEGWIT, 0}, {OutputType::BECH32, 0}};\n+\n+    for (const auto& spkm : GetAllScriptPubKeyMans()) {\n+        const DescriptorScriptPubKeyMan* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+        assert(desc_spkm);\n+        LOCK(desc_spkm->cs_desc_man);\n+        WalletDescriptor w_desc = desc_spkm->GetWalletDescriptor();\n+\n+        // Automatically generated descriptors are ranged\n+        if (!w_desc.descriptor->IsRange()) {\n+            continue;\n+        }\n+\n+        // Audotmatically generated descriptors have exactly 1 xpub and no other keys\n+        std::set<CPubKey> desc_pubkeys;\n+        std::set<CExtPubKey> desc_xpubs;\n+        w_desc.descriptor->GetPubKeys(desc_pubkeys, desc_xpubs);\n+        if (desc_xpubs.size() != 1 || desc_pubkeys.size() != 0) {\n+            continue;\n+        }\n+        const CExtPubKey& xpub = *desc_xpubs.begin();\n+\n+        if (descs_keys.count(xpub) == 0) {\n+            descs_keys.emplace(xpub, std::make_pair(tmpl, 0));\n+        }\n+\n+        // Automatically generated descriptors have an output type that is one of legacy, p2sh-segwit, or bech32\n+        std::optional<OutputType> output_type = w_desc.descriptor->GetOutputType();\n+        if (!output_type.has_value()) {\n+            continue;\n+        }\n+        if (LEGACY_OUTPUT_TYPES.count(output_type.value()) == 0) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 59,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "0571caf6324549e2b840e58d8b11c3d31973a7c4",
      "in_reply_to_id": 1155586506,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2023-04-10T15:16:58Z",
      "updated_at": "2023-04-10T15:16:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1161810575",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161810575"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 580,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161810707",
      "pull_request_review_id": 1377683811,
      "id": 1161810707,
      "node_id": "PRRC_kwDOABII585FP9MT",
      "diff_hunk": "@@ -522,6 +522,121 @@ void CWallet::UpgradeDescriptorCache()\n     SetWalletFlag(WALLET_FLAG_LAST_HARDENED_XPUB_CACHED);\n }\n \n+/**\n+ * UpgradeToGlobalHDKey searches through the descriptors in a descriptor wallet and tries to find a CExtPubKey\n+ * which is likely to be the most recent one used to generate all of the automatically generated descriptors.\n+ * The automatically generated descriptors are guaranteed to be 2 p2pkh, 2 p2sh-segwit, and 2 p2wpkh. There may\n+ * be 2 p2tr descriptors, as well as imports. Those are ignored as they are not guaranteed to be present in all wallets.\n+ * Candidate CExtKeys are those that appear in the aforementioned descriptors as the only key. The best candidate is\n+ * selected as the one that was most recently used.\n+ *\n+ * The best candidate will be added to the wallet as the current active HD key. Any other candidates will be added as\n+ * HD keys that have been rotated out.\n+ *\n+ * WALLET_FLAG_GLOBAL_HD_KEY will be set in order to indicate that this upgrade has occurred.\n+ */\n+void CWallet::UpgradeToGlobalHDKey(WalletBatch& batch, const std::map<std::pair<uint256, CKeyID>, CKey>& desc_keys, const std::map<std::pair<uint256, CKeyID>, std::pair<CPubKey, std::vector<unsigned char>>>& desc_crypt_keys)\n+{\n+    if (!IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) ||\n+        IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) ||\n+        IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        return;\n+    }\n+\n+\n+    std::map<CExtPubKey, std::pair<std::map<OutputType, int>, uint64_t>> descs_keys;",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 27,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "0571caf6324549e2b840e58d8b11c3d31973a7c4",
      "in_reply_to_id": 1155604123,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Changed",
      "created_at": "2023-04-10T15:17:08Z",
      "updated_at": "2023-04-10T15:17:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1161810707",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161810707"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 548,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161810822",
      "pull_request_review_id": 1377684010,
      "id": 1161810822,
      "node_id": "PRRC_kwDOABII585FP9OG",
      "diff_hunk": "@@ -522,6 +522,121 @@ void CWallet::UpgradeDescriptorCache()\n     SetWalletFlag(WALLET_FLAG_LAST_HARDENED_XPUB_CACHED);\n }\n \n+/**\n+ * UpgradeToGlobalHDKey searches through the descriptors in a descriptor wallet and tries to find a CExtPubKey\n+ * which is likely to be the most recent one used to generate all of the automatically generated descriptors.\n+ * The automatically generated descriptors are guaranteed to be 2 p2pkh, 2 p2sh-segwit, and 2 p2wpkh. There may\n+ * be 2 p2tr descriptors, as well as imports. Those are ignored as they are not guaranteed to be present in all wallets.\n+ * Candidate CExtKeys are those that appear in the aforementioned descriptors as the only key. The best candidate is\n+ * selected as the one that was most recently used.\n+ *\n+ * The best candidate will be added to the wallet as the current active HD key. Any other candidates will be added as\n+ * HD keys that have been rotated out.\n+ *\n+ * WALLET_FLAG_GLOBAL_HD_KEY will be set in order to indicate that this upgrade has occurred.\n+ */\n+void CWallet::UpgradeToGlobalHDKey(WalletBatch& batch, const std::map<std::pair<uint256, CKeyID>, CKey>& desc_keys, const std::map<std::pair<uint256, CKeyID>, std::pair<CPubKey, std::vector<unsigned char>>>& desc_crypt_keys)",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 17,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "0571caf6324549e2b840e58d8b11c3d31973a7c4",
      "in_reply_to_id": 1155610688,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2023-04-10T15:17:19Z",
      "updated_at": "2023-04-10T15:17:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1161810822",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161810822"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 538,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161810914",
      "pull_request_review_id": 1377684161,
      "id": 1161810914,
      "node_id": "PRRC_kwDOABII585FP9Pi",
      "diff_hunk": "@@ -522,6 +522,121 @@ void CWallet::UpgradeDescriptorCache()\n     SetWalletFlag(WALLET_FLAG_LAST_HARDENED_XPUB_CACHED);\n }\n \n+/**\n+ * UpgradeToGlobalHDKey searches through the descriptors in a descriptor wallet and tries to find a CExtPubKey\n+ * which is likely to be the most recent one used to generate all of the automatically generated descriptors.\n+ * The automatically generated descriptors are guaranteed to be 2 p2pkh, 2 p2sh-segwit, and 2 p2wpkh. There may\n+ * be 2 p2tr descriptors, as well as imports. Those are ignored as they are not guaranteed to be present in all wallets.\n+ * Candidate CExtKeys are those that appear in the aforementioned descriptors as the only key. The best candidate is\n+ * selected as the one that was most recently used.\n+ *\n+ * The best candidate will be added to the wallet as the current active HD key. Any other candidates will be added as\n+ * HD keys that have been rotated out.\n+ *\n+ * WALLET_FLAG_GLOBAL_HD_KEY will be set in order to indicate that this upgrade has occurred.\n+ */\n+void CWallet::UpgradeToGlobalHDKey(WalletBatch& batch, const std::map<std::pair<uint256, CKeyID>, CKey>& desc_keys, const std::map<std::pair<uint256, CKeyID>, std::pair<CPubKey, std::vector<unsigned char>>>& desc_crypt_keys)\n+{\n+    if (!IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) ||\n+        IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) ||\n+        IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        return;\n+    }\n+\n+\n+    std::map<CExtPubKey, std::pair<std::map<OutputType, int>, uint64_t>> descs_keys;\n+    std::map<OutputType, int> tmpl = {{OutputType::LEGACY, 0}, {OutputType::P2SH_SEGWIT, 0}, {OutputType::BECH32, 0}};\n+\n+    for (const auto& spkm : GetAllScriptPubKeyMans()) {\n+        const DescriptorScriptPubKeyMan* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+        assert(desc_spkm);\n+        LOCK(desc_spkm->cs_desc_man);\n+        WalletDescriptor w_desc = desc_spkm->GetWalletDescriptor();\n+\n+        // Automatically generated descriptors are ranged\n+        if (!w_desc.descriptor->IsRange()) {\n+            continue;\n+        }\n+\n+        // Audotmatically generated descriptors have exactly 1 xpub and no other keys\n+        std::set<CPubKey> desc_pubkeys;\n+        std::set<CExtPubKey> desc_xpubs;\n+        w_desc.descriptor->GetPubKeys(desc_pubkeys, desc_xpubs);\n+        if (desc_xpubs.size() != 1 || desc_pubkeys.size() != 0) {\n+            continue;\n+        }\n+        const CExtPubKey& xpub = *desc_xpubs.begin();\n+\n+        if (descs_keys.count(xpub) == 0) {\n+            descs_keys.emplace(xpub, std::make_pair(tmpl, 0));\n+        }\n+\n+        // Automatically generated descriptors have an output type that is one of legacy, p2sh-segwit, or bech32\n+        std::optional<OutputType> output_type = w_desc.descriptor->GetOutputType();\n+        if (!output_type.has_value()) {\n+            continue;\n+        }\n+        if (LEGACY_OUTPUT_TYPES.count(output_type.value()) == 0) {\n+            continue;\n+        }\n+        descs_keys[xpub].first[output_type.value()]++;\n+\n+        if (w_desc.creation_time > descs_keys[xpub].second) {\n+            descs_keys[xpub].second = w_desc.creation_time;\n+        }\n+    }\n+\n+    // Find candidate active xpubs",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 69,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "0571caf6324549e2b840e58d8b11c3d31973a7c4",
      "in_reply_to_id": 1155615459,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2023-04-10T15:17:26Z",
      "updated_at": "2023-04-10T15:17:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1161810914",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161810914"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 590,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161811025",
      "pull_request_review_id": 1377684337,
      "id": 1161811025,
      "node_id": "PRRC_kwDOABII585FP9RR",
      "diff_hunk": "@@ -522,6 +522,121 @@ void CWallet::UpgradeDescriptorCache()\n     SetWalletFlag(WALLET_FLAG_LAST_HARDENED_XPUB_CACHED);\n }\n \n+/**\n+ * UpgradeToGlobalHDKey searches through the descriptors in a descriptor wallet and tries to find a CExtPubKey\n+ * which is likely to be the most recent one used to generate all of the automatically generated descriptors.\n+ * The automatically generated descriptors are guaranteed to be 2 p2pkh, 2 p2sh-segwit, and 2 p2wpkh. There may\n+ * be 2 p2tr descriptors, as well as imports. Those are ignored as they are not guaranteed to be present in all wallets.\n+ * Candidate CExtKeys are those that appear in the aforementioned descriptors as the only key. The best candidate is\n+ * selected as the one that was most recently used.\n+ *\n+ * The best candidate will be added to the wallet as the current active HD key. Any other candidates will be added as\n+ * HD keys that have been rotated out.\n+ *\n+ * WALLET_FLAG_GLOBAL_HD_KEY will be set in order to indicate that this upgrade has occurred.\n+ */\n+void CWallet::UpgradeToGlobalHDKey(WalletBatch& batch, const std::map<std::pair<uint256, CKeyID>, CKey>& desc_keys, const std::map<std::pair<uint256, CKeyID>, std::pair<CPubKey, std::vector<unsigned char>>>& desc_crypt_keys)\n+{\n+    if (!IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) ||\n+        IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) ||\n+        IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        return;\n+    }\n+\n+\n+    std::map<CExtPubKey, std::pair<std::map<OutputType, int>, uint64_t>> descs_keys;\n+    std::map<OutputType, int> tmpl = {{OutputType::LEGACY, 0}, {OutputType::P2SH_SEGWIT, 0}, {OutputType::BECH32, 0}};\n+\n+    for (const auto& spkm : GetAllScriptPubKeyMans()) {\n+        const DescriptorScriptPubKeyMan* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+        assert(desc_spkm);\n+        LOCK(desc_spkm->cs_desc_man);\n+        WalletDescriptor w_desc = desc_spkm->GetWalletDescriptor();\n+\n+        // Automatically generated descriptors are ranged\n+        if (!w_desc.descriptor->IsRange()) {\n+            continue;\n+        }\n+\n+        // Audotmatically generated descriptors have exactly 1 xpub and no other keys\n+        std::set<CPubKey> desc_pubkeys;\n+        std::set<CExtPubKey> desc_xpubs;\n+        w_desc.descriptor->GetPubKeys(desc_pubkeys, desc_xpubs);\n+        if (desc_xpubs.size() != 1 || desc_pubkeys.size() != 0) {\n+            continue;\n+        }\n+        const CExtPubKey& xpub = *desc_xpubs.begin();\n+\n+        if (descs_keys.count(xpub) == 0) {\n+            descs_keys.emplace(xpub, std::make_pair(tmpl, 0));\n+        }\n+\n+        // Automatically generated descriptors have an output type that is one of legacy, p2sh-segwit, or bech32\n+        std::optional<OutputType> output_type = w_desc.descriptor->GetOutputType();\n+        if (!output_type.has_value()) {\n+            continue;\n+        }\n+        if (LEGACY_OUTPUT_TYPES.count(output_type.value()) == 0) {\n+            continue;\n+        }\n+        descs_keys[xpub].first[output_type.value()]++;\n+\n+        if (w_desc.creation_time > descs_keys[xpub].second) {\n+            descs_keys[xpub].second = w_desc.creation_time;\n+        }\n+    }\n+\n+    // Find candidate active xpubs\n+    // These are the ones that are used in 2 pkh(), 2 sh(wpkh()), and 2 wpkh() descriptors\n+    uint64_t best_time = 0;\n+    std::optional<CExtPubKey> best_xpub;\n+    std::map<CKeyID, CExtPubKey> xpubs;\n+    for (const auto& [xpub, info] : descs_keys) {\n+        const auto& [dtypes, desc_time] = info;\n+        if (std::all_of(dtypes.begin(), dtypes.end(), [](const auto& p) { return p.second == 2;})) {\n+            xpubs.emplace(xpub.pubkey.GetID(), xpub);\n+            if (desc_time > best_time) {\n+                best_time = desc_time;\n+                best_xpub.emplace(xpub);\n+            }\n+        }\n+    }\n+\n+    // Add hd keys",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 85,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "0571caf6324549e2b840e58d8b11c3d31973a7c4",
      "in_reply_to_id": 1155618170,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2023-04-10T15:17:34Z",
      "updated_at": "2023-04-10T15:17:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1161811025",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161811025"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 606,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1162375326",
      "pull_request_review_id": 1378559287,
      "id": 1162375326,
      "node_id": "PRRC_kwDOABII585FSHCe",
      "diff_hunk": "@@ -522,6 +522,121 @@ void CWallet::UpgradeDescriptorCache()\n     SetWalletFlag(WALLET_FLAG_LAST_HARDENED_XPUB_CACHED);\n }\n \n+/**\n+ * UpgradeToGlobalHDKey searches through the descriptors in a descriptor wallet and tries to find a CExtPubKey\n+ * which is likely to be the most recent one used to generate all of the automatically generated descriptors.\n+ * The automatically generated descriptors are guaranteed to be 2 p2pkh, 2 p2sh-segwit, and 2 p2wpkh. There may\n+ * be 2 p2tr descriptors, as well as imports. Those are ignored as they are not guaranteed to be present in all wallets.\n+ * Candidate CExtKeys are those that appear in the aforementioned descriptors as the only key. The best candidate is\n+ * selected as the one that was most recently used.\n+ *\n+ * The best candidate will be added to the wallet as the current active HD key. Any other candidates will be added as\n+ * HD keys that have been rotated out.\n+ *\n+ * WALLET_FLAG_GLOBAL_HD_KEY will be set in order to indicate that this upgrade has occurred.\n+ */\n+void CWallet::UpgradeToGlobalHDKey(WalletBatch& batch, const std::map<std::pair<uint256, CKeyID>, CKey>& desc_keys, const std::map<std::pair<uint256, CKeyID>, std::pair<CPubKey, std::vector<unsigned char>>>& desc_crypt_keys)\n+{\n+    if (!IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) ||\n+        IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) ||\n+        IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        return;\n+    }\n+\n+\n+    std::map<CExtPubKey, std::pair<std::map<OutputType, int>, uint64_t>> descs_keys;\n+    std::map<OutputType, int> tmpl = {{OutputType::LEGACY, 0}, {OutputType::P2SH_SEGWIT, 0}, {OutputType::BECH32, 0}};\n+\n+    for (const auto& spkm : GetAllScriptPubKeyMans()) {\n+        const DescriptorScriptPubKeyMan* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+        assert(desc_spkm);\n+        LOCK(desc_spkm->cs_desc_man);\n+        WalletDescriptor w_desc = desc_spkm->GetWalletDescriptor();\n+\n+        // Automatically generated descriptors are ranged\n+        if (!w_desc.descriptor->IsRange()) {\n+            continue;\n+        }\n+\n+        // Audotmatically generated descriptors have exactly 1 xpub and no other keys\n+        std::set<CPubKey> desc_pubkeys;\n+        std::set<CExtPubKey> desc_xpubs;\n+        w_desc.descriptor->GetPubKeys(desc_pubkeys, desc_xpubs);\n+        if (desc_xpubs.size() != 1 || desc_pubkeys.size() != 0) {\n+            continue;\n+        }\n+        const CExtPubKey& xpub = *desc_xpubs.begin();\n+\n+        if (descs_keys.count(xpub) == 0) {\n+            descs_keys.emplace(xpub, std::make_pair(tmpl, 0));\n+        }\n+\n+        // Automatically generated descriptors have an output type that is one of legacy, p2sh-segwit, or bech32\n+        std::optional<OutputType> output_type = w_desc.descriptor->GetOutputType();\n+        if (!output_type.has_value()) {\n+            continue;\n+        }\n+        if (LEGACY_OUTPUT_TYPES.count(output_type.value()) == 0) {\n+            continue;\n+        }\n+        descs_keys[xpub].first[output_type.value()]++;\n+\n+        if (w_desc.creation_time > descs_keys[xpub].second) {\n+            descs_keys[xpub].second = w_desc.creation_time;\n+        }\n+    }\n+\n+    // Find candidate active xpubs\n+    // These are the ones that are used in 2 pkh(), 2 sh(wpkh()), and 2 wpkh() descriptors\n+    uint64_t best_time = 0;\n+    std::optional<CExtPubKey> best_xpub;\n+    std::map<CKeyID, CExtPubKey> xpubs;\n+    for (const auto& [xpub, info] : descs_keys) {\n+        const auto& [dtypes, desc_time] = info;\n+        if (std::all_of(dtypes.begin(), dtypes.end(), [](const auto& p) { return p.second == 2;})) {\n+            xpubs.emplace(xpub.pubkey.GetID(), xpub);\n+            if (desc_time > best_time) {\n+                best_time = desc_time;\n+                best_xpub.emplace(xpub);\n+            }\n+        }\n+    }\n+\n+    // Add hd keys\n+    for (const auto& [id_pair, key] : desc_keys) {\n+        const auto& [desc_id, keyid] = id_pair;\n+\n+        const auto& it = xpubs.find(keyid);\n+        if (it == xpubs.end()) {\n+            continue;\n+        }\n+\n+        CExtKey extkey(it->second, key);\n+        AddHDKey(extkey);\n+        xpubs.erase(it);\n+    }\n+    for (const auto& [id_pair, key_pair] : desc_crypt_keys) {\n+        const auto& [desc_id, keyid] = id_pair;\n+        const auto& [pubkey, ckey] = key_pair;\n+\n+        const auto& it = xpubs.find(keyid);\n+        if (it == xpubs.end()) {\n+            continue;\n+        }\n+\n+        LoadHDCryptedKey(it->second, ckey);\n+        batch.WriteHDCryptedKey(it->second, ckey);",
      "path": "src/wallet/wallet.cpp",
      "position": 108,
      "original_position": 108,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "0571caf6324549e2b840e58d8b11c3d31973a7c4",
      "in_reply_to_id": 1155626611,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yes this is nice to have. Since the key format could never change due to backward compatibility requirements, this is not an issue. You can resolve this comment.",
      "created_at": "2023-04-11T06:55:18Z",
      "updated_at": "2023-04-11T06:55:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1162375326",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1162375326"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 623,
      "original_line": 623,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1162378013",
      "pull_request_review_id": 1378563453,
      "id": 1162378013,
      "node_id": "PRRC_kwDOABII585FSHsd",
      "diff_hunk": "@@ -522,6 +522,121 @@ void CWallet::UpgradeDescriptorCache()\n     SetWalletFlag(WALLET_FLAG_LAST_HARDENED_XPUB_CACHED);\n }\n \n+/**\n+ * UpgradeToGlobalHDKey searches through the descriptors in a descriptor wallet and tries to find a CExtPubKey\n+ * which is likely to be the most recent one used to generate all of the automatically generated descriptors.\n+ * The automatically generated descriptors are guaranteed to be 2 p2pkh, 2 p2sh-segwit, and 2 p2wpkh. There may\n+ * be 2 p2tr descriptors, as well as imports. Those are ignored as they are not guaranteed to be present in all wallets.\n+ * Candidate CExtKeys are those that appear in the aforementioned descriptors as the only key. The best candidate is\n+ * selected as the one that was most recently used.\n+ *\n+ * The best candidate will be added to the wallet as the current active HD key. Any other candidates will be added as\n+ * HD keys that have been rotated out.\n+ *\n+ * WALLET_FLAG_GLOBAL_HD_KEY will be set in order to indicate that this upgrade has occurred.\n+ */\n+void CWallet::UpgradeToGlobalHDKey(WalletBatch& batch, const std::map<std::pair<uint256, CKeyID>, CKey>& desc_keys, const std::map<std::pair<uint256, CKeyID>, std::pair<CPubKey, std::vector<unsigned char>>>& desc_crypt_keys)\n+{\n+    if (!IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) ||\n+        IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) ||\n+        IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        return;\n+    }\n+\n+\n+    std::map<CExtPubKey, std::pair<std::map<OutputType, int>, uint64_t>> descs_keys;\n+    std::map<OutputType, int> tmpl = {{OutputType::LEGACY, 0}, {OutputType::P2SH_SEGWIT, 0}, {OutputType::BECH32, 0}};\n+\n+    for (const auto& spkm : GetAllScriptPubKeyMans()) {\n+        const DescriptorScriptPubKeyMan* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+        assert(desc_spkm);\n+        LOCK(desc_spkm->cs_desc_man);\n+        WalletDescriptor w_desc = desc_spkm->GetWalletDescriptor();\n+\n+        // Automatically generated descriptors are ranged\n+        if (!w_desc.descriptor->IsRange()) {\n+            continue;\n+        }\n+\n+        // Audotmatically generated descriptors have exactly 1 xpub and no other keys\n+        std::set<CPubKey> desc_pubkeys;\n+        std::set<CExtPubKey> desc_xpubs;\n+        w_desc.descriptor->GetPubKeys(desc_pubkeys, desc_xpubs);\n+        if (desc_xpubs.size() != 1 || desc_pubkeys.size() != 0) {\n+            continue;\n+        }\n+        const CExtPubKey& xpub = *desc_xpubs.begin();\n+\n+        if (descs_keys.count(xpub) == 0) {\n+            descs_keys.emplace(xpub, std::make_pair(tmpl, 0));\n+        }\n+\n+        // Automatically generated descriptors have an output type that is one of legacy, p2sh-segwit, or bech32\n+        std::optional<OutputType> output_type = w_desc.descriptor->GetOutputType();\n+        if (!output_type.has_value()) {\n+            continue;\n+        }\n+        if (LEGACY_OUTPUT_TYPES.count(output_type.value()) == 0) {\n+            continue;\n+        }\n+        descs_keys[xpub].first[output_type.value()]++;\n+\n+        if (w_desc.creation_time > descs_keys[xpub].second) {\n+            descs_keys[xpub].second = w_desc.creation_time;\n+        }\n+    }\n+\n+    // Find candidate active xpubs\n+    // These are the ones that are used in 2 pkh(), 2 sh(wpkh()), and 2 wpkh() descriptors\n+    uint64_t best_time = 0;\n+    std::optional<CExtPubKey> best_xpub;\n+    std::map<CKeyID, CExtPubKey> xpubs;\n+    for (const auto& [xpub, info] : descs_keys) {\n+        const auto& [dtypes, desc_time] = info;\n+        if (std::all_of(dtypes.begin(), dtypes.end(), [](const auto& p) { return p.second == 2;})) {\n+            xpubs.emplace(xpub.pubkey.GetID(), xpub);\n+            if (desc_time > best_time) {\n+                best_time = desc_time;\n+                best_xpub.emplace(xpub);\n+            }\n+        }\n+    }\n+\n+    // Add hd keys\n+    for (const auto& [id_pair, key] : desc_keys) {\n+        const auto& [desc_id, keyid] = id_pair;\n+\n+        const auto& it = xpubs.find(keyid);\n+        if (it == xpubs.end()) {\n+            continue;\n+        }\n+\n+        CExtKey extkey(it->second, key);\n+        AddHDKey(extkey);\n+        xpubs.erase(it);",
      "path": "src/wallet/wallet.cpp",
      "position": 96,
      "original_position": 96,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "0571caf6324549e2b840e58d8b11c3d31973a7c4",
      "in_reply_to_id": 1155623853,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I guess that's ok, but `AddHDKey` already has an early return for existing keys.",
      "created_at": "2023-04-11T06:58:28Z",
      "updated_at": "2023-04-11T06:58:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1162378013",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1162378013"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 611,
      "original_line": 611,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196058973",
      "pull_request_review_id": 1429990749,
      "id": 1196058973,
      "node_id": "PRRC_kwDOABII585HSmld",
      "diff_hunk": "@@ -332,5 +333,43 @@ def run_test(self):\n             wallet = node_v19.get_wallet_rpc(\"w1_v19\")\n             assert wallet.getaddressinfo(address_18075)[\"solvable\"]\n \n+        if self.options.descriptors:\n+            self.log.info(\"Test background upgrading of descriptor wallets to have hd key\")\n+\n+            def check_hd_keyupgrade(wallet_name, passphrase=None):\n+                # Copy to master\n+                node_wallet_dir = os.path.join(node_v23.datadir, \"regtest\", \"wallets\", wallet_name)\n+                node_master_wallet_dir = os.path.join(node_master_wallets_dir, wallet_name)\n+                shutil.copytree(node_wallet_dir, node_master_wallet_dir)\n+\n+                # Checks\n+                node_master.loadwallet(wallet_name)\n+                wallet = node_master.get_wallet_rpc(wallet_name)\n+                if passphrase is not None:\n+                    wallet.walletpassphrase(passphrase, 10)\n+                descs = wallet.listdescriptors(True)\n+                xpub_info = wallet.getxpub(True)\n+                for desc in descs[\"descriptors\"]:\n+                    assert xpub_info[\"xprv\"] in desc[\"desc\"]\n+                wallet.unloadwallet()\n+\n+                # Copy back to older node and make sure it can be loaded\n+                shutil.rmtree(node_wallet_dir)\n+                shutil.copytree(node_master_wallet_dir, node_wallet_dir)\n+                node_v23.loadwallet(wallet_name)\n+                node_v23.unloadwallet(wallet_name)\n+\n+                # Remove wallet from master for next node",
      "path": "test/functional/wallet_backwards_compatibility.py",
      "position": 38,
      "original_position": 38,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "in_reply_to_id": null,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: for the next ~~node~~test",
      "created_at": "2023-05-17T07:25:49Z",
      "updated_at": "2023-05-17T07:25:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1196058973",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1196058973"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 362,
      "original_line": 362,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218151088",
      "pull_request_review_id": 1462675329,
      "id": 1218151088,
      "node_id": "PRRC_kwDOABII585Im4Kw",
      "diff_hunk": "@@ -516,6 +516,121 @@ void CWallet::UpgradeDescriptorCache()\n     SetWalletFlag(WALLET_FLAG_LAST_HARDENED_XPUB_CACHED);\n }\n \n+/**\n+ * UpgradeToGlobalHDKey searches through the descriptors in a descriptor wallet and tries to find a CExtPubKey\n+ * which is likely to be the most recent one used to generate all of the automatically generated descriptors.\n+ * The automatically generated descriptors are guaranteed to be 2 p2pkh, 2 p2sh-segwit, and 2 p2wpkh. There may\n+ * be 2 p2tr descriptors, as well as imports. Those are ignored as they are not guaranteed to be present in all wallets.\n+ * Candidate CExtKeys are those that appear in the aforementioned descriptors as the only key. The best candidate is\n+ * selected as the one that was most recently used.\n+ *\n+ * The best candidate will be added to the wallet as the current active HD key. Any other candidates will be added as\n+ * HD keys that have been rotated out.\n+ *\n+ * WALLET_FLAG_GLOBAL_HD_KEY will be set in order to indicate that this upgrade has occurred.\n+ */\n+void CWallet::UpgradeToGlobalHDKey(WalletBatch& batch, const std::map<DescIDKeyIDPair, CKey>& desc_keys, const std::map<DescIDKeyIDPair, CryptedKeyPair>& desc_crypt_keys)\n+{\n+    if (!IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) ||\n+        IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) ||\n+        IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        return;\n+    }\n+\n+\n+    std::map<CExtPubKey, std::pair<std::map<OutputType, int>, uint64_t>> key_counts;\n+    std::map<OutputType, int> tmpl = {{OutputType::LEGACY, 0}, {OutputType::P2SH_SEGWIT, 0}, {OutputType::BECH32, 0}};\n+\n+    for (const auto& spkm : GetAllScriptPubKeyMans()) {\n+        const DescriptorScriptPubKeyMan* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+        assert(desc_spkm);\n+        LOCK(desc_spkm->cs_desc_man);\n+        WalletDescriptor w_desc = desc_spkm->GetWalletDescriptor();\n+\n+        // Automatically generated descriptors are ranged\n+        if (!w_desc.descriptor->IsRange()) {\n+            continue;\n+        }\n+\n+        // Audotmatically generated descriptors have exactly 1 xpub and no other keys",
      "path": "src/wallet/wallet.cpp",
      "position": 41,
      "original_position": 41,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "95d11f09c2c0d4ad66ba2e4ce2d15be4c002fb94",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "95d11f09c2c0d4ad66ba2e4ce2d15be4c002fb94 `// Automatically`",
      "created_at": "2023-06-05T14:24:25Z",
      "updated_at": "2023-06-05T15:06:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1218151088",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218151088"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 556,
      "original_line": 556,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218161082",
      "pull_request_review_id": 1462675329,
      "id": 1218161082,
      "node_id": "PRRC_kwDOABII585Im6m6",
      "diff_hunk": "@@ -516,6 +516,121 @@ void CWallet::UpgradeDescriptorCache()\n     SetWalletFlag(WALLET_FLAG_LAST_HARDENED_XPUB_CACHED);\n }\n \n+/**\n+ * UpgradeToGlobalHDKey searches through the descriptors in a descriptor wallet and tries to find a CExtPubKey\n+ * which is likely to be the most recent one used to generate all of the automatically generated descriptors.\n+ * The automatically generated descriptors are guaranteed to be 2 p2pkh, 2 p2sh-segwit, and 2 p2wpkh. There may\n+ * be 2 p2tr descriptors, as well as imports. Those are ignored as they are not guaranteed to be present in all wallets.\n+ * Candidate CExtKeys are those that appear in the aforementioned descriptors as the only key. The best candidate is\n+ * selected as the one that was most recently used.\n+ *\n+ * The best candidate will be added to the wallet as the current active HD key. Any other candidates will be added as\n+ * HD keys that have been rotated out.\n+ *\n+ * WALLET_FLAG_GLOBAL_HD_KEY will be set in order to indicate that this upgrade has occurred.\n+ */\n+void CWallet::UpgradeToGlobalHDKey(WalletBatch& batch, const std::map<DescIDKeyIDPair, CKey>& desc_keys, const std::map<DescIDKeyIDPair, CryptedKeyPair>& desc_crypt_keys)\n+{\n+    if (!IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) ||\n+        IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) ||\n+        IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        return;\n+    }\n+\n+\n+    std::map<CExtPubKey, std::pair<std::map<OutputType, int>, uint64_t>> key_counts;\n+    std::map<OutputType, int> tmpl = {{OutputType::LEGACY, 0}, {OutputType::P2SH_SEGWIT, 0}, {OutputType::BECH32, 0}};\n+\n+    for (const auto& spkm : GetAllScriptPubKeyMans()) {\n+        const DescriptorScriptPubKeyMan* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+        assert(desc_spkm);\n+        LOCK(desc_spkm->cs_desc_man);\n+        WalletDescriptor w_desc = desc_spkm->GetWalletDescriptor();\n+\n+        // Automatically generated descriptors are ranged\n+        if (!w_desc.descriptor->IsRange()) {\n+            continue;\n+        }\n+\n+        // Audotmatically generated descriptors have exactly 1 xpub and no other keys\n+        std::set<CPubKey> desc_pubkeys;\n+        std::set<CExtPubKey> desc_xpubs;\n+        w_desc.descriptor->GetPubKeys(desc_pubkeys, desc_xpubs);\n+        if (desc_xpubs.size() != 1 || desc_pubkeys.size() != 0) {\n+            continue;\n+        }\n+        const CExtPubKey& xpub = *desc_xpubs.begin();\n+\n+        if (key_counts.count(xpub) == 0) {\n+            key_counts.emplace(xpub, std::make_pair(tmpl, 0));\n+        }\n+\n+        // Automatically generated descriptors have an output type that is one of legacy, p2sh-segwit, or bech32\n+        std::optional<OutputType> output_type = w_desc.descriptor->GetOutputType();\n+        if (!output_type.has_value()) {\n+            continue;\n+        }\n+        if (tmpl.count(output_type.value()) == 0) {\n+            continue;\n+        }\n+        key_counts[xpub].first[output_type.value()]++;\n+\n+        if (w_desc.creation_time > key_counts[xpub].second) {\n+            key_counts[xpub].second = w_desc.creation_time;\n+        }\n+    }\n+\n+    // Find candidate xpubs\n+    // These are the ones that are used in 2 pkh(), 2 sh(wpkh()), and 2 wpkh() descriptors\n+    uint64_t best_time = 0;\n+    std::optional<CExtPubKey> best_xpub;\n+    std::map<CKeyID, CExtPubKey> xpubs;\n+    for (const auto& [xpub, info] : key_counts) {\n+        const auto& [dtypes, desc_time] = info;\n+        if (std::all_of(dtypes.begin(), dtypes.end(), [](const auto& p) { return p.second == 2;})) {\n+            xpubs.emplace(xpub.pubkey.GetID(), xpub);\n+            if (desc_time > best_time) {\n+                best_time = desc_time;\n+                best_xpub.emplace(xpub);\n+            }\n+        }\n+    }\n+\n+    // For all candidate xpubs, add corresponding private keys if available\n+    for (const auto& [id_pair, key] : desc_keys) {",
      "path": "src/wallet/wallet.cpp",
      "position": 86,
      "original_position": 86,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "95d11f09c2c0d4ad66ba2e4ce2d15be4c002fb94",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "95d11f09c2c0d4ad66ba2e4ce2d15be4c002fb94: why not loop over `xpubs`?",
      "created_at": "2023-06-05T14:31:40Z",
      "updated_at": "2023-06-05T15:06:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1218161082",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218161082"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 601,
      "original_line": 601,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218166104",
      "pull_request_review_id": 1462675329,
      "id": 1218166104,
      "node_id": "PRRC_kwDOABII585Im71Y",
      "diff_hunk": "@@ -516,6 +516,121 @@ void CWallet::UpgradeDescriptorCache()\n     SetWalletFlag(WALLET_FLAG_LAST_HARDENED_XPUB_CACHED);\n }\n \n+/**\n+ * UpgradeToGlobalHDKey searches through the descriptors in a descriptor wallet and tries to find a CExtPubKey\n+ * which is likely to be the most recent one used to generate all of the automatically generated descriptors.\n+ * The automatically generated descriptors are guaranteed to be 2 p2pkh, 2 p2sh-segwit, and 2 p2wpkh. There may\n+ * be 2 p2tr descriptors, as well as imports. Those are ignored as they are not guaranteed to be present in all wallets.\n+ * Candidate CExtKeys are those that appear in the aforementioned descriptors as the only key. The best candidate is\n+ * selected as the one that was most recently used.\n+ *\n+ * The best candidate will be added to the wallet as the current active HD key. Any other candidates will be added as\n+ * HD keys that have been rotated out.\n+ *\n+ * WALLET_FLAG_GLOBAL_HD_KEY will be set in order to indicate that this upgrade has occurred.\n+ */\n+void CWallet::UpgradeToGlobalHDKey(WalletBatch& batch, const std::map<DescIDKeyIDPair, CKey>& desc_keys, const std::map<DescIDKeyIDPair, CryptedKeyPair>& desc_crypt_keys)\n+{\n+    if (!IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) ||\n+        IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) ||\n+        IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)\n+        ) {\n+        return;\n+    }\n+\n+\n+    std::map<CExtPubKey, std::pair<std::map<OutputType, int>, uint64_t>> key_counts;\n+    std::map<OutputType, int> tmpl = {{OutputType::LEGACY, 0}, {OutputType::P2SH_SEGWIT, 0}, {OutputType::BECH32, 0}};\n+\n+    for (const auto& spkm : GetAllScriptPubKeyMans()) {\n+        const DescriptorScriptPubKeyMan* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+        assert(desc_spkm);\n+        LOCK(desc_spkm->cs_desc_man);\n+        WalletDescriptor w_desc = desc_spkm->GetWalletDescriptor();\n+\n+        // Automatically generated descriptors are ranged\n+        if (!w_desc.descriptor->IsRange()) {\n+            continue;\n+        }\n+\n+        // Audotmatically generated descriptors have exactly 1 xpub and no other keys\n+        std::set<CPubKey> desc_pubkeys;\n+        std::set<CExtPubKey> desc_xpubs;\n+        w_desc.descriptor->GetPubKeys(desc_pubkeys, desc_xpubs);\n+        if (desc_xpubs.size() != 1 || desc_pubkeys.size() != 0) {\n+            continue;\n+        }\n+        const CExtPubKey& xpub = *desc_xpubs.begin();\n+\n+        if (key_counts.count(xpub) == 0) {\n+            key_counts.emplace(xpub, std::make_pair(tmpl, 0));\n+        }\n+\n+        // Automatically generated descriptors have an output type that is one of legacy, p2sh-segwit, or bech32\n+        std::optional<OutputType> output_type = w_desc.descriptor->GetOutputType();\n+        if (!output_type.has_value()) {\n+            continue;\n+        }\n+        if (tmpl.count(output_type.value()) == 0) {\n+            continue;\n+        }\n+        key_counts[xpub].first[output_type.value()]++;\n+\n+        if (w_desc.creation_time > key_counts[xpub].second) {\n+            key_counts[xpub].second = w_desc.creation_time;\n+        }\n+    }\n+\n+    // Find candidate xpubs\n+    // These are the ones that are used in 2 pkh(), 2 sh(wpkh()), and 2 wpkh() descriptors\n+    uint64_t best_time = 0;\n+    std::optional<CExtPubKey> best_xpub;\n+    std::map<CKeyID, CExtPubKey> xpubs;\n+    for (const auto& [xpub, info] : key_counts) {\n+        const auto& [dtypes, desc_time] = info;\n+        if (std::all_of(dtypes.begin(), dtypes.end(), [](const auto& p) { return p.second == 2;})) {\n+            xpubs.emplace(xpub.pubkey.GetID(), xpub);\n+            if (desc_time > best_time) {\n+                best_time = desc_time;\n+                best_xpub.emplace(xpub);\n+            }\n+        }\n+    }\n+\n+    // For all candidate xpubs, add corresponding private keys if available\n+    for (const auto& [id_pair, key] : desc_keys) {\n+        const auto& [desc_id, keyid] = id_pair;\n+\n+        const auto& it = xpubs.find(keyid);\n+        if (it == xpubs.end()) {\n+            continue;\n+        }\n+\n+        CExtKey extkey(it->second, key);\n+        AddHDKey(extkey);\n+        xpubs.erase(it);\n+    }\n+    for (const auto& [id_pair, key_pair] : desc_crypt_keys) {\n+        const auto& [desc_id, keyid] = id_pair;\n+        const auto& [pubkey, ckey] = key_pair;\n+\n+        const auto& it = xpubs.find(keyid);\n+        if (it == xpubs.end()) {\n+            continue;\n+        }\n+\n+        LoadHDCryptedKey(it->second, ckey);\n+        batch.WriteHDCryptedKey(it->second, ckey);\n+        xpubs.erase(it);\n+    }\n+\n+    if (best_xpub) {\n+        SetActiveHDKey(*best_xpub);",
      "path": "src/wallet/wallet.cpp",
      "position": 113,
      "original_position": 113,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "95d11f09c2c0d4ad66ba2e4ce2d15be4c002fb94",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "95d11f09c2c0d4ad66ba2e4ce2d15be4c002fb94: can we emit a warning the in the `else` case?",
      "created_at": "2023-06-05T14:35:28Z",
      "updated_at": "2023-06-05T15:06:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1218166104",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218166104"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 628,
      "original_line": 628,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218168069",
      "pull_request_review_id": 1462675329,
      "id": 1218168069,
      "node_id": "PRRC_kwDOABII585Im8UF",
      "diff_hunk": "@@ -516,6 +516,121 @@ void CWallet::UpgradeDescriptorCache()\n     SetWalletFlag(WALLET_FLAG_LAST_HARDENED_XPUB_CACHED);\n }\n \n+/**\n+ * UpgradeToGlobalHDKey searches through the descriptors in a descriptor wallet and tries to find a CExtPubKey\n+ * which is likely to be the most recent one used to generate all of the automatically generated descriptors.\n+ * The automatically generated descriptors are guaranteed to be 2 p2pkh, 2 p2sh-segwit, and 2 p2wpkh. There may\n+ * be 2 p2tr descriptors, as well as imports. Those are ignored as they are not guaranteed to be present in all wallets.\n+ * Candidate CExtKeys are those that appear in the aforementioned descriptors as the only key. The best candidate is\n+ * selected as the one that was most recently used.\n+ *\n+ * The best candidate will be added to the wallet as the current active HD key. Any other candidates will be added as\n+ * HD keys that have been rotated out.\n+ *\n+ * WALLET_FLAG_GLOBAL_HD_KEY will be set in order to indicate that this upgrade has occurred.\n+ */\n+void CWallet::UpgradeToGlobalHDKey(WalletBatch& batch, const std::map<DescIDKeyIDPair, CKey>& desc_keys, const std::map<DescIDKeyIDPair, CryptedKeyPair>& desc_crypt_keys)\n+{\n+    if (!IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS) ||\n+        IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) ||\n+        IsWalletFlagSet(WALLET_FLAG_GLOBAL_HD_KEY)",
      "path": "src/wallet/wallet.cpp",
      "position": 21,
      "original_position": 21,
      "commit_id": "c79539fc20d902b5f9e098cc996c4e27c8e5b8c5",
      "original_commit_id": "95d11f09c2c0d4ad66ba2e4ce2d15be4c002fb94",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "95d11f09c2c0d4ad66ba2e4ce2d15be4c002fb94: it's better if the caller checks this flag. It makes it easier to implement a \"try again\" feature later for folks with complicated wallets where somehow the upgrade fails to find a best xpub. Can wait for followup though.",
      "created_at": "2023-06-05T14:36:43Z",
      "updated_at": "2023-06-05T15:06:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26728#discussion_r1218168069",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218168069"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 536,
      "original_line": 536,
      "side": "RIGHT"
    }
  ]
}