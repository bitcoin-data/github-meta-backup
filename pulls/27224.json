{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224",
    "id": 1266997888,
    "node_id": "PR_kwDOABII585LhNqA",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/27224",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/27224.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/27224.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27224",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27224/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/a5986e82dd2b8f923d60f9e31760ef62b9010105",
    "number": 27224,
    "state": "closed",
    "locked": false,
    "maintainer_can_modify": false,
    "title": "refactor: Remove CAddressBookData::destdata",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This is cleanup that doesn't change external behavior. Benefits of the cleanup are:\r\n\r\n- Removes awkward `StringMap` intermediate representation for wallet address metadata.\r\n- Simplifies `CWallet`, deals with used address and received request serialization in `walletdb.cpp` instead of higher level wallet code\r\n- Adds test coverage and documentation\r\n\r\nThis PR doesn't change externally observable behavior. Internally, the only change in behavior is that `EraseDestData` deletes rows directly from the database because they are no longer stored in memory. This is more direct and efficient because it uses a single lookup and scan instead of multiple lookups.\r\n\r\nMotivation for this cleanup is making changes like #18550, #18192, #13756 easier to reason about and less likely to result in unintended behavior and bugs\r\n\r\n---\r\n\r\nThis PR is a rebased copy of #18608. For some reason that PR is locked and couldn't be reopened or commented on.\r\n\r\nThis PR is an alternative to #27215 with differences described in https://github.com/bitcoin/bitcoin/pull/27215#pullrequestreview-1329028143\r\n",
    "labels": [
      {
        "id": 135961,
        "node_id": "MDU6TGFiZWwxMzU5NjE=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
        "name": "Refactoring",
        "color": "E6F6D6",
        "default": false
      }
    ],
    "created_at": "2023-03-07T21:51:45Z",
    "updated_at": "2023-05-01T17:17:42Z",
    "closed_at": "2023-05-01T12:17:51Z",
    "mergeable_state": "unknown",
    "merged_at": "2023-05-01T12:17:51Z",
    "merge_commit_sha": "5325a61167a6905dae60f670a0e6c5855e5d658c",
    "assignees": [],
    "requested_reviewers": [
      {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      }
    ],
    "requested_teams": [],
    "head": {
      "label": "ryanofsky:pr/nodest",
      "ref": "pr/nodest",
      "sha": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 69901633,
        "node_id": "MDEwOlJlcG9zaXRvcnk2OTkwMTYzMw==",
        "name": "bitcoin",
        "full_name": "ryanofsky/bitcoin",
        "owner": {
          "login": "ryanofsky",
          "id": 7133040,
          "node_id": "MDQ6VXNlcjcxMzMwNDA=",
          "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/ryanofsky",
          "html_url": "https://github.com/ryanofsky",
          "followers_url": "https://api.github.com/users/ryanofsky/followers",
          "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
          "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
          "repos_url": "https://api.github.com/users/ryanofsky/repos",
          "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/ryanofsky/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/ryanofsky/bitcoin",
        "archive_url": "https://api.github.com/repos/ryanofsky/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/ryanofsky/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/ryanofsky/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/ryanofsky/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/ryanofsky/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/ryanofsky/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/ryanofsky/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/ryanofsky/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/ryanofsky/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/ryanofsky/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/ryanofsky/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/ryanofsky/bitcoin/events",
        "forks_url": "https://api.github.com/repos/ryanofsky/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/ryanofsky/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/ryanofsky/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/ryanofsky/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/ryanofsky/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/ryanofsky/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/ryanofsky/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/ryanofsky/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/ryanofsky/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/ryanofsky/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/ryanofsky/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/ryanofsky/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/ryanofsky/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/ryanofsky/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/ryanofsky/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/ryanofsky/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:ryanofsky/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/ryanofsky/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/ryanofsky/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/ryanofsky/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/ryanofsky/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/ryanofsky/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/ryanofsky/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/ryanofsky/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/ryanofsky/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/ryanofsky/bitcoin/hooks",
        "svn_url": "https://github.com/ryanofsky/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 6,
        "stargazers_count": 8,
        "watchers_count": 8,
        "size": 229522,
        "default_branch": "master",
        "open_issues_count": 1,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-07T07:29:58Z",
        "created_at": "2016-10-03T19:05:43Z",
        "updated_at": "2023-05-05T12:10:19Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "7f4ab67e7be615b2425a85fb65872fc2327f58c3",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 34325,
        "stargazers_count": 69819,
        "watchers_count": 69819,
        "size": 233879,
        "default_branch": "master",
        "open_issues_count": 626,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-07T07:29:24Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-06-07T07:34:31Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 215,
    "deletions": 95,
    "changed_files": 11,
    "commits": 2,
    "review_comments": 37,
    "comments": 6
  },
  "events": [
    {
      "event": "commented",
      "id": 1458923346,
      "node_id": "IC_kwDOABII585W9WdS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1458923346",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-07T21:51:47Z",
      "updated_at": "2023-05-01T12:09:32Z",
      "author_association": "MEMBER",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [furszy](https://github.com/bitcoin/bitcoin/pull/27224#pullrequestreview-1384148699), [achow101](https://github.com/bitcoin/bitcoin/pull/27224#issuecomment-1529640566) |\n| Stale ACK | [josibake](https://github.com/bitcoin/bitcoin/pull/27224#pullrequestreview-1360512338) |\n\nIf your review is incorrectly listed, please react with 👎 to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#bitcoin-core/gui/723](https://github.com/bitcoin-core/gui/pull/723) (Add warnings for non-active addresses in receive tab and address book by pinheadmz)\n* [#27286](https://github.com/bitcoin/bitcoin/pull/27286) (wallet: Keep track of the wallet's own transaction outputs in memory by achow101)\n* [#26836](https://github.com/bitcoin/bitcoin/pull/26836) (wallet: finish addressbook encapsulation by furszy)\n* [#26644](https://github.com/bitcoin/bitcoin/pull/26644) (wallet: bugfix, 'wallet_load_ckey' unit test fails with bdb by furszy)\n* [#25991](https://github.com/bitcoin/bitcoin/pull/25991) (Wallet: Add foreign_outputs metadata to support CoinJoin transactions by luke-jr)\n* [#24914](https://github.com/bitcoin/bitcoin/pull/24914) (wallet: Load database records in a particular order by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#issuecomment-1458923346",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27224"
    },
    {
      "event": "labeled",
      "id": 8690810487,
      "node_id": "LE_lADOABII585gN7N0zwAAAAIGAz53",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8690810487",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-07T21:51:49Z",
      "label": {
        "name": "Refactoring",
        "color": "E6F6D6"
      }
    },
    {
      "event": "reviewed",
      "id": 1330392187,
      "node_id": "PRR_kwDOABII585PTCx7",
      "url": null,
      "actor": null,
      "commit_id": "2a44c4e0c7a20a1e1964ecb25fe148759fbb0e2f",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#pullrequestreview-1330392187",
      "submitted_at": "2023-03-08T10:47:12Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 8699995612,
      "node_id": "HRFPE_lADOABII585gN7N0zwAAAAIGj2Xc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8699995612",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-08T19:53:02Z"
    },
    {
      "event": "reviewed",
      "id": 1331334304,
      "node_id": "PRR_kwDOABII585PWoyg",
      "url": null,
      "actor": null,
      "commit_id": "6388b30274971f0488214d283f28bfc948995a1b",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Updated 2a44c4e0c7a20a1e1964ecb25fe148759fbb0e2f -> 6388b30274971f0488214d283f28bfc948995a1b ([`pr/nodest.15`](https://github.com/ryanofsky/bitcoin/commits/pr/nodest.15) -> [`pr/nodest.16`](https://github.com/ryanofsky/bitcoin/commits/pr/nodest.16), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/nodest.15..pr/nodest.16)) to fix clang-tidy `std::move` warning https://cirrus-ci.com/task/4799988845248512?logs=ci#L4742",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#pullrequestreview-1331334304",
      "submitted_at": "2023-03-08T20:23:55Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
    },
    {
      "event": "reviewed",
      "id": 1341984808,
      "node_id": "PRR_kwDOABII585P_RAo",
      "url": null,
      "actor": null,
      "commit_id": "6388b30274971f0488214d283f28bfc948995a1b",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#pullrequestreview-1341984808",
      "submitted_at": "2023-03-15T17:03:47Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 8797643712,
      "node_id": "HRFPE_lADOABII585gN7N0zwAAAAIMYWPA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8797643712",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-20T17:55:47Z"
    },
    {
      "event": "reviewed",
      "id": 1349037350,
      "node_id": "PRR_kwDOABII585QaK0m",
      "url": null,
      "actor": null,
      "commit_id": "6388b30274971f0488214d283f28bfc948995a1b",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Updated 6388b30274971f0488214d283f28bfc948995a1b -> fe367f2e4e5fb95546fa26491d43346e0bc11adb ([`pr/nodest.16`](https://github.com/ryanofsky/bitcoin/commits/pr/nodest.16) -> [`pr/nodest.17`](https://github.com/ryanofsky/bitcoin/commits/pr/nodest.17), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/nodest.16..pr/nodest.17)) adding suggested erase method, also adding more comments and removing some unnecessary changes to existing code after the rebase.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#pullrequestreview-1349037350",
      "submitted_at": "2023-03-20T17:56:01Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
    },
    {
      "event": "commented",
      "id": 1481673419,
      "node_id": "IC_kwDOABII585YUIrL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1481673419",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-23T18:09:22Z",
      "updated_at": "2023-03-23T18:09:22Z",
      "author_association": "MEMBER",
      "body": "ACK fe367f2e4e5fb95546fa26491d43346e0bc11adb",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#issuecomment-1481673419",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27224"
    },
    {
      "event": "review_requested",
      "id": 8837260239,
      "node_id": "RRE_lADOABII585gN7N0zwAAAAIOvePP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8837260239",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-24T10:46:15Z",
      "requested_reviewer": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "reviewed",
      "id": 1358939669,
      "node_id": "PRR_kwDOABII585Q_8YV",
      "url": null,
      "actor": null,
      "commit_id": "fe367f2e4e5fb95546fa26491d43346e0bc11adb",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Concept ACK\r\n\r\nI read through the motivating examples you listed and I think this change makes a lot of sense. Also great to see more test coverage!\r\n\r\nStill reading and testing to make sure I fully understand the change but left a small suggestion in the meanwhile",
      "user": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#pullrequestreview-1358939669",
      "submitted_at": "2023-03-27T11:50:33Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 8857471330,
      "node_id": "HRFPE_lADOABII585gN7N0zwAAAAIP8kli",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8857471330",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-27T19:01:25Z"
    },
    {
      "event": "reviewed",
      "id": 1359680913,
      "node_id": "PRR_kwDOABII585RCxWR",
      "url": null,
      "actor": null,
      "commit_id": "fe367f2e4e5fb95546fa26491d43346e0bc11adb",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Updated fe367f2e4e5fb95546fa26491d43346e0bc11adb -> 0ad6a533b93162ec808de092cbe5edc31a27a390 ([`pr/nodest.17`](https://github.com/ryanofsky/bitcoin/commits/pr/nodest.17) -> [`pr/nodest.18`](https://github.com/ryanofsky/bitcoin/commits/pr/nodest.18), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/nodest.17..pr/nodest.18)) using more brace initialization as suggested\r\n",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#pullrequestreview-1359680913",
      "submitted_at": "2023-03-27T19:02:29Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
    },
    {
      "event": "reviewed",
      "id": 1360512338,
      "node_id": "PRR_kwDOABII585RF8VS",
      "url": null,
      "actor": null,
      "commit_id": "0ad6a533b93162ec808de092cbe5edc31a27a390",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK https://github.com/bitcoin/bitcoin/pull/27224/commits/0ad6a533b93162ec808de092cbe5edc31a27a390\r\n\r\nI left a suggestion about using  `DataStream&&` instead of `Span<std::byte>`, but not blocking",
      "user": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#pullrequestreview-1360512338",
      "submitted_at": "2023-03-28T08:43:39Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
    },
    {
      "event": "review_requested",
      "id": 8862468392,
      "node_id": "RRE_lADOABII585gN7N0zwAAAAIQPoko",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8862468392",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-28T08:43:44Z",
      "requested_reviewer": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "reviewed",
      "id": 1360931572,
      "node_id": "PRR_kwDOABII585RHir0",
      "url": null,
      "actor": null,
      "commit_id": "0ad6a533b93162ec808de092cbe5edc31a27a390",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Code review 0ad6a533, left few points.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#pullrequestreview-1360931572",
      "submitted_at": "2023-03-28T13:13:16Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
    },
    {
      "event": "commented",
      "id": 1486957262,
      "node_id": "IC_kwDOABII585YoSrO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1486957262",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-28T14:03:39Z",
      "updated_at": "2023-03-28T14:03:39Z",
      "author_association": "MEMBER",
      "body": "@furszy, thanks for the thorough review. I will start implementing your suggestions, but do you think you could help me with your comments about encapsulation like https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1150541159?\r\n\r\nThe comments are just a little vague from my perspective so it'd be great if you could provide specific code suggestions and I will apply or implement them. For background, I've been a little detached from the address encapsulation attempt, and personally like m_address_book.find(dest) / m_addressbook[dest] lookups and for loops a little better than calling FindAddress/FindOrInsertAddress/ForAddresses wrapper functions. But I don't have a strong opinion and am happy to use wrappers, I just think you would be better at suggesting with names / parameters since you have been designing the API and know more about the goals.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#issuecomment-1486957262",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27224"
    },
    {
      "event": "mentioned",
      "id": 8865870100,
      "node_id": "MEE_lADOABII585gN7N0zwAAAAIQcnEU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8865870100",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-28T14:03:39Z"
    },
    {
      "event": "subscribed",
      "id": 8865870136,
      "node_id": "SE_lADOABII585gN7N0zwAAAAIQcnE4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8865870136",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-28T14:03:39Z"
    },
    {
      "event": "commented",
      "id": 1487314169,
      "node_id": "IC_kwDOABII585Yppz5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1487314169",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-28T17:17:46Z",
      "updated_at": "2023-03-28T19:46:45Z",
      "author_association": "MEMBER",
      "body": "> @furszy, thanks for the thorough review. I will start implementing your suggestions, but do you think you could help me with your comments about encapsulation like [#27224 (comment)](https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1150541159)?\r\n> \r\n> For background, I've been a little detached from the address encapsulation attempt, and personally like m_address_book.find(dest) / m_addressbook[dest] lookups and for loops a little better than calling FindAddress/FindOrInsertAddress/ForAddresses wrapper functions. But I don't have a strong opinion and am happy to use wrappers, I just think you would be better at suggesting with names / parameters since you have been designing the API and know more about the goals.\r\n\r\nYeah ok.\r\n\r\nThe main purpose of address book encapsulation is prevent people from accidentally modifying the ‘purpose’ field in an RPC command or the GUI, or from creating a new entry by misusing the map's [] operator. Which it could lead, in the worst-case scenario, to a \"send\" address being relabeled as a \"receive\" address, resulting in a user sending funds to an address they do not own while thinking they do.\r\n\r\nI know that it didn’t happen so far but.. it’s a big project and I think that we shouldn’t assume that everyone touching the GUI and/or the RPC commands are aware of the internal address book usage (e.g. #25979). Simpler to just forget about this possible issue by letting people access entries through an interface.\r\n\r\nAlso, the encapsulation will let us use another mutex for the address book, so commands like `setlabel`, `getaddressbylabel` etc will be able to run `cs_wallet` free (not such a big feature but it adds value).\r\n\r\n> The comments are just a little vague from my perspective so it'd be great if you could provide specific code suggestions and I will apply or implement them. \r\n\r\nSadly, the cleanest implementation would come after #24914, when we load the wallet in-order, first read the address book entry, then “dest data” etc.\r\nWe are currently forced to append new address book entries while we loop over  the “used” and “requests” db records because the entry could not exist yet.. which is ugly and adds more boilerplate code.\r\n\r\nAbout the API naming, we still have a mixture of names there.\r\nBut we could continue moving toward the usage of `LoadXXX` prefix for methods that are only relevant for the loading process. We are already using this term for the spkms and other members. Thoughts?.\r\n\r\nThen, in the future, to not allow calling this `LoadXXX` methods from RPC related code, same as we do in the GUI, would be nice to start using the wallet interface there instead of directly access the `CWallet` object (not sure if there are plans for this already).\r\n\r\nBut anyway, future stuff.\r\nHere is the small commit for this https://github.com/furszy/bitcoin-core/commit/2195b1e3288f1019f81fc76c584519bd1d158f59. Check if you like it. It’s not a big deal.\r\n\r\n--------------\r\n\r\nAnother idea:\r\nOnce we make the address book member private, we could allow direct access only from `LoadWallet` by making a new \"loading\" class that has `CWallet` as friend. This would remove the `LoadXXX` encapsulation boilerplate if that is what makes you doubt about it.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#issuecomment-1487314169",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27224"
    },
    {
      "event": "mentioned",
      "id": 8867929114,
      "node_id": "MEE_lADOABII585gN7N0zwAAAAIQkdwa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8867929114",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-28T17:17:49Z"
    },
    {
      "event": "subscribed",
      "id": 8867929147,
      "node_id": "SE_lADOABII585gN7N0zwAAAAIQkdw7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8867929147",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-28T17:17:49Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 8949322918,
      "node_id": "HRFPE_lADOABII585gN7N0zwAAAAIVa9Sm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8949322918",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-06T20:06:41Z"
    },
    {
      "event": "reviewed",
      "id": 1373581514,
      "node_id": "PRR_kwDOABII585R3zDK",
      "url": null,
      "actor": null,
      "commit_id": "d34323544d7283bf46bb154a90b8feca443b103e",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Updated 0ad6a533b93162ec808de092cbe5edc31a27a390 -> d34323544d7283bf46bb154a90b8feca443b103e ([`pr/nodest.18`](https://github.com/ryanofsky/bitcoin/commits/pr/nodest.18) -> [`pr/nodest.19`](https://github.com/ryanofsky/bitcoin/commits/pr/nodest.19), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/nodest.18..pr/nodest.19)) applying most of the suggested changes. Thanks for the reviews!",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#pullrequestreview-1373581514",
      "submitted_at": "2023-04-06T20:07:42Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDU5MzhhZDBiZGIwMTM5NTM4NjFjN2NkMTVhOTVmMDA5OThhMDZmNDQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5938ad0bdb013953861c7cd15a95f00998a06f44",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5938ad0bdb013953861c7cd15a95f00998a06f44",
      "tree": {
        "sha": "5c760ab363b8c3ee305f1762766af2007cd65b00",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5c760ab363b8c3ee305f1762766af2007cd65b00"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cae0608ad4b195652e0cfcc905e19b50197d43ab",
          "sha": "cae0608ad4b195652e0cfcc905e19b50197d43ab",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/cae0608ad4b195652e0cfcc905e19b50197d43ab"
        }
      ],
      "message": "wallet: Add DatabaseBatch::ErasePrefix method\n\nThis new function is not used yet this commit, but next commit adds usages and\ntest coverage for both BDB and sqlite.",
      "committer": {
        "name": "Ryan Ofsky",
        "email": "ryan@ofsky.org",
        "date": "2023-04-12T09:30:43Z"
      },
      "author": {
        "name": "Ryan Ofsky",
        "email": "ryan@ofsky.org",
        "date": "2020-04-12T17:40:43Z"
      },
      "sha": "5938ad0bdb013953861c7cd15a95f00998a06f44"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGE1OTg2ZTgyZGQyYjhmOTIzZDYwZjllMzE3NjBlZjYyYjkwMTAxMDU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "tree": {
        "sha": "e8d7dba6b4c7f022542e3d2ddbea9c0619961f07",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e8d7dba6b4c7f022542e3d2ddbea9c0619961f07"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5938ad0bdb013953861c7cd15a95f00998a06f44",
          "sha": "5938ad0bdb013953861c7cd15a95f00998a06f44",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5938ad0bdb013953861c7cd15a95f00998a06f44"
        }
      ],
      "message": "refactor: Remove CAddressBookData::destdata\n\nThis is cleanup that doesn't change external behavior.\n\n- Removes awkward `StringMap` intermediate representation\n- Simplifies CWallet code, deals with used address and received request\n  serialization in walletdb.cpp\n- Adds test coverage and documentation\n- Reduces memory usage\n\nThis PR doesn't change externally observable behavior. Internally, only change\nin behavior is that EraseDestData deletes directly from database because the\n`StringMap` is gone. This is more direct and efficient because it uses a single\nbtree lookup and scan instead of multiple lookups\n\nMotivation for this cleanup is making changes like #18550, #18192, #13756\neasier to reason about and less likely to result in unintended behavior and\nbugs\n\nCo-authored-by: furszy <matiasfurszyfer@protonmail.com>",
      "committer": {
        "name": "Ryan Ofsky",
        "email": "ryan@ofsky.org",
        "date": "2023-04-12T09:30:43Z"
      },
      "author": {
        "name": "Ryan Ofsky",
        "email": "ryan@ofsky.org",
        "date": "2020-04-12T17:40:43Z"
      },
      "sha": "a5986e82dd2b8f923d60f9e31760ef62b9010105"
    },
    {
      "event": "labeled",
      "id": 8984508294,
      "node_id": "LE_lADOABII585gN7N0zwAAAAIXhLeG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8984508294",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-12T11:26:54Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 8987203082,
      "node_id": "HRFPE_lADOABII585gN7N0zwAAAAIXrdYK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8987203082",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-12T15:42:20Z"
    },
    {
      "event": "commented",
      "id": 1505513192,
      "node_id": "IC_kwDOABII585ZvE7o",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1505513192",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-12T15:48:25Z",
      "updated_at": "2023-04-12T15:48:25Z",
      "author_association": "MEMBER",
      "body": "Rebased d34323544d7283bf46bb154a90b8feca443b103e -> a5986e82dd2b8f923d60f9e31760ef62b9010105 ([`pr/nodest.19`](https://github.com/ryanofsky/bitcoin/commits/pr/nodest.19) -> [`pr/nodest.20`](https://github.com/ryanofsky/bitcoin/commits/pr/nodest.20), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/nodest.19-rebase..pr/nodest.20)) due to conflict with #27217",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#issuecomment-1505513192",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27224"
    },
    {
      "event": "unlabeled",
      "id": 8988471191,
      "node_id": "UNLE_lADOABII585gN7N0zwAAAAIXwS-X",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8988471191",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-12T18:01:28Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1384148699,
      "node_id": "PRR_kwDOABII585SgG7b",
      "url": null,
      "actor": null,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Code ACK a5986e82",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#pullrequestreview-1384148699",
      "submitted_at": "2023-04-13T20:22:43Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
    },
    {
      "event": "review_requested",
      "id": 9000904022,
      "node_id": "RRE_lADOABII585gN7N0zwAAAAIYfuVW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9000904022",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-13T20:22:48Z",
      "requested_reviewer": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "commented",
      "id": 1529640566,
      "node_id": "IC_kwDOABII585bLHZ2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1529640566",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-01T12:09:29Z",
      "updated_at": "2023-05-01T12:09:29Z",
      "author_association": "MEMBER",
      "body": "ACK a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#issuecomment-1529640566",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27224"
    },
    {
      "event": "review_request_removed",
      "id": 9136198099,
      "node_id": "RRRE_lADOABII585gN7N0zwAAAAIgj1HT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9136198099",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-01T12:09:33Z",
      "requested_reviewer": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "merged",
      "id": 9136239424,
      "node_id": "ME_lADOABII585gN7N0zwAAAAIgj_NA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9136239424",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "5325a61167a6905dae60f670a0e6c5855e5d658c",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5325a61167a6905dae60f670a0e6c5855e5d658c",
      "created_at": "2023-05-01T12:17:51Z"
    },
    {
      "event": "closed",
      "id": 9136239456,
      "node_id": "CE_lADOABII585gN7N0zwAAAAIgj_Ng",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9136239456",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-01T12:17:51Z"
    },
    {
      "event": "reviewed",
      "id": 1407726864,
      "node_id": "PRR_kwDOABII585T6DUQ",
      "url": null,
      "actor": null,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#pullrequestreview-1407726864",
      "submitted_at": "2023-05-01T15:29:22Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
    },
    {
      "event": "referenced",
      "id": 9137985959,
      "node_id": "REFE_lADOABII585gN7N0zwAAAAIgqpmn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9137985959",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "b24d751a2385351697c5dc87f8f6a628f109897e",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/b24d751a2385351697c5dc87f8f6a628f109897e",
      "created_at": "2023-05-01T16:51:11Z"
    },
    {
      "event": "referenced",
      "id": 9138134181,
      "node_id": "REFE_lADOABII585gN7N0zwAAAAIgrNyl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9138134181",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "959e5cd1533334af9ff24dc52e81ca7c095ef5af",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/959e5cd1533334af9ff24dc52e81ca7c095ef5af",
      "created_at": "2023-05-01T17:11:37Z"
    },
    {
      "event": "referenced",
      "id": 9138169100,
      "node_id": "REFE_lADOABII585gN7N0zwAAAAIgrWUM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9138169100",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "2877c80afd40313760dbe11a86e89e87dbc7f2b8",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/2877c80afd40313760dbe11a86e89e87dbc7f2b8",
      "created_at": "2023-05-01T17:17:04Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1129250725",
      "pull_request_review_id": 1330392187,
      "id": 1129250725,
      "node_id": "PRRC_kwDOABII585DTv-l",
      "diff_hunk": "@@ -609,7 +609,12 @@ ReadKeyValue(CWallet* pwallet, DataStream& ssKey, CDataStream& ssValue,\n             ssKey >> strAddress;\n             ssKey >> strKey;\n             ssValue >> strValue;\n-            pwallet->LoadDestData(DecodeDestination(strAddress), strKey, strValue);\n+            CAddressBookData& data = pwallet->m_address_book[DecodeDestination(strAddress)];\n+            if (strKey.compare(\"used\") == 0) {\n+                data.SetUsed(true);\n+            } else if (strKey.compare(0, 2, \"rr\") == 0) {\n+                data.SetReceiveRequest(strKey.substr(2), std::move(strValue));",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 9,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "2a44c4e0c7a20a1e1964ecb25fe148759fbb0e2f",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```\r\n\r\nsrc/wallet/walletdb.cpp:616:58: error: passing result of std::move() as a const reference argument; no move will actually happen [performance-move-const-arg,-warnings-as-errors]\r\n                data.SetReceiveRequest(strKey.substr(2), std::move(strValue));",
      "created_at": "2023-03-08T10:47:12Z",
      "updated_at": "2023-03-08T10:47:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1129250725",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1129250725"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 616,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1129950744",
      "pull_request_review_id": 1331334304,
      "id": 1129950744,
      "node_id": "PRRC_kwDOABII585DWa4Y",
      "diff_hunk": "@@ -609,7 +609,12 @@ ReadKeyValue(CWallet* pwallet, DataStream& ssKey, CDataStream& ssValue,\n             ssKey >> strAddress;\n             ssKey >> strKey;\n             ssValue >> strValue;\n-            pwallet->LoadDestData(DecodeDestination(strAddress), strKey, strValue);\n+            CAddressBookData& data = pwallet->m_address_book[DecodeDestination(strAddress)];\n+            if (strKey.compare(\"used\") == 0) {\n+                data.SetUsed(true);\n+            } else if (strKey.compare(0, 2, \"rr\") == 0) {\n+                data.SetReceiveRequest(strKey.substr(2), std::move(strValue));",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 9,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "2a44c4e0c7a20a1e1964ecb25fe148759fbb0e2f",
      "in_reply_to_id": 1129250725,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1129250725\r\n\r\nThanks, fixed now",
      "created_at": "2023-03-08T19:49:38Z",
      "updated_at": "2023-03-08T20:23:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1129950744",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1129950744"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 616,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137453458",
      "pull_request_review_id": 1341984808,
      "id": 1137453458,
      "node_id": "PRRC_kwDOABII585DzCmS",
      "diff_hunk": "@@ -205,21 +205,29 @@ class CAddressBookData\n {\n private:\n     bool m_change{true};\n+    bool m_used{false};\n     std::string m_label;\n+    std::map<std::string, std::string> m_receive_requests;\n public:\n     std::string purpose;\n \n     CAddressBookData() : purpose(\"unknown\") {}\n \n-    typedef std::map<std::string, std::string> StringMap;\n-    StringMap destdata;\n-\n     bool IsChange() const { return m_change; }\n+    bool IsUsed() const { return m_used; }\n+    void SetUsed(bool used) { m_used = used;}\n     const std::string& GetLabel() const { return m_label; }\n     void SetLabel(const std::string& label) {\n         m_change = false;\n         m_label = label;\n     }\n+    const std::map<std::string, std::string>& GetReceiveRequests() const { return m_receive_requests; }\n+    bool SetReceiveRequest(std::string id, std::string value)\n+    {\n+        if (value.empty()) return m_receive_requests.erase(id);",
      "path": "src/wallet/wallet.h",
      "position": null,
      "original_position": 26,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "6388b30274971f0488214d283f28bfc948995a1b",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I strongly dislike using the empty string to indicate deletion. I think it would be better to have a separate `RemoveReceiveRequest`.",
      "created_at": "2023-03-15T17:00:23Z",
      "updated_at": "2023-03-15T17:03:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1137453458",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137453458"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 227,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137458690",
      "pull_request_review_id": 1341984808,
      "id": 1137458690,
      "node_id": "PRRC_kwDOABII585DzD4C",
      "diff_hunk": "@@ -205,21 +205,29 @@ class CAddressBookData\n {\n private:\n     bool m_change{true};\n+    bool m_used{false};\n     std::string m_label;\n+    std::map<std::string, std::string> m_receive_requests;",
      "path": "src/wallet/wallet.h",
      "position": null,
      "original_position": 6,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "6388b30274971f0488214d283f28bfc948995a1b",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I'm not convinced that this needs to be a map. Receive requests are only created by the GUI, and the GUI only creates them for a newly retrieved address, so it shouldn't be possible to have multiple receive requests.\r\n\r\nAdditionally, receive requests are identified by an int which is being (un)stringified. This could just be an int to avoid that constant conversion in the GUI.",
      "created_at": "2023-03-15T17:03:42Z",
      "updated_at": "2023-03-15T17:03:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1137458690",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137458690"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 210,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137647274",
      "pull_request_review_id": 1342243492,
      "id": 1137647274,
      "node_id": "PRRC_kwDOABII585Dzx6q",
      "diff_hunk": "@@ -205,21 +205,29 @@ class CAddressBookData\n {\n private:\n     bool m_change{true};\n+    bool m_used{false};\n     std::string m_label;\n+    std::map<std::string, std::string> m_receive_requests;\n public:\n     std::string purpose;\n \n     CAddressBookData() : purpose(\"unknown\") {}\n \n-    typedef std::map<std::string, std::string> StringMap;\n-    StringMap destdata;\n-\n     bool IsChange() const { return m_change; }\n+    bool IsUsed() const { return m_used; }\n+    void SetUsed(bool used) { m_used = used;}\n     const std::string& GetLabel() const { return m_label; }\n     void SetLabel(const std::string& label) {\n         m_change = false;\n         m_label = label;\n     }\n+    const std::map<std::string, std::string>& GetReceiveRequests() const { return m_receive_requests; }\n+    bool SetReceiveRequest(std::string id, std::string value)\n+    {\n+        if (value.empty()) return m_receive_requests.erase(id);",
      "path": "src/wallet/wallet.h",
      "position": null,
      "original_position": 26,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "6388b30274971f0488214d283f28bfc948995a1b",
      "in_reply_to_id": 1137453458,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1137647274\r\n\r\n> I strongly dislike using the empty string to indicate deletion. I think it would be better to have a separate `RemoveReceiveRequest`.\r\n\r\nYou are right. This is shitty and I will add a separate method to avoid continuing this pattern.",
      "created_at": "2023-03-15T19:23:29Z",
      "updated_at": "2023-03-15T19:23:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1137647274",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137647274"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 227,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137679417",
      "pull_request_review_id": 1342293430,
      "id": 1137679417,
      "node_id": "PRRC_kwDOABII585Dz5w5",
      "diff_hunk": "@@ -205,21 +205,29 @@ class CAddressBookData\n {\n private:\n     bool m_change{true};\n+    bool m_used{false};\n     std::string m_label;\n+    std::map<std::string, std::string> m_receive_requests;",
      "path": "src/wallet/wallet.h",
      "position": null,
      "original_position": 6,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "6388b30274971f0488214d283f28bfc948995a1b",
      "in_reply_to_id": 1137458690,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1137458690\r\n\r\n> I'm not convinced that this needs to be a map. Receive requests are only created by the GUI, and the GUI only creates them for a newly retrieved address, so it shouldn't be possible to have multiple receive requests.\r\n> \r\n> Additionally, receive requests are identified by an int which is being (un)stringified. This could just be an int to avoid that constant conversion in the GUI.\r\n\r\nYou could definitely be right about these things, but I need to look into GUI code more to have an opinion. This PR avoids changing any GUI code, and keeps the behavior of `interfaces::Wallet` methods the same as before from the perspective of the GUI.\r\n\r\nIf the definitions or behavior of `interfaces::Wallet` methods should change as you say, I think it would make sense to implement these changes as a separate PR, because making those changes here would not really simplify much (would basically replace `string` with `int` and `find()` with `has_value()`), and would require understanding GUI code to review, unlike the current changes.",
      "created_at": "2023-03-15T19:35:22Z",
      "updated_at": "2023-03-15T19:35:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1137679417",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137679417"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 210,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142438454",
      "pull_request_review_id": 1349037350,
      "id": 1142438454,
      "node_id": "PRRC_kwDOABII585EGDo2",
      "diff_hunk": "@@ -205,21 +205,29 @@ class CAddressBookData\n {\n private:\n     bool m_change{true};\n+    bool m_used{false};\n     std::string m_label;\n+    std::map<std::string, std::string> m_receive_requests;",
      "path": "src/wallet/wallet.h",
      "position": null,
      "original_position": 6,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "6388b30274971f0488214d283f28bfc948995a1b",
      "in_reply_to_id": 1137458690,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: [#27224 (comment)](https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1137458690)\r\n\r\nInstead of extending the PR to modify GUI code, I've kept changes here internal to the wallet and added a note in `setAddressReceiveRequest` about the wallet/gui interface and say how it could be improved in the future.",
      "created_at": "2023-03-20T17:02:16Z",
      "updated_at": "2023-03-20T17:56:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1142438454",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142438454"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 210,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142496680",
      "pull_request_review_id": 1349037350,
      "id": 1142496680,
      "node_id": "PRRC_kwDOABII585EGR2o",
      "diff_hunk": "@@ -205,21 +205,29 @@ class CAddressBookData\n {\n private:\n     bool m_change{true};\n+    bool m_used{false};\n     std::string m_label;\n+    std::map<std::string, std::string> m_receive_requests;\n public:\n     std::string purpose;\n \n     CAddressBookData() : purpose(\"unknown\") {}\n \n-    typedef std::map<std::string, std::string> StringMap;\n-    StringMap destdata;\n-\n     bool IsChange() const { return m_change; }\n+    bool IsUsed() const { return m_used; }\n+    void SetUsed(bool used) { m_used = used;}\n     const std::string& GetLabel() const { return m_label; }\n     void SetLabel(const std::string& label) {\n         m_change = false;\n         m_label = label;\n     }\n+    const std::map<std::string, std::string>& GetReceiveRequests() const { return m_receive_requests; }\n+    bool SetReceiveRequest(std::string id, std::string value)\n+    {\n+        if (value.empty()) return m_receive_requests.erase(id);",
      "path": "src/wallet/wallet.h",
      "position": null,
      "original_position": 26,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "6388b30274971f0488214d283f28bfc948995a1b",
      "in_reply_to_id": 1137453458,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> re: [#27224 (comment)](https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1137647274)\r\n\r\nThis is done now",
      "created_at": "2023-03-20T17:52:56Z",
      "updated_at": "2023-03-20T17:56:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1142496680",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1142496680"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 227,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1149193825",
      "pull_request_review_id": 1358939669,
      "id": 1149193825,
      "node_id": "PRRC_kwDOABII585Ef05h",
      "diff_hunk": "@@ -808,6 +810,22 @@ bool BerkeleyBatch::HasKey(DataStream&& key)\n     return ret == 0;\n }\n \n+bool BerkeleyBatch::ErasePrefix(Span<std::byte> prefix)\n+{\n+    if (!TxnBegin()) return false;\n+    auto cursor = std::make_unique<BerkeleyCursor>(m_database, this);\n+    Dbt prefix_key(prefix.data(), prefix.size()), prefix_value;",
      "path": "src/wallet/bdb.cpp",
      "position": null,
      "original_position": 25,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "fe367f2e4e5fb95546fa26491d43346e0bc11adb",
      "in_reply_to_id": null,
      "user": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This line was really confusing for me at first. Perhaps something like this could make it more clear?\r\n\r\n```suggestion\r\n    Dbt prefix_key(prefix.data(), prefix.size()), prefix_value{};\r\n```\r\n",
      "created_at": "2023-03-27T11:48:07Z",
      "updated_at": "2023-03-27T11:50:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1149193825",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1149193825"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 817,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1149661885",
      "pull_request_review_id": 1359680913,
      "id": 1149661885,
      "node_id": "PRRC_kwDOABII585EhnK9",
      "diff_hunk": "@@ -808,6 +810,22 @@ bool BerkeleyBatch::HasKey(DataStream&& key)\n     return ret == 0;\n }\n \n+bool BerkeleyBatch::ErasePrefix(Span<std::byte> prefix)\n+{\n+    if (!TxnBegin()) return false;\n+    auto cursor = std::make_unique<BerkeleyCursor>(m_database, this);\n+    Dbt prefix_key(prefix.data(), prefix.size()), prefix_value;",
      "path": "src/wallet/bdb.cpp",
      "position": null,
      "original_position": 25,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "fe367f2e4e5fb95546fa26491d43346e0bc11adb",
      "in_reply_to_id": 1149193825,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1149193825\r\n\r\nThanks, switched to brace initialization like you suggested in many places now. Should be clearer and safer\r\n\r\n",
      "created_at": "2023-03-27T18:43:41Z",
      "updated_at": "2023-03-27T19:02:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1149661885",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1149661885"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 817,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1150232826",
      "pull_request_review_id": 1360512338,
      "id": 1150232826,
      "node_id": "PRRC_kwDOABII585Ejyj6",
      "diff_hunk": "@@ -205,6 +206,7 @@ class BerkeleyBatch : public DatabaseBatch\n     bool WriteKey(DataStream&& key, DataStream&& value, bool overwrite = true) override;\n     bool EraseKey(DataStream&& key) override;\n     bool HasKey(DataStream&& key) override;\n+    bool ErasePrefix(Span<std::byte> prefix) override;",
      "path": "src/wallet/bdb.h",
      "position": null,
      "original_position": 17,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "0ad6a533b93162ec808de092cbe5edc31a27a390",
      "in_reply_to_id": null,
      "user": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Perhaps there's some nuance that I'm missing, but it seems strange to have this be `Span<std::byte>` when the rest of the methods take `DataStream&&`. I changed the `ErasePrefix` method to instead take `DataStream&&` as an argument and was able to compile and pass the unit and functional tests. Seems like it would be preferable to match the other methods unless you have a reason to prefer `Span<std::byte>`?",
      "created_at": "2023-03-28T08:37:40Z",
      "updated_at": "2023-03-28T08:44:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1150232826",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1150232826"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 209,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1150238393",
      "pull_request_review_id": 1360512338,
      "id": 1150238393,
      "node_id": "PRRC_kwDOABII585Ejz65",
      "diff_hunk": "@@ -1082,16 +1087,28 @@ void MaybeCompactWalletDB(WalletContext& context)\n     fOneThread = false;\n }\n \n-bool WalletBatch::WriteDestData(const std::string &address, const std::string &key, const std::string &value)\n+bool WalletBatch::WriteAddressPreviouslySpent(const CTxDestination& dest, bool previously_spent)\n+{\n+    auto key{std::make_pair(DBKeys::DESTDATA, std::make_pair(EncodeDestination(dest), std::string(\"used\")))};\n+    return previously_spent ? WriteIC(key, std::string(\"1\")) : EraseIC(key);\n+}\n+\n+bool WalletBatch::WriteAddressReceiveRequest(const CTxDestination& dest, const std::string& id, const std::string& receive_request)\n {\n-    return WriteIC(std::make_pair(DBKeys::DESTDATA, std::make_pair(address, key)), value);\n+    return WriteIC(std::make_pair(DBKeys::DESTDATA, std::make_pair(EncodeDestination(dest), \"rr\" + id)), receive_request);\n }\n \n-bool WalletBatch::EraseDestData(const std::string &address, const std::string &key)\n+bool WalletBatch::EraseAddressReceiveRequest(const CTxDestination& dest, const std::string& id)\n {\n-    return EraseIC(std::make_pair(DBKeys::DESTDATA, std::make_pair(address, key)));\n+    return EraseIC(std::make_pair(DBKeys::DESTDATA, std::make_pair(EncodeDestination(dest), \"rr\" + id)));\n }\n \n+bool WalletBatch::EraseAddressData(const CTxDestination& dest)\n+{\n+    DataStream prefix;\n+    prefix << DBKeys::DESTDATA << EncodeDestination(dest);\n+    return m_batch->ErasePrefix(prefix);",
      "path": "src/wallet/walletdb.cpp",
      "position": 50,
      "original_position": 42,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "0ad6a533b93162ec808de092cbe5edc31a27a390",
      "in_reply_to_id": null,
      "user": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "as part of changing `ErasePrefix` to accept a `DataStream&&`, I also changed this line:\r\n\r\n```suggestion\r\n    return m_batch->ErasePrefix(DataStream(prefix));\r\n```\r\n\r\nto make this an `rvalue`. there is likely a cleaner way to do this, if you end up going with `DataStream`",
      "created_at": "2023-03-28T08:41:52Z",
      "updated_at": "2023-03-28T13:17:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1150238393",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1150238393"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1124,
      "original_line": 1124,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1150513279",
      "pull_request_review_id": 1360931572,
      "id": 1150513279,
      "node_id": "PRRC_kwDOABII585Ek3B_",
      "diff_hunk": "@@ -2821,65 +2817,46 @@ unsigned int CWallet::ComputeTimeSmart(const CWalletTx& wtx, bool rescanning_old\n \n bool CWallet::SetAddressUsed(WalletBatch& batch, const CTxDestination& dest, bool used)\n {\n-    const std::string key{\"used\"};\n     if (std::get_if<CNoDestination>(&dest))\n         return false;\n \n     if (!used) {\n-        if (auto* data = util::FindKey(m_address_book, dest)) data->destdata.erase(key);\n-        return batch.EraseDestData(EncodeDestination(dest), key);\n+        if (auto* data{util::FindKey(m_address_book, dest)}) data->previously_spent = false;\n+        return batch.WriteAddressPreviouslySpent(dest, false);\n     }\n \n-    const std::string value{\"1\"};\n-    m_address_book[dest].destdata.insert(std::make_pair(key, value));\n-    return batch.WriteDestData(EncodeDestination(dest), key, value);\n-}\n-\n-void CWallet::LoadDestData(const CTxDestination &dest, const std::string &key, const std::string &value)\n-{\n-    m_address_book[dest].destdata.insert(std::make_pair(key, value));\n+    m_address_book[dest].previously_spent = true;\n+    return batch.WriteAddressPreviouslySpent(dest, true);\n }\n \n bool CWallet::IsAddressUsed(const CTxDestination& dest) const\n {\n-    const std::string key{\"used\"};\n-    std::map<CTxDestination, CAddressBookData>::const_iterator i = m_address_book.find(dest);\n-    if(i != m_address_book.end())\n-    {\n-        CAddressBookData::StringMap::const_iterator j = i->second.destdata.find(key);\n-        if(j != i->second.destdata.end())\n-        {\n-            return true;\n-        }\n-    }\n+    if (auto* data{util::FindKey(m_address_book, dest)}) return data->previously_spent;\n     return false;\n }\n \n std::vector<std::string> CWallet::GetAddressReceiveRequests() const\n {\n-    const std::string prefix{\"rr\"};\n     std::vector<std::string> values;\n-    for (const auto& address : m_address_book) {\n-        for (const auto& data : address.second.destdata) {\n-            if (!data.first.compare(0, prefix.size(), prefix)) {\n-                values.emplace_back(data.second);\n-            }\n+    for (const auto& dest : m_address_book) {\n+        for (const auto& request : dest.second.receive_requests) {\n+            values.emplace_back(request.second);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 67,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "0ad6a533b93162ec808de092cbe5edc31a27a390",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: could use structured bindings.\r\n```c++\r\nfor (const auto& [dest, entry] : m_address_book) {\r\n     for (const auto& [id, request] : entry.receive_requests) {\r\n         values.emplace_back(request);\r\n     }\r\n}\r\n```",
      "created_at": "2023-03-28T12:19:18Z",
      "updated_at": "2023-03-28T13:13:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1150513279",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1150513279"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": 2841,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2843,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1150523650",
      "pull_request_review_id": 1360931572,
      "id": 1150523650,
      "node_id": "PRRC_kwDOABII585Ek5kC",
      "diff_hunk": "@@ -2439,11 +2439,7 @@ bool CWallet::DelAddressBook(const CTxDestination& address)\n             return false;\n         }\n         // Delete destdata tuples associated with address",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 3,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "0ad6a533b93162ec808de092cbe5edc31a27a390",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "No longer the case.\r\nSame for the comment that is above this one.",
      "created_at": "2023-03-28T12:23:29Z",
      "updated_at": "2023-03-28T13:13:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1150523650",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1150523650"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2441,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1150535358",
      "pull_request_review_id": 1360931572,
      "id": 1150535358,
      "node_id": "PRRC_kwDOABII585Ek8a-",
      "diff_hunk": "@@ -2821,65 +2817,46 @@ unsigned int CWallet::ComputeTimeSmart(const CWalletTx& wtx, bool rescanning_old\n \n bool CWallet::SetAddressUsed(WalletBatch& batch, const CTxDestination& dest, bool used)",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 15,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "0ad6a533b93162ec808de092cbe5edc31a27a390",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Not really for this PR, but.. the `used` arg is never false.\r\n\r\n`SetAddressUsed` is only called from `SetSpentKeyState` which is only called from `AddToWallet`, which provides `used=true`.\r\n\r\nWhich.. means that the address is not reverted to a \"not used\" state if the tx gets abandoned/discarded.\r\n\r\nCould also work on it on a follow-up. Probably after #26836 so changes don't end up conflicting that much.",
      "created_at": "2023-03-28T12:32:56Z",
      "updated_at": "2023-04-06T20:13:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1150535358",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1150535358"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2818,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1150538791",
      "pull_request_review_id": 1360931572,
      "id": 1150538791,
      "node_id": "PRRC_kwDOABII585Ek9Qn",
      "diff_hunk": "@@ -2821,65 +2817,46 @@ unsigned int CWallet::ComputeTimeSmart(const CWalletTx& wtx, bool rescanning_old\n \n bool CWallet::SetAddressUsed(WalletBatch& batch, const CTxDestination& dest, bool used)\n {\n-    const std::string key{\"used\"};\n     if (std::get_if<CNoDestination>(&dest))\n         return false;\n \n     if (!used) {\n-        if (auto* data = util::FindKey(m_address_book, dest)) data->destdata.erase(key);\n-        return batch.EraseDestData(EncodeDestination(dest), key);\n+        if (auto* data{util::FindKey(m_address_book, dest)}) data->previously_spent = false;\n+        return batch.WriteAddressPreviouslySpent(dest, false);\n     }\n \n-    const std::string value{\"1\"};\n-    m_address_book[dest].destdata.insert(std::make_pair(key, value));\n-    return batch.WriteDestData(EncodeDestination(dest), key, value);\n-}\n-\n-void CWallet::LoadDestData(const CTxDestination &dest, const std::string &key, const std::string &value)\n-{\n-    m_address_book[dest].destdata.insert(std::make_pair(key, value));",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 35,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "0ad6a533b93162ec808de092cbe5edc31a27a390",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This method was removed from the cpp but not from the header.",
      "created_at": "2023-03-28T12:35:30Z",
      "updated_at": "2023-03-28T13:13:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1150538791",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1150538791"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": 2838,
      "start_side": "LEFT",
      "line": null,
      "original_line": 2845,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1150541159",
      "pull_request_review_id": 1360931572,
      "id": 1150541159,
      "node_id": "PRRC_kwDOABII585Ek91n",
      "diff_hunk": "@@ -609,7 +609,12 @@ ReadKeyValue(CWallet* pwallet, DataStream& ssKey, CDataStream& ssValue,\n             ssKey >> strAddress;\n             ssKey >> strKey;\n             ssValue >> strValue;\n-            pwallet->LoadDestData(DecodeDestination(strAddress), strKey, strValue);\n+            CAddressBookData& data{pwallet->m_address_book[DecodeDestination(strAddress)]};\n+            if (strKey.compare(\"used\") == 0) {\n+                data.previously_spent = true;\n+            } else if (strKey.compare(0, 2, \"rr\") == 0) {\n+                data.receive_requests[strKey.substr(2)] = std::move(strValue);",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 9,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "0ad6a533b93162ec808de092cbe5edc31a27a390",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Would be good to keep the encapsulation and don't access `m_address_book` from outside of the wallet class (otherwise we are reverting #25337 and, future, #26836). ",
      "created_at": "2023-03-28T12:37:28Z",
      "updated_at": "2023-03-28T13:13:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1150541159",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1150541159"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": 612,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 616,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1150567795",
      "pull_request_review_id": 1360931572,
      "id": 1150567795,
      "node_id": "PRRC_kwDOABII585ElEVz",
      "diff_hunk": "@@ -656,12 +656,14 @@ void BerkeleyDatabase::ReloadDbEnv()\n     env->ReloadDbEnv();\n }\n \n-BerkeleyCursor::BerkeleyCursor(BerkeleyDatabase& database)\n+BerkeleyCursor::BerkeleyCursor(BerkeleyDatabase& database, BerkeleyBatch* batch)\n {\n     if (!database.m_db.get()) {\n         throw std::runtime_error(STR_INTERNAL_BUG(\"BerkeleyDatabase does not exist\"));\n     }\n-    int ret = database.m_db->cursor(nullptr, &m_cursor, 0);\n+    // Transaction argument to cursor is only needed when using the cursor to\n+    // write to the database. Read-only cursors do not need a txn pointer.\n+    int ret = database.m_db->cursor(batch ? batch->txn() : nullptr, &m_cursor, 0);",
      "path": "src/wallet/bdb.cpp",
      "position": 13,
      "original_position": 13,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "0ad6a533b93162ec808de092cbe5edc31a27a390",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "this also fixes abdef47f206dec114300b2d852f5c297b03179e3 (from #26644)",
      "created_at": "2023-03-28T12:55:35Z",
      "updated_at": "2023-03-28T13:13:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1150567795",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1150567795"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": 673,
      "original_start_line": 664,
      "start_side": "RIGHT",
      "line": 675,
      "original_line": 675,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1150572914",
      "pull_request_review_id": 1360931572,
      "id": 1150572914,
      "node_id": "PRRC_kwDOABII585ElFly",
      "diff_hunk": "@@ -427,19 +427,63 @@ BOOST_AUTO_TEST_CASE(ComputeTimeSmart)\n     BOOST_CHECK_EQUAL(AddTx(*m_node.chainman, m_wallet, 5, 50, 600), 300);\n }\n \n-BOOST_AUTO_TEST_CASE(LoadReceiveRequests)\n+static const DatabaseFormat DATABASE_FORMATS[] = {\n+#ifdef USE_SQLITE\n+    DatabaseFormat::SQLITE,\n+#endif\n+#ifdef USE_BDB\n+    DatabaseFormat::BERKELEY,\n+#endif\n+};\n+\n+void TestLoadWallet(const std::string& name, DatabaseFormat format, std::function<void(std::shared_ptr<CWallet>)> f)\n {\n-    CTxDestination dest = PKHash();\n-    LOCK(m_wallet.cs_wallet);\n-    WalletBatch batch{m_wallet.GetDatabase()};\n-    m_wallet.SetAddressUsed(batch, dest, true);\n-    m_wallet.SetAddressReceiveRequest(batch, dest, \"0\", \"val_rr0\");\n-    m_wallet.SetAddressReceiveRequest(batch, dest, \"1\", \"val_rr1\");\n-\n-    auto values = m_wallet.GetAddressReceiveRequests();\n-    BOOST_CHECK_EQUAL(values.size(), 2U);\n-    BOOST_CHECK_EQUAL(values[0], \"val_rr0\");\n-    BOOST_CHECK_EQUAL(values[1], \"val_rr1\");\n+    node::NodeContext node;\n+    auto chain{interfaces::MakeChain(node)};\n+    DatabaseOptions options;\n+    options.require_format = format;\n+    DatabaseStatus status;\n+    bilingual_str error;\n+    std::vector<bilingual_str> warnings;\n+    auto database{MakeWalletDatabase(name, options, status, error)};\n+    auto wallet{std::make_shared<CWallet>(chain.get(), \"\", std::move(database))};\n+    wallet->LoadWallet();",
      "path": "src/wallet/test/wallet_tests.cpp",
      "position": null,
      "original_position": 36,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "0ad6a533b93162ec808de092cbe5edc31a27a390",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Could\r\n```c++\r\nBOOST_CHECK_EQUAL(wallet->LoadWallet(), DBErrors::::LOAD_OK);\r\n```\r\n",
      "created_at": "2023-03-28T12:59:21Z",
      "updated_at": "2023-03-28T13:13:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1150572914",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1150572914"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 450,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1150579720",
      "pull_request_review_id": 1360931572,
      "id": 1150579720,
      "node_id": "PRRC_kwDOABII585ElHQI",
      "diff_hunk": "@@ -427,19 +427,63 @@ BOOST_AUTO_TEST_CASE(ComputeTimeSmart)\n     BOOST_CHECK_EQUAL(AddTx(*m_node.chainman, m_wallet, 5, 50, 600), 300);\n }\n \n-BOOST_AUTO_TEST_CASE(LoadReceiveRequests)\n+static const DatabaseFormat DATABASE_FORMATS[] = {\n+#ifdef USE_SQLITE\n+    DatabaseFormat::SQLITE,\n+#endif\n+#ifdef USE_BDB\n+    DatabaseFormat::BERKELEY,\n+#endif\n+};\n+\n+void TestLoadWallet(const std::string& name, DatabaseFormat format, std::function<void(std::shared_ptr<CWallet>)> f)\n {\n-    CTxDestination dest = PKHash();\n-    LOCK(m_wallet.cs_wallet);\n-    WalletBatch batch{m_wallet.GetDatabase()};\n-    m_wallet.SetAddressUsed(batch, dest, true);\n-    m_wallet.SetAddressReceiveRequest(batch, dest, \"0\", \"val_rr0\");\n-    m_wallet.SetAddressReceiveRequest(batch, dest, \"1\", \"val_rr1\");\n-\n-    auto values = m_wallet.GetAddressReceiveRequests();\n-    BOOST_CHECK_EQUAL(values.size(), 2U);\n-    BOOST_CHECK_EQUAL(values[0], \"val_rr0\");\n-    BOOST_CHECK_EQUAL(values[1], \"val_rr1\");\n+    node::NodeContext node;\n+    auto chain{interfaces::MakeChain(node)};\n+    DatabaseOptions options;\n+    options.require_format = format;\n+    DatabaseStatus status;\n+    bilingual_str error;\n+    std::vector<bilingual_str> warnings;\n+    auto database{MakeWalletDatabase(name, options, status, error)};\n+    auto wallet{std::make_shared<CWallet>(chain.get(), \"\", std::move(database))};\n+    wallet->LoadWallet();\n+    WITH_LOCK(wallet->cs_wallet, f(wallet));\n+}\n+\n+BOOST_FIXTURE_TEST_CASE(LoadReceiveRequests, TestingSetup)\n+{\n+    for (DatabaseFormat format : DATABASE_FORMATS) {\n+        const std::string name{strprintf(\"receive-requests-%i\", format)};\n+        TestLoadWallet(name, format, [](std::shared_ptr<CWallet> wallet) EXCLUSIVE_LOCKS_REQUIRED(wallet->cs_wallet) {\n+            BOOST_CHECK(!wallet->m_address_book[PKHash()].previously_spent);",
      "path": "src/wallet/test/wallet_tests.cpp",
      "position": null,
      "original_position": 45,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "0ad6a533b93162ec808de092cbe5edc31a27a390",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Same as above, would be good to not access `m_address_book` directly from outside of the wallet class.\r\nThe map [] operator usage in a random place of the sources could easily screw things up.\r\n\r\nCould change it to\r\n```c++\r\nBOOST_CHECK(!wallet->IsAddressUsed(PKHash()));\r\n```",
      "created_at": "2023-03-28T13:04:35Z",
      "updated_at": "2023-03-28T13:14:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1150579720",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1150579720"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 459,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1150583313",
      "pull_request_review_id": 1360931572,
      "id": 1150583313,
      "node_id": "PRRC_kwDOABII585ElIIR",
      "diff_hunk": "@@ -427,19 +427,63 @@ BOOST_AUTO_TEST_CASE(ComputeTimeSmart)\n     BOOST_CHECK_EQUAL(AddTx(*m_node.chainman, m_wallet, 5, 50, 600), 300);\n }\n \n-BOOST_AUTO_TEST_CASE(LoadReceiveRequests)\n+static const DatabaseFormat DATABASE_FORMATS[] = {\n+#ifdef USE_SQLITE\n+    DatabaseFormat::SQLITE,\n+#endif\n+#ifdef USE_BDB\n+    DatabaseFormat::BERKELEY,\n+#endif\n+};\n+\n+void TestLoadWallet(const std::string& name, DatabaseFormat format, std::function<void(std::shared_ptr<CWallet>)> f)\n {\n-    CTxDestination dest = PKHash();\n-    LOCK(m_wallet.cs_wallet);\n-    WalletBatch batch{m_wallet.GetDatabase()};\n-    m_wallet.SetAddressUsed(batch, dest, true);\n-    m_wallet.SetAddressReceiveRequest(batch, dest, \"0\", \"val_rr0\");\n-    m_wallet.SetAddressReceiveRequest(batch, dest, \"1\", \"val_rr1\");\n-\n-    auto values = m_wallet.GetAddressReceiveRequests();\n-    BOOST_CHECK_EQUAL(values.size(), 2U);\n-    BOOST_CHECK_EQUAL(values[0], \"val_rr0\");\n-    BOOST_CHECK_EQUAL(values[1], \"val_rr1\");\n+    node::NodeContext node;\n+    auto chain{interfaces::MakeChain(node)};\n+    DatabaseOptions options;\n+    options.require_format = format;\n+    DatabaseStatus status;\n+    bilingual_str error;\n+    std::vector<bilingual_str> warnings;\n+    auto database{MakeWalletDatabase(name, options, status, error)};\n+    auto wallet{std::make_shared<CWallet>(chain.get(), \"\", std::move(database))};\n+    wallet->LoadWallet();\n+    WITH_LOCK(wallet->cs_wallet, f(wallet));\n+}\n+\n+BOOST_FIXTURE_TEST_CASE(LoadReceiveRequests, TestingSetup)\n+{\n+    for (DatabaseFormat format : DATABASE_FORMATS) {\n+        const std::string name{strprintf(\"receive-requests-%i\", format)};\n+        TestLoadWallet(name, format, [](std::shared_ptr<CWallet> wallet) EXCLUSIVE_LOCKS_REQUIRED(wallet->cs_wallet) {\n+            BOOST_CHECK(!wallet->m_address_book[PKHash()].previously_spent);\n+            WalletBatch batch{wallet->GetDatabase()};\n+            BOOST_CHECK(batch.WriteAddressPreviouslySpent(PKHash(), true));\n+            BOOST_CHECK(batch.WriteAddressPreviouslySpent(ScriptHash(), true));\n+            BOOST_CHECK(wallet->SetAddressReceiveRequest(batch, PKHash(), \"0\", \"val_rr00\"));\n+            BOOST_CHECK(wallet->EraseAddressReceiveRequest(batch, PKHash(), \"0\"));\n+            BOOST_CHECK(wallet->SetAddressReceiveRequest(batch, PKHash(), \"1\", \"val_rr10\"));\n+            BOOST_CHECK(wallet->SetAddressReceiveRequest(batch, PKHash(), \"1\", \"val_rr11\"));\n+            BOOST_CHECK(wallet->SetAddressReceiveRequest(batch, ScriptHash(), \"2\", \"val_rr20\"));\n+        });\n+        TestLoadWallet(name, format, [](std::shared_ptr<CWallet> wallet) EXCLUSIVE_LOCKS_REQUIRED(wallet->cs_wallet) {\n+            BOOST_CHECK(wallet->m_address_book[PKHash()].previously_spent);\n+            BOOST_CHECK(wallet->m_address_book[ScriptHash()].previously_spent);",
      "path": "src/wallet/test/wallet_tests.cpp",
      "position": null,
      "original_position": 57,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "0ad6a533b93162ec808de092cbe5edc31a27a390",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```c++\r\nBOOST_CHECK(wallet->IsAddressUsed(PKHash()));\r\nBOOST_CHECK(wallet->IsAddressUsed(ScriptHash()));\r\n```",
      "created_at": "2023-03-28T13:07:18Z",
      "updated_at": "2023-03-28T13:13:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1150583313",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1150583313"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": 470,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 471,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1150586523",
      "pull_request_review_id": 1360931572,
      "id": 1150586523,
      "node_id": "PRRC_kwDOABII585ElI6b",
      "diff_hunk": "@@ -427,19 +427,63 @@ BOOST_AUTO_TEST_CASE(ComputeTimeSmart)\n     BOOST_CHECK_EQUAL(AddTx(*m_node.chainman, m_wallet, 5, 50, 600), 300);\n }\n \n-BOOST_AUTO_TEST_CASE(LoadReceiveRequests)\n+static const DatabaseFormat DATABASE_FORMATS[] = {\n+#ifdef USE_SQLITE\n+    DatabaseFormat::SQLITE,\n+#endif\n+#ifdef USE_BDB\n+    DatabaseFormat::BERKELEY,\n+#endif\n+};\n+\n+void TestLoadWallet(const std::string& name, DatabaseFormat format, std::function<void(std::shared_ptr<CWallet>)> f)\n {\n-    CTxDestination dest = PKHash();\n-    LOCK(m_wallet.cs_wallet);\n-    WalletBatch batch{m_wallet.GetDatabase()};\n-    m_wallet.SetAddressUsed(batch, dest, true);\n-    m_wallet.SetAddressReceiveRequest(batch, dest, \"0\", \"val_rr0\");\n-    m_wallet.SetAddressReceiveRequest(batch, dest, \"1\", \"val_rr1\");\n-\n-    auto values = m_wallet.GetAddressReceiveRequests();\n-    BOOST_CHECK_EQUAL(values.size(), 2U);\n-    BOOST_CHECK_EQUAL(values[0], \"val_rr0\");\n-    BOOST_CHECK_EQUAL(values[1], \"val_rr1\");\n+    node::NodeContext node;\n+    auto chain{interfaces::MakeChain(node)};\n+    DatabaseOptions options;\n+    options.require_format = format;\n+    DatabaseStatus status;\n+    bilingual_str error;\n+    std::vector<bilingual_str> warnings;\n+    auto database{MakeWalletDatabase(name, options, status, error)};\n+    auto wallet{std::make_shared<CWallet>(chain.get(), \"\", std::move(database))};\n+    wallet->LoadWallet();\n+    WITH_LOCK(wallet->cs_wallet, f(wallet));\n+}\n+\n+BOOST_FIXTURE_TEST_CASE(LoadReceiveRequests, TestingSetup)\n+{\n+    for (DatabaseFormat format : DATABASE_FORMATS) {\n+        const std::string name{strprintf(\"receive-requests-%i\", format)};\n+        TestLoadWallet(name, format, [](std::shared_ptr<CWallet> wallet) EXCLUSIVE_LOCKS_REQUIRED(wallet->cs_wallet) {\n+            BOOST_CHECK(!wallet->m_address_book[PKHash()].previously_spent);\n+            WalletBatch batch{wallet->GetDatabase()};\n+            BOOST_CHECK(batch.WriteAddressPreviouslySpent(PKHash(), true));\n+            BOOST_CHECK(batch.WriteAddressPreviouslySpent(ScriptHash(), true));\n+            BOOST_CHECK(wallet->SetAddressReceiveRequest(batch, PKHash(), \"0\", \"val_rr00\"));\n+            BOOST_CHECK(wallet->EraseAddressReceiveRequest(batch, PKHash(), \"0\"));\n+            BOOST_CHECK(wallet->SetAddressReceiveRequest(batch, PKHash(), \"1\", \"val_rr10\"));\n+            BOOST_CHECK(wallet->SetAddressReceiveRequest(batch, PKHash(), \"1\", \"val_rr11\"));\n+            BOOST_CHECK(wallet->SetAddressReceiveRequest(batch, ScriptHash(), \"2\", \"val_rr20\"));\n+        });\n+        TestLoadWallet(name, format, [](std::shared_ptr<CWallet> wallet) EXCLUSIVE_LOCKS_REQUIRED(wallet->cs_wallet) {\n+            BOOST_CHECK(wallet->m_address_book[PKHash()].previously_spent);\n+            BOOST_CHECK(wallet->m_address_book[ScriptHash()].previously_spent);\n+            auto requests = wallet->GetAddressReceiveRequests();\n+            auto erequests = {\"val_rr11\", \"val_rr20\"};\n+            BOOST_CHECK_EQUAL_COLLECTIONS(requests.begin(), requests.end(), std::begin(erequests), std::end(erequests));\n+            WalletBatch batch{wallet->GetDatabase()};\n+            BOOST_CHECK(batch.WriteAddressPreviouslySpent(PKHash(), false));\n+            BOOST_CHECK(batch.EraseAddressData(ScriptHash()));\n+        });\n+        TestLoadWallet(name, format, [](std::shared_ptr<CWallet> wallet) EXCLUSIVE_LOCKS_REQUIRED(wallet->cs_wallet) {\n+            BOOST_CHECK(!wallet->m_address_book[PKHash()].previously_spent);\n+            BOOST_CHECK(!wallet->m_address_book[ScriptHash()].previously_spent);",
      "path": "src/wallet/test/wallet_tests.cpp",
      "position": null,
      "original_position": 67,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "0ad6a533b93162ec808de092cbe5edc31a27a390",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```c++\r\nBOOST_CHECK(!wallet->IsAddressUsed(PKHash()));\r\nBOOST_CHECK(!wallet->IsAddressUsed(ScriptHash()));\r\n```",
      "created_at": "2023-03-28T13:09:39Z",
      "updated_at": "2023-03-28T13:13:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1150586523",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1150586523"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": 480,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 481,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1158949529",
      "pull_request_review_id": 1373581514,
      "id": 1158949529,
      "node_id": "PRRC_kwDOABII585FFCqZ",
      "diff_hunk": "@@ -205,6 +206,7 @@ class BerkeleyBatch : public DatabaseBatch\n     bool WriteKey(DataStream&& key, DataStream&& value, bool overwrite = true) override;\n     bool EraseKey(DataStream&& key) override;\n     bool HasKey(DataStream&& key) override;\n+    bool ErasePrefix(Span<std::byte> prefix) override;",
      "path": "src/wallet/bdb.h",
      "position": null,
      "original_position": 17,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "0ad6a533b93162ec808de092cbe5edc31a27a390",
      "in_reply_to_id": 1150232826,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/27224/files#r1150232826\r\n\r\n> you have a reason to prefer `Span<std::byte>`?\r\n\r\nWell it should actually take a span of const bytes, so I fixed this to add const.\r\n\r\nPassing a span makes more sense than passing a datastream because the function just needs a read-only array of bytes, it doesn't need a read/write vector or a stream object or anything more complicated.\r\n\r\nThe other functions are using CDataStream just because they are called by older code which might be counting on them to call memory_cleanse, and would require extra work to convert to spans, though it was tried previously in #19320",
      "created_at": "2023-04-05T19:53:18Z",
      "updated_at": "2023-04-06T20:07:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1158949529",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1158949529"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 209,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1159265608",
      "pull_request_review_id": 1373581514,
      "id": 1159265608,
      "node_id": "PRRC_kwDOABII585FGP1I",
      "diff_hunk": "@@ -427,19 +427,63 @@ BOOST_AUTO_TEST_CASE(ComputeTimeSmart)\n     BOOST_CHECK_EQUAL(AddTx(*m_node.chainman, m_wallet, 5, 50, 600), 300);\n }\n \n-BOOST_AUTO_TEST_CASE(LoadReceiveRequests)\n+static const DatabaseFormat DATABASE_FORMATS[] = {\n+#ifdef USE_SQLITE\n+    DatabaseFormat::SQLITE,\n+#endif\n+#ifdef USE_BDB\n+    DatabaseFormat::BERKELEY,\n+#endif\n+};\n+\n+void TestLoadWallet(const std::string& name, DatabaseFormat format, std::function<void(std::shared_ptr<CWallet>)> f)\n {\n-    CTxDestination dest = PKHash();\n-    LOCK(m_wallet.cs_wallet);\n-    WalletBatch batch{m_wallet.GetDatabase()};\n-    m_wallet.SetAddressUsed(batch, dest, true);\n-    m_wallet.SetAddressReceiveRequest(batch, dest, \"0\", \"val_rr0\");\n-    m_wallet.SetAddressReceiveRequest(batch, dest, \"1\", \"val_rr1\");\n-\n-    auto values = m_wallet.GetAddressReceiveRequests();\n-    BOOST_CHECK_EQUAL(values.size(), 2U);\n-    BOOST_CHECK_EQUAL(values[0], \"val_rr0\");\n-    BOOST_CHECK_EQUAL(values[1], \"val_rr1\");\n+    node::NodeContext node;\n+    auto chain{interfaces::MakeChain(node)};\n+    DatabaseOptions options;\n+    options.require_format = format;\n+    DatabaseStatus status;\n+    bilingual_str error;\n+    std::vector<bilingual_str> warnings;\n+    auto database{MakeWalletDatabase(name, options, status, error)};\n+    auto wallet{std::make_shared<CWallet>(chain.get(), \"\", std::move(database))};\n+    wallet->LoadWallet();",
      "path": "src/wallet/test/wallet_tests.cpp",
      "position": null,
      "original_position": 36,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "0ad6a533b93162ec808de092cbe5edc31a27a390",
      "in_reply_to_id": 1150572914,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1150572914\r\n\r\n> ```c++\r\n> BOOST_CHECK_EQUAL(wallet->LoadWallet(), DBErrors::::LOAD_OK);\r\n> ```\r\n\r\nThanks, added this check",
      "created_at": "2023-04-06T04:18:06Z",
      "updated_at": "2023-04-06T20:07:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1159265608",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1159265608"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 450,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160133066",
      "pull_request_review_id": 1373581514,
      "id": 1160133066,
      "node_id": "PRRC_kwDOABII585FJjnK",
      "diff_hunk": "@@ -2821,65 +2817,46 @@ unsigned int CWallet::ComputeTimeSmart(const CWalletTx& wtx, bool rescanning_old\n \n bool CWallet::SetAddressUsed(WalletBatch& batch, const CTxDestination& dest, bool used)\n {\n-    const std::string key{\"used\"};\n     if (std::get_if<CNoDestination>(&dest))\n         return false;\n \n     if (!used) {\n-        if (auto* data = util::FindKey(m_address_book, dest)) data->destdata.erase(key);\n-        return batch.EraseDestData(EncodeDestination(dest), key);\n+        if (auto* data{util::FindKey(m_address_book, dest)}) data->previously_spent = false;\n+        return batch.WriteAddressPreviouslySpent(dest, false);\n     }\n \n-    const std::string value{\"1\"};\n-    m_address_book[dest].destdata.insert(std::make_pair(key, value));\n-    return batch.WriteDestData(EncodeDestination(dest), key, value);\n-}\n-\n-void CWallet::LoadDestData(const CTxDestination &dest, const std::string &key, const std::string &value)\n-{\n-    m_address_book[dest].destdata.insert(std::make_pair(key, value));\n+    m_address_book[dest].previously_spent = true;\n+    return batch.WriteAddressPreviouslySpent(dest, true);\n }\n \n bool CWallet::IsAddressUsed(const CTxDestination& dest) const\n {\n-    const std::string key{\"used\"};\n-    std::map<CTxDestination, CAddressBookData>::const_iterator i = m_address_book.find(dest);\n-    if(i != m_address_book.end())\n-    {\n-        CAddressBookData::StringMap::const_iterator j = i->second.destdata.find(key);\n-        if(j != i->second.destdata.end())\n-        {\n-            return true;\n-        }\n-    }\n+    if (auto* data{util::FindKey(m_address_book, dest)}) return data->previously_spent;\n     return false;\n }\n \n std::vector<std::string> CWallet::GetAddressReceiveRequests() const\n {\n-    const std::string prefix{\"rr\"};\n     std::vector<std::string> values;\n-    for (const auto& address : m_address_book) {\n-        for (const auto& data : address.second.destdata) {\n-            if (!data.first.compare(0, prefix.size(), prefix)) {\n-                values.emplace_back(data.second);\n-            }\n+    for (const auto& dest : m_address_book) {\n+        for (const auto& request : dest.second.receive_requests) {\n+            values.emplace_back(request.second);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 67,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "0ad6a533b93162ec808de092cbe5edc31a27a390",
      "in_reply_to_id": 1150513279,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1150513279\r\n\r\n> nit: could use structured bindings.\r\n\r\nThanks, applied suggestion",
      "created_at": "2023-04-06T18:35:00Z",
      "updated_at": "2023-04-06T20:07:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1160133066",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160133066"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": 2841,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2843,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160135250",
      "pull_request_review_id": 1373581514,
      "id": 1160135250,
      "node_id": "PRRC_kwDOABII585FJkJS",
      "diff_hunk": "@@ -609,7 +609,12 @@ ReadKeyValue(CWallet* pwallet, DataStream& ssKey, CDataStream& ssValue,\n             ssKey >> strAddress;\n             ssKey >> strKey;\n             ssValue >> strValue;\n-            pwallet->LoadDestData(DecodeDestination(strAddress), strKey, strValue);\n+            CAddressBookData& data{pwallet->m_address_book[DecodeDestination(strAddress)]};\n+            if (strKey.compare(\"used\") == 0) {\n+                data.previously_spent = true;\n+            } else if (strKey.compare(0, 2, \"rr\") == 0) {\n+                data.receive_requests[strKey.substr(2)] = std::move(strValue);",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 9,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "0ad6a533b93162ec808de092cbe5edc31a27a390",
      "in_reply_to_id": 1150541159,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1150541159\r\n\r\n> Would be good to keep the encapsulation and don't access `m_address_book` from outside of the wallet class (otherwise we are reverting #25337 and, future, #26836).\r\n\r\nThanks, applied your change (https://github.com/furszy/bitcoin-core/commit/2195b1e3288f1019f81fc76c584519bd1d158f59)",
      "created_at": "2023-04-06T18:37:48Z",
      "updated_at": "2023-04-06T20:07:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1160135250",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160135250"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": 612,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 616,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160135564",
      "pull_request_review_id": 1373581514,
      "id": 1160135564,
      "node_id": "PRRC_kwDOABII585FJkOM",
      "diff_hunk": "@@ -1082,16 +1087,28 @@ void MaybeCompactWalletDB(WalletContext& context)\n     fOneThread = false;\n }\n \n-bool WalletBatch::WriteDestData(const std::string &address, const std::string &key, const std::string &value)\n+bool WalletBatch::WriteAddressPreviouslySpent(const CTxDestination& dest, bool previously_spent)\n+{\n+    auto key{std::make_pair(DBKeys::DESTDATA, std::make_pair(EncodeDestination(dest), std::string(\"used\")))};\n+    return previously_spent ? WriteIC(key, std::string(\"1\")) : EraseIC(key);\n+}\n+\n+bool WalletBatch::WriteAddressReceiveRequest(const CTxDestination& dest, const std::string& id, const std::string& receive_request)\n {\n-    return WriteIC(std::make_pair(DBKeys::DESTDATA, std::make_pair(address, key)), value);\n+    return WriteIC(std::make_pair(DBKeys::DESTDATA, std::make_pair(EncodeDestination(dest), \"rr\" + id)), receive_request);\n }\n \n-bool WalletBatch::EraseDestData(const std::string &address, const std::string &key)\n+bool WalletBatch::EraseAddressReceiveRequest(const CTxDestination& dest, const std::string& id)\n {\n-    return EraseIC(std::make_pair(DBKeys::DESTDATA, std::make_pair(address, key)));\n+    return EraseIC(std::make_pair(DBKeys::DESTDATA, std::make_pair(EncodeDestination(dest), \"rr\" + id)));\n }\n \n+bool WalletBatch::EraseAddressData(const CTxDestination& dest)\n+{\n+    DataStream prefix;\n+    prefix << DBKeys::DESTDATA << EncodeDestination(dest);\n+    return m_batch->ErasePrefix(prefix);",
      "path": "src/wallet/walletdb.cpp",
      "position": 50,
      "original_position": 42,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "0ad6a533b93162ec808de092cbe5edc31a27a390",
      "in_reply_to_id": 1150238393,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1150238393\r\n\r\n> to make this an `rvalue`. there is likely a cleaner way to do this, if you end up going with `DataStream`\r\n\r\nThanks, responded to earlier comment",
      "created_at": "2023-04-06T18:38:10Z",
      "updated_at": "2023-04-06T20:07:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1160135564",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160135564"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1124,
      "original_line": 1124,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160137866",
      "pull_request_review_id": 1373581514,
      "id": 1160137866,
      "node_id": "PRRC_kwDOABII585FJkyK",
      "diff_hunk": "@@ -427,19 +427,63 @@ BOOST_AUTO_TEST_CASE(ComputeTimeSmart)\n     BOOST_CHECK_EQUAL(AddTx(*m_node.chainman, m_wallet, 5, 50, 600), 300);\n }\n \n-BOOST_AUTO_TEST_CASE(LoadReceiveRequests)\n+static const DatabaseFormat DATABASE_FORMATS[] = {\n+#ifdef USE_SQLITE\n+    DatabaseFormat::SQLITE,\n+#endif\n+#ifdef USE_BDB\n+    DatabaseFormat::BERKELEY,\n+#endif\n+};\n+\n+void TestLoadWallet(const std::string& name, DatabaseFormat format, std::function<void(std::shared_ptr<CWallet>)> f)\n {\n-    CTxDestination dest = PKHash();\n-    LOCK(m_wallet.cs_wallet);\n-    WalletBatch batch{m_wallet.GetDatabase()};\n-    m_wallet.SetAddressUsed(batch, dest, true);\n-    m_wallet.SetAddressReceiveRequest(batch, dest, \"0\", \"val_rr0\");\n-    m_wallet.SetAddressReceiveRequest(batch, dest, \"1\", \"val_rr1\");\n-\n-    auto values = m_wallet.GetAddressReceiveRequests();\n-    BOOST_CHECK_EQUAL(values.size(), 2U);\n-    BOOST_CHECK_EQUAL(values[0], \"val_rr0\");\n-    BOOST_CHECK_EQUAL(values[1], \"val_rr1\");\n+    node::NodeContext node;\n+    auto chain{interfaces::MakeChain(node)};\n+    DatabaseOptions options;\n+    options.require_format = format;\n+    DatabaseStatus status;\n+    bilingual_str error;\n+    std::vector<bilingual_str> warnings;\n+    auto database{MakeWalletDatabase(name, options, status, error)};\n+    auto wallet{std::make_shared<CWallet>(chain.get(), \"\", std::move(database))};\n+    wallet->LoadWallet();\n+    WITH_LOCK(wallet->cs_wallet, f(wallet));\n+}\n+\n+BOOST_FIXTURE_TEST_CASE(LoadReceiveRequests, TestingSetup)\n+{\n+    for (DatabaseFormat format : DATABASE_FORMATS) {\n+        const std::string name{strprintf(\"receive-requests-%i\", format)};\n+        TestLoadWallet(name, format, [](std::shared_ptr<CWallet> wallet) EXCLUSIVE_LOCKS_REQUIRED(wallet->cs_wallet) {\n+            BOOST_CHECK(!wallet->m_address_book[PKHash()].previously_spent);",
      "path": "src/wallet/test/wallet_tests.cpp",
      "position": null,
      "original_position": 45,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "0ad6a533b93162ec808de092cbe5edc31a27a390",
      "in_reply_to_id": 1150579720,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1150579720\r\n\r\n> ```c++\r\n> BOOST_CHECK(!wallet->IsAddressUsed(PKHash()));\r\n> ```\r\n\r\nThanks applied your suggested change (https://github.com/furszy/bitcoin-core/commit/2195b1e3288f1019f81fc76c584519bd1d158f59)",
      "created_at": "2023-04-06T18:40:52Z",
      "updated_at": "2023-04-06T20:07:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1160137866",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160137866"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 459,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160138381",
      "pull_request_review_id": 1373581514,
      "id": 1160138381,
      "node_id": "PRRC_kwDOABII585FJk6N",
      "diff_hunk": "@@ -427,19 +427,63 @@ BOOST_AUTO_TEST_CASE(ComputeTimeSmart)\n     BOOST_CHECK_EQUAL(AddTx(*m_node.chainman, m_wallet, 5, 50, 600), 300);\n }\n \n-BOOST_AUTO_TEST_CASE(LoadReceiveRequests)\n+static const DatabaseFormat DATABASE_FORMATS[] = {\n+#ifdef USE_SQLITE\n+    DatabaseFormat::SQLITE,\n+#endif\n+#ifdef USE_BDB\n+    DatabaseFormat::BERKELEY,\n+#endif\n+};\n+\n+void TestLoadWallet(const std::string& name, DatabaseFormat format, std::function<void(std::shared_ptr<CWallet>)> f)\n {\n-    CTxDestination dest = PKHash();\n-    LOCK(m_wallet.cs_wallet);\n-    WalletBatch batch{m_wallet.GetDatabase()};\n-    m_wallet.SetAddressUsed(batch, dest, true);\n-    m_wallet.SetAddressReceiveRequest(batch, dest, \"0\", \"val_rr0\");\n-    m_wallet.SetAddressReceiveRequest(batch, dest, \"1\", \"val_rr1\");\n-\n-    auto values = m_wallet.GetAddressReceiveRequests();\n-    BOOST_CHECK_EQUAL(values.size(), 2U);\n-    BOOST_CHECK_EQUAL(values[0], \"val_rr0\");\n-    BOOST_CHECK_EQUAL(values[1], \"val_rr1\");\n+    node::NodeContext node;\n+    auto chain{interfaces::MakeChain(node)};\n+    DatabaseOptions options;\n+    options.require_format = format;\n+    DatabaseStatus status;\n+    bilingual_str error;\n+    std::vector<bilingual_str> warnings;\n+    auto database{MakeWalletDatabase(name, options, status, error)};\n+    auto wallet{std::make_shared<CWallet>(chain.get(), \"\", std::move(database))};\n+    wallet->LoadWallet();\n+    WITH_LOCK(wallet->cs_wallet, f(wallet));\n+}\n+\n+BOOST_FIXTURE_TEST_CASE(LoadReceiveRequests, TestingSetup)\n+{\n+    for (DatabaseFormat format : DATABASE_FORMATS) {\n+        const std::string name{strprintf(\"receive-requests-%i\", format)};\n+        TestLoadWallet(name, format, [](std::shared_ptr<CWallet> wallet) EXCLUSIVE_LOCKS_REQUIRED(wallet->cs_wallet) {\n+            BOOST_CHECK(!wallet->m_address_book[PKHash()].previously_spent);\n+            WalletBatch batch{wallet->GetDatabase()};\n+            BOOST_CHECK(batch.WriteAddressPreviouslySpent(PKHash(), true));\n+            BOOST_CHECK(batch.WriteAddressPreviouslySpent(ScriptHash(), true));\n+            BOOST_CHECK(wallet->SetAddressReceiveRequest(batch, PKHash(), \"0\", \"val_rr00\"));\n+            BOOST_CHECK(wallet->EraseAddressReceiveRequest(batch, PKHash(), \"0\"));\n+            BOOST_CHECK(wallet->SetAddressReceiveRequest(batch, PKHash(), \"1\", \"val_rr10\"));\n+            BOOST_CHECK(wallet->SetAddressReceiveRequest(batch, PKHash(), \"1\", \"val_rr11\"));\n+            BOOST_CHECK(wallet->SetAddressReceiveRequest(batch, ScriptHash(), \"2\", \"val_rr20\"));\n+        });\n+        TestLoadWallet(name, format, [](std::shared_ptr<CWallet> wallet) EXCLUSIVE_LOCKS_REQUIRED(wallet->cs_wallet) {\n+            BOOST_CHECK(wallet->m_address_book[PKHash()].previously_spent);\n+            BOOST_CHECK(wallet->m_address_book[ScriptHash()].previously_spent);",
      "path": "src/wallet/test/wallet_tests.cpp",
      "position": null,
      "original_position": 57,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "0ad6a533b93162ec808de092cbe5edc31a27a390",
      "in_reply_to_id": 1150583313,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1150583313\r\n\r\n> ```c++\r\n> BOOST_CHECK(wallet->IsAddressUsed(PKHash()));\r\n> BOOST_CHECK(wallet->IsAddressUsed(ScriptHash()));\r\n> ```\r\n\r\nThanks applied your suggested change (https://github.com/furszy/bitcoin-core/commit/2195b1e3288f1019f81fc76c584519bd1d158f59)",
      "created_at": "2023-04-06T18:41:32Z",
      "updated_at": "2023-04-06T20:07:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1160138381",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160138381"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": 470,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 471,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160138608",
      "pull_request_review_id": 1373581514,
      "id": 1160138608,
      "node_id": "PRRC_kwDOABII585FJk9w",
      "diff_hunk": "@@ -427,19 +427,63 @@ BOOST_AUTO_TEST_CASE(ComputeTimeSmart)\n     BOOST_CHECK_EQUAL(AddTx(*m_node.chainman, m_wallet, 5, 50, 600), 300);\n }\n \n-BOOST_AUTO_TEST_CASE(LoadReceiveRequests)\n+static const DatabaseFormat DATABASE_FORMATS[] = {\n+#ifdef USE_SQLITE\n+    DatabaseFormat::SQLITE,\n+#endif\n+#ifdef USE_BDB\n+    DatabaseFormat::BERKELEY,\n+#endif\n+};\n+\n+void TestLoadWallet(const std::string& name, DatabaseFormat format, std::function<void(std::shared_ptr<CWallet>)> f)\n {\n-    CTxDestination dest = PKHash();\n-    LOCK(m_wallet.cs_wallet);\n-    WalletBatch batch{m_wallet.GetDatabase()};\n-    m_wallet.SetAddressUsed(batch, dest, true);\n-    m_wallet.SetAddressReceiveRequest(batch, dest, \"0\", \"val_rr0\");\n-    m_wallet.SetAddressReceiveRequest(batch, dest, \"1\", \"val_rr1\");\n-\n-    auto values = m_wallet.GetAddressReceiveRequests();\n-    BOOST_CHECK_EQUAL(values.size(), 2U);\n-    BOOST_CHECK_EQUAL(values[0], \"val_rr0\");\n-    BOOST_CHECK_EQUAL(values[1], \"val_rr1\");\n+    node::NodeContext node;\n+    auto chain{interfaces::MakeChain(node)};\n+    DatabaseOptions options;\n+    options.require_format = format;\n+    DatabaseStatus status;\n+    bilingual_str error;\n+    std::vector<bilingual_str> warnings;\n+    auto database{MakeWalletDatabase(name, options, status, error)};\n+    auto wallet{std::make_shared<CWallet>(chain.get(), \"\", std::move(database))};\n+    wallet->LoadWallet();\n+    WITH_LOCK(wallet->cs_wallet, f(wallet));\n+}\n+\n+BOOST_FIXTURE_TEST_CASE(LoadReceiveRequests, TestingSetup)\n+{\n+    for (DatabaseFormat format : DATABASE_FORMATS) {\n+        const std::string name{strprintf(\"receive-requests-%i\", format)};\n+        TestLoadWallet(name, format, [](std::shared_ptr<CWallet> wallet) EXCLUSIVE_LOCKS_REQUIRED(wallet->cs_wallet) {\n+            BOOST_CHECK(!wallet->m_address_book[PKHash()].previously_spent);\n+            WalletBatch batch{wallet->GetDatabase()};\n+            BOOST_CHECK(batch.WriteAddressPreviouslySpent(PKHash(), true));\n+            BOOST_CHECK(batch.WriteAddressPreviouslySpent(ScriptHash(), true));\n+            BOOST_CHECK(wallet->SetAddressReceiveRequest(batch, PKHash(), \"0\", \"val_rr00\"));\n+            BOOST_CHECK(wallet->EraseAddressReceiveRequest(batch, PKHash(), \"0\"));\n+            BOOST_CHECK(wallet->SetAddressReceiveRequest(batch, PKHash(), \"1\", \"val_rr10\"));\n+            BOOST_CHECK(wallet->SetAddressReceiveRequest(batch, PKHash(), \"1\", \"val_rr11\"));\n+            BOOST_CHECK(wallet->SetAddressReceiveRequest(batch, ScriptHash(), \"2\", \"val_rr20\"));\n+        });\n+        TestLoadWallet(name, format, [](std::shared_ptr<CWallet> wallet) EXCLUSIVE_LOCKS_REQUIRED(wallet->cs_wallet) {\n+            BOOST_CHECK(wallet->m_address_book[PKHash()].previously_spent);\n+            BOOST_CHECK(wallet->m_address_book[ScriptHash()].previously_spent);\n+            auto requests = wallet->GetAddressReceiveRequests();\n+            auto erequests = {\"val_rr11\", \"val_rr20\"};\n+            BOOST_CHECK_EQUAL_COLLECTIONS(requests.begin(), requests.end(), std::begin(erequests), std::end(erequests));\n+            WalletBatch batch{wallet->GetDatabase()};\n+            BOOST_CHECK(batch.WriteAddressPreviouslySpent(PKHash(), false));\n+            BOOST_CHECK(batch.EraseAddressData(ScriptHash()));\n+        });\n+        TestLoadWallet(name, format, [](std::shared_ptr<CWallet> wallet) EXCLUSIVE_LOCKS_REQUIRED(wallet->cs_wallet) {\n+            BOOST_CHECK(!wallet->m_address_book[PKHash()].previously_spent);\n+            BOOST_CHECK(!wallet->m_address_book[ScriptHash()].previously_spent);",
      "path": "src/wallet/test/wallet_tests.cpp",
      "position": null,
      "original_position": 67,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "0ad6a533b93162ec808de092cbe5edc31a27a390",
      "in_reply_to_id": 1150586523,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1150586523\r\n\r\n> ```c++\r\n> BOOST_CHECK(!wallet->IsAddressUsed(PKHash()));\r\n> BOOST_CHECK(!wallet->IsAddressUsed(ScriptHash()));\r\n> ```\r\n\r\nThanks applied your suggested change (https://github.com/furszy/bitcoin-core/commit/2195b1e3288f1019f81fc76c584519bd1d158f59)",
      "created_at": "2023-04-06T18:41:49Z",
      "updated_at": "2023-04-06T20:07:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1160138608",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160138608"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": 480,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 481,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160150468",
      "pull_request_review_id": 1373581514,
      "id": 1160150468,
      "node_id": "PRRC_kwDOABII585FJn3E",
      "diff_hunk": "@@ -2439,11 +2439,7 @@ bool CWallet::DelAddressBook(const CTxDestination& address)\n             return false;\n         }\n         // Delete destdata tuples associated with address",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 3,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "0ad6a533b93162ec808de092cbe5edc31a27a390",
      "in_reply_to_id": 1150523650,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> No longer the case. Same for the comment that is above this one.\r\n\r\nThanks, I basically just replaced \"destdata\" with \"address data\"  in these comments, but you can let me know if the issue was something else",
      "created_at": "2023-04-06T18:56:38Z",
      "updated_at": "2023-04-06T20:07:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1160150468",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160150468"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2441,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160160932",
      "pull_request_review_id": 1373581514,
      "id": 1160160932,
      "node_id": "PRRC_kwDOABII585FJqak",
      "diff_hunk": "@@ -2821,65 +2817,46 @@ unsigned int CWallet::ComputeTimeSmart(const CWalletTx& wtx, bool rescanning_old\n \n bool CWallet::SetAddressUsed(WalletBatch& batch, const CTxDestination& dest, bool used)",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 15,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "0ad6a533b93162ec808de092cbe5edc31a27a390",
      "in_reply_to_id": 1150535358,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1150535358\r\n\r\nSure, I think it would make sense to clear this flag when a transaction is abandoned. I think this could be a separate issue, and it should be pretty easy to implement anytime IMO",
      "created_at": "2023-04-06T19:10:12Z",
      "updated_at": "2023-04-06T20:07:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1160160932",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160160932"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2818,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160161770",
      "pull_request_review_id": 1373581514,
      "id": 1160161770,
      "node_id": "PRRC_kwDOABII585FJqnq",
      "diff_hunk": "@@ -2821,65 +2817,46 @@ unsigned int CWallet::ComputeTimeSmart(const CWalletTx& wtx, bool rescanning_old\n \n bool CWallet::SetAddressUsed(WalletBatch& batch, const CTxDestination& dest, bool used)\n {\n-    const std::string key{\"used\"};\n     if (std::get_if<CNoDestination>(&dest))\n         return false;\n \n     if (!used) {\n-        if (auto* data = util::FindKey(m_address_book, dest)) data->destdata.erase(key);\n-        return batch.EraseDestData(EncodeDestination(dest), key);\n+        if (auto* data{util::FindKey(m_address_book, dest)}) data->previously_spent = false;\n+        return batch.WriteAddressPreviouslySpent(dest, false);\n     }\n \n-    const std::string value{\"1\"};\n-    m_address_book[dest].destdata.insert(std::make_pair(key, value));\n-    return batch.WriteDestData(EncodeDestination(dest), key, value);\n-}\n-\n-void CWallet::LoadDestData(const CTxDestination &dest, const std::string &key, const std::string &value)\n-{\n-    m_address_book[dest].destdata.insert(std::make_pair(key, value));",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 35,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "0ad6a533b93162ec808de092cbe5edc31a27a390",
      "in_reply_to_id": 1150538791,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1150538791\r\n\r\n> This method was removed from the cpp but not from the header.\r\n\r\nThanks applied your suggested change (https://github.com/furszy/bitcoin-core/commit/2195b1e3288f1019f81fc76c584519bd1d158f59)",
      "created_at": "2023-04-06T19:11:23Z",
      "updated_at": "2023-04-06T20:07:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1160161770",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160161770"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": 2838,
      "start_side": "LEFT",
      "line": null,
      "original_line": 2845,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160562186",
      "pull_request_review_id": 1376002016,
      "id": 1160562186,
      "node_id": "PRRC_kwDOABII585FLMYK",
      "diff_hunk": "@@ -205,6 +206,7 @@ class BerkeleyBatch : public DatabaseBatch\n     bool WriteKey(DataStream&& key, DataStream&& value, bool overwrite = true) override;\n     bool EraseKey(DataStream&& key) override;\n     bool HasKey(DataStream&& key) override;\n+    bool ErasePrefix(Span<std::byte> prefix) override;",
      "path": "src/wallet/bdb.h",
      "position": null,
      "original_position": 17,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "0ad6a533b93162ec808de092cbe5edc31a27a390",
      "in_reply_to_id": 1150232826,
      "user": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "gotcha, thanks for the explanation!",
      "created_at": "2023-04-07T09:05:37Z",
      "updated_at": "2023-04-07T09:05:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1160562186",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160562186"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 209,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165987641",
      "pull_request_review_id": 1384148699,
      "id": 1165987641,
      "node_id": "PRRC_kwDOABII585Ff485",
      "diff_hunk": "@@ -2824,67 +2820,58 @@ unsigned int CWallet::ComputeTimeSmart(const CWalletTx& wtx, bool rescanning_old\n     return nTimeSmart;\n }\n \n-bool CWallet::SetAddressUsed(WalletBatch& batch, const CTxDestination& dest, bool used)\n+bool CWallet::SetAddressPreviouslySpent(WalletBatch& batch, const CTxDestination& dest, bool used)\n {\n-    const std::string key{\"used\"};\n     if (std::get_if<CNoDestination>(&dest))\n         return false;\n \n     if (!used) {\n-        if (auto* data = util::FindKey(m_address_book, dest)) data->destdata.erase(key);\n-        return batch.EraseDestData(EncodeDestination(dest), key);\n+        if (auto* data{util::FindKey(m_address_book, dest)}) data->previously_spent = false;\n+        return batch.WriteAddressPreviouslySpent(dest, false);\n     }\n \n-    const std::string value{\"1\"};\n-    m_address_book[dest].destdata.insert(std::make_pair(key, value));\n-    return batch.WriteDestData(EncodeDestination(dest), key, value);\n+    LoadAddressPreviouslySpent(dest);\n+    return batch.WriteAddressPreviouslySpent(dest, true);\n }\n \n-void CWallet::LoadDestData(const CTxDestination &dest, const std::string &key, const std::string &value)\n+void CWallet::LoadAddressPreviouslySpent(const CTxDestination& dest)\n {\n-    m_address_book[dest].destdata.insert(std::make_pair(key, value));\n+    m_address_book[dest].previously_spent = true;\n }\n \n-bool CWallet::IsAddressUsed(const CTxDestination& dest) const\n+void CWallet::LoadAddressReceiveRequest(const CTxDestination& dest, const std::string& id, const std::string& request)\n {\n-    const std::string key{\"used\"};\n-    std::map<CTxDestination, CAddressBookData>::const_iterator i = m_address_book.find(dest);\n-    if(i != m_address_book.end())\n-    {\n-        CAddressBookData::StringMap::const_iterator j = i->second.destdata.find(key);\n-        if(j != i->second.destdata.end())\n-        {\n-            return true;\n-        }\n-    }\n+    m_address_book[dest].receive_requests[id] = request;\n+}\n+\n+bool CWallet::IsAddressPreviouslySpent(const CTxDestination& dest) const\n+{\n+    if (auto* data{util::FindKey(m_address_book, dest)}) return data->previously_spent;\n     return false;\n }\n \n std::vector<std::string> CWallet::GetAddressReceiveRequests() const\n {\n-    const std::string prefix{\"rr\"};\n     std::vector<std::string> values;\n-    for (const auto& address : m_address_book) {\n-        for (const auto& data : address.second.destdata) {\n-            if (!data.first.compare(0, prefix.size(), prefix)) {\n-                values.emplace_back(data.second);\n-            }\n+    for (const auto& [dest, entry] : m_address_book) {\n+        for (const auto& [id, request] : entry.receive_requests) {\n+            values.emplace_back(request);\n         }\n     }\n     return values;\n }\n \n bool CWallet::SetAddressReceiveRequest(WalletBatch& batch, const CTxDestination& dest, const std::string& id, const std::string& value)\n {\n-    const std::string key{\"rr\" + id}; // \"rr\" prefix = \"receive request\" in destdata\n-    CAddressBookData& data = m_address_book.at(dest);\n-    if (value.empty()) {\n-        if (!batch.EraseDestData(EncodeDestination(dest), key)) return false;\n-        data.destdata.erase(key);\n-    } else {\n-        if (!batch.WriteDestData(EncodeDestination(dest), key, value)) return false;\n-        data.destdata[key] = value;\n-    }\n+    if (!batch.WriteAddressReceiveRequest(dest, id, value)) return false;\n+    m_address_book[dest].receive_requests[id] = value;\n+    return true;\n+}\n+\n+bool CWallet::EraseAddressReceiveRequest(WalletBatch& batch, const CTxDestination& dest, const std::string& id)\n+{\n+    if (!batch.EraseAddressReceiveRequest(dest, id)) return false;\n+    m_address_book[dest].receive_requests.erase(id);",
      "path": "src/wallet/wallet.cpp",
      "position": 157,
      "original_position": 157,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Would be good to check that the map contains the element prior accessing it. Otherwise the GUI could be adding a new address book entry by mistake.",
      "created_at": "2023-04-13T20:19:46Z",
      "updated_at": "2023-04-13T20:22:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1165987641",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165987641"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": 2871,
      "original_start_line": 2871,
      "start_side": "RIGHT",
      "line": 2874,
      "original_line": 2874,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1181656908",
      "pull_request_review_id": 1407726864,
      "id": 1181656908,
      "node_id": "PRRC_kwDOABII585GbqdM",
      "diff_hunk": "@@ -223,17 +223,22 @@ struct CAddressBookData\n     std::optional<AddressPurpose> purpose;\n \n     /**\n-     * Additional address metadata map that can currently hold two types of keys:\n-     *\n-     *   \"used\" keys with values always set to \"1\" or \"p\" if present. This is set on\n-     *       IsMine addresses that have already been spent from if the\n-     *       avoid_reuse option is enabled\n-     *\n-     *   \"rr##\" keys where ## is a decimal number, with serialized\n-     *       RecentRequestEntry objects as values\n+     * Whether coins with this address have previously been spent. Set when the\n+     * the wallet avoid_reuse option is enabled and this is an IsMine address\n+     * that has already received funds and spent them. This is used during coin\n+     * selection to increase privacy by not creating different transactions\n+     * that spend from the same addresses.\n+     */\n+    bool previously_spent{false};\n+\n+    /**\n+     * Map containing data about previously generated receive requests\n+     * requesting funds to be sent to this address. Only present for IsMine\n+     * addresses. Map keys are decimal numbers uniquely identifying each",
      "path": "src/wallet/wallet.h",
      "position": 23,
      "original_position": 23,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "in_reply_to_id": null,
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I was momentarily confused by this because (IIUC) map keys are the `int64_t id` field of `RecentRequestEntry` but actually encoded into `std::string` by a few methods in `RecentRequestsTableModel`. So I'm wondering: Is there a reason we need to keep those IDs as strings? Is it like, at this point, going back to int64 would be a needless refactor?\r\n\r\n\r\n\r\n",
      "created_at": "2023-05-01T15:29:22Z",
      "updated_at": "2023-05-01T15:29:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1181656908",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1181656908"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 237,
      "original_line": 237,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1181688010",
      "pull_request_review_id": 1407784008,
      "id": 1181688010,
      "node_id": "PRRC_kwDOABII585GbyDK",
      "diff_hunk": "@@ -223,17 +223,22 @@ struct CAddressBookData\n     std::optional<AddressPurpose> purpose;\n \n     /**\n-     * Additional address metadata map that can currently hold two types of keys:\n-     *\n-     *   \"used\" keys with values always set to \"1\" or \"p\" if present. This is set on\n-     *       IsMine addresses that have already been spent from if the\n-     *       avoid_reuse option is enabled\n-     *\n-     *   \"rr##\" keys where ## is a decimal number, with serialized\n-     *       RecentRequestEntry objects as values\n+     * Whether coins with this address have previously been spent. Set when the\n+     * the wallet avoid_reuse option is enabled and this is an IsMine address\n+     * that has already received funds and spent them. This is used during coin\n+     * selection to increase privacy by not creating different transactions\n+     * that spend from the same addresses.\n+     */\n+    bool previously_spent{false};\n+\n+    /**\n+     * Map containing data about previously generated receive requests\n+     * requesting funds to be sent to this address. Only present for IsMine\n+     * addresses. Map keys are decimal numbers uniquely identifying each",
      "path": "src/wallet/wallet.h",
      "position": 23,
      "original_position": 23,
      "commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "original_commit_id": "a5986e82dd2b8f923d60f9e31760ef62b9010105",
      "in_reply_to_id": 1181656908,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1181656908\r\n\r\n> So I'm wondering: Is there a reason we need to keep those IDs as strings? Is it like, at this point, going back to int64 would be a needless refactor?\r\n\r\nOnly reason that the [`CAddressBookData::receive_requests`](https://github.com/bitcoin/bitcoin/blob/be0325c6a62505d63bc07320b05e31618ef9bbb1/src/wallet/wallet.h#L232-L239) map containing the requests has string keys and string values is that the [`setAddressReceiveRequest`](https://github.com/bitcoin/bitcoin/blob/be0325c6a62505d63bc07320b05e31618ef9bbb1/src/wallet/interfaces.cpp#L230-L247) API adding the requests takes string keys and string values.\r\n\r\nI think it is best for the map types to match the API types, so wallet code can store the values it is passed without parsing them. But definitely the [`setAddressReceiveRequest`](https://github.com/bitcoin/bitcoin/blob/be0325c6a62505d63bc07320b05e31618ef9bbb1/src/wallet/interfaces.cpp#L230-L247) API could be improved, and there was discussion about this in https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1137458690. Not only could the string keys be replaced by integer keys, but it might be possible to drop the keys and the map entirely if the GUI doesn't need to store multiple requests for a single address. I'm not sure how valuable this refactoring would be, but it should be easier to do now that receive requests are stored separately from other address data.\r\n\r\nEDIT: I was curious what replacing strings with ints would look like so I implemented it in commit 2877c80afd40313760dbe11a86e89e87dbc7f2b8 ([branch](https://github.com/ryanofsky/bitcoin/commits/pr/intrequest)). I think the cleanup probably isn't that valuable standalone, but it might be useful as part of a larger change.",
      "created_at": "2023-05-01T16:11:40Z",
      "updated_at": "2023-05-01T17:17:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27224#discussion_r1181688010",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1181688010"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27224"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 237,
      "original_line": 237,
      "side": "RIGHT"
    }
  ]
}