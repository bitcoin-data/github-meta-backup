{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897",
    "id": 237043855,
    "node_id": "MDExOlB1bGxSZXF1ZXN0MjM3MDQzODU1",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/14897",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/14897.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/14897.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/1cff3d6cb017aea87d16cbda0768bbab256d16da",
    "number": 14897,
    "state": "closed",
    "locked": true,
    "maintainer_can_modify": false,
    "title": "randomize GETDATA(tx) request order and introduce bias toward outbound ",
    "user": {
      "login": "naumenkogs",
      "id": 7975071,
      "node_id": "MDQ6VXNlcjc5NzUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naumenkogs",
      "html_url": "https://github.com/naumenkogs",
      "followers_url": "https://api.github.com/users/naumenkogs/followers",
      "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
      "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
      "repos_url": "https://api.github.com/users/naumenkogs/repos",
      "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This code makes executing two particular (and potentially other) attacks harder.\r\n\r\n### InvBlock\r\nThis behavior was described well [here](https://www.cs.umd.edu/projects/coinscope/coinscope.pdf) (page 11).\r\n\r\nPer current implementation, if node A receives _INV_ (tx) from node B, node A sends _GETDATA_ to B and waits for _TX_ message back.\r\n\r\nNode A is likely to receive more _INVs_ (regarding the same tx) from other peers. But node A would not send another _GETDATA_ unless it does not hear _TX_ back from node B for next 2 minutes (to save bandwidth)\r\n\r\nThus, if B is a malicious node, it can prevent node A from getting the transaction (even if all A’s peers have it) for 2 minutes.\r\n\r\nThis behavior seems to be an inherent limitation of the current P2P relay protocol, and I don’t see how it can be fundamentally changed (I can see workarounds which involve rewriting a lot of P2P code though).\r\n\r\n### What does this PR fix?\r\n\r\nThe attacks I’m looking at involve preventing A from learning the transaction for 2*N minutes. To do that, an attacker has to spin up N nodes and send N _INVs_ simultaneously to node A (then InvBlocks will be queued with an interval of 2 minutes according to current implementation)\r\n\r\nMore precisely, 2 scenarios I’m looking at are:\r\n1. An attacker censors a particular transaction. By performing InvBlock from different nodes, an attacker can execute a network-wide censorship of a particular transaction (or all transactions). The earlier an attacker founds the transaction he wants to censor, the easier it is to perform an attack. As it was pointed out by @gwillen, this is even more dangerous in the case of lightning, where transactions are known in advance. \r\n2. Topology inference described in papers [1](https://www.cs.umd.edu/projects/coinscope/coinscope.pdf), [2](https://arxiv.org/pdf/1812.00942.pdf) involve network-wide InvBlock. This fix would not mitigate this type of inference, but I believe it will make it more expensive to perform (an attacker would have to create more transactions and perform more rounds to learn the topology, the second paper itself notes that InvBlock isolation is important for the attack).\r\n\r\n### How does it work\r\nThis PR introduces bias toward outbound connections (they have higher priority when a node chooses from whom it should request a transaction) and randomizes the order.\r\nAs per @gmaxwell suggestion, GETDATA requests queue is created after processing all incoming messages from all nodes. \r\n\r\nAfter this fix, if the incoming messages were [I1, I2, I3, O1, O2, O3, O4], the queue for _GETDATA_ may look like [O2, O1, O3, O4, I1, I3, I2, ….].\r\n\r\nIf {I1, I2, I3} were significantly earlier (but the difference is less than TX_TIMEOUT=60 s) than others, the queue for _GETDATA_ may look like [I2, O2, O1, O3, O4, I1, I3, ….]. \r\n\r\n\r\n### Other comments:\r\n1. This mitigation works better if the connectivity is higher (especially outbound, because it would be less likely that 2 _GETDATAs_ for inbound malicious nodes queued together)\r\n",
    "labels": [
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      }
    ],
    "milestone": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/35",
      "html_url": "https://github.com/bitcoin/bitcoin/milestone/35",
      "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/35/labels",
      "id": 3318051,
      "node_id": "MDk6TWlsZXN0b25lMzMxODA1MQ==",
      "number": 35,
      "state": "closed",
      "title": "0.18.0",
      "description": "",
      "creator": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "open_issues": 0,
      "closed_issues": 186,
      "created_at": "2018-05-03T15:34:54Z",
      "updated_at": "2020-03-17T18:30:07Z",
      "closed_at": "2019-05-03T02:51:38Z"
    },
    "active_lock_reason": "resolved",
    "created_at": "2018-12-08T04:12:48Z",
    "updated_at": "2022-08-16T17:22:08Z",
    "closed_at": "2019-02-08T04:13:10Z",
    "mergeable_state": "unknown",
    "merged_at": "2019-02-08T04:13:09Z",
    "merge_commit_sha": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "head": {
      "label": "naumenkogs:master",
      "ref": "master",
      "sha": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 115054139,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTUwNTQxMzk=",
        "name": "bitcoin",
        "full_name": "naumenkogs/bitcoin",
        "owner": {
          "login": "naumenkogs",
          "id": 7975071,
          "node_id": "MDQ6VXNlcjc5NzUwNzE=",
          "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/naumenkogs",
          "html_url": "https://github.com/naumenkogs",
          "followers_url": "https://api.github.com/users/naumenkogs/followers",
          "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
          "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
          "repos_url": "https://api.github.com/users/naumenkogs/repos",
          "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/naumenkogs/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/naumenkogs/bitcoin",
        "archive_url": "https://api.github.com/repos/naumenkogs/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/naumenkogs/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/naumenkogs/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/naumenkogs/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/naumenkogs/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/naumenkogs/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/naumenkogs/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/naumenkogs/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/naumenkogs/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/naumenkogs/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/naumenkogs/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/naumenkogs/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/naumenkogs/bitcoin/events",
        "forks_url": "https://api.github.com/repos/naumenkogs/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/naumenkogs/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/naumenkogs/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/naumenkogs/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/naumenkogs/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/naumenkogs/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/naumenkogs/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/naumenkogs/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/naumenkogs/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/naumenkogs/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/naumenkogs/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/naumenkogs/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/naumenkogs/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/naumenkogs/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/naumenkogs/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/naumenkogs/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:naumenkogs/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/naumenkogs/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/naumenkogs/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/naumenkogs/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/naumenkogs/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/naumenkogs/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/naumenkogs/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/naumenkogs/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/naumenkogs/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/naumenkogs/bitcoin/hooks",
        "svn_url": "https://github.com/naumenkogs/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 2,
        "stargazers_count": 1,
        "watchers_count": 1,
        "size": 213338,
        "default_branch": "master",
        "open_issues_count": 1,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-02-23T10:57:41Z",
        "created_at": "2017-12-21T22:52:17Z",
        "updated_at": "2021-03-02T13:21:27Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "72d34c0edc5ad9e69e0d054459ec15d2278f206b",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 34324,
        "stargazers_count": 69817,
        "watchers_count": 69817,
        "size": 233879,
        "default_branch": "master",
        "open_issues_count": 627,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-06T22:42:00Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-06-07T01:13:41Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 168,
    "deletions": 81,
    "changed_files": 6,
    "commits": 1,
    "review_comments": 80,
    "comments": 29
  },
  "events": [
    {
      "event": "mentioned",
      "id": 2013818843,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjAxMzgxODg0Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2013818843",
      "actor": {
        "login": "gwillen",
        "id": 458997,
        "node_id": "MDQ6VXNlcjQ1ODk5Nw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/458997?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gwillen",
        "html_url": "https://github.com/gwillen",
        "followers_url": "https://api.github.com/users/gwillen/followers",
        "following_url": "https://api.github.com/users/gwillen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gwillen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gwillen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gwillen/subscriptions",
        "organizations_url": "https://api.github.com/users/gwillen/orgs",
        "repos_url": "https://api.github.com/users/gwillen/repos",
        "events_url": "https://api.github.com/users/gwillen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gwillen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-08T04:12:49Z"
    },
    {
      "event": "subscribed",
      "id": 2013818844,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDIwMTM4MTg4NDQ=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2013818844",
      "actor": {
        "login": "gwillen",
        "id": 458997,
        "node_id": "MDQ6VXNlcjQ1ODk5Nw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/458997?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gwillen",
        "html_url": "https://github.com/gwillen",
        "followers_url": "https://api.github.com/users/gwillen/followers",
        "following_url": "https://api.github.com/users/gwillen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gwillen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gwillen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gwillen/subscriptions",
        "organizations_url": "https://api.github.com/users/gwillen/orgs",
        "repos_url": "https://api.github.com/users/gwillen/repos",
        "events_url": "https://api.github.com/users/gwillen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gwillen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-08T04:12:49Z"
    },
    {
      "event": "labeled",
      "id": 2013821168,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDIwMTM4MjExNjg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2013821168",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-08T04:20:48Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    },
    {
      "event": "commented",
      "id": 445430340,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NTQzMDM0MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/445430340",
      "actor": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-08T04:40:16Z",
      "updated_at": "2018-12-08T04:40:16Z",
      "author_association": "CONTRIBUTOR",
      "body": "I'm strongly in support of doing something about this. \r\n\r\nBut instead, why not  do something like:  for each tx keep a next-time and ordered data structure, sorted on ( outbound, nonce) where nonce is just selected at random when the inv is processed.\r\n\r\nThen after each run of the message handling loop, after processing messages from all peers. go through the txn and for every tx with a next-time in the past, pop the best element from the list and query its peer, then update the next time.\r\n\r\nThis way there is even a decent chance that you do not fetch the txn from the first to offer it to you, you fetch in random order, and fetch from outpeers first if there are any outstanding offer.",
      "user": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-445430340",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "commented",
      "id": 445434264,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NTQzNDI2NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/445434264",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-08T05:59:54Z",
      "updated_at": "2018-12-08T05:59:54Z",
      "author_association": "MEMBER",
      "body": "@gmaxwell My implementation was supposed to have minimum intrusion in other parts of the code, but now when you suggested an alternative it seems not much code too. I'll update my PR soon.",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-445434264",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "mentioned",
      "id": 2013847321,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjAxMzg0NzMyMQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2013847321",
      "actor": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-08T05:59:54Z"
    },
    {
      "event": "subscribed",
      "id": 2013847322,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDIwMTM4NDczMjI=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2013847322",
      "actor": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-08T05:59:54Z"
    },
    {
      "event": "commented",
      "id": 445436633,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NTQzNjYzMw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/445436633",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-08T06:42:09Z",
      "updated_at": "2019-02-04T22:56:55Z",
      "author_association": "MEMBER",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#15141](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15141.html) (Rewrite DoS interface between validation and net_processing by sdaftuar)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-445436633",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "commented",
      "id": 445488406,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NTQ4ODQwNg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/445488406",
      "actor": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-08T20:42:10Z",
      "updated_at": "2018-12-08T20:42:10Z",
      "author_association": "CONTRIBUTOR",
      "body": "Awesome, if you find that implementing something else actually does turn out to be complicated, please feel free to loop back.  I asked in part because it didn't _seem_ like it would be much more complicated, but the devil is in the details.  I think what you propose here sounds better than nothing, but I think we can probably bypass the half-measure. :)",
      "user": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-445488406",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "mentioned",
      "id": 2014480036,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjAxNDQ4MDAzNg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2014480036",
      "actor": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-09T17:17:52Z"
    },
    {
      "event": "subscribed",
      "id": 2014480037,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDIwMTQ0ODAwMzc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2014480037",
      "actor": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-09T17:17:52Z"
    },
    {
      "event": "renamed",
      "id": 2014484271,
      "node_id": "MDE3OlJlbmFtZWRUaXRsZUV2ZW50MjAxNDQ4NDI3MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2014484271",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-09T17:29:20Z",
      "rename": {
        "from": "bias towards outbound connections for askFor(tx)",
        "to": "randomize GETDATA(tx) request order and introduce bias toward outbound "
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2014487537,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjAxNDQ4NzUzNw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2014487537",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-09T17:37:10Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2014489448,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjAxNDQ4OTQ0OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2014489448",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-09T17:41:51Z"
    },
    {
      "event": "reviewed",
      "id": 182999927,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MTgyOTk5OTI3",
      "url": null,
      "actor": null,
      "commit_id": "6019b2a8754c2a610a0355d904fb16c86dd91b5a",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#pullrequestreview-182999927",
      "submitted_at": "2018-12-09T23:05:49Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
    },
    {
      "event": "commented",
      "id": 445580678,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NTU4MDY3OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/445580678",
      "actor": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-09T23:06:10Z",
      "updated_at": "2018-12-09T23:06:10Z",
      "author_association": "CONTRIBUTOR",
      "body": "Nice work!\r\nConcept ACK.",
      "user": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-445580678",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "reviewed",
      "id": 183093021,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MTgzMDkzMDIx",
      "url": null,
      "actor": null,
      "commit_id": "6019b2a8754c2a610a0355d904fb16c86dd91b5a",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "user": {
        "login": "AM5800",
        "id": 621585,
        "node_id": "MDQ6VXNlcjYyMTU4NQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/621585?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/AM5800",
        "html_url": "https://github.com/AM5800",
        "followers_url": "https://api.github.com/users/AM5800/followers",
        "following_url": "https://api.github.com/users/AM5800/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/AM5800/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/AM5800/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/AM5800/subscriptions",
        "organizations_url": "https://api.github.com/users/AM5800/orgs",
        "repos_url": "https://api.github.com/users/AM5800/repos",
        "events_url": "https://api.github.com/users/AM5800/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/AM5800/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#pullrequestreview-183093021",
      "submitted_at": "2018-12-10T09:29:44Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
    },
    {
      "event": "reviewed",
      "id": 183121612,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MTgzMTIxNjEy",
      "url": null,
      "actor": null,
      "commit_id": "6019b2a8754c2a610a0355d904fb16c86dd91b5a",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "user": {
        "login": "AM5800",
        "id": 621585,
        "node_id": "MDQ6VXNlcjYyMTU4NQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/621585?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/AM5800",
        "html_url": "https://github.com/AM5800",
        "followers_url": "https://api.github.com/users/AM5800/followers",
        "following_url": "https://api.github.com/users/AM5800/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/AM5800/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/AM5800/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/AM5800/subscriptions",
        "organizations_url": "https://api.github.com/users/AM5800/orgs",
        "repos_url": "https://api.github.com/users/AM5800/repos",
        "events_url": "https://api.github.com/users/AM5800/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/AM5800/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#pullrequestreview-183121612",
      "submitted_at": "2018-12-10T10:37:00Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
    },
    {
      "event": "reviewed",
      "id": 183126588,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MTgzMTI2NTg4",
      "url": null,
      "actor": null,
      "commit_id": "6019b2a8754c2a610a0355d904fb16c86dd91b5a",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "user": {
        "login": "AM5800",
        "id": 621585,
        "node_id": "MDQ6VXNlcjYyMTU4NQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/621585?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/AM5800",
        "html_url": "https://github.com/AM5800",
        "followers_url": "https://api.github.com/users/AM5800/followers",
        "following_url": "https://api.github.com/users/AM5800/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/AM5800/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/AM5800/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/AM5800/subscriptions",
        "organizations_url": "https://api.github.com/users/AM5800/orgs",
        "repos_url": "https://api.github.com/users/AM5800/repos",
        "events_url": "https://api.github.com/users/AM5800/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/AM5800/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#pullrequestreview-183126588",
      "submitted_at": "2018-12-10T10:49:14Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
    },
    {
      "event": "reviewed",
      "id": 183137952,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MTgzMTM3OTUy",
      "url": null,
      "actor": null,
      "commit_id": "6019b2a8754c2a610a0355d904fb16c86dd91b5a",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "user": {
        "login": "AM5800",
        "id": 621585,
        "node_id": "MDQ6VXNlcjYyMTU4NQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/621585?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/AM5800",
        "html_url": "https://github.com/AM5800",
        "followers_url": "https://api.github.com/users/AM5800/followers",
        "following_url": "https://api.github.com/users/AM5800/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/AM5800/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/AM5800/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/AM5800/subscriptions",
        "organizations_url": "https://api.github.com/users/AM5800/orgs",
        "repos_url": "https://api.github.com/users/AM5800/repos",
        "events_url": "https://api.github.com/users/AM5800/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/AM5800/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#pullrequestreview-183137952",
      "submitted_at": "2018-12-10T11:20:09Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
    },
    {
      "event": "reviewed",
      "id": 185636386,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MTg1NjM2Mzg2",
      "url": null,
      "actor": null,
      "commit_id": "4ba0f8648bbe8bf159018d53c7761ce90cfcd0f1",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "ken2812221",
        "id": 11154118,
        "node_id": "MDQ6VXNlcjExMTU0MTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/11154118?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ken2812221",
        "html_url": "https://github.com/ken2812221",
        "followers_url": "https://api.github.com/users/ken2812221/followers",
        "following_url": "https://api.github.com/users/ken2812221/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ken2812221/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ken2812221/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ken2812221/subscriptions",
        "organizations_url": "https://api.github.com/users/ken2812221/orgs",
        "repos_url": "https://api.github.com/users/ken2812221/repos",
        "events_url": "https://api.github.com/users/ken2812221/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ken2812221/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#pullrequestreview-185636386",
      "submitted_at": "2018-12-17T15:11:24Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
    },
    {
      "event": "mentioned",
      "id": 2033188869,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjAzMzE4ODg2OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2033188869",
      "actor": {
        "login": "theuni",
        "id": 417043,
        "node_id": "MDQ6VXNlcjQxNzA0Mw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theuni",
        "html_url": "https://github.com/theuni",
        "followers_url": "https://api.github.com/users/theuni/followers",
        "following_url": "https://api.github.com/users/theuni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theuni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theuni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
        "organizations_url": "https://api.github.com/users/theuni/orgs",
        "repos_url": "https://api.github.com/users/theuni/repos",
        "events_url": "https://api.github.com/users/theuni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theuni/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-18T14:53:12Z"
    },
    {
      "event": "subscribed",
      "id": 2033188871,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDIwMzMxODg4NzE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2033188871",
      "actor": {
        "login": "theuni",
        "id": 417043,
        "node_id": "MDQ6VXNlcjQxNzA0Mw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theuni",
        "html_url": "https://github.com/theuni",
        "followers_url": "https://api.github.com/users/theuni/followers",
        "following_url": "https://api.github.com/users/theuni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theuni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theuni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
        "organizations_url": "https://api.github.com/users/theuni/orgs",
        "repos_url": "https://api.github.com/users/theuni/repos",
        "events_url": "https://api.github.com/users/theuni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theuni/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-18T14:53:12Z"
    },
    {
      "event": "mentioned",
      "id": 2033188874,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjAzMzE4ODg3NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2033188874",
      "actor": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-18T14:53:12Z"
    },
    {
      "event": "subscribed",
      "id": 2033188877,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDIwMzMxODg4Nzc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2033188877",
      "actor": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-18T14:53:12Z"
    },
    {
      "event": "reviewed",
      "id": 186101993,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MTg2MTAxOTkz",
      "url": null,
      "actor": null,
      "commit_id": "4ba0f8648bbe8bf159018d53c7761ce90cfcd0f1",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Concept ACK, this would be a nice improvement to make.\r\n\r\nHowever I think it would be better if we could move more, if not all, of this logic to `net_processing.cpp`.  I left some comments below explaining my thinking.",
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#pullrequestreview-186101993",
      "submitted_at": "2018-12-18T20:28:57Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
    },
    {
      "event": "reviewed",
      "id": 186714775,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MTg2NzE0Nzc1",
      "url": null,
      "actor": null,
      "commit_id": "4ba0f8648bbe8bf159018d53c7761ce90cfcd0f1",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#pullrequestreview-186714775",
      "submitted_at": "2018-12-19T19:37:53Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
    },
    {
      "event": "reviewed",
      "id": 189831223,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MTg5ODMxMjIz",
      "url": null,
      "actor": null,
      "commit_id": "4ba0f8648bbe8bf159018d53c7761ce90cfcd0f1",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "practicalswift",
        "id": 7826565,
        "node_id": "MDQ6VXNlcjc4MjY1NjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/practicalswift",
        "html_url": "https://github.com/practicalswift",
        "followers_url": "https://api.github.com/users/practicalswift/followers",
        "following_url": "https://api.github.com/users/practicalswift/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/practicalswift/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/practicalswift/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
        "organizations_url": "https://api.github.com/users/practicalswift/orgs",
        "repos_url": "https://api.github.com/users/practicalswift/repos",
        "events_url": "https://api.github.com/users/practicalswift/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/practicalswift/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#pullrequestreview-189831223",
      "submitted_at": "2019-01-07T14:33:40Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
    },
    {
      "event": "labeled",
      "id": 2071883979,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDIwNzE4ODM5Nzk=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2071883979",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-14T14:20:44Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2072888800,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjA3Mjg4ODgwMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2072888800",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-14T20:44:57Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2072939141,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjA3MjkzOTE0MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2072939141",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-14T21:08:20Z"
    },
    {
      "event": "commented",
      "id": 454167958,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NDE2Nzk1OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454167958",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-14T21:27:55Z",
      "updated_at": "2019-01-14T21:27:55Z",
      "author_association": "MEMBER",
      "body": "I've updated the implementation in a DoS-resistant way.\r\n\r\nWell, the new code is heavily based on the latest @sdaftuar work (mostly his implementation with my review and couple minor edits), but we decided to use this PR.",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-454167958",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "mentioned",
      "id": 2072981560,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjA3Mjk4MTU2MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2072981560",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-14T21:27:55Z"
    },
    {
      "event": "subscribed",
      "id": 2072981562,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDIwNzI5ODE1NjI=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2072981562",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-14T21:27:55Z"
    },
    {
      "event": "unlabeled",
      "id": 2073009857,
      "node_id": "MDE0OlVubGFiZWxlZEV2ZW50MjA3MzAwOTg1Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2073009857",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-14T21:41:15Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "added_to_project",
      "id": 2081119858,
      "node_id": "MDE5OkFkZGVkVG9Qcm9qZWN0RXZlbnQyMDgxMTE5ODU4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2081119858",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-17T19:04:36Z",
      "project_card": {
        "id": 16639949,
        "url": "https://api.github.com/projects/columns/cards/16639949",
        "project_id": 481835,
        "project_url": "https://api.github.com/projects/481835",
        "column_name": "Blockers"
      }
    },
    {
      "event": "commented",
      "id": 455683287,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NTY4MzI4Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/455683287",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-18T20:50:14Z",
      "updated_at": "2019-01-18T20:50:14Z",
      "author_association": "MEMBER",
      "body": "I think I might be missing something about when the code in `SendMessages()` runs. But how is this change randomizing which peer a transaction gets requested from?\r\n\r\nIt seems like the first request is scheduled based on inv time, and goes to the peer that announced first (with 1 second penalty for an incoming peer):\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/2f9abf746b3555ca8b47e8d0122bf4252396a7ff/src/net_processing.cpp#L669-L674\r\n\r\nAnd then subsequent requests all get scheduled at the same time based on the first request (again with penalty for incoming peers):\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/2f9abf746b3555ca8b47e8d0122bf4252396a7ff/src/net_processing.cpp#L3865-L3867\r\n\r\nSo the peer chosen will depend on the order of SendMessages() calls, which appears to be fixed, not random.\r\n\r\nVery possible I am missing something here, though.\r\n\r\nAs for the PR, I need to look more closely at the code, but in general it looks very good and the comments are great. It would be good to add a commit description and also credit Suhas if it's true this is \"heavily based\" on his work (https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-454167958). I think if you add a\r\n\r\n```\r\nCo-authored-by: Suhas Daftuar <sdaftuar@gmail.com>\r\n```\r\n\r\nline to the end of your commit message it will list him as a coauthor in github.\r\n\r\n\r\n\r\n\r\n",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-455683287",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "commented",
      "id": 455696095,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NTY5NjA5NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/455696095",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-18T21:39:09Z",
      "updated_at": "2019-01-19T00:58:35Z",
      "author_association": "MEMBER",
      "body": "@ryanofsky\r\n\r\nIt would not randomize for outbound peers, because the request would be sent right after processMessage for a given peer. We might add a delay to randomize this one too, but under current threat model (sybil attacks through outbound are very unlikely) I don't see a real reason.\r\n\r\nAnd yes, I should modify the github comment to credit Suhas, thanks for the idea.",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-455696095",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "mentioned",
      "id": 2083996979,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjA4Mzk5Njk3OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2083996979",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-18T21:39:09Z"
    },
    {
      "event": "subscribed",
      "id": 2083996980,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDIwODM5OTY5ODA=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2083996980",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-18T21:39:09Z"
    },
    {
      "event": "commented",
      "id": 455715211,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NTcxNTIxMQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/455715211",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-18T22:59:30Z",
      "updated_at": "2019-01-18T23:00:13Z",
      "author_association": "MEMBER",
      "body": "> It would not randomize for outbound peers, because the request would be sent right after processMessage for a given peer\r\n\r\nThis is only true for the first request, right? After the first request, assuming it timed out, all the outbound peers would be scheduled to make the next request at the same time (`last_request_time + MAX_GETDATA_TX_DELAY`), and since SendMessages() seems to be called on peers in a stable order, which peer requested first would be fixed. This seems to contradict the PR description which says \"This PR introduces bias toward outbound connections (they have higher priority when a node chooses from whom it should request a transaction) and randomizes the order.\" Maybe you just need to drop the part about randomizing the order.\r\n\r\nI think I also need to look into how `SendMessages()` is called. It seems like if it were called in a predictable way, like once a second on all peers in a fixed order, then this code would just keep resending the transaction request to the first outbound peer after the initial request timed out, and never try any different peers, because every peer would schedule their next request at the exact same time, and the same peer would always be called first to actually send the request.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-455715211",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "commented",
      "id": 455716192,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NTcxNjE5Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/455716192",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-18T23:05:01Z",
      "updated_at": "2019-01-18T23:05:01Z",
      "author_association": "MEMBER",
      "body": "@ryanofsky I would rather randomize it for outbound as well, since the point you're making seems correct and it's no good.\r\n\r\nIt is called in a fixed order. There is a chance of randomization due to non-uniform processing time per request, but this processing time is way less than 1 second, so the chance is very low.\r\n\r\nAfter talking to you, I think we should add PoissonNext() to both outbound and inbound delays (a new delay every time), because this would only make it stronger and won't bring any bad implications. What do you think?",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-455716192",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "mentioned",
      "id": 2084140749,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjA4NDE0MDc0OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2084140749",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-18T23:05:02Z"
    },
    {
      "event": "subscribed",
      "id": 2084140751,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDIwODQxNDA3NTE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2084140751",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-18T23:05:02Z"
    },
    {
      "event": "commented",
      "id": 455717682,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NTcxNzY4Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/455717682",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-18T23:13:21Z",
      "updated_at": "2019-01-18T23:13:21Z",
      "author_association": "MEMBER",
      "body": "Adding PoissonNext() seems like a reasonable way to randomize & rotate among peers, but I am far from an expert on this code and am just trying to understand it myself, so hopefully others will weigh in.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-455717682",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "commented",
      "id": 455719371,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NTcxOTM3MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/455719371",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-18T23:23:18Z",
      "updated_at": "2019-01-18T23:44:32Z",
      "author_association": "MEMBER",
      "body": "@ryanofsky Ah, I think I was confused for a while myself (Sorry for that), but see what actually happens.\r\n\r\nImagine scheduling a request for t=1 from peer A. Then, for A and other peers B, C we've heard the transaction from the next request time after the timeout will be t1=61. Then, m_tx_download.m_tx_process_time for peer A would not contain the tx anymore (it'd be in in_flight), and the choice between B and C will be random, because they're scheduled for the same time, and who knows which node's SendMessages will hit this timestamp first.\r\n\r\nWell, a bit not random, because Probability(B) > Probability(C) if the list is A B C D E F G H. But that's fine, because 1) outbound would be always prioritized; 2) An attacker cannot control this list.\r\n\r\nThus, I think we should not change anything (besides perhaps adding a little delay for outbound to not process right away, but that's not critical)",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-455719371",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "mentioned",
      "id": 2084162608,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjA4NDE2MjYwOA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2084162608",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-18T23:23:18Z"
    },
    {
      "event": "subscribed",
      "id": 2084162609,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDIwODQxNjI2MDk=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2084162609",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-18T23:23:18Z"
    },
    {
      "event": "commented",
      "id": 455728035,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NTcyODAzNQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/455728035",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-19T00:17:21Z",
      "updated_at": "2019-01-19T00:17:21Z",
      "author_association": "MEMBER",
      "body": "My concern isn't than an attacker will be able to choose an outbound peer. My concern is that if an outbound peer fails, the code might just keep trying to send requests to it without ever trying another peer. With:\r\n\r\n```c++\r\nvoid ThreadMessageHandler() {\r\n   for (pnode : vnodes) {\r\n      SendMessages(pnode);\r\n   }\r\n}\r\n```\r\n\r\nif there's a longer delay between `ThreadMessageHandler` calls than it take `ThreadMessageHandler` to execute, and if multiple nodes are scheduled to send a request at the same time, the earlier node in the list will usually be the one sending the request, unless I'm missing something.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-455728035",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "commented",
      "id": 455731279,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NTczMTI3OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/455731279",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-19T00:41:28Z",
      "updated_at": "2019-01-19T00:41:28Z",
      "author_association": "MEMBER",
      "body": "@ryanofsky no it won't, because it will be removed from the attacker's  ```state.m_tx_download.m_tx_process_time``` (it will be in attacker's ```state.m_tx_download.m_in_flight``` instead). And thus next time we will ask it from some other peer, which was never asked for that tx before.",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-455731279",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "mentioned",
      "id": 2084240908,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjA4NDI0MDkwOA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2084240908",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-19T00:41:28Z"
    },
    {
      "event": "subscribed",
      "id": 2084240909,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDIwODQyNDA5MDk=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2084240909",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-19T00:41:28Z"
    },
    {
      "event": "commented",
      "id": 455733185,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NTczMzE4NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/455733185",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-19T00:57:16Z",
      "updated_at": "2019-01-19T00:57:16Z",
      "author_association": "MEMBER",
      "body": "Makes sense. Thanks!",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-455733185",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "labeled",
      "id": 2087083380,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDIwODcwODMzODA=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2087083380",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-21T18:32:00Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2087170793,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjA4NzE3MDc5Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2087170793",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-21T19:27:48Z"
    },
    {
      "event": "unlabeled",
      "id": 2087183917,
      "node_id": "MDE0OlVubGFiZWxlZEV2ZW50MjA4NzE4MzkxNw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2087183917",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-21T19:36:04Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 195785987,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MTk1Nzg1OTg3",
      "url": null,
      "actor": null,
      "commit_id": "53ad7bedb4e6182acc8f087f92ab87b48184062b",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#pullrequestreview-195785987",
      "submitted_at": "2019-01-24T00:56:29Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
    },
    {
      "event": "commented",
      "id": 457318391,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NzMxODM5MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/457318391",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-24T19:08:12Z",
      "updated_at": "2019-01-24T19:08:12Z",
      "author_association": "MEMBER",
      "body": "Due to the fact that nodes are processed in order in CConnman::ThreadMessageHandler, with an up-to-100ms delay before running SendMessages, I believe it may be very likely that the first outgoing peer will get the inv first. Maybe when re-inserting invs in the queue for processing, add a small random delay (say in the order of a few seconds)?",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-457318391",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "commented",
      "id": 457802080,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NzgwMjA4MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/457802080",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-26T04:50:40Z",
      "updated_at": "2019-01-26T04:51:34Z",
      "author_association": "MEMBER",
      "body": "@sipa so in current version inbound peers get a penalty of 1 second. Without the randomization you suggest, creating sybil inbound connections to a target node is quite pointless.\r\n\r\nIf we add this PoissonNextSend(2) to every *non-first* (I believe it does not make sense for first) request, it would make sense to create sybil inbounds, hope that one of them roll zero and get a 1-second delay (from penalty), while one (or N/8) outbound get 2-seconds delay on average (and there are currently only 8 outbound not all of which would know the tx under attack).\r\n\r\nThus, there is a trade-off. I think it is safe enough when penalty >= delay, so I'll make both of them 1 second for now. I will leave a comment about it as well.",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-457802080",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "mentioned",
      "id": 2098688318,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjA5ODY4ODMxOA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2098688318",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-26T04:50:40Z"
    },
    {
      "event": "subscribed",
      "id": 2098688319,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDIwOTg2ODgzMTk=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2098688319",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-26T04:50:40Z"
    },
    {
      "event": "commented",
      "id": 457803340,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NzgwMzM0MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/457803340",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-26T05:17:50Z",
      "updated_at": "2019-01-26T05:17:50Z",
      "author_association": "MEMBER",
      "body": "@naumenkogs What about something like a uniform delay between 60 and 62 s for outbound, and between 62 and 64 s for inbound?",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-457803340",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "mentioned",
      "id": 2098695583,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjA5ODY5NTU4Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2098695583",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-26T05:17:50Z"
    },
    {
      "event": "subscribed",
      "id": 2098695584,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDIwOTg2OTU1ODQ=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2098695584",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-26T05:17:50Z"
    },
    {
      "event": "commented",
      "id": 457804217,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NzgwNDIxNw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/457804217",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-26T05:35:37Z",
      "updated_at": "2019-01-26T05:35:37Z",
      "author_association": "MEMBER",
      "body": "I've increased the delay to 2 seconds. We might've still used 1 second for first request to reduce the latency, but 1) I believe the issue pointed out above still applies for inbound even though it's much less likely 2) I think latency won't be affected significantly (I'd expect 5% extra delay or so)  3) code looks a bit cleaner this way",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-457804217",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "reviewed",
      "id": 197155484,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MTk3MTU1NDg0",
      "url": null,
      "actor": null,
      "commit_id": "fe01a6d9420d1bc4f1490b2ca9b776c3a4c9c38e",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "marcinja",
        "id": 12243734,
        "node_id": "MDQ6VXNlcjEyMjQzNzM0",
        "avatar_url": "https://avatars.githubusercontent.com/u/12243734?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/marcinja",
        "html_url": "https://github.com/marcinja",
        "followers_url": "https://api.github.com/users/marcinja/followers",
        "following_url": "https://api.github.com/users/marcinja/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/marcinja/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/marcinja/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/marcinja/subscriptions",
        "organizations_url": "https://api.github.com/users/marcinja/orgs",
        "repos_url": "https://api.github.com/users/marcinja/repos",
        "events_url": "https://api.github.com/users/marcinja/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/marcinja/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#pullrequestreview-197155484",
      "submitted_at": "2019-01-28T17:13:21Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
    },
    {
      "event": "reviewed",
      "id": 197736548,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MTk3NzM2NTQ4",
      "url": null,
      "actor": null,
      "commit_id": "be6a8a3c44acae5dc23aca67fd9f25ddc9d10f51",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Looks mostly good, will test.",
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#pullrequestreview-197736548",
      "submitted_at": "2019-01-29T19:34:00Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
    },
    {
      "event": "reviewed",
      "id": 197889380,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MTk3ODg5Mzgw",
      "url": null,
      "actor": null,
      "commit_id": "1c2dc6dfb6811987f752ca3abb3134395c468b93",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#pullrequestreview-197889380",
      "submitted_at": "2019-01-30T03:19:13Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
    },
    {
      "event": "commented",
      "id": 458987276,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ1ODk4NzI3Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/458987276",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-30T15:31:31Z",
      "updated_at": "2019-01-30T15:31:31Z",
      "author_association": "MEMBER",
      "body": "Tested and it works, though I'd like to see the changes I mentioned above.\r\n\r\nHere's a functional test that reviewers may be interested in that demonstrates the new behavior (this test fails on master):\r\n\r\n```\r\n#!/usr/bin/env python3\r\n# Copyright (c) 2019 The Bitcoin Core developers\r\n# Distributed under the MIT software license, see the accompanying\r\n# file COPYING or http://www.opensource.org/licenses/mit-license.php.\r\n\"\"\"Test transaction download behavior for resilience to InvBlock.\r\n\r\n- Create some bitcoind nodes that are connected to one another.\r\n- Create many mininode's to each bitcoind.\r\n- Randomly create a transaction on a bitcoind node:\r\n  * When a mininode hears of the transaction via an INV, send\r\n    announcements from all mininodes to all bitcoind nodes.\r\n  * Do not respond to any GETDATA requests.\r\n  * Verify that after 90 seconds all bitcoind nodes still have each\r\n    transaction.\r\n\r\n\"\"\"\r\n\r\nfrom test_framework.messages import msg_inv, CInv\r\nfrom test_framework.mininode import P2PInterface\r\nfrom test_framework.test_framework import BitcoinTestFramework\r\nfrom test_framework.util import sync_mempools\r\n\r\nclass TestP2PConn(P2PInterface):\r\n    def __init__(self):\r\n        super().__init__()\r\n        self.announced_tx = []\r\n\r\nclass TxDownloadTest(BitcoinTestFramework):\r\n    def set_test_params(self):\r\n        self.setup_clean_chain = True\r\n        self.num_nodes = 5\r\n\r\n    def test_inv_block(self):\r\n        # Pick a random bitcoind and generate a transaction\r\n        import random\r\n        node = random.choice(self.nodes)\r\n        txid = node.sendtoaddress(random.choice(self.nodes).getnewaddress(), 1)\r\n        self.log.info(\"---> Generated txid \" + txid)\r\n        txid = int(txid, 16)\r\n\r\n        # Announce the transaction to all peers\r\n        msg = msg_inv([CInv(t=1, h=txid)])\r\n        for p in self.peers:\r\n            p.send_message(msg)\r\n\r\n        sync_mempools(self.nodes, timeout=90)\r\n        self.log.info(\"---> Mempools synced\")\r\n\r\n    def run_test(self):\r\n        # Setup the p2p connections\r\n        NUM_INBOUND = 10\r\n        self.peers = []\r\n        for node in self.nodes:\r\n            node.generate(10)\r\n            self.sync_all()\r\n            for i in range(NUM_INBOUND):\r\n                 self.peers.append(node.add_p2p_connection(TestP2PConn()))\r\n\r\n        self.nodes[0].generate(100) # mature prior coinbases\r\n        self.sync_all()\r\n        self.log.info(\"Nodes are setup with balances\")\r\n\r\n        TRIALS = 2\r\n        for i in range(TRIALS):\r\n            self.log.info(\"InvBlockTest: trial %d\" % i)\r\n            self.test_inv_block()\r\n\r\nif __name__ == '__main__':\r\n    TxDownloadTest().main()\r\n```",
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-458987276",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "commented",
      "id": 458990298,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ1ODk5MDI5OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/458990298",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-30T15:39:18Z",
      "updated_at": "2019-01-30T15:39:18Z",
      "author_association": "MEMBER",
      "body": "Could the commits be squashed into a single one? It seems they are just fixups to the first one.",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-458990298",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "milestoned",
      "id": 2106977260,
      "node_id": "MDE1Ok1pbGVzdG9uZWRFdmVudDIxMDY5NzcyNjA=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2106977260",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-30T16:07:38Z",
      "milestone": {
        "title": "0.18.0"
      }
    },
    {
      "event": "mentioned",
      "id": 2106998058,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjEwNjk5ODA1OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2106998058",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-30T16:14:44Z"
    },
    {
      "event": "subscribed",
      "id": 2106998060,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDIxMDY5OTgwNjA=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2106998060",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-30T16:14:44Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2107047994,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjEwNzA0Nzk5NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2107047994",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-30T16:31:09Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2107060290,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjEwNzA2MDI5MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2107060290",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-30T16:35:10Z"
    },
    {
      "event": "reviewed",
      "id": 198189249,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MTk4MTg5MjQ5",
      "url": null,
      "actor": null,
      "commit_id": "1c2dc6dfb6811987f752ca3abb3134395c468b93",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "lightly-tested ACK cf36539a4d7a428e2120c1bc26cfba3216a48a69\r\n\r\nI did leave some nits that should probably be addressed however...",
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#pullrequestreview-198189249",
      "submitted_at": "2019-01-30T17:04:44Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2112486683,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjExMjQ4NjY4Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2112486683",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-02-01T15:33:47Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2112525688,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjExMjUyNTY4OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2112525688",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-02-01T15:48:11Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2112564019,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjExMjU2NDAxOQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2112564019",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-02-01T16:01:57Z"
    },
    {
      "event": "reviewed",
      "id": 199731895,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MTk5NzMxODk1",
      "url": null,
      "actor": null,
      "commit_id": "1442d29530c7245e8a9eca69b4ecdd474fcb38ff",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Concept ACK. The documentation is awesome and in general GETDATA(tx) logic is much easier to reason about after this changeset.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#pullrequestreview-199731895",
      "submitted_at": "2019-02-04T18:48:26Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
    },
    {
      "event": "commented",
      "id": 460394142,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MDM5NDE0Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/460394142",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-02-04T20:09:12Z",
      "updated_at": "2019-02-04T20:09:12Z",
      "author_association": "MEMBER",
      "body": "utACK modulo the unnecessary `ProcessMessage()` param.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-460394142",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2116738324,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjExNjczODMyNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2116738324",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-02-04T20:10:14Z"
    },
    {
      "event": "commented",
      "id": 460396485,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MDM5NjQ4NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/460396485",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-02-04T20:16:28Z",
      "updated_at": "2019-02-04T20:16:28Z",
      "author_association": "MEMBER",
      "body": "utACK https://github.com/bitcoin/bitcoin/commit/acf05329ca1bc36f8e89dcd7e1db956b6681262d\r\n\r\nIt'd be nice if someone packaged up @sdaftuar's functional test for a follow-up PR.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-460396485",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "mentioned",
      "id": 2116753384,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjExNjc1MzM4NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2116753384",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-02-04T20:16:28Z"
    },
    {
      "event": "subscribed",
      "id": 2116753385,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDIxMTY3NTMzODU=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2116753385",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-02-04T20:16:28Z"
    },
    {
      "event": "reviewed",
      "id": 199771603,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MTk5NzcxNjAz",
      "url": null,
      "actor": null,
      "commit_id": "1442d29530c7245e8a9eca69b4ecdd474fcb38ff",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "utACK, but looks like it needs rebasing on the logger changes in #15266.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#pullrequestreview-199771603",
      "submitted_at": "2019-02-04T22:24:02Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
    },
    {
      "event": "reviewed",
      "id": 199853098,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MTk5ODUzMDk4",
      "url": null,
      "actor": null,
      "commit_id": "acf05329ca1bc36f8e89dcd7e1db956b6681262d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Concept ACK acf05329ca\r\n\r\nI really like the refactoring that renames the variable names and adds documentation. That makes it a lot easier to understand the code (or at least less confusing).\r\n\r\nI will review and test later this week, but initial tests suggest that a remote can fill up the tx state without bounds. (I stopped my node when `m_tx_process_time.size()==1359900`)",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#pullrequestreview-199853098",
      "submitted_at": "2019-02-05T19:47:10Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2119989940,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjExOTk4OTk0MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2119989940",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-02-05T23:58:58Z"
    },
    {
      "event": "commented",
      "id": 461121519,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MTEyMTUxOQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/461121519",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-02-06T17:56:03Z",
      "updated_at": "2019-02-06T17:56:59Z",
      "author_association": "MEMBER",
      "body": "@naumenkogs  Unless you'd like to be credited as `User` in the release notes, you'll want to change the author name on your commit:\r\n```\r\nAuthor: User <...@gmail.com>\r\n```",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-461121519",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "mentioned",
      "id": 2121976649,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjEyMTk3NjY0OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2121976649",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-02-06T17:56:03Z"
    },
    {
      "event": "subscribed",
      "id": 2121976650,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDIxMjE5NzY2NTA=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2121976650",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-02-06T17:56:03Z"
    },
    {
      "event": "commented",
      "id": 461157405,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MTE1NzQwNQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/461157405",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-02-06T19:35:45Z",
      "updated_at": "2019-02-06T19:35:45Z",
      "author_association": "MEMBER",
      "body": "utACK 4282e1472d",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-461157405",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "commented",
      "id": 461234685,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MTIzNDY4NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/461234685",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-02-06T23:49:52Z",
      "updated_at": "2019-02-06T23:49:52Z",
      "author_association": "MEMBER",
      "body": "utACK 4282e1472d7798cb622a3918e6cd168ab49ff96e\r\n\r\nOne thing for future consideration: it seems to me that `filterInventoryKnown` and `m_tx_announced` have a partial overlapping function, which makes me wonder if they can be merged, or at least have inv announcement test both.\r\n\r\nYou may want to take @laanwj's comment into account about crediting of your commit.\r\n\r\n",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-461234685",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "mentioned",
      "id": 2122763896,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjEyMjc2Mzg5Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2122763896",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-02-06T23:49:52Z"
    },
    {
      "event": "subscribed",
      "id": 2122763899,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDIxMjI3NjM4OTk=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2122763899",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-02-06T23:49:52Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxY2ZmM2Q2Y2IwMTdhZWE4N2QxNmNiZGEwNzY4YmJhYjI1NmQxNmRh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "tree": {
        "sha": "8655b5b333b8050199464f4ad8034b46fe37c800",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8655b5b333b8050199464f4ad8034b46fe37c800"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5029e94f855c73bad2e0ea6dc0378f33787ae131",
          "sha": "5029e94f855c73bad2e0ea6dc0378f33787ae131",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5029e94f855c73bad2e0ea6dc0378f33787ae131"
        }
      ],
      "message": "Change in transaction pull scheduling to prevent InvBlock-related attacks\n\nCo-authored-by: Suhas Daftuar <sdaftuar@gmail.com>",
      "committer": {
        "name": "Gleb Naumenko",
        "email": "naumenko.gs@gmail.com",
        "date": "2019-02-07T04:25:27Z"
      },
      "author": {
        "name": "Gleb Naumenko",
        "email": "naumenko.gs@gmail.com",
        "date": "2019-02-07T04:25:27Z"
      },
      "sha": "1cff3d6cb017aea87d16cbda0768bbab256d16da"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2123069308,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjEyMzA2OTMwOA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2123069308",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-02-07T04:25:50Z"
    },
    {
      "event": "commented",
      "id": 461458762,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MTQ1ODc2Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/461458762",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-02-07T15:06:20Z",
      "updated_at": "2019-02-07T15:10:46Z",
      "author_association": "MEMBER",
      "body": "My last change is just to update author's name.",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-461458762",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "commented",
      "id": 461461555,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MTQ2MTU1NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/461461555",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-02-07T15:12:13Z",
      "updated_at": "2019-02-07T15:12:13Z",
      "author_association": "MEMBER",
      "body": "no-code-changes ACK 1cff3d6cb0",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-461461555",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "commented",
      "id": 461567530,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MTU2NzUzMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/461567530",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-02-07T19:39:09Z",
      "updated_at": "2019-02-07T19:39:09Z",
      "author_association": "MEMBER",
      "body": "no-code-changes ACK 1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#issuecomment-461567530",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14897"
    },
    {
      "event": "merged",
      "id": 2126179574,
      "node_id": "MDExOk1lcmdlZEV2ZW50MjEyNjE3OTU3NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2126179574",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "created_at": "2019-02-08T04:13:09Z"
    },
    {
      "event": "closed",
      "id": 2126179575,
      "node_id": "MDExOkNsb3NlZEV2ZW50MjEyNjE3OTU3NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2126179575",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-02-08T04:13:10Z"
    },
    {
      "event": "referenced",
      "id": 2126179774,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDIxMjYxNzk3NzQ=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2126179774",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "b9b26d9c3615d15669ae0a049c1dede39a9e59a9",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b9b26d9c3615d15669ae0a049c1dede39a9e59a9",
      "created_at": "2019-02-08T04:13:25Z"
    },
    {
      "event": "removed_from_project",
      "id": 2126270466,
      "node_id": "MDIzOlJlbW92ZWRGcm9tUHJvamVjdEV2ZW50MjEyNjI3MDQ2Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2126270466",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-02-08T05:53:28Z",
      "project_card": {
        "id": 16639949,
        "url": "https://api.github.com/projects/columns/cards/16639949",
        "project_id": 481835,
        "project_url": "https://api.github.com/projects/481835",
        "column_name": "Blockers"
      }
    },
    {
      "event": "reviewed",
      "id": 201248349,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjAxMjQ4MzQ5",
      "url": null,
      "actor": null,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#pullrequestreview-201248349",
      "submitted_at": "2019-02-11T15:07:09Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
    },
    {
      "event": "referenced",
      "id": 2153027327,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDIxNTMwMjczMjc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2153027327",
      "actor": {
        "login": "HashUnlimited",
        "id": 26601261,
        "node_id": "MDQ6VXNlcjI2NjAxMjYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/26601261?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/HashUnlimited",
        "html_url": "https://github.com/HashUnlimited",
        "followers_url": "https://api.github.com/users/HashUnlimited/followers",
        "following_url": "https://api.github.com/users/HashUnlimited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/HashUnlimited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/HashUnlimited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/HashUnlimited/subscriptions",
        "organizations_url": "https://api.github.com/users/HashUnlimited/orgs",
        "repos_url": "https://api.github.com/users/HashUnlimited/repos",
        "events_url": "https://api.github.com/users/HashUnlimited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/HashUnlimited/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "c119ba3c9b321a7f4418860741b3f69173e9c891",
      "commit_url": "https://api.github.com/repos/HashUnlimited/chaincoin/commits/c119ba3c9b321a7f4418860741b3f69173e9c891",
      "created_at": "2019-02-20T20:00:15Z"
    },
    {
      "event": "referenced",
      "id": 2286805536,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDIyODY4MDU1MzY=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2286805536",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "607b1b74986b7390836545889cc60cac5fedc175",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/607b1b74986b7390836545889cc60cac5fedc175",
      "created_at": "2019-04-18T20:11:42Z"
    },
    {
      "event": "referenced",
      "id": 2408007237,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDI0MDgwMDcyMzc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2408007237",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "f792395d13aa99ce51887db14e4f77a746d910e3",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f792395d13aa99ce51887db14e4f77a746d910e3",
      "created_at": "2019-06-12T16:37:14Z"
    },
    {
      "event": "referenced",
      "id": 2408457548,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDI0MDg0NTc1NDg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2408457548",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "0fe7564a41ddee584470c420b28a5377b63d3eae",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/0fe7564a41ddee584470c420b28a5377b63d3eae",
      "created_at": "2019-06-12T19:20:09Z"
    },
    {
      "event": "referenced",
      "id": 2415984218,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDI0MTU5ODQyMTg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2415984218",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "f3855781fdc52382b7ccfd0060623fa8ab1541b5",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f3855781fdc52382b7ccfd0060623fa8ab1541b5",
      "created_at": "2019-06-16T16:49:27Z"
    },
    {
      "event": "referenced",
      "id": 2862055304,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDI4NjIwNTUzMDQ=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2862055304",
      "actor": {
        "login": "jasonbcox",
        "id": 602513,
        "node_id": "MDQ6VXNlcjYwMjUxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/602513?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jasonbcox",
        "html_url": "https://github.com/jasonbcox",
        "followers_url": "https://api.github.com/users/jasonbcox/followers",
        "following_url": "https://api.github.com/users/jasonbcox/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jasonbcox/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jasonbcox/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jasonbcox/subscriptions",
        "organizations_url": "https://api.github.com/users/jasonbcox/orgs",
        "repos_url": "https://api.github.com/users/jasonbcox/repos",
        "events_url": "https://api.github.com/users/jasonbcox/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jasonbcox/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "8d1a1da709dcad31f35f502ac43aa8d49512bea1",
      "commit_url": "https://api.github.com/repos/Bitcoin-ABC/bitcoin-abc/commits/8d1a1da709dcad31f35f502ac43aa8d49512bea1",
      "created_at": "2019-12-06T16:46:27Z"
    },
    {
      "event": "referenced",
      "id": 3208219677,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDMyMDgyMTk2Nzc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3208219677",
      "actor": {
        "login": "codablock",
        "id": 1884269,
        "node_id": "MDQ6VXNlcjE4ODQyNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1884269?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/codablock",
        "html_url": "https://github.com/codablock",
        "followers_url": "https://api.github.com/users/codablock/followers",
        "following_url": "https://api.github.com/users/codablock/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/codablock/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/codablock/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/codablock/subscriptions",
        "organizations_url": "https://api.github.com/users/codablock/orgs",
        "repos_url": "https://api.github.com/users/codablock/repos",
        "events_url": "https://api.github.com/users/codablock/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/codablock/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "8c0ff34ccd3572405e68c9f92b75e66d86d0f6de",
      "commit_url": "https://api.github.com/repos/codablock/dash/commits/8c0ff34ccd3572405e68c9f92b75e66d86d0f6de",
      "created_at": "2020-04-07T05:15:30Z"
    },
    {
      "event": "referenced",
      "id": 3208219686,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDMyMDgyMTk2ODY=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3208219686",
      "actor": {
        "login": "codablock",
        "id": 1884269,
        "node_id": "MDQ6VXNlcjE4ODQyNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1884269?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/codablock",
        "html_url": "https://github.com/codablock",
        "followers_url": "https://api.github.com/users/codablock/followers",
        "following_url": "https://api.github.com/users/codablock/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/codablock/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/codablock/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/codablock/subscriptions",
        "organizations_url": "https://api.github.com/users/codablock/orgs",
        "repos_url": "https://api.github.com/users/codablock/repos",
        "events_url": "https://api.github.com/users/codablock/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/codablock/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "74eabc23e54a1329b6c0231b8ea0e3df583ed4f8",
      "commit_url": "https://api.github.com/repos/codablock/dash/commits/74eabc23e54a1329b6c0231b8ea0e3df583ed4f8",
      "created_at": "2020-04-07T05:15:30Z"
    },
    {
      "event": "referenced",
      "id": 3216047635,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDMyMTYwNDc2MzU=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3216047635",
      "actor": {
        "login": "codablock",
        "id": 1884269,
        "node_id": "MDQ6VXNlcjE4ODQyNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1884269?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/codablock",
        "html_url": "https://github.com/codablock",
        "followers_url": "https://api.github.com/users/codablock/followers",
        "following_url": "https://api.github.com/users/codablock/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/codablock/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/codablock/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/codablock/subscriptions",
        "organizations_url": "https://api.github.com/users/codablock/orgs",
        "repos_url": "https://api.github.com/users/codablock/repos",
        "events_url": "https://api.github.com/users/codablock/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/codablock/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "26dec64e79e896a790ebb070d5d9b28adfbf21ed",
      "commit_url": "https://api.github.com/repos/dashpay/dash/commits/26dec64e79e896a790ebb070d5d9b28adfbf21ed",
      "created_at": "2020-04-08T22:12:48Z"
    },
    {
      "event": "referenced",
      "id": 3820974967,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDM4MjA5NzQ5Njc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3820974967",
      "actor": {
        "login": "jonspock",
        "id": 25382027,
        "node_id": "MDQ6VXNlcjI1MzgyMDI3",
        "avatar_url": "https://avatars.githubusercontent.com/u/25382027?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonspock",
        "html_url": "https://github.com/jonspock",
        "followers_url": "https://api.github.com/users/jonspock/followers",
        "following_url": "https://api.github.com/users/jonspock/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonspock/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonspock/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonspock/subscriptions",
        "organizations_url": "https://api.github.com/users/jonspock/orgs",
        "repos_url": "https://api.github.com/users/jonspock/repos",
        "events_url": "https://api.github.com/users/jonspock/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonspock/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "95f5bd81c61d0ae69a4bb47796e5e861b2697354",
      "commit_url": "https://api.github.com/repos/jonspock/devault/commits/95f5bd81c61d0ae69a4bb47796e5e861b2697354",
      "created_at": "2020-09-29T17:59:13Z"
    },
    {
      "event": "referenced",
      "id": 3821507584,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDM4MjE1MDc1ODQ=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3821507584",
      "actor": {
        "login": "jonspock",
        "id": 25382027,
        "node_id": "MDQ6VXNlcjI1MzgyMDI3",
        "avatar_url": "https://avatars.githubusercontent.com/u/25382027?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonspock",
        "html_url": "https://github.com/jonspock",
        "followers_url": "https://api.github.com/users/jonspock/followers",
        "following_url": "https://api.github.com/users/jonspock/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonspock/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonspock/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonspock/subscriptions",
        "organizations_url": "https://api.github.com/users/jonspock/orgs",
        "repos_url": "https://api.github.com/users/jonspock/repos",
        "events_url": "https://api.github.com/users/jonspock/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonspock/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "5b47d328466a6959876a5791117197e6406ab38f",
      "commit_url": "https://api.github.com/repos/jonspock/devault/commits/5b47d328466a6959876a5791117197e6406ab38f",
      "created_at": "2020-09-29T20:16:38Z"
    },
    {
      "event": "referenced",
      "id": 3862992230,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDM4NjI5OTIyMzA=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3862992230",
      "actor": {
        "login": "jonspock",
        "id": 25382027,
        "node_id": "MDQ6VXNlcjI1MzgyMDI3",
        "avatar_url": "https://avatars.githubusercontent.com/u/25382027?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonspock",
        "html_url": "https://github.com/jonspock",
        "followers_url": "https://api.github.com/users/jonspock/followers",
        "following_url": "https://api.github.com/users/jonspock/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonspock/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonspock/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonspock/subscriptions",
        "organizations_url": "https://api.github.com/users/jonspock/orgs",
        "repos_url": "https://api.github.com/users/jonspock/repos",
        "events_url": "https://api.github.com/users/jonspock/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonspock/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "3dfd6536408f5b4ce2ece783201ab55969cdd8d6",
      "commit_url": "https://api.github.com/repos/devaultcrypto/devault/commits/3dfd6536408f5b4ce2ece783201ab55969cdd8d6",
      "created_at": "2020-10-10T18:13:03Z"
    },
    {
      "event": "referenced",
      "id": 4148760918,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDQxNDg3NjA5MTg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4148760918",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "762cbd287f63035dc8f814b998c0b1af2e497820",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/762cbd287f63035dc8f814b998c0b1af2e497820",
      "created_at": "2020-12-25T08:44:46Z"
    },
    {
      "event": "referenced",
      "id": 4149219598,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDQxNDkyMTk1OTg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4149219598",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "68c18bc1da4c4df40d7bef3a90446f2f50f8c464",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/68c18bc1da4c4df40d7bef3a90446f2f50f8c464",
      "created_at": "2020-12-25T19:57:52Z"
    },
    {
      "event": "referenced",
      "id": 4149820039,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDQxNDk4MjAwMzk=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4149820039",
      "actor": {
        "login": "mjdietzx",
        "id": 7217256,
        "node_id": "MDQ6VXNlcjcyMTcyNTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7217256?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mjdietzx",
        "html_url": "https://github.com/mjdietzx",
        "followers_url": "https://api.github.com/users/mjdietzx/followers",
        "following_url": "https://api.github.com/users/mjdietzx/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mjdietzx/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mjdietzx/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mjdietzx/subscriptions",
        "organizations_url": "https://api.github.com/users/mjdietzx/orgs",
        "repos_url": "https://api.github.com/users/mjdietzx/repos",
        "events_url": "https://api.github.com/users/mjdietzx/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mjdietzx/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "32ae4b427fe21ca4d5c8fd6d1d340bef17103026",
      "commit_url": "https://api.github.com/repos/mjdietzx/bitcoin/commits/32ae4b427fe21ca4d5c8fd6d1d340bef17103026",
      "created_at": "2020-12-26T20:21:26Z"
    },
    {
      "event": "referenced",
      "id": 4517982303,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDQ1MTc5ODIzMDM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4517982303",
      "actor": {
        "login": "ckti",
        "id": 7046769,
        "node_id": "MDQ6VXNlcjcwNDY3Njk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7046769?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ckti",
        "html_url": "https://github.com/ckti",
        "followers_url": "https://api.github.com/users/ckti/followers",
        "following_url": "https://api.github.com/users/ckti/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ckti/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ckti/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ckti/subscriptions",
        "organizations_url": "https://api.github.com/users/ckti/orgs",
        "repos_url": "https://api.github.com/users/ckti/repos",
        "events_url": "https://api.github.com/users/ckti/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ckti/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "675f3ed517a9ede1484989fe4da9744f10450560",
      "commit_url": "https://api.github.com/repos/ckti-ioncore-current/ion/commits/675f3ed517a9ede1484989fe4da9744f10450560",
      "created_at": "2021-03-28T10:03:20Z"
    },
    {
      "event": "referenced",
      "id": 4517982305,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDQ1MTc5ODIzMDU=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4517982305",
      "actor": {
        "login": "ckti",
        "id": 7046769,
        "node_id": "MDQ6VXNlcjcwNDY3Njk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7046769?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ckti",
        "html_url": "https://github.com/ckti",
        "followers_url": "https://api.github.com/users/ckti/followers",
        "following_url": "https://api.github.com/users/ckti/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ckti/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ckti/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ckti/subscriptions",
        "organizations_url": "https://api.github.com/users/ckti/orgs",
        "repos_url": "https://api.github.com/users/ckti/repos",
        "events_url": "https://api.github.com/users/ckti/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ckti/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "0333b9cdda0557b0edd8f9e8543e955c07d484e4",
      "commit_url": "https://api.github.com/repos/ckti-ioncore-current/ion/commits/0333b9cdda0557b0edd8f9e8543e955c07d484e4",
      "created_at": "2021-03-28T10:03:20Z"
    },
    {
      "event": "mentioned",
      "id": 4710624401,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDcxMDYyNDQwMQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4710624401",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-05-09T11:18:57Z"
    },
    {
      "event": "subscribed",
      "id": 4710624404,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ3MTA2MjQ0MDQ=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4710624404",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-05-09T11:18:57Z"
    },
    {
      "event": "referenced",
      "id": 4944328649,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDQ5NDQzMjg2NDk=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4944328649",
      "actor": {
        "login": "PastaPastaPasta",
        "id": 6443210,
        "node_id": "MDQ6VXNlcjY0NDMyMTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6443210?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/PastaPastaPasta",
        "html_url": "https://github.com/PastaPastaPasta",
        "followers_url": "https://api.github.com/users/PastaPastaPasta/followers",
        "following_url": "https://api.github.com/users/PastaPastaPasta/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/PastaPastaPasta/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/PastaPastaPasta/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/PastaPastaPasta/subscriptions",
        "organizations_url": "https://api.github.com/users/PastaPastaPasta/orgs",
        "repos_url": "https://api.github.com/users/PastaPastaPasta/repos",
        "events_url": "https://api.github.com/users/PastaPastaPasta/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/PastaPastaPasta/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "ca2a4305743b74e59a50e389cc8ea28f21eecbcd",
      "commit_url": "https://api.github.com/repos/PastaPastaPasta/dash/commits/ca2a4305743b74e59a50e389cc8ea28f21eecbcd",
      "created_at": "2021-06-27T21:17:58Z"
    },
    {
      "event": "referenced",
      "id": 4944491938,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDQ5NDQ0OTE5Mzg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4944491938",
      "actor": {
        "login": "PastaPastaPasta",
        "id": 6443210,
        "node_id": "MDQ6VXNlcjY0NDMyMTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6443210?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/PastaPastaPasta",
        "html_url": "https://github.com/PastaPastaPasta",
        "followers_url": "https://api.github.com/users/PastaPastaPasta/followers",
        "following_url": "https://api.github.com/users/PastaPastaPasta/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/PastaPastaPasta/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/PastaPastaPasta/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/PastaPastaPasta/subscriptions",
        "organizations_url": "https://api.github.com/users/PastaPastaPasta/orgs",
        "repos_url": "https://api.github.com/users/PastaPastaPasta/repos",
        "events_url": "https://api.github.com/users/PastaPastaPasta/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/PastaPastaPasta/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "23776b4c5336f385ce7cc2ea2d4ab7e33cc9dc76",
      "commit_url": "https://api.github.com/repos/PastaPastaPasta/dash/commits/23776b4c5336f385ce7cc2ea2d4ab7e33cc9dc76",
      "created_at": "2021-06-28T00:24:53Z"
    },
    {
      "event": "referenced",
      "id": 4950405931,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDQ5NTA0MDU5MzE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4950405931",
      "actor": {
        "login": "PastaPastaPasta",
        "id": 6443210,
        "node_id": "MDQ6VXNlcjY0NDMyMTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6443210?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/PastaPastaPasta",
        "html_url": "https://github.com/PastaPastaPasta",
        "followers_url": "https://api.github.com/users/PastaPastaPasta/followers",
        "following_url": "https://api.github.com/users/PastaPastaPasta/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/PastaPastaPasta/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/PastaPastaPasta/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/PastaPastaPasta/subscriptions",
        "organizations_url": "https://api.github.com/users/PastaPastaPasta/orgs",
        "repos_url": "https://api.github.com/users/PastaPastaPasta/repos",
        "events_url": "https://api.github.com/users/PastaPastaPasta/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/PastaPastaPasta/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "fb5de1fdc94314bb7f71da49434cd10fb1dfc319",
      "commit_url": "https://api.github.com/repos/PastaPastaPasta/dash/commits/fb5de1fdc94314bb7f71da49434cd10fb1dfc319",
      "created_at": "2021-06-29T00:06:28Z"
    },
    {
      "event": "referenced",
      "id": 4968414923,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDQ5Njg0MTQ5MjM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4968414923",
      "actor": {
        "login": "PastaPastaPasta",
        "id": 6443210,
        "node_id": "MDQ6VXNlcjY0NDMyMTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6443210?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/PastaPastaPasta",
        "html_url": "https://github.com/PastaPastaPasta",
        "followers_url": "https://api.github.com/users/PastaPastaPasta/followers",
        "following_url": "https://api.github.com/users/PastaPastaPasta/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/PastaPastaPasta/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/PastaPastaPasta/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/PastaPastaPasta/subscriptions",
        "organizations_url": "https://api.github.com/users/PastaPastaPasta/orgs",
        "repos_url": "https://api.github.com/users/PastaPastaPasta/repos",
        "events_url": "https://api.github.com/users/PastaPastaPasta/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/PastaPastaPasta/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "4a516525d2ffd614fe6c9d02d261a7028f9ef048",
      "commit_url": "https://api.github.com/repos/PastaPastaPasta/dash/commits/4a516525d2ffd614fe6c9d02d261a7028f9ef048",
      "created_at": "2021-07-01T22:04:34Z"
    },
    {
      "event": "referenced",
      "id": 4968437183,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDQ5Njg0MzcxODM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4968437183",
      "actor": {
        "login": "PastaPastaPasta",
        "id": 6443210,
        "node_id": "MDQ6VXNlcjY0NDMyMTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6443210?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/PastaPastaPasta",
        "html_url": "https://github.com/PastaPastaPasta",
        "followers_url": "https://api.github.com/users/PastaPastaPasta/followers",
        "following_url": "https://api.github.com/users/PastaPastaPasta/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/PastaPastaPasta/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/PastaPastaPasta/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/PastaPastaPasta/subscriptions",
        "organizations_url": "https://api.github.com/users/PastaPastaPasta/orgs",
        "repos_url": "https://api.github.com/users/PastaPastaPasta/repos",
        "events_url": "https://api.github.com/users/PastaPastaPasta/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/PastaPastaPasta/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "a00d0c25d78c19f58a904c6a215f2786e6acad66",
      "commit_url": "https://api.github.com/repos/PastaPastaPasta/dash/commits/a00d0c25d78c19f58a904c6a215f2786e6acad66",
      "created_at": "2021-07-01T22:11:26Z"
    },
    {
      "event": "referenced",
      "id": 5027710437,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDUwMjc3MTA0Mzc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5027710437",
      "actor": {
        "login": "PastaPastaPasta",
        "id": 6443210,
        "node_id": "MDQ6VXNlcjY0NDMyMTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6443210?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/PastaPastaPasta",
        "html_url": "https://github.com/PastaPastaPasta",
        "followers_url": "https://api.github.com/users/PastaPastaPasta/followers",
        "following_url": "https://api.github.com/users/PastaPastaPasta/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/PastaPastaPasta/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/PastaPastaPasta/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/PastaPastaPasta/subscriptions",
        "organizations_url": "https://api.github.com/users/PastaPastaPasta/orgs",
        "repos_url": "https://api.github.com/users/PastaPastaPasta/repos",
        "events_url": "https://api.github.com/users/PastaPastaPasta/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/PastaPastaPasta/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "4028ce8e8b475987218ba7fc902ffa421f0e0e49",
      "commit_url": "https://api.github.com/repos/PastaPastaPasta/dash/commits/4028ce8e8b475987218ba7fc902ffa421f0e0e49",
      "created_at": "2021-07-15T20:55:55Z"
    },
    {
      "event": "referenced",
      "id": 5027719718,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDUwMjc3MTk3MTg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5027719718",
      "actor": {
        "login": "PastaPastaPasta",
        "id": 6443210,
        "node_id": "MDQ6VXNlcjY0NDMyMTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6443210?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/PastaPastaPasta",
        "html_url": "https://github.com/PastaPastaPasta",
        "followers_url": "https://api.github.com/users/PastaPastaPasta/followers",
        "following_url": "https://api.github.com/users/PastaPastaPasta/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/PastaPastaPasta/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/PastaPastaPasta/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/PastaPastaPasta/subscriptions",
        "organizations_url": "https://api.github.com/users/PastaPastaPasta/orgs",
        "repos_url": "https://api.github.com/users/PastaPastaPasta/repos",
        "events_url": "https://api.github.com/users/PastaPastaPasta/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/PastaPastaPasta/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "4bb9abf42232445521cec1e0ed981da0b362ff74",
      "commit_url": "https://api.github.com/repos/PastaPastaPasta/dash/commits/4bb9abf42232445521cec1e0ed981da0b362ff74",
      "created_at": "2021-07-15T20:58:24Z"
    },
    {
      "event": "referenced",
      "id": 5321350268,
      "node_id": "REFE_lADOABII584XLeMdzwAAAAE9LVx8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5321350268",
      "actor": {
        "login": "PastaPastaPasta",
        "id": 6443210,
        "node_id": "MDQ6VXNlcjY0NDMyMTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6443210?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/PastaPastaPasta",
        "html_url": "https://github.com/PastaPastaPasta",
        "followers_url": "https://api.github.com/users/PastaPastaPasta/followers",
        "following_url": "https://api.github.com/users/PastaPastaPasta/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/PastaPastaPasta/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/PastaPastaPasta/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/PastaPastaPasta/subscriptions",
        "organizations_url": "https://api.github.com/users/PastaPastaPasta/orgs",
        "repos_url": "https://api.github.com/users/PastaPastaPasta/repos",
        "events_url": "https://api.github.com/users/PastaPastaPasta/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/PastaPastaPasta/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "1177bc94fcef39c32c7fa25e92600031142ae878",
      "commit_url": "https://api.github.com/repos/PastaPastaPasta/dash/commits/1177bc94fcef39c32c7fa25e92600031142ae878",
      "created_at": "2021-09-17T20:02:24Z"
    },
    {
      "event": "referenced",
      "id": 6106863459,
      "node_id": "REFE_lADOABII584XLeMdzwAAAAFr_1dj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6106863459",
      "actor": {
        "login": "gades",
        "id": 4200730,
        "node_id": "MDQ6VXNlcjQyMDA3MzA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4200730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gades",
        "html_url": "https://github.com/gades",
        "followers_url": "https://api.github.com/users/gades/followers",
        "following_url": "https://api.github.com/users/gades/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gades/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gades/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gades/subscriptions",
        "organizations_url": "https://api.github.com/users/gades/orgs",
        "repos_url": "https://api.github.com/users/gades/repos",
        "events_url": "https://api.github.com/users/gades/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gades/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "1e3af95174429df5a1197bb42c2960df05ae3d47",
      "commit_url": "https://api.github.com/repos/cosanta/cosanta-core/commits/1e3af95174429df5a1197bb42c2960df05ae3d47",
      "created_at": "2022-02-20T07:20:45Z"
    },
    {
      "event": "referenced",
      "id": 6106863461,
      "node_id": "REFE_lADOABII584XLeMdzwAAAAFr_1dl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6106863461",
      "actor": {
        "login": "gades",
        "id": 4200730,
        "node_id": "MDQ6VXNlcjQyMDA3MzA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4200730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gades",
        "html_url": "https://github.com/gades",
        "followers_url": "https://api.github.com/users/gades/followers",
        "following_url": "https://api.github.com/users/gades/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gades/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gades/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gades/subscriptions",
        "organizations_url": "https://api.github.com/users/gades/orgs",
        "repos_url": "https://api.github.com/users/gades/repos",
        "events_url": "https://api.github.com/users/gades/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gades/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "2faa55b02fcab9421392a9d5ac675eec87411721",
      "commit_url": "https://api.github.com/repos/cosanta/cosanta-core/commits/2faa55b02fcab9421392a9d5ac675eec87411721",
      "created_at": "2022-02-20T07:20:45Z"
    },
    {
      "event": "locked",
      "id": 7199131505,
      "node_id": "LOE_lADOABII584XLeMdzwAAAAGtGgdx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7199131505",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-16T17:22:08Z",
      "lock_reason": "resolved"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240058192",
      "pull_request_review_id": 182999927,
      "id": 240058192,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MDA1ODE5Mg==",
      "diff_hunk": "@@ -2786,38 +2803,29 @@ CNode::~CNode()\n     CloseSocket(hSocket);\n }\n \n-void CNode::AskFor(const CInv& inv)\n+void CNode::AddToAskSet(const CInv& inv)\n {\n-    if (mapAskFor.size() > MAPASKFOR_MAX_SZ || setAskFor.size() > SETASKFOR_MAX_SZ)\n+    if (ask_set.size() > ASKSET_MAX_SZ)\n         return;\n     // a peer may not have multiple non-responded queue positions for a single inv item\n-    if (!setAskFor.insert(inv.hash).second)\n+    if (!ask_set.insert(inv).second)\n         return;\n \n-    // We're using mapAskFor as a priority queue,\n-    // the key is the earliest time the request can be sent\n-    int64_t nRequestTime;\n-    limitedmap<uint256, int64_t>::const_iterator it = mapAlreadyAskedFor.find(inv.hash);\n-    if (it != mapAlreadyAskedFor.end())\n-        nRequestTime = it->second;\n-    else\n-        nRequestTime = 0;\n-    LogPrint(BCLog::NET, \"askfor %s  %d (%s) peer=%d\\n\", inv.ToString(), nRequestTime, FormatISO8601Time(nRequestTime/1000000), id);\n-\n     // Make sure not to reuse time indexes to keep things in the same order\n     int64_t nNow = GetTimeMicros() - 1000000;\n     static int64_t nLastTime;\n     ++nLastTime;\n     nNow = std::max(nNow, nLastTime);\n     nLastTime = nNow;\n \n-    // Each retry is 2 minutes after the last\n-    nRequestTime = std::max(nRequestTime + 2 * 60 * 1000000, nNow);\n-    if (it != mapAlreadyAskedFor.end())\n-        mapAlreadyAskedFor.update(it, nRequestTime);\n-    else\n-        mapAlreadyAskedFor.insert(std::make_pair(inv.hash, nRequestTime));\n-    mapAskFor.insert(std::make_pair(nRequestTime, inv));\n+    tx_to_ask.insert(std::make_pair(inv.hash, nNow));\n+\n+    int priority = rand() % OUTBOUND_ASK_PRIORITY;",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 74,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "6019b2a8754c2a610a0355d904fb16c86dd91b5a",
      "in_reply_to_id": null,
      "user": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Maybe use the internal random functions here (`GetRand()`)?",
      "created_at": "2018-12-09T23:05:49Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r240058192",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240058192"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2823,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240135053",
      "pull_request_review_id": 183092381,
      "id": 240135053,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MDEzNTA1Mw==",
      "diff_hunk": "@@ -2786,38 +2803,29 @@ CNode::~CNode()\n     CloseSocket(hSocket);\n }\n \n-void CNode::AskFor(const CInv& inv)\n+void CNode::AddToAskSet(const CInv& inv)\n {\n-    if (mapAskFor.size() > MAPASKFOR_MAX_SZ || setAskFor.size() > SETASKFOR_MAX_SZ)\n+    if (ask_set.size() > ASKSET_MAX_SZ)\n         return;\n     // a peer may not have multiple non-responded queue positions for a single inv item\n-    if (!setAskFor.insert(inv.hash).second)\n+    if (!ask_set.insert(inv).second)\n         return;\n \n-    // We're using mapAskFor as a priority queue,\n-    // the key is the earliest time the request can be sent\n-    int64_t nRequestTime;\n-    limitedmap<uint256, int64_t>::const_iterator it = mapAlreadyAskedFor.find(inv.hash);\n-    if (it != mapAlreadyAskedFor.end())\n-        nRequestTime = it->second;\n-    else\n-        nRequestTime = 0;\n-    LogPrint(BCLog::NET, \"askfor %s  %d (%s) peer=%d\\n\", inv.ToString(), nRequestTime, FormatISO8601Time(nRequestTime/1000000), id);\n-\n     // Make sure not to reuse time indexes to keep things in the same order\n     int64_t nNow = GetTimeMicros() - 1000000;\n     static int64_t nLastTime;\n     ++nLastTime;\n     nNow = std::max(nNow, nLastTime);\n     nLastTime = nNow;\n \n-    // Each retry is 2 minutes after the last\n-    nRequestTime = std::max(nRequestTime + 2 * 60 * 1000000, nNow);\n-    if (it != mapAlreadyAskedFor.end())\n-        mapAlreadyAskedFor.update(it, nRequestTime);\n-    else\n-        mapAlreadyAskedFor.insert(std::make_pair(inv.hash, nRequestTime));\n-    mapAskFor.insert(std::make_pair(nRequestTime, inv));\n+    tx_to_ask.insert(std::make_pair(inv.hash, nNow));\n+\n+    int priority = rand() % OUTBOUND_ASK_PRIORITY;",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 74,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "6019b2a8754c2a610a0355d904fb16c86dd91b5a",
      "in_reply_to_id": 240058192,
      "user": {
        "login": "AM5800",
        "id": 621585,
        "node_id": "MDQ6VXNlcjYyMTU4NQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/621585?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/AM5800",
        "html_url": "https://github.com/AM5800",
        "followers_url": "https://api.github.com/users/AM5800/followers",
        "following_url": "https://api.github.com/users/AM5800/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/AM5800/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/AM5800/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/AM5800/subscriptions",
        "organizations_url": "https://api.github.com/users/AM5800/orgs",
        "repos_url": "https://api.github.com/users/AM5800/repos",
        "events_url": "https://api.github.com/users/AM5800/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/AM5800/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Using something like `randrange` would be even better",
      "created_at": "2018-12-10T09:28:17Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r240135053",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240135053"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2823,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240135562",
      "pull_request_review_id": 183093021,
      "id": 240135562,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MDEzNTU2Mg==",
      "diff_hunk": "@@ -88,6 +88,11 @@ static const size_t DEFAULT_MAXSENDBUFFER    = 1 * 1000;\n // NOTE: When adjusting this, update rpcnet:setban's help (\"24h\")\n static const unsigned int DEFAULT_MISBEHAVING_BANTIME = 60 * 60 * 24;  // Default 24-hour ban\n \n+// time between GETDATA requests to different peers\n+static const int64_t TX_TIMEOUT = 60 * 1000000;",
      "path": "src/net.h",
      "position": null,
      "original_position": 14,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "6019b2a8754c2a610a0355d904fb16c86dd91b5a",
      "in_reply_to_id": null,
      "user": {
        "login": "AM5800",
        "id": 621585,
        "node_id": "MDQ6VXNlcjYyMTU4NQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/621585?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/AM5800",
        "html_url": "https://github.com/AM5800",
        "followers_url": "https://api.github.com/users/AM5800/followers",
        "following_url": "https://api.github.com/users/AM5800/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/AM5800/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/AM5800/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/AM5800/subscriptions",
        "organizations_url": "https://api.github.com/users/AM5800/orgs",
        "repos_url": "https://api.github.com/users/AM5800/repos",
        "events_url": "https://api.github.com/users/AM5800/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/AM5800/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think this name is way too generic. Maybe `GETDATA_TIMEOUT`?",
      "created_at": "2018-12-10T09:29:44Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r240135562",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240135562"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 92,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240159098",
      "pull_request_review_id": 183121612,
      "id": 240159098,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MDE1OTA5OA==",
      "diff_hunk": "@@ -2065,6 +2066,22 @@ void CConnman::ThreadMessageHandler()\n             if (flagInterruptMsgProc)\n                 return;\n         }\n+        int64_t nNow = GetTimeMicros();\n+        for (std::map<uint256, int64_t>::const_iterator tx = tx_to_ask.begin(); tx != tx_to_ask.end(); ++tx) {\n+            if (tx->second > nNow)\n+                continue;\n+\n+            std::multimap<int, std::pair<CNode*, CInv>> peersToAskTx = tx_to_ask_from.find(tx->first)->second;\n+            std::multimap<int, std::pair<CNode*, CInv>>::iterator peerToAsk = peersToAskTx.begin();\n+            if (peerToAsk != peersToAskTx.end()) {\n+                peerToAsk->second.first->scheduled_asks.insert(peerToAsk->second.second);",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 22,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "6019b2a8754c2a610a0355d904fb16c86dd91b5a",
      "in_reply_to_id": null,
      "user": {
        "login": "AM5800",
        "id": 621585,
        "node_id": "MDQ6VXNlcjYyMTU4NQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/621585?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/AM5800",
        "html_url": "https://github.com/AM5800",
        "followers_url": "https://api.github.com/users/AM5800/followers",
        "following_url": "https://api.github.com/users/AM5800/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/AM5800/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/AM5800/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/AM5800/subscriptions",
        "organizations_url": "https://api.github.com/users/AM5800/orgs",
        "repos_url": "https://api.github.com/users/AM5800/repos",
        "events_url": "https://api.github.com/users/AM5800/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/AM5800/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I find this block and especially this line barely readable. All those `peerToAsk->second.first`...\r\nMaybe you can at least consider extracting some variables and giving them proper names?\r\n\r\nFor example `tx->first` is `tx_hash`. \r\n`tx-second` is a `timeout` and so on.",
      "created_at": "2018-12-10T10:36:59Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r240159098",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240159098"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2077,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240163117",
      "pull_request_review_id": 183126588,
      "id": 240163117,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MDE2MzExNw==",
      "diff_hunk": "@@ -86,7 +86,8 @@ std::map<CNetAddr, LocalServiceInfo> mapLocalHost GUARDED_BY(cs_mapLocalHost);\n static bool vfLimited[NET_MAX] GUARDED_BY(cs_mapLocalHost) = {};\n std::string strSubVersion;\n \n-limitedmap<uint256, int64_t> mapAlreadyAskedFor(MAX_INV_SZ);\n+limitedmap<uint256, int64_t> tx_to_ask(MAX_INV_SZ);\n+std::map<uint256, std::multimap<int, std::pair<CNode*, CInv>>> tx_to_ask_from;",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "6019b2a8754c2a610a0355d904fb16c86dd91b5a",
      "in_reply_to_id": null,
      "user": {
        "login": "AM5800",
        "id": 621585,
        "node_id": "MDQ6VXNlcjYyMTU4NQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/621585?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/AM5800",
        "html_url": "https://github.com/AM5800",
        "followers_url": "https://api.github.com/users/AM5800/followers",
        "following_url": "https://api.github.com/users/AM5800/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/AM5800/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/AM5800/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/AM5800/subscriptions",
        "organizations_url": "https://api.github.com/users/AM5800/orgs",
        "repos_url": "https://api.github.com/users/AM5800/repos",
        "events_url": "https://api.github.com/users/AM5800/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/AM5800/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Can this `CNode*` pointer dangle?",
      "created_at": "2018-12-10T10:49:14Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r240163117",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240163117"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 90,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240166538",
      "pull_request_review_id": 183130907,
      "id": 240166538,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MDE2NjUzOA==",
      "diff_hunk": "@@ -88,6 +88,11 @@ static const size_t DEFAULT_MAXSENDBUFFER    = 1 * 1000;\n // NOTE: When adjusting this, update rpcnet:setban's help (\"24h\")\n static const unsigned int DEFAULT_MISBEHAVING_BANTIME = 60 * 60 * 24;  // Default 24-hour ban\n \n+// time between GETDATA requests to different peers\n+static const int64_t TX_TIMEOUT = 60 * 1000000;",
      "path": "src/net.h",
      "position": null,
      "original_position": 14,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "6019b2a8754c2a610a0355d904fb16c86dd91b5a",
      "in_reply_to_id": 240135562,
      "user": {
        "login": "AM5800",
        "id": 621585,
        "node_id": "MDQ6VXNlcjYyMTU4NQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/621585?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/AM5800",
        "html_url": "https://github.com/AM5800",
        "followers_url": "https://api.github.com/users/AM5800/followers",
        "following_url": "https://api.github.com/users/AM5800/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/AM5800/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/AM5800/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/AM5800/subscriptions",
        "organizations_url": "https://api.github.com/users/AM5800/orgs",
        "repos_url": "https://api.github.com/users/AM5800/repos",
        "events_url": "https://api.github.com/users/AM5800/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/AM5800/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Besides, neither comment nor the variable name mention unit. I guess those are microseconds, but still...",
      "created_at": "2018-12-10T11:00:09Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r240166538",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240166538"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 92,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240172301",
      "pull_request_review_id": 183137952,
      "id": 240172301,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MDE3MjMwMQ==",
      "diff_hunk": "@@ -2786,38 +2803,29 @@ CNode::~CNode()\n     CloseSocket(hSocket);\n }\n \n-void CNode::AskFor(const CInv& inv)\n+void CNode::AddToAskSet(const CInv& inv)\n {\n-    if (mapAskFor.size() > MAPASKFOR_MAX_SZ || setAskFor.size() > SETASKFOR_MAX_SZ)\n+    if (ask_set.size() > ASKSET_MAX_SZ)\n         return;\n     // a peer may not have multiple non-responded queue positions for a single inv item\n-    if (!setAskFor.insert(inv.hash).second)\n+    if (!ask_set.insert(inv).second)\n         return;\n \n-    // We're using mapAskFor as a priority queue,\n-    // the key is the earliest time the request can be sent\n-    int64_t nRequestTime;\n-    limitedmap<uint256, int64_t>::const_iterator it = mapAlreadyAskedFor.find(inv.hash);\n-    if (it != mapAlreadyAskedFor.end())\n-        nRequestTime = it->second;\n-    else\n-        nRequestTime = 0;\n-    LogPrint(BCLog::NET, \"askfor %s  %d (%s) peer=%d\\n\", inv.ToString(), nRequestTime, FormatISO8601Time(nRequestTime/1000000), id);\n-\n     // Make sure not to reuse time indexes to keep things in the same order\n     int64_t nNow = GetTimeMicros() - 1000000;\n     static int64_t nLastTime;\n     ++nLastTime;\n     nNow = std::max(nNow, nLastTime);\n     nLastTime = nNow;\n \n-    // Each retry is 2 minutes after the last\n-    nRequestTime = std::max(nRequestTime + 2 * 60 * 1000000, nNow);\n-    if (it != mapAlreadyAskedFor.end())\n-        mapAlreadyAskedFor.update(it, nRequestTime);\n-    else\n-        mapAlreadyAskedFor.insert(std::make_pair(inv.hash, nRequestTime));\n-    mapAskFor.insert(std::make_pair(nRequestTime, inv));\n+    tx_to_ask.insert(std::make_pair(inv.hash, nNow));\n+\n+    int priority = rand() % OUTBOUND_ASK_PRIORITY;\n+    if (!fInbound) {\n+        priority += OUTBOUND_ASK_PRIORITY;",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 76,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "6019b2a8754c2a610a0355d904fb16c86dd91b5a",
      "in_reply_to_id": null,
      "user": {
        "login": "AM5800",
        "id": 621585,
        "node_id": "MDQ6VXNlcjYyMTU4NQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/621585?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/AM5800",
        "html_url": "https://github.com/AM5800",
        "followers_url": "https://api.github.com/users/AM5800/followers",
        "following_url": "https://api.github.com/users/AM5800/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/AM5800/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/AM5800/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/AM5800/subscriptions",
        "organizations_url": "https://api.github.com/users/AM5800/orgs",
        "repos_url": "https://api.github.com/users/AM5800/repos",
        "events_url": "https://api.github.com/users/AM5800/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/AM5800/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I am a bit confused: \r\nSo here if a node is inbound - it's priority is bound by OUTBOUND_ASK_PRIORITY,\r\nand if it is outbound - you add OUTBOUND_ASK_PRIORITY one more time.\r\n\r\nSo outbound nodes will have higher priority value, right? \r\n\r\nBut then in \r\n`std::multimap<int, std::pair<CNode*, CInv>>::iterator peerToAsk = peersToAskTx.begin();`\r\nYou take the node with lowest priority?",
      "created_at": "2018-12-10T11:20:08Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r240172301",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240172301"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2825,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240287543",
      "pull_request_review_id": 183282656,
      "id": 240287543,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MDI4NzU0Mw==",
      "diff_hunk": "@@ -2786,38 +2803,29 @@ CNode::~CNode()\n     CloseSocket(hSocket);\n }\n \n-void CNode::AskFor(const CInv& inv)\n+void CNode::AddToAskSet(const CInv& inv)\n {\n-    if (mapAskFor.size() > MAPASKFOR_MAX_SZ || setAskFor.size() > SETASKFOR_MAX_SZ)\n+    if (ask_set.size() > ASKSET_MAX_SZ)\n         return;\n     // a peer may not have multiple non-responded queue positions for a single inv item\n-    if (!setAskFor.insert(inv.hash).second)\n+    if (!ask_set.insert(inv).second)\n         return;\n \n-    // We're using mapAskFor as a priority queue,\n-    // the key is the earliest time the request can be sent\n-    int64_t nRequestTime;\n-    limitedmap<uint256, int64_t>::const_iterator it = mapAlreadyAskedFor.find(inv.hash);\n-    if (it != mapAlreadyAskedFor.end())\n-        nRequestTime = it->second;\n-    else\n-        nRequestTime = 0;\n-    LogPrint(BCLog::NET, \"askfor %s  %d (%s) peer=%d\\n\", inv.ToString(), nRequestTime, FormatISO8601Time(nRequestTime/1000000), id);\n-\n     // Make sure not to reuse time indexes to keep things in the same order\n     int64_t nNow = GetTimeMicros() - 1000000;\n     static int64_t nLastTime;\n     ++nLastTime;\n     nNow = std::max(nNow, nLastTime);\n     nLastTime = nNow;\n \n-    // Each retry is 2 minutes after the last\n-    nRequestTime = std::max(nRequestTime + 2 * 60 * 1000000, nNow);\n-    if (it != mapAlreadyAskedFor.end())\n-        mapAlreadyAskedFor.update(it, nRequestTime);\n-    else\n-        mapAlreadyAskedFor.insert(std::make_pair(inv.hash, nRequestTime));\n-    mapAskFor.insert(std::make_pair(nRequestTime, inv));\n+    tx_to_ask.insert(std::make_pair(inv.hash, nNow));\n+\n+    int priority = rand() % OUTBOUND_ASK_PRIORITY;\n+    if (!fInbound) {\n+        priority += OUTBOUND_ASK_PRIORITY;",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 76,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "6019b2a8754c2a610a0355d904fb16c86dd91b5a",
      "in_reply_to_id": 240172301,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "oops. You are right.",
      "created_at": "2018-12-10T16:41:19Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r240287543",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240287543"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2825,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240316792",
      "pull_request_review_id": 183319213,
      "id": 240316792,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MDMxNjc5Mg==",
      "diff_hunk": "@@ -86,7 +86,8 @@ std::map<CNetAddr, LocalServiceInfo> mapLocalHost GUARDED_BY(cs_mapLocalHost);\n static bool vfLimited[NET_MAX] GUARDED_BY(cs_mapLocalHost) = {};\n std::string strSubVersion;\n \n-limitedmap<uint256, int64_t> mapAlreadyAskedFor(MAX_INV_SZ);\n+limitedmap<uint256, int64_t> tx_to_ask(MAX_INV_SZ);\n+std::map<uint256, std::multimap<int, std::pair<CNode*, CInv>>> tx_to_ask_from;",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "6019b2a8754c2a610a0355d904fb16c86dd91b5a",
      "in_reply_to_id": 240163117,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It seems CNode constructor is deleted, and using a pointer is widely used across the codebase. What exactly would you suggest?",
      "created_at": "2018-12-10T17:58:56Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r240316792",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240316792"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 90,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240343501",
      "pull_request_review_id": 183352609,
      "id": 240343501,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MDM0MzUwMQ==",
      "diff_hunk": "@@ -86,7 +86,8 @@ std::map<CNetAddr, LocalServiceInfo> mapLocalHost GUARDED_BY(cs_mapLocalHost);\n static bool vfLimited[NET_MAX] GUARDED_BY(cs_mapLocalHost) = {};\n std::string strSubVersion;\n \n-limitedmap<uint256, int64_t> mapAlreadyAskedFor(MAX_INV_SZ);\n+limitedmap<uint256, int64_t> tx_to_ask(MAX_INV_SZ);\n+std::map<uint256, std::multimap<int, std::pair<CNode*, CInv>>> tx_to_ask_from;",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "6019b2a8754c2a610a0355d904fb16c86dd91b5a",
      "in_reply_to_id": 240163117,
      "user": {
        "login": "AM5800",
        "id": 621585,
        "node_id": "MDQ6VXNlcjYyMTU4NQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/621585?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/AM5800",
        "html_url": "https://github.com/AM5800",
        "followers_url": "https://api.github.com/users/AM5800/followers",
        "following_url": "https://api.github.com/users/AM5800/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/AM5800/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/AM5800/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/AM5800/subscriptions",
        "organizations_url": "https://api.github.com/users/AM5800/orgs",
        "repos_url": "https://api.github.com/users/AM5800/repos",
        "events_url": "https://api.github.com/users/AM5800/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/AM5800/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I asked because I wasn't able to figure out if this is a problem during my initial review: \r\nif we put some node to this map and this node disconnects after. What will happen?\r\n\r\nRight now I can't check it. Will look tomorrow more thoroughly. \r\nI also have a solution in case pointers can dangle - you can use `NodeId`. And then when you need actual pointer to `CNode` query it from `CConnman`.\r\n\r\nBTW, thanks for extracted variables. It is much better now!\r\n\r\n\r\n",
      "created_at": "2018-12-10T19:14:58Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r240343501",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240343501"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 90,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240366097",
      "pull_request_review_id": 183380983,
      "id": 240366097,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MDM2NjA5Nw==",
      "diff_hunk": "@@ -86,7 +86,8 @@ std::map<CNetAddr, LocalServiceInfo> mapLocalHost GUARDED_BY(cs_mapLocalHost);\n static bool vfLimited[NET_MAX] GUARDED_BY(cs_mapLocalHost) = {};\n std::string strSubVersion;\n \n-limitedmap<uint256, int64_t> mapAlreadyAskedFor(MAX_INV_SZ);\n+limitedmap<uint256, int64_t> tx_to_ask(MAX_INV_SZ);\n+std::map<uint256, std::multimap<int, std::pair<CNode*, CInv>>> tx_to_ask_from;",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "6019b2a8754c2a610a0355d904fb16c86dd91b5a",
      "in_reply_to_id": 240163117,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "That's indeed a good idea.",
      "created_at": "2018-12-10T20:21:45Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r240366097",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240366097"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 90,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242184732",
      "pull_request_review_id": 185636386,
      "id": 242184732,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MjE4NDczMg==",
      "diff_hunk": "@@ -2065,6 +2066,35 @@ void CConnman::ThreadMessageHandler()\n             if (flagInterruptMsgProc)\n                 return;\n         }\n+        int64_t nNow = GetTimeMicros();\n+        for (std::map<uint256, int64_t>::const_iterator tx = tx_to_ask.begin(); tx != tx_to_ask.end(); ++tx) {\n+            int64_t next_ask_time = tx->second;\n+            if (next_ask_time > nNow)\n+                continue;\n+\n+            uint256 tx_hash = tx->first;\n+            std::multimap<int, std::pair<CNode*, CInv>> peers_to_ask_tx = tx_to_ask_from.find(tx_hash)->second;\n+            std::multimap<int, std::pair<CNode*, CInv>>::iterator peer_to_ask = peers_to_ask_tx.begin();\n+            // Make sure that queried peer is not disconnected\n+            CNode* peer;",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 24,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "4ba0f8648bbe8bf159018d53c7761ce90cfcd0f1",
      "in_reply_to_id": null,
      "user": {
        "login": "ken2812221",
        "id": 11154118,
        "node_id": "MDQ6VXNlcjExMTU0MTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/11154118?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ken2812221",
        "html_url": "https://github.com/ken2812221",
        "followers_url": "https://api.github.com/users/ken2812221/followers",
        "following_url": "https://api.github.com/users/ken2812221/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ken2812221/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ken2812221/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ken2812221/subscriptions",
        "organizations_url": "https://api.github.com/users/ken2812221/orgs",
        "repos_url": "https://api.github.com/users/ken2812221/repos",
        "events_url": "https://api.github.com/users/ken2812221/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ken2812221/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think you should initialize this with nullptr.",
      "created_at": "2018-12-17T15:11:24Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r242184732",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242184732"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2079,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242565737",
      "pull_request_review_id": 186101993,
      "id": 242565737,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MjU2NTczNw==",
      "diff_hunk": "@@ -86,7 +86,8 @@ std::map<CNetAddr, LocalServiceInfo> mapLocalHost GUARDED_BY(cs_mapLocalHost);\n static bool vfLimited[NET_MAX] GUARDED_BY(cs_mapLocalHost) = {};\n std::string strSubVersion;\n \n-limitedmap<uint256, int64_t> mapAlreadyAskedFor(MAX_INV_SZ);\n+limitedmap<uint256, int64_t> tx_to_ask(MAX_INV_SZ);\n+std::map<uint256, std::multimap<int, std::pair<CNode*, CInv>>> tx_to_ask_from;",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "4ba0f8648bbe8bf159018d53c7761ce90cfcd0f1",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This comment was marked resolved but I think the review comment still hasn't been addressed -- I think it'd be better to store a `NodeId` rather than a `CNode *` inside this structure, to avoid concerns around the locking of CNode's and potentially dereferencing a deleted object.\r\n\r\nAlso could you add a comment explaining what is being stored in this map?",
      "created_at": "2018-12-18T14:49:10Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r242565737",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242565737"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 90,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242567478",
      "pull_request_review_id": 186101993,
      "id": 242567478,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MjU2NzQ3OA==",
      "diff_hunk": "@@ -2065,6 +2066,35 @@ void CConnman::ThreadMessageHandler()\n             if (flagInterruptMsgProc)\n                 return;\n         }\n+        int64_t nNow = GetTimeMicros();",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "4ba0f8648bbe8bf159018d53c7761ce90cfcd0f1",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "All the code added in this chunk strikes me as logic that belongs in the `SendMessages()` function in `net_processing.cpp`, rather than in the message handling thread.\r\n\r\nThe split between what we do in `net.cpp` and what we do in `net_processing.cpp` isn't crystal clear, but my general sense is that we try to do application level behaviors in `net_processing.cpp`, and generic/low-level network logic in `net.cpp`.  When there's spillover between the two (such as when we need to store data in a `CNode` that feels like it belongs in `CNodeState` but for some reason it's tricky to do), then the split tends to be that `net.cpp` just handles the data storage, while the logic that uses it is in `net_processing.cpp`.\r\n\r\nSo adding logic directly to `ThreadMessageHandler` makes me vaguely uncomfortable -- the locking around CNode's can be tricky to get right, and so doing application-level things in here feels like the wrong design.\r\n\r\nI actually wonder if we could move all this transaction request logic (including the per-peer and per-txid storage) to be in `net_processing.cpp`, and do this all with `CNodeState`, rather than have inv storage kept in `CNode`?  If that's achievable, I think that would be a win overall.\r\n\r\n@TheBlueMatt or @theuni -- care to agree/disagree with what I wrote?\r\n",
      "created_at": "2018-12-18T14:53:12Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r242567478",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242567478"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2069,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242572079",
      "pull_request_review_id": 186101993,
      "id": 242572079,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MjU3MjA3OQ==",
      "diff_hunk": "@@ -2786,38 +2816,31 @@ CNode::~CNode()\n     CloseSocket(hSocket);\n }\n \n-void CNode::AskFor(const CInv& inv)\n+void CNode::AddToAskSet(const CInv& inv)\n {\n-    if (mapAskFor.size() > MAPASKFOR_MAX_SZ || setAskFor.size() > SETASKFOR_MAX_SZ)\n+    if (ask_set.size() > ASKSET_MAX_SZ)\n         return;\n     // a peer may not have multiple non-responded queue positions for a single inv item\n-    if (!setAskFor.insert(inv.hash).second)\n+    if (!ask_set.insert(inv).second)\n         return;\n \n-    // We're using mapAskFor as a priority queue,\n-    // the key is the earliest time the request can be sent\n-    int64_t nRequestTime;\n-    limitedmap<uint256, int64_t>::const_iterator it = mapAlreadyAskedFor.find(inv.hash);\n-    if (it != mapAlreadyAskedFor.end())\n-        nRequestTime = it->second;\n-    else\n-        nRequestTime = 0;\n-    LogPrint(BCLog::NET, \"askfor %s  %d (%s) peer=%d\\n\", inv.ToString(), nRequestTime, FormatISO8601Time(nRequestTime/1000000), id);\n-\n     // Make sure not to reuse time indexes to keep things in the same order\n     int64_t nNow = GetTimeMicros() - 1000000;\n     static int64_t nLastTime;\n     ++nLastTime;\n     nNow = std::max(nNow, nLastTime);\n     nLastTime = nNow;\n \n-    // Each retry is 2 minutes after the last\n-    nRequestTime = std::max(nRequestTime + 2 * 60 * 1000000, nNow);\n-    if (it != mapAlreadyAskedFor.end())\n-        mapAlreadyAskedFor.update(it, nRequestTime);\n-    else\n-        mapAlreadyAskedFor.insert(std::make_pair(inv.hash, nRequestTime));\n-    mapAskFor.insert(std::make_pair(nRequestTime, inv));\n+    tx_to_ask.insert(std::make_pair(inv.hash, nNow));\n+\n+    // Peers with lower priority are queried earlier\n+    int priority = GetRandInt(OUTBOUND_ASK_MAX_INFERIORITY - 1);\n+    if (fInbound) {\n+        priority += OUTBOUND_ASK_MAX_INFERIORITY;\n+    }\n+\n+    tx_to_ask_from[inv.hash].insert(std::make_pair(priority, std::make_pair(this, inv)));\n+    AddRef();",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 94,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "4ba0f8648bbe8bf159018d53c7761ce90cfcd0f1",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Storing a `CNode *` and doing an `AddRef` seems risky to me -- I think it's better to store a NodeId and do a lookup to see if the peer is still around.  Otherwise, it's possible for a CNode object to live on even after a peer has disconnected, potentially for a long time?  And in general reasoning about the lifetime of these objects is already a little tricky, so I think we should avoid adding more complexity to it.",
      "created_at": "2018-12-18T15:04:12Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r242572079",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242572079"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2843,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242578580",
      "pull_request_review_id": 186101993,
      "id": 242578580,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MjU3ODU4MA==",
      "diff_hunk": "@@ -2786,38 +2816,31 @@ CNode::~CNode()\n     CloseSocket(hSocket);\n }\n \n-void CNode::AskFor(const CInv& inv)\n+void CNode::AddToAskSet(const CInv& inv)\n {\n-    if (mapAskFor.size() > MAPASKFOR_MAX_SZ || setAskFor.size() > SETASKFOR_MAX_SZ)\n+    if (ask_set.size() > ASKSET_MAX_SZ)\n         return;\n     // a peer may not have multiple non-responded queue positions for a single inv item\n-    if (!setAskFor.insert(inv.hash).second)\n+    if (!ask_set.insert(inv).second)\n         return;\n \n-    // We're using mapAskFor as a priority queue,\n-    // the key is the earliest time the request can be sent\n-    int64_t nRequestTime;\n-    limitedmap<uint256, int64_t>::const_iterator it = mapAlreadyAskedFor.find(inv.hash);\n-    if (it != mapAlreadyAskedFor.end())\n-        nRequestTime = it->second;\n-    else\n-        nRequestTime = 0;\n-    LogPrint(BCLog::NET, \"askfor %s  %d (%s) peer=%d\\n\", inv.ToString(), nRequestTime, FormatISO8601Time(nRequestTime/1000000), id);\n-\n     // Make sure not to reuse time indexes to keep things in the same order\n     int64_t nNow = GetTimeMicros() - 1000000;\n     static int64_t nLastTime;\n     ++nLastTime;\n     nNow = std::max(nNow, nLastTime);\n     nLastTime = nNow;\n \n-    // Each retry is 2 minutes after the last\n-    nRequestTime = std::max(nRequestTime + 2 * 60 * 1000000, nNow);\n-    if (it != mapAlreadyAskedFor.end())\n-        mapAlreadyAskedFor.update(it, nRequestTime);\n-    else\n-        mapAlreadyAskedFor.insert(std::make_pair(inv.hash, nRequestTime));\n-    mapAskFor.insert(std::make_pair(nRequestTime, inv));\n+    tx_to_ask.insert(std::make_pair(inv.hash, nNow));",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 85,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "4ba0f8648bbe8bf159018d53c7761ce90cfcd0f1",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I was wondering if we should bake in a delay if we receive a new transaction for the first time from an inbound peer?  It seems like if we want to give some window for an outbound peer to jump the queue before we make a getdata request to an inbound peer, then we might as well make that window more explicit, rather than leave it to the timing of the message handling thread.",
      "created_at": "2018-12-18T15:19:55Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r242578580",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242578580"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2834,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242686938",
      "pull_request_review_id": 186101993,
      "id": 242686938,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MjY4NjkzOA==",
      "diff_hunk": "@@ -2210,8 +2210,10 @@ bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStr\n         bool fMissingInputs = false;\n         CValidationState state;\n \n-        pfrom->setAskFor.erase(inv.hash);\n-        mapAlreadyAskedFor.erase(inv.hash);\n+        pfrom->ask_set.erase(inv);\n+        tx_to_ask.erase(inv.hash);\n+        tx_to_ask_from.erase(inv.hash);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 17,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "4ba0f8648bbe8bf159018d53c7761ce90cfcd0f1",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Erasing from `tx_to_ask_from` would mean that we will forget all the other peers who have announced this transaction to us as well, and not be able to request it anymore?  I think we shouldn't do that until after the transaction has been accepted to our mempool (or maybe is in our orphan map).  Otherwise an adversary could blind us to a segwit transaction by announcing a tx first, waiting a reasonable amount of time for other peers to announce, and then delivering a malleated version.",
      "created_at": "2018-12-18T20:06:17Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r242686938",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242686938"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2215,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242691483",
      "pull_request_review_id": 186101993,
      "id": 242691483,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MjY5MTQ4Mw==",
      "diff_hunk": "@@ -69,7 +69,7 @@ static const bool DEFAULT_UPNP = false;\n /** The maximum number of entries in mapAskFor */\n static const size_t MAPASKFOR_MAX_SZ = MAX_INV_SZ;\n /** The maximum number of entries in setAskFor (larger due to getdata latency)*/\n-static const size_t SETASKFOR_MAX_SZ = 2 * MAX_INV_SZ;\n+static const size_t ASKSET_MAX_SZ = 2 * MAX_INV_SZ;",
      "path": "src/net.h",
      "position": null,
      "original_position": 5,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "4ba0f8648bbe8bf159018d53c7761ce90cfcd0f1",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The comment above this line should be updated for the new variable name.",
      "created_at": "2018-12-18T20:20:28Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r242691483",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242691483"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 72,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242692171",
      "pull_request_review_id": 186101993,
      "id": 242692171,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MjY5MjE3MQ==",
      "diff_hunk": "@@ -2065,6 +2066,35 @@ void CConnman::ThreadMessageHandler()\n             if (flagInterruptMsgProc)\n                 return;\n         }\n+        int64_t nNow = GetTimeMicros();\n+        for (std::map<uint256, int64_t>::const_iterator tx = tx_to_ask.begin(); tx != tx_to_ask.end(); ++tx) {\n+            int64_t next_ask_time = tx->second;\n+            if (next_ask_time > nNow)\n+                continue;\n+\n+            uint256 tx_hash = tx->first;\n+            std::multimap<int, std::pair<CNode*, CInv>> peers_to_ask_tx = tx_to_ask_from.find(tx_hash)->second;",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 21,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "4ba0f8648bbe8bf159018d53c7761ce90cfcd0f1",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Do we need to make this `std::multimap<...>& peers_to_ask_tx` to avoid a copy?",
      "created_at": "2018-12-18T20:22:54Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r242692171",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242692171"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2076,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242693563",
      "pull_request_review_id": 186101993,
      "id": 242693563,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MjY5MzU2Mw==",
      "diff_hunk": "@@ -536,7 +541,13 @@ extern bool fDiscover;\n extern bool fListen;\n extern bool fRelayTxes;\n \n-extern limitedmap<uint256, int64_t> mapAlreadyAskedFor;\n+// keeps track of all received INVs for which TX not received",
      "path": "src/net.h",
      "position": null,
      "original_position": 26,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "4ba0f8648bbe8bf159018d53c7761ce90cfcd0f1",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Perhaps update this comment to explain what is in this map exactly?  I think it's txid -> next request time in micros?",
      "created_at": "2018-12-18T20:27:31Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r242693563",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242693563"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 544,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242693745",
      "pull_request_review_id": 186101993,
      "id": 242693745,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MjY5Mzc0NQ==",
      "diff_hunk": "@@ -536,7 +541,13 @@ extern bool fDiscover;\n extern bool fListen;\n extern bool fRelayTxes;\n \n-extern limitedmap<uint256, int64_t> mapAlreadyAskedFor;\n+// keeps track of all received INVs for which TX not received\n+extern limitedmap<uint256, int64_t> tx_to_ask;\n+\n+// peers are ordered randomly with a bias towards outbound\n+// need CInv inside to distinguish segwit",
      "path": "src/net.h",
      "position": null,
      "original_position": 30,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "4ba0f8648bbe8bf159018d53c7761ce90cfcd0f1",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Also here, would be nice to have the comment explain exactly what the fields in the map are.",
      "created_at": "2018-12-18T20:28:07Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r242693745",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/242693745"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 548,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/243020650",
      "pull_request_review_id": 186679424,
      "id": 243020650,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MzAyMDY1MA==",
      "diff_hunk": "@@ -2065,6 +2066,35 @@ void CConnman::ThreadMessageHandler()\n             if (flagInterruptMsgProc)\n                 return;\n         }\n+        int64_t nNow = GetTimeMicros();",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "4ba0f8648bbe8bf159018d53c7761ce90cfcd0f1",
      "in_reply_to_id": 242567478,
      "user": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yes, that stuff has no business being in net, its only currently there for historical reasons, if there's an opportunity to move it to net_processing, we should.",
      "created_at": "2018-12-19T18:10:47Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r243020650",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/243020650"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2069,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/243048621",
      "pull_request_review_id": 186714775,
      "id": 243048621,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MzA0ODYyMQ==",
      "diff_hunk": "@@ -86,7 +86,8 @@ std::map<CNetAddr, LocalServiceInfo> mapLocalHost GUARDED_BY(cs_mapLocalHost);\n static bool vfLimited[NET_MAX] GUARDED_BY(cs_mapLocalHost) = {};\n std::string strSubVersion;\n \n-limitedmap<uint256, int64_t> mapAlreadyAskedFor(MAX_INV_SZ);\n+limitedmap<uint256, int64_t> tx_to_ask(MAX_INV_SZ);",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "4ba0f8648bbe8bf159018d53c7761ce90cfcd0f1",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "If an adversary were to blast us with huge INV messages, then I think they could take over this data structure, and blind us to all other transactions -- once a txid leaves `tx_to_ask` I think we'll never request it?\r\n\r\nAlso, I think this is one way that `tx_to_ask` and `tx_to_ask_from` could get out of sync which looks like it would cause a memory leak.",
      "created_at": "2018-12-19T19:37:53Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r243048621",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/243048621"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 89,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245672104",
      "pull_request_review_id": 189831223,
      "id": 245672104,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0NTY3MjEwNA==",
      "diff_hunk": "@@ -2786,38 +2816,31 @@ CNode::~CNode()\n     CloseSocket(hSocket);\n }\n \n-void CNode::AskFor(const CInv& inv)\n+void CNode::AddToAskSet(const CInv& inv)\n {\n-    if (mapAskFor.size() > MAPASKFOR_MAX_SZ || setAskFor.size() > SETASKFOR_MAX_SZ)\n+    if (ask_set.size() > ASKSET_MAX_SZ)\n         return;\n     // a peer may not have multiple non-responded queue positions for a single inv item\n-    if (!setAskFor.insert(inv.hash).second)\n+    if (!ask_set.insert(inv).second)\n         return;\n \n-    // We're using mapAskFor as a priority queue,\n-    // the key is the earliest time the request can be sent\n-    int64_t nRequestTime;\n-    limitedmap<uint256, int64_t>::const_iterator it = mapAlreadyAskedFor.find(inv.hash);\n-    if (it != mapAlreadyAskedFor.end())\n-        nRequestTime = it->second;\n-    else\n-        nRequestTime = 0;\n-    LogPrint(BCLog::NET, \"askfor %s  %d (%s) peer=%d\\n\", inv.ToString(), nRequestTime, FormatISO8601Time(nRequestTime/1000000), id);",
      "path": "src/net.cpp",
      "position": 29,
      "original_position": 69,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "4ba0f8648bbe8bf159018d53c7761ce90cfcd0f1",
      "in_reply_to_id": null,
      "user": {
        "login": "practicalswift",
        "id": 7826565,
        "node_id": "MDQ6VXNlcjc4MjY1NjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/practicalswift",
        "html_url": "https://github.com/practicalswift",
        "followers_url": "https://api.github.com/users/practicalswift/followers",
        "following_url": "https://api.github.com/users/practicalswift/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/practicalswift/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/practicalswift/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
        "organizations_url": "https://api.github.com/users/practicalswift/orgs",
        "repos_url": "https://api.github.com/users/practicalswift/repos",
        "events_url": "https://api.github.com/users/practicalswift/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/practicalswift/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This is the last use of `FormatISO8601Time`. Please remove it from `src/util/time.cpp`.",
      "created_at": "2019-01-07T14:33:40Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r245672104",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/245672104"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2663,
      "original_line": 2663,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250406395",
      "pull_request_review_id": 195785987,
      "id": 250406395,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MDQwNjM5NQ==",
      "diff_hunk": "@@ -591,6 +657,25 @@ static void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vec\n     }\n }\n \n+void RequestTx(CNodeState *state, uint256 &txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    CNodeState::TxDownloadState &peer = state->m_tx_download;\n+    if (peer.m_tx_announced.size() >= MAX_PEER_TX_ANNOUNCEMENTS || peer.m_tx_announced.count(txid)) {\n+        // Too many queued announcements from this peer, or we already have\n+        // this announcement\n+        return;\n+    }\n+    peer.m_tx_announced.insert(txid);\n+\n+    int64_t process_time = GetTimeMicros();\n+\n+    // We delay processing announcements from non-preferred (eg inbound) peers\n+    if (!state->fPreferredDownload) process_time += INBOUND_PEER_TX_DELAY;\n+\n+    peer.m_tx_process_time.insert(std::make_pair(process_time, txid));",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 99,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "53ad7bedb4e6182acc8f087f92ab87b48184062b",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Use `peer.m_tx_process_time.emplace(process_time, txid);` for better readability (and possibly slightly better performance).",
      "created_at": "2019-01-23T22:58:13Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r250406395",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250406395"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 675,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250406573",
      "pull_request_review_id": 195785987,
      "id": 250406573,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MDQwNjU3Mw==",
      "diff_hunk": "@@ -591,6 +657,25 @@ static void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vec\n     }\n }\n \n+void RequestTx(CNodeState *state, uint256 &txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    CNodeState::TxDownloadState &peer = state->m_tx_download;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 86,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "53ad7bedb4e6182acc8f087f92ab87b48184062b",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Slightly confusing variable name. What about `download_state` ?",
      "created_at": "2019-01-23T22:58:52Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r250406573",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250406573"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 662,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250406784",
      "pull_request_review_id": 195785987,
      "id": 250406784,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MDQwNjc4NA==",
      "diff_hunk": "@@ -609,6 +694,26 @@ static bool IsOutboundDisconnectionCandidate(const CNode *node)\n     return !(node->fInbound || node->m_manual_connection || node->fFeeler || node->fOneShot);\n }\n \n+int64_t PeerLogicValidation::GetTxRequestTime(uint256 &txid)",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 110,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "53ad7bedb4e6182acc8f087f92ab87b48184062b",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`txid` can be a const reference",
      "created_at": "2019-01-23T22:59:40Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r250406784",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250406784"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 697,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250407281",
      "pull_request_review_id": 195785987,
      "id": 250407281,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MDQwNzI4MQ==",
      "diff_hunk": "@@ -609,6 +694,26 @@ static bool IsOutboundDisconnectionCandidate(const CNode *node)\n     return !(node->fInbound || node->m_manual_connection || node->fFeeler || node->fOneShot);\n }\n \n+int64_t PeerLogicValidation::GetTxRequestTime(uint256 &txid)\n+{\n+    auto it = m_already_asked_for.find(txid);\n+    if (it != m_already_asked_for.end()) {\n+        return it->second;\n+    }\n+    return 0;\n+}\n+\n+void PeerLogicValidation::UpdateTxRequestTime(uint256 &txid, int64_t request_time)",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 119,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "53ad7bedb4e6182acc8f087f92ab87b48184062b",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`txid` can be a const reference",
      "created_at": "2019-01-23T23:01:34Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r250407281",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250407281"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 706,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250411372",
      "pull_request_review_id": 195785987,
      "id": 250411372,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MDQxMTM3Mg==",
      "diff_hunk": "@@ -72,11 +72,19 @@ class PeerLogicValidation final : public CValidationInterface, public NetEventsI\n     /** If we have extra outbound peers, try to disconnect the one with the oldest block announcement */\n     void EvictExtraOutboundPeers(int64_t time_in_seconds) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    void EraseTxRequest(uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main) { m_already_asked_for.erase(txid); }\n+private:",
      "path": "src/net_processing.h",
      "position": null,
      "original_position": 5,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "53ad7bedb4e6182acc8f087f92ab87b48184062b",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This 'private' seems redundant.",
      "created_at": "2019-01-23T23:16:46Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r250411372",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250411372"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 76,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250418030",
      "pull_request_review_id": 195785987,
      "id": 250418030,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MDQxODAzMA==",
      "diff_hunk": "@@ -3731,24 +3838,44 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n         //\n         // Message: getdata (non-blocks)\n         //\n-        while (!pto->mapAskFor.empty() && (*pto->mapAskFor.begin()).first <= nNow)\n+        std::multimap<int64_t, uint256> &tx_process_time = state.m_tx_download.m_tx_process_time;\n+        while (!tx_process_time.empty() && (*tx_process_time.begin()).first <= nNow && state.m_tx_download.m_in_flight.size() < MAX_PEER_TX_IN_FLIGHT)",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 206,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "53ad7bedb4e6182acc8f087f92ab87b48184062b",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Instead of `(*tx_process_time.begin()).first` you can write `tx_process_time.begin()->first`",
      "created_at": "2019-01-23T23:46:06Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r250418030",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250418030"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3842,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250418365",
      "pull_request_review_id": 195785987,
      "id": 250418365,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MDQxODM2NQ==",
      "diff_hunk": "@@ -3731,24 +3838,44 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n         //\n         // Message: getdata (non-blocks)\n         //\n-        while (!pto->mapAskFor.empty() && (*pto->mapAskFor.begin()).first <= nNow)\n+        std::multimap<int64_t, uint256> &tx_process_time = state.m_tx_download.m_tx_process_time;\n+        while (!tx_process_time.empty() && (*tx_process_time.begin()).first <= nNow && state.m_tx_download.m_in_flight.size() < MAX_PEER_TX_IN_FLIGHT)\n         {\n-            const CInv& inv = (*pto->mapAskFor.begin()).second;\n+            const uint256& txid = (*tx_process_time.begin()).second;\n+            CInv inv(MSG_TX | GetFetchFlags(pto), txid);\n             if (!AlreadyHave(inv))\n             {\n-                LogPrint(BCLog::NET, \"Requesting %s peer=%d\\n\", inv.ToString(), pto->GetId());\n-                vGetData.push_back(inv);\n-                if (vGetData.size() >= 1000)\n-                {\n-                    connman->PushMessage(pto, msgMaker.Make(NetMsgType::GETDATA, vGetData));\n-                    vGetData.clear();\n+                // If this transaction was last request more than 1 minute ago,",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 219,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "53ad7bedb4e6182acc8f087f92ab87b48184062b",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Typo: requested",
      "created_at": "2019-01-23T23:47:41Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r250418365",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250418365"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3848,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250425010",
      "pull_request_review_id": 195785987,
      "id": 250425010,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MDQyNTAxMA==",
      "diff_hunk": "@@ -3731,24 +3838,44 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n         //\n         // Message: getdata (non-blocks)\n         //\n-        while (!pto->mapAskFor.empty() && (*pto->mapAskFor.begin()).first <= nNow)\n+        std::multimap<int64_t, uint256> &tx_process_time = state.m_tx_download.m_tx_process_time;\n+        while (!tx_process_time.empty() && (*tx_process_time.begin()).first <= nNow && state.m_tx_download.m_in_flight.size() < MAX_PEER_TX_IN_FLIGHT)\n         {\n-            const CInv& inv = (*pto->mapAskFor.begin()).second;\n+            const uint256& txid = (*tx_process_time.begin()).second;\n+            CInv inv(MSG_TX | GetFetchFlags(pto), txid);\n             if (!AlreadyHave(inv))\n             {\n-                LogPrint(BCLog::NET, \"Requesting %s peer=%d\\n\", inv.ToString(), pto->GetId());\n-                vGetData.push_back(inv);\n-                if (vGetData.size() >= 1000)\n-                {\n-                    connman->PushMessage(pto, msgMaker.Make(NetMsgType::GETDATA, vGetData));\n-                    vGetData.clear();\n+                // If this transaction was last request more than 1 minute ago,\n+                // then request.\n+                int64_t last_request_time = GetTxRequestTime(inv.hash);\n+                if (last_request_time <= nNow - MAX_GETDATA_TX_DELAY) {\n+                    LogPrint(BCLog::NET, \"Requesting %s peer=%d\\n\", inv.ToString(), pto->GetId());\n+                    vGetData.push_back(inv);\n+                    if (vGetData.size() >= 1000)\n+                    {\n+                        connman->PushMessage(pto, msgMaker.Make(NetMsgType::GETDATA, vGetData));\n+                        vGetData.clear();\n+                    }\n+                    UpdateTxRequestTime(inv.hash, nNow);\n+                    state.m_tx_download.m_in_flight.insert(inv.hash);\n+                } else {\n+                    // This transaction is in flight from someone else; queue\n+                    // up processing to happen after the download times out\n+                    // (with a slight delay for inboudnd peers, to prefer",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 235,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "53ad7bedb4e6182acc8f087f92ab87b48184062b",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Typo: inboudnd",
      "created_at": "2019-01-24T00:21:38Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r250425010",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250425010"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3864,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250426347",
      "pull_request_review_id": 195785987,
      "id": 250426347,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MDQyNjM0Nw==",
      "diff_hunk": "@@ -3731,24 +3838,44 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n         //\n         // Message: getdata (non-blocks)\n         //\n-        while (!pto->mapAskFor.empty() && (*pto->mapAskFor.begin()).first <= nNow)\n+        std::multimap<int64_t, uint256> &tx_process_time = state.m_tx_download.m_tx_process_time;\n+        while (!tx_process_time.empty() && (*tx_process_time.begin()).first <= nNow && state.m_tx_download.m_in_flight.size() < MAX_PEER_TX_IN_FLIGHT)\n         {\n-            const CInv& inv = (*pto->mapAskFor.begin()).second;\n+            const uint256& txid = (*tx_process_time.begin()).second;\n+            CInv inv(MSG_TX | GetFetchFlags(pto), txid);\n             if (!AlreadyHave(inv))\n             {\n-                LogPrint(BCLog::NET, \"Requesting %s peer=%d\\n\", inv.ToString(), pto->GetId());\n-                vGetData.push_back(inv);\n-                if (vGetData.size() >= 1000)\n-                {\n-                    connman->PushMessage(pto, msgMaker.Make(NetMsgType::GETDATA, vGetData));\n-                    vGetData.clear();\n+                // If this transaction was last request more than 1 minute ago,\n+                // then request.\n+                int64_t last_request_time = GetTxRequestTime(inv.hash);\n+                if (last_request_time <= nNow - MAX_GETDATA_TX_DELAY) {\n+                    LogPrint(BCLog::NET, \"Requesting %s peer=%d\\n\", inv.ToString(), pto->GetId());\n+                    vGetData.push_back(inv);\n+                    if (vGetData.size() >= 1000)\n+                    {\n+                        connman->PushMessage(pto, msgMaker.Make(NetMsgType::GETDATA, vGetData));\n+                        vGetData.clear();\n+                    }\n+                    UpdateTxRequestTime(inv.hash, nNow);\n+                    state.m_tx_download.m_in_flight.insert(inv.hash);\n+                } else {\n+                    // This transaction is in flight from someone else; queue\n+                    // up processing to happen after the download times out\n+                    // (with a slight delay for inboudnd peers, to prefer\n+                    // requests to outbound peers).\n+                    int64_t new_process_time = last_request_time + MAX_GETDATA_TX_DELAY;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 237,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "53ad7bedb4e6182acc8f087f92ab87b48184062b",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Could this just call `RequestTx`? To avoid spreading the INBOUND_PEER_TX_DELAY logic over two places in the code.",
      "created_at": "2019-01-24T00:28:28Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r250426347",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250426347"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3866,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250430235",
      "pull_request_review_id": 195785987,
      "id": 250430235,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MDQzMDIzNQ==",
      "diff_hunk": "@@ -3731,24 +3838,44 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n         //\n         // Message: getdata (non-blocks)\n         //\n-        while (!pto->mapAskFor.empty() && (*pto->mapAskFor.begin()).first <= nNow)\n+        std::multimap<int64_t, uint256> &tx_process_time = state.m_tx_download.m_tx_process_time;\n+        while (!tx_process_time.empty() && (*tx_process_time.begin()).first <= nNow && state.m_tx_download.m_in_flight.size() < MAX_PEER_TX_IN_FLIGHT)\n         {\n-            const CInv& inv = (*pto->mapAskFor.begin()).second;\n+            const uint256& txid = (*tx_process_time.begin()).second;\n+            CInv inv(MSG_TX | GetFetchFlags(pto), txid);\n             if (!AlreadyHave(inv))\n             {\n-                LogPrint(BCLog::NET, \"Requesting %s peer=%d\\n\", inv.ToString(), pto->GetId());\n-                vGetData.push_back(inv);\n-                if (vGetData.size() >= 1000)\n-                {\n-                    connman->PushMessage(pto, msgMaker.Make(NetMsgType::GETDATA, vGetData));\n-                    vGetData.clear();\n+                // If this transaction was last request more than 1 minute ago,\n+                // then request.\n+                int64_t last_request_time = GetTxRequestTime(inv.hash);\n+                if (last_request_time <= nNow - MAX_GETDATA_TX_DELAY) {\n+                    LogPrint(BCLog::NET, \"Requesting %s peer=%d\\n\", inv.ToString(), pto->GetId());\n+                    vGetData.push_back(inv);\n+                    if (vGetData.size() >= 1000)\n+                    {\n+                        connman->PushMessage(pto, msgMaker.Make(NetMsgType::GETDATA, vGetData));\n+                        vGetData.clear();\n+                    }\n+                    UpdateTxRequestTime(inv.hash, nNow);\n+                    state.m_tx_download.m_in_flight.insert(inv.hash);\n+                } else {\n+                    // This transaction is in flight from someone else; queue\n+                    // up processing to happen after the download times out\n+                    // (with a slight delay for inboudnd peers, to prefer\n+                    // requests to outbound peers).\n+                    int64_t new_process_time = last_request_time + MAX_GETDATA_TX_DELAY;\n+                    if (!state.fPreferredDownload) new_process_time += INBOUND_PEER_TX_DELAY;\n+                    tx_process_time.insert(std::make_pair(new_process_time, txid));\n                 }\n-            } else {\n-                //If we're not going to ask, don't expect a response.\n-                pto->setAskFor.erase(inv.hash);\n-            }\n-            pto->mapAskFor.erase(pto->mapAskFor.begin());\n+              } else {",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 246,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "53ad7bedb4e6182acc8f087f92ab87b48184062b",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Incorrect indentation.",
      "created_at": "2019-01-24T00:49:26Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r250430235",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/250430235"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3870,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/251509914",
      "pull_request_review_id": 197155484,
      "id": 251509914,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MTUwOTkxNA==",
      "diff_hunk": "@@ -72,6 +72,8 @@ class PeerLogicValidation final : public CValidationInterface, public NetEventsI\n     /** If we have extra outbound peers, try to disconnect the one with the oldest block announcement */\n     void EvictExtraOutboundPeers(int64_t time_in_seconds) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    // void EraseTxRequest(uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main) { m_already_asked_for.erase(txid); }",
      "path": "src/net_processing.h",
      "position": null,
      "original_position": 4,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "fe01a6d9420d1bc4f1490b2ca9b776c3a4c9c38e",
      "in_reply_to_id": null,
      "user": {
        "login": "marcinja",
        "id": 12243734,
        "node_id": "MDQ6VXNlcjEyMjQzNzM0",
        "avatar_url": "https://avatars.githubusercontent.com/u/12243734?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/marcinja",
        "html_url": "https://github.com/marcinja",
        "followers_url": "https://api.github.com/users/marcinja/followers",
        "following_url": "https://api.github.com/users/marcinja/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/marcinja/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/marcinja/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/marcinja/subscriptions",
        "organizations_url": "https://api.github.com/users/marcinja/orgs",
        "repos_url": "https://api.github.com/users/marcinja/repos",
        "events_url": "https://api.github.com/users/marcinja/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/marcinja/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: Looks like you can remove these two lines now",
      "created_at": "2019-01-28T17:13:21Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r251509914",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/251509914"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 75,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/251569015",
      "pull_request_review_id": 197228835,
      "id": 251569015,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MTU2OTAxNQ==",
      "diff_hunk": "@@ -72,6 +72,8 @@ class PeerLogicValidation final : public CValidationInterface, public NetEventsI\n     /** If we have extra outbound peers, try to disconnect the one with the oldest block announcement */\n     void EvictExtraOutboundPeers(int64_t time_in_seconds) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    // void EraseTxRequest(uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main) { m_already_asked_for.erase(txid); }",
      "path": "src/net_processing.h",
      "position": null,
      "original_position": 4,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "fe01a6d9420d1bc4f1490b2ca9b776c3a4c9c38e",
      "in_reply_to_id": 251509914,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "oops!",
      "created_at": "2019-01-28T19:54:08Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r251569015",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/251569015"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 75,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/251978894",
      "pull_request_review_id": 197736548,
      "id": 251978894,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MTk3ODg5NA==",
      "diff_hunk": "@@ -657,25 +663,56 @@ static void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vec\n     }\n }\n \n-void RequestTx(CNodeState *state, uint256 &txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+void EraseTxRequest(uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    m_already_asked_for.erase(txid);\n+}\n+\n+int64_t GetTxRequestTime(const uint256& txid)\n+{\n+    auto it = m_already_asked_for.find(txid);\n+    if (it != m_already_asked_for.end()) {\n+        return it->second;\n+    }\n+    return 0;\n+}\n+\n+void UpdateTxRequestTime(const uint256 &txid, int64_t request_time)\n {\n-    CNodeState::TxDownloadState &peer = state->m_tx_download;\n-    if (peer.m_tx_announced.size() >= MAX_PEER_TX_ANNOUNCEMENTS || peer.m_tx_announced.count(txid)) {\n+    auto it = m_already_asked_for.find(txid);\n+    if (it == m_already_asked_for.end()) {\n+        m_already_asked_for.insert(std::make_pair(txid, request_time));\n+    } else {\n+        m_already_asked_for.update(it, request_time);\n+    }\n+}\n+\n+\n+void RequestTx(CNodeState *state, const uint256 &txid) {\n+    CNodeState::TxDownloadState &peer_download_state = state->m_tx_download;\n+    if (peer_download_state.m_tx_announced.size() >= MAX_PEER_TX_ANNOUNCEMENTS || peer_download_state.m_tx_announced.count(txid)) {\n         // Too many queued announcements from this peer, or we already have\n         // this announcement\n         return;\n     }\n-    peer.m_tx_announced.insert(txid);\n \n-    int64_t process_time = GetTimeMicros();\n+    int64_t process_time;\n+    int64_t last_request_time = GetTxRequestTime(txid);\n+    // First time requesting this tx\n+    if (last_request_time == 0) {\n+        peer_download_state.m_tx_announced.insert(txid);\n+        process_time = GetTimeMicros();\n+    } else {\n+        // Add extra delay so that first peer from the list is not prioritizied due to ThreadMessageHandler delay\n+        process_time = PoissonNextSend(last_request_time + MAX_GETDATA_TX_DELAY, AVG_GETDATA_REQUEST_INTERVAL);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 77,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "be6a8a3c44acae5dc23aca67fd9f25ddc9d10f51",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "There's no downside here to using a uniform distribution here, is there?  And otherwise some inbound peers could be prioritized over outbound peers, which is what we were trying to avoid... I think we could just do:\r\n\r\n`process_time = last_request_time + MAX_GETDATA_TX_DELAY + GetRand(AVG_GETDATA_REQUEST_INTERVAL * 1000000)`",
      "created_at": "2019-01-29T19:19:14Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r251978894",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/251978894"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 707,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/251978982",
      "pull_request_review_id": 197736548,
      "id": 251978982,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MTk3ODk4Mg==",
      "diff_hunk": "@@ -657,25 +663,56 @@ static void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vec\n     }\n }\n \n-void RequestTx(CNodeState *state, uint256 &txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+void EraseTxRequest(uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    m_already_asked_for.erase(txid);\n+}\n+\n+int64_t GetTxRequestTime(const uint256& txid)\n+{\n+    auto it = m_already_asked_for.find(txid);\n+    if (it != m_already_asked_for.end()) {\n+        return it->second;\n+    }\n+    return 0;\n+}\n+\n+void UpdateTxRequestTime(const uint256 &txid, int64_t request_time)\n {\n-    CNodeState::TxDownloadState &peer = state->m_tx_download;\n-    if (peer.m_tx_announced.size() >= MAX_PEER_TX_ANNOUNCEMENTS || peer.m_tx_announced.count(txid)) {\n+    auto it = m_already_asked_for.find(txid);\n+    if (it == m_already_asked_for.end()) {\n+        m_already_asked_for.insert(std::make_pair(txid, request_time));\n+    } else {\n+        m_already_asked_for.update(it, request_time);\n+    }\n+}\n+\n+\n+void RequestTx(CNodeState *state, const uint256 &txid) {\n+    CNodeState::TxDownloadState &peer_download_state = state->m_tx_download;\n+    if (peer_download_state.m_tx_announced.size() >= MAX_PEER_TX_ANNOUNCEMENTS || peer_download_state.m_tx_announced.count(txid)) {\n         // Too many queued announcements from this peer, or we already have\n         // this announcement\n         return;\n     }\n-    peer.m_tx_announced.insert(txid);\n \n-    int64_t process_time = GetTimeMicros();\n+    int64_t process_time;\n+    int64_t last_request_time = GetTxRequestTime(txid);\n+    // First time requesting this tx\n+    if (last_request_time == 0) {\n+        peer_download_state.m_tx_announced.insert(txid);\n+        process_time = GetTimeMicros();\n+    } else {\n+        // Add extra delay so that first peer from the list is not prioritizied due to ThreadMessageHandler delay",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 76,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "be6a8a3c44acae5dc23aca67fd9f25ddc9d10f51",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: prioritized\r\n\r\nAlso I find this comment a bit confusing, perhaps just something like:\r\n`// Randomize the delay to avoid biasing some peers over others (such as due to fixed ordering of peer processing in ThreadMessageHandler)`\r\n\r\n(BTW sorry for writing this code incorrectly the first time, I mistakenly thought we shuffled our peers each loop iteration in ThreadMessageHandler, which is why I didn't add randomization here in the first place!)",
      "created_at": "2019-01-29T19:19:31Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r251978982",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/251978982"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 706,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/251979507",
      "pull_request_review_id": 197736548,
      "id": 251979507,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MTk3OTUwNw==",
      "diff_hunk": "@@ -367,6 +370,9 @@ struct CNodeState {\n     }\n };\n \n+// Keeps track of the time (in microseconds) when transactions were requested last time\n+limitedmap<uint256, int64_t> m_already_asked_for(MAX_INV_SZ);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 22,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "be6a8a3c44acae5dc23aca67fd9f25ddc9d10f51",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think we still want the `GUARDED_BY(cs_main)` annotation here?",
      "created_at": "2019-01-29T19:20:54Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r251979507",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/251979507"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 374,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/251979712",
      "pull_request_review_id": 197736548,
      "id": 251979712,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MTk3OTcxMg==",
      "diff_hunk": "@@ -657,25 +663,56 @@ static void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vec\n     }\n }\n \n-void RequestTx(CNodeState *state, uint256 &txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+void EraseTxRequest(uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    m_already_asked_for.erase(txid);\n+}\n+\n+int64_t GetTxRequestTime(const uint256& txid)",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 37,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "be6a8a3c44acae5dc23aca67fd9f25ddc9d10f51",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think this should also have `EXCLUSIVE_LOCKS_REQUIRED(cs_main)`.",
      "created_at": "2019-01-29T19:21:29Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r251979712",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/251979712"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 671,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/251979850",
      "pull_request_review_id": 197736548,
      "id": 251979850,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MTk3OTg1MA==",
      "diff_hunk": "@@ -657,25 +663,56 @@ static void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vec\n     }\n }\n \n-void RequestTx(CNodeState *state, uint256 &txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+void EraseTxRequest(uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    m_already_asked_for.erase(txid);\n+}\n+\n+int64_t GetTxRequestTime(const uint256& txid)\n+{\n+    auto it = m_already_asked_for.find(txid);\n+    if (it != m_already_asked_for.end()) {\n+        return it->second;\n+    }\n+    return 0;\n+}\n+\n+void UpdateTxRequestTime(const uint256 &txid, int64_t request_time)",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 46,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "be6a8a3c44acae5dc23aca67fd9f25ddc9d10f51",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`EXCLUSIVE_LOCKS_REQUIRED(cs_main)` here as well.",
      "created_at": "2019-01-29T19:21:52Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r251979850",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/251979850"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 680,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/251980514",
      "pull_request_review_id": 197736548,
      "id": 251980514,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MTk4MDUxNA==",
      "diff_hunk": "@@ -657,25 +663,56 @@ static void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vec\n     }\n }\n \n-void RequestTx(CNodeState *state, uint256 &txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+void EraseTxRequest(uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    m_already_asked_for.erase(txid);\n+}\n+\n+int64_t GetTxRequestTime(const uint256& txid)\n+{\n+    auto it = m_already_asked_for.find(txid);\n+    if (it != m_already_asked_for.end()) {\n+        return it->second;\n+    }\n+    return 0;\n+}\n+\n+void UpdateTxRequestTime(const uint256 &txid, int64_t request_time)\n {\n-    CNodeState::TxDownloadState &peer = state->m_tx_download;\n-    if (peer.m_tx_announced.size() >= MAX_PEER_TX_ANNOUNCEMENTS || peer.m_tx_announced.count(txid)) {\n+    auto it = m_already_asked_for.find(txid);\n+    if (it == m_already_asked_for.end()) {\n+        m_already_asked_for.insert(std::make_pair(txid, request_time));\n+    } else {\n+        m_already_asked_for.update(it, request_time);\n+    }\n+}\n+\n+\n+void RequestTx(CNodeState *state, const uint256 &txid) {",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 59,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "be6a8a3c44acae5dc23aca67fd9f25ddc9d10f51",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`EXCLUSIVE_LOCKS_REQUIRED(cs_main)` here as well.",
      "created_at": "2019-01-29T19:23:37Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r251980514",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/251980514"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 691,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252044077",
      "pull_request_review_id": 197817169,
      "id": 252044077,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MjA0NDA3Nw==",
      "diff_hunk": "@@ -367,6 +370,9 @@ struct CNodeState {\n     }\n };\n \n+// Keeps track of the time (in microseconds) when transactions were requested last time\n+limitedmap<uint256, int64_t> m_already_asked_for(MAX_INV_SZ);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 22,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "be6a8a3c44acae5dc23aca67fd9f25ddc9d10f51",
      "in_reply_to_id": 251979507,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "For some reason I didn't manage to make it work with limitedmaps. It seemed like it's either size allocation or ``GUARDED_BY``, and I don't see how to allocate it anywhere else after my code changes. ",
      "created_at": "2019-01-29T22:25:57Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r252044077",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252044077"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 374,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252054079",
      "pull_request_review_id": 197829485,
      "id": 252054079,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MjA1NDA3OQ==",
      "diff_hunk": "@@ -657,25 +663,56 @@ static void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vec\n     }\n }\n \n-void RequestTx(CNodeState *state, uint256 &txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+void EraseTxRequest(uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    m_already_asked_for.erase(txid);\n+}\n+\n+int64_t GetTxRequestTime(const uint256& txid)\n+{\n+    auto it = m_already_asked_for.find(txid);\n+    if (it != m_already_asked_for.end()) {\n+        return it->second;\n+    }\n+    return 0;\n+}\n+\n+void UpdateTxRequestTime(const uint256 &txid, int64_t request_time)\n {\n-    CNodeState::TxDownloadState &peer = state->m_tx_download;\n-    if (peer.m_tx_announced.size() >= MAX_PEER_TX_ANNOUNCEMENTS || peer.m_tx_announced.count(txid)) {\n+    auto it = m_already_asked_for.find(txid);\n+    if (it == m_already_asked_for.end()) {\n+        m_already_asked_for.insert(std::make_pair(txid, request_time));\n+    } else {\n+        m_already_asked_for.update(it, request_time);\n+    }\n+}\n+\n+\n+void RequestTx(CNodeState *state, const uint256 &txid) {\n+    CNodeState::TxDownloadState &peer_download_state = state->m_tx_download;\n+    if (peer_download_state.m_tx_announced.size() >= MAX_PEER_TX_ANNOUNCEMENTS || peer_download_state.m_tx_announced.count(txid)) {\n         // Too many queued announcements from this peer, or we already have\n         // this announcement\n         return;\n     }\n-    peer.m_tx_announced.insert(txid);\n \n-    int64_t process_time = GetTimeMicros();\n+    int64_t process_time;\n+    int64_t last_request_time = GetTxRequestTime(txid);\n+    // First time requesting this tx\n+    if (last_request_time == 0) {\n+        peer_download_state.m_tx_announced.insert(txid);\n+        process_time = GetTimeMicros();\n+    } else {\n+        // Add extra delay so that first peer from the list is not prioritizied due to ThreadMessageHandler delay\n+        process_time = PoissonNextSend(last_request_time + MAX_GETDATA_TX_DELAY, AVG_GETDATA_REQUEST_INTERVAL);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 77,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "be6a8a3c44acae5dc23aca67fd9f25ddc9d10f51",
      "in_reply_to_id": 251978894,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> some inbound peers could be prioritized over outbound peers\r\n\r\nNope, with these constants, it's [60..62] for outbound and [62..64] for inbound, so it's not possible.\r\n\r\nHowever, I think you're right and using GetRand() would work.",
      "created_at": "2019-01-29T22:59:38Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r252054079",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252054079"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 707,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252104433",
      "pull_request_review_id": 197889380,
      "id": 252104433,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MjEwNDQzMw==",
      "diff_hunk": "@@ -301,6 +370,9 @@ struct CNodeState {\n     }\n };\n \n+// Keeps track of the time (in microseconds) when transactions were requested last time\n+limitedmap<uint256, int64_t> m_already_asked_for(MAX_INV_SZ);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 88,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "1c2dc6dfb6811987f752ca3abb3134395c468b93",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> For some reason I didn't manage to make it work with limitedmaps. It seemed like it's either size allocation or GUARDED_BY, and I don't see how to allocate it anywhere else after my code changes.\r\n\r\n\r\nThis might work\r\n\r\n```suggestion\r\nlimitedmap<uint256, int64_t> m_already_asked_for GUARDED_BY(cs_main)(MAX_INV_SZ);\r\n```",
      "created_at": "2019-01-30T03:19:13Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r252104433",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252104433"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 374,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252301125",
      "pull_request_review_id": 198134141,
      "id": 252301125,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MjMwMTEyNQ==",
      "diff_hunk": "@@ -657,25 +663,56 @@ static void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vec\n     }\n }\n \n-void RequestTx(CNodeState *state, uint256 &txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+void EraseTxRequest(uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    m_already_asked_for.erase(txid);\n+}\n+\n+int64_t GetTxRequestTime(const uint256& txid)\n+{\n+    auto it = m_already_asked_for.find(txid);\n+    if (it != m_already_asked_for.end()) {\n+        return it->second;\n+    }\n+    return 0;\n+}\n+\n+void UpdateTxRequestTime(const uint256 &txid, int64_t request_time)\n {\n-    CNodeState::TxDownloadState &peer = state->m_tx_download;\n-    if (peer.m_tx_announced.size() >= MAX_PEER_TX_ANNOUNCEMENTS || peer.m_tx_announced.count(txid)) {\n+    auto it = m_already_asked_for.find(txid);\n+    if (it == m_already_asked_for.end()) {\n+        m_already_asked_for.insert(std::make_pair(txid, request_time));\n+    } else {\n+        m_already_asked_for.update(it, request_time);\n+    }\n+}\n+\n+\n+void RequestTx(CNodeState *state, const uint256 &txid) {\n+    CNodeState::TxDownloadState &peer_download_state = state->m_tx_download;\n+    if (peer_download_state.m_tx_announced.size() >= MAX_PEER_TX_ANNOUNCEMENTS || peer_download_state.m_tx_announced.count(txid)) {\n         // Too many queued announcements from this peer, or we already have\n         // this announcement\n         return;\n     }\n-    peer.m_tx_announced.insert(txid);\n \n-    int64_t process_time = GetTimeMicros();\n+    int64_t process_time;\n+    int64_t last_request_time = GetTxRequestTime(txid);\n+    // First time requesting this tx\n+    if (last_request_time == 0) {\n+        peer_download_state.m_tx_announced.insert(txid);\n+        process_time = GetTimeMicros();\n+    } else {\n+        // Add extra delay so that first peer from the list is not prioritizied due to ThreadMessageHandler delay\n+        process_time = PoissonNextSend(last_request_time + MAX_GETDATA_TX_DELAY, AVG_GETDATA_REQUEST_INTERVAL);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 77,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "be6a8a3c44acae5dc23aca67fd9f25ddc9d10f51",
      "in_reply_to_id": 251978894,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Nope, with these constants, it's [60..62] for outbound and [62..64] for inbound, so it's not possible.\r\n\r\nThere is no upper bound on what PoissonNextSend might return...?",
      "created_at": "2019-01-30T15:20:11Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r252301125",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252301125"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 707,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252308379",
      "pull_request_review_id": 198143460,
      "id": 252308379,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MjMwODM3OQ==",
      "diff_hunk": "@@ -657,25 +663,56 @@ static void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vec\n     }\n }\n \n-void RequestTx(CNodeState *state, uint256 &txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+void EraseTxRequest(uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    m_already_asked_for.erase(txid);\n+}\n+\n+int64_t GetTxRequestTime(const uint256& txid)\n+{\n+    auto it = m_already_asked_for.find(txid);\n+    if (it != m_already_asked_for.end()) {\n+        return it->second;\n+    }\n+    return 0;\n+}\n+\n+void UpdateTxRequestTime(const uint256 &txid, int64_t request_time)\n {\n-    CNodeState::TxDownloadState &peer = state->m_tx_download;\n-    if (peer.m_tx_announced.size() >= MAX_PEER_TX_ANNOUNCEMENTS || peer.m_tx_announced.count(txid)) {\n+    auto it = m_already_asked_for.find(txid);\n+    if (it == m_already_asked_for.end()) {\n+        m_already_asked_for.insert(std::make_pair(txid, request_time));\n+    } else {\n+        m_already_asked_for.update(it, request_time);\n+    }\n+}\n+\n+\n+void RequestTx(CNodeState *state, const uint256 &txid) {\n+    CNodeState::TxDownloadState &peer_download_state = state->m_tx_download;\n+    if (peer_download_state.m_tx_announced.size() >= MAX_PEER_TX_ANNOUNCEMENTS || peer_download_state.m_tx_announced.count(txid)) {\n         // Too many queued announcements from this peer, or we already have\n         // this announcement\n         return;\n     }\n-    peer.m_tx_announced.insert(txid);\n \n-    int64_t process_time = GetTimeMicros();\n+    int64_t process_time;\n+    int64_t last_request_time = GetTxRequestTime(txid);\n+    // First time requesting this tx\n+    if (last_request_time == 0) {\n+        peer_download_state.m_tx_announced.insert(txid);\n+        process_time = GetTimeMicros();\n+    } else {\n+        // Add extra delay so that first peer from the list is not prioritizied due to ThreadMessageHandler delay\n+        process_time = PoissonNextSend(last_request_time + MAX_GETDATA_TX_DELAY, AVG_GETDATA_REQUEST_INTERVAL);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 77,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "be6a8a3c44acae5dc23aca67fd9f25ddc9d10f51",
      "in_reply_to_id": 251978894,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "You're right, thanks.",
      "created_at": "2019-01-30T15:35:38Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r252308379",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252308379"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 707,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252326992",
      "pull_request_review_id": 198167619,
      "id": 252326992,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MjMyNjk5Mg==",
      "diff_hunk": "@@ -301,6 +370,9 @@ struct CNodeState {\n     }\n };\n \n+// Keeps track of the time (in microseconds) when transactions were requested last time\n+limitedmap<uint256, int64_t> m_already_asked_for(MAX_INV_SZ);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 88,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "1c2dc6dfb6811987f752ca3abb3134395c468b93",
      "in_reply_to_id": 252104433,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Verified that this works, thanks @MarcoFalke ",
      "created_at": "2019-01-30T16:14:44Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r252326992",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252326992"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 374,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252328086",
      "pull_request_review_id": 198169044,
      "id": 252328086,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MjMyODA4Ng==",
      "diff_hunk": "@@ -367,6 +370,9 @@ struct CNodeState {\n     }\n };\n \n+// Keeps track of the time (in microseconds) when transactions were requested last time\n+limitedmap<uint256, int64_t> m_already_asked_for(MAX_INV_SZ);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 22,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "be6a8a3c44acae5dc23aca67fd9f25ddc9d10f51",
      "in_reply_to_id": 251979507,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Actually, this should be renamed now to `g_already_asked_for`",
      "created_at": "2019-01-30T16:17:10Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r252328086",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252328086"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 374,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252348537",
      "pull_request_review_id": 198189249,
      "id": 252348537,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MjM0ODUzNw==",
      "diff_hunk": "@@ -274,6 +286,63 @@ struct CNodeState {\n     //! Time of last new block announcement\n     int64_t m_last_block_announcement;\n \n+    /*\n+     * State associated with transaction download.\n+     *\n+     * Tx download algorithm:\n+     *\n+     *   When inv comes in, queue up (process_time, txid) inside the peer's\n+     *   CNodeState (m_tx_process_time) as long as m_tx_announced for the peer\n+     *   isn't too big (MAX_PEER_TX_ANNOUNCEMENTS).\n+     *\n+     *   The process_time for a transaction is set to nNow for outbound peers,\n+     *   nNow + 1 second for inbound peers. This is the time at which we'll\n+     *   consider trying to request the transaction from the peer in\n+     *   SendMessages(). The delay for inbound peers is to allow outbound peers\n+     *   a chance to announce before we request from inbound peers, to prevent\n+     *   an adversary from using inbound connections to blind us to a\n+     *   transaction (InvBlock).\n+     *\n+     *   When we call SendMessages() for a given peer,\n+     *   we will loop over the transactions in m_tx_process_time, looking\n+     *   at the transactions whose process_time <= nNow. We'll request each\n+     *   such transaction that we don't have already and that hasn't been\n+     *   requested from another peer recently, up until we hit the\n+     *   MAX_PEER_TX_IN_FLIGHT limit for the peer. Then we'll update\n+     *   mapAlreadyAskedFor for each requested txid, storing the time of the\n+     *   GETDATA request. We use mapAlreadyAskedFor to coordinate transaction\n+     *   requests amongst our peers.\n+     *\n+     *   For transactions that we still need but we have already recently\n+     *   requested from some other peer, we'll reinsert (process_time, txid)\n+     *   back into the peer's m_tx_process_time at the point in the future at\n+     *   which the most recent GETDATA request would time out (ie\n+     *   MAX_GETDATA_TX_DELAY + the request time stored in mapAlreadyAskedFor).\n+     *   We add an additional delay for inbound peers, again to prefer\n+     *   attempting download from outbound peers first.\n+     *\n+     *   When we receive a transaction from a peer, we remove the txid from the\n+     *   peer's m_in_flight set and from their recently announced set\n+     *   (m_tx_announced).  We also clear m_already_asked_for for that entry, so\n+     *   that if somehow the transaction is not accepted but also not added to\n+     *   the reject filter, then we will eventually redownload from other\n+     *   peers.\n+     */",
      "path": "src/net_processing.cpp",
      "position": 70,
      "original_position": 64,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "cf36539a4d7a428e2120c1bc26cfba3216a48a69",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: This comment should be updated to refer to the new variables (eg mapAlreadyAskedFor was renamed), new constants (1 second is now incorrect), and the randomization behavior/delay change.",
      "created_at": "2019-01-30T17:02:26Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r252348537",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252348537"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 336,
      "original_line": 336,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252348726",
      "pull_request_review_id": 198189249,
      "id": 252348726,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MjM0ODcyNg==",
      "diff_hunk": "@@ -301,6 +370,9 @@ struct CNodeState {\n     }\n };\n \n+// Keeps track of the time (in microseconds) when transactions were requested last time\n+limitedmap<uint256, int64_t> m_already_asked_for GUARDED_BY(cs_main)(MAX_INV_SZ);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 88,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "cf36539a4d7a428e2120c1bc26cfba3216a48a69",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: I mentioned this before, I believe our style guide says that globals should start with `g_` instead of `m_`.",
      "created_at": "2019-01-30T17:02:53Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r252348726",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/252348726"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 374,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253583389",
      "pull_request_review_id": 199731895,
      "id": 253583389,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MzU4MzM4OQ==",
      "diff_hunk": "@@ -301,6 +373,9 @@ struct CNodeState {\n     }\n };\n \n+// Keeps track of the time (in microseconds) when transactions were requested last time\n+limitedmap<uint256, int64_t> g_already_asked_for GUARDED_BY(cs_main)(MAX_INV_SZ);",
      "path": "src/net_processing.cpp",
      "position": 94,
      "original_position": 91,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "1442d29530c7245e8a9eca69b4ecdd474fcb38ff",
      "in_reply_to_id": null,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Presumably the `MAX_PEER_TX_ANNOUNCEMENTS` limitation prevents any peer from triggering unnecessary evictions by overrunning this map with junk announcements.",
      "created_at": "2019-02-04T18:17:57Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r253583389",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253583389"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 380,
      "original_line": 380,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253584924",
      "pull_request_review_id": 199731895,
      "id": 253584924,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MzU4NDkyNA==",
      "diff_hunk": "@@ -591,6 +666,58 @@ static void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vec\n     }\n }\n \n+void EraseTxRequest(uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    g_already_asked_for.erase(txid);\n+}\n+\n+int64_t GetTxRequestTime(const uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    auto it = g_already_asked_for.find(txid);\n+    if (it != g_already_asked_for.end()) {\n+        return it->second;\n+    }\n+    return 0;\n+}\n+\n+void UpdateTxRequestTime(const uint256& txid, int64_t request_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    auto it = g_already_asked_for.find(txid);\n+    if (it == g_already_asked_for.end()) {\n+        g_already_asked_for.insert(std::make_pair(txid, request_time));\n+    } else {\n+        g_already_asked_for.update(it, request_time);\n+    }\n+}\n+\n+\n+void RequestTx(CNodeState* state, const uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    CNodeState::TxDownloadState& peer_download_state = state->m_tx_download;\n+    if (peer_download_state.m_tx_announced.size() >= MAX_PEER_TX_ANNOUNCEMENTS || peer_download_state.m_tx_announced.count(txid)) {\n+        // Too many queued announcements from this peer, or we already have\n+        // this announcement\n+        return;\n+    }\n+",
      "path": "src/net_processing.cpp",
      "position": 137,
      "original_position": 133,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "1442d29530c7245e8a9eca69b4ecdd474fcb38ff",
      "in_reply_to_id": null,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Is it worth a belt-and-suspenders early return here if `txid` is present in `peer_download_state.m_tx_announced` or `.m_in_flight`, a la the old `AskFor()` definition? Or is that change in behavior intentional?",
      "created_at": "2019-02-04T18:22:08Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r253584924",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253584924"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 706,
      "original_line": 706,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253587193",
      "pull_request_review_id": 199731895,
      "id": 253587193,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MzU4NzE5Mw==",
      "diff_hunk": "@@ -1570,7 +1697,7 @@ bool static ProcessHeadersMessage(CNode *pfrom, CConnman *connman, const std::ve\n     return true;\n }\n \n-bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStream& vRecv, int64_t nTimeReceived, const CChainParams& chainparams, CConnman* connman, const std::atomic<bool>& interruptMsgProc, bool enable_bip61)\n+bool static ProcessMessage(PeerLogicValidation* peer_logic, CNode* pfrom, const std::string& strCommand, CDataStream& vRecv, int64_t nTimeReceived, const CChainParams& chainparams, CConnman* connman, const std::atomic<bool>& interruptMsgProc, bool enable_bip61)",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 160,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "1442d29530c7245e8a9eca69b4ecdd474fcb38ff",
      "in_reply_to_id": null,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Might be missing something, but can't see any necessity for this new param.",
      "created_at": "2019-02-04T18:28:29Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r253587193",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253587193"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1700,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253597444",
      "pull_request_review_id": 199748696,
      "id": 253597444,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MzU5NzQ0NA==",
      "diff_hunk": "@@ -301,6 +373,9 @@ struct CNodeState {\n     }\n };\n \n+// Keeps track of the time (in microseconds) when transactions were requested last time\n+limitedmap<uint256, int64_t> g_already_asked_for GUARDED_BY(cs_main)(MAX_INV_SZ);",
      "path": "src/net_processing.cpp",
      "position": 94,
      "original_position": 91,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "1442d29530c7245e8a9eca69b4ecdd474fcb38ff",
      "in_reply_to_id": 253583389,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think the limit on the number of in-flight requests to a peer is what prevents this from being taken over.",
      "created_at": "2019-02-04T18:54:18Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r253597444",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253597444"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 380,
      "original_line": 380,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253597989",
      "pull_request_review_id": 199748696,
      "id": 253597989,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MzU5Nzk4OQ==",
      "diff_hunk": "@@ -591,6 +666,58 @@ static void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vec\n     }\n }\n \n+void EraseTxRequest(uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    g_already_asked_for.erase(txid);\n+}\n+\n+int64_t GetTxRequestTime(const uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    auto it = g_already_asked_for.find(txid);\n+    if (it != g_already_asked_for.end()) {\n+        return it->second;\n+    }\n+    return 0;\n+}\n+\n+void UpdateTxRequestTime(const uint256& txid, int64_t request_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    auto it = g_already_asked_for.find(txid);\n+    if (it == g_already_asked_for.end()) {\n+        g_already_asked_for.insert(std::make_pair(txid, request_time));\n+    } else {\n+        g_already_asked_for.update(it, request_time);\n+    }\n+}\n+\n+\n+void RequestTx(CNodeState* state, const uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    CNodeState::TxDownloadState& peer_download_state = state->m_tx_download;\n+    if (peer_download_state.m_tx_announced.size() >= MAX_PEER_TX_ANNOUNCEMENTS || peer_download_state.m_tx_announced.count(txid)) {\n+        // Too many queued announcements from this peer, or we already have\n+        // this announcement\n+        return;\n+    }\n+",
      "path": "src/net_processing.cpp",
      "position": 137,
      "original_position": 133,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "1442d29530c7245e8a9eca69b4ecdd474fcb38ff",
      "in_reply_to_id": 253584924,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I believe the ` || peer_download_state.m_tx_announced.count(txid)) {` captures the check you're asking about?  I don't think this should be a change in behavior compared with AskFor().\r\n\r\nBecause we check against m_tx_announced, I don't think we also need to check with what's in flight.",
      "created_at": "2019-02-04T18:55:34Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r253597989",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253597989"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 706,
      "original_line": 706,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253598802",
      "pull_request_review_id": 199748696,
      "id": 253598802,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MzU5ODgwMg==",
      "diff_hunk": "@@ -1570,7 +1697,7 @@ bool static ProcessHeadersMessage(CNode *pfrom, CConnman *connman, const std::ve\n     return true;\n }\n \n-bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStream& vRecv, int64_t nTimeReceived, const CChainParams& chainparams, CConnman* connman, const std::atomic<bool>& interruptMsgProc, bool enable_bip61)\n+bool static ProcessMessage(PeerLogicValidation* peer_logic, CNode* pfrom, const std::string& strCommand, CDataStream& vRecv, int64_t nTimeReceived, const CChainParams& chainparams, CConnman* connman, const std::atomic<bool>& interruptMsgProc, bool enable_bip61)",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 160,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "1442d29530c7245e8a9eca69b4ecdd474fcb38ff",
      "in_reply_to_id": 253587193,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think this is a hold-over from an earlier version of this patch in which some of the data structures were inside PeerLogicValidation -- I think you're right that this should be removed now.",
      "created_at": "2019-02-04T18:57:30Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r253598802",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253598802"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1700,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253599147",
      "pull_request_review_id": 199750769,
      "id": 253599147,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MzU5OTE0Nw==",
      "diff_hunk": "@@ -1570,7 +1697,7 @@ bool static ProcessHeadersMessage(CNode *pfrom, CConnman *connman, const std::ve\n     return true;\n }\n \n-bool static ProcessMessage(CNode* pfrom, const std::string& strCommand, CDataStream& vRecv, int64_t nTimeReceived, const CChainParams& chainparams, CConnman* connman, const std::atomic<bool>& interruptMsgProc, bool enable_bip61)\n+bool static ProcessMessage(PeerLogicValidation* peer_logic, CNode* pfrom, const std::string& strCommand, CDataStream& vRecv, int64_t nTimeReceived, const CChainParams& chainparams, CConnman* connman, const std::atomic<bool>& interruptMsgProc, bool enable_bip61)",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 160,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "1442d29530c7245e8a9eca69b4ecdd474fcb38ff",
      "in_reply_to_id": 253587193,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "good point, it's not needed after latest changes.",
      "created_at": "2019-02-04T18:58:20Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r253599147",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253599147"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1700,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253603806",
      "pull_request_review_id": 199756131,
      "id": 253603806,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MzYwMzgwNg==",
      "diff_hunk": "@@ -301,6 +373,9 @@ struct CNodeState {\n     }\n };\n \n+// Keeps track of the time (in microseconds) when transactions were requested last time\n+limitedmap<uint256, int64_t> g_already_asked_for GUARDED_BY(cs_main)(MAX_INV_SZ);",
      "path": "src/net_processing.cpp",
      "position": 94,
      "original_position": 91,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "1442d29530c7245e8a9eca69b4ecdd474fcb38ff",
      "in_reply_to_id": 253583389,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Right, and you need as many as 500 sybil connections to overrun this map :)",
      "created_at": "2019-02-04T19:10:32Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r253603806",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253603806"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 380,
      "original_line": 380,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253608895",
      "pull_request_review_id": 199762372,
      "id": 253608895,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MzYwODg5NQ==",
      "diff_hunk": "@@ -301,6 +373,9 @@ struct CNodeState {\n     }\n };\n \n+// Keeps track of the time (in microseconds) when transactions were requested last time\n+limitedmap<uint256, int64_t> g_already_asked_for GUARDED_BY(cs_main)(MAX_INV_SZ);",
      "path": "src/net_processing.cpp",
      "position": 94,
      "original_position": 91,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "1442d29530c7245e8a9eca69b4ecdd474fcb38ff",
      "in_reply_to_id": 253583389,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I forgot to add that the downside to this map being overrun is that we'll just request a transaction sooner than we otherwise would have (in the event that it was removed due to this data structure filling up). So if a zillion peers manage to take over this data structure, they're just wasting our bandwidth a bit -- which they can already do.",
      "created_at": "2019-02-04T19:23:54Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r253608895",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253608895"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 380,
      "original_line": 380,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253616437",
      "pull_request_review_id": 199771603,
      "id": 253616437,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MzYxNjQzNw==",
      "diff_hunk": "@@ -591,6 +666,58 @@ static void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vec\n     }\n }\n \n+void EraseTxRequest(uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    g_already_asked_for.erase(txid);\n+}\n+\n+int64_t GetTxRequestTime(const uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    auto it = g_already_asked_for.find(txid);\n+    if (it != g_already_asked_for.end()) {\n+        return it->second;\n+    }\n+    return 0;\n+}\n+\n+void UpdateTxRequestTime(const uint256& txid, int64_t request_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    auto it = g_already_asked_for.find(txid);",
      "path": "src/net_processing.cpp",
      "position": 119,
      "original_position": 116,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "1442d29530c7245e8a9eca69b4ecdd474fcb38ff",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "If `g_already_asked_for` turns into a normal map, this whole function can become `g_already_asked_for[txid] = request_time;`.",
      "created_at": "2019-02-04T19:43:13Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r253616437",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253616437"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 688,
      "original_line": 688,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253624945",
      "pull_request_review_id": 199781677,
      "id": 253624945,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MzYyNDk0NQ==",
      "diff_hunk": "@@ -591,6 +666,58 @@ static void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vec\n     }\n }\n \n+void EraseTxRequest(uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    g_already_asked_for.erase(txid);\n+}\n+\n+int64_t GetTxRequestTime(const uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    auto it = g_already_asked_for.find(txid);\n+    if (it != g_already_asked_for.end()) {\n+        return it->second;\n+    }\n+    return 0;\n+}\n+\n+void UpdateTxRequestTime(const uint256& txid, int64_t request_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    auto it = g_already_asked_for.find(txid);\n+    if (it == g_already_asked_for.end()) {\n+        g_already_asked_for.insert(std::make_pair(txid, request_time));\n+    } else {\n+        g_already_asked_for.update(it, request_time);\n+    }\n+}\n+\n+\n+void RequestTx(CNodeState* state, const uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    CNodeState::TxDownloadState& peer_download_state = state->m_tx_download;\n+    if (peer_download_state.m_tx_announced.size() >= MAX_PEER_TX_ANNOUNCEMENTS || peer_download_state.m_tx_announced.count(txid)) {\n+        // Too many queued announcements from this peer, or we already have\n+        // this announcement\n+        return;\n+    }\n+",
      "path": "src/net_processing.cpp",
      "position": 137,
      "original_position": 133,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "1442d29530c7245e8a9eca69b4ecdd474fcb38ff",
      "in_reply_to_id": 253584924,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "D'oh, yep you're totally right.",
      "created_at": "2019-02-04T20:05:13Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r253624945",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253624945"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 706,
      "original_line": 706,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253626146",
      "pull_request_review_id": 199782955,
      "id": 253626146,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MzYyNjE0Ng==",
      "diff_hunk": "@@ -301,6 +373,9 @@ struct CNodeState {\n     }\n };\n \n+// Keeps track of the time (in microseconds) when transactions were requested last time\n+limitedmap<uint256, int64_t> g_already_asked_for GUARDED_BY(cs_main)(MAX_INV_SZ);",
      "path": "src/net_processing.cpp",
      "position": 94,
      "original_position": 91,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "1442d29530c7245e8a9eca69b4ecdd474fcb38ff",
      "in_reply_to_id": 253583389,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> I think the limit on the number of in-flight requests to a peer is what prevents this from being taken over.\r\n\r\nAh right, per the third clause in this while condition: https://github.com/bitcoin/bitcoin/pull/14897/files#diff-eff7adeaec73a769788bb78858815c91R3864",
      "created_at": "2019-02-04T20:08:20Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r253626146",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253626146"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 380,
      "original_line": 380,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253662793",
      "pull_request_review_id": 199771603,
      "id": 253662793,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MzY2Mjc5Mw==",
      "diff_hunk": "@@ -3731,24 +3860,39 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n         //\n         // Message: getdata (non-blocks)\n         //\n-        while (!pto->mapAskFor.empty() && (*pto->mapAskFor.begin()).first <= nNow)\n-        {\n-            const CInv& inv = (*pto->mapAskFor.begin()).second;\n-            if (!AlreadyHave(inv))\n-            {\n-                LogPrint(BCLog::NET, \"Requesting %s peer=%d\\n\", inv.ToString(), pto->GetId());\n-                vGetData.push_back(inv);\n-                if (vGetData.size() >= 1000)\n-                {\n-                    connman->PushMessage(pto, msgMaker.Make(NetMsgType::GETDATA, vGetData));\n-                    vGetData.clear();\n+        std::multimap<int64_t, uint256>& tx_process_time = state.m_tx_download.m_tx_process_time;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 201,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "acf05329ca1bc36f8e89dcd7e1db956b6681262d",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Suggestion: use `auto&` as type.",
      "created_at": "2019-02-04T21:58:48Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r253662793",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253662793"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3863,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253662911",
      "pull_request_review_id": 199771603,
      "id": 253662911,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MzY2MjkxMQ==",
      "diff_hunk": "@@ -3731,24 +3860,39 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n         //\n         // Message: getdata (non-blocks)\n         //\n-        while (!pto->mapAskFor.empty() && (*pto->mapAskFor.begin()).first <= nNow)\n-        {\n-            const CInv& inv = (*pto->mapAskFor.begin()).second;\n-            if (!AlreadyHave(inv))\n-            {\n-                LogPrint(BCLog::NET, \"Requesting %s peer=%d\\n\", inv.ToString(), pto->GetId());\n-                vGetData.push_back(inv);\n-                if (vGetData.size() >= 1000)\n-                {\n-                    connman->PushMessage(pto, msgMaker.Make(NetMsgType::GETDATA, vGetData));\n-                    vGetData.clear();\n+        std::multimap<int64_t, uint256>& tx_process_time = state.m_tx_download.m_tx_process_time;\n+        while (!tx_process_time.empty() && tx_process_time.begin()->first <= nNow && state.m_tx_download.m_in_flight.size() < MAX_PEER_TX_IN_FLIGHT) {\n+            const uint256& txid = (*tx_process_time.begin()).second;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 203,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "acf05329ca1bc36f8e89dcd7e1db956b6681262d",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Suggestion: use `tx_process_time.begin()->second`.",
      "created_at": "2019-02-04T21:59:10Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r253662911",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253662911"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3865,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253663293",
      "pull_request_review_id": 199771603,
      "id": 253663293,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MzY2MzI5Mw==",
      "diff_hunk": "@@ -3731,24 +3860,39 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n         //\n         // Message: getdata (non-blocks)\n         //\n-        while (!pto->mapAskFor.empty() && (*pto->mapAskFor.begin()).first <= nNow)\n-        {\n-            const CInv& inv = (*pto->mapAskFor.begin()).second;\n-            if (!AlreadyHave(inv))\n-            {\n-                LogPrint(BCLog::NET, \"Requesting %s peer=%d\\n\", inv.ToString(), pto->GetId());\n-                vGetData.push_back(inv);\n-                if (vGetData.size() >= 1000)\n-                {\n-                    connman->PushMessage(pto, msgMaker.Make(NetMsgType::GETDATA, vGetData));\n-                    vGetData.clear();\n+        std::multimap<int64_t, uint256>& tx_process_time = state.m_tx_download.m_tx_process_time;\n+        while (!tx_process_time.empty() && tx_process_time.begin()->first <= nNow && state.m_tx_download.m_in_flight.size() < MAX_PEER_TX_IN_FLIGHT) {\n+            const uint256& txid = (*tx_process_time.begin()).second;\n+            CInv inv(MSG_TX | GetFetchFlags(pto), txid);\n+            if (!AlreadyHave(inv)) {\n+                // If this transaction was last requested more than 1 minute ago,\n+                // then request.\n+                int64_t last_request_time = GetTxRequestTime(inv.hash);\n+                if (last_request_time <= nNow - GETDATA_TX_INTERVAL) {\n+                    LogPrint(BCLog::NET, \"Requesting %s peer=%d\\n\", inv.ToString(), pto->GetId());\n+                    vGetData.push_back(inv);\n+                    if (vGetData.size() >= 1000) {",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 212,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "acf05329ca1bc36f8e89dcd7e1db956b6681262d",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Maybe introduce a constant for this (I know it's moved code, feel free to ignore).",
      "created_at": "2019-02-04T22:00:17Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r253663293",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253663293"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3874,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253667919",
      "pull_request_review_id": 199771603,
      "id": 253667919,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MzY2NzkxOQ==",
      "diff_hunk": "@@ -64,6 +64,18 @@ static constexpr int STALE_RELAY_AGE_LIMIT = 30 * 24 * 60 * 60;\n /// Age after which a block is considered historical for purposes of rate\n /// limiting block relay. Set to one week, denominated in seconds.\n static constexpr int HISTORICAL_BLOCK_AGE = 7 * 24 * 60 * 60;\n+/** Maximum number of in-flight transactions from a peer */\n+static constexpr int32_t MAX_PEER_TX_IN_FLIGHT = 100;\n+/** Maximum number of announced transactions from a peer */\n+static constexpr int32_t MAX_PEER_TX_ANNOUNCEMENTS = 2 * MAX_INV_SZ;\n+/** How many microseconds to delay requesting transactions from inbound peers */\n+static constexpr int64_t INBOUND_PEER_TX_DELAY = 2 * 1000000;\n+/** How long to wait (in microseconds) before downloading a transaction from an additional peer */\n+static constexpr int64_t GETDATA_TX_INTERVAL = 60 * 1000000;\n+/** Maximum delay (in microseconds) for transaction requests to avoid biasing some peers over others.\n+ * To preserve security, should not exceed INBOUND_PEER_TX_DELAY */",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 13,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "acf05329ca1bc36f8e89dcd7e1db956b6681262d",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "You can add `static_assert(INBOUND_PEER_DELAY >= MAX_GETDATA_RANDOM_DELAY, \"To preserve security, MAX_GETDATA_RANDOM_DELAY should not exceed INBOUND_PEER_DELAY\");` if you want to codify this (only checked at compile time).",
      "created_at": "2019-02-04T22:15:16Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r253667919",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253667919"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 76,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253670248",
      "pull_request_review_id": 199771603,
      "id": 253670248,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MzY3MDI0OA==",
      "diff_hunk": "@@ -591,6 +666,58 @@ static void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vec\n     }\n }\n \n+void EraseTxRequest(uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    g_already_asked_for.erase(txid);\n+}\n+\n+int64_t GetTxRequestTime(const uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    auto it = g_already_asked_for.find(txid);\n+    if (it != g_already_asked_for.end()) {\n+        return it->second;\n+    }\n+    return 0;\n+}\n+\n+void UpdateTxRequestTime(const uint256& txid, int64_t request_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    auto it = g_already_asked_for.find(txid);\n+    if (it == g_already_asked_for.end()) {\n+        g_already_asked_for.insert(std::make_pair(txid, request_time));\n+    } else {\n+        g_already_asked_for.update(it, request_time);\n+    }\n+}\n+\n+\n+void RequestTx(CNodeState* state, const uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    CNodeState::TxDownloadState& peer_download_state = state->m_tx_download;\n+    if (peer_download_state.m_tx_announced.size() >= MAX_PEER_TX_ANNOUNCEMENTS || peer_download_state.m_tx_announced.count(txid)) {\n+        // Too many queued announcements from this peer, or we already have\n+        // this announcement\n+        return;\n+    }\n+\n+    int64_t process_time;\n+    int64_t last_request_time = GetTxRequestTime(txid);\n+    // First time requesting this tx\n+    if (last_request_time == 0) {\n+        peer_download_state.m_tx_announced.insert(txid);\n+        process_time = GetTimeMicros();",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 139,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "acf05329ca1bc36f8e89dcd7e1db956b6681262d",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "You could avoid querying the time here, by passing in `nNow` from the caller.",
      "created_at": "2019-02-04T22:22:40Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r253670248",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253670248"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 708,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253678797",
      "pull_request_review_id": 199848088,
      "id": 253678797,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MzY3ODc5Nw==",
      "diff_hunk": "@@ -64,6 +64,18 @@ static constexpr int STALE_RELAY_AGE_LIMIT = 30 * 24 * 60 * 60;\n /// Age after which a block is considered historical for purposes of rate\n /// limiting block relay. Set to one week, denominated in seconds.\n static constexpr int HISTORICAL_BLOCK_AGE = 7 * 24 * 60 * 60;\n+/** Maximum number of in-flight transactions from a peer */\n+static constexpr int32_t MAX_PEER_TX_IN_FLIGHT = 100;\n+/** Maximum number of announced transactions from a peer */\n+static constexpr int32_t MAX_PEER_TX_ANNOUNCEMENTS = 2 * MAX_INV_SZ;\n+/** How many microseconds to delay requesting transactions from inbound peers */\n+static constexpr int64_t INBOUND_PEER_TX_DELAY = 2 * 1000000;\n+/** How long to wait (in microseconds) before downloading a transaction from an additional peer */\n+static constexpr int64_t GETDATA_TX_INTERVAL = 60 * 1000000;\n+/** Maximum delay (in microseconds) for transaction requests to avoid biasing some peers over others.\n+ * To preserve security, should not exceed INBOUND_PEER_TX_DELAY */",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 13,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "acf05329ca1bc36f8e89dcd7e1db956b6681262d",
      "in_reply_to_id": 253667919,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Awesome, I forgot about this option.",
      "created_at": "2019-02-04T22:52:36Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r253678797",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253678797"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 76,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253682754",
      "pull_request_review_id": 199853098,
      "id": 253682754,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1MzY4Mjc1NA==",
      "diff_hunk": "@@ -274,6 +286,66 @@ struct CNodeState {\n     //! Time of last new block announcement\n     int64_t m_last_block_announcement;\n \n+    /*\n+     * State associated with transaction download.\n+     *\n+     * Tx download algorithm:\n+     *\n+     *   When inv comes in, queue up (process_time, txid) inside the peer's\n+     *   CNodeState (m_tx_process_time) as long as m_tx_announced for the peer\n+     *   isn't too big (MAX_PEER_TX_ANNOUNCEMENTS).\n+     *\n+     *   The process_time for a transaction is set to nNow for outbound peers,\n+     *   nNow + 2 seconds for inbound peers. This is the time at which we'll\n+     *   consider trying to request the transaction from the peer in\n+     *   SendMessages(). The delay for inbound peers is to allow outbound peers\n+     *   a chance to announce before we request from inbound peers, to prevent\n+     *   an adversary from using inbound connections to blind us to a\n+     *   transaction (InvBlock).\n+     *\n+     *   When we call SendMessages() for a given peer,\n+     *   we will loop over the transactions in m_tx_process_time, looking\n+     *   at the transactions whose process_time <= nNow. We'll request each\n+     *   such transaction that we don't have already and that hasn't been\n+     *   requested from another peer recently, up until we hit the\n+     *   MAX_PEER_TX_IN_FLIGHT limit for the peer. Then we'll update\n+     *   g_already_asked_for for each requested txid, storing the time of the\n+     *   GETDATA request. We use g_already_asked_for to coordinate transaction\n+     *   requests amongst our peers.\n+     *\n+     *   For transactions that we still need but we have already recently\n+     *   requested from some other peer, we'll reinsert (process_time, txid)\n+     *   back into the peer's m_tx_process_time at the point in the future at\n+     *   which the most recent GETDATA request would time out (ie\n+     *   GETDATA_TX_INTERVAL + the request time stored in g_already_asked_for).\n+     *   We add an additional delay for inbound peers, again to prefer\n+     *   attempting download from outbound peers first.\n+     *   We also add an extra small random delay up to 2 seconds\n+     *   to avoid biasing some peers over others. (e.g., due to fixed ordering\n+     *   of peer processing in ThreadMessageHandler).\n+     *\n+     *   When we receive a transaction from a peer, we remove the txid from the\n+     *   peer's m_in_flight set and from their recently announced set\n+     *   (m_tx_announced).  We also clear g_already_asked_for for that entry, so\n+     *   that if somehow the transaction is not accepted but also not added to\n+     *   the reject filter, then we will eventually redownload from other\n+     *   peers.\n+     */\n+    struct TxDownloadState {\n+        /* Track when to attempt download of announced transactions (process\n+         * time in micros -> txid)\n+         */\n+        std::multimap<int64_t, uint256> m_tx_process_time;\n+\n+        //! Store all the transactions a peer has recently announced\n+        std::set<uint256> m_tx_announced;\n+\n+        //! Store transactions which were requested by us\n+        std::set<uint256> m_in_flight;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 78,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "acf05329ca1bc36f8e89dcd7e1db956b6681262d",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "doc-nit: Either remove the \"tx\" from the `m_tx_`-prefix from the other members or call this member `m_tx_in_flight`?",
      "created_at": "2019-02-04T23:07:28Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r253682754",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/253682754"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 344,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254007802",
      "pull_request_review_id": 200255384,
      "id": 254007802,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NDAwNzgwMg==",
      "diff_hunk": "@@ -591,6 +666,58 @@ static void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vec\n     }\n }\n \n+void EraseTxRequest(uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    g_already_asked_for.erase(txid);\n+}\n+\n+int64_t GetTxRequestTime(const uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    auto it = g_already_asked_for.find(txid);\n+    if (it != g_already_asked_for.end()) {\n+        return it->second;\n+    }\n+    return 0;\n+}\n+\n+void UpdateTxRequestTime(const uint256& txid, int64_t request_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    auto it = g_already_asked_for.find(txid);",
      "path": "src/net_processing.cpp",
      "position": 119,
      "original_position": 116,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "1442d29530c7245e8a9eca69b4ecdd474fcb38ff",
      "in_reply_to_id": 253616437,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "To be clear: are you suggesting switching to normal map and relying on the fact that we are not gonna have 500 sybils (so that it results in the same limiting properties due to checks discussed [here](https://github.com/bitcoin/bitcoin/pull/14897#discussion_r253583389)?",
      "created_at": "2019-02-05T19:16:19Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r254007802",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254007802"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 688,
      "original_line": 688,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254013618",
      "pull_request_review_id": 199853098,
      "id": 254013618,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NDAxMzYxOA==",
      "diff_hunk": "@@ -591,6 +666,58 @@ static void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vec\n     }\n }\n \n+void EraseTxRequest(uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 100,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "acf05329ca1bc36f8e89dcd7e1db956b6681262d",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "style-nit: Should be const reference?",
      "created_at": "2019-02-05T19:30:50Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r254013618",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254013618"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 669,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254016483",
      "pull_request_review_id": 199853098,
      "id": 254016483,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NDAxNjQ4Mw==",
      "diff_hunk": "@@ -591,6 +666,58 @@ static void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vec\n     }\n }\n \n+void EraseTxRequest(uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    g_already_asked_for.erase(txid);\n+}\n+\n+int64_t GetTxRequestTime(const uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    auto it = g_already_asked_for.find(txid);\n+    if (it != g_already_asked_for.end()) {\n+        return it->second;\n+    }\n+    return 0;\n+}\n+\n+void UpdateTxRequestTime(const uint256& txid, int64_t request_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    auto it = g_already_asked_for.find(txid);\n+    if (it == g_already_asked_for.end()) {\n+        g_already_asked_for.insert(std::make_pair(txid, request_time));\n+    } else {\n+        g_already_asked_for.update(it, request_time);\n+    }\n+}\n+\n+\n+void RequestTx(CNodeState* state, const uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    CNodeState::TxDownloadState& peer_download_state = state->m_tx_download;\n+    if (peer_download_state.m_tx_announced.size() >= MAX_PEER_TX_ANNOUNCEMENTS || peer_download_state.m_tx_announced.count(txid)) {\n+        // Too many queued announcements from this peer, or we already have\n+        // this announcement\n+        return;\n+    }\n+\n+    int64_t process_time;\n+    int64_t last_request_time = GetTxRequestTime(txid);\n+    // First time requesting this tx\n+    if (last_request_time == 0) {\n+        peer_download_state.m_tx_announced.insert(txid);\n+        process_time = GetTimeMicros();\n+    } else {\n+        // Randomize the delay to avoid biasing some peers over others (such as due to\n+        // fixed ordering of peer processing in ThreadMessageHandler)\n+        process_time = last_request_time + GETDATA_TX_INTERVAL + GetRand(MAX_GETDATA_RANDOM_DELAY);\n+    }\n+\n+    // We delay processing announcements from non-preferred (eg inbound) peers\n+    if (!state->fPreferredDownload) process_time += INBOUND_PEER_TX_DELAY;\n+\n+    peer_download_state.m_tx_process_time.emplace(process_time, txid);\n+}",
      "path": "src/net_processing.cpp",
      "position": 153,
      "original_position": 150,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "acf05329ca1bc36f8e89dcd7e1db956b6681262d",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In this function you are checking against the size of `m_tx_announced` to prevent DoS. However, a remote peer can control whether entries are added to `m_tx_announced` or not (see the if condition before `peer_download_state.m_tx_announced.insert`)\r\n\r\nSo you can eat all memory by slowly filling `m_tx_process_time` without touching the other tx download state and thus avoid the DoS protection.",
      "created_at": "2019-02-05T19:38:31Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r254016483",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254016483"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 722,
      "original_line": 722,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254017151",
      "pull_request_review_id": 199853098,
      "id": 254017151,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NDAxNzE1MQ==",
      "diff_hunk": "@@ -3731,24 +3860,39 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n         //\n         // Message: getdata (non-blocks)\n         //\n-        while (!pto->mapAskFor.empty() && (*pto->mapAskFor.begin()).first <= nNow)\n-        {\n-            const CInv& inv = (*pto->mapAskFor.begin()).second;\n-            if (!AlreadyHave(inv))\n-            {\n-                LogPrint(BCLog::NET, \"Requesting %s peer=%d\\n\", inv.ToString(), pto->GetId());\n-                vGetData.push_back(inv);\n-                if (vGetData.size() >= 1000)\n-                {\n-                    connman->PushMessage(pto, msgMaker.Make(NetMsgType::GETDATA, vGetData));\n-                    vGetData.clear();\n+        std::multimap<int64_t, uint256>& tx_process_time = state.m_tx_download.m_tx_process_time;\n+        while (!tx_process_time.empty() && tx_process_time.begin()->first <= nNow && state.m_tx_download.m_in_flight.size() < MAX_PEER_TX_IN_FLIGHT) {\n+            const uint256& txid = (*tx_process_time.begin()).second;\n+            CInv inv(MSG_TX | GetFetchFlags(pto), txid);\n+            if (!AlreadyHave(inv)) {\n+                // If this transaction was last requested more than 1 minute ago,\n+                // then request.\n+                int64_t last_request_time = GetTxRequestTime(inv.hash);\n+                if (last_request_time <= nNow - GETDATA_TX_INTERVAL) {\n+                    LogPrint(BCLog::NET, \"Requesting %s peer=%d\\n\", inv.ToString(), pto->GetId());\n+                    vGetData.push_back(inv);\n+                    if (vGetData.size() >= 1000) {",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 212,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "acf05329ca1bc36f8e89dcd7e1db956b6681262d",
      "in_reply_to_id": 253663293,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Maybe introduce a constant for this (I know it's moved code, feel free to ignore).\r\n\r\nI'd prefer to do this in a follow up pull request for all places where this constant is used, since this is not the only place that uses this constant IIRC.",
      "created_at": "2019-02-05T19:40:21Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r254017151",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254017151"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3874,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254023223",
      "pull_request_review_id": 200274020,
      "id": 254023223,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NDAyMzIyMw==",
      "diff_hunk": "@@ -591,6 +666,58 @@ static void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vec\n     }\n }\n \n+void EraseTxRequest(uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    g_already_asked_for.erase(txid);\n+}\n+\n+int64_t GetTxRequestTime(const uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    auto it = g_already_asked_for.find(txid);\n+    if (it != g_already_asked_for.end()) {\n+        return it->second;\n+    }\n+    return 0;\n+}\n+\n+void UpdateTxRequestTime(const uint256& txid, int64_t request_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    auto it = g_already_asked_for.find(txid);\n+    if (it == g_already_asked_for.end()) {\n+        g_already_asked_for.insert(std::make_pair(txid, request_time));\n+    } else {\n+        g_already_asked_for.update(it, request_time);\n+    }\n+}\n+\n+\n+void RequestTx(CNodeState* state, const uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    CNodeState::TxDownloadState& peer_download_state = state->m_tx_download;\n+    if (peer_download_state.m_tx_announced.size() >= MAX_PEER_TX_ANNOUNCEMENTS || peer_download_state.m_tx_announced.count(txid)) {\n+        // Too many queued announcements from this peer, or we already have\n+        // this announcement\n+        return;\n+    }\n+\n+    int64_t process_time;\n+    int64_t last_request_time = GetTxRequestTime(txid);\n+    // First time requesting this tx\n+    if (last_request_time == 0) {\n+        peer_download_state.m_tx_announced.insert(txid);\n+        process_time = GetTimeMicros();\n+    } else {\n+        // Randomize the delay to avoid biasing some peers over others (such as due to\n+        // fixed ordering of peer processing in ThreadMessageHandler)\n+        process_time = last_request_time + GETDATA_TX_INTERVAL + GetRand(MAX_GETDATA_RANDOM_DELAY);\n+    }\n+\n+    // We delay processing announcements from non-preferred (eg inbound) peers\n+    if (!state->fPreferredDownload) process_time += INBOUND_PEER_TX_DELAY;\n+\n+    peer_download_state.m_tx_process_time.emplace(process_time, txid);\n+}",
      "path": "src/net_processing.cpp",
      "position": 153,
      "original_position": 150,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "acf05329ca1bc36f8e89dcd7e1db956b6681262d",
      "in_reply_to_id": 254016483,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good catch!  Looks like it's just a mistake that we are only adding to m_tx_announced if `last_request_time == 0`, rather than always.",
      "created_at": "2019-02-05T19:57:11Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r254023223",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254023223"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 722,
      "original_line": 722,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254025498",
      "pull_request_review_id": 200276983,
      "id": 254025498,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NDAyNTQ5OA==",
      "diff_hunk": "@@ -3731,24 +3860,39 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n         //\n         // Message: getdata (non-blocks)\n         //\n-        while (!pto->mapAskFor.empty() && (*pto->mapAskFor.begin()).first <= nNow)\n-        {\n-            const CInv& inv = (*pto->mapAskFor.begin()).second;\n-            if (!AlreadyHave(inv))\n-            {\n-                LogPrint(BCLog::NET, \"Requesting %s peer=%d\\n\", inv.ToString(), pto->GetId());\n-                vGetData.push_back(inv);\n-                if (vGetData.size() >= 1000)\n-                {\n-                    connman->PushMessage(pto, msgMaker.Make(NetMsgType::GETDATA, vGetData));\n-                    vGetData.clear();\n+        std::multimap<int64_t, uint256>& tx_process_time = state.m_tx_download.m_tx_process_time;\n+        while (!tx_process_time.empty() && tx_process_time.begin()->first <= nNow && state.m_tx_download.m_in_flight.size() < MAX_PEER_TX_IN_FLIGHT) {\n+            const uint256& txid = (*tx_process_time.begin()).second;\n+            CInv inv(MSG_TX | GetFetchFlags(pto), txid);\n+            if (!AlreadyHave(inv)) {\n+                // If this transaction was last requested more than 1 minute ago,\n+                // then request.\n+                int64_t last_request_time = GetTxRequestTime(inv.hash);\n+                if (last_request_time <= nNow - GETDATA_TX_INTERVAL) {\n+                    LogPrint(BCLog::NET, \"Requesting %s peer=%d\\n\", inv.ToString(), pto->GetId());\n+                    vGetData.push_back(inv);\n+                    if (vGetData.size() >= 1000) {",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 212,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "acf05329ca1bc36f8e89dcd7e1db956b6681262d",
      "in_reply_to_id": 253663293,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It seems like it's the only place.\r\nWe had this discussion on IRC: the code for processing GETDATA uses 50,000 instead of 1000 for compatibility reasons.",
      "created_at": "2019-02-05T20:03:51Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r254025498",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254025498"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3874,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254393143",
      "pull_request_review_id": 200732104,
      "id": 254393143,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NDM5MzE0Mw==",
      "diff_hunk": "@@ -591,6 +666,58 @@ static void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vec\n     }\n }\n \n+void EraseTxRequest(uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    g_already_asked_for.erase(txid);\n+}\n+\n+int64_t GetTxRequestTime(const uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    auto it = g_already_asked_for.find(txid);\n+    if (it != g_already_asked_for.end()) {\n+        return it->second;\n+    }\n+    return 0;\n+}\n+\n+void UpdateTxRequestTime(const uint256& txid, int64_t request_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    auto it = g_already_asked_for.find(txid);",
      "path": "src/net_processing.cpp",
      "position": 119,
      "original_position": 116,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "1442d29530c7245e8a9eca69b4ecdd474fcb38ff",
      "in_reply_to_id": 253616437,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "No, I'm suggesting that *if* we'd determine that switching to a normal map is safe, this function can be simplified.\r\n\r\n",
      "created_at": "2019-02-06T18:26:57Z",
      "updated_at": "2019-02-07T04:25:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r254393143",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254393143"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 688,
      "original_line": 688,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254809602",
      "pull_request_review_id": 201248349,
      "id": 254809602,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NDgwOTYwMg==",
      "diff_hunk": "@@ -591,6 +669,58 @@ static void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vec\n     }\n }\n \n+void EraseTxRequest(const uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    g_already_asked_for.erase(txid);\n+}\n+\n+int64_t GetTxRequestTime(const uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    auto it = g_already_asked_for.find(txid);\n+    if (it != g_already_asked_for.end()) {\n+        return it->second;\n+    }\n+    return 0;\n+}\n+\n+void UpdateTxRequestTime(const uint256& txid, int64_t request_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    auto it = g_already_asked_for.find(txid);\n+    if (it == g_already_asked_for.end()) {\n+        g_already_asked_for.insert(std::make_pair(txid, request_time));\n+    } else {\n+        g_already_asked_for.update(it, request_time);\n+    }\n+}\n+\n+\n+void RequestTx(CNodeState* state, const uint256& txid, int64_t nNow) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    CNodeState::TxDownloadState& peer_download_state = state->m_tx_download;\n+    if (peer_download_state.m_tx_announced.size() >= MAX_PEER_TX_ANNOUNCEMENTS || peer_download_state.m_tx_announced.count(txid)) {\n+        // Too many queued announcements from this peer, or we already have\n+        // this announcement\n+        return;\n+    }\n+    peer_download_state.m_tx_announced.insert(txid);\n+\n+    int64_t process_time;\n+    int64_t last_request_time = GetTxRequestTime(txid);",
      "path": "src/net_processing.cpp",
      "position": 139,
      "original_position": 139,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "style-nit: Could be `const`",
      "created_at": "2019-02-07T18:23:11Z",
      "updated_at": "2019-02-11T15:07:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r254809602",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254809602"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 708,
      "original_line": 708,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254809936",
      "pull_request_review_id": 201248349,
      "id": 254809936,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NDgwOTkzNg==",
      "diff_hunk": "@@ -3731,24 +3866,39 @@ bool PeerLogicValidation::SendMessages(CNode* pto)\n         //\n         // Message: getdata (non-blocks)\n         //\n-        while (!pto->mapAskFor.empty() && (*pto->mapAskFor.begin()).first <= nNow)\n-        {\n-            const CInv& inv = (*pto->mapAskFor.begin()).second;\n-            if (!AlreadyHave(inv))\n-            {\n-                LogPrint(BCLog::NET, \"Requesting %s peer=%d\\n\", inv.ToString(), pto->GetId());\n-                vGetData.push_back(inv);\n-                if (vGetData.size() >= 1000)\n-                {\n-                    connman->PushMessage(pto, msgMaker.Make(NetMsgType::GETDATA, vGetData));\n-                    vGetData.clear();\n+        auto& tx_process_time = state.m_tx_download.m_tx_process_time;\n+        while (!tx_process_time.empty() && tx_process_time.begin()->first <= nNow && state.m_tx_download.m_tx_in_flight.size() < MAX_PEER_TX_IN_FLIGHT) {\n+            const uint256& txid = tx_process_time.begin()->second;\n+            CInv inv(MSG_TX | GetFetchFlags(pto), txid);\n+            if (!AlreadyHave(inv)) {\n+                // If this transaction was last requested more than 1 minute ago,\n+                // then request.\n+                int64_t last_request_time = GetTxRequestTime(inv.hash);\n+                if (last_request_time <= nNow - GETDATA_TX_INTERVAL) {",
      "path": "src/net_processing.cpp",
      "position": 225,
      "original_position": 225,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "style-nit: Could inline `GetTxRequestTime` here to avoid the named symbol `last_request_time`.",
      "created_at": "2019-02-07T18:24:06Z",
      "updated_at": "2019-02-11T15:07:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r254809936",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254809936"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3877,
      "original_line": 3877,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254812156",
      "pull_request_review_id": 201248349,
      "id": 254812156,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NDgxMjE1Ng==",
      "diff_hunk": "@@ -591,6 +669,58 @@ static void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vec\n     }\n }\n \n+void EraseTxRequest(const uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    g_already_asked_for.erase(txid);\n+}\n+\n+int64_t GetTxRequestTime(const uint256& txid) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    auto it = g_already_asked_for.find(txid);\n+    if (it != g_already_asked_for.end()) {\n+        return it->second;\n+    }\n+    return 0;\n+}\n+\n+void UpdateTxRequestTime(const uint256& txid, int64_t request_time) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    auto it = g_already_asked_for.find(txid);\n+    if (it == g_already_asked_for.end()) {\n+        g_already_asked_for.insert(std::make_pair(txid, request_time));\n+    } else {\n+        g_already_asked_for.update(it, request_time);\n+    }\n+}\n+\n+\n+void RequestTx(CNodeState* state, const uint256& txid, int64_t nNow) EXCLUSIVE_LOCKS_REQUIRED(cs_main)\n+{\n+    CNodeState::TxDownloadState& peer_download_state = state->m_tx_download;\n+    if (peer_download_state.m_tx_announced.size() >= MAX_PEER_TX_ANNOUNCEMENTS || peer_download_state.m_tx_announced.count(txid)) {\n+        // Too many queued announcements from this peer, or we already have\n+        // this announcement\n+        return;\n+    }\n+    peer_download_state.m_tx_announced.insert(txid);",
      "path": "src/net_processing.cpp",
      "position": 136,
      "original_position": 136,
      "commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "original_commit_id": "1cff3d6cb017aea87d16cbda0768bbab256d16da",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "style-nit: Could make this `if (!peer_download_state.m_tx_announced.insert(txid).second) return;` and remove the `count()` above to avoid two lookups. (This will be in line with the previous code in `AskFor`)",
      "created_at": "2019-02-07T18:29:46Z",
      "updated_at": "2019-02-11T15:07:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14897#discussion_r254812156",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/254812156"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14897"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 705,
      "original_line": 705,
      "side": "RIGHT"
    }
  ]
}