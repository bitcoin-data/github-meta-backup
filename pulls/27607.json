{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607",
    "id": 1343911718,
    "node_id": "PR_kwDOABII585QGncm",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/27607",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/27607.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/27607.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27607",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27607/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/89477bec4ef3c05b1630b7635b4bcbc09c24b98a",
    "number": 27607,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "index: improve initialization and pruning violation check",
    "user": {
      "login": "furszy",
      "id": 5377650,
      "node_id": "MDQ6VXNlcjUzNzc2NTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/furszy",
      "html_url": "https://github.com/furszy",
      "followers_url": "https://api.github.com/users/furszy/followers",
      "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
      "organizations_url": "https://api.github.com/users/furszy/orgs",
      "repos_url": "https://api.github.com/users/furszy/repos",
      "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/furszy/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Depending on ~https://github.com/bitcoin/bitcoin/pull/27720~ and https://github.com/bitcoin/bitcoin/pull/27708.\r\n\r\nMade the following changes:\r\n\r\n* Replaced the indexers threads active wait and the `is_ready` global flag by a postponed indexers start call (after `load-blk` thread finishes loading the blocks).\r\n\r\n* Decoupled index `Init()` from `Start()`. So indexers can be initialized without spawning the sync thread.\r\n\r\n* Simplified pruning violation code by re-purposing `GetFirstStoredBlock`. Now called `IsBlockDataAvailable`.\r\n\r\n* Made the indexes pruning violation check more efficient by fetching the oldest block from all indexers and performing the block data availability check from that point only once, and not once per index as is now (If the oldest block passes the check, newer blocks will also pass it).",
    "labels": [
      {
        "id": 97470796,
        "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
        "name": "UTXO Db and Indexes",
        "color": "fbca04",
        "default": false
      }
    ],
    "created_at": "2023-05-09T14:55:04Z",
    "updated_at": "2023-06-06T19:40:55Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "13337a00ce3dba073e47315d3fba604cb708182c",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "furszy:2023_index_decouple_has_data_checks",
      "ref": "2023_index_decouple_has_data_checks",
      "sha": "89477bec4ef3c05b1630b7635b4bcbc09c24b98a",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 143624913,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNDM2MjQ5MTM=",
        "name": "bitcoin-core",
        "full_name": "furszy/bitcoin-core",
        "owner": {
          "login": "furszy",
          "id": 5377650,
          "node_id": "MDQ6VXNlcjUzNzc2NTA=",
          "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/furszy",
          "html_url": "https://github.com/furszy",
          "followers_url": "https://api.github.com/users/furszy/followers",
          "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
          "organizations_url": "https://api.github.com/users/furszy/orgs",
          "repos_url": "https://api.github.com/users/furszy/repos",
          "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/furszy/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/furszy/bitcoin-core",
        "description": "Bitcoin-Core",
        "fork": true,
        "url": "https://api.github.com/repos/furszy/bitcoin-core",
        "archive_url": "https://api.github.com/repos/furszy/bitcoin-core/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/furszy/bitcoin-core/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/furszy/bitcoin-core/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/furszy/bitcoin-core/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/furszy/bitcoin-core/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/furszy/bitcoin-core/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/furszy/bitcoin-core/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/furszy/bitcoin-core/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/furszy/bitcoin-core/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/furszy/bitcoin-core/contributors",
        "deployments_url": "https://api.github.com/repos/furszy/bitcoin-core/deployments",
        "downloads_url": "https://api.github.com/repos/furszy/bitcoin-core/downloads",
        "events_url": "https://api.github.com/repos/furszy/bitcoin-core/events",
        "forks_url": "https://api.github.com/repos/furszy/bitcoin-core/forks",
        "git_commits_url": "https://api.github.com/repos/furszy/bitcoin-core/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/furszy/bitcoin-core/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/furszy/bitcoin-core/git/tags%7B/sha%7D",
        "git_url": "git://github.com/furszy/bitcoin-core.git",
        "issue_comment_url": "https://api.github.com/repos/furszy/bitcoin-core/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/furszy/bitcoin-core/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/furszy/bitcoin-core/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/furszy/bitcoin-core/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/furszy/bitcoin-core/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/furszy/bitcoin-core/languages",
        "merges_url": "https://api.github.com/repos/furszy/bitcoin-core/merges",
        "milestones_url": "https://api.github.com/repos/furszy/bitcoin-core/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/furszy/bitcoin-core/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/furszy/bitcoin-core/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/furszy/bitcoin-core/releases%7B/id%7D",
        "ssh_url": "git@github.com:furszy/bitcoin-core.git",
        "stargazers_url": "https://api.github.com/repos/furszy/bitcoin-core/stargazers",
        "statuses_url": "https://api.github.com/repos/furszy/bitcoin-core/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/furszy/bitcoin-core/subscribers",
        "subscription_url": "https://api.github.com/repos/furszy/bitcoin-core/subscription",
        "tags_url": "https://api.github.com/repos/furszy/bitcoin-core/tags",
        "teams_url": "https://api.github.com/repos/furszy/bitcoin-core/teams",
        "trees_url": "https://api.github.com/repos/furszy/bitcoin-core/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/furszy/bitcoin-core.git",
        "hooks_url": "https://api.github.com/repos/furszy/bitcoin-core/hooks",
        "svn_url": "https://github.com/furszy/bitcoin-core",
        "homepage": "",
        "language": "C++",
        "forks_count": 2,
        "stargazers_count": 1,
        "watchers_count": 1,
        "size": 380259,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-06T20:18:24Z",
        "created_at": "2018-08-05T15:28:43Z",
        "updated_at": "2023-02-27T18:01:49Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "3a83d4417b35cb0173286b6da97315be861901bc",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 34325,
        "stargazers_count": 69819,
        "watchers_count": 69819,
        "size": 233879,
        "default_branch": "master",
        "open_issues_count": 626,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-07T07:29:24Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-06-07T07:34:31Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 157,
    "deletions": 102,
    "changed_files": 18,
    "commits": 7,
    "review_comments": 22,
    "comments": 17
  },
  "events": [
    {
      "event": "commented",
      "id": 1540297299,
      "node_id": "IC_kwDOABII585bzxJT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1540297299",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-09T14:55:07Z",
      "updated_at": "2023-06-01T04:48:31Z",
      "author_association": "MEMBER",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27711](https://github.com/bitcoin/bitcoin/pull/27711) (kernel: Remove shutdown from kernel library by TheCharlatan)\n* [#27708](https://github.com/bitcoin/bitcoin/pull/27708) (Return EXIT_FAILURE on post-init fatal errors by furszy)\n* [#27596](https://github.com/bitcoin/bitcoin/pull/27596) (assumeutxo (2) by jamesob)\n* [#26966](https://github.com/bitcoin/bitcoin/pull/26966) (index: blockfilter initial sync speedup, parallelize process by furszy)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#issuecomment-1540297299",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27607"
    },
    {
      "event": "labeled",
      "id": 9202431676,
      "node_id": "LE_lADOABII585ldbL0zwAAAAIkgfa8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9202431676",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-09T15:53:58Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1422846165,
      "node_id": "PRR_kwDOABII585UzujV",
      "url": null,
      "actor": null,
      "commit_id": "86752e0cc5bc48f3d4ac1cd07835c37daf078d6a",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Reviewed 86752e0cc5bc48f3d4ac1cd07835c37daf078d6a and it mostly looks good, but does have a null pointer deference currently (see comments and suggested fix). I like this PR because it will simplify #24230 and could potentially improve performance. I'm not actually how sure how much it actually would improve performance in practice though, so I'm curious if that's was the original motivation here or if this is related to one of your other changes. I'm also curious about the todo:\r\n\r\n> Pending todo: Fix remaining test by using the block index map instead of the active chain. The active chain is not available at the point where the indexers are started.\r\n\r\nUnsure if this is just referring to the null pointer problem, or to something else",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#pullrequestreview-1422846165",
      "submitted_at": "2023-05-11T16:10:34Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
    },
    {
      "event": "commented",
      "id": 1544648748,
      "node_id": "IC_kwDOABII585cEXgs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1544648748",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-11T20:40:56Z",
      "updated_at": "2023-05-12T01:32:58Z",
      "author_association": "MEMBER",
      "body": "Thanks for the deep review @ryanofsky!\r\n\r\n> Reviewed [86752e0](https://github.com/bitcoin/bitcoin/commit/86752e0cc5bc48f3d4ac1cd07835c37daf078d6a) and it mostly looks good, but does have a null pointer deference currently (see comments and suggested fix). I like this PR because it will simplify #24230 and could potentially improve performance. I'm not actually how sure how much it actually would improve performance in practice though, so I'm curious if that's was the original motivation here or if this is related to one of your other changes.\r\n\r\nYeah, the motivation came from a mix of thoughts actually.\r\n\r\nI was reviewing #24230 and wasn't completely sold by the `hasDataFromTipDown()` call inside the `attachChain` function. It seems odd to call to a chain data verification function in an event registering method.\r\nThen went deeper over the function, realized about the work duplication, and took that argument to simplify #24230 a bit.\r\n\r\nWe could also move the entire `hasDataFromTipDown` from the interface to somewhere else in this way. So there is no `CBlockIndex` dependency in the interface neither here nor in the #24230 intermediate commits.\r\n\r\nPlus, It plays well with #25193.\r\n\r\nAnd.. I'm also thinking that after #24230 and the parallel sync work (#26966), we could have one initial sync thread with a workers pool for all the indexers instead of the current per indexer sync thread.\r\nWhich should speedup the sync process quite a lot. We are currently reading the entire chain block by block from disk on every index thread. So instead, we could read blocks just once, then dispatch events to the indexers. Making indexers purely listeners with no associated thread.\r\n\r\n>  I'm also curious about the todo:\r\n> \r\n> > Pending todo: Fix remaining test by using the block index map instead of the active chain. The active chain is not available at the point where the indexers are started.\r\n> \r\n> Unsure if this is just referring to the null pointer problem, or to something else\r\n\r\nYeah ok. That comment is inaccurate and I forgot to update it.\r\n\r\nI initially thought that the issue was due an initialization ordering, that we weren’t having the active chain activated at that point (thought that was done only post load-blk thread completion).\r\nSo I implemented 4738a1d7d46a9dd1f12dfeb047b142ab33c0fa16 and 837acfdbaca430cc5e29b7cdbf61380c33ed1aa2 instead of the current version. Which is better than what we have here currently, but it’s not the solution for the null ptr deference.\r\n\r\nThe issue is that empty indexers don’t set the best block to the genesis `CBlockIndex`, they just leave it null. So, the index summary returns a valid height=0 with an empty block hash.. which crashes on the block hash assertion.\r\n\r\nSo, the fix is easy. But.. I haven’t done it because have found another possible index sync \"fatal error\" in master and wanted to fix it prior continue moving forward here.\r\n\r\nEssentially, we are not checking whether the node has the post fork point blocks in disk prior starting the index:\r\n\r\nThe pruning violation checks whether we have blocks from the fork point up to the active chain tip. But it does not check if the node has blocks from the fork point up to the fork tip.. which are required by coinstatsindex to reverse its state during the reorg..\r\n\r\nE.g.\r\n\r\nActive chain\r\nA -> B -> C -> D -> E\r\n\r\nIndex chain\r\nA -> B -> C -> G -> F -> H\r\n\r\nThe “failure error” will happen when G or F are not in disk or were pruned.\r\n\r\nSo, if this happens, it causes a “fatal error“ during the coin stats index reorg process due the impossibility to read the block from disk.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#issuecomment-1544648748",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27607"
    },
    {
      "event": "mentioned",
      "id": 9226618132,
      "node_id": "MEE_lADOABII585ldbL0zwAAAAIl8wUU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9226618132",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-11T20:40:57Z"
    },
    {
      "event": "subscribed",
      "id": 9226618148,
      "node_id": "SE_lADOABII585ldbL0zwAAAAIl8wUk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9226618148",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-11T20:40:57Z"
    },
    {
      "event": "commented",
      "id": 1548248095,
      "node_id": "IC_kwDOABII585cSGQf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1548248095",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-15T17:17:41Z",
      "updated_at": "2023-05-15T17:17:41Z",
      "author_association": "MEMBER",
      "body": "re: https://github.com/bitcoin/bitcoin/pull/27607#issuecomment-1544648748\r\n\r\n> We could also move the entire `hasDataFromTipDown` from the interface to somewhere else in this way. So there is no `CBlockIndex` dependency in the interface neither here nor in the #24230 intermediate commits.\r\n\r\nYes I don't think it makes sense to expose that method as part of the `Chain` interface, and even if it did make sense, it wouldn't make sense to put the implementation in the `ChainImpl` class, because the class is mostly meant to hold glue code, not complicated functions. That's the reason for the suggestion to make it a standalone function `bool ChainDataFromTipDown(ChainstateManager& chainman, const CBlockIndex& start_block)` in https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1191396717\r\n\r\n> And.. I'm also thinking that after #24230 and the parallel sync work (#26966), we could have one initial sync thread with a workers pool for all the indexers instead of the current per indexer sync thread. Which should speedup the sync process quite a lot. We are currently reading the entire chain block by block from disk on every index thread. So instead, we could read blocks just once, then dispatch events to the indexers. Making indexers purely listeners with no associated thread.\r\n\r\nYes letting indexes just receive notifications to get in sync and not have to implement sync logic is the goal of #24230. And the threading issue should be orthogonal after that PR. Indexes (and wallets) could read and process blocks in single thread, or read blocks in a single thread and process them in parallel, or read and process blocks in parallel like happens currently, or use some other form of scheduling. But regardless of what ordering is used, the interface an individual index uses to get in sync should not have to change, and indexes shouldn't have to create sync threads or deal with race conditions between the notification threads and sync threads.\r\n\r\n> I initially thought that the issue was due an initialization ordering, that we weren’t having the active chain activated at that point (thought that was done only post load-blk thread completion).\r\n\r\nOh, I see. That's also what I concluded from seeing the failure, but I guess it is not the complete picture.\r\n\r\n> The issue is that empty indexers don’t set the best block to the genesis `CBlockIndex`, they just leave it null. So, the index summary returns a valid height=0 with an empty block hash.. which crashes on the block hash assertion.\r\n> \r\n> So, the fix is easy.\r\n\r\nI didn't know about this. I guess the fix would be to treat the genesis as the fork point in this case. And to consider the index already synced if there is nochainstate and the genesis pointer is null.\r\n\r\n> But.. I haven’t done it because have found another possible index sync \"fatal error\" in master and wanted to fix it prior continue moving forward here.\r\n\r\nIt seems like it would be a good thing to fix this. But this sounds like something that was already broken, so I'm not sure if the fix has to be bundled here, necessarily. I think the \"has data from tip down\" check is a useful check that can run early and warn if any block data is missing. But if the check isn't perfect and doesn't catch missing block, it shouldn't be the worst thing because the missing blocks will just be reported later rather than earlier.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#issuecomment-1548248095",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27607"
    },
    {
      "event": "reviewed",
      "id": 1429474726,
      "node_id": "PRR_kwDOABII585VNA2m",
      "url": null,
      "actor": null,
      "commit_id": "86752e0cc5bc48f3d4ac1cd07835c37daf078d6a",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "I can't see how the current approach could work, even if the problems discussed above were solved:\r\n\r\nWith this PR, the newly introduced function `update_indexes_start_block` is executed right after creating the index, but before executing `Start()`. But the index is basically just an empty object at this point, because its constructor doesn't interact with the database stored on disk at all. So calling `GetSummary()` can't possibly give any meaningful data about the best block at this stage. The load from disk is being done in `Init()`/`CustomInit()`, but that happens only later within `Start()`.\r\n\r\nI think the necessary order would be to \r\n1) create all indexes and read their best block / other data from disk\r\n2) determine the oldest block for all indexes\r\n3) Do the pruning check once",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#pullrequestreview-1429474726",
      "submitted_at": "2023-05-16T21:37:29Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9262695781,
      "node_id": "HRFPE_lADOABII585ldbL0zwAAAAIoGYVl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9262695781",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-16T21:40:07Z"
    },
    {
      "event": "commented",
      "id": 1550419574,
      "node_id": "IC_kwDOABII585caYZ2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1550419574",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-16T22:09:21Z",
      "updated_at": "2023-05-16T22:09:21Z",
      "author_association": "MEMBER",
      "body": "> I can't see how the current approach could work, even if the problems discussed above were solved:\r\n\r\nGood catch noticing Init() was not called! It doesn't seem like it should be that hard to fix, though. The PR was already moving most of the code out of Init(), anyway, so now a little more code needs to move. I didn't look very deeply but I would probably make Init() a public method and call it after constructing the index. Also stop calling Init() from Start() and move the RegisterValidationInterface() from Start() to Init().",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#issuecomment-1550419574",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27607"
    },
    {
      "event": "commented",
      "id": 1550420156,
      "node_id": "IC_kwDOABII585caYi8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1550420156",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-16T22:10:01Z",
      "updated_at": "2023-05-16T22:33:35Z",
      "author_association": "MEMBER",
      "body": "Thanks for the review @mzumsande.\r\n\r\nFunny that I pushed a small update at the same time that you were commenting.\r\n\r\nHave few more changes on the pipeline that will be pushing soon. e.g. the `hasDataFromTipDown` entire function can be written in two lines.. just need to re-purpose the `GetFirstStoredBlock` function a bit :).\r\n\r\n> I think the necessary order would be to\r\n>\r\n> create all indexes and read their best block / other data from disk\r\ndetermine the oldest block for all indexes\r\nDo the pruning check once\r\n\r\nYeah.. I was thinking on the other issue and forgot that `Init()` isn't being called in the constructor.. :face_palm:. Will re-order it, Thanks!\r\n\r\n\r\n\r\n\r\n\r\n",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#issuecomment-1550420156",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27607"
    },
    {
      "event": "mentioned",
      "id": 9262861781,
      "node_id": "MEE_lADOABII585ldbL0zwAAAAIoHA3V",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9262861781",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-16T22:10:02Z"
    },
    {
      "event": "subscribed",
      "id": 9262861797,
      "node_id": "SE_lADOABII585ldbL0zwAAAAIoHA3l",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9262861797",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-16T22:10:02Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9264536966,
      "node_id": "HRFPE_lADOABII585ldbL0zwAAAAIoNZ2G",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9264536966",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-17T04:35:34Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9264568761,
      "node_id": "HRFPE_lADOABII585ldbL0zwAAAAIoNhm5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9264568761",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-17T04:42:37Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9264575156,
      "node_id": "HRFPE_lADOABII585ldbL0zwAAAAIoNjK0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9264575156",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-17T04:44:05Z"
    },
    {
      "event": "commented",
      "id": 1551406710,
      "node_id": "IC_kwDOABII585ceJZ2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1551406710",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-17T13:31:57Z",
      "updated_at": "2023-05-17T13:35:39Z",
      "author_association": "MEMBER",
      "body": "Looking at current version of the PR 6dfec1b5fbb0f8e95a6134ea8b27e9d6c285d171 it seems to have changed a lot, and the other thing it is doing now is delaying startup of indexes until blocks are loaded, so there is no longer a conflict with `reindex-chainstate`. So it is basically reimplementing #25193 in a different way that doesn't require a `sleep_for(std::chrono::milliseconds(500))` waitloop. I think this approach is cleaner, but also that #25193 is a smaller more targeted change with a test, so I would probably prefer to see #25193 merged first and with this cleanup and rewrite merged later.\r\n\r\n~#25193 also has two ACKs, so I can re-ack and merge it soon.~ EDIT: Never mind, just noticed it needs rebase currently\r\n\r\nOn this PR, I like the approach and thinks the code looks pretty good overall. The only thing I don't like is all the complexity added to AppInitMain(). I think that complexity could go away if you got rid of the `std::set<BaseIndex*> indexers` local variable there and added a `NodeContext` `std::vector<BaseIndex*> indexes` member instead. Then there would be no need for the `func_start_indexes` lambda. The lambda could be replaced with a regular `StartIndexes` function instead.\r\n\r\n",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#issuecomment-1551406710",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27607"
    },
    {
      "event": "commented",
      "id": 1551443566,
      "node_id": "IC_kwDOABII585ceSZu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1551443566",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-17T13:54:24Z",
      "updated_at": "2023-05-17T14:00:11Z",
      "author_association": "MEMBER",
      "body": "Was about to send the updates comment hehe. I was too tired last night to write it. Thanks for the review ryanofsky!\r\n\r\nUpdates list:\r\n\r\n- Decoupled index `Init()` from `Start()`. So indexers can be initialized without spawning the sync thread. \r\n\r\n- Simplified the pruning violation code by re-purposing the `GetFirstStoredBlock` function. Now called `IsBlockDataAvailable`.\r\n\r\n- Fixed a small race, where we set the index `m_synced` flag (which enables `BlockConnected` events) before calling to the child class init function. So, for example, the block filter index could theoretically process a block before initializing the `next filter position` field and end up overwriting the first stored filter.\r\n\r\n-------\r\n\r\nFeedback:\r\n\r\n> Looking at current version of the PR [6dfec1b](https://github.com/bitcoin/bitcoin/commit/6dfec1b5fbb0f8e95a6134ea8b27e9d6c285d171) it seems to have changed a lot, and the other thing it is doing now is delaying startup of indexes until blocks are loaded, so there is no longer a conflict with `reindex-chainstate`. So it is basically reimplementing #25193 in a different way that doesn't require a `sleep_for(std::chrono::milliseconds(500))` waitloop. I think this approach is cleaner, but also that #25193 is a smaller more targeted change with a test, so I would probably prefer to see #25193 merged first and with this cleanup and rewrite merged later.\r\n\r\nYeah, I updated the PR description last night stating that this is now built on top of #25193 (but my slightly modified version of it https://github.com/bitcoin/bitcoin/pull/25193#pullrequestreview-1375021974).\r\n\r\n@mzumsande said that he was going to give them a look and probably take them. So, all good if them get squashed there or here. Either way is fine for me. Happy to re-review #25193 whenever is ready to go again.\r\n\r\n\r\n \r\n> On this PR, I like the approach and thinks the code looks pretty good overall. The only thing I don't like is all the complexity added to AppInitMain(). I think that complexity could go away if you got rid of the `std::set<BaseIndex*> indexers` local variable there and added a `NodeContext` `std::vector<BaseIndex*> indexes` member instead. Then there would be no need for the `func_start_indexes` lambda. The lambda could be replaced with a regular `StartIndexes` function instead.\r\n\r\nSounds great. Was also thinking about moving the lambda to a standalone function but wasn't finding the right place and didn't want to create a new file only for this.\r\n\r\n",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#issuecomment-1551443566",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27607"
    },
    {
      "event": "mentioned",
      "id": 9269782097,
      "node_id": "MEE_lADOABII585ldbL0zwAAAAIohaZR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9269782097",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-17T13:54:25Z"
    },
    {
      "event": "subscribed",
      "id": 9269782117,
      "node_id": "SE_lADOABII585ldbL0zwAAAAIohaZl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9269782117",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-17T13:54:25Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9270730987,
      "node_id": "HRFPE_lADOABII585ldbL0zwAAAAIolCDr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9270730987",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-17T15:12:40Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9271212343,
      "node_id": "HRFPE_lADOABII585ldbL0zwAAAAIom3k3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9271212343",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-17T15:49:29Z"
    },
    {
      "event": "labeled",
      "id": 9272894992,
      "node_id": "LE_lADOABII585ldbL0zwAAAAIotSYQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9272894992",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-17T19:11:44Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9272927968,
      "node_id": "HRFPE_lADOABII585ldbL0zwAAAAIotabg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9272927968",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-17T19:16:05Z"
    },
    {
      "event": "commented",
      "id": 1551934377,
      "node_id": "IC_kwDOABII585cgKOp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1551934377",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-17T19:23:59Z",
      "updated_at": "2023-05-18T14:23:31Z",
      "author_association": "MEMBER",
      "body": "Rebased post #25193 merge. Conflicts solved.\r\n\r\nOnly change from the last push is on the first commit ca30419, where the index threads active wait and the global flag are replaced by a post-poned indexers start call.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#issuecomment-1551934377",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27607"
    },
    {
      "event": "renamed",
      "id": 9273201717,
      "node_id": "RTE_lADOABII585ldbL0zwAAAAIoudQ1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9273201717",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-17T19:55:26Z",
      "rename": {
        "from": "init: verify blocks data existence only once for all the indexers",
        "to": "index: improve initialization and pruning violation checks"
      }
    },
    {
      "event": "renamed",
      "id": 9273208272,
      "node_id": "RTE_lADOABII585ldbL0zwAAAAIoue3Q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9273208272",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-17T19:56:24Z",
      "rename": {
        "from": "index: improve initialization and pruning violation checks",
        "to": "index: improve initialization and pruning violation check"
      }
    },
    {
      "event": "unlabeled",
      "id": 9273851798,
      "node_id": "UNLE_lADOABII585ldbL0zwAAAAIow7-W",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9273851798",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-17T21:29:00Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9280345628,
      "node_id": "HRFPE_lADOABII585ldbL0zwAAAAIpJtYc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9280345628",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-18T14:16:19Z"
    },
    {
      "event": "commented",
      "id": 1553369947,
      "node_id": "IC_kwDOABII585clotb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1553369947",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-18T17:17:02Z",
      "updated_at": "2023-05-18T17:17:02Z",
      "author_association": "MEMBER",
      "body": "CI failure is not related.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#issuecomment-1553369947",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27607"
    },
    {
      "event": "commented",
      "id": 1553376251,
      "node_id": "IC_kwDOABII585clqP7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1553376251",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-18T17:22:48Z",
      "updated_at": "2023-05-18T17:23:03Z",
      "author_association": "MEMBER",
      "body": "See https://github.com/bitcoin/bitcoin/issues/27492#issuecomment-1527772394 about the CI failure",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#issuecomment-1553376251",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27607"
    },
    {
      "event": "commented",
      "id": 1553379017,
      "node_id": "IC_kwDOABII585clq7J",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1553379017",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-18T17:25:23Z",
      "updated_at": "2023-05-18T17:25:39Z",
      "author_association": "MEMBER",
      "body": "re: https://github.com/bitcoin/bitcoin/pull/27607#issue-1702212340\r\n\r\n>* Fixed a small race, where we set the index `m_synced` flag (which enables `BlockConnected` events) before calling to the child class init function. So, for example, the block filter index could theoretically process a block before initializing the next filter position field and end up overwriting the first stored filter.\r\n\r\nCan you clarify this? I don't see m_synced getting set to true before the index is synced, and don't understand the block filter index example.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#issuecomment-1553379017",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27607"
    },
    {
      "event": "commented",
      "id": 1553400917,
      "node_id": "IC_kwDOABII585clwRV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1553400917",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-18T17:42:22Z",
      "updated_at": "2023-05-18T17:44:09Z",
      "author_association": "MEMBER",
      "body": "> re: [#27607 (comment)](https://github.com/bitcoin/bitcoin/pull/27607#issue-1702212340)\r\n> \r\n> > * Fixed a small race, where we set the index `m_synced` flag (which enables `BlockConnected` events) before calling to the child class init function. So, for example, the block filter index could theoretically process a block before initializing the next filter position field and end up overwriting the first stored filter.\r\n> \r\n> Can you clarify this? I don't see m_synced getting set to true before the index is synced, and don't understand the block filter index example.\r\n\r\nSure. The [BaseIndex::Start()](https://github.com/bitcoin/bitcoin/blob/6cc136bbd36f859a16e469bb5c016d06c19bcd50/src/index/base.cpp#L401) flow in master is the following one:\r\n\r\n1) Calls `RegisterValidationInterface()` --> which registers to the validation interface.\r\n2) Calls [BaseIndex::Init()](https://github.com/bitcoin/bitcoin/blob/6cc136bbd36f859a16e469bb5c016d06c19bcd50/src/index/base.cpp#L409) --> which, prior the pruning check, sets [m_synced](https://github.com/bitcoin/bitcoin/blob/6cc136bbd36f859a16e469bb5c016d06c19bcd50/src/index/base.cpp#L109):\r\n    `m_synced = m_best_block_index.load() == active_chain.Tip()`\r\n3) Calls `CustomInit()`.  --> which, for the block index filter, initializes the [m_next_filter_pos](https://github.com/bitcoin/bitcoin/blob/6cc136bbd36f859a16e469bb5c016d06c19bcd50/src/index/blockfilterindex.cpp#L114) field with the db information.\r\n\r\nSo, if the block filter index is synced, and the index receives a `BlockConnected` event after finish point (2) and before point (3) then `m_next_filter_pos` will not be initialized, so `BlockFIlterIndex::CustomAppend()` will use a null `m_next_filter_pos`. ",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#issuecomment-1553400917",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27607"
    },
    {
      "event": "commented",
      "id": 1553414023,
      "node_id": "IC_kwDOABII585clzeH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1553414023",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-18T17:54:19Z",
      "updated_at": "2023-05-18T18:02:41Z",
      "author_association": "MEMBER",
      "body": "Thanks! So the problem is that `m_synced` is set to true before `CustomInit` code runs, instead of after. It looks like this bug was introduced in bef4e405f3de2718dfee279a9abff4daf016da26 from #25494\r\n\r\nEDIT: Added a note in the other PR https://github.com/bitcoin/bitcoin/pull/25494#discussion_r1198123860",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#issuecomment-1553414023",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27607"
    },
    {
      "event": "commented",
      "id": 1553427942,
      "node_id": "IC_kwDOABII585cl23m",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1553427942",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-18T18:05:30Z",
      "updated_at": "2023-05-18T18:05:30Z",
      "author_association": "MEMBER",
      "body": "> Thanks! So the problem is that `m_synced` is set to true before `CustomInit` code runs, instead of after. It looks like this bug was introduced in [bef4e40](https://github.com/bitcoin/bitcoin/commit/bef4e405f3de2718dfee279a9abff4daf016da26) from #25494\r\n\r\nYeah!, that is more or less what I wrote in the description \"Fixed a small race, where we set the index `m_synced` flag (which enables `BlockConnected` events) before calling to the child class init function\".\r\n\r\nHappy to write it differently if it is not good enough. Maybe should change \"child class init function\" for \"CustomInit\"?. (in the commit description it's explained with more details anyway)",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#issuecomment-1553427942",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27607"
    },
    {
      "event": "commented",
      "id": 1553447313,
      "node_id": "IC_kwDOABII585cl7mR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1553447313",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-18T18:23:13Z",
      "updated_at": "2023-05-18T18:23:13Z",
      "author_association": "MEMBER",
      "body": "> Happy to write it differently if it is not good enough. Maybe should change \"child class init function\" for \"CustomInit\"?. (in the commit description it's explained with more details anyway)\r\n\r\nYes if CustomInit was mentioned I probably would have understood better. I would say this PR fixes a race condition where an index's  `CustomAppend` method might be called before its `CustomInit` method, causing the index to try to update itself before it is initialized. And that the PR fixes the problem by always setting `m_synced` to true until after `CustomInit` is called, instead of before. And that the race was introduced in bef4e405f3de2718dfee279a9abff4daf016da26 from #25494",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#issuecomment-1553447313",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27607"
    },
    {
      "event": "commented",
      "id": 1553480215,
      "node_id": "IC_kwDOABII585cmDoX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1553480215",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-18T18:43:13Z",
      "updated_at": "2023-05-18T18:43:13Z",
      "author_association": "MEMBER",
      "body": "sounds good. Description updated, thanks.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#issuecomment-1553480215",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27607"
    },
    {
      "event": "reviewed",
      "id": 1433254608,
      "node_id": "PRR_kwDOABII585VbbrQ",
      "url": null,
      "actor": null,
      "commit_id": "dd9bc393ebd4ba915ca94991390b6e98d29dcfaf",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Reviewed dd9bc393ebd4ba915ca94991390b6e98d29dcfaf, which looks good overall, but I had questions about few things",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#pullrequestreview-1433254608",
      "submitted_at": "2023-05-18T19:16:10Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
    },
    {
      "event": "reviewed",
      "id": 1433308364,
      "node_id": "PRR_kwDOABII585VbozM",
      "url": null,
      "actor": null,
      "commit_id": "dd9bc393ebd4ba915ca94991390b6e98d29dcfaf",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#pullrequestreview-1433308364",
      "submitted_at": "2023-05-18T19:16:43Z",
      "state": "DISMISSED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
    },
    {
      "event": "review_dismissed",
      "id": 9283031643,
      "node_id": "RDE_lADOABII585ldbL0zwAAAAIpT9Jb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9283031643",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-18T19:17:47Z",
      "dismissed_review": {
        "state": "APPROVED",
        "review_id": 1433308364,
        "dismissal_message": "Was just trying to undo request changes, not approve the PR",
        "dismissal_commit_id": null
      }
    },
    {
      "event": "labeled",
      "id": 9286741685,
      "node_id": "LE_lADOABII585ldbL0zwAAAAIpiG61",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9286741685",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-19T07:50:23Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 9287397238,
      "node_id": "UNLE_lADOABII585ldbL0zwAAAAIpkm92",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9287397238",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-19T09:10:16Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1434924256,
      "node_id": "PRR_kwDOABII585VhzTg",
      "url": null,
      "actor": null,
      "commit_id": "dd9bc393ebd4ba915ca94991390b6e98d29dcfaf",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#pullrequestreview-1434924256",
      "submitted_at": "2023-05-19T21:36:17Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9304313407,
      "node_id": "HRFPE_lADOABII585ldbL0zwAAAAIqlI4_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9304313407",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-22T15:42:49Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9304700726,
      "node_id": "HRFPE_lADOABII585ldbL0zwAAAAIqmnc2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9304700726",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-22T16:19:28Z"
    },
    {
      "event": "commented",
      "id": 1557553941,
      "node_id": "IC_kwDOABII585c1mMV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1557553941",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-22T16:41:49Z",
      "updated_at": "2023-05-22T16:41:49Z",
      "author_association": "MEMBER",
      "body": "Feedback tackled, thanks ryanofsky and mzumzande for your deep review!\r\n\r\nThis PR now depends on #27720 and #27708.\r\n\r\nList of changes since the last review:\r\n\r\n* Created #27708 so the post-init shutdown doesn’t introduce any tangible difference for user and tests. (Per https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1198184049 discussion).\r\n\r\n* Moved the `LoadMempool()` call from the blockstorage import function to init.cpp (per https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1199824807 discussion). So the indexes can be started prior starting the mempool (which could take a while) and we don’t keep a mempool related function inside `blockstorage.cpp`.\r\n\r\n* Decoupled the uninitialized index child class race condition into an standalone PR #27720.\r\n\r\n* Fixed a missing init return if `index.Init()` fails.\r\n\r\n* Renamed `IsBlockDataAvailable` to `CheckBlockDataAvailability` and added the missing data availability check for the upper block (https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1199268910).",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#issuecomment-1557553941",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27607"
    },
    {
      "event": "unlabeled",
      "id": 9305843037,
      "node_id": "UNLE_lADOABII585ldbL0zwAAAAIqq-Vd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9305843037",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-22T18:24:28Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "labeled",
      "id": 9305843315,
      "node_id": "LE_lADOABII585ldbL0zwAAAAIqq-Zz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9305843315",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-22T18:24:31Z",
      "label": {
        "name": "UTXO Db and Indexes",
        "color": "fbca04"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9351280914,
      "node_id": "HRFPE_lADOABII585ldbL0zwAAAAItYTkS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9351280914",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-26T14:07:17Z"
    },
    {
      "event": "labeled",
      "id": 9380212539,
      "node_id": "LE_lADOABII585ldbL0zwAAAAIvGq87",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9380212539",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-30T15:50:39Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "referenced",
      "id": 9393660039,
      "node_id": "REFE_lADOABII585ldbL0zwAAAAIv5-CH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9393660039",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "3a83d4417b35cb0173286b6da97315be861901bc",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3a83d4417b35cb0173286b6da97315be861901bc",
      "created_at": "2023-05-31T17:56:43Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDhjNjNkNTUzZGViNmQxNzBiYTUyM2ViMWUxZjYwY2YzNTQ2ZGQxZjk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8c63d553deb6d170ba523eb1e1f60cf3546dd1f9",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/8c63d553deb6d170ba523eb1e1f60cf3546dd1f9",
      "tree": {
        "sha": "0b4db5d39f5381c40515e1ef3e4e2b8d1f24612d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0b4db5d39f5381c40515e1ef3e4e2b8d1f24612d"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 0b4db5d39f5381c40515e1ef3e4e2b8d1f24612d\nparent 3a83d4417b35cb0173286b6da97315be861901bc\nauthor furszy <matiasfurszyfer@protonmail.com> 1684590677 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1685558097 -0300\n\nReturn EXIT_FAILURE on post-init fatal errors\n\nIt seems odd to return `EXIT_SUCCESS` when the node aborted\nexecution due a fatal internal error or any post-init problem\nthat triggers an unrequested shutdown.\n\ne.g. blocks or coins db I/O errors, disconnect block failure,\nfailure during thread import (external blocks loading process\nerror), among others.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmR3k1EACgkQXdI8zGhq\npiMFgw/+I7hhmQSbEtgFm366Tu0oX6IEK0lvz9xeUKI6qamCntnxUY1qmmwNBj2S\no4VHeipCaqVHS7x9HNZfI+0P3AQ3ITeAPTNW1iYh1apnWhriPEWwlz3+Bp6gWNKh\neTWdOFvVflFEGLZozoLhJ+AbMmX/6XJ6l/x9nS565Cm/JVfMtjwX9KnzaJDW6OJb\nPxe9lKmQ2IBnnPBrUnupbIGGQ4/n6eqBVq1kqk6HyMGJOGIXEDgZRNR2OE5P5R43\nDJJaHfIgMtPMl6VzubBFsfpWEWALbpRuJ+ZvoOlu7uYYa616J7nN6yqJI6xGDdmx\nhobwlsGfEWsQiDp9gcfTFi4BAimGZWZNNUvnhFWGQAEx4ybVWahCTP9FK9j+5bAM\nFh3VgGqdx3fy8ODn4QkxF8Qw0aQkA/ZM1cyoYH/lIanwavwYHW/DY7YLqKK9qKsy\n+LrO6QPKlmA+g5GzhdknmXB8dzt5OdhgOro9zhTzzb7qKpNmr8KLa6Qrn2BK+vn1\nVkOzS3voXs5CTtetq1DkoZkWpMKKaj36oiLuSRSudb9R9WUZRXB3PZnAQF0+mq+n\nFzs3kJbUiLCkTtZDsZGAoL10E/N3tjoltSo7wlE9/Whaze82O5I5FgnnXzvd0ZPC\nsGHjPpUECGZOet5+rZmbGR6skvDvlnGZ2I+u/qunHIIE/1Oyr1s=\n=tfCc\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3a83d4417b35cb0173286b6da97315be861901bc",
          "sha": "3a83d4417b35cb0173286b6da97315be861901bc",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/3a83d4417b35cb0173286b6da97315be861901bc"
        }
      ],
      "message": "Return EXIT_FAILURE on post-init fatal errors\n\nIt seems odd to return `EXIT_SUCCESS` when the node aborted\nexecution due a fatal internal error or any post-init problem\nthat triggers an unrequested shutdown.\n\ne.g. blocks or coins db I/O errors, disconnect block failure,\nfailure during thread import (external blocks loading process\nerror), among others.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-05-31T18:34:57Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-05-20T13:51:17Z"
      },
      "sha": "8c63d553deb6d170ba523eb1e1f60cf3546dd1f9"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGY5OGMxNzExYTNlOGUxZTdkYTliZjg4NmNkNzZlZmZhYWEwZWNiZWQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f98c1711a3e8e1e7da9bf886cd76effaaa0ecbed",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/f98c1711a3e8e1e7da9bf886cd76effaaa0ecbed",
      "tree": {
        "sha": "908094f82408280597c68a46b3800f55f18a5294",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/908094f82408280597c68a46b3800f55f18a5294"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 908094f82408280597c68a46b3800f55f18a5294\nparent 8c63d553deb6d170ba523eb1e1f60cf3546dd1f9\nauthor furszy <matiasfurszyfer@protonmail.com> 1684769224 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1685558097 -0300\n\nrefactor: move 'LoadMempool' call out of blockstorage.cpp\n\nand rename 'ThreadImport' to 'ImportBlocks'.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmR3k1EACgkQXdI8zGhq\npiM5Cw/9FZ3sv2I82CcUlB5nNvfvZKxQ7vfDiPtKtToHhJJyHd6zqt0FmoQAcT3B\nFyNSrbe7GxkCYbXTZQOBCxhtdPOzw9Ucf26HoPeZPkdR1azwu6JDJ+AacEzz5u3k\nntHK+pkQt/NeUQk9bTTL/ondrKFlV0DGPQzDQgkMYE9+k9RurHTXlD/iS7AK6AtY\nZpr5P7r3RC4uyCk2w66isUa1SUGSQnvg9hWYTkWI3XNMrxLKY6hH9KNrR6OEOKTb\nSgyIBqFG/PO3hM90qAINIVo4qDqXVb17J0JiysVLjdeJmEtt2bwhKNxMN67scdqG\nnnCIPw6FgLBqMqaT4m8Yn2MNnvpsqRPeosy4xDgzgJbN44TdV0g3wjNCjC8gnYfh\nBRUe/smtFxTHIMtsLlcKMBAtajlAK3qzwl0prpyJS2XUxKgnkV9eioZrsFubO/U1\nHE70gYf42b+9QDpZ434RBbzOs5OLdiV1c6dDKJp+ed5gehW3Wcw2FqP3vMo1ow+Y\nZYeiK/gsnN6GHWOyZySalHm5kwhDVvRFZ43dlaPNZMwEW4TqXsFerzLtYeuhSA4f\nN4gdxIlcPNkL6kyKMbxrPvQ1wiHWTLq3vztqVtEl3akhzCYstXQn8YBqogqsFeJs\nMY5ppZdTcwFl+yQ69WqsMHQZVIVLO9VmYKRsw2Oa1oBrGRaxK4A=\n=Rew7\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8c63d553deb6d170ba523eb1e1f60cf3546dd1f9",
          "sha": "8c63d553deb6d170ba523eb1e1f60cf3546dd1f9",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/8c63d553deb6d170ba523eb1e1f60cf3546dd1f9"
        }
      ],
      "message": "refactor: move 'LoadMempool' call out of blockstorage.cpp\n\nand rename 'ThreadImport' to 'ImportBlocks'.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-05-31T18:34:57Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-05-22T15:27:04Z"
      },
      "sha": "f98c1711a3e8e1e7da9bf886cd76effaaa0ecbed"
    },
    {
      "event": "referenced",
      "id": 9394035217,
      "node_id": "REFE_lADOABII585ldbL0zwAAAAIv7ZoR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9394035217",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "9ec40ffad20b44a5e0dc76626ae3be8a6522aa25",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/9ec40ffad20b44a5e0dc76626ae3be8a6522aa25",
      "created_at": "2023-05-31T18:40:23Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDZlNDA3MjUwMDZiNjQ3ZDFhYjhjNWU3Yjg5YmI3YTExZTdmZGVkOGM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6e40725006b647d1ab8c5e7b89bb7a11e7fded8c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/6e40725006b647d1ab8c5e7b89bb7a11e7fded8c",
      "tree": {
        "sha": "94e3e0ced815bb9fa3e10306b853b678598b4cd3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/94e3e0ced815bb9fa3e10306b853b678598b4cd3"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 94e3e0ced815bb9fa3e10306b853b678598b4cd3\nparent f98c1711a3e8e1e7da9bf886cd76effaaa0ecbed\nauthor furszy <matiasfurszyfer@protonmail.com> 1684350415 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1685558537 -0300\n\ninit: start indexes after the loadblk thread finishes\n\nThis ensures us that the active chain will be available\nprior starting the indexes. Which let us remove the\nthreads active wait and the `g_indexes_ready_to_sync`\nglobal flag.\n\nThe feature_index_prune.py change is because the index\npruning violation checks are now performed in a separate\nthread, not the init one. So the error is treated as a\npost-init shutdown instead of a synchronous init error.\n\nExtra note: the checks performed inside `StartIndexes`\nwill be expanded in subsequent commits.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmR3lQoACgkQXdI8zGhq\npiNfGg/+OaDkWeoAApYLXG6U9fGjJFENCQlu+sGziV0qnzyIc8f74iGf7IHMJBFn\nFvUuQrnG5DlRfxLskqKJ7Oj/G92NWD+A4bwOyJJs5zaHZhZ+hG5uL6bYbqZi9iv1\nXllj5rJR/tL/K4+k94H2zNbTQ39Tv/wWBv+hq3q0zQC1tCAlq+fqTP7d+NQjyN6X\nHgGmEe1DC+XFP+0+ZLg0hMv/d6wUKEUa4UVKl+82Vj+Zmx/WrDZOj1SvQXrqKO40\nF6pwReMFcoM30RutGk0UKUx0QIyDlCf77GyeILbp85Ylp4g/3Kj5EidQzotIeUtm\neqoCKxxMfpdn1geF0yW0EdUjHXrlph8iN9djKT8gouXuyZ2mRJNjrvIA5F9GbjPH\nivk3CXaG4uw/sGoKk5h9ku6r6nfTk7lQoC7b80OtzplNtMmIC3N/1sK0iYEsBixf\nPB+DO0eHKqSWJElezNZyUjlfmfWKPpvG1w3uql/tIfuaBOURpGiThRlxfVdYJQhW\nRFQ6buCa21gttRcWD1EsBABD5cBoh8bcp1qCpQ9OiPIfBoF4OhJErMCaZXRUxEGK\nEVhtUqRW/80lsAhHTDHJ6hW6LsSTXikWwI+dMIA/tjQbJLPsNv/wF87eUPBBsQcS\nsjAcrmy8l4xUIYHzn/ixph+xP/MPsvVG9fYpSy3uPhQLU8hMm3A=\n=up1A\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f98c1711a3e8e1e7da9bf886cd76effaaa0ecbed",
          "sha": "f98c1711a3e8e1e7da9bf886cd76effaaa0ecbed",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/f98c1711a3e8e1e7da9bf886cd76effaaa0ecbed"
        }
      ],
      "message": "init: start indexes after the loadblk thread finishes\n\nThis ensures us that the active chain will be available\nprior starting the indexes. Which let us remove the\nthreads active wait and the `g_indexes_ready_to_sync`\nglobal flag.\n\nThe feature_index_prune.py change is because the index\npruning violation checks are now performed in a separate\nthread, not the init one. So the error is treated as a\npost-init shutdown instead of a synchronous init error.\n\nExtra note: the checks performed inside `StartIndexes`\nwill be expanded in subsequent commits.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-05-31T18:42:17Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-05-17T19:06:55Z"
      },
      "sha": "6e40725006b647d1ab8c5e7b89bb7a11e7fded8c"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGYzY2NhNTk2ZTIxZTI2NzBlYzE4ZDU1ZmNlZTQyZTUxZGE1MTM0MzE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f3cca596e21e2670ec18d55fcee42e51da513431",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/f3cca596e21e2670ec18d55fcee42e51da513431",
      "tree": {
        "sha": "8891e18fcf8bfb1745e8ff7f84db64c03817b2e3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8891e18fcf8bfb1745e8ff7f84db64c03817b2e3"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 8891e18fcf8bfb1745e8ff7f84db64c03817b2e3\nparent 6e40725006b647d1ab8c5e7b89bb7a11e7fded8c\nauthor furszy <matiasfurszyfer@protonmail.com> 1684275546 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1685559048 -0300\n\nrefactor: simplify pruning violation check\n\nand add 'IsBlockDataAvailable' function.\n\nthis commit shouldn't change behavior in any way.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmR3lwgACgkQXdI8zGhq\npiNODxAAx+c5doi9icaGgvJh3hnEf1PHTg90S5RwCS9v/9wyAEAIIAVuCBWeR+nl\n14rdpYbP//kuU+n991SKXI98ayR0HLKKqGvHDcY6ZMQrbTICNtfY0I0WwLiLo/xf\nFwDiaRzhDuNMlSDMWV62AivTOvagXUg3pUcdrYlz1zGtSgSDgsTVZYdx+aLPB7tl\nFBBP5HmA8Wwg7gqNrxJHtWAnuC8YnhTyjFd7vkVZ+Irk+WFLG7ntvbVybUUy18aJ\nTlWVp+l4oI58mTPCDIsmD9+DviR1p0/yAdtdMpUzDFGgRG4/gVolun2KE54NED92\ngcNK8wjFSJ8e/KCmCZl5dtXWenewRll8uc7FBJkxR7J1rYkhwLAR4FAiNUfCjrKa\nwHgpCBtyDP6Saf3NMUG6SoJF1k5FV+umcbMKjixFiAehHOZWvcejk+shSDUGecD0\nvDpnP9pp/SXyDraFn+5ndLeM7DzHFWYUaSSfIlsx9155aFlflvxOPYSXQbh0ker0\nEAN3F0zKx0uGX6MfhMxAqg2bBp85pDylLvcCGpbHkN/Xjq3renFodVMJqSmqVDDo\nCJsY1/DE9iC8qXNJ9U6odt2JyBSyKoCwNp8XQrh3XNKOVyV3rwzitv9YtgzjacMV\n1/iHL2aOYBwqEikYssZwktvk4e0qkNabgDhiXG2TFXB6oHwkxNE=\n=QXcA\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6e40725006b647d1ab8c5e7b89bb7a11e7fded8c",
          "sha": "6e40725006b647d1ab8c5e7b89bb7a11e7fded8c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/6e40725006b647d1ab8c5e7b89bb7a11e7fded8c"
        }
      ],
      "message": "refactor: simplify pruning violation check\n\nand add 'IsBlockDataAvailable' function.\n\nthis commit shouldn't change behavior in any way.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-05-31T18:50:48Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-05-16T22:19:06Z"
      },
      "sha": "f3cca596e21e2670ec18d55fcee42e51da513431"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGU2MDY0ZDExNWY2OTc3MmYxNzlmODRlNGMzMzk4ZTg2YjgyOGJlYTY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e6064d115f69772f179f84e4c3398e86b828bea6",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/e6064d115f69772f179f84e4c3398e86b828bea6",
      "tree": {
        "sha": "5b4c1f4acb095ecf1c7d99de73f07abf5adea2c3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5b4c1f4acb095ecf1c7d99de73f07abf5adea2c3"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 5b4c1f4acb095ecf1c7d99de73f07abf5adea2c3\nparent f3cca596e21e2670ec18d55fcee42e51da513431\nauthor furszy <matiasfurszyfer@protonmail.com> 1684766582 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1685559048 -0300\n\nMake CheckBlockDataAvailability return nullptr if 'upper_block' has no data\n\nSame as with GetFirstStoredBlock(), it cannot happen currently\nbut better to fix it now.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmR3lwgACgkQXdI8zGhq\npiN4DQ//dB61HDU4RLvytAgY+62Fvxec5L0t/cMNhv8nqXJNmWiaD0+qO6Y0mbON\nxLJr2C5EkJ2unJEgz+yxQA6O0WyJPwAAU/4A/1Z7r08YBJfs2ur+5fBL8/GIjLH2\nYHPDFBjqtFYIhDVR+UrjP3Zn3DvHEQ/dOE9rGSEgq4sGNRLoSHXvbXYSRmeFTvw1\n66bofGX8MApE4IpqlFUKzs8wUJ1nYhE2Nmz6mb6OE2CGDheYv/PvWxz2w9C32OQz\nQh/viI/cbHfRSfgyX3YC9YLcuZJooGu48IA5veNdVGofeM7SVbZ0JaNCAJqMKPFY\n0gbDuf9FrZlqnaI7WkgR/cVycBXhvB8gg+VTVTq+fkGsRbftwc64Qz0B/brR5ldD\n5ymJvzbI/WzFKKLcg11NlYTPEbEbgHfUUIVzxPG3uqcqPrB3reo1I2LSJjsphQVo\nX3OJ987EMO1bnj20Chh7aGNxa1448ObmhTx9R8a4jtovIazOZHUtPlSNP13eV0Sg\n6q5QZQ2UzobxNP+fJnIZbaWUgTeMXO+Fpcr7LuQpKea5E1Pcco2Hn715ckS3u+V8\nfaeDF0Aj6F/avfyelE9nqae9ljOXZ+4bXySedbxayK9+fNFx3uPAP/xw3vEIcG0B\npG8QIl9kndJpXzi9AnjFJ75KSDobf75Aito/3lnpMx6GhDcF3rw=\n=7t/3\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f3cca596e21e2670ec18d55fcee42e51da513431",
          "sha": "f3cca596e21e2670ec18d55fcee42e51da513431",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/f3cca596e21e2670ec18d55fcee42e51da513431"
        }
      ],
      "message": "Make CheckBlockDataAvailability return nullptr if 'upper_block' has no data\n\nSame as with GetFirstStoredBlock(), it cannot happen currently\nbut better to fix it now.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-05-31T18:50:48Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-05-22T14:43:02Z"
      },
      "sha": "e6064d115f69772f179f84e4c3398e86b828bea6"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDhjZTRkMDhkYTM0MDMyYTE1MmQyMDI0NmY2ZWY0NTg2N2ZkM2JjNmM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8ce4d08da34032a152d20246f6ef45867fd3bc6c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/8ce4d08da34032a152d20246f6ef45867fd3bc6c",
      "tree": {
        "sha": "1e72f8a2be2c820e99d757f09b16e67e0234b6e1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1e72f8a2be2c820e99d757f09b16e67e0234b6e1"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 1e72f8a2be2c820e99d757f09b16e67e0234b6e1\nparent e6064d115f69772f179f84e4c3398e86b828bea6\nauthor furszy <matiasfurszyfer@protonmail.com> 1684295709 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1685559048 -0300\n\nrefactor: index, decouple 'Init' from 'Start'\n\nLetting indexes be initialized without spawning\nthe sync thread.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmR3lwgACgkQXdI8zGhq\npiMofhAAppWTq+v5CMJFpEOBUBE8P6oQr5jKS6HUxVtj4wMSYvatcAaOpFAzILay\nk7yfM4qqouausQzP/f7HR4r+VefnAMCwr1OQYzlrc8VWCuALxrlbY5od0f/m3ZbI\ngOvTkEdJ/dGVIGigqEU08mdeBDO0wi9h9J7QVL1prZym3morwXzk37uX62PHrDXx\nmtGK9nuI2Bf2Dz67C9ebtkGk5/Yy2rQ1tYLfUjQMHOTXDIsWEngdIHK93oMX/L4p\n4l4bn1glEibynE0wFJkOS2jxm9cacdV7RSXJsVSe7SSKE8P4XdiKOVfVI8Yz6J0J\nzI9AuCLHsutj1U5ugi15TgMFpB02KI2L/XtrNvgweW90foRaI7QRR3o732V7gnwZ\nc4g9cFjQJssKrFHgQUKRDsjgtYWK1Qp6U+JxDf7bH13gzMmLkPBP6SdTUgoV+H3C\nEgEHG7AWwCEgjU4AswnNKVJsxlkguPB5p5yZLWiYe3q0ZlAWoJpBSCac3xpdl/zR\nFUrn+GhZtXvgOWA+RsDgw8qMaT/m7v3svS+7vjvcPk8TKEdMKQNY/qpXH664TTtk\nM5ehv5APZRI+y0tkCttbV1uMJhzwmRhd5U8GAhfQrq5A4L0WYDMvRgU+8isJY8Gm\naWaxuKjqElQUV6bFce/YtC+JgWAtq3qGgvQ9OQz0EdW4l7KIyQo=\n=kNZs\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e6064d115f69772f179f84e4c3398e86b828bea6",
          "sha": "e6064d115f69772f179f84e4c3398e86b828bea6",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/e6064d115f69772f179f84e4c3398e86b828bea6"
        }
      ],
      "message": "refactor: index, decouple 'Init' from 'Start'\n\nLetting indexes be initialized without spawning\nthe sync thread.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-05-31T18:50:48Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-05-17T03:55:09Z"
      },
      "sha": "8ce4d08da34032a152d20246f6ef45867fd3bc6c"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDg5NDc3YmVjNGVmM2MwNWIxNjMwYjc2MzViNGJjYmMwOWMyNGI5OGE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/89477bec4ef3c05b1630b7635b4bcbc09c24b98a",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/89477bec4ef3c05b1630b7635b4bcbc09c24b98a",
      "tree": {
        "sha": "8b78551e08d03167cfeb30c9e9a98ac7833deeee",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8b78551e08d03167cfeb30c9e9a98ac7833deeee"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 8b78551e08d03167cfeb30c9e9a98ac7833deeee\nparent 8ce4d08da34032a152d20246f6ef45867fd3bc6c\nauthor furszy <matiasfurszyfer@protonmail.com> 1684272935 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1685559228 -0300\n\nindex: verify blocks data existence only once\n\nAt present, during init, we traverse the chain (once per index)\nto confirm that all necessary blocks to sync each index up to\nthe current tip are present.\n\nTo make the process more efficient, we can fetch the oldest block\nfrom the indexers and perform the chain data existence check from\nthat point only once.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmR3l7wACgkQXdI8zGhq\npiPxnBAAnq8GM/HfAvmiheXRwLPFO3DVIDi4QXclPYchgd2ngGvIPLUx780AfCjX\ndegNPPu+kmfU/UlOAEdNnBfE3MNe7Pl28znPnUkoB9GBVdPRYBn9PLhnoOYLa3/L\nmsiYrdhgYPNBbCscRj9HK/iOSNXZmvtkeW1oiec3lI3pJpauOfvJiKX3TPNYdaqW\nphJ6gGksdl7xnQSzZ1ug58BXpau/fMXupvR+8/kfTkDfdtkgatPEWcAhoISncKEk\nG8AkXjKNG5HYHBcY21aftW3DlVAWI5/0m1d8pksbL0jA8x2C3Phcp6jA6Vt1cbsg\ndbKc+FbaCHC0npmSWTLYQsGJc6Pe7TYXzCgSedB54B/CYBOlbZhVfjY1c7YdjU7N\nbsad6ryDJj0+X+vpH+6xdWT4vNPUsXRY02HCef+cVd/A/4YwyRL4tZUnl//TMe8k\nNIjuywN6TYe57SF7kqc6vKWY026kpSdBFeqyBfeWpOKnW5vCWMTyXQkPQBvqniQq\ns828f9ncT/9tHxF/3jg64lrNNU+E90UN0bRLHI2a/m27eJXGcr4LBfIICWyvDziE\nlg4Yx5uWYYGrVB1YYl4q6OGOqH0NKK7tlk1yb8fGSb/ZTCc3zA+SAqMMFO7UFMNz\nlGurCcGGXUQZwGxK7X92ALXKD8ro0DPQMkPjYXNVJM0nAy8apOA=\n=lgwx\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8ce4d08da34032a152d20246f6ef45867fd3bc6c",
          "sha": "8ce4d08da34032a152d20246f6ef45867fd3bc6c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/8ce4d08da34032a152d20246f6ef45867fd3bc6c"
        }
      ],
      "message": "index: verify blocks data existence only once\n\nAt present, during init, we traverse the chain (once per index)\nto confirm that all necessary blocks to sync each index up to\nthe current tip are present.\n\nTo make the process more efficient, we can fetch the oldest block\nfrom the indexers and perform the chain data existence check from\nthat point only once.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-05-31T18:53:48Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-05-16T21:35:35Z"
      },
      "sha": "89477bec4ef3c05b1630b7635b4bcbc09c24b98a"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9394230591,
      "node_id": "HRFPE_lADOABII585ldbL0zwAAAAIv8JU_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9394230591",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-31T18:56:05Z"
    },
    {
      "event": "unlabeled",
      "id": 9394408124,
      "node_id": "UNLE_lADOABII585ldbL0zwAAAAIv80q8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9394408124",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-31T19:11:25Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191329811",
      "pull_request_review_id": 1422846165,
      "id": 1191329811,
      "node_id": "PRRC_kwDOABII585HAkAT",
      "diff_hunk": "@@ -390,7 +385,11 @@ IndexSummary BaseIndex::GetSummary() const\n     IndexSummary summary{};\n     summary.name = GetName();\n     summary.synced = m_synced;\n-    summary.best_block_height = m_best_block_index ? m_best_block_index.load()->nHeight : 0;\n+    if (m_best_block_index) {\n+        const CBlockIndex* pindex = m_best_block_index.load();",
      "path": "src/index/base.cpp",
      "position": null,
      "original_position": 18,
      "commit_id": "89477bec4ef3c05b1630b7635b4bcbc09c24b98a",
      "original_commit_id": "86752e0cc5bc48f3d4ac1cd07835c37daf078d6a",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"index: verify blocks data existence only once\" (86752e0cc5bc48f3d4ac1cd07835c37daf078d6a)\r\n\r\nNot important in practice, but since `m_best_block_index` is an atomic variable, it would look a little better to retrieve it atomically with:\r\n\r\n```\r\n    if (const CBlockIndex* pindex = m_best_block_index.load()) {\r\n```",
      "created_at": "2023-05-11T15:09:55Z",
      "updated_at": "2023-05-11T16:10:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1191329811",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191329811"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
        }
      },
      "start_line": null,
      "original_start_line": 388,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 389,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191383733",
      "pull_request_review_id": 1422846165,
      "id": 1191383733,
      "node_id": "PRRC_kwDOABII585HAxK1",
      "diff_hunk": "@@ -1562,32 +1562,55 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n                                      chainman, *node.mempool, ignores_incoming_txs);\n     RegisterValidationInterface(node.peerman.get());\n \n-    // ********************************************************* Step 8: start indexers\n+    // ********************************************************* Step 8: init indexers\n+\n+    // Cache the first block required by the indexes\n+    const CBlockIndex* indexes_start_block{nullptr};\n+    std::string older_index_name;\n+    const auto& update_indexes_start_block = [&](const BaseIndex* index){\n+        const IndexSummary& summary = index->GetSummary();\n+        if (summary.synced) return;\n+        const CBlockIndex* pindex = WITH_LOCK(::cs_main, return chainman.ActiveChain()[summary.best_block_height]);\n+        // indexes are always initialized to the active chain last common block\n+        assert(pindex->GetBlockHash() == summary.best_block_hash);",
      "path": "src/init.cpp",
      "position": null,
      "original_position": 15,
      "commit_id": "89477bec4ef3c05b1630b7635b4bcbc09c24b98a",
      "original_commit_id": "86752e0cc5bc48f3d4ac1cd07835c37daf078d6a",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"index: verify blocks data existence only once\" (86752e0cc5bc48f3d4ac1cd07835c37daf078d6a)\r\n\r\nIn the case where the bitcoind datadir is being newly created and the `LoadChainState` call above doesn't set a chain tip, `pindex` will be null here and this line will segfault. It should be possible to handle this with `if (!pindex) return`. This is causing CI errors (https://cirrus-ci.com/task/4539645451567104) currently",
      "created_at": "2023-05-11T15:49:13Z",
      "updated_at": "2023-05-11T16:10:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1191383733",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191383733"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1575,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191390577",
      "pull_request_review_id": 1422846165,
      "id": 1191390577,
      "node_id": "PRRC_kwDOABII585HAy1x",
      "diff_hunk": "@@ -725,6 +725,39 @@ class ChainImpl : public Chain\n     {\n         ::uiInterface.ShowProgress(title, progress, resume_possible);\n     }\n+    bool hasDataFromTipDown(const CBlockIndex* start_block) override {",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "89477bec4ef3c05b1630b7635b4bcbc09c24b98a",
      "original_commit_id": "1341793b928ba81205b1cea11fdbd52fe6c3e869",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"indexes, refactor: Remove index prune_violation code\" (1341793b928ba81205b1cea11fdbd52fe6c3e869)\r\n\r\nNote for reviewers: code in this function is moved from the BaseIndex::Init function with minor changes. An easy way to review it is to look at the before and after versions in a side by side diff.",
      "created_at": "2023-05-11T15:54:34Z",
      "updated_at": "2023-05-11T16:10:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1191390577",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191390577"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 728,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191396717",
      "pull_request_review_id": 1422846165,
      "id": 1191396717,
      "node_id": "PRRC_kwDOABII585HA0Vt",
      "diff_hunk": "@@ -725,6 +725,39 @@ class ChainImpl : public Chain\n     {\n         ::uiInterface.ShowProgress(title, progress, resume_possible);\n     }\n+    bool hasDataFromTipDown(const CBlockIndex* start_block) override {",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "89477bec4ef3c05b1630b7635b4bcbc09c24b98a",
      "original_commit_id": "1341793b928ba81205b1cea11fdbd52fe6c3e869",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"indexes, refactor: Remove index prune_violation code\" (1341793b928ba81205b1cea11fdbd52fe6c3e869)\r\n\r\nIt would probably make more sense to make this method into a standalone function `bool ChainDataFromTipDown(ChainstateManager& chainman, const CBlockIndex& start_block)` function in someplace like `src/node/chainstate.cpp` than to add it to interfaces::Chain if it won't be called by chain clients like wallets or indexes.",
      "created_at": "2023-05-11T15:59:32Z",
      "updated_at": "2023-05-11T16:10:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1191396717",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1191396717"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 728,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198165818",
      "pull_request_review_id": 1433254608,
      "id": 1198165818,
      "node_id": "PRRC_kwDOABII585Hao86",
      "diff_hunk": "@@ -1665,13 +1655,20 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     }\n #endif\n \n-    std::vector<fs::path> vImportFiles;\n-    for (const std::string& strFile : args.GetArgs(\"-loadblock\")) {\n-        vImportFiles.push_back(fs::PathFromString(strFile));\n-    }\n+    chainman.m_load_block = std::thread(&util::TraceThread, \"loadblk\", [&chainman, &args, &node] {\n+        std::vector<fs::path> vImportFiles;\n+        for (const std::string& strFile : args.GetArgs(\"-loadblock\")) {\n+            vImportFiles.push_back(fs::PathFromString(strFile));\n+        }\n \n-    chainman.m_load_block = std::thread(&util::TraceThread, \"loadblk\", [=, &chainman, &args] {\n         ThreadImport(chainman, vImportFiles, ShouldPersistMempool(args) ? MempoolPath(args) : fs::path{});\n+\n+        // Start indexers",
      "path": "src/init.cpp",
      "position": null,
      "original_position": 61,
      "commit_id": "89477bec4ef3c05b1630b7635b4bcbc09c24b98a",
      "original_commit_id": "ca3041984cf3665e27b6783c923ab1c32682500a",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"init: start indexes after the loadblk thread finishes\" (ca3041984cf3665e27b6783c923ab1c32682500a)\r\n\r\nCould we change \"indexers\" to \"indexes\" in all new code? I don't think distinguishing between an \"index\" and \"indexer\" really clarifies anything, and the word \"indexers\" seems a little odd and unexpected.",
      "created_at": "2023-05-18T18:35:25Z",
      "updated_at": "2023-05-18T19:16:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1198165818",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198165818"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1666,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198184049",
      "pull_request_review_id": 1433254608,
      "id": 1198184049,
      "node_id": "PRRC_kwDOABII585HatZx",
      "diff_hunk": "@@ -1665,13 +1655,20 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     }\n #endif\n \n-    std::vector<fs::path> vImportFiles;\n-    for (const std::string& strFile : args.GetArgs(\"-loadblock\")) {\n-        vImportFiles.push_back(fs::PathFromString(strFile));\n-    }\n+    chainman.m_load_block = std::thread(&util::TraceThread, \"loadblk\", [&chainman, &args, &node] {\n+        std::vector<fs::path> vImportFiles;\n+        for (const std::string& strFile : args.GetArgs(\"-loadblock\")) {\n+            vImportFiles.push_back(fs::PathFromString(strFile));\n+        }\n \n-    chainman.m_load_block = std::thread(&util::TraceThread, \"loadblk\", [=, &chainman, &args] {\n         ThreadImport(chainman, vImportFiles, ShouldPersistMempool(args) ? MempoolPath(args) : fs::path{});\n+\n+        // Start indexers\n+        if (!StartIndexes(node)) {",
      "path": "src/init.cpp",
      "position": 69,
      "original_position": 62,
      "commit_id": "89477bec4ef3c05b1630b7635b4bcbc09c24b98a",
      "original_commit_id": "ca3041984cf3665e27b6783c923ab1c32682500a",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"init: start indexes after the loadblk thread finishes\" (ca3041984cf3665e27b6783c923ab1c32682500a)\r\n\r\nOne side-effect of this change is that now if there is a \"best block of the index goes beyond pruned data\" error, bitcoind successfully starts and returns 0 then exits, where previously it could fail early and actually return an error code.\r\n\r\nThat aspect of the previous behavior seems better to me, though I'm not sure what the tradeoffs are. \r\n\r\nDo you think the the main benefit of this commit is cleaner code, and the worse error detection a side effect? Or are there other benefits to this commit?\r\n\r\nI'm thinking the PR is doing a lot of things and maybe it would be good to split into smaller PRs where possible. Especially if the smaller PRs can be unambiguous improvements.",
      "created_at": "2023-05-18T18:48:33Z",
      "updated_at": "2023-05-18T19:16:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1198184049",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198184049"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1682,
      "original_line": 1682,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198191133",
      "pull_request_review_id": 1433254608,
      "id": 1198191133,
      "node_id": "PRRC_kwDOABII585HavId",
      "diff_hunk": "@@ -216,8 +216,13 @@ class BlockManager\n     //! Returns last CBlockIndex* that is a checkpoint\n     const CBlockIndex* GetLastCheckpoint(const CCheckpointData& data) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    //! Returns 'lower_block' if all blocks up to that point are available in disk, otherwise returns the first block that is not pruned in the upper-lower range.\n+    //! If 'lower_block=nullptr': verify blocks availability up to the genesis block.\n+    //! Returns nullptr if 'lower_block' is not an 'upper_block' ancestry.\n+    const CBlockIndex* IsBlockDataAvailable(const CBlockIndex& upper_block LIFETIMEBOUND, const CBlockIndex* lower_block=nullptr) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n+\n     //! Find the first block that is not pruned\n-    const CBlockIndex* GetFirstStoredBlock(const CBlockIndex& start_block LIFETIMEBOUND) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n+    const CBlockIndex* GetFirstStoredBlock(const CBlockIndex& upper_block LIFETIMEBOUND) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);",
      "path": "src/node/blockstorage.h",
      "position": null,
      "original_position": 11,
      "commit_id": "89477bec4ef3c05b1630b7635b4bcbc09c24b98a",
      "original_commit_id": "704c9e4cf67468708db655226a78489b92ef0523",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"index: simplify pruning violation check\" (704c9e4cf67468708db655226a78489b92ef0523)\r\n\r\nWould be good to make this declaration use the same argument name as the definition which is `BlockManager::GetFirstStoredBlock(const CBlockIndex& start_block)`",
      "created_at": "2023-05-18T18:53:45Z",
      "updated_at": "2023-05-18T19:16:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1198191133",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198191133"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 225,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198193156",
      "pull_request_review_id": 1433254608,
      "id": 1198193156,
      "node_id": "PRRC_kwDOABII585HavoE",
      "diff_hunk": "@@ -106,36 +106,16 @@ bool BaseIndex::Init()\n     // via `BlockConnected` signals until, possibly, the next restart.\n     m_synced = m_best_block_index.load() == active_chain.Tip();\n     if (!m_synced) {\n-        bool prune_violation = false;\n-        if (!m_best_block_index) {\n-            // index is not built yet\n-            // make sure we have all block data back to the genesis\n-            prune_violation = m_chainstate->m_blockman.GetFirstStoredBlock(*active_chain.Tip()) != active_chain.Genesis();\n+        const CBlockIndex* start_block = m_best_block_index.load();\n+        if (!start_block) start_block = active_chain.Genesis();\n+        if (!active_chain.Contains(start_block)) {\n+            // if the bestblock is not part of the mainchain, find the fork\n+            // so we can make sure we have all data down to the fork\n+            start_block = active_chain.FindFork(start_block);\n         }\n-        // in case the index has a best block set and is not fully synced\n-        // check if we have the required blocks to continue building the index\n-        else {\n-            const CBlockIndex* block_to_test = m_best_block_index.load();\n-            if (!active_chain.Contains(block_to_test)) {\n-                // if the bestblock is not part of the mainchain, find the fork\n-                // and make sure we have all data down to the fork\n-                block_to_test = active_chain.FindFork(block_to_test);\n-            }\n-            const CBlockIndex* block = active_chain.Tip();\n-            prune_violation = true;\n-            // check backwards from the tip if we have all block data until we reach the indexes bestblock\n-            while (block_to_test && block && (block->nStatus & BLOCK_HAVE_DATA)) {\n-                if (block_to_test == block) {\n-                    prune_violation = false;\n-                    break;\n-                }\n-                // block->pprev must exist at this point, since block_to_test is part of the chain\n-                // and thus must be encountered when going backwards from the tip\n-                assert(block->pprev);\n-                block = block->pprev;\n-            }\n-        }\n-        if (prune_violation) {\n+\n+        // make sure we have all block data back to the start block\n+        if (m_chainstate->m_blockman.IsBlockDataAvailable(*active_chain.Tip(), start_block) != start_block) {",
      "path": "src/index/base.cpp",
      "position": null,
      "original_position": 42,
      "commit_id": "89477bec4ef3c05b1630b7635b4bcbc09c24b98a",
      "original_commit_id": "704c9e4cf67468708db655226a78489b92ef0523",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"index: simplify pruning violation check\" (704c9e4cf67468708db655226a78489b92ef0523)\r\n\r\nCould the commit message clarify if any behavior is changing here? Would be good to label it a refactoring and say it does not change behavior if nothing is changing, and say what is changing otherwise.\r\n\r\nAlso, it seems like new code that is added here just gets moved / deleted later in the PR in the last commit \"index: verify blocks data existence only once\" (dd9bc393ebd4ba915ca94991390b6e98d29dcfaf).\r\n\r\nI could be missing something, but it seems like the PR would be easier to review if this commit only added the `IsBlockDataAvailable` function, the other commit started calling it, so reviewers would only need to review one new version of the pruned data check, instead of reviewing a temporary version that gets thrown away and then another final version.",
      "created_at": "2023-05-18T18:55:54Z",
      "updated_at": "2023-05-18T19:16:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1198193156",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198193156"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 118,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198195900",
      "pull_request_review_id": 1433254608,
      "id": 1198195900,
      "node_id": "PRRC_kwDOABII585HawS8",
      "diff_hunk": "@@ -119,6 +116,16 @@ bool BaseIndex::Init()\n             return InitError(strprintf(Untranslated(\"%s best block of the index goes beyond pruned data. Please disable the index or reindex (which will download the whole blockchain again)\"), GetName()));\n         }\n     }\n+\n+    // Child init\n+    if (!CustomInit(start_block ? std::make_optional(interfaces::BlockKey{start_block->GetBlockHash(), start_block->nHeight}) : std::nullopt)) {",
      "path": "src/index/base.cpp",
      "position": 67,
      "original_position": 22,
      "commit_id": "89477bec4ef3c05b1630b7635b4bcbc09c24b98a",
      "original_commit_id": "21812970cc56191e18f96692e47f00ed881bd596",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"index: prevent race by calling 'CustomInit' prior setting 'm_synced' flag\" (21812970cc56191e18f96692e47f00ed881bd596)\r\n\r\nI think it would be nice to split this commit off into a separate PR is possible, so we have a minimal bugfix that could backported (and also be easier to understand)",
      "created_at": "2023-05-18T18:59:05Z",
      "updated_at": "2023-05-18T19:16:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1198195900",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198195900"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 113,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198198410",
      "pull_request_review_id": 1433254608,
      "id": 1198198410,
      "node_id": "PRRC_kwDOABII585Haw6K",
      "diff_hunk": "@@ -1577,6 +1577,9 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n         node.indexers.insert(g_coin_stats_index.get());\n     }\n \n+    // Init all indexers\n+    for (auto indexer : node.indexers) indexer->Init();",
      "path": "src/init.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "89477bec4ef3c05b1630b7635b4bcbc09c24b98a",
      "original_commit_id": "26bd60eafc42484d80d5dfef0fa0abb77e7817ce",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"refactor: index, decouple 'Init' from 'Start'\" (26bd60eafc42484d80d5dfef0fa0abb77e7817ce)\r\n\r\nInit return value is ignored. I think this needs to return false if it fails. Would also be good to mark Init declaration with `[[nodiscard]]`",
      "created_at": "2023-05-18T19:02:00Z",
      "updated_at": "2023-05-18T19:16:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1198198410",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1198198410"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1581,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199013812",
      "pull_request_review_id": 1434512490,
      "id": 1199013812,
      "node_id": "PRRC_kwDOABII585Hd3-0",
      "diff_hunk": "@@ -1665,13 +1655,20 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     }\n #endif\n \n-    std::vector<fs::path> vImportFiles;\n-    for (const std::string& strFile : args.GetArgs(\"-loadblock\")) {\n-        vImportFiles.push_back(fs::PathFromString(strFile));\n-    }\n+    chainman.m_load_block = std::thread(&util::TraceThread, \"loadblk\", [&chainman, &args, &node] {\n+        std::vector<fs::path> vImportFiles;\n+        for (const std::string& strFile : args.GetArgs(\"-loadblock\")) {\n+            vImportFiles.push_back(fs::PathFromString(strFile));\n+        }\n \n-    chainman.m_load_block = std::thread(&util::TraceThread, \"loadblk\", [=, &chainman, &args] {\n         ThreadImport(chainman, vImportFiles, ShouldPersistMempool(args) ? MempoolPath(args) : fs::path{});\n+\n+        // Start indexers",
      "path": "src/init.cpp",
      "position": null,
      "original_position": 61,
      "commit_id": "89477bec4ef3c05b1630b7635b4bcbc09c24b98a",
      "original_commit_id": "ca3041984cf3665e27b6783c923ab1c32682500a",
      "in_reply_to_id": 1198165818,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Sure, will change it. I used indexers to try to differentiate them from block indexes but guess that its an odd term in English.",
      "created_at": "2023-05-19T14:14:20Z",
      "updated_at": "2023-05-19T14:14:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1199013812",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199013812"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1666,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199080037",
      "pull_request_review_id": 1434618666,
      "id": 1199080037,
      "node_id": "PRRC_kwDOABII585HeIJl",
      "diff_hunk": "@@ -1665,13 +1655,20 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     }\n #endif\n \n-    std::vector<fs::path> vImportFiles;\n-    for (const std::string& strFile : args.GetArgs(\"-loadblock\")) {\n-        vImportFiles.push_back(fs::PathFromString(strFile));\n-    }\n+    chainman.m_load_block = std::thread(&util::TraceThread, \"loadblk\", [&chainman, &args, &node] {\n+        std::vector<fs::path> vImportFiles;\n+        for (const std::string& strFile : args.GetArgs(\"-loadblock\")) {\n+            vImportFiles.push_back(fs::PathFromString(strFile));\n+        }\n \n-    chainman.m_load_block = std::thread(&util::TraceThread, \"loadblk\", [=, &chainman, &args] {\n         ThreadImport(chainman, vImportFiles, ShouldPersistMempool(args) ? MempoolPath(args) : fs::path{});\n+\n+        // Start indexers\n+        if (!StartIndexes(node)) {",
      "path": "src/init.cpp",
      "position": 69,
      "original_position": 62,
      "commit_id": "89477bec4ef3c05b1630b7635b4bcbc09c24b98a",
      "original_commit_id": "ca3041984cf3665e27b6783c923ab1c32682500a",
      "in_reply_to_id": 1198184049,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Do you think the the main benefit of this commit is cleaner code, and the worse error detection a side effect? Or are there other benefits to this commit?\r\n\r\nAside from the cleaner code (which I think that it's salable on its own), I see maintainability and test coverage benefits with the global flag removal. Also, the indexes threads active-wait isn't that good in terms of processors context switching (the index threads are waking up every 0.5s and the reindex process could take a while).\r\nPlus, since #25193, we skip the pruning violation checks prior reindex, while here we are recovering those checks too.\r\n\r\nFurthermore, it's more accurate to conduct the pruning violations checks after the \"loadblk\" thread execution. This is because that thread imports data from external sources and activates the best chain (only there we know which is the node's best chain).\r\nMeaning that, with the current code, we could have performed the pruning violations checks on a fork chain if the import thread encounters another best chain (and not perform any pruning check on the real active chain). Which could lead to a similar situation as there would be no init error if something isn't correct after thread import execution.\r\n\r\nSaid that, talking about the init returned error, maybe we could cache the node shutdown reason and return it even if the error was post-init?. Will give it a look.\r\n\r\n\r\n> I'm thinking the PR is doing a lot of things and maybe it would be good to split into smaller PRs where possible. Especially if the smaller PRs can be unambiguous improvements.\r\n\r\nYeah sure.\r\nI usually try to not split a PR too much (when it's scoped under a certain area) to not loose review power and coordinate better between ourselves but.. I agree that this started targeting something and now grew up a bit longer.",
      "created_at": "2023-05-19T15:13:34Z",
      "updated_at": "2023-05-20T04:07:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1199080037",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199080037"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1682,
      "original_line": 1682,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199268910",
      "pull_request_review_id": 1434924256,
      "id": 1199268910,
      "node_id": "PRRC_kwDOABII585He2Qu",
      "diff_hunk": "@@ -216,8 +216,13 @@ class BlockManager\n     //! Returns last CBlockIndex* that is a checkpoint\n     const CBlockIndex* GetLastCheckpoint(const CCheckpointData& data) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    //! Returns 'lower_block' if all blocks up to that point are available in disk, otherwise returns the first block that is not pruned in the upper-lower range.\n+    //! If 'lower_block=nullptr': verify blocks availability up to the genesis block.\n+    //! Returns nullptr if 'lower_block' is not an 'upper_block' ancestry.\n+    const CBlockIndex* IsBlockDataAvailable(const CBlockIndex& upper_block LIFETIMEBOUND, const CBlockIndex* lower_block=nullptr) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);",
      "path": "src/node/blockstorage.h",
      "position": null,
      "original_position": 7,
      "commit_id": "89477bec4ef3c05b1630b7635b4bcbc09c24b98a",
      "original_commit_id": "704c9e4cf67468708db655226a78489b92ef0523",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't think this is possible to trigger with the way the function is used, but if `upper_block` already has `NO_DATA`, it would return that block, maybe `nullptr` would be more natural? (also applies to `GetFirstStoredBlock`).\r\n\r\nAlso, the name sounds like a boolean function, maybe something like `CheckBlockDataAvailability()` would be better?",
      "created_at": "2023-05-19T18:42:19Z",
      "updated_at": "2023-05-19T21:36:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1199268910",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199268910"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 222,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199338711",
      "pull_request_review_id": 1434924256,
      "id": 1199338711,
      "node_id": "PRRC_kwDOABII585HfHTX",
      "diff_hunk": "@@ -119,6 +116,16 @@ bool BaseIndex::Init()\n             return InitError(strprintf(Untranslated(\"%s best block of the index goes beyond pruned data. Please disable the index or reindex (which will download the whole blockchain again)\"), GetName()));\n         }\n     }\n+\n+    // Child init\n+    if (!CustomInit(start_block ? std::make_optional(interfaces::BlockKey{start_block->GetBlockHash(), start_block->nHeight}) : std::nullopt)) {",
      "path": "src/index/base.cpp",
      "position": 67,
      "original_position": 22,
      "commit_id": "89477bec4ef3c05b1630b7635b4bcbc09c24b98a",
      "original_commit_id": "21812970cc56191e18f96692e47f00ed881bd596",
      "in_reply_to_id": 1198195900,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good catch! Is my understanding correct that this race cannot actually happen in practice on master right now, because the indexes are set up (`Init()`) by the init thread, which starts the networking and loadblk threads only later - so I can't see from which other thread `BlockConnected` signals could come from at this stage. However, once index initialization is deferred to the loadblk thread in ca3041984cf3665e27b6783c923ab1c32682500a, I think this race could easily happen. \r\n (this might affect the decision whether backport is necessary).",
      "created_at": "2023-05-19T20:20:58Z",
      "updated_at": "2023-05-19T21:36:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1199338711",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199338711"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 113,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199624849",
      "pull_request_review_id": 1435416979,
      "id": 1199624849,
      "node_id": "PRRC_kwDOABII585HgNKR",
      "diff_hunk": "@@ -1665,13 +1655,20 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     }\n #endif\n \n-    std::vector<fs::path> vImportFiles;\n-    for (const std::string& strFile : args.GetArgs(\"-loadblock\")) {\n-        vImportFiles.push_back(fs::PathFromString(strFile));\n-    }\n+    chainman.m_load_block = std::thread(&util::TraceThread, \"loadblk\", [&chainman, &args, &node] {\n+        std::vector<fs::path> vImportFiles;\n+        for (const std::string& strFile : args.GetArgs(\"-loadblock\")) {\n+            vImportFiles.push_back(fs::PathFromString(strFile));\n+        }\n \n-    chainman.m_load_block = std::thread(&util::TraceThread, \"loadblk\", [=, &chainman, &args] {\n         ThreadImport(chainman, vImportFiles, ShouldPersistMempool(args) ? MempoolPath(args) : fs::path{});\n+\n+        // Start indexers\n+        if (!StartIndexes(node)) {",
      "path": "src/init.cpp",
      "position": 69,
      "original_position": 62,
      "commit_id": "89477bec4ef3c05b1630b7635b4bcbc09c24b98a",
      "original_commit_id": "ca3041984cf3665e27b6783c923ab1c32682500a",
      "in_reply_to_id": 1198184049,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Said that, talking about the init returned error, maybe we could cache the node shutdown reason and return it even if the error was post-init?. Will give it a look.\r\n\r\nFollowing-up this, pushed #27708. Which will let us keep the same behavior as we have now:\r\n\r\nThe user, same as the functional tests, shouldn't notice any difference between running the pruning violation checks in the load-blk thread vs init thread with it. We will continue erroring out after a pruning violation with an `EXIT_FAILURE` code. Making the `feature_index_prune.py` changes in ca3041984cf3665e27b6783c923ab1c32682500a no longer needed.",
      "created_at": "2023-05-20T15:18:55Z",
      "updated_at": "2023-05-20T15:18:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1199624849",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199624849"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1682,
      "original_line": 1682,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199788121",
      "pull_request_review_id": 1435558536,
      "id": 1199788121,
      "node_id": "PRRC_kwDOABII585Hg1BZ",
      "diff_hunk": "@@ -216,8 +216,13 @@ class BlockManager\n     //! Returns last CBlockIndex* that is a checkpoint\n     const CBlockIndex* GetLastCheckpoint(const CCheckpointData& data) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    //! Returns 'lower_block' if all blocks up to that point are available in disk, otherwise returns the first block that is not pruned in the upper-lower range.\n+    //! If 'lower_block=nullptr': verify blocks availability up to the genesis block.\n+    //! Returns nullptr if 'lower_block' is not an 'upper_block' ancestry.\n+    const CBlockIndex* IsBlockDataAvailable(const CBlockIndex& upper_block LIFETIMEBOUND, const CBlockIndex* lower_block=nullptr) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n+\n     //! Find the first block that is not pruned\n-    const CBlockIndex* GetFirstStoredBlock(const CBlockIndex& start_block LIFETIMEBOUND) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n+    const CBlockIndex* GetFirstStoredBlock(const CBlockIndex& upper_block LIFETIMEBOUND) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);",
      "path": "src/node/blockstorage.h",
      "position": null,
      "original_position": 11,
      "commit_id": "89477bec4ef3c05b1630b7635b4bcbc09c24b98a",
      "original_commit_id": "704c9e4cf67468708db655226a78489b92ef0523",
      "in_reply_to_id": 1198191133,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "yeah thx, this is a remanent from a previous version.",
      "created_at": "2023-05-21T15:42:13Z",
      "updated_at": "2023-05-21T15:42:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1199788121",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199788121"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 225,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199796712",
      "pull_request_review_id": 1435566027,
      "id": 1199796712,
      "node_id": "PRRC_kwDOABII585Hg3Ho",
      "diff_hunk": "@@ -106,36 +106,16 @@ bool BaseIndex::Init()\n     // via `BlockConnected` signals until, possibly, the next restart.\n     m_synced = m_best_block_index.load() == active_chain.Tip();\n     if (!m_synced) {\n-        bool prune_violation = false;\n-        if (!m_best_block_index) {\n-            // index is not built yet\n-            // make sure we have all block data back to the genesis\n-            prune_violation = m_chainstate->m_blockman.GetFirstStoredBlock(*active_chain.Tip()) != active_chain.Genesis();\n+        const CBlockIndex* start_block = m_best_block_index.load();\n+        if (!start_block) start_block = active_chain.Genesis();\n+        if (!active_chain.Contains(start_block)) {\n+            // if the bestblock is not part of the mainchain, find the fork\n+            // so we can make sure we have all data down to the fork\n+            start_block = active_chain.FindFork(start_block);\n         }\n-        // in case the index has a best block set and is not fully synced\n-        // check if we have the required blocks to continue building the index\n-        else {\n-            const CBlockIndex* block_to_test = m_best_block_index.load();\n-            if (!active_chain.Contains(block_to_test)) {\n-                // if the bestblock is not part of the mainchain, find the fork\n-                // and make sure we have all data down to the fork\n-                block_to_test = active_chain.FindFork(block_to_test);\n-            }\n-            const CBlockIndex* block = active_chain.Tip();\n-            prune_violation = true;\n-            // check backwards from the tip if we have all block data until we reach the indexes bestblock\n-            while (block_to_test && block && (block->nStatus & BLOCK_HAVE_DATA)) {\n-                if (block_to_test == block) {\n-                    prune_violation = false;\n-                    break;\n-                }\n-                // block->pprev must exist at this point, since block_to_test is part of the chain\n-                // and thus must be encountered when going backwards from the tip\n-                assert(block->pprev);\n-                block = block->pprev;\n-            }\n-        }\n-        if (prune_violation) {\n+\n+        // make sure we have all block data back to the start block\n+        if (m_chainstate->m_blockman.IsBlockDataAvailable(*active_chain.Tip(), start_block) != start_block) {",
      "path": "src/index/base.cpp",
      "position": null,
      "original_position": 42,
      "commit_id": "89477bec4ef3c05b1630b7635b4bcbc09c24b98a",
      "original_commit_id": "704c9e4cf67468708db655226a78489b92ef0523",
      "in_reply_to_id": 1198193156,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Could the commit message clarify if any behavior is changing here? Would be good to label it a refactoring and say it does not change behavior if nothing is changing, and say what is changing otherwise.\r\n\r\nyeah sure. https://github.com/bitcoin/bitcoin/commit/704c9e4cf67468708db655226a78489b92ef0523 has no behavior change.\r\n\r\n> Also, it seems like new code that is added here just gets moved / deleted later in the PR in the last commit \"index: verify blocks data existence only once\" (https://github.com/bitcoin/bitcoin/commit/dd9bc393ebd4ba915ca94991390b6e98d29dcfaf).\r\n> \r\n> I could be missing something, but it seems like the PR would be easier to review if this commit only added the IsBlockDataAvailable function, the other commit started calling it, so reviewers would only need to review one new version of the pruned data check, instead of reviewing a temporary version that gets thrown away and then another final version.\r\n\r\nHmm, I actually made it in this way to try to make review easier.\r\n\r\nThe idea was that 704c9e4 makes current violation code much more concise with no behavior change (introducing this new function which re-purposes another existent function), then dd9bc393 moves it to init with a slightly difference: instead of calling `IsBlockDataAvailable` once per index, it's called once for all the indexes (so the diff is on init fetching the oldest block index from the indexers and then calling `IsBlockDataAvailable` with it).\r\n\r\nI thought that was going to be easier to review in this way than moving + changing the entire pruning violation check at once in a single commit. I mean, at least for me, it seemed good to let us verify that the conciser pruning violation code doesn't introduces any behavior changes first (at this point reviewers should be ok with the \"new\" process), then move that to init and call it with the the oldest indexer block index (which is the behavior change).\r\n\r\nBut let me know if this doesn't makes sense for you, and you still prefer the all-in-one way. If it doesn't help review or code consistency, could go ahead with your suggestion.",
      "created_at": "2023-05-21T16:48:54Z",
      "updated_at": "2023-05-21T16:49:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1199796712",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199796712"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 118,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199824807",
      "pull_request_review_id": 1435589453,
      "id": 1199824807,
      "node_id": "PRRC_kwDOABII585Hg9-n",
      "diff_hunk": "@@ -1665,13 +1655,20 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     }\n #endif\n \n-    std::vector<fs::path> vImportFiles;\n-    for (const std::string& strFile : args.GetArgs(\"-loadblock\")) {\n-        vImportFiles.push_back(fs::PathFromString(strFile));\n-    }\n+    chainman.m_load_block = std::thread(&util::TraceThread, \"loadblk\", [&chainman, &args, &node] {\n+        std::vector<fs::path> vImportFiles;\n+        for (const std::string& strFile : args.GetArgs(\"-loadblock\")) {\n+            vImportFiles.push_back(fs::PathFromString(strFile));\n+        }\n \n-    chainman.m_load_block = std::thread(&util::TraceThread, \"loadblk\", [=, &chainman, &args] {\n         ThreadImport(chainman, vImportFiles, ShouldPersistMempool(args) ? MempoolPath(args) : fs::path{});\n+\n+        // Start indexers\n+        if (!StartIndexes(node)) {",
      "path": "src/init.cpp",
      "position": 69,
      "original_position": 62,
      "commit_id": "89477bec4ef3c05b1630b7635b4bcbc09c24b98a",
      "original_commit_id": "ca3041984cf3665e27b6783c923ab1c32682500a",
      "in_reply_to_id": 1198184049,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Do you think the the main benefit of this commit is cleaner code, and the worse error detection a side effect? Or are there other benefits to this commit?\r\n\r\nI think one minor downside could be that the indexes will be available a few minutes later because loadblk doesn't only do reindexing etc., it also loads the mempool - this could take several minutes depending on mempool size and there isn't really a reason why the indexes shouldn't be available before that has finished. This is already the case now in case of `-reindex-chainstate` after #25193 (I didn't think of that), but it could be easily changed in master by moving `g_indexes_ready_to_sync = true` up one line in `ThreadImport`.",
      "created_at": "2023-05-21T20:42:15Z",
      "updated_at": "2023-05-21T21:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1199824807",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199824807"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1682,
      "original_line": 1682,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199939444",
      "pull_request_review_id": 1435746295,
      "id": 1199939444,
      "node_id": "PRRC_kwDOABII585HhZ90",
      "diff_hunk": "@@ -1665,13 +1655,20 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     }\n #endif\n \n-    std::vector<fs::path> vImportFiles;\n-    for (const std::string& strFile : args.GetArgs(\"-loadblock\")) {\n-        vImportFiles.push_back(fs::PathFromString(strFile));\n-    }\n+    chainman.m_load_block = std::thread(&util::TraceThread, \"loadblk\", [&chainman, &args, &node] {\n+        std::vector<fs::path> vImportFiles;\n+        for (const std::string& strFile : args.GetArgs(\"-loadblock\")) {\n+            vImportFiles.push_back(fs::PathFromString(strFile));\n+        }\n \n-    chainman.m_load_block = std::thread(&util::TraceThread, \"loadblk\", [=, &chainman, &args] {\n         ThreadImport(chainman, vImportFiles, ShouldPersistMempool(args) ? MempoolPath(args) : fs::path{});\n+\n+        // Start indexers\n+        if (!StartIndexes(node)) {",
      "path": "src/init.cpp",
      "position": 69,
      "original_position": 62,
      "commit_id": "89477bec4ef3c05b1630b7635b4bcbc09c24b98a",
      "original_commit_id": "ca3041984cf3665e27b6783c923ab1c32682500a",
      "in_reply_to_id": 1198184049,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> This is already the case now in case of -reindex-chainstate after https://github.com/bitcoin/bitcoin/pull/25193 (I didn't think of that), but it could be easily changed in master by moving g_indexes_ready_to_sync = true up one line in ThreadImport.\r\n\r\nyeah, I don't see why that would be a downside for this changes neither. Same as with `g_indexes_ready_to_sync` flag,  the `StartIndexes()` call could be executed before the mempool load too.\r\n\r\nIt wouldn't be bad to rename `ThreadImport` to `ImportBlocks`, and move the single line mempool load function call to the end of the `loadblk` lambda.",
      "created_at": "2023-05-22T04:21:20Z",
      "updated_at": "2023-05-22T04:21:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1199939444",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1199939444"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1682,
      "original_line": 1682,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200555420",
      "pull_request_review_id": 1436698456,
      "id": 1200555420,
      "node_id": "PRRC_kwDOABII585HjwWc",
      "diff_hunk": "@@ -119,6 +116,16 @@ bool BaseIndex::Init()\n             return InitError(strprintf(Untranslated(\"%s best block of the index goes beyond pruned data. Please disable the index or reindex (which will download the whole blockchain again)\"), GetName()));\n         }\n     }\n+\n+    // Child init\n+    if (!CustomInit(start_block ? std::make_optional(interfaces::BlockKey{start_block->GetBlockHash(), start_block->nHeight}) : std::nullopt)) {",
      "path": "src/index/base.cpp",
      "position": 67,
      "original_position": 22,
      "commit_id": "89477bec4ef3c05b1630b7635b4bcbc09c24b98a",
      "original_commit_id": "21812970cc56191e18f96692e47f00ed881bd596",
      "in_reply_to_id": 1198195900,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": ">  Is my understanding correct that this race cannot actually happen in practice on master right now, because the indexes are set up (Init()) by the init thread, which starts the networking and loadblk threads only later - so I can't see from which other thread BlockConnected signals could come from at this stage.\r\n\r\nYeah, the race cannot realistically happen in master. The only process that occurs before the indexes initialization is the chain state loading process, which doesn't signal any block connection event.\r\n\r\nSo back porting seems to not be needed. But, if it helps review, could still decouple 21812970cc56191e18f96692e47f00ed881bd596 into a standalone PR.",
      "created_at": "2023-05-22T13:56:31Z",
      "updated_at": "2023-05-22T13:56:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1200555420",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200555420"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 113,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200556364",
      "pull_request_review_id": 1436699935,
      "id": 1200556364,
      "node_id": "PRRC_kwDOABII585HjwlM",
      "diff_hunk": "@@ -1577,6 +1577,9 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n         node.indexers.insert(g_coin_stats_index.get());\n     }\n \n+    // Init all indexers\n+    for (auto indexer : node.indexers) indexer->Init();",
      "path": "src/init.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "89477bec4ef3c05b1630b7635b4bcbc09c24b98a",
      "original_commit_id": "26bd60eafc42484d80d5dfef0fa0abb77e7817ce",
      "in_reply_to_id": 1198198410,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "good catch 👌🏼 .",
      "created_at": "2023-05-22T13:57:13Z",
      "updated_at": "2023-05-22T13:57:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1200556364",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200556364"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1581,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200568842",
      "pull_request_review_id": 1436724179,
      "id": 1200568842,
      "node_id": "PRRC_kwDOABII585HjzoK",
      "diff_hunk": "@@ -216,8 +216,13 @@ class BlockManager\n     //! Returns last CBlockIndex* that is a checkpoint\n     const CBlockIndex* GetLastCheckpoint(const CCheckpointData& data) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    //! Returns 'lower_block' if all blocks up to that point are available in disk, otherwise returns the first block that is not pruned in the upper-lower range.\n+    //! If 'lower_block=nullptr': verify blocks availability up to the genesis block.\n+    //! Returns nullptr if 'lower_block' is not an 'upper_block' ancestry.\n+    const CBlockIndex* IsBlockDataAvailable(const CBlockIndex& upper_block LIFETIMEBOUND, const CBlockIndex* lower_block=nullptr) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);",
      "path": "src/node/blockstorage.h",
      "position": null,
      "original_position": 7,
      "commit_id": "89477bec4ef3c05b1630b7635b4bcbc09c24b98a",
      "original_commit_id": "704c9e4cf67468708db655226a78489b92ef0523",
      "in_reply_to_id": 1199268910,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> I don't think this is possible to trigger with the way the function is used, but if upper_block already has NO_DATA, it would return that block, maybe nullptr would be more natural? (also applies to GetFirstStoredBlock).\r\n\r\nyeah, that is something that already exists. Good eye.\r\nIt shouldn't be possible to trigger as `upper_block` is always equal to the chain tip and, as far as I know, we never prune the tip. But.. a bug is a bug, better to fix it now.",
      "created_at": "2023-05-22T14:07:08Z",
      "updated_at": "2023-05-22T14:07:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27607#discussion_r1200568842",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1200568842"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 222,
      "side": "RIGHT"
    }
  ]
}