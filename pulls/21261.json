{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261",
    "id": 577213353,
    "node_id": "MDExOlB1bGxSZXF1ZXN0NTc3MjEzMzUz",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21261",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/21261.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/21261.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21261",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21261/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
    "number": 21261,
    "state": "closed",
    "locked": true,
    "maintainer_can_modify": false,
    "title": "p2p: update inbound eviction protection for multiple networks, add I2P peers",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Continuing the work in #20197 and #20685, this pull updates and abstracts our inbound eviction protection to make it fully ratio-based and easily extensible to peers connected via high-latency privacy networks that we newly support, like I2P and perhaps others soon, as these peers are disadvantaged by the latency criteria of our eviction logic.\r\n\r\nIt then adds eviction protection for peers connected over I2P.  As described in https://github.com/bitcoin/bitcoin/pull/20685#issuecomment-767486499, we've observed over the past few months that I2P peers have a min ping latency similar to or greater than that of onion peers.\r\n\r\nThe algorithm is a basically a multi-pass knapsack:\r\n\r\n- Count the number of eviction candidates in each of the disadvantaged\r\n  privacy networks.\r\n\r\n- Sort the networks from lower to higher candidate counts, so that\r\n  a network with fewer candidates will have the first opportunity\r\n  for any unused slots remaining from the previous iteration.  In\r\n  the case of a tie in candidate counts, priority is given by array\r\n  member order from first to last, guesstimated to favor more unusual\r\n  networks.\r\n\r\n- Iterate through the networks in this order.  On each iteration,\r\n  allocate each network an equal number of protected slots targeting\r\n  a total number of candidates to protect, provided any slots remain\r\n  in the knapsack.\r\n\r\n- Protect the candidates in that network having the longest uptime,\r\n  if any in that network are present.\r\n\r\n- Continue iterating as long as we have non-allocated slots\r\n  remaining and candidates available to protect.\r\n\r\nThe goal of this logic is to favorise the diversity of our peer connections.\r\n\r\nThe individual commit messages describe each change in more detail.\r\n\r\nSpecial thank you to Vasil Dimov for the excellent review feedback and the algorithm improvement that made this change much better than it would have been otherwise. Thanks also to Antoine Riard, whose review feedback nudged this change to protect disadvantaged networks having fewer, rather than more, eviction candidates.",
    "labels": [
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      }
    ],
    "milestone": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/47",
      "html_url": "https://github.com/bitcoin/bitcoin/milestone/47",
      "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/47/labels",
      "id": 5347322,
      "node_id": "MDk6TWlsZXN0b25lNTM0NzMyMg==",
      "number": 47,
      "state": "closed",
      "title": "22.0",
      "description": "",
      "creator": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "open_issues": 0,
      "closed_issues": 124,
      "created_at": "2020-04-25T00:14:49Z",
      "updated_at": "2021-09-14T07:16:53Z",
      "closed_at": "2021-09-09T12:47:52Z"
    },
    "active_lock_reason": "resolved",
    "created_at": "2021-02-22T00:29:47Z",
    "updated_at": "2022-08-16T17:24:15Z",
    "closed_at": "2021-06-14T13:05:18Z",
    "mergeable_state": "unknown",
    "merged_at": "2021-06-14T13:05:18Z",
    "merge_commit_sha": "5c4f0c4d46f030498c222a15a0399c6e0a7d28f1",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "head": {
      "label": "jonatack:protect-i2p-peers-from-eviction",
      "ref": "protect-i2p-peers-from-eviction",
      "sha": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 173103842,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNzMxMDM4NDI=",
        "name": "bitcoin",
        "full_name": "jonatack/bitcoin",
        "owner": {
          "login": "jonatack",
          "id": 2415484,
          "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/jonatack",
          "html_url": "https://github.com/jonatack",
          "followers_url": "https://api.github.com/users/jonatack/followers",
          "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
          "organizations_url": "https://api.github.com/users/jonatack/orgs",
          "repos_url": "https://api.github.com/users/jonatack/repos",
          "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/jonatack/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/jonatack/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/jonatack/bitcoin",
        "archive_url": "https://api.github.com/repos/jonatack/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/jonatack/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/jonatack/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/jonatack/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/jonatack/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/jonatack/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/jonatack/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/jonatack/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/jonatack/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/jonatack/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/jonatack/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/jonatack/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/jonatack/bitcoin/events",
        "forks_url": "https://api.github.com/repos/jonatack/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/jonatack/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/jonatack/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/jonatack/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/jonatack/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/jonatack/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/jonatack/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/jonatack/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/jonatack/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/jonatack/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/jonatack/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/jonatack/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/jonatack/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/jonatack/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/jonatack/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/jonatack/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:jonatack/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/jonatack/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/jonatack/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/jonatack/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/jonatack/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/jonatack/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/jonatack/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/jonatack/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/jonatack/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/jonatack/bitcoin/hooks",
        "svn_url": "https://github.com/jonatack/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 1,
        "stargazers_count": 1,
        "watchers_count": 1,
        "size": 217428,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-05-31T14:39:25Z",
        "created_at": "2019-02-28T11:57:18Z",
        "updated_at": "2023-01-03T22:00:49Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "de5512e28df220990ad123b914167aadd6f50979",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 34324,
        "stargazers_count": 69819,
        "watchers_count": 69819,
        "size": 233879,
        "default_branch": "master",
        "open_issues_count": 627,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-06T22:42:00Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-06-07T04:47:18Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 472,
    "deletions": 194,
    "changed_files": 5,
    "commits": 17,
    "review_comments": 61,
    "comments": 13
  },
  "events": [
    {
      "event": "labeled",
      "id": 4357003569,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDQzNTcwMDM1Njk=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4357003569",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-02-22T00:31:13Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4357103037,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDM1NzEwMzAzNw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4357103037",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-02-22T01:30:13Z"
    },
    {
      "event": "commented",
      "id": 783026889,
      "node_id": "MDEyOklzc3VlQ29tbWVudDc4MzAyNjg4OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/783026889",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-02-22T03:17:19Z",
      "updated_at": "2021-06-03T05:25:12Z",
      "author_association": "MEMBER",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21160 (net/net processing: Move tx inventory into net_processing by jnewbery)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#issuecomment-783026889",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21261"
    },
    {
      "event": "commented",
      "id": 785710010,
      "node_id": "MDEyOklzc3VlQ29tbWVudDc4NTcxMDAxMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/785710010",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-02-25T08:18:37Z",
      "updated_at": "2021-02-25T08:18:37Z",
      "author_association": "MEMBER",
      "body": "Concept ACK",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#issuecomment-785710010",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21261"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4615324149,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDYxNTMyNDE0OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4615324149",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-19T21:27:44Z"
    },
    {
      "event": "renamed",
      "id": 4619645991,
      "node_id": "MDE3OlJlbmFtZWRUaXRsZUV2ZW50NDYxOTY0NTk5MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4619645991",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-20T14:35:20Z",
      "rename": {
        "from": "p2p, test: add inbound eviction protection for I2P peers",
        "to": "p2p: update inbound eviction protection for multiple networks, add I2P peers"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4619654527,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDYxOTY1NDUyNw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4619654527",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-20T14:36:43Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4632624171,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDYzMjYyNDE3MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4632624171",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-22T18:13:56Z"
    },
    {
      "event": "ready_for_review",
      "id": 4632796611,
      "node_id": "MDE5OlJlYWR5Rm9yUmV2aWV3RXZlbnQ0NjMyNzk2NjEx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4632796611",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-22T18:45:50Z"
    },
    {
      "event": "added_to_project",
      "id": 4632900796,
      "node_id": "MDE5OkFkZGVkVG9Qcm9qZWN0RXZlbnQ0NjMyOTAwNzk2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4632900796",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-22T19:04:46Z",
      "project_card": {
        "id": 59645595,
        "url": "https://api.github.com/projects/columns/cards/59645595",
        "project_id": 481835,
        "project_url": "https://api.github.com/projects/481835",
        "column_name": "Blockers"
      }
    },
    {
      "event": "commented",
      "id": 829668926,
      "node_id": "MDEyOklzc3VlQ29tbWVudDgyOTY2ODkyNg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/829668926",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-29T23:26:53Z",
      "updated_at": "2021-04-29T23:26:53Z",
      "author_association": "MEMBER",
      "body": "Concept ACK, will review more closely soon.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#issuecomment-829668926",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21261"
    },
    {
      "event": "reviewed",
      "id": 650516145,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjUwNTE2MTQ1",
      "url": null,
      "actor": null,
      "commit_id": "831b3294d92b23f85617e77ea3f90082de73ce3a",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Approach ACK 831b3294d92b23f85617e77ea3f90082de73ce3a",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#pullrequestreview-650516145",
      "submitted_at": "2021-05-03T17:02:06Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4697813375,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDY5NzgxMzM3NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4697813375",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-05-06T20:57:40Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4701723638,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDcwMTcyMzYzOA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4701723638",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-05-07T12:59:52Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4704792157,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDcwNDc5MjE1Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4704792157",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-05-07T21:35:54Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4704999267,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDcwNDk5OTI2Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4704999267",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-05-07T22:29:08Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4707312004,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDcwNzMxMjAwNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4707312004",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-05-08T10:38:19Z"
    },
    {
      "event": "commented",
      "id": 836811768,
      "node_id": "MDEyOklzc3VlQ29tbWVudDgzNjgxMTc2OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/836811768",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-05-10T15:04:35Z",
      "updated_at": "2021-05-10T15:04:35Z",
      "author_association": "MEMBER",
      "body": "Concept ACK",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#issuecomment-836811768",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21261"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4751029108,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDc1MTAyOTEwOA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4751029108",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-05-16T13:55:46Z"
    },
    {
      "event": "reviewed",
      "id": 660895577,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjYwODk1NTc3",
      "url": null,
      "actor": null,
      "commit_id": "4890e2f2fdefaa18b0e96bcaf3691fb3f0213572",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Approach ACK 4890e2f2fdefaa18b0e96bcaf3691fb3f0213572\r\n\r\nSome squashing is warranted.",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#pullrequestreview-660895577",
      "submitted_at": "2021-05-17T12:17:02Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
    },
    {
      "event": "commented",
      "id": 842280881,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg0MjI4MDg4MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/842280881",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-05-17T12:22:48Z",
      "updated_at": "2021-05-17T12:22:48Z",
      "author_association": "MEMBER",
      "body": "> Approach ACK [4890e2f](https://github.com/bitcoin/bitcoin/commit/4890e2f2fdefaa18b0e96bcaf3691fb3f0213572)\r\n> \r\n> Some squashing is warranted.\r\n\r\nThanks! Indeed. Re-arranging.",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#issuecomment-842280881",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21261"
    },
    {
      "event": "labeled",
      "id": 4786807368,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDQ3ODY4MDczNjg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4786807368",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-05-24T13:49:35Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 669469370,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjY5NDY5Mzcw",
      "url": null,
      "actor": null,
      "commit_id": "161aed5142048bb5c681628eb3d25d574cfbba47",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Approach ACK 831b329",
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#pullrequestreview-669469370",
      "submitted_at": "2021-05-26T20:28:40Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4834247824,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDgzNDI0NzgyNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4834247824",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-02T21:46:10Z"
    },
    {
      "event": "unlabeled",
      "id": 4834588649,
      "node_id": "MDE0OlVubGFiZWxlZEV2ZW50NDgzNDU4ODY0OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4834588649",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-02T23:52:37Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 853612805,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg1MzYxMjgwNQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/853612805",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-03T06:40:06Z",
      "updated_at": "2021-06-03T06:40:06Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK. Will take a closer look later today :)",
      "user": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#issuecomment-853612805",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21261"
    },
    {
      "event": "milestoned",
      "id": 4839336231,
      "node_id": "MDE1Ok1pbGVzdG9uZWRFdmVudDQ4MzkzMzYyMzE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4839336231",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-03T19:07:13Z",
      "milestone": {
        "title": "22.0"
      }
    },
    {
      "event": "commented",
      "id": 855652920,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg1NTY1MjkyMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/855652920",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-07T07:05:11Z",
      "updated_at": "2021-06-07T07:05:11Z",
      "author_association": "MEMBER",
      "body": "Thanks for the concept ACKs @mzumsande, @duncandean and @laanwj and the approach ACKs @vasild and @ariard. Now ready for final review. \r\n\r\nThis screenshot illustrates the higher latency of I2P peers, which disadvantages them under our inbound eviction criteria even relative to onion peers.\r\n\r\n![Screenshot from 2021-06-07 08-56-56](https://user-images.githubusercontent.com/2415484/120973346-544b3400-c75e-11eb-901e-667f36ebcd54.png)\r\n",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#issuecomment-855652920",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21261"
    },
    {
      "event": "mentioned",
      "id": 4849904222,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDg0OTkwNDIyMg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4849904222",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-07T07:05:11Z"
    },
    {
      "event": "subscribed",
      "id": 4849904228,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ4NDk5MDQyMjg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4849904228",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-07T07:05:11Z"
    },
    {
      "event": "mentioned",
      "id": 4849904233,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDg0OTkwNDIzMw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4849904233",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-07T07:05:11Z"
    },
    {
      "event": "subscribed",
      "id": 4849904237,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ4NDk5MDQyMzc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4849904237",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-07T07:05:12Z"
    },
    {
      "event": "mentioned",
      "id": 4849904243,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDg0OTkwNDI0Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4849904243",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-07T07:05:12Z"
    },
    {
      "event": "subscribed",
      "id": 4849904250,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ4NDk5MDQyNTA=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4849904250",
      "actor": {
        "login": "dunxen",
        "id": 3072149,
        "node_id": "MDQ6VXNlcjMwNzIxNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3072149?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dunxen",
        "html_url": "https://github.com/dunxen",
        "followers_url": "https://api.github.com/users/dunxen/followers",
        "following_url": "https://api.github.com/users/dunxen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dunxen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dunxen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dunxen/subscriptions",
        "organizations_url": "https://api.github.com/users/dunxen/orgs",
        "repos_url": "https://api.github.com/users/dunxen/repos",
        "events_url": "https://api.github.com/users/dunxen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dunxen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-07T07:05:12Z"
    },
    {
      "event": "mentioned",
      "id": 4849904255,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDg0OTkwNDI1NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4849904255",
      "actor": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-07T07:05:12Z"
    },
    {
      "event": "subscribed",
      "id": 4849904262,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ4NDk5MDQyNjI=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4849904262",
      "actor": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-07T07:05:12Z"
    },
    {
      "event": "mentioned",
      "id": 4849904270,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDg0OTkwNDI3MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4849904270",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-07T07:05:12Z"
    },
    {
      "event": "subscribed",
      "id": 4849904273,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ4NDk5MDQyNzM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4849904273",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-07T07:05:12Z"
    },
    {
      "event": "reviewed",
      "id": 677464350,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Njc3NDY0MzUw",
      "url": null,
      "actor": null,
      "commit_id": "dd6f8c429128a3916de8be6c523e1a3d494da7a0",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#pullrequestreview-677464350",
      "submitted_at": "2021-06-08T13:12:23Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4877104645,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDg3NzEwNDY0NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4877104645",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-11T10:18:18Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxY2RlODAwNTIzM2QxNjM3MjNkNGQ1YmYxYmFjZjIyZTZjYjdhMDdl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1cde8005233d163723d4d5bf1bacf22e6cb7a07e",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/1cde8005233d163723d4d5bf1bacf22e6cb7a07e",
      "tree": {
        "sha": "5724bbaa1b931f88f9053225f61836d0dc9f5790",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5724bbaa1b931f88f9053225f61836d0dc9f5790"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 5724bbaa1b931f88f9053225f61836d0dc9f5790\nparent f66eceaecf464bfab5e19f3ca8fe680d8a6aa2e1\nauthor Jon Atack <jon@atack.com> 1618070747 +0200\ncommitter Jon Atack <jon@atack.com> 1623407219 +0200\n\np2p, refactor: rm redundant erase_size calculation in SelectNodeToEvict()\n\nas EraseLastKElements() called in the next line performs the same operation.\nThanks to Martin Zumsande (lightlike) for seeing this while reviewing.\n\nCo-authored-by: Martin Zumsande <mzumsande@gmail.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmDDOnMACgkQT1chs9Dj\nkh2dcw//Ycp9l9VOJe9h1K+9t8bVGRth/BCRu1rzD3wQ6RWEHBI9/XLq3gq+ObsE\n3DAHuNE8/AJKrC03gkd9si4qQzDyjXeZAHKjgcFybxLk7w5RcDRw1x1AwWN4gmly\nNsWAhzKCmLZyORZMj2v3ebpJG+TiQAMna3DtkVoAq8pzCsOawug2Qsh1bGVvdSPp\n5isnNorwN9LeKmfAiddm67dzONyfeirW+vNKFuJKcTs5HUIIsfDDhqQ5XWSMUyRh\nlphRAsS6OqZDrWfspecUOLbH+O+YOlRxW5aagnVTQq24ooXy2A9Tds0eREUBidi2\n8WC5Q1jjLEQYsZhOQspqIwvyerBqVyNcLNk2l/qbdA1Y8iTzig+go8Bwvqv1K4++\ngwEShP+ghji35kNMynal2G+J5FNG6rEqOcujrqZD3mjcOLFfp4fnnP3rOCcMHc9P\nLXlOWzc8xQhVvvJf3oyGmjj887+A9Ivm02SSoTUnSBbPEyb0QAWllxLnae6+flTw\n2JRhtZD/0UQj6SzkhgNaT+xWCcvdXwr3G+FFyUijLbHYpt8c5TQwKt3ei1KPvbbi\ndAT+t0svlwR4MvlBz/Ejp+n48yhx4AGp1p2n0472koHlNuRUYZEjeYUvFl6Osw1J\nlNP1TnibHeOlvEQ+r4ll/ivU4aT4JH2rwDO2BXBvT2jhxQ+zaoY=\n=p7ig\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwIFGjYdJhTP/zAdqe5rdYAWE+R9gUJ50UXk1LEq/FWWtnCP/wEBn1/Qfwreaf\nJncK9J/XABkI8SDCVwFKoYXfNIiRd3VpuaLDFYTsf+Ulif7Vew+sKL4ZUgjxBGDD\nOnXwCKepyi1u5fx0AIPf4w0u+QyOLi1odHRwczovL2FsaWNlLmJ0Yy5jYWxlbmRh\nci5vcGVudGltZXN0YW1wcy5vcmf/8BAzjbcqdbsjSDEuPzIlEt2pCPEEYMM6dfAI\nG15WNlpeYBAAg9/jDS75DI4pKGh0dHBzOi8vZmlubmV5LmNhbGVuZGFyLmV0ZXJu\naXR5d2FsbC5jb23/8BCw5GVE3JguvVZx9wy9S+pmCPEEYMM6dfAIKdPHo/nHzr8A\ng9/jDS75DI4jImh0dHBzOi8vYnRjLmNhbGVuZGFyLmNhdGFsbGF4eS5jb23wELw1\nqgLU9DPN8oC84iS5i7cI8QRgwzp18AiI88xC4bw3ZQCD3+MNLvkMjiwraHR0cHM6\nLy9ib2IuYnRjLmNhbGVuZGFyLm9wZW50aW1lc3RhbXBzLm9yZw==\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f66eceaecf464bfab5e19f3ca8fe680d8a6aa2e1",
          "sha": "f66eceaecf464bfab5e19f3ca8fe680d8a6aa2e1",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/f66eceaecf464bfab5e19f3ca8fe680d8a6aa2e1"
        }
      ],
      "message": "p2p, refactor: rm redundant erase_size calculation in SelectNodeToEvict()\n\nas EraseLastKElements() called in the next line performs the same operation.\nThanks to Martin Zumsande (lightlike) for seeing this while reviewing.\n\nCo-authored-by: Martin Zumsande <mzumsande@gmail.com>",
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-06-11T10:26:59Z"
      },
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-04-10T16:05:47Z"
      },
      "sha": "1cde8005233d163723d4d5bf1bacf22e6cb7a07e"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4877434134,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDg3NzQzNDEzNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4877434134",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-11T11:32:05Z"
    },
    {
      "event": "commented",
      "id": 859579163,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg1OTU3OTE2Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/859579163",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-11T13:23:35Z",
      "updated_at": "2021-06-11T15:05:18Z",
      "author_association": "MEMBER",
      "body": "Updated per the discussions above and rebased.  The CI failure seems unrelated.  I'm running a node on this branch with `-maxconnections=40`.\r\n\r\nEdit: repushed to give the unrelated CI issue another chance.",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#issuecomment-859579163",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21261"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4878421794,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDg3ODQyMTc5NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4878421794",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-11T14:41:51Z"
    },
    {
      "event": "reviewed",
      "id": 681905665,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjgxOTA1NjY1",
      "url": null,
      "actor": null,
      "commit_id": "22b1dae1e07326e9644cc0ffcb50196352f32a3d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK 42530190d82ee1692a546a8daae89e3ba0f5a3a2\r\n\r\nI think the following commits should be squashed into one:\r\n```\r\ne157ed1478 p2p: make ProtectEvictionCandidatesByRatio() fully ratio-based\r\n029256f7ed p2p: give networks with more peers priority for unused protection slots\r\n42530190d8 p2p, refactor: replace NET_LOCALHOST with a bool struct member\r\n```\r\nIt could be tedious and time consuming for reviewers to review newly added code that is rehauled in a subsequent commit and then changed again in yet another commit.",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#pullrequestreview-681905665",
      "submitted_at": "2021-06-11T15:09:41Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
    },
    {
      "event": "reviewed",
      "id": 682042627,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjgyMDQyNjI3",
      "url": null,
      "actor": null,
      "commit_id": "42530190d82ee1692a546a8daae89e3ba0f5a3a2",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "I think this is pretty mature, if you can just have a look around this [comment](https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650190229) ? Other comments are less substantial. Once done, I want to check again correctness of the multi-pass algorithm.",
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#pullrequestreview-682042627",
      "submitted_at": "2021-06-11T18:35:57Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
    },
    {
      "event": "commented",
      "id": 860083875,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg2MDA4Mzg3NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/860083875",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-12T17:27:08Z",
      "updated_at": "2021-06-12T17:27:08Z",
      "author_association": "MEMBER",
      "body": "Thanks for the feedback @vasild and @ariard. All the feedback taken, will re-push after reworking the tests. ",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#issuecomment-860083875",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21261"
    },
    {
      "event": "mentioned",
      "id": 4881494445,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDg4MTQ5NDQ0NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4881494445",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-12T17:27:08Z"
    },
    {
      "event": "subscribed",
      "id": 4881494447,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ4ODE0OTQ0NDc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4881494447",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-12T17:27:08Z"
    },
    {
      "event": "mentioned",
      "id": 4881494448,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDg4MTQ5NDQ0OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4881494448",
      "actor": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-12T17:27:08Z"
    },
    {
      "event": "subscribed",
      "id": 4881494449,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ4ODE0OTQ0NDk=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4881494449",
      "actor": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-12T17:27:08Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4882460248,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDg4MjQ2MDI0OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4882460248",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-13T16:41:34Z"
    },
    {
      "event": "commented",
      "id": 860239666,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg2MDIzOTY2Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/860239666",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-13T16:45:51Z",
      "updated_at": "2021-06-13T18:27:14Z",
      "author_association": "MEMBER",
      "body": "Updated, taking all review feedback by @vasild and @ariard, and also improving readability and updating the tests.\r\n\r\n`git diff 4253019 a457f34 --color-words`",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#issuecomment-860239666",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21261"
    },
    {
      "event": "mentioned",
      "id": 4882463805,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDg4MjQ2MzgwNQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4882463805",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-13T16:45:51Z"
    },
    {
      "event": "subscribed",
      "id": 4882463806,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ4ODI0NjM4MDY=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4882463806",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-13T16:45:51Z"
    },
    {
      "event": "mentioned",
      "id": 4882463809,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDg4MjQ2MzgwOQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4882463809",
      "actor": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-13T16:45:51Z"
    },
    {
      "event": "subscribed",
      "id": 4882463810,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ4ODI0NjM4MTA=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4882463810",
      "actor": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-13T16:45:51Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1MTllNzZiYjY0ZDAzZWNhYzE3NWVjMzNjMzFlMzdkMGU5MGYwMzdm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/519e76bb64d03ecac175ec33c31e37d0e90f037f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/519e76bb64d03ecac175ec33c31e37d0e90f037f",
      "tree": {
        "sha": "b961aed190a8bd001071981b011c0164273eb3b3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b961aed190a8bd001071981b011c0164273eb3b3"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree b961aed190a8bd001071981b011c0164273eb3b3\nparent 1cde8005233d163723d4d5bf1bacf22e6cb7a07e\nauthor Jon Atack <jon@atack.com> 1618837705 +0200\ncommitter Jon Atack <jon@atack.com> 1623608080 +0200\n\ntest: speed up and simplify peer_eviction_test\n\nThis speeds up the test significantly, which helps when\nrunning it repeatedly.\n\nSuggest reviewing the diff with:\n\ncolorMoved = dimmed-zebra\ncolorMovedWs = allow-indentation-change\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmDGS0oACgkQT1chs9Dj\nkh0TtA/+P15oOtUSJ8Kyc9bcg+UdsjMSI+soO0cC7uokzfGq7neqDr0vOuA2nRIO\njmRoUtMT6Ad7MtMQDErxr+ZVWaKubOh3xH1XqY5PeU1UO5Rlt7UXnhtXTV6mpG85\nXLt9sWkeL83yEEx+ekKk+KP/edSAfWoJOavlZgDyqBlJBTUYHmi3VgsYI5pUy4Fv\nsOpt1i/bCnStcyDExyi2cQ+FT0c+fyt/nhNHgsydbTa2+rsl1am8UV+0IR2Vdzg6\nKjlXvP0odMZsej1btUnKDcAkEzSFxTHqAyGy5iBM+wEutPZMrDU3edCrpWW83f4Q\nKwHFvPnC2DcX9Q+daHBZDwhA8MinKADpkpO13TlHBxPO6v+42n5VwFmt+lgy9KhD\nd22t2R/ueyLhZm97dZPTB+vrgatRpsHh+8I1XuYdcjFlrwZBAU7NVDi2pdbcV4Gl\n0aft/z3Wv/ZmVwXsKvOYYxAKbGugs/qxTPU448NKzRtmuIDEet1JygxmBUNQE2JW\nx7nPnjPMc1yrnsQkNAIAH9Yf8sUXWors0VtLbD8CN7cSyoxP6wspv2houodzwa+6\n1eL5WZ2LdEd2/R60t5L06K5P1+a/7+9aZLn9VUFsPufekBb8OKO1Rl7dbO/dVyF+\nU0NcbmhLo08sUpJJ52fsmqLT9NwSkizOcg4UWXpvXhOJTEhBdDw=\n=JTa5\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwILd4fhwL1jZGh9vCVZnJh7Y/KW2SJoaRh6lrZ8cp7v3jCP/wEBp5qIO4wl/p\nNUOcE8rNvTwI8QRgxktL8Ah4l+cqezXe0QCD3+MNLvkMjiwraHR0cHM6Ly9ib2Iu\nYnRjLmNhbGVuZGFyLm9wZW50aW1lc3RhbXBzLm9yZ//wEGmTvq//Fpl7Gq8/wcnJ\niWcI8QRgxktL8Ahf8Nb2UuLndQCD3+MNLvkMjikoaHR0cHM6Ly9maW5uZXkuY2Fs\nZW5kYXIuZXRlcm5pdHl3YWxsLmNvbf/wEKGOXZWu0mPXQpAspkSo3LYI8QRgxktL\n8AjbmqY4ij4s4QCD3+MNLvkMjiMiaHR0cHM6Ly9idGMuY2FsZW5kYXIuY2F0YWxs\nYXh5LmNvbfAQ04j9WXyHh87ey9JkbapjWQjxBGDGS0vwCEM4LMJiAfnAAIPf4w0u\n+QyOLi1odHRwczovL2FsaWNlLmJ0Yy5jYWxlbmRhci5vcGVudGltZXN0YW1wcy5v\ncmc=\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1cde8005233d163723d4d5bf1bacf22e6cb7a07e",
          "sha": "1cde8005233d163723d4d5bf1bacf22e6cb7a07e",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/1cde8005233d163723d4d5bf1bacf22e6cb7a07e"
        }
      ],
      "message": "test: speed up and simplify peer_eviction_test\n\nThis speeds up the test significantly, which helps when\nrunning it repeatedly.\n\nSuggest reviewing the diff with:\n\ncolorMoved = dimmed-zebra\ncolorMovedWs = allow-indentation-change",
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-06-13T18:14:40Z"
      },
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-04-19T13:08:25Z"
      },
      "sha": "519e76bb64d03ecac175ec33c31e37d0e90f037f"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0YTE5ZjUwMWFiYWM0YWRiNDc2YTZmMmEzMGRmZGYxYTM1ODkyY2Nj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4a19f501abac4adb476a6f2a30dfdf1a35892ccc",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/4a19f501abac4adb476a6f2a30dfdf1a35892ccc",
      "tree": {
        "sha": "28b36b569fc3b6dd2a77dc232a7aba184f5a2c48",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/28b36b569fc3b6dd2a77dc232a7aba184f5a2c48"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 28b36b569fc3b6dd2a77dc232a7aba184f5a2c48\nparent 519e76bb64d03ecac175ec33c31e37d0e90f037f\nauthor Jon Atack <jon@atack.com> 1621242662 +0200\ncommitter Jon Atack <jon@atack.com> 1623608141 +0200\n\ntest: add ALL_NETWORKS to test utilities\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmDGS04ACgkQT1chs9Dj\nkh2rcw/5AZgugQd1CyYAouPDVqKZIN4EURfbE+PG0zLQFNK/aMRx3Ma+FUNI71EJ\nK7fg7spyAZ8EF7tujIcrxwuIWuz67zi9rCt2tB0rbCXKQfxGQ8lNUFavJO0the1x\neUYWOBAbJoEgu24XtqCmmyGF8rwnzwbSyJdTNw0XSqSNiH9+zRa0YOXFeYA39F6N\nBncShDMt1vx1DHp4AkjNpL2zPHH2Z2mAH8hmdkbR1cyss1+fWhX2pskWTAeI7FIw\nf2wSwmghqisCi1cjksHsofiRyyhAoJuOKODfAItaJHhLjLSnan+mpDXz1lGTbeX+\nD6F2IeWNEzJch7xuf5Y1ufxE0KL58u9uG5DbWeoKldCBdGKAge8hm3HN+juLK/zS\nqvUtYFO/iMi6Kx0USaimSgROEtRv4ucxk8RuCbiBdVw+DCxqf5CZDJHEIaZnetwk\nqjNEcyFAC3orGIQL+Z+73h0dp4dcsR5tsh8zZ7dQuoxkQI9RcnuE1Z0SnRvrPjz5\nzGbKBmoZL5uJ0WO1zRYh82DIKTcL8fjtLXY3oOgWzxikI3lxrMbusYeBzhg+z+vP\nGfx/AInzsfRfaoKcueid/BndDg7LSvPx2W4umj6KZzTr0G6iag6m/OkCLlGDOLV1\nTij7fJNpXbCFJz3iwTUIDk5yEvGPGdKCm7GryR3xDjYf65pdeVY=\n=1mO1\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwINXQ18S1raPnevqRArhEqg/sFEwIm9203oYO9W6SHQAmCP/wEDFRooITHlJ0\nH1YGM7af8W0I8QRgxktP8AgOUgiH7afWcACD3+MNLvkMjiMiaHR0cHM6Ly9idGMu\nY2FsZW5kYXIuY2F0YWxsYXh5LmNvbf/wEKCqTDbEoFfippl8Lpgn4ZUI8QRgxktP\n8Ah+LGfJQldYmQCD3+MNLvkMjiwraHR0cHM6Ly9ib2IuYnRjLmNhbGVuZGFyLm9w\nZW50aW1lc3RhbXBzLm9yZ//wEMQbvGh/o4MkrdInKKg1inQI8QRgxktP8AjyWBq/\nCHleXQCD3+MNLvkMjikoaHR0cHM6Ly9maW5uZXkuY2FsZW5kYXIuZXRlcm5pdHl3\nYWxsLmNvbfAQ+rTfPKU3jlEg/x81AcV5VwjxBGDGS0/wCC7daYTJEIK2AIPf4w0u\n+QyOLi1odHRwczovL2FsaWNlLmJ0Yy5jYWxlbmRhci5vcGVudGltZXN0YW1wcy5v\ncmc=\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/519e76bb64d03ecac175ec33c31e37d0e90f037f",
          "sha": "519e76bb64d03ecac175ec33c31e37d0e90f037f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/519e76bb64d03ecac175ec33c31e37d0e90f037f"
        }
      ],
      "message": "test: add ALL_NETWORKS to test utilities",
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-06-13T18:15:41Z"
      },
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-05-17T09:11:02Z"
      },
      "sha": "4a19f501abac4adb476a6f2a30dfdf1a35892ccc"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzplYzU5MGYxZDkxMzI1NDA0MzgzZDc0MDk4YTViNDJhMmNkNjdkYWQ5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ec590f1d91325404383d74098a5b42a2cd67dad9",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/ec590f1d91325404383d74098a5b42a2cd67dad9",
      "tree": {
        "sha": "addf6b125d47932892135aadcdbd124e6fe54688",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/addf6b125d47932892135aadcdbd124e6fe54688"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree addf6b125d47932892135aadcdbd124e6fe54688\nparent 4a19f501abac4adb476a6f2a30dfdf1a35892ccc\nauthor Jon Atack <jon@atack.com> 1623314717 +0200\ncommitter Jon Atack <jon@atack.com> 1623608143 +0200\n\np2p, refactor: improve constness in ProtectEvictionCandidatesByRatio()\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmDGS1AACgkQT1chs9Dj\nkh2xag//fjHoM4SaR6VusPmiMEQuFm58NQg86NzkWurBrnktpJVlPTMHtDjIVysw\ntUYxwfX85gMgpns2p+cVaWmkXkIj2pYSaKzYep+EYSn/w370bYfaCr1+IELHvSy+\nSaGkzZYVqVP5VvmiIoSiRwguH38YHk0kjuY3HFnBHiWn8gwu8rUdshG1iFVLdDSX\n2tc54CCf6PucHpdD+F/JDH0QoRak5ftbxVX1xlJgq8kI1DmrXH3IOgMXWwMhhgjZ\nDvzqeGuFH6JG/UINQ8zIf5Oweo1flAHnNN3SBQzS7EspOTOixAhFNAuaZdd27OUn\n8T0zooAv6uo8b1QB5fAamukmt4u8x96Sc5qJON7HyjJ5Y3TslyB0S/4rXtHlfErI\nfLoFryaH3DguiqNhY+xkGRXcqJvah92/1YCaVpORxdEVcmEDLGL39KEONnQ39qHy\nS9Eov1Qq8GnJ4pB7JQxZrfN5DLkDVzCNI/eSXhaM3+uKscTxUWHgPmAIsDOY0Qc4\nLjPxW5+rK0YRwIGeLObZNgWVXxxnbgFSNc4puqVZvXyv2N3wISKtETbaFvR5yYFo\nq/ds9R906WwaLQx6iYsIyBAP0XO3cq7yZXAgWIk6yeJhMOIy5obo9muUD0xDyU2O\nsp/DScqWEJwQdQtbcICLHzyr0tiFngVqj6Bi2snA52jPL2WIjUA=\n=ZKah\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwIPNq1RChmCx4pxcIc7f6J++NC1IsQL0yb5AxDhe9gDGaCP/wECFU0beV6JF8\nZN8sDXL3lwQI8QRgxktR8AicRuLjDt5hiwCD3+MNLvkMjiMiaHR0cHM6Ly9idGMu\nY2FsZW5kYXIuY2F0YWxsYXh5LmNvbf/wEDw0pbaa7iP4hCOP+pa+vvcI8CDK1Pba\nf6lLGLkMRmgcJ9zGx3Da7NtLTxCh6frFydVM1QjwINj5dISkSQpnBwKdJBy9aOuR\nNONFquji4XOZXxrzTjgoCPEEYMZLUfAIDB0DMTc4fZ8Ag9/jDS75DI4pKGh0dHBz\nOi8vZmlubmV5LmNhbGVuZGFyLmV0ZXJuaXR5d2FsbC5jb23/8BCfQtbec1lM41XV\nmfZHNfE/CPEEYMZLUfAIUwjxlgSwGvIAg9/jDS75DI4sK2h0dHBzOi8vYm9iLmJ0\nYy5jYWxlbmRhci5vcGVudGltZXN0YW1wcy5vcmfwEKSGspxWupfPuoO6rnf7PaEI\n8QRgxktR8Ag2OziPhbb10wCD3+MNLvkMji4taHR0cHM6Ly9hbGljZS5idGMuY2Fs\nZW5kYXIub3BlbnRpbWVzdGFtcHMub3Jn\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4a19f501abac4adb476a6f2a30dfdf1a35892ccc",
          "sha": "4a19f501abac4adb476a6f2a30dfdf1a35892ccc",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/4a19f501abac4adb476a6f2a30dfdf1a35892ccc"
        }
      ],
      "message": "p2p, refactor: improve constness in ProtectEvictionCandidatesByRatio()",
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-06-13T18:15:43Z"
      },
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-06-10T08:45:17Z"
      },
      "sha": "ec590f1d91325404383d74098a5b42a2cd67dad9"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3MzIxZTZmMmZlMTY0MWViMzMxZjMwZTY4NjQ2ZjU5ODRkNGJjYmIz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7321e6f2fe1641eb331f30e68646f5984d4bcbb3",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/7321e6f2fe1641eb331f30e68646f5984d4bcbb3",
      "tree": {
        "sha": "48b022302341b7dca747f7c5bc6ea5c420056f4e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/48b022302341b7dca747f7c5bc6ea5c420056f4e"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 48b022302341b7dca747f7c5bc6ea5c420056f4e\nparent ec590f1d91325404383d74098a5b42a2cd67dad9\nauthor Jon Atack <jon@atack.com> 1623315099 +0200\ncommitter Jon Atack <jon@atack.com> 1623608145 +0200\n\np2p, refactor: rename vEvictionCandidates to eviction_candidates\n\nin ProtectEvictionCandidatesByRatio()\nper current style guide in doc/developer-notes.md\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmDGS1IACgkQT1chs9Dj\nkh01rg//U5b6Yh5fx6FsiV4uh439WbyZtXq7jFSmqU3WCltxL5j6La0n5QmBlz2E\nKWeUpGl4ky7/TnXd/foA5GzNWvSipAb8qVcPCVEOJLvgTnhIXlHcfuaakECVPc0r\nvLN5u8Rx8nIjPSxeLWCSusVIM72eMZgyrRHGG4yDUJgIeH//g15nnzhRuu07h6za\npRQ1g1vLyAo61LcoBSd+QT7A7s8aTPZfxUBsGXELU6wMkkiWV/zZgkHaJZVt+hxt\nRU8Kcm29wECGM2GY1fS6B3rNkQf5b4emPVObJA0KFEVHLgKgBhIGFT22vBjV9/Ke\n9jQZ5lu9EekOYtk5sXDLpPtIETxryi0ysgmGDTOER8/NUC15PV8boJlK/Ko/8JEZ\nUQUm5ZRaswrV5JDRu9w+2Bz2tdME5THkQaKQ5uFAUXUNGYSTwxfdI1ZKhYzy/W5v\naEM2GMARsbeGduOIqLEAEC3QCeEs1o7PBTFlnUfds6ti1knYEhASlAO/RDZii11i\nJ5M8/QmxOAGx08pdVOAG+cbOlava/mSrrm0v6mzmGPO3ARfpOMbrZ+i4oXVhPID3\n35cbwCa3v2ww/qAQhcOV/b+BtZj39k5RCIm02fdcsZO+eU0uoGbjY22qd2rglia7\nrqHRxuLX5RjIl22U7j5eFm0CiOKf0Y5MUIdB3CLjKnTCVmf07do=\n=bbcF\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwILE+Y+cVbQb3TuCQRyLk5xrhEK5OxduYuo3sQkEcv3G4CP/wEA8NQly9yhCr\n0nJvA91lnqII8QRgxktT8AirIpAor6VlVQCD3+MNLvkMjiMiaHR0cHM6Ly9idGMu\nY2FsZW5kYXIuY2F0YWxsYXh5LmNvbf/wEHwm1DE4V8pKrNcW153YNXgI8QRgxktT\n8Ai/8V2KkuSngQCD3+MNLvkMji4taHR0cHM6Ly9hbGljZS5idGMuY2FsZW5kYXIu\nb3BlbnRpbWVzdGFtcHMub3Jn//AQltf/tNHqksodYkWg5CXgFgjxBGDGS1PwCDX6\nfrQbPWDeAIPf4w0u+QyOKShodHRwczovL2Zpbm5leS5jYWxlbmRhci5ldGVybml0\neXdhbGwuY29t8BDCM/6omOKei3jx3qbvpCBaCPEEYMZLU/AIE5IRLao0o7IAg9/j\nDS75DI4sK2h0dHBzOi8vYm9iLmJ0Yy5jYWxlbmRhci5vcGVudGltZXN0YW1wcy5v\ncmc=\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ec590f1d91325404383d74098a5b42a2cd67dad9",
          "sha": "ec590f1d91325404383d74098a5b42a2cd67dad9",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/ec590f1d91325404383d74098a5b42a2cd67dad9"
        }
      ],
      "message": "p2p, refactor: rename vEvictionCandidates to eviction_candidates\n\nin ProtectEvictionCandidatesByRatio()\nper current style guide in doc/developer-notes.md",
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-06-13T18:15:45Z"
      },
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-06-10T08:51:39Z"
      },
      "sha": "7321e6f2fe1641eb331f30e68646f5984d4bcbb3"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0ZWU3YWVjNDdlYmY2YjU5YjRkOTMwZTZlNDAyNWU5MTM1MmMwNWI0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4ee7aec47ebf6b59b4d930e6e4025e91352c05b4",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/4ee7aec47ebf6b59b4d930e6e4025e91352c05b4",
      "tree": {
        "sha": "85b8dbf02595930be27cf35ac4a7e778c93e190c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/85b8dbf02595930be27cf35ac4a7e778c93e190c"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 85b8dbf02595930be27cf35ac4a7e778c93e190c\nparent 7321e6f2fe1641eb331f30e68646f5984d4bcbb3\nauthor Jon Atack <jon@atack.com> 1623318295 +0200\ncommitter Jon Atack <jon@atack.com> 1623608147 +0200\n\np2p: add m_network to NodeEvictionCandidate struct\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmDGS1QACgkQT1chs9Dj\nkh1LnRAAsBV58bDo1h7+/7LBuynSrTpeyCDyATAtdScIKQAAD/NuZSVlq/A3ptXV\nOg+CFXWnuxqwURZTTyK8GskAJNgulc2gAUMhj4+fbotcE9MMm04Rz69qAlbzWbNz\nFUlRCiFO9L9sEuS4pBRiO+3p/I32mSu9Vgxb1fjvRzjBxpgV6eGoBpOvXJtx2fh5\nsA83f3feY6HYIJWdS5Bh0nHki66GbkFlT981qP34Mord9W/d+Ex9jhjavWDaBd/X\nZEmWC5R5A4P8R6JdgKU6KcMAMuFZ2aUK24Y+nSgB4zJeHpBjxpteqYEcE4Vi7rlL\nh/xrv5Xhnd6UvnSLMeEzbupv30a2SOf8by8fUSYqFyG+4IeyiJ7eCsK2wx3AooYm\nX1Vp9/BYcOG9FcpOCQU6vMaWT7YeJq752jFApuDptVmE/kJYDeWjPD5DxKVzEdr4\n7G0vKtwJaDZjLNBVNDoWBZdkbsGIbJwvdu+8YwPz1xwoG9KF7fj6AbN3QybvYvk9\nZPwBkahhMQbIZRK3iIgdBMhNqlJlju867SAtMxsj8DFkUaTtf3tLyF1WC+3RAtlp\n9K10lTW3HaimuzGsAd8z84Jxz3oNotPtro2xlJNzkMGjg7u1VH81waScV4pXqYqV\ny9Ind1HDWpoY/6717mTD9HMAQnDaNGZ452dFj6SHGopfq3hKhF0=\n=6EME\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwIPyq4k1L9bmrI4aGr0w+fgVBytv2lDfEenNtMTnz5TZ1CP/wEA3JCX7PqfNI\nKB52UsBRWx8I8SAToGWLVqFeqZRErUlFh+Q5kH7Mfws6h20J2D5snHcOUAjwICVB\n38pPJgfHy6Vko8WUI6kWkewHeJWMoWiEe9ZWPXwZCPAgBGaMuKfYq2+YBLnaKLgB\nm+ztgfdT8uDaAlTx5QLvfBUI8QRgxktV8AiLR7BvIAGrAgCD3+MNLvkMjikoaHR0\ncHM6Ly9maW5uZXkuY2FsZW5kYXIuZXRlcm5pdHl3YWxsLmNvbf/wEBejsFRyNm74\nkxjw4ndx8DAI8QRgxktV8Ag7yrdqQJrpKACD3+MNLvkMjiMiaHR0cHM6Ly9idGMu\nY2FsZW5kYXIuY2F0YWxsYXh5LmNvbf/wEGgGnPr58tow3QtuZhEMzIwI8QRgxktV\n8Ah4O35Hfbxa6gCD3+MNLvkMjiwraHR0cHM6Ly9ib2IuYnRjLmNhbGVuZGFyLm9w\nZW50aW1lc3RhbXBzLm9yZ/AQtsZ88tvSZwdPwFw9xu0xmAjxIGeZYv33r0hnI9yo\nC3gRqO6/RICEL/4Z+i4dhbqajoN+CPEgD3MpbxtreQNH6yopBdGlTD8mDpAi5+Fj\nrwSze3E1CNsI8CDK02ltnsSGB7BS2RI+dW1fy4GtNbry1Bvn1i/kVy5KIwjxBGDG\nS1XwCP7imoAHiySbAIPf4w0u+QyOLi1odHRwczovL2FsaWNlLmJ0Yy5jYWxlbmRh\nci5vcGVudGltZXN0YW1wcy5vcmc=\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7321e6f2fe1641eb331f30e68646f5984d4bcbb3",
          "sha": "7321e6f2fe1641eb331f30e68646f5984d4bcbb3",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/7321e6f2fe1641eb331f30e68646f5984d4bcbb3"
        }
      ],
      "message": "p2p: add m_network to NodeEvictionCandidate struct",
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-06-13T18:15:47Z"
      },
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-06-10T09:44:55Z"
      },
      "sha": "4ee7aec47ebf6b59b4d930e6e4025e91352c05b4"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzozOGE4MWE4ZTIwYjBlNWFkOWZlZjBlYWU4YWJkOTE0NjE5ZjA1YjI1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/38a81a8e20b0e5ad9fef0eae8abd914619f05b25",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/38a81a8e20b0e5ad9fef0eae8abd914619f05b25",
      "tree": {
        "sha": "95e3fa63555f284ba5c035561019df4c48c44e9e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/95e3fa63555f284ba5c035561019df4c48c44e9e"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 95e3fa63555f284ba5c035561019df4c48c44e9e\nparent 4ee7aec47ebf6b59b4d930e6e4025e91352c05b4\nauthor Jon Atack <jon@atack.com> 1621242548 +0200\ncommitter Jon Atack <jon@atack.com> 1623608149 +0200\n\np2p: add CompareNodeNetworkTime() comparator struct\n\nto compare and sort peer eviction candidates by the\npassed-in is_local (localhost status) and network\narguments, and by longest uptime.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmDGS1YACgkQT1chs9Dj\nkh14pRAArWcWJvOn/iToKfwk355JMGGVpHObe0+shBmjvO1TQDBpDE2NkLs22Wdi\neI2qXOuRdKog7uQuKR6Me7k1l9swIRo1nw0RJNtpuEtdQek1cIsFV+0AJ14+bzn5\nJzseZJF9bEYXQjIXt31ffe7TxoULmTM1lKF+zdIL3MQqUb0ABJsOBuGRr8q97/Vi\nQgcVG7ImPToC7BAeTl7xLTN4hmH2GECYXr91LC+X53K7L3PjgQwuUSn8RXhlmOcm\n/Fxj64N2jfSfheW0OQk7G1qP4PykpQwQFuWSWFKk307++zYO0E/Rb0UUDrhpqYBc\n2QElXjdGW0QKGEK3+fZbiVi4FY4tmPpfHNmEeJ2SKiFTIjchRU0doUmCx0na7wCw\n48591jf3NbNYgS/sSUnG1DsxtWItD3ReMQU7zDfmPnh7fjcP9VDk4OzTWKT6oEBt\nLIdTJJ35GjKjVsPR15jnhKCfnMazf6/VvKpcPfEIJGf1efkG9/JRJgs0dfnCAdkh\nKJuHKsi0pcCwXknJu5IFKDuYJ9+l30N/ry44XJrT9ljNrprl5ZUyuguB+Y++5SCV\n0yZV/GAGoL7tmtI6oo53UfcSnSYHHyZZU/CY5s8BpcNqrlO0RljFnvuFny69AEQ6\nScwUSjCdFdojmf04rR+aJDU05UGCLpgmMr/v9OgqD3Im9oQrmwE=\n=aeHn\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwIJ+Ely0k0ECov6ArgDxw0TtDDGhu718Vk5PXcpLH2VLwCP/wEALQJ3j4VTQa\ngXa3eMQc5zgI8QRgxktX8Ag75WR6JUEVxgCD3+MNLvkMjiwraHR0cHM6Ly9ib2Iu\nYnRjLmNhbGVuZGFyLm9wZW50aW1lc3RhbXBzLm9yZ//wECeyncXjQC7XKL1kpbxR\niwwI8SAEcYEIEUxaqERWY8ohaypzQ4msMNg6fEGg0mH1et/8bQjxIO9SOj9ikYrE\n1X34cSxfPPOQP30O2dxNDEvnRiNl6vWnCPEEYMZLV/AI6vuCOAIf7W4Ag9/jDS75\nDI4uLWh0dHBzOi8vYWxpY2UuYnRjLmNhbGVuZGFyLm9wZW50aW1lc3RhbXBzLm9y\nZ//wEJsAIl0kPSI+ufqyoK9ptkAI8QRgxktX8AjN3kKAXTEhQACD3+MNLvkMjiMi\naHR0cHM6Ly9idGMuY2FsZW5kYXIuY2F0YWxsYXh5LmNvbfAQ3b+8nszFIcrwiSAf\nDPJ8agjxBGDGS1fwCEsCBOwUt0x5AIPf4w0u+QyOKShodHRwczovL2Zpbm5leS5j\nYWxlbmRhci5ldGVybml0eXdhbGwuY29t\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4ee7aec47ebf6b59b4d930e6e4025e91352c05b4",
          "sha": "4ee7aec47ebf6b59b4d930e6e4025e91352c05b4",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/4ee7aec47ebf6b59b4d930e6e4025e91352c05b4"
        }
      ],
      "message": "p2p: add CompareNodeNetworkTime() comparator struct\n\nto compare and sort peer eviction candidates by the\npassed-in is_local (localhost status) and network\narguments, and by longest uptime.",
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-06-13T18:15:49Z"
      },
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-05-17T09:09:08Z"
      },
      "sha": "38a81a8e20b0e5ad9fef0eae8abd914619f05b25"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzozZjgxMDVjNGQyNTFlMGU4MWJkZDMxZjA5OTkwMDRlMzZmODk5MGIy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3f8105c4d251e0e81bdd31f0999004e36f8990b2",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/3f8105c4d251e0e81bdd31f0999004e36f8990b2",
      "tree": {
        "sha": "ea3396646bffe279aa5b1544bf1dc2781a7af9c7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ea3396646bffe279aa5b1544bf1dc2781a7af9c7"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree ea3396646bffe279aa5b1544bf1dc2781a7af9c7\nparent 38a81a8e20b0e5ad9fef0eae8abd914619f05b25\nauthor Jon Atack <jon@atack.com> 1622668501 +0200\ncommitter Jon Atack <jon@atack.com> 1623608151 +0200\n\ntest: remove combined onion/localhost eviction protection tests\n\nas we are about the change the behavior sufficiently that when we\nhave multiple disadvantaged networks and a small number of peers\nunder test, the number of protected peers per network can be different.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmDGS1gACgkQT1chs9Dj\nkh1XKA//WZImweiibj2NzsbxhdCVQNTNLDeymrNHfMTbrwxvr8QVntOPSXQ8C/eG\nfSUkXIc5RF8pPinPvvUhSMAbfVEES47ccTdjovxoW5npLs0TCnQgx/efNaK1yTIg\njHghxaXCA3RY60tTk2ItGQTBLzg/QKwOAyLOOk1pteLIN18GcHY8xJfLEoY2sbOj\nxvsqby1s03zQavT5HV818GeEmysVDibEQyr7T26rCsp/lm6BfkUxfBnczIHxxF+m\nSq77qCP4LY7EwPRPtxSgX5ASQMNSiacu8PP14/yclyQCJRg7XI4N++KUQM8sq60G\n9xAV3w7GFC0haSaGTHq/TS6uSreKWszZGByUp1zXdCbS7yVsAerFT1mLGjQFEznA\n4G91zz50bkbCJcuiSpMd8CyKVuGpVUQip0kmzR57x7gW8JBnpxaPfBd6xgN8OM+y\n26QA+wU4FJyLyC6Hx8U8dL5wow3SOriiUTjVYhnRq7GMstOxPGenqI0mBtkFX/Id\noGwZIPJKZWCxQ1eW4XQab/LLMdh8Nso11/tmcLVfOVzldIUaCwub2SC8LX4G6ztk\nrCrnrG6+kei9ID/yAofZkw60EwS3QmQDhE1hzeFc6HR+Dqx1UBtf5eGD4uMgE2Ms\nyz2L21DDc5SwPdN0ilRkC/8KbL5YaKn+sXY+fyySPYkQXETD+bc=\n=QFI4\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwIK3BU3dpwL4kStW/roFB8OaEASf6TJapuiVdg2Y/KQQbCP/wEEV4jsBA6LBd\n5V9rlp6uvLcI8QRgxktZ8Ai88SdX9HkBXgCD3+MNLvkMjiwraHR0cHM6Ly9ib2Iu\nYnRjLmNhbGVuZGFyLm9wZW50aW1lc3RhbXBzLm9yZ//wEEZ0C+32cE0GbORi0+RA\narUI8QRgxktZ8Ajd+bT1oN/RmQCD3+MNLvkMjiMiaHR0cHM6Ly9idGMuY2FsZW5k\nYXIuY2F0YWxsYXh5LmNvbf/wEHXMnLw4oVEPvBEbfZnAr/wI8QRgxktZ8AgXyu25\nvSbW3gCD3+MNLvkMji4taHR0cHM6Ly9hbGljZS5idGMuY2FsZW5kYXIub3BlbnRp\nbWVzdGFtcHMub3Jn8BCBAsOoaMKIx2ydfLehmzY9CPEEYMZLWfAIlziZT9EDlBMA\ng9/jDS75DI4pKGh0dHBzOi8vZmlubmV5LmNhbGVuZGFyLmV0ZXJuaXR5d2FsbC5j\nb20=\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/38a81a8e20b0e5ad9fef0eae8abd914619f05b25",
          "sha": "38a81a8e20b0e5ad9fef0eae8abd914619f05b25",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/38a81a8e20b0e5ad9fef0eae8abd914619f05b25"
        }
      ],
      "message": "test: remove combined onion/localhost eviction protection tests\n\nas we are about the change the behavior sufficiently that when we\nhave multiple disadvantaged networks and a small number of peers\nunder test, the number of protected peers per network can be different.",
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-06-13T18:15:51Z"
      },
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-06-02T21:15:01Z"
      },
      "sha": "3f8105c4d251e0e81bdd31f0999004e36f8990b2"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4882544611,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDg4MjU0NDYxMQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4882544611",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-13T18:27:00Z"
    },
    {
      "event": "reviewed",
      "id": 682737970,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjgyNzM3OTcw",
      "url": null,
      "actor": null,
      "commit_id": "a457f34e5039b75ee015b273028c3ee153656d5c",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK a457f34e5039b75ee015b273028c3ee153656d5c",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#pullrequestreview-682737970",
      "submitted_at": "2021-06-14T11:24:13Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
    },
    {
      "event": "commented",
      "id": 860624384,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg2MDYyNDM4NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/860624384",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-14T11:53:32Z",
      "updated_at": "2021-06-14T12:54:51Z",
      "author_association": "MEMBER",
      "body": "I've been running this PR (various versions) on a busy node for the last weeks. Unfortunately this node has a really high `maxconnections` (500, while average number of connected peers is 200) so I just realize I haven't been actually testing the eviction behavior :blush: \r\n\r\nIn any case\r\nCode review (and lightly tested) ACK a457f34e5039b75ee015b273028c3ee153656d5c\r\nCode review re-ACK 1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#issuecomment-860624384",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21261"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxZTE1YWNmNDc4YWUwNzEyMzQzNTBjOWIzOGRjODIzZGZlMmUzNDE5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1e15acf478ae071234350c9b38dc823dfe2e3419",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/1e15acf478ae071234350c9b38dc823dfe2e3419",
      "tree": {
        "sha": "4eb1366de749464a4cb614e4c72099d184331270",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4eb1366de749464a4cb614e4c72099d184331270"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 4eb1366de749464a4cb614e4c72099d184331270\nparent 3f8105c4d251e0e81bdd31f0999004e36f8990b2\nauthor Jon Atack <jon@atack.com> 1618917740 +0200\ncommitter Jon Atack <jon@atack.com> 1623671869 +0200\n\np2p: make ProtectEvictionCandidatesByRatio() fully ratio-based\n\nwith a more abstract framework to allow easily extending inbound\neviction protection to peers connected through new higher-latency\nnetworks that are disadvantaged by our inbound eviction criteria,\nsuch as I2P and perhaps other BIP155 networks in the future like\nCJDNS.  This is a change in behavior.\n\nThe algorithm is a basically a multi-pass knapsack:\n\n- Count the number of eviction candidates in each of the disadvantaged\n  privacy networks.\n\n- Sort the networks from lower to higher candidate counts, so that\n  a network with fewer candidates will have the first opportunity\n  for any unused slots remaining from the previous iteration.  In\n  the case of a tie in candidate counts, priority is given by array\n  member order from first to last, guesstimated to favor more unusual\n  networks.\n\n- Iterate through the networks in this order.  On each iteration,\n  allocate each network an equal number of protected slots targeting\n  a total number of candidates to protect, provided any slots remain\n  in the knapsack.\n\n- Protect the candidates in that network having the longest uptime,\n  if any in that network are present.\n\n- Continue iterating as long as we have non-allocated slots\n  remaining and candidates available to protect.\n\nLocalhost peers are treated as a network like Tor or I2P by aliasing\nthem to an unused Network enumerator: Network::NET_MAX.\n\nThe goal is to favorise diversity of our inbound connections.\n\nCredit to Vasil Dimov for improving the algorithm from single-pass\nto multi-pass to better allocate unused protection slots.\n\nCo-authored-by: Vasil Dimov <vd@FreeBSD.org>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmDHREUACgkQT1chs9Dj\nkh0w7hAAp6uOoqHWgO3audmM1HCN10OSCbbkWjwW0W61BFCmAknxZ4lRZz6LVCFw\nfnjegESlK2Zy3j0IHkJ4WN+AwBFtj2VpCZ7jR7nIBvpyPEgZzvc6jxXu4YV5p/K/\nNxiJFNTzv+PuLi3zOkRuXUw7W17+4X7kU/L1HKTm5cul/oRXMmN7ew2R6EiVg3Zs\nXHedlfqZVeeiojDqkJZsEJQLnMcYoKm+O8107GSKoPEOhy4SV3g6n5g86OEVQKKw\nv1mfBDbxtCUCdhf6MV1TzahfD7z74itEtyxlXAdUScnqLZp81iZFk5LzICQZovU7\niAd8g/13leqvcu6bf1cE5l9AqLGgecvjefGJxHbTvnvOfiHDlv9mi6MQiY0GQErH\nOpXqteH+3Mh4ClSz5ci/RXkQGiJhv9pIRT1YH9XBHguEQxE3AgmmaJg14jEaSrgK\nyAgH43hwf/2bZjWYcbWp1yVgm54Gcs9ZEj5qsLx69IdS+4cLjaemmgp708JGqnXJ\nMRfVnpdra3B9TVn+GWwIgCwbWJaicB5kaYY7Y99r5xJ6ksVlum8qkFVMnNmr0g48\nnVsun+r58xu/FiJasfElnnz5vbrz/t7Jdgq7kpKQ/zZeZEhU0tSg7b3l+cEIN+sj\nSKzR8IGGRj7Ydx9N+AZlhYMePQPyzrsLCRYWA7n56qTAeih6nNk=\n=sLJd\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwIJUKnd+9tZWD6Ez18UaeVOUAmL2LbIi7fclx0jXAmhqBCP/wEIHSpWsZzzBD\np1GUWlAXwJ8I8SCheFLK6QxmXrxGGuxb7PzpaRds/ZBGTe6EQsUKT7jS9gjxBGDH\nREfwCKBAdmCQ2fQKAIPf4w0u+QyOKShodHRwczovL2Zpbm5leS5jYWxlbmRhci5l\ndGVybml0eXdhbGwuY29t//AQhuqbj+/AkHxPJI68lxuHyAjxIOgC52zGQk6G8vWM\ncKDvOfbMgtdzMl3W4QoGEUpSR2BICPEEYMdERvAIT2YDBisX97QAg9/jDS75DI4j\nImh0dHBzOi8vYnRjLmNhbGVuZGFyLmNhdGFsbGF4eS5jb23/8BCKRfqzi6EnwG3k\nWBSWVaEQCPEgzg2Ln0qtVUsJYrKULHxgIJIrmqaXrXODYTf7I4uE4UMI8QRgx0RG\n8AiyGrN85xT7mACD3+MNLvkMji4taHR0cHM6Ly9hbGljZS5idGMuY2FsZW5kYXIu\nb3BlbnRpbWVzdGFtcHMub3Jn8BDaMr6fEWqrRJlovbcOGrYVCPEgOL7LnAJdgSKf\n0VTb2GnhySBikvFwywsmlaDCX7uVExsI8QRgx0RG8Ag0H8Oehm757wCD3+MNLvkM\njiwraHR0cHM6Ly9ib2IuYnRjLmNhbGVuZGFyLm9wZW50aW1lc3RhbXBzLm9yZw==\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3f8105c4d251e0e81bdd31f0999004e36f8990b2",
          "sha": "3f8105c4d251e0e81bdd31f0999004e36f8990b2",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/3f8105c4d251e0e81bdd31f0999004e36f8990b2"
        }
      ],
      "message": "p2p: make ProtectEvictionCandidatesByRatio() fully ratio-based\n\nwith a more abstract framework to allow easily extending inbound\neviction protection to peers connected through new higher-latency\nnetworks that are disadvantaged by our inbound eviction criteria,\nsuch as I2P and perhaps other BIP155 networks in the future like\nCJDNS.  This is a change in behavior.\n\nThe algorithm is a basically a multi-pass knapsack:\n\n- Count the number of eviction candidates in each of the disadvantaged\n  privacy networks.\n\n- Sort the networks from lower to higher candidate counts, so that\n  a network with fewer candidates will have the first opportunity\n  for any unused slots remaining from the previous iteration.  In\n  the case of a tie in candidate counts, priority is given by array\n  member order from first to last, guesstimated to favor more unusual\n  networks.\n\n- Iterate through the networks in this order.  On each iteration,\n  allocate each network an equal number of protected slots targeting\n  a total number of candidates to protect, provided any slots remain\n  in the knapsack.\n\n- Protect the candidates in that network having the longest uptime,\n  if any in that network are present.\n\n- Continue iterating as long as we have non-allocated slots\n  remaining and candidates available to protect.\n\nLocalhost peers are treated as a network like Tor or I2P by aliasing\nthem to an unused Network enumerator: Network::NET_MAX.\n\nThe goal is to favorise diversity of our inbound connections.\n\nCredit to Vasil Dimov for improving the algorithm from single-pass\nto multi-pass to better allocate unused protection slots.\n\nCo-authored-by: Vasil Dimov <vd@FreeBSD.org>",
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-06-14T11:57:49Z"
      },
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-04-20T11:22:20Z"
      },
      "sha": "1e15acf478ae071234350c9b38dc823dfe2e3419"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3ODdkNDZiYjJhMzlmYjM5MTY2ODgyY2M2ZTBhZmJjMzQ0MjRkODhl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/787d46bb2a39fb39166882cc6e0afbc34424d88e",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/787d46bb2a39fb39166882cc6e0afbc34424d88e",
      "tree": {
        "sha": "faa7ed8fc43139c45d77d1c2f8979a8696b65ed7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/faa7ed8fc43139c45d77d1c2f8979a8696b65ed7"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree faa7ed8fc43139c45d77d1c2f8979a8696b65ed7\nparent 1e15acf478ae071234350c9b38dc823dfe2e3419\nauthor Jon Atack <jon@atack.com> 1618913860 +0200\ncommitter Jon Atack <jon@atack.com> 1623671879 +0200\n\np2p: update ProtectEvictionCandidatesByRatio() doxygen docs\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmDHREcACgkQT1chs9Dj\nkh0jpQ//SbEtMeR1P0N5FbhcYWjU52/sEJp3oLC7y5oLTOP8IZfTR7sB1T/IX59u\nYpg+hQSO1fHnG4am61mqbRz+VdNnDZUA0/daAdOINVTIxq04B2FenXDaGoir2sAB\nrBJx1LbuF03wWycR77lmCuaScfQKvnDqRg/XCC/vV7cWQ39BeUrmInVc3U0gV7yH\nQrDYfMHBHnOQ2TBkTdhdw/Z4wG0I2E4leCIixJlIs7QzD/hd8vFefNszlPM+/eAW\nVsSDTRiUhV9JhiVA6A6CkPaJIJcYN+J37LF5dOuxG9T7H8BpwwBf6vMpzix6HcLx\nAS8G/hqU3r4V9vys9+Qbv5Lyy1wKA8luyLAQvk3waP+tt7EMUT0s5635WpH5l46H\nQKjSxACwoJ1xLnxb2oRKsAyLkj4P+bNfPS/fxlAy4qKPYPAb5u75sJpxbd9V+8Jd\nmYiTixmQRwpScEM2w2M23ShBj8+r7Vgqis/YHyLEddHujFnuun4qnbOHPOVV8T6H\nDyFH/XvpDMaB3EEFXrxgy1Ldb1m/acBNXvN4ymkQDEyVFbGqG8r2Hz43czDEKowj\narsJYtbF8Ueas+w0a5aPWx/e0+r+uzxKSmhkz7l9DE0ibyYuZCT/Mdc495rt/ZXh\n5UTn2Edlamu5i6oWT3fPYZpcMco2Qjb8/X9RdJrKAEE5339x3Qs=\n=C+Km\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwIM5PVoDXH+wi3D56wETijNf73Q2ikth1xX1DY6pY1K2JCP/wEBAp+/a3eFjx\nbJdBTXAMrMQI8SAR/iE5UTKeUOpFhzh1x6Dl6UHiXSoPL+rbADKspDS+6QjxBGDH\nREjwCOtrBWJwgfI7AIPf4w0u+QyOIyJodHRwczovL2J0Yy5jYWxlbmRhci5jYXRh\nbGxheHkuY29t//AQTpnNXinx6OEAdIbAxj//tAjwINR2d4WMrVXoJ4AddY6u+nbI\n3HoXHqwBfNkyJjfR7BV7CPAgwGfTWY5v2Yypg1WwFtc4zd3yiiVzWK7LxCFDkiz0\ntU4I8SD5ZXwsc4tv1Ktg6HTJfs6UD2PqDtmcYHhI4SLRgm7QogjxBGDHREjwCOVn\nNB/H0ueXAIPf4w0u+QyOLi1odHRwczovL2FsaWNlLmJ0Yy5jYWxlbmRhci5vcGVu\ndGltZXN0YW1wcy5vcmf/8BChgfgT29Ks+S72/bVW68JbCPEgBv1Pp9iv0vvkWGir\nR0Rlb+JbE/QOptaeGR+IHPsdqXgI8QRgx0RI8AgVbWPmzE1upwCD3+MNLvkMjiwr\naHR0cHM6Ly9ib2IuYnRjLmNhbGVuZGFyLm9wZW50aW1lc3RhbXBzLm9yZ/AQs6pm\nmCqIfa/spMoiJNrS7AjxIFlYllFWzNmrSbBpF+UL3eV+jV1htOz/dUU+lyJGKv4y\nCPEgDami2sC4kTA+AgMgDpuKhbs09Lens7XJZor6aKa0LQII8CBTv+ZyGTzYO247\ntxFDDYzyTkf/bdM/fly0QqYqvtDzzwjxBGDHREnwCOBglIp3lBQxAIPf4w0u+QyO\nKShodHRwczovL2Zpbm5leS5jYWxlbmRhci5ldGVybml0eXdhbGwuY29t\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1e15acf478ae071234350c9b38dc823dfe2e3419",
          "sha": "1e15acf478ae071234350c9b38dc823dfe2e3419",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/1e15acf478ae071234350c9b38dc823dfe2e3419"
        }
      ],
      "message": "p2p: update ProtectEvictionCandidatesByRatio() doxygen docs",
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-06-14T11:57:59Z"
      },
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-04-20T10:17:40Z"
      },
      "sha": "787d46bb2a39fb39166882cc6e0afbc34424d88e"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5ZTg4OWU4YTVjMDIxYjBlYzdlNGM0ZDE3ZDQxOGFiNGEwYWNjYWQ0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9e889e8a5c021b0ec7e4c4d17d418ab4a0accad4",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/9e889e8a5c021b0ec7e4c4d17d418ab4a0accad4",
      "tree": {
        "sha": "312b1193d503075e141960a17dfa46e7c841231a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/312b1193d503075e141960a17dfa46e7c841231a"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 312b1193d503075e141960a17dfa46e7c841231a\nparent 787d46bb2a39fb39166882cc6e0afbc34424d88e\nauthor Jon Atack <jon@atack.com> 1623406089 +0200\ncommitter Jon Atack <jon@atack.com> 1623671881 +0200\n\np2p: remove unused CompareOnionTimeConnected()\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmDHREkACgkQT1chs9Dj\nkh2lEg//ZoTH6dy5Lfl5F0xvcc1CcnqRxtlOPvA6Wyj1Cssr8CnZf6xUAIAc3mCu\nyV12t4olaEZqVEeUwTydA6ezN3OlGpUiaHDloJDYijBONe3NI6OM5aZ7z5GLGJoL\nyw6ug4eMNsDDL4s3Q/jVUgj3Ke2aROGbA/m7Wtf48VmV02utR15iNQCqM404kKE+\ns4z2lBtFrNFoIVZBggmI2v6+/5YytC3xBWDa7rxeyGD/9Iq0pLE2F8hK/4riUWGV\nSuPiOg3NevB5wlyOO7o0oNMyryosUQmILU1F02b8AB12I6WiTu0cmd8Ya2L28T7d\nlcg8XVJSzhujfM6WVyk9vKtCBZc0SIa8wgMHf9ndBNUtilX4Nqjee7bsec2CL2lV\nOH1PerTMncXzri1pHQFdfkhk+DY3VQ+jiKXDs2gYDbpCffgIp4XlfFJV0b4Liumk\nFD5apC8QeYX5Ys5vpebnf7jxvBnt0G2jl+asPfx70WJQ0ZCmcfSl8J7/EOrgvVJR\nWJzYUHFv+iePH6YoMSND21LbonfIJgZxQ2/3BCn17jx+3xncWESIJPS/XBDLQQn1\nZJH/6wjvtvaQJhj3ON+yLtFzZYlAdwyxpSbwx/FEU09C7/r29t8ECaPPp4uR6hp/\nsAwSlJjJzk7TuBgA2W9bZxl9TApNqpHupQG+hA6EGMe98au9+YQ=\n=fU7U\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwIAX/bQUlC45Ilj01GUe2xIkPkxXI0GHqiB8WlPy+nCfGCP/wEBFFUDauh6Ub\nN6/45GhsD8YI8QRgx0RL8Ahwy+0VkiEh1gCD3+MNLvkMjikoaHR0cHM6Ly9maW5u\nZXkuY2FsZW5kYXIuZXRlcm5pdHl3YWxsLmNvbf/wEFk9Z5EJwDnyKL6yMULR4/gI\n8QRgx0RK8AiPwp/ucsOKQgCD3+MNLvkMjiMiaHR0cHM6Ly9idGMuY2FsZW5kYXIu\nY2F0YWxsYXh5LmNvbf/wEN6eX8bX1leJb//8YflIYy4I8QRgx0RK8Agh46zhp6Xf\nXQCD3+MNLvkMji4taHR0cHM6Ly9hbGljZS5idGMuY2FsZW5kYXIub3BlbnRpbWVz\ndGFtcHMub3Jn8BDorOvPvEbgZVuPf+juQ9xZCPEEYMdES/AI4PMkRdn88pMAg9/j\nDS75DI4sK2h0dHBzOi8vYm9iLmJ0Yy5jYWxlbmRhci5vcGVudGltZXN0YW1wcy5v\ncmc=\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/787d46bb2a39fb39166882cc6e0afbc34424d88e",
          "sha": "787d46bb2a39fb39166882cc6e0afbc34424d88e",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/787d46bb2a39fb39166882cc6e0afbc34424d88e"
        }
      ],
      "message": "p2p: remove unused CompareOnionTimeConnected()",
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-06-14T11:58:01Z"
      },
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-06-11T10:08:09Z"
      },
      "sha": "9e889e8a5c021b0ec7e4c4d17d418ab4a0accad4"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzozMTBmYWI0OTI4MmQ1MDdlNWZhNzEwYWZiMjBkMDM2NjA0YmJmM2Ey",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/310fab49282d507e5fa710afb20d036604bbf3a2",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/310fab49282d507e5fa710afb20d036604bbf3a2",
      "tree": {
        "sha": "b1e440e10e27be3b55a442cea8c29b1d2de2e9c1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b1e440e10e27be3b55a442cea8c29b1d2de2e9c1"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree b1e440e10e27be3b55a442cea8c29b1d2de2e9c1\nparent 9e889e8a5c021b0ec7e4c4d17d418ab4a0accad4\nauthor Jon Atack <jon@atack.com> 1623406107 +0200\ncommitter Jon Atack <jon@atack.com> 1623671883 +0200\n\np2p: remove unused CompareLocalHostTimeConnected()\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmDHREwACgkQT1chs9Dj\nkh0uPw/+LGYSLwx4373vX1JCahTqG54djh36Bvc2I6A5vHEbInPFS6lD+Us1Bzf+\nIknQE7XZ/10z5QPV8mUp41EJ/bKECPuL0taji70t6D0UQYLNMHew6yDltTNl9ATD\nen7jniW/MiJ2R/eXbzRPX48EMLluoEF/VvTP8Emsn+hkn7+cA1Y4RBFeHXiXBT9K\nmn5r+KW+EW4Uqr7eAVu4AOsfAdXKRaOXpcyxdbB9p+nG4ykIK8kleuxi/CfC7cto\nibTrt7pQbIKlIWSIT7p4xJM4hRvbVfq2yCUdAGE3L0/rGggSxdw5kPk7e+d2CE8L\nTzyhoXbhMo3ny0VVnTU+q0ajfF8zoLqM2/EitVNODNT2+Ixq9ySr7e+g0esijubl\nNusCnNFpjeUnJAw5p6Hc5yjhf4vwA9cTi9mmJX3jPnu2nbEuH2bmXGE6a+3xwL90\nfI0S7867PrQ8Ju+nnoTN3xPqBoAUyBY8SYeZvWPiq4vCmq2E+pRi8/0bm43bvu8k\n7oooUHhh+0HDw2gkyvaxyQSu78KSI7mtM3DWk+TfgyU+is/3FnVuDvpIUn11lzqF\nNCNSsik5AcYb2B1lqllcM5C6Q/qYM31EjKRUpQSFejSVKIr/uxIIA5ViQbnW998p\nffzHqL5Wq0nJsBkV7zsSH2tWlVqoBAIB3eeuVldMZTn2cplapJw=\n=fEak\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwII6DNfafVn1m/NBnffN96N6lrg2bc4tY2Wq3AtLjblbhCP/wECCdcEf8tQ4W\nu0pcyxxTJB8I8QRgx0RN8AgdkdGnPTbNWgCD3+MNLvkMjiMiaHR0cHM6Ly9idGMu\nY2FsZW5kYXIuY2F0YWxsYXh5LmNvbf/wEGRF/Im5wMn5IdRn6xCYvMsI8QRgx0RN\n8AisiZwb04iTvgCD3+MNLvkMjikoaHR0cHM6Ly9maW5uZXkuY2FsZW5kYXIuZXRl\ncm5pdHl3YWxsLmNvbf/wEKd5fyHa2+QHGF6D+D/T5a0I8QRgx0RN8AgR/hQGY25m\ntQCD3+MNLvkMjiwraHR0cHM6Ly9ib2IuYnRjLmNhbGVuZGFyLm9wZW50aW1lc3Rh\nbXBzLm9yZ/AQu+j72rw9dEr8DZLpe0ALYAjwIJh4GUoo/mH1f2I1l2WAUCeFIkE/\nqqhec4pQLsgjIHBNCPAgiw7ZH2cVrUHyIb8cZViBxi4IQJEjl/JnYL/ERqJuCf4I\n8QRgx0RN8Ahz4KFzzpDZnQCD3+MNLvkMji4taHR0cHM6Ly9hbGljZS5idGMuY2Fs\nZW5kYXIub3BlbnRpbWVzdGFtcHMub3Jn\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9e889e8a5c021b0ec7e4c4d17d418ab4a0accad4",
          "sha": "9e889e8a5c021b0ec7e4c4d17d418ab4a0accad4",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/9e889e8a5c021b0ec7e4c4d17d418ab4a0accad4"
        }
      ],
      "message": "p2p: remove unused CompareLocalHostTimeConnected()",
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-06-14T11:58:03Z"
      },
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-06-11T10:08:27Z"
      },
      "sha": "310fab49282d507e5fa710afb20d036604bbf3a2"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzowNDVjYjQwMTkyYmYzZGZhNmM0MjkxNjIzN2U1NWY4NmJiYzc4OGQ0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/045cb40192bf3dfa6c42916237e55f86bbc788d4",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/045cb40192bf3dfa6c42916237e55f86bbc788d4",
      "tree": {
        "sha": "c482449df5b49cfbf20c412da05fadeec21e2afe",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c482449df5b49cfbf20c412da05fadeec21e2afe"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree c482449df5b49cfbf20c412da05fadeec21e2afe\nparent 310fab49282d507e5fa710afb20d036604bbf3a2\nauthor Jon Atack <jon@atack.com> 1623405248 +0200\ncommitter Jon Atack <jon@atack.com> 1623671885 +0200\n\np2p: remove unused m_is_onion member from NodeEvictionCandidate struct\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmDHRE4ACgkQT1chs9Dj\nkh2S/w//TuwDvd3VI1Jdo1X+bwKHZE8yM+BbTSd9vR9fHnR+D0CgfYoB2EX06zJC\nYncPMoenPR9DZ0nGxLb9b46pVGa8G7Nxt6zH/Lz2vWqnMLNZhSh2E45AbeaWnuhH\n4hTSG6qyxfcho2T32F7FZAECS9zH59DayrMmYm1pr/olxFBdGBISvigAMIYEX7d2\n+y0zb2u1wZnBqLUb4QE1mCmO5K0C9s2HmttM1v+eZVY5mFFzlcqCn53XTrWzZNgu\nMaykgdalFia4dEC4TDW6lpHFbUzXtXkTdHTSUhmx9FLXCvQzNJDG/Y5eB2R1PEEQ\nynub56ghabxGOP8G6wAK6Vsp71CtdTOKtpVstb4U2N+1kHcgaWnU8Cz1xPJEZ0vj\nxZe/lcPPO1DjRgCalc/oLP44HwT1hUOrz0rCMcBmdQv289dFxiT0jKP3I2MIhYD4\nSvzHU/7K3n0tTuJO+LW3qfz1Tlb72NFeAwKpunPTdcFBxC+MvLPrJbpD5HArBEXc\nE+npTO79JHGF/pE8jZHYDrY0bCINul4iaXqeLdKT2HIN24McwqRKJYx2T5H/zI+E\nYT9uXkJ7kLjXIsD56fBz1fq5FwXWV8OzVS6KzdD/NWuXNoBwqmY5Z7TCtGR95JKd\nBz5SkJ3EszJLywpXoSDxapIT5VkOzompYE23lxaA+uQ4FVteKNc=\n=bkhz\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwIPcEW/GFKv/zC4KLhEoSFNerd5oET14Ai+dBP2jxvNUzCP/wEAK5vV64WvGl\ndf+hsPPUEIII8QRgx0RP8Aj1QaGq3RKkZwCD3+MNLvkMjiwraHR0cHM6Ly9ib2Iu\nYnRjLmNhbGVuZGFyLm9wZW50aW1lc3RhbXBzLm9yZ//wEDP5bwK/u3BXDoZZupoq\n3g8I8CD2DDr1t3M6Qm5ErNSoFixjoBI8t49t0tn3rVatz4g5bwjwIORagXhwuqj+\nCFOpZInkfWJbjQAPWb7IINucoVjKe91KCPEEYMdET/AI+ro59vSrWIYAg9/jDS75\nDI4uLWh0dHBzOi8vYWxpY2UuYnRjLmNhbGVuZGFyLm9wZW50aW1lc3RhbXBzLm9y\nZ//wEE86CKpUP2BUo6jvjOyE8eAI8QRgx0RP8AhXD3AXwz55iwCD3+MNLvkMjiMi\naHR0cHM6Ly9idGMuY2FsZW5kYXIuY2F0YWxsYXh5LmNvbfAQr5QmOWXRIJU2IsgG\nM8nKaAjxBGDHRE/wCMDBB0q7jsvWAIPf4w0u+QyOKShodHRwczovL2Zpbm5leS5j\nYWxlbmRhci5ldGVybml0eXdhbGwuY29t\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/310fab49282d507e5fa710afb20d036604bbf3a2",
          "sha": "310fab49282d507e5fa710afb20d036604bbf3a2",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/310fab49282d507e5fa710afb20d036604bbf3a2"
        }
      ],
      "message": "p2p: remove unused m_is_onion member from NodeEvictionCandidate struct",
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-06-14T11:58:05Z"
      },
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-06-11T09:54:08Z"
      },
      "sha": "045cb40192bf3dfa6c42916237e55f86bbc788d4"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3MGJiYzYyNzExNjQzZWM1N2NjZTYyMGY5ZjdhMGUxZmU1ZmI2MzQ2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/70bbc62711643ec57cce620f9f7a0e1fe5fb6346",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/70bbc62711643ec57cce620f9f7a0e1fe5fb6346",
      "tree": {
        "sha": "174daaec97e60d571884201eb7412c344effcb39",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/174daaec97e60d571884201eb7412c344effcb39"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 174daaec97e60d571884201eb7412c344effcb39\nparent 045cb40192bf3dfa6c42916237e55f86bbc788d4\nauthor Jon Atack <jon@atack.com> 1619102557 +0200\ncommitter Jon Atack <jon@atack.com> 1623672012 +0200\n\ntest: add combined onion/localhost eviction protection coverage\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmDHRNMACgkQT1chs9Dj\nkh1vSg/9GuPwPQYfkIT1abCRNn8Jb9hsKw3og+Lsy44XzXw7fE8xeBj537iqDDJb\nAK02+tXn6RDjLQ+tgyG/aXzL1D6NKO3RjvQbtZBQ9580XX0tKrxAidAXSilk6MN1\n/DeFCA3dGRk7vroCRWs/wj6Y/4He8Bkm+IKdkOstq5FZh86r9lZEQQ5DzoguE/mC\ngFFMRJQdcqtHwhdY8fe6DXdHxeZeyLLal42FJeId7G5Z5qE976wDL92Y0f656PNs\nI20zTe2K7owVGUadCvfHP9HvCYFaOiTAf2lPnbafzZiAdti3kw42P6dGNX9sWx+B\nJbHqWytfkDiG7nEYbyP4JF/hBBhW5XOrXQUta3FICGo5MKlI6TrdVZfj/Q7V+INt\nv7FpfioLdo+z2GlxK2MM4bRZZQNF5BE4GovGaGauadVuJDlXkVuxJDF4nilETc59\nGBI5+dz5BAQvGDe0S6QT1cgZSyo6euBrIELgm9nB/UmE1o7lE/iFneh77LFV7rZp\npeyYLvegUWjG1C78kNCHU7BEeyoLm8Fg3aDQF6ymX3wlrugnNI+O4ioq/5peghfX\n/H2S7rArtoktUBbMYFK1sIglHH2Ax880CRSzdRHXF4kxBBxR/OSBKfEZ021bEWxS\nfDXroj6bTpSDyNYG2Blmb+UaxgfW88uvCyLIXqzu61JoCA4N+Ks=\n=2uYI\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwIEMaupSX90JjEhxDNt75omRXY1T7Pz/pArCWF3+UiQ0tCP/wEF/xamkc3Zka\nwfVsTCUSvoMI8QRgx0TT8AiH6Tvoyc06DgCD3+MNLvkMjikoaHR0cHM6Ly9maW5u\nZXkuY2FsZW5kYXIuZXRlcm5pdHl3YWxsLmNvbf/wEG7nGf2vm+iT+WfDOEDztWsI\n8QRgx0TU8AjNTDhg2iudSACD3+MNLvkMjiwraHR0cHM6Ly9ib2IuYnRjLmNhbGVu\nZGFyLm9wZW50aW1lc3RhbXBzLm9yZ//wEPPQl0F79ZG1AvMZk6dIbJUI8QRgx0TU\n8AhiCjrcNQfFAACD3+MNLvkMji4taHR0cHM6Ly9hbGljZS5idGMuY2FsZW5kYXIu\nb3BlbnRpbWVzdGFtcHMub3Jn8BD+CEbYn6eR6rb/FTAmhJC9CPEEYMdE1PAIAjFu\n4cEeOcMAg9/jDS75DI4jImh0dHBzOi8vYnRjLmNhbGVuZGFyLmNhdGFsbGF4eS5j\nb20=\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/045cb40192bf3dfa6c42916237e55f86bbc788d4",
          "sha": "045cb40192bf3dfa6c42916237e55f86bbc788d4",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/045cb40192bf3dfa6c42916237e55f86bbc788d4"
        }
      ],
      "message": "test: add combined onion/localhost eviction protection coverage",
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-06-14T12:00:12Z"
      },
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-04-22T14:42:37Z"
      },
      "sha": "70bbc62711643ec57cce620f9f7a0e1fe5fb6346"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjZTAyZGQxZWYxZjdmNTRmMzM3ODBiMzJmMTk1ZDMxYzFjYzg3MzE4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ce02dd1ef1f7f54f33780b32f195d31c1cc87318",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/ce02dd1ef1f7f54f33780b32f195d31c1cc87318",
      "tree": {
        "sha": "45d2262216da1f6858f993ba06d68740483f1b40",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/45d2262216da1f6858f993ba06d68740483f1b40"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 45d2262216da1f6858f993ba06d68740483f1b40\nparent 70bbc62711643ec57cce620f9f7a0e1fe5fb6346\nauthor Jon Atack <jon@atack.com> 1618063863 +0200\ncommitter Jon Atack <jon@atack.com> 1623672095 +0200\n\np2p: extend inbound eviction protection by network to I2P peers\n\nThis commit extends our inbound eviction protection to I2P peers to\nfavorise the diversity of peer connections, as peers connected\nthrough the I2P network are otherwise disadvantaged by our eviction\ncriteria for their higher latency (higher min ping times) relative\nto IPv4 and IPv6 peers, as well as relative to Tor onion peers.\n\nThe `networks` array is order-dependent in the case of a tie in\ncandidate counts between networks (earlier array members receive\npriority in the case of a tie).\n\nTherefore, we place I2P candidates before localhost and onion ones\nin terms of opportunity to recover unused remaining protected slots\nfrom the previous iteration, guesstimating that most nodes allowing\nboth onion and I2P inbounds will have more onion peers, followed by\nlocalhost, then I2P, as I2P support is only being added in the\nupcoming v22.0 release.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmDHRSYACgkQT1chs9Dj\nkh2DFBAAkflN1TUnuoAY/saX7XM03pCtb132KjWqkUa3Q8tyVy6vI72Ei3Uf8Bsw\nsmkFwGo+S3V206Bw3tp0UajFZdpCJi1YYSlExZL8WgUHN6t3LQ6mgSITyTrXMe20\nAxifd9OL72uKXiauIcUM1mRp7+km/YaBhNVJxhuapkbAQ6ELzz1i4SrSIAfQ2f1B\nCA/44brKAkKNV44/opIha7BJz6zs6lF5KlWG36qq9wJuzdSt0M2v0XGucHnOBcrY\nPShcDM0ljtaIuGJGL6gF9rmEy0Ne8WZld1YjgSabd3Ri7IYty4+aSGG1GoTWcHwT\ntXGBw25inrm90EdAKsYjvcL1bXrKJXXEREplw2aDbNMt9MhQYckIwQE+quN4TnDa\nMihX3lLwL2U+/rMkQl5kTI3anQe0OomsGu87Zv4mEqZJ0VNN2P7kDPRuVDp3snE1\nPjZIPdQEXY5iUAwk8VAQ+rHAKZxqV7DlbXzgZNrrZwA1XezPN9m5T2b3yTuCZjyF\nlQA99yr5agUBUDMKlskgmbL8RTE3LixKXGCODssfhWUixyi/cOf/0GweBk1rqyYX\n9Ii7Z5adF5mBlP3cDzjAidCKVVLi/2SPu9F8p82AojrLAbBysqaK7gsVPmVqiSHw\nZEoU8et9aOMV+9hpd+/FcIpl2B50hjMZALreTDP5etOFyQ+D8Fs=\n=LECq\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwIAdkQ+qwLfWIWrid9KguVCW7z7f0PtNsl61XK0yqtKS9CP/wEAiwZu5k5fU6\noWnvLdUUMmYI8CASrFcryXOfVcDbVXYb6LwLWIElunkfeQnWJlGwKJZarAjwIESg\nsxyiAnVcZduGaRu79/seoxBVreF5govEOKu3IDtSCPEEYMdFKPAIj7UpwylQv5IA\ng9/jDS75DI4sK2h0dHBzOi8vYm9iLmJ0Yy5jYWxlbmRhci5vcGVudGltZXN0YW1w\ncy5vcmf/8BBGT5zxXg0kIZYkrDU50X52CPEgmHodIEX537E0MTxRvQXzwEtOMRD0\nwuoiXcOj6RNVJcEI8CDE2JW7EiViMG+xMDBQjKC4IChBBRNI/pVEBOexGGZJlwjx\nBGDHRSfwCNbPpfBrvbMOAIPf4w0u+QyOIyJodHRwczovL2J0Yy5jYWxlbmRhci5j\nYXRhbGxheHkuY29t//AQkHa08kmXqmdFoD7uU49ZhgjwIPfxc75MPPtwylzb8CpJ\n02f4UEjQnITyJEP7hlNi+ID7CPEg9uHjfUUUYfx9avsXl4tehfuz8NnYc2MTOLLw\nWJR7GZQI8CC9ApIHBeD9Q909b0WtTJtlTWAERitkN+q37Ov7TjCTvgjxBGDHRSfw\nCCGsneHAcMowAIPf4w0u+QyOKShodHRwczovL2Zpbm5leS5jYWxlbmRhci5ldGVy\nbml0eXdhbGwuY29t8BD+lP6NifaV3N8Pb2rYc3SkCPEglKixyLm1HI9UI7lcJPW/\nr8gGpgnryRkckVDrydIcZOEI8SBJ47R6/OsXG2QDdiUD4qLToRBgEu6BZsTf9WyH\nZKCrnQjxBGDHRSjwCNZnkQ1/iObhAIPf4w0u+QyOLi1odHRwczovL2FsaWNlLmJ0\nYy5jYWxlbmRhci5vcGVudGltZXN0YW1wcy5vcmc=\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/70bbc62711643ec57cce620f9f7a0e1fe5fb6346",
          "sha": "70bbc62711643ec57cce620f9f7a0e1fe5fb6346",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/70bbc62711643ec57cce620f9f7a0e1fe5fb6346"
        }
      ],
      "message": "p2p: extend inbound eviction protection by network to I2P peers\n\nThis commit extends our inbound eviction protection to I2P peers to\nfavorise the diversity of peer connections, as peers connected\nthrough the I2P network are otherwise disadvantaged by our eviction\ncriteria for their higher latency (higher min ping times) relative\nto IPv4 and IPv6 peers, as well as relative to Tor onion peers.\n\nThe `networks` array is order-dependent in the case of a tie in\ncandidate counts between networks (earlier array members receive\npriority in the case of a tie).\n\nTherefore, we place I2P candidates before localhost and onion ones\nin terms of opportunity to recover unused remaining protected slots\nfrom the previous iteration, guesstimating that most nodes allowing\nboth onion and I2P inbounds will have more onion peers, followed by\nlocalhost, then I2P, as I2P support is only being added in the\nupcoming v22.0 release.",
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-06-14T12:01:35Z"
      },
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-04-10T14:11:03Z"
      },
      "sha": "ce02dd1ef1f7f54f33780b32f195d31c1cc87318"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3YzIyODRlZGEyMmEwOGRiZjJhNTYwODk0ZTQ5NmUyNDVkMDI2ZWUw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7c2284eda22a08dbf2a560894e496e245d026ee0",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/7c2284eda22a08dbf2a560894e496e245d026ee0",
      "tree": {
        "sha": "b1b5cb245617bbb1866e96271d279b7a93965769",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b1b5cb245617bbb1866e96271d279b7a93965769"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree b1b5cb245617bbb1866e96271d279b7a93965769\nparent ce02dd1ef1f7f54f33780b32f195d31c1cc87318\nauthor Jon Atack <jon@atack.com> 1619102781 +0200\ncommitter Jon Atack <jon@atack.com> 1623672104 +0200\n\ntest: add tests for inbound eviction protection of I2P peers\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmDHRSgACgkQT1chs9Dj\nkh3CCRAAgo6adQ1mFRgowYt2ePi4tItMUdjvdP1r1ewO4MpMXIkBHFPcs3PVYX0f\nesQA9NjPZsOjfbAglKfygMduVYbtbbTpC+Kno7u8OaurvepHvoCWFzihCrKb9CtG\neGSuxiy2XWZTkw8vbZhhn/gkM9G2ynaSLbaiOMkkBbk+NtWM00UtoEbZ5kkMcd2h\nYl6K7P6Ey2CKyR4fQQQCwBb4qK4rTaza1eEPnXhRREaCDlNhYYVDXNKBl56/87m8\nBZosaIaWni+t6fbtlUqfpbKtwZo/GK7n7HcfrVlpQNIH4J2bYTArHa3lpIIUAIGX\nR1lat8oSL1rtDeeDsZjhqkAJHxRYpQwgU7grZMTodIK9rd1VB2M08q9ohqCfWxGz\nLS0M5FTieT+xWIjlLks7QT5XEgrpEAXGqSxN8nix6A7FMEKJZm2srdSzhFPCQEqk\nmE6F3iVw6oN3awrSlBqTUUwJbT1ngRcIExvEoQnjUnTKt1OUbZRHpMC1oMXmq/US\nNiNzb102JptFE0UdXO7Z5QYyMQr7jz4L/lWTtzilhlQ4edNcE+36eOlWrJqvN2mX\nfEJgPwvkeMxoV5lw+DEoDTdJZQ94qtz2ayk2ArUjT0thFlM6Pt36xEMkNmhuV2gb\n6J+Aeb8AF/J4tUta5C7sjDnTIPZChij9cqLfREDcVF4HCbxSitw=\n=kghF\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwIFe4cEIYJ8tsQlb+M2wNjYYAKEE8SzBfGSsNrEd/B8s5CP/wEJIwln9opgK1\nMDVTVbS1VBwI8QRgx0Up8Ajw8/oBfzW+yQCD3+MNLvkMjiMiaHR0cHM6Ly9idGMu\nY2FsZW5kYXIuY2F0YWxsYXh5LmNvbf/wENjj08CHjpFJ08U0IP32/DUI8SA4CBhD\nL0Fac2B4IWoi8ISPCDA+zhEO4rAmsfdZ9EHa1QjxBGDHRSnwCINlURpACHVkAIPf\n4w0u+QyOKShodHRwczovL2Zpbm5leS5jYWxlbmRhci5ldGVybml0eXdhbGwuY29t\n//AQ68/QCNdXIGXvx6chW5SoSQjxIEBxA6/sbVKSxH4Ay8jhx5IoQzfnDJV5LPLG\nHPfKruNDCPEEYMdFKvAIZ5R2UsCWYIMAg9/jDS75DI4uLWh0dHBzOi8vYWxpY2Uu\nYnRjLmNhbGVuZGFyLm9wZW50aW1lc3RhbXBzLm9yZ/AQ+oZsXnx8mrrpOQyC2RcP\npQjxBGDHRSrwCL7DKMyf2B5bAIPf4w0u+QyOLCtodHRwczovL2JvYi5idGMuY2Fs\nZW5kYXIub3BlbnRpbWVzdGFtcHMub3Jn\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ce02dd1ef1f7f54f33780b32f195d31c1cc87318",
          "sha": "ce02dd1ef1f7f54f33780b32f195d31c1cc87318",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/ce02dd1ef1f7f54f33780b32f195d31c1cc87318"
        }
      ],
      "message": "test: add tests for inbound eviction protection of I2P peers",
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-06-14T12:01:44Z"
      },
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-04-22T14:46:21Z"
      },
      "sha": "7c2284eda22a08dbf2a560894e496e245d026ee0"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxYjEwODhkNTJmYmZmOGIxYzk0MzhkNmFhOGM2ZWRjYmRkNDcxNDU3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "tree": {
        "sha": "ea7ef602879b81956072189f0c955af009c6b150",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ea7ef602879b81956072189f0c955af009c6b150"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree ea7ef602879b81956072189f0c955af009c6b150\nparent 7c2284eda22a08dbf2a560894e496e245d026ee0\nauthor Jon Atack <jon@atack.com> 1619112097 +0200\ncommitter Jon Atack <jon@atack.com> 1623672135 +0200\n\ntest: add combined I2P/onion/localhost eviction protection tests\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmDHRUcACgkQT1chs9Dj\nkh1Zkw//XsaQS4e86yOp+PqWu52SUlmu6u69F6LCH2qyT9yWo4zBIsBIVy7BXkvG\nzNVKwachcX+gbpYXxxUFIufEV5gH1o3BfHO4vNTqKXz28J2J1M36gcxjVdvHTmKt\nJUH8NGZ6I33oZ8Sxe577rQXppoavrRAe+GfIJDIohUMtCB9juX8Jsqql1fViqq0q\nrdMxXBNdkQSAi7bqaiDCn8SpywwtQaW6Lp9L7EUlkp3K3CLd2SM7GWI+MnDDn1Zm\nRZa6dsBP0yFpZhzeK0oOILOlx8a8Gw7Lzp30lnNo+XIDUm18vHTjbQCWLH3qhAEz\nrqJRbuehAXOAAYS13cqvDdqlSpNq0nijcoVsGx6CvFto2skf9DsC7c/Zr7jdbpqt\nVGEhbkLwI5S+lQRv/SDUC4j2bPl52fcftCGiA+oxbmlBG3ZZ1DSBeqYdjh2rR6Kd\nZpqpBzVwb2HKCb2K7CH8hy1Q3tXvt5kiyO9bjtdSu6d6ZJxAkroHuhQZyGvXij1N\nBsKkkOlaBw/cso3qGyxoEHW7llEK3NSbPB+xxhlMtFPD5LDUqLqcu/7Dmz7RUp6g\nAvTF01mibKyLgXkkQgsN53HBe9Jt87CDNCRAD49rb9PoRGFQ9V8WE5BzF0W8/7v9\n/F8+/F27/Fra6axPUcTlg1q6jq3PYmc2DhSavmXrImyIaYBg9oY=\n=hcg6\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwIPPQFYMWKLTym4emKVCzc5tuXYQC322dOAVIElfU+1cmCP/wELt0YY2jQbKi\n/y4xGg6ykKcI8SAK5KCCUIn9ZWXmr/pue4kNpnIVJCTkPBselDsMLafJGgjxBGDH\nRUnwCOL96/jsjvtDAIPf4w0u+QyOKShodHRwczovL2Zpbm5leS5jYWxlbmRhci5l\ndGVybml0eXdhbGwuY29t//AQ46elDl85soifF0UJ4y2UDwjwIHO0ayMOM+DTZCPn\nefWNMgCXuw/yqXCj2+a2yJ1oIco/CPAgE+SEDBJZqbfXkoP4KAyPxlefCaHTNdsW\noZhNR6hJCOQI8QRgx0VJ8AjapmFsKybYOACD3+MNLvkMji4taHR0cHM6Ly9hbGlj\nZS5idGMuY2FsZW5kYXIub3BlbnRpbWVzdGFtcHMub3Jn//AQ5LFtap8YpepztEDi\nJlswNQjxIF8M4tFZRYcbAaxavGbAEeeWcwtV+9K0OdmN1QR6vq5qCPEEYMdFSfAI\ny2gHXDbS+tkAg9/jDS75DI4jImh0dHBzOi8vYnRjLmNhbGVuZGFyLmNhdGFsbGF4\neS5jb23wEOtKzslW4gjWUYSeq7LyWpMI8SDfjAy/C9culU7I/GbGh5RIa2ofrw10\nfkXAT5wRDiG5DwjwIBfyhpp8PymhOcOssrVIrA865Pm4IxiqCbC9r3H1AkPZCPEE\nYMdFSfAIJeecdavxifMAg9/jDS75DI4sK2h0dHBzOi8vYm9iLmJ0Yy5jYWxlbmRh\nci5vcGVudGltZXN0YW1wcy5vcmc=\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7c2284eda22a08dbf2a560894e496e245d026ee0",
          "sha": "7c2284eda22a08dbf2a560894e496e245d026ee0",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/7c2284eda22a08dbf2a560894e496e245d026ee0"
        }
      ],
      "message": "test: add combined I2P/onion/localhost eviction protection tests",
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-06-14T12:02:15Z"
      },
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-04-22T17:21:37Z"
      },
      "sha": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4885282917,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDg4NTI4MjkxNw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4885282917",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-14T12:13:25Z"
    },
    {
      "event": "commented",
      "id": 860648064,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg2MDY0ODA2NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/860648064",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-14T12:33:53Z",
      "updated_at": "2021-06-14T12:34:21Z",
      "author_association": "MEMBER",
      "body": "Thanks @vasild and @laanwj.  Updated per `git diff a457f34 1b1088d --color-words` for the review suggestion and to add 4 test cases, and updated the PR description to thank/credit @vasild and @ariard.",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#issuecomment-860648064",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21261"
    },
    {
      "event": "mentioned",
      "id": 4885382187,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDg4NTM4MjE4Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4885382187",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-14T12:33:54Z"
    },
    {
      "event": "subscribed",
      "id": 4885382190,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ4ODUzODIxOTA=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4885382190",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-14T12:33:54Z"
    },
    {
      "event": "mentioned",
      "id": 4885382199,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDg4NTM4MjE5OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4885382199",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-14T12:33:54Z"
    },
    {
      "event": "subscribed",
      "id": 4885382201,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ4ODUzODIyMDE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4885382201",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-14T12:33:54Z"
    },
    {
      "event": "mentioned",
      "id": 4885382203,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDg4NTM4MjIwMw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4885382203",
      "actor": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-14T12:33:54Z"
    },
    {
      "event": "subscribed",
      "id": 4885382210,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ4ODUzODIyMTA=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4885382210",
      "actor": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-14T12:33:54Z"
    },
    {
      "event": "reviewed",
      "id": 682882695,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjgyODgyNjk1",
      "url": null,
      "actor": null,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK 1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#pullrequestreview-682882695",
      "submitted_at": "2021-06-14T13:02:45Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
    },
    {
      "event": "merged",
      "id": 4885547115,
      "node_id": "MDExOk1lcmdlZEV2ZW50NDg4NTU0NzExNQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4885547115",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "5c4f0c4d46f030498c222a15a0399c6e0a7d28f1",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5c4f0c4d46f030498c222a15a0399c6e0a7d28f1",
      "created_at": "2021-06-14T13:05:18Z"
    },
    {
      "event": "closed",
      "id": 4885547144,
      "node_id": "MDExOkNsb3NlZEV2ZW50NDg4NTU0NzE0NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4885547144",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-14T13:05:19Z"
    },
    {
      "event": "removed_from_project",
      "id": 4885551647,
      "node_id": "MDIzOlJlbW92ZWRGcm9tUHJvamVjdEV2ZW50NDg4NTU1MTY0Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4885551647",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-14T13:06:04Z",
      "project_card": {
        "id": 59645595,
        "url": "https://api.github.com/projects/columns/cards/59645595",
        "project_id": 481835,
        "project_url": "https://api.github.com/projects/481835",
        "column_name": "Blockers"
      }
    },
    {
      "event": "head_ref_deleted",
      "id": 4885613765,
      "node_id": "MDE5OkhlYWRSZWZEZWxldGVkRXZlbnQ0ODg1NjEzNzY1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4885613765",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-14T13:16:53Z"
    },
    {
      "event": "commented",
      "id": 860681508,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg2MDY4MTUwOA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/860681508",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-14T13:23:32Z",
      "updated_at": "2021-06-14T13:23:32Z",
      "author_association": "MEMBER",
      "body": "> Wow! How long does it take to get up to 200 peers? Mine is restarted a lot but never gets above 35-40.\r\n\r\nLast restart was last week, it gets connections quite quickly. Then again it is connected to all possible networks and has had a >99% uptime for a few years. Either that helps or maybe it's just all spy nodes :slightly_smiling_face: \r\n",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#issuecomment-860681508",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21261"
    },
    {
      "event": "referenced",
      "id": 4885879681,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDQ4ODU4Nzk2ODE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4885879681",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "b9e1e110ed5d58acb273bd44b33f2523305ef1ff",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/b9e1e110ed5d58acb273bd44b33f2523305ef1ff",
      "created_at": "2021-06-14T14:01:49Z"
    },
    {
      "event": "referenced",
      "id": 5025220933,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDUwMjUyMjA5MzM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5025220933",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "21998bc028d6d72229ae826d2dd9d78981367952",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/21998bc028d6d72229ae826d2dd9d78981367952",
      "created_at": "2021-07-15T12:50:04Z"
    },
    {
      "event": "referenced",
      "id": 6090579058,
      "node_id": "REFE_lADOABII584wdVOuzwAAAAFrBtxy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6090579058",
      "actor": {
        "login": "Fabcien",
        "id": 44533924,
        "node_id": "MDQ6VXNlcjQ0NTMzOTI0",
        "avatar_url": "https://avatars.githubusercontent.com/u/44533924?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Fabcien",
        "html_url": "https://github.com/Fabcien",
        "followers_url": "https://api.github.com/users/Fabcien/followers",
        "following_url": "https://api.github.com/users/Fabcien/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Fabcien/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Fabcien/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Fabcien/subscriptions",
        "organizations_url": "https://api.github.com/users/Fabcien/orgs",
        "repos_url": "https://api.github.com/users/Fabcien/repos",
        "events_url": "https://api.github.com/users/Fabcien/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Fabcien/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "990ce4d9f44afef5c90152e272e2598addd4c87a",
      "commit_url": "https://api.github.com/repos/Bitcoin-ABC/bitcoin-abc/commits/990ce4d9f44afef5c90152e272e2598addd4c87a",
      "created_at": "2022-02-17T14:06:00Z"
    },
    {
      "event": "referenced",
      "id": 6169962372,
      "node_id": "REFE_lADOABII584wdVOuzwAAAAFvwieE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6169962372",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "8b6cd42c6226dea28c182a48a214d1c091b9b5bb",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8b6cd42c6226dea28c182a48a214d1c091b9b5bb",
      "created_at": "2022-03-02T11:01:10Z"
    },
    {
      "event": "referenced",
      "id": 6723198629,
      "node_id": "REFE_lADOABII584wdVOuzwAAAAGQu96l",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6723198629",
      "actor": {
        "login": "gwillen",
        "id": 458997,
        "node_id": "MDQ6VXNlcjQ1ODk5Nw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/458997?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gwillen",
        "html_url": "https://github.com/gwillen",
        "followers_url": "https://api.github.com/users/gwillen/followers",
        "following_url": "https://api.github.com/users/gwillen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gwillen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gwillen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gwillen/subscriptions",
        "organizations_url": "https://api.github.com/users/gwillen/orgs",
        "repos_url": "https://api.github.com/users/gwillen/repos",
        "events_url": "https://api.github.com/users/gwillen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gwillen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "dc6f5685847e0e20f95f085fd7f3dc98fcde9aa6",
      "commit_url": "https://api.github.com/repos/ElementsProject/elements/commits/dc6f5685847e0e20f95f085fd7f3dc98fcde9aa6",
      "created_at": "2022-06-01T21:22:33Z"
    },
    {
      "event": "locked",
      "id": 7199146759,
      "node_id": "LOE_lADOABII584wdVOuzwAAAAGtGkMH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7199146759",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-16T17:24:15Z",
      "lock_reason": "resolved"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625210280",
      "pull_request_review_id": 650516145,
      "id": 625210280,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTIxMDI4MA==",
      "diff_hunk": "@@ -896,36 +902,64 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvict\n {\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n     const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n+    const size_t total_protect_size{initial_size / 2};\n \n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n+    // Count number of nodes connected via localhost, I2P, and onion.\n+    // Higher positions in the array recover unused slots left by lower ones.\n+    std::array<size_t, 3> network_counts{{}};\n+    for (const NodeEvictionCandidate& node : vEvictionCandidates) {\n+        if (node.m_is_local) {\n+            ++network_counts[0];\n+        } else if (node.m_is_i2p) {\n+            ++network_counts[1];\n+        } else if (node.m_is_onion) {\n+            ++network_counts[2];\n+        }\n     }\n \n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n-    }\n+    // Find the number of networks from which we have disadvantaged candidates.\n+    const auto networks = std::count_if(network_counts.begin(), network_counts.end(), [](auto n) { return n; });\n+\n+    if (networks) {\n+        // Obtain the minimum number of peers per network to potentially protect.\n+        // The base ratio is 1/2 (for the case of peers from only 1 network).\n+        const size_t protect_size_per_network{total_protect_size / (2 * networks)};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 64,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "831b3294d92b23f85617e77ea3f90082de73ce3a",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Before this PR we would have protected 25% onions. With this PR up to commit 517976187 (inclusive) we would protect 12.5% onions and with the full PR - just 8.3%. What about:\r\n\r\n```suggestion\r\n        const size_t protect_size_per_network{total_protect_size / networks};\r\n```",
      "created_at": "2021-05-03T16:33:42Z",
      "updated_at": "2021-05-08T15:13:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r625210280",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625210280"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 931,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625212333",
      "pull_request_review_id": 650516145,
      "id": 625212333,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTIxMjMzMw==",
      "diff_hunk": "@@ -896,36 +902,64 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvict\n {\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n     const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n+    const size_t total_protect_size{initial_size / 2};\n \n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n+    // Count number of nodes connected via localhost, I2P, and onion.\n+    // Higher positions in the array recover unused slots left by lower ones.\n+    std::array<size_t, 3> network_counts{{}};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 36,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "831b3294d92b23f85617e77ea3f90082de73ce3a",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "These are used as booleans. I would suggest something like:\r\n\r\n```cpp\r\nstruct {\r\n    bool local{false};\r\n    bool i2p{false};\r\n    bool onion{false};\r\n} networks;\r\n...\r\nif (node.m_is_local) {\r\n    networks.local = true;\r\n}\r\n\r\n// if (networks) becomes:\r\nif (networks.local || networks.i2p || networks.onion)\r\n```",
      "created_at": "2021-05-03T16:37:09Z",
      "updated_at": "2021-05-08T15:13:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r625212333",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625212333"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 914,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625223765",
      "pull_request_review_id": 650516145,
      "id": 625223765,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTIyMzc2NQ==",
      "diff_hunk": "@@ -1022,7 +1055,7 @@ bool CConnman::AttemptToEvictConnection()\n                                                HasAllDesirableServiceFlags(node->nServices),\n                                                peer_relay_txes, peer_filter_not_null, node->nKeyedNetGroup,\n                                                node->m_prefer_evict, node->addr.IsLocal(),\n-                                               node->m_inbound_onion};\n+                                               node->m_inbound_onion, node->addr.IsI2P()};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 116,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "831b3294d92b23f85617e77ea3f90082de73ce3a",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Passing multiple booleans like `is_onion`, `is_i2p`, etc is a bit un-flexible and leaves the possibility for contradictions like having both flags set to true. Fuzzing could do that and I expect that there may be (or may be added) some legit assert somewhere in the code to ensure that nonsensical values like `is_onion==true` and `is_i2p==true` are not passed (resulting in an assertion failure during fuzzing).\r\n\r\nWhat about passing `enum Network` instead?",
      "created_at": "2021-05-03T16:55:49Z",
      "updated_at": "2021-05-08T15:13:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r625223765",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/625223765"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1058,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/626485716",
      "pull_request_review_id": 652197438,
      "id": 626485716,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNjQ4NTcxNg==",
      "diff_hunk": "@@ -896,36 +902,64 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvict\n {\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n     const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n+    const size_t total_protect_size{initial_size / 2};\n \n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n+    // Count number of nodes connected via localhost, I2P, and onion.\n+    // Higher positions in the array recover unused slots left by lower ones.\n+    std::array<size_t, 3> network_counts{{}};\n+    for (const NodeEvictionCandidate& node : vEvictionCandidates) {\n+        if (node.m_is_local) {\n+            ++network_counts[0];\n+        } else if (node.m_is_i2p) {\n+            ++network_counts[1];\n+        } else if (node.m_is_onion) {\n+            ++network_counts[2];\n+        }\n     }\n \n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n-    }\n+    // Find the number of networks from which we have disadvantaged candidates.\n+    const auto networks = std::count_if(network_counts.begin(), network_counts.end(), [](auto n) { return n; });\n+\n+    if (networks) {\n+        // Obtain the minimum number of peers per network to potentially protect.\n+        // The base ratio is 1/2 (for the case of peers from only 1 network).\n+        const size_t protect_size_per_network{total_protect_size / (2 * networks)};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 64,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "831b3294d92b23f85617e77ea3f90082de73ce3a",
      "in_reply_to_id": 625210280,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Those are initial (not necessarily final) percentages iff onion, i2p and localhost peers are all present in the eviction candidates. For instance, if no i2p or localhost peers are among the candidats, then the full 25% is made available to onions. And if localhost or i2p peers are present, any initially reserved slots that they don't use are made available for onions. (See the commit messages for a more detailed description). I'm not against adjusting the ratios though.",
      "created_at": "2021-05-05T11:32:02Z",
      "updated_at": "2021-05-08T15:13:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r626485716",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/626485716"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 931,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/626495780",
      "pull_request_review_id": 652210679,
      "id": 626495780,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNjQ5NTc4MA==",
      "diff_hunk": "@@ -896,36 +902,64 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvict\n {\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n     const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n+    const size_t total_protect_size{initial_size / 2};\n \n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n+    // Count number of nodes connected via localhost, I2P, and onion.\n+    // Higher positions in the array recover unused slots left by lower ones.\n+    std::array<size_t, 3> network_counts{{}};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 36,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "831b3294d92b23f85617e77ea3f90082de73ce3a",
      "in_reply_to_id": 625212333,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It's used to determine the number of networks from which we have disadvantaged candidates (indeed that could be done with bools also, replacing count_if with a sum of each boolean) but I anticipate possibly also using the actual counts to determine the distribution size or order of the protected slots.",
      "created_at": "2021-05-05T11:49:35Z",
      "updated_at": "2021-05-08T15:13:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r626495780",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/626495780"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 914,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/627764474",
      "pull_request_review_id": 653895708,
      "id": 627764474,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNzc2NDQ3NA==",
      "diff_hunk": "@@ -1022,7 +1055,7 @@ bool CConnman::AttemptToEvictConnection()\n                                                HasAllDesirableServiceFlags(node->nServices),\n                                                peer_relay_txes, peer_filter_not_null, node->nKeyedNetGroup,\n                                                node->m_prefer_evict, node->addr.IsLocal(),\n-                                               node->m_inbound_onion};\n+                                               node->m_inbound_onion, node->addr.IsI2P()};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 116,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "831b3294d92b23f85617e77ea3f90082de73ce3a",
      "in_reply_to_id": 625223765,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Passing `enum Network`, instead of multiple booleans, indeed allowed rewriting this to be better abstracted and generalizable. WIP, for now the initial rewrite is in an additional commit.",
      "created_at": "2021-05-06T21:05:47Z",
      "updated_at": "2021-05-08T15:13:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r627764474",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/627764474"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1058,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/633484515",
      "pull_request_review_id": 660903857,
      "id": 633484515,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMzQ4NDUxNQ==",
      "diff_hunk": "@@ -896,36 +902,64 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvict\n {\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n     const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n+    const size_t total_protect_size{initial_size / 2};\n \n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n+    // Count number of nodes connected via localhost, I2P, and onion.\n+    // Higher positions in the array recover unused slots left by lower ones.\n+    std::array<size_t, 3> network_counts{{}};\n+    for (const NodeEvictionCandidate& node : vEvictionCandidates) {\n+        if (node.m_is_local) {\n+            ++network_counts[0];\n+        } else if (node.m_is_i2p) {\n+            ++network_counts[1];\n+        } else if (node.m_is_onion) {\n+            ++network_counts[2];\n+        }\n     }\n \n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n-    }\n+    // Find the number of networks from which we have disadvantaged candidates.\n+    const auto networks = std::count_if(network_counts.begin(), network_counts.end(), [](auto n) { return n; });\n+\n+    if (networks) {\n+        // Obtain the minimum number of peers per network to potentially protect.\n+        // The base ratio is 1/2 (for the case of peers from only 1 network).\n+        const size_t protect_size_per_network{total_protect_size / (2 * networks)};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 64,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "831b3294d92b23f85617e77ea3f90082de73ce3a",
      "in_reply_to_id": 625210280,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I played around with a more generous version that would protect more than 1/4 in the case of eviction candidates from multiple disadvantaged networks.  Didn't keep it for now, but memoizing the commit: e5c27dd.",
      "created_at": "2021-05-17T12:26:00Z",
      "updated_at": "2021-05-17T12:26:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r633484515",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/633484515"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 931,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640068051",
      "pull_request_review_id": 669469370,
      "id": 640068051,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDA2ODA1MQ==",
      "diff_hunk": "@@ -902,26 +902,44 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvict\n     // disadvantaged under our eviction criteria.\n     const size_t initial_size = vEvictionCandidates.size();\n     size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n \n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n+    // Count number of nodes connected via localhost and onion.\n+    // Higher positions in the array recover unused slots left by lower ones.\n+    std::array<size_t, 2> network_counts{{}};\n+    for (const NodeEvictionCandidate& node : vEvictionCandidates) {\n+        if (node.m_is_local) {\n+            ++network_counts[0];\n+        } else if (node.m_is_onion) {\n+            ++network_counts[1];\n+        }\n     }\n \n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n-    }\n+    // Find the number of networks from which we have disadvantaged candidates.\n+    const auto networks = std::count_if(network_counts.begin(), network_counts.end(), [](auto n) { return n; });\n+\n+    if (networks) {\n+        // Obtain the minimum number of peers per network to potentially protect.\n+        // The base ratio is 1/2 (for the case of peers from only 1 network).\n+        const size_t protect_size_per_network{total_protect_size / (2 * networks)};\n \n+        if (protect_size_per_network) {\n+            size_t total_to_protect{protect_size_per_network};\n+\n+            if (network_counts[0]) {\n+                // Protect localhost peers, sorted by longest uptime.\n+                EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, total_to_protect,\n+                                   [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+                total_to_protect += protect_size_per_network;\n+            }\n+\n+            if (network_counts[1]) {\n+                // Protect onion peers (connected via our onion service), sorted by longest uptime.\n+                const size_t onion_peers_to_protect{total_to_protect - (initial_size - vEvictionCandidates.size())};\n+                EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_peers_to_protect,",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 53,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "161aed5142048bb5c681628eb3d25d574cfbba47",
      "in_reply_to_id": null,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Why you don't pass `k=protect_size_per_network` to `EraseLastKElements` ?\r\n\r\nLet's say initial_size=200, total_protect_size=100.\r\nIf you count two networks, protected_size_per_network=25.\r\n\r\nIf the first network does exist, vEvictionCandidates is reduced to 175, total_to_protect increased to 50\r\nAnd the second network does exist, 50 - 200 - 175, k is equal to 25\r\n\r\nIf the first network doesn't exist, vEvictionCandidates isn't reduced, total_to_protect is equal to 25\r\nAnd the second network does exist, 25 - 200 - 200, k is equal to 25\r\n\r\nLet me know if I get the math wrong, or the logic is altered in following commits (after 5179761)\r\n\r\nAlso, `total_to_protect`, `protect_size_per_network` are confusing. Maybe rename `total_to_protect` to `already_selected_for_protect_size` ?",
      "created_at": "2021-05-26T19:39:20Z",
      "updated_at": "2021-05-26T20:28:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r640068051",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640068051"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 938,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640096971",
      "pull_request_review_id": 669469370,
      "id": 640096971,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDA5Njk3MQ==",
      "diff_hunk": "@@ -851,6 +851,12 @@ static bool CompareOnionTimeConnected(const NodeEvictionCandidate& a, const Node\n     return a.nTimeConnected > b.nTimeConnected;\n }\n \n+static bool CompareI2PTimeConnected(const NodeEvictionCandidate& a, const NodeEvictionCandidate& b)\n+{\n+    if (a.m_is_i2p != b.m_is_i2p) return b.m_is_i2p;\n+    return a.nTimeConnected > b.nTimeConnected;\n+}\n+",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 9,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "2aaeeff3e8f6c24c9ac0eebf6fbcf9e409a3a141",
      "in_reply_to_id": null,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "What would be the purpose of the follow-up you're envisioning ?\r\n\r\nAFAIU this current patchset, any unused protected slots across a high-latency network is reallocated to the next one by summing up `protect_size_per_network` and passing through `total_to_protect` ?",
      "created_at": "2021-05-26T20:26:18Z",
      "updated_at": "2021-05-26T20:28:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r640096971",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/640096971"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 859,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/644332628",
      "pull_request_review_id": 674697946,
      "id": 644332628,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NDMzMjYyOA==",
      "diff_hunk": "@@ -851,6 +851,12 @@ static bool CompareOnionTimeConnected(const NodeEvictionCandidate& a, const Node\n     return a.nTimeConnected > b.nTimeConnected;\n }\n \n+static bool CompareI2PTimeConnected(const NodeEvictionCandidate& a, const NodeEvictionCandidate& b)\n+{\n+    if (a.m_is_i2p != b.m_is_i2p) return b.m_is_i2p;\n+    return a.nTimeConnected > b.nTimeConnected;\n+}\n+",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 9,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "2aaeeff3e8f6c24c9ac0eebf6fbcf9e409a3a141",
      "in_reply_to_id": 640096971,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "You're right. The commit message was out of date. Updated.",
      "created_at": "2021-06-02T21:28:23Z",
      "updated_at": "2021-06-02T21:28:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r644332628",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/644332628"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 859,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/644337039",
      "pull_request_review_id": 674703478,
      "id": 644337039,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NDMzNzAzOQ==",
      "diff_hunk": "@@ -902,26 +902,44 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvict\n     // disadvantaged under our eviction criteria.\n     const size_t initial_size = vEvictionCandidates.size();\n     size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n \n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n+    // Count number of nodes connected via localhost and onion.\n+    // Higher positions in the array recover unused slots left by lower ones.\n+    std::array<size_t, 2> network_counts{{}};\n+    for (const NodeEvictionCandidate& node : vEvictionCandidates) {\n+        if (node.m_is_local) {\n+            ++network_counts[0];\n+        } else if (node.m_is_onion) {\n+            ++network_counts[1];\n+        }\n     }\n \n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n-    }\n+    // Find the number of networks from which we have disadvantaged candidates.\n+    const auto networks = std::count_if(network_counts.begin(), network_counts.end(), [](auto n) { return n; });\n+\n+    if (networks) {\n+        // Obtain the minimum number of peers per network to potentially protect.\n+        // The base ratio is 1/2 (for the case of peers from only 1 network).\n+        const size_t protect_size_per_network{total_protect_size / (2 * networks)};\n \n+        if (protect_size_per_network) {\n+            size_t total_to_protect{protect_size_per_network};\n+\n+            if (network_counts[0]) {\n+                // Protect localhost peers, sorted by longest uptime.\n+                EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, total_to_protect,\n+                                   [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+                total_to_protect += protect_size_per_network;\n+            }\n+\n+            if (network_counts[1]) {\n+                // Protect onion peers (connected via our onion service), sorted by longest uptime.\n+                const size_t onion_peers_to_protect{total_to_protect - (initial_size - vEvictionCandidates.size())};\n+                EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_peers_to_protect,",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 53,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "161aed5142048bb5c681628eb3d25d574cfbba47",
      "in_reply_to_id": 640068051,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Since the inital number of protected slots per network goes down quickly as the number of networks increases, it seems good to not waste any unused slots in this basic greedy knapsack. So we calculate `peers_to_protect` for each iteration having potential peers to protect, in order to recover any unused slots from the previous iteration.",
      "created_at": "2021-06-02T21:36:35Z",
      "updated_at": "2021-06-02T21:36:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r644337039",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/644337039"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 938,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/644338502",
      "pull_request_review_id": 674705350,
      "id": 644338502,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NDMzODUwMg==",
      "diff_hunk": "@@ -902,26 +902,44 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvict\n     // disadvantaged under our eviction criteria.\n     const size_t initial_size = vEvictionCandidates.size();\n     size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n \n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n+    // Count number of nodes connected via localhost and onion.\n+    // Higher positions in the array recover unused slots left by lower ones.\n+    std::array<size_t, 2> network_counts{{}};\n+    for (const NodeEvictionCandidate& node : vEvictionCandidates) {\n+        if (node.m_is_local) {\n+            ++network_counts[0];\n+        } else if (node.m_is_onion) {\n+            ++network_counts[1];\n+        }\n     }\n \n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n-    }\n+    // Find the number of networks from which we have disadvantaged candidates.\n+    const auto networks = std::count_if(network_counts.begin(), network_counts.end(), [](auto n) { return n; });\n+\n+    if (networks) {\n+        // Obtain the minimum number of peers per network to potentially protect.\n+        // The base ratio is 1/2 (for the case of peers from only 1 network).\n+        const size_t protect_size_per_network{total_protect_size / (2 * networks)};\n \n+        if (protect_size_per_network) {\n+            size_t total_to_protect{protect_size_per_network};\n+\n+            if (network_counts[0]) {\n+                // Protect localhost peers, sorted by longest uptime.\n+                EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, total_to_protect,\n+                                   [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+                total_to_protect += protect_size_per_network;\n+            }\n+\n+            if (network_counts[1]) {\n+                // Protect onion peers (connected via our onion service), sorted by longest uptime.\n+                const size_t onion_peers_to_protect{total_to_protect - (initial_size - vEvictionCandidates.size())};\n+                EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_peers_to_protect,",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 53,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "161aed5142048bb5c681628eb3d25d574cfbba47",
      "in_reply_to_id": 640068051,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Hm, `s/total_to_protect/available_to_protect/`? Edit: done.",
      "created_at": "2021-06-02T21:39:32Z",
      "updated_at": "2021-06-02T21:43:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r644338502",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/644338502"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 938,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647319655",
      "pull_request_review_id": 677464350,
      "id": 647319655,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NzMxOTY1NQ==",
      "diff_hunk": "@@ -894,40 +893,64 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size = initial_size / 2;\n+    struct Net {\n+        Network id;\n+        size_t count;\n+        bool operator<(const Net& rhs) const { return count < rhs.count; }\n+    };\n+    static constexpr Network localhost{NET_MAX}; // alias localhost to an unused Network enumerator\n+    std::vector<Net> networks{{localhost, 0}, {NET_I2P, 0}, {NET_ONION, 0}};\n+\n+    // Tally the number of eviction candidates per disadvantaged network.\n+    for (Net& n : networks) {\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(), [&n](const NodeEvictionCandidate& c) {\n+            return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+        });\n+    }\n+\n+    // Find the number of disadvantaged networks from which we have eviction candidates.\n+    const auto networks_size = std::count_if(networks.begin(), networks.end(), [](const Net& n) { return n.count; });\n+\n+    if (networks_size) {\n+        // Obtain the minimum number of peers per network to potentially protect.\n+        // The base ratio is 1/2 (for the case of peers from only 1 network).\n+        const size_t protect_size_per_network{total_protect_size / (2 * networks_size)};\n+\n+        if (protect_size_per_network) {\n+            size_t available_to_protect{protect_size_per_network};\n+\n+            // Stable-sort networks by ascending candidate count, to allow networks that\n+            // have more peers to recover slots not used by networks with fewer peers.\n+            std::stable_sort(networks.begin(), networks.end());\n+\n+            for (const Net& n : networks) {\n+                if (n.count == 0) continue;\n+\n+                // Protect peers of this network, sorted by longest uptime.\n+                const size_t peers_to_protect{available_to_protect - (initial_size - candidates.size())};\n+                EraseLastKElements(candidates, CompareNodeNetworkTime(n.id, localhost), peers_to_protect,\n+                                   [&n](const NodeEvictionCandidate& c) {\n+                                       return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+                                   });\n+                available_to_protect += protect_size_per_network;\n+            }\n+        }",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 117,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "dd6f8c429128a3916de8be6c523e1a3d494da7a0",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "_(I needed a pen and paper for this)_\r\n\r\nLets assume `initial_size = 100`.\r\n\r\nCase 1: `candidates` contains 1 localhost peer, 20 I2P peers and 20 Tor peers. From those, the protected will be: 1 localhost, 15 I2P, 8 Tor.\r\n\r\nCase 2: `candidates` contains 0 localhost peers, 20 I2P peers and 20 Tor peers. From those, the protected will be: 12 I2P peers and 12 Tor peers.\r\n\r\nCase 2 looks strange compared to Case 1 because _less_ I2P peers will be protected when there are no localhost ones. I would expect less peers from some earlier networks to result in more protections from subsequent networks.",
      "created_at": "2021-06-08T10:37:37Z",
      "updated_at": "2021-06-08T13:12:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r647319655",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647319655"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": 927,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 961,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647322855",
      "pull_request_review_id": 677464350,
      "id": 647322855,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NzMyMjg1NQ==",
      "diff_hunk": "@@ -894,40 +893,64 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size = initial_size / 2;\n+    struct Net {\n+        Network id;\n+        size_t count;\n+        bool operator<(const Net& rhs) const { return count < rhs.count; }\n+    };\n+    static constexpr Network localhost{NET_MAX}; // alias localhost to an unused Network enumerator\n+    std::vector<Net> networks{{localhost, 0}, {NET_I2P, 0}, {NET_ONION, 0}};\n+\n+    // Tally the number of eviction candidates per disadvantaged network.\n+    for (Net& n : networks) {\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(), [&n](const NodeEvictionCandidate& c) {\n+            return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+        });\n+    }\n+\n+    // Find the number of disadvantaged networks from which we have eviction candidates.\n+    const auto networks_size = std::count_if(networks.begin(), networks.end(), [](const Net& n) { return n.count; });\n+\n+    if (networks_size) {\n+        // Obtain the minimum number of peers per network to potentially protect.\n+        // The base ratio is 1/2 (for the case of peers from only 1 network).\n+        const size_t protect_size_per_network{total_protect_size / (2 * networks_size)};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 97,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "dd6f8c429128a3916de8be6c523e1a3d494da7a0",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Why \"minimum\"? I think that either `protect_size_per_network` or less peers will be protected, so that is a \"maximum\", no?",
      "created_at": "2021-06-08T10:44:11Z",
      "updated_at": "2021-06-08T13:12:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r647322855",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647322855"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": 925,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 927,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647413273",
      "pull_request_review_id": 677464350,
      "id": 647413273,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NzQxMzI3Mw==",
      "diff_hunk": "@@ -883,6 +871,17 @@ static bool CompareNodeBlockRelayOnlyTime(const NodeEvictionCandidate &a, const\n     return a.nTimeConnected > b.nTimeConnected;\n }\n \n+struct CompareNodeNetworkTime {",
      "path": "src/net.cpp",
      "position": 39,
      "original_position": 23,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "dd6f8c429128a3916de8be6c523e1a3d494da7a0",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I find this hard to grasp. Some comments would be nice. For example:\r\n```cpp\r\n/**\r\n * Define an order between NodeEvictionCandidate objects based on network and connection time.\r\n * Nodes near the beginning are more likely to be disconnected, nodes near the end will be\r\n * protected (less likely to be disconnected).\r\n * - First all nodes that do not belong to `network`, among them:\r\n *   - first nodes that have been connected shorter\r\n *   - later nodes that have been connected longer\r\n * - Later all nodes that belong to `network`, among them, sorted by connection time as above.\r\n */\r\nstruct CompareNodeNetworkTime {\r\n```",
      "created_at": "2021-06-08T12:57:07Z",
      "updated_at": "2021-06-08T13:12:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r647413273",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647413273"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 883,
      "original_line": 883,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647417447",
      "pull_request_review_id": 677464350,
      "id": 647417447,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NzQxNzQ0Nw==",
      "diff_hunk": "@@ -883,6 +871,17 @@ static bool CompareNodeBlockRelayOnlyTime(const NodeEvictionCandidate &a, const\n     return a.nTimeConnected > b.nTimeConnected;\n }\n \n+struct CompareNodeNetworkTime {\n+    const Network network, localhost;\n+    CompareNodeNetworkTime(Network n, Network l) : network(n), localhost(l) {}\n+    bool operator()(const NodeEvictionCandidate& a, const NodeEvictionCandidate& b) const\n+    {\n+        if (network == localhost && a.m_is_local != b.m_is_local) return b.m_is_local;\n+        if ((a.m_network == network) != (b.m_network == network)) return b.m_network == network;",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 29,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "dd6f8c429128a3916de8be6c523e1a3d494da7a0",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "If `network == localhost` and `a.m_is_local == b.m_is_local` then the control flow will continue to the second `if`. I think this is wrong or at least confusing because if this is the localhost comparator (`network == localhost`) then it should not sort based on `m_network`. Here is an example that does not involve passing the constant `localhost` if that makes it easier to understand, feel free to ignore:\r\n\r\n```cpp\r\nstruct CompareNodeNetworkTime { \r\n    const Network m_network;\r\n    const bool m_is_local;\r\n    CompareNodeNetworkTime(Network network, bool is_local)\r\n        : m_network(network), m_is_local(is_local)\r\n    { \r\n    } \r\n    bool operator()(const NodeEvictionCandidate& a, const NodeEvictionCandidate& b) const\r\n    { \r\n        if (m_is_local) {\r\n            if (a.m_is_local != b.m_is_local) {\r\n                return b.m_is_local;\r\n            }\r\n        } else if ((a.m_network == m_network) != (b.m_network == m_network)) {\r\n            return b.m_network == m_network;\r\n        }   \r\n        return a.nTimeConnected > b.nTimeConnected;\r\n    };  \r\n};\r\n\r\n...\r\n\r\nCompareNodeNetworkTime(n.id, n.id == localhost)\r\n```\r\n",
      "created_at": "2021-06-08T13:02:07Z",
      "updated_at": "2021-06-08T13:12:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r647417447",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647417447"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": 879,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 880,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647471801",
      "pull_request_review_id": 678559917,
      "id": 647471801,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NzQ3MTgwMQ==",
      "diff_hunk": "@@ -894,40 +893,64 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size = initial_size / 2;\n+    struct Net {\n+        Network id;\n+        size_t count;\n+        bool operator<(const Net& rhs) const { return count < rhs.count; }\n+    };\n+    static constexpr Network localhost{NET_MAX}; // alias localhost to an unused Network enumerator\n+    std::vector<Net> networks{{localhost, 0}, {NET_I2P, 0}, {NET_ONION, 0}};\n+\n+    // Tally the number of eviction candidates per disadvantaged network.\n+    for (Net& n : networks) {\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(), [&n](const NodeEvictionCandidate& c) {\n+            return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+        });\n+    }\n+\n+    // Find the number of disadvantaged networks from which we have eviction candidates.\n+    const auto networks_size = std::count_if(networks.begin(), networks.end(), [](const Net& n) { return n.count; });\n+\n+    if (networks_size) {\n+        // Obtain the minimum number of peers per network to potentially protect.\n+        // The base ratio is 1/2 (for the case of peers from only 1 network).\n+        const size_t protect_size_per_network{total_protect_size / (2 * networks_size)};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 97,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "dd6f8c429128a3916de8be6c523e1a3d494da7a0",
      "in_reply_to_id": 647322855,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Unused slots can be recovered, so the number protected can be higher, and yes, if there are fewer peers of that network, the number protected can be lower. Perhaps s/minimum/initial/. ",
      "created_at": "2021-06-08T14:00:59Z",
      "updated_at": "2021-06-08T14:00:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r647471801",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/647471801"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": 925,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 927,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/648020574",
      "pull_request_review_id": 679276720,
      "id": 648020574,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0ODAyMDU3NA==",
      "diff_hunk": "@@ -883,6 +871,17 @@ static bool CompareNodeBlockRelayOnlyTime(const NodeEvictionCandidate &a, const\n     return a.nTimeConnected > b.nTimeConnected;\n }\n \n+struct CompareNodeNetworkTime {\n+    const Network network, localhost;\n+    CompareNodeNetworkTime(Network n, Network l) : network(n), localhost(l) {}\n+    bool operator()(const NodeEvictionCandidate& a, const NodeEvictionCandidate& b) const\n+    {\n+        if (network == localhost && a.m_is_local != b.m_is_local) return b.m_is_local;\n+        if ((a.m_network == network) != (b.m_network == network)) return b.m_network == network;",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 29,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "dd6f8c429128a3916de8be6c523e1a3d494da7a0",
      "in_reply_to_id": 647417447,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The suggestion is equivalent/does the same thing, assuming the following change is also made to the caller. \r\n```diff\r\n-                EraseLastKElements(candidates, CompareNodeNetworkTime(n.id, localhost), peers_to_protect,\r\n+                EraseLastKElements(candidates, CompareNodeNetworkTime(n.id, n.id == localhost), peers_to_protect,\r\n```\r\n",
      "created_at": "2021-06-09T06:59:45Z",
      "updated_at": "2021-06-09T06:59:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r648020574",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/648020574"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": 879,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 880,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/648033899",
      "pull_request_review_id": 679294541,
      "id": 648033899,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0ODAzMzg5OQ==",
      "diff_hunk": "@@ -894,40 +893,64 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size = initial_size / 2;\n+    struct Net {\n+        Network id;\n+        size_t count;\n+        bool operator<(const Net& rhs) const { return count < rhs.count; }\n+    };\n+    static constexpr Network localhost{NET_MAX}; // alias localhost to an unused Network enumerator\n+    std::vector<Net> networks{{localhost, 0}, {NET_I2P, 0}, {NET_ONION, 0}};\n+\n+    // Tally the number of eviction candidates per disadvantaged network.\n+    for (Net& n : networks) {\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(), [&n](const NodeEvictionCandidate& c) {\n+            return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+        });\n+    }\n+\n+    // Find the number of disadvantaged networks from which we have eviction candidates.\n+    const auto networks_size = std::count_if(networks.begin(), networks.end(), [](const Net& n) { return n.count; });\n+\n+    if (networks_size) {\n+        // Obtain the minimum number of peers per network to potentially protect.\n+        // The base ratio is 1/2 (for the case of peers from only 1 network).\n+        const size_t protect_size_per_network{total_protect_size / (2 * networks_size)};\n+\n+        if (protect_size_per_network) {\n+            size_t available_to_protect{protect_size_per_network};\n+\n+            // Stable-sort networks by ascending candidate count, to allow networks that\n+            // have more peers to recover slots not used by networks with fewer peers.\n+            std::stable_sort(networks.begin(), networks.end());\n+\n+            for (const Net& n : networks) {\n+                if (n.count == 0) continue;\n+\n+                // Protect peers of this network, sorted by longest uptime.\n+                const size_t peers_to_protect{available_to_protect - (initial_size - candidates.size())};\n+                EraseLastKElements(candidates, CompareNodeNetworkTime(n.id, localhost), peers_to_protect,\n+                                   [&n](const NodeEvictionCandidate& c) {\n+                                       return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+                                   });\n+                available_to_protect += protect_size_per_network;\n+            }\n+        }",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 117,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "dd6f8c429128a3916de8be6c523e1a3d494da7a0",
      "in_reply_to_id": 647319655,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think the outcome of Case 2 is ideal.  Case 1 protects many I2P peers because that network gets the unused slots from the localhost allocation.  What change would you suggest?  Keep in mind that this is a subcomponent seen in isolation; another 1/4 of the remaining peers will be protected based on their uptime.",
      "created_at": "2021-06-09T07:20:28Z",
      "updated_at": "2021-06-09T07:20:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r648033899",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/648033899"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": 927,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 961,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/648082182",
      "pull_request_review_id": 679358530,
      "id": 648082182,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0ODA4MjE4Mg==",
      "diff_hunk": "@@ -894,40 +893,64 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size = initial_size / 2;\n+    struct Net {\n+        Network id;\n+        size_t count;\n+        bool operator<(const Net& rhs) const { return count < rhs.count; }\n+    };\n+    static constexpr Network localhost{NET_MAX}; // alias localhost to an unused Network enumerator\n+    std::vector<Net> networks{{localhost, 0}, {NET_I2P, 0}, {NET_ONION, 0}};\n+\n+    // Tally the number of eviction candidates per disadvantaged network.\n+    for (Net& n : networks) {\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(), [&n](const NodeEvictionCandidate& c) {\n+            return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+        });\n+    }\n+\n+    // Find the number of disadvantaged networks from which we have eviction candidates.\n+    const auto networks_size = std::count_if(networks.begin(), networks.end(), [](const Net& n) { return n.count; });\n+\n+    if (networks_size) {\n+        // Obtain the minimum number of peers per network to potentially protect.\n+        // The base ratio is 1/2 (for the case of peers from only 1 network).\n+        const size_t protect_size_per_network{total_protect_size / (2 * networks_size)};\n+\n+        if (protect_size_per_network) {\n+            size_t available_to_protect{protect_size_per_network};\n+\n+            // Stable-sort networks by ascending candidate count, to allow networks that\n+            // have more peers to recover slots not used by networks with fewer peers.\n+            std::stable_sort(networks.begin(), networks.end());\n+\n+            for (const Net& n : networks) {\n+                if (n.count == 0) continue;\n+\n+                // Protect peers of this network, sorted by longest uptime.\n+                const size_t peers_to_protect{available_to_protect - (initial_size - candidates.size())};\n+                EraseLastKElements(candidates, CompareNodeNetworkTime(n.id, localhost), peers_to_protect,\n+                                   [&n](const NodeEvictionCandidate& c) {\n+                                       return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+                                   });\n+                available_to_protect += protect_size_per_network;\n+            }\n+        }",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 117,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "dd6f8c429128a3916de8be6c523e1a3d494da7a0",
      "in_reply_to_id": 647319655,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Hm, maybe we can tally the number of networks that have more than `protect_size_per_network` peers and try to share the leftover slots between them so that Case 1 protects 1 / 11 / 12 instead of 1 / 15 / 8.",
      "created_at": "2021-06-09T08:26:18Z",
      "updated_at": "2021-06-09T08:26:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r648082182",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/648082182"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": 927,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 961,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/648169448",
      "pull_request_review_id": 679474233,
      "id": 648169448,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0ODE2OTQ0OA==",
      "diff_hunk": "@@ -894,40 +893,64 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size = initial_size / 2;\n+    struct Net {\n+        Network id;\n+        size_t count;\n+        bool operator<(const Net& rhs) const { return count < rhs.count; }\n+    };\n+    static constexpr Network localhost{NET_MAX}; // alias localhost to an unused Network enumerator\n+    std::vector<Net> networks{{localhost, 0}, {NET_I2P, 0}, {NET_ONION, 0}};\n+\n+    // Tally the number of eviction candidates per disadvantaged network.\n+    for (Net& n : networks) {\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(), [&n](const NodeEvictionCandidate& c) {\n+            return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+        });\n+    }\n+\n+    // Find the number of disadvantaged networks from which we have eviction candidates.\n+    const auto networks_size = std::count_if(networks.begin(), networks.end(), [](const Net& n) { return n.count; });\n+\n+    if (networks_size) {\n+        // Obtain the minimum number of peers per network to potentially protect.\n+        // The base ratio is 1/2 (for the case of peers from only 1 network).\n+        const size_t protect_size_per_network{total_protect_size / (2 * networks_size)};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 97,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "dd6f8c429128a3916de8be6c523e1a3d494da7a0",
      "in_reply_to_id": 647322855,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Right, it can be higher or lower. Neither one of \"minimum\" or \"maximum\" is suitable. `s/minimum/initial/` looks good.",
      "created_at": "2021-06-09T10:21:45Z",
      "updated_at": "2021-06-09T10:21:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r648169448",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/648169448"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": 925,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 927,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/648183294",
      "pull_request_review_id": 679492907,
      "id": 648183294,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0ODE4MzI5NA==",
      "diff_hunk": "@@ -894,40 +893,64 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size = initial_size / 2;\n+    struct Net {\n+        Network id;\n+        size_t count;\n+        bool operator<(const Net& rhs) const { return count < rhs.count; }\n+    };\n+    static constexpr Network localhost{NET_MAX}; // alias localhost to an unused Network enumerator\n+    std::vector<Net> networks{{localhost, 0}, {NET_I2P, 0}, {NET_ONION, 0}};\n+\n+    // Tally the number of eviction candidates per disadvantaged network.\n+    for (Net& n : networks) {\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(), [&n](const NodeEvictionCandidate& c) {\n+            return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+        });\n+    }\n+\n+    // Find the number of disadvantaged networks from which we have eviction candidates.\n+    const auto networks_size = std::count_if(networks.begin(), networks.end(), [](const Net& n) { return n.count; });\n+\n+    if (networks_size) {\n+        // Obtain the minimum number of peers per network to potentially protect.\n+        // The base ratio is 1/2 (for the case of peers from only 1 network).\n+        const size_t protect_size_per_network{total_protect_size / (2 * networks_size)};\n+\n+        if (protect_size_per_network) {\n+            size_t available_to_protect{protect_size_per_network};\n+\n+            // Stable-sort networks by ascending candidate count, to allow networks that\n+            // have more peers to recover slots not used by networks with fewer peers.\n+            std::stable_sort(networks.begin(), networks.end());\n+\n+            for (const Net& n : networks) {\n+                if (n.count == 0) continue;\n+\n+                // Protect peers of this network, sorted by longest uptime.\n+                const size_t peers_to_protect{available_to_protect - (initial_size - candidates.size())};\n+                EraseLastKElements(candidates, CompareNodeNetworkTime(n.id, localhost), peers_to_protect,\n+                                   [&n](const NodeEvictionCandidate& c) {\n+                                       return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+                                   });\n+                available_to_protect += protect_size_per_network;\n+            }\n+        }",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 117,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "dd6f8c429128a3916de8be6c523e1a3d494da7a0",
      "in_reply_to_id": 647319655,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": ">  What change would you suggest?\r\n\r\n```cpp\r\nvoid ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\r\n{\r\n    // Treat localhost connections as a separate network.\r\n    static constexpr Network NET_LOCALHOST{NET_MAX};\r\n\r\n    const std::array<Network, 3> networks{NET_LOCALHOST, NET_I2P, NET_ONION};\r\n\r\n    // Protect the half of the remaining nodes which have been connected the longest.\r\n    // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\r\n    // To favorise the diversity of our peer connections, reserve up to half of\r\n    // these protected spots for onion, localhost and I2P peers, even if they're\r\n    // not longest uptime overall. This helps protect these higher-latency peers\r\n    // that tend to be otherwise disadvantaged under our eviction criteria.\r\n    const size_t total_to_protect{candidates.size() / 2};\r\n\r\n    // Protect up to 25% of `candidates` due to network. We may protect less if\r\n    // there are no candidates that belong to `networks`.\r\n\r\n    const size_t max_protect_due_to_network{total_to_protect / 2};\r\n    size_t num_protected{0};\r\n\r\n    while (num_protected < max_protect_due_to_network) {\r\n        const size_t remaining_to_protect{max_protect_due_to_network - num_protected};\r\n        const size_t protect_per_network{std::max(remaining_to_protect / networks.size(), 1UL)};\r\n        bool protected_at_least_one{false};\r\n\r\n        for (const Network net : networks) {\r\n            const size_t before = candidates.size();\r\n            EraseLastKElements(candidates,\r\n                               CompareNodeNetworkTime(net, net == NET_LOCALHOST),\r\n                               protect_per_network,\r\n                               [&net](const NodeEvictionCandidate& c) {\r\n                                   return net == NET_LOCALHOST ? c.m_is_local : c.m_network == net;\r\n                               });\r\n            const size_t after = candidates.size();\r\n            if (after < before) {\r\n                protected_at_least_one = true;\r\n                num_protected += before - after;\r\n                if (num_protected >= max_protect_due_to_network) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (!protected_at_least_one) {\r\n            break;\r\n        }\r\n    }\r\n\r\n    // Protect another 25% to 50% of `candidates` due to uptime/longevity. For example, if\r\n    // 25% were protected due to network then we will protect 25% due to uptime, if\r\n    // 20% were protected due to network then we will protect 30% due to uptime.\r\n    const size_t remaining{total_to_protect - num_protected};\r\n    EraseLastKElements(candidates, ReverseCompareNodeTimeConnected, remaining);\r\n}\r\n```\r\n\r\nwill result in:\r\n```\r\n(number of peers that belong to localhost, i2p, tor => protected peers from localhost, i2p, tor)\r\n1, 20, 20 => 1, 12, 12\r\n0, 20, 20 => 0, 13, 12\r\n```\r\n\r\nFeel free to ignore.",
      "created_at": "2021-06-09T10:43:20Z",
      "updated_at": "2021-06-09T10:43:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r648183294",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/648183294"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": 927,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 961,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/648613692",
      "pull_request_review_id": 680061239,
      "id": 648613692,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0ODYxMzY5Mg==",
      "diff_hunk": "@@ -894,40 +893,64 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size = initial_size / 2;\n+    struct Net {\n+        Network id;\n+        size_t count;\n+        bool operator<(const Net& rhs) const { return count < rhs.count; }\n+    };\n+    static constexpr Network localhost{NET_MAX}; // alias localhost to an unused Network enumerator\n+    std::vector<Net> networks{{localhost, 0}, {NET_I2P, 0}, {NET_ONION, 0}};\n+\n+    // Tally the number of eviction candidates per disadvantaged network.\n+    for (Net& n : networks) {\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(), [&n](const NodeEvictionCandidate& c) {\n+            return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+        });\n+    }\n+\n+    // Find the number of disadvantaged networks from which we have eviction candidates.\n+    const auto networks_size = std::count_if(networks.begin(), networks.end(), [](const Net& n) { return n.count; });\n+\n+    if (networks_size) {\n+        // Obtain the minimum number of peers per network to potentially protect.\n+        // The base ratio is 1/2 (for the case of peers from only 1 network).\n+        const size_t protect_size_per_network{total_protect_size / (2 * networks_size)};\n+\n+        if (protect_size_per_network) {\n+            size_t available_to_protect{protect_size_per_network};\n+\n+            // Stable-sort networks by ascending candidate count, to allow networks that\n+            // have more peers to recover slots not used by networks with fewer peers.\n+            std::stable_sort(networks.begin(), networks.end());\n+\n+            for (const Net& n : networks) {\n+                if (n.count == 0) continue;\n+\n+                // Protect peers of this network, sorted by longest uptime.\n+                const size_t peers_to_protect{available_to_protect - (initial_size - candidates.size())};\n+                EraseLastKElements(candidates, CompareNodeNetworkTime(n.id, localhost), peers_to_protect,\n+                                   [&n](const NodeEvictionCandidate& c) {\n+                                       return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+                                   });\n+                available_to_protect += protect_size_per_network;\n+            }\n+        }",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 117,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "dd6f8c429128a3916de8be6c523e1a3d494da7a0",
      "in_reply_to_id": 647319655,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This seems like a nice approach, multi-pass with simpler data structures. Will adapt the tests to it to check all the test cases.  Edit: only 4 \"combined\" test cases needed to be updated, and this version does better on those. ",
      "created_at": "2021-06-09T19:28:26Z",
      "updated_at": "2021-06-09T19:41:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r648613692",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/648613692"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": 927,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 961,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649189169",
      "pull_request_review_id": 680791861,
      "id": 649189169,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0OTE4OTE2OQ==",
      "diff_hunk": "@@ -894,40 +893,64 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size = initial_size / 2;\n+    struct Net {\n+        Network id;\n+        size_t count;\n+        bool operator<(const Net& rhs) const { return count < rhs.count; }\n+    };\n+    static constexpr Network localhost{NET_MAX}; // alias localhost to an unused Network enumerator\n+    std::vector<Net> networks{{localhost, 0}, {NET_I2P, 0}, {NET_ONION, 0}};\n+\n+    // Tally the number of eviction candidates per disadvantaged network.\n+    for (Net& n : networks) {\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(), [&n](const NodeEvictionCandidate& c) {\n+            return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+        });\n+    }\n+\n+    // Find the number of disadvantaged networks from which we have eviction candidates.\n+    const auto networks_size = std::count_if(networks.begin(), networks.end(), [](const Net& n) { return n.count; });\n+\n+    if (networks_size) {\n+        // Obtain the minimum number of peers per network to potentially protect.\n+        // The base ratio is 1/2 (for the case of peers from only 1 network).\n+        const size_t protect_size_per_network{total_protect_size / (2 * networks_size)};\n+\n+        if (protect_size_per_network) {\n+            size_t available_to_protect{protect_size_per_network};\n+\n+            // Stable-sort networks by ascending candidate count, to allow networks that\n+            // have more peers to recover slots not used by networks with fewer peers.\n+            std::stable_sort(networks.begin(), networks.end());\n+\n+            for (const Net& n : networks) {\n+                if (n.count == 0) continue;\n+\n+                // Protect peers of this network, sorted by longest uptime.\n+                const size_t peers_to_protect{available_to_protect - (initial_size - candidates.size())};\n+                EraseLastKElements(candidates, CompareNodeNetworkTime(n.id, localhost), peers_to_protect,\n+                                   [&n](const NodeEvictionCandidate& c) {\n+                                       return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+                                   });\n+                available_to_protect += protect_size_per_network;\n+            }\n+        }",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 117,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "dd6f8c429128a3916de8be6c523e1a3d494da7a0",
      "in_reply_to_id": 647319655,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It looks like we should keep the `Net` struct and `<` sort operator so the result can independent of the order of members in the `networks` array, so a hybrid approach, also adding an `is_local` member to the struct to no longer need `net == localhost` throughout the code.",
      "created_at": "2021-06-10T13:35:30Z",
      "updated_at": "2021-06-10T13:35:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r649189169",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649189169"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": 927,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 961,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649206111",
      "pull_request_review_id": 680815438,
      "id": 649206111,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0OTIwNjExMQ==",
      "diff_hunk": "@@ -894,40 +893,64 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size = initial_size / 2;\n+    struct Net {\n+        Network id;\n+        size_t count;\n+        bool operator<(const Net& rhs) const { return count < rhs.count; }\n+    };\n+    static constexpr Network localhost{NET_MAX}; // alias localhost to an unused Network enumerator\n+    std::vector<Net> networks{{localhost, 0}, {NET_I2P, 0}, {NET_ONION, 0}};\n+\n+    // Tally the number of eviction candidates per disadvantaged network.\n+    for (Net& n : networks) {\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(), [&n](const NodeEvictionCandidate& c) {\n+            return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+        });\n+    }\n+\n+    // Find the number of disadvantaged networks from which we have eviction candidates.\n+    const auto networks_size = std::count_if(networks.begin(), networks.end(), [](const Net& n) { return n.count; });\n+\n+    if (networks_size) {\n+        // Obtain the minimum number of peers per network to potentially protect.\n+        // The base ratio is 1/2 (for the case of peers from only 1 network).\n+        const size_t protect_size_per_network{total_protect_size / (2 * networks_size)};\n+\n+        if (protect_size_per_network) {\n+            size_t available_to_protect{protect_size_per_network};\n+\n+            // Stable-sort networks by ascending candidate count, to allow networks that\n+            // have more peers to recover slots not used by networks with fewer peers.\n+            std::stable_sort(networks.begin(), networks.end());\n+\n+            for (const Net& n : networks) {\n+                if (n.count == 0) continue;\n+\n+                // Protect peers of this network, sorted by longest uptime.\n+                const size_t peers_to_protect{available_to_protect - (initial_size - candidates.size())};\n+                EraseLastKElements(candidates, CompareNodeNetworkTime(n.id, localhost), peers_to_protect,\n+                                   [&n](const NodeEvictionCandidate& c) {\n+                                       return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+                                   });\n+                available_to_protect += protect_size_per_network;\n+            }\n+        }",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 117,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "dd6f8c429128a3916de8be6c523e1a3d494da7a0",
      "in_reply_to_id": 647319655,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yes, with the above snippet, the result may depend on the order of elements in the `networks` array, but only up to 1 which I think it ok - after all, if we want to split evenly e.g. 10 slots among 3 networks, some network will get 4 slots and the rest will get 3 slots.\r\n\r\nThe current code also depends on the order in `networks` because it does \"stable\" sort, right?",
      "created_at": "2021-06-10T13:54:19Z",
      "updated_at": "2021-06-10T13:54:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r649206111",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649206111"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": 927,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 961,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649229635",
      "pull_request_review_id": 680848241,
      "id": 649229635,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0OTIyOTYzNQ==",
      "diff_hunk": "@@ -894,40 +893,64 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size = initial_size / 2;\n+    struct Net {\n+        Network id;\n+        size_t count;\n+        bool operator<(const Net& rhs) const { return count < rhs.count; }\n+    };\n+    static constexpr Network localhost{NET_MAX}; // alias localhost to an unused Network enumerator\n+    std::vector<Net> networks{{localhost, 0}, {NET_I2P, 0}, {NET_ONION, 0}};\n+\n+    // Tally the number of eviction candidates per disadvantaged network.\n+    for (Net& n : networks) {\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(), [&n](const NodeEvictionCandidate& c) {\n+            return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+        });\n+    }\n+\n+    // Find the number of disadvantaged networks from which we have eviction candidates.\n+    const auto networks_size = std::count_if(networks.begin(), networks.end(), [](const Net& n) { return n.count; });\n+\n+    if (networks_size) {\n+        // Obtain the minimum number of peers per network to potentially protect.\n+        // The base ratio is 1/2 (for the case of peers from only 1 network).\n+        const size_t protect_size_per_network{total_protect_size / (2 * networks_size)};\n+\n+        if (protect_size_per_network) {\n+            size_t available_to_protect{protect_size_per_network};\n+\n+            // Stable-sort networks by ascending candidate count, to allow networks that\n+            // have more peers to recover slots not used by networks with fewer peers.\n+            std::stable_sort(networks.begin(), networks.end());\n+\n+            for (const Net& n : networks) {\n+                if (n.count == 0) continue;\n+\n+                // Protect peers of this network, sorted by longest uptime.\n+                const size_t peers_to_protect{available_to_protect - (initial_size - candidates.size())};\n+                EraseLastKElements(candidates, CompareNodeNetworkTime(n.id, localhost), peers_to_protect,\n+                                   [&n](const NodeEvictionCandidate& c) {\n+                                       return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+                                   });\n+                available_to_protect += protect_size_per_network;\n+            }\n+        }",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 117,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "dd6f8c429128a3916de8be6c523e1a3d494da7a0",
      "in_reply_to_id": 647319655,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The results make more sense when they depend on number of peers by network, e.g. if you have 10 I2P peers and 3 onion ones, best to give first chance at unused slots to the I2P peers so we protect, say, 3 I2P and 2 onions rather than the opposite.  Stable sort only makes a difference if the peer counts are equal. I'll propose this separately in the last commit for feedback.",
      "created_at": "2021-06-10T14:19:47Z",
      "updated_at": "2021-06-10T14:19:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r649229635",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649229635"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": 927,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 961,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649233724",
      "pull_request_review_id": 680853861,
      "id": 649233724,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0OTIzMzcyNA==",
      "diff_hunk": "@@ -894,40 +893,64 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size = initial_size / 2;\n+    struct Net {\n+        Network id;\n+        size_t count;\n+        bool operator<(const Net& rhs) const { return count < rhs.count; }\n+    };\n+    static constexpr Network localhost{NET_MAX}; // alias localhost to an unused Network enumerator\n+    std::vector<Net> networks{{localhost, 0}, {NET_I2P, 0}, {NET_ONION, 0}};\n+\n+    // Tally the number of eviction candidates per disadvantaged network.\n+    for (Net& n : networks) {\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(), [&n](const NodeEvictionCandidate& c) {\n+            return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+        });\n+    }\n+\n+    // Find the number of disadvantaged networks from which we have eviction candidates.\n+    const auto networks_size = std::count_if(networks.begin(), networks.end(), [](const Net& n) { return n.count; });\n+\n+    if (networks_size) {\n+        // Obtain the minimum number of peers per network to potentially protect.\n+        // The base ratio is 1/2 (for the case of peers from only 1 network).\n+        const size_t protect_size_per_network{total_protect_size / (2 * networks_size)};\n+\n+        if (protect_size_per_network) {\n+            size_t available_to_protect{protect_size_per_network};\n+\n+            // Stable-sort networks by ascending candidate count, to allow networks that\n+            // have more peers to recover slots not used by networks with fewer peers.\n+            std::stable_sort(networks.begin(), networks.end());\n+\n+            for (const Net& n : networks) {\n+                if (n.count == 0) continue;\n+\n+                // Protect peers of this network, sorted by longest uptime.\n+                const size_t peers_to_protect{available_to_protect - (initial_size - candidates.size())};\n+                EraseLastKElements(candidates, CompareNodeNetworkTime(n.id, localhost), peers_to_protect,\n+                                   [&n](const NodeEvictionCandidate& c) {\n+                                       return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+                                   });\n+                available_to_protect += protect_size_per_network;\n+            }\n+        }",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 117,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "dd6f8c429128a3916de8be6c523e1a3d494da7a0",
      "in_reply_to_id": 647319655,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "What I like is that we focused on different aspects and the combined result seems to provide the best eviction protection, so this is great.",
      "created_at": "2021-06-10T14:24:14Z",
      "updated_at": "2021-06-10T14:24:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r649233724",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649233724"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": 927,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 961,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649244859",
      "pull_request_review_id": 680869136,
      "id": 649244859,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0OTI0NDg1OQ==",
      "diff_hunk": "@@ -894,40 +893,64 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size = initial_size / 2;\n+    struct Net {\n+        Network id;\n+        size_t count;\n+        bool operator<(const Net& rhs) const { return count < rhs.count; }\n+    };\n+    static constexpr Network localhost{NET_MAX}; // alias localhost to an unused Network enumerator\n+    std::vector<Net> networks{{localhost, 0}, {NET_I2P, 0}, {NET_ONION, 0}};\n+\n+    // Tally the number of eviction candidates per disadvantaged network.\n+    for (Net& n : networks) {\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(), [&n](const NodeEvictionCandidate& c) {\n+            return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+        });\n+    }\n+\n+    // Find the number of disadvantaged networks from which we have eviction candidates.\n+    const auto networks_size = std::count_if(networks.begin(), networks.end(), [](const Net& n) { return n.count; });\n+\n+    if (networks_size) {\n+        // Obtain the minimum number of peers per network to potentially protect.\n+        // The base ratio is 1/2 (for the case of peers from only 1 network).\n+        const size_t protect_size_per_network{total_protect_size / (2 * networks_size)};\n+\n+        if (protect_size_per_network) {\n+            size_t available_to_protect{protect_size_per_network};\n+\n+            // Stable-sort networks by ascending candidate count, to allow networks that\n+            // have more peers to recover slots not used by networks with fewer peers.\n+            std::stable_sort(networks.begin(), networks.end());\n+\n+            for (const Net& n : networks) {\n+                if (n.count == 0) continue;\n+\n+                // Protect peers of this network, sorted by longest uptime.\n+                const size_t peers_to_protect{available_to_protect - (initial_size - candidates.size())};\n+                EraseLastKElements(candidates, CompareNodeNetworkTime(n.id, localhost), peers_to_protect,\n+                                   [&n](const NodeEvictionCandidate& c) {\n+                                       return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+                                   });\n+                available_to_protect += protect_size_per_network;\n+            }\n+        }",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 117,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "dd6f8c429128a3916de8be6c523e1a3d494da7a0",
      "in_reply_to_id": 647319655,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "So, if we have 10 I2P peers and 3 onion ones and we want to protect 6 in total, we will protect 3 I2P and 3 onion, this is desired, right?\r\n\r\nIf we have again 10 I2P and 3 onion and want to protect 5, do we want to protect 3 I2P and 2 onion or 2 I2P and 3 onion? I am not sure. One may argue that protecting one more (but we are talking about just one here) from the rare network (onion) is better because it is easier to find peers from the more popular network (I2P), so the ones from the rare network are more scarce and precious. Or a counter argument could be to keep the proportion - if we have more I2P, then keep more I2P.\r\n\r\nPersonally, I think it is not so important because it is just 1 peer we are talking about here and I would favor code simplicity over enforcing either approach with more complex code.",
      "created_at": "2021-06-10T14:35:55Z",
      "updated_at": "2021-06-10T14:35:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r649244859",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649244859"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": 927,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 961,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649246190",
      "pull_request_review_id": 680870930,
      "id": 649246190,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0OTI0NjE5MA==",
      "diff_hunk": "@@ -883,6 +871,17 @@ static bool CompareNodeBlockRelayOnlyTime(const NodeEvictionCandidate &a, const\n     return a.nTimeConnected > b.nTimeConnected;\n }\n \n+struct CompareNodeNetworkTime {\n+    const Network network, localhost;\n+    CompareNodeNetworkTime(Network n, Network l) : network(n), localhost(l) {}\n+    bool operator()(const NodeEvictionCandidate& a, const NodeEvictionCandidate& b) const\n+    {\n+        if (network == localhost && a.m_is_local != b.m_is_local) return b.m_is_local;\n+        if ((a.m_network == network) != (b.m_network == network)) return b.m_network == network;",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 29,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "dd6f8c429128a3916de8be6c523e1a3d494da7a0",
      "in_reply_to_id": 647417447,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Updated to pass an `is_local` bool.",
      "created_at": "2021-06-10T14:37:22Z",
      "updated_at": "2021-06-10T14:37:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r649246190",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649246190"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": 879,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 880,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649247964",
      "pull_request_review_id": 680873414,
      "id": 649247964,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0OTI0Nzk2NA==",
      "diff_hunk": "@@ -894,40 +893,64 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size = initial_size / 2;\n+    struct Net {\n+        Network id;\n+        size_t count;\n+        bool operator<(const Net& rhs) const { return count < rhs.count; }\n+    };\n+    static constexpr Network localhost{NET_MAX}; // alias localhost to an unused Network enumerator\n+    std::vector<Net> networks{{localhost, 0}, {NET_I2P, 0}, {NET_ONION, 0}};\n+\n+    // Tally the number of eviction candidates per disadvantaged network.\n+    for (Net& n : networks) {\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(), [&n](const NodeEvictionCandidate& c) {\n+            return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+        });\n+    }\n+\n+    // Find the number of disadvantaged networks from which we have eviction candidates.\n+    const auto networks_size = std::count_if(networks.begin(), networks.end(), [](const Net& n) { return n.count; });\n+\n+    if (networks_size) {\n+        // Obtain the minimum number of peers per network to potentially protect.\n+        // The base ratio is 1/2 (for the case of peers from only 1 network).\n+        const size_t protect_size_per_network{total_protect_size / (2 * networks_size)};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 97,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "dd6f8c429128a3916de8be6c523e1a3d494da7a0",
      "in_reply_to_id": 647322855,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks. This line is now no longer used.",
      "created_at": "2021-06-10T14:39:15Z",
      "updated_at": "2021-06-10T14:39:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r649247964",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649247964"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": 925,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 927,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649277371",
      "pull_request_review_id": 680914077,
      "id": 649277371,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0OTI3NzM3MQ==",
      "diff_hunk": "@@ -894,40 +893,64 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size = initial_size / 2;\n+    struct Net {\n+        Network id;\n+        size_t count;\n+        bool operator<(const Net& rhs) const { return count < rhs.count; }\n+    };\n+    static constexpr Network localhost{NET_MAX}; // alias localhost to an unused Network enumerator\n+    std::vector<Net> networks{{localhost, 0}, {NET_I2P, 0}, {NET_ONION, 0}};\n+\n+    // Tally the number of eviction candidates per disadvantaged network.\n+    for (Net& n : networks) {\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(), [&n](const NodeEvictionCandidate& c) {\n+            return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+        });\n+    }\n+\n+    // Find the number of disadvantaged networks from which we have eviction candidates.\n+    const auto networks_size = std::count_if(networks.begin(), networks.end(), [](const Net& n) { return n.count; });\n+\n+    if (networks_size) {\n+        // Obtain the minimum number of peers per network to potentially protect.\n+        // The base ratio is 1/2 (for the case of peers from only 1 network).\n+        const size_t protect_size_per_network{total_protect_size / (2 * networks_size)};\n+\n+        if (protect_size_per_network) {\n+            size_t available_to_protect{protect_size_per_network};\n+\n+            // Stable-sort networks by ascending candidate count, to allow networks that\n+            // have more peers to recover slots not used by networks with fewer peers.\n+            std::stable_sort(networks.begin(), networks.end());\n+\n+            for (const Net& n : networks) {\n+                if (n.count == 0) continue;\n+\n+                // Protect peers of this network, sorted by longest uptime.\n+                const size_t peers_to_protect{available_to_protect - (initial_size - candidates.size())};\n+                EraseLastKElements(candidates, CompareNodeNetworkTime(n.id, localhost), peers_to_protect,\n+                                   [&n](const NodeEvictionCandidate& c) {\n+                                       return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+                                   });\n+                available_to_protect += protect_size_per_network;\n+            }\n+        }",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 117,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "dd6f8c429128a3916de8be6c523e1a3d494da7a0",
      "in_reply_to_id": 647319655,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yes, this is about tradeoffs. The simplest code was when only a `Network` was passed around all the code without the `is_local` bool everywhere, but that simplicity had a logic encapsulation drawback (perhaps some others), so I rewrote everything and brought back `is_local`. \r\n\r\nI've redone this pull several times because I'd like it to do the right thing, whether networks with more peers get first priority at unused slots or networks with fewer.  When running a node with a reduced number of connections (`-maxconnections`), an eviction candidate can be one of a small number. If people prefer to have the array order decide independently of the number of peers, it seems we should clearly document that dependency. Edit: documented.\r\n\r\nI've separated the changes out to separate commits. Am going through everything before pushing the update.",
      "created_at": "2021-06-10T15:11:29Z",
      "updated_at": "2021-06-11T13:27:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r649277371",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649277371"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": 927,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 961,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649292684",
      "pull_request_review_id": 680935401,
      "id": 649292684,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0OTI5MjY4NA==",
      "diff_hunk": "@@ -894,40 +893,64 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size = initial_size / 2;\n+    struct Net {\n+        Network id;\n+        size_t count;\n+        bool operator<(const Net& rhs) const { return count < rhs.count; }\n+    };\n+    static constexpr Network localhost{NET_MAX}; // alias localhost to an unused Network enumerator\n+    std::vector<Net> networks{{localhost, 0}, {NET_I2P, 0}, {NET_ONION, 0}};\n+\n+    // Tally the number of eviction candidates per disadvantaged network.\n+    for (Net& n : networks) {\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(), [&n](const NodeEvictionCandidate& c) {\n+            return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+        });\n+    }\n+\n+    // Find the number of disadvantaged networks from which we have eviction candidates.\n+    const auto networks_size = std::count_if(networks.begin(), networks.end(), [](const Net& n) { return n.count; });\n+\n+    if (networks_size) {\n+        // Obtain the minimum number of peers per network to potentially protect.\n+        // The base ratio is 1/2 (for the case of peers from only 1 network).\n+        const size_t protect_size_per_network{total_protect_size / (2 * networks_size)};\n+\n+        if (protect_size_per_network) {\n+            size_t available_to_protect{protect_size_per_network};\n+\n+            // Stable-sort networks by ascending candidate count, to allow networks that\n+            // have more peers to recover slots not used by networks with fewer peers.\n+            std::stable_sort(networks.begin(), networks.end());\n+\n+            for (const Net& n : networks) {\n+                if (n.count == 0) continue;\n+\n+                // Protect peers of this network, sorted by longest uptime.\n+                const size_t peers_to_protect{available_to_protect - (initial_size - candidates.size())};\n+                EraseLastKElements(candidates, CompareNodeNetworkTime(n.id, localhost), peers_to_protect,\n+                                   [&n](const NodeEvictionCandidate& c) {\n+                                       return n.id == localhost ? c.m_is_local : c.m_network == n.id;\n+                                   });\n+                available_to_protect += protect_size_per_network;\n+            }\n+        }",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 117,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "dd6f8c429128a3916de8be6c523e1a3d494da7a0",
      "in_reply_to_id": 647319655,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "My thought is that having separate protection buckets for each of the disadvantaged networks is the essential step here to improving the diversity of our inbound peer connections...and that unused protection slots should be distributed among disadvantaged networks having remaining eviction candidates by descending order of their count, and in the case of a tie, fall back to the array order.",
      "created_at": "2021-06-10T15:29:01Z",
      "updated_at": "2021-06-11T11:34:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r649292684",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649292684"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": 927,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 961,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649452442",
      "pull_request_review_id": 681157090,
      "id": 649452442,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0OTQ1MjQ0Mg==",
      "diff_hunk": "@@ -883,6 +871,17 @@ static bool CompareNodeBlockRelayOnlyTime(const NodeEvictionCandidate &a, const\n     return a.nTimeConnected > b.nTimeConnected;\n }\n \n+struct CompareNodeNetworkTime {",
      "path": "src/net.cpp",
      "position": 39,
      "original_position": 23,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "dd6f8c429128a3916de8be6c523e1a3d494da7a0",
      "in_reply_to_id": 647413273,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done, added documentation.",
      "created_at": "2021-06-10T19:09:44Z",
      "updated_at": "2021-06-10T19:09:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r649452442",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/649452442"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 883,
      "original_line": 883,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650032286",
      "pull_request_review_id": 681905665,
      "id": 650032286,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDAzMjI4Ng==",
      "diff_hunk": "@@ -894,40 +902,62 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n+    // Networks to protect: localhost, onion, I2P. In case of equal counts, earlier array members\n+    // have the first opportunity to recover unused protection slots from the previous iteration.\n+    struct Net { Network id; size_t count; bool is_local; };\n+    std::array<Net, 3> networks{{{/* localhost */ NET_MAX, 0, 1}, {NET_ONION, 0, 0}, {NET_I2P, 0, 0}}};\n+\n+    for (Net& n : networks) { // Count and store the number of eviction candidates per network.\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(),\n+                                [&n](const NodeEvictionCandidate& c) {\n+                                    return n.is_local ? c.m_is_local : c.m_network == n.id;\n+                                });\n+    }\n+    // Sort `networks` by descending candidate count, to give networks having more candidates\n+    // the first opportunity to recover unused protection slots from the previous iteration.\n+    std::stable_sort(networks.begin(), networks.end(), [](Net a, Net b) { return a.count > b.count; });\n+\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size{initial_size / 2};\n+\n+    // Protect up to 25% of the candidates by disadvantaged network.\n+    const size_t max_protect_by_network{total_protect_size / 2};\n+    size_t num_protected{0};\n+\n+    while (num_protected < max_protect_by_network) {\n+        const size_t remaining_to_protect{max_protect_by_network - num_protected};\n+        const size_t protect_per_network{std::max(remaining_to_protect / networks.size(), static_cast<size_t>(1))};\n+        bool protected_at_least_one{false};\n+        for (const Net& n : networks) {\n+            if (n.count == 0) continue;\n+            const size_t before = candidates.size();\n+            EraseLastKElements(candidates, CompareNodeNetworkTime(n.is_local, n.id), protect_per_network,\n+                               [&n](const NodeEvictionCandidate& c) {\n+                                   return n.is_local ? c.m_is_local : c.m_network == n.id;\n+                               });\n+            const size_t after = candidates.size();\n+            if (before > after) {\n+                protected_at_least_one = true;\n+                num_protected += before - after;\n+                if (num_protected >= max_protect_by_network) break;",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 120,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "22b1dae1e07326e9644cc0ffcb50196352f32a3d",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "_off-topic, please ignore_\r\n\r\n```cpp\r\nif (cond) statement;\r\n```\r\nvs\r\n```cpp\r\nif (cond) {\r\n    statement;\r\n}\r\n```\r\n\r\nPutting everything on one line has 3 disadvantages:\r\n1. It is not gdb friendly - it is not possible to set a breakpoint on `statement;` - to stop after `cond` and before `statement` (if `cond` was true).\r\n2. It is not friendly to line-based code coverage - it will show that that line was executed even if `statement` was not.\r\n3. It is not diff friendly:\r\n3.1.\r\n```diff\r\n-if (cond) statement;\r\n+if (cond) {\r\n+    statement;\r\n+    another;\r\n+}\r\n```\r\nVS\r\n```diff\r\n if (cond) {\r\n     statement;\r\n+    another;\r\n }\r\n```\r\n3.2.\r\n```diff\r\n-if (some || involved(123) || STUFF + here / 9 || you_have_to_check_if_this_is_the_same) woho(x * 19 - y);\r\n+if (some || involved(123) || STUFF + here / 9 || you_have_to_check_if_this_is_the_same) woho(x * 29 - y);\r\n```\r\nVS\r\n```diff\r\n if (some || involved(123) || STUFF + here / 9 || no_need_to_check_in_this_case) {\r\n-    woho(x * 19 - y);\r\n+    woho(x * 29 - y);\r\n }\r\n```\r\n",
      "created_at": "2021-06-11T14:38:58Z",
      "updated_at": "2021-06-11T15:09:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650032286",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650032286"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 946,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650041974",
      "pull_request_review_id": 681905665,
      "id": 650041974,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDA0MTk3NA==",
      "diff_hunk": "@@ -36,7 +32,7 @@ std::vector<NodeEvictionCandidate> GetRandomNodeEvictionCandidates(const int n_c\n             /* nKeyedNetGroup */ random_context.randrange(100),\n             /* prefer_evict */ random_context.randbool(),\n             /* m_is_local */ random_context.randbool(),\n-            /* m_is_onion */ random_context.randbool(),\n+            /* m_network */ static_cast<Network>(random_context.randrange(static_cast<int>(Network::NET_INTERNAL))),",
      "path": "src/test/net_peer_eviction_tests.cpp",
      "position": null,
      "original_position": 25,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "42530190d82ee1692a546a8daae89e3ba0f5a3a2",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This implies that `NET_INTERNAL` has the highest value which may change in the future.\r\n\r\n```suggestion\r\n            /* m_network */ ALL_NETWORKS[random_context.randrange(ALL_NETWORKS.size())],\r\n```",
      "created_at": "2021-06-11T14:51:38Z",
      "updated_at": "2021-06-11T15:09:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650041974",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650041974"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 35,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650133285",
      "pull_request_review_id": 682042627,
      "id": 650133285,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDEzMzI4NQ==",
      "diff_hunk": "@@ -894,40 +902,58 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 51,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "42530190d82ee1692a546a8daae89e3ba0f5a3a2",
      "in_reply_to_id": null,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "micro-nit: i would prefer `eviction_candidates`",
      "created_at": "2021-06-11T16:49:29Z",
      "updated_at": "2021-06-11T18:35:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650133285",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650133285"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 905,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650141548",
      "pull_request_review_id": 682042627,
      "id": 650141548,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDE0MTU0OA==",
      "diff_hunk": "@@ -894,40 +902,58 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n+    // Networks to protect: localhost, onion, I2P. In case of equal counts, earlier array members\n+    // have the first opportunity to recover unused protection slots from the previous iteration.\n+    struct Net { Network id; size_t count; bool is_local; };\n+    std::array<Net, 3> networks{{{/* localhost */ NET_MAX, 0, 1}, {NET_ONION, 0, 0}, {NET_I2P, 0, 0}}};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 56,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "42530190d82ee1692a546a8daae89e3ba0f5a3a2",
      "in_reply_to_id": null,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Maybe you can precise onion as \"torv3\" or \"tor\" ? \r\n\r\nI think even if Tor is the most well-known deployed onion routing you have multiple other existing onion routing constructions. In fact, I2P's garlic routing is widely similar to Tor's onion routing. Or [Sphinx](https://www.freehaven.net/anonbib/cache/DBLP:conf/sp/DanezisG09.pdf) as deployed on LN communication layer is also a format of onion. Pedantic point :)",
      "created_at": "2021-06-11T17:03:11Z",
      "updated_at": "2021-06-11T18:35:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650141548",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650141548"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 910,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650149599",
      "pull_request_review_id": 682063946,
      "id": 650149599,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDE0OTU5OQ==",
      "diff_hunk": "@@ -36,7 +32,7 @@ std::vector<NodeEvictionCandidate> GetRandomNodeEvictionCandidates(const int n_c\n             /* nKeyedNetGroup */ random_context.randrange(100),\n             /* prefer_evict */ random_context.randbool(),\n             /* m_is_local */ random_context.randbool(),\n-            /* m_is_onion */ random_context.randbool(),\n+            /* m_network */ static_cast<Network>(random_context.randrange(static_cast<int>(Network::NET_INTERNAL))),",
      "path": "src/test/net_peer_eviction_tests.cpp",
      "position": null,
      "original_position": 25,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "42530190d82ee1692a546a8daae89e3ba0f5a3a2",
      "in_reply_to_id": 650041974,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good point, looks like your suggestion with this might do it:\r\n```diff\r\n+++ b/src/test/net_peer_eviction_tests.cpp\r\n@@ -4,6 +4,7 @@\r\n #include <net.h>\r\n+#include <test/util/net.h>\r\n #include <test/util/setup_common.h>\r\n \r\n@@ -32,7 +33,7 @@ std::vector<NodeEvictionCandidate> GetRandomNodeEvictionCandidates(const int n_c\r\n-            /* m_network */ static_cast<Network>(random_context.randrange(static_cast<int>(Network::NET_INTERNAL))),\r\n+            /* m_network */ ALL_NETWORKS[random_context.randrange(ALL_NETWORKS.size())],\r\n\r\n+++ b/src/test/util/net.h\r\n@@ -68,7 +68,7 @@ constexpr ConnectionType ALL_CONNECTION_TYPES[]{\r\n-constexpr Network ALL_NETWORKS[]{\r\n+constexpr std::array ALL_NETWORKS{\r\n```\r\n",
      "created_at": "2021-06-11T17:17:22Z",
      "updated_at": "2021-06-11T17:19:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650149599",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650149599"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 35,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650164339",
      "pull_request_review_id": 682042627,
      "id": 650164339,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDE2NDMzOQ==",
      "diff_hunk": "@@ -894,40 +902,58 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n+    // Networks to protect: localhost, onion, I2P. In case of equal counts, earlier array members\n+    // have the first opportunity to recover unused protection slots from the previous iteration.\n+    struct Net { Network id; size_t count; bool is_local; };\n+    std::array<Net, 3> networks{{{/* localhost */ NET_MAX, 0, 1}, {NET_ONION, 0, 0}, {NET_I2P, 0, 0}}};\n+\n+    for (Net& n : networks) { // Count and store the number of eviction candidates per network.\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(),\n+                                [&n](const NodeEvictionCandidate& c) { return n.is_local ? c.m_is_local : c.m_network == n.id; });\n+    }\n+    // Sort `networks` by descending candidate count, to give networks having more candidates\n+    // the first opportunity to recover unused protection slots from the previous iteration.\n+    std::stable_sort(networks.begin(), networks.end(), [](Net a, Net b) { return a.count > b.count; });\n+\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size{initial_size / 2};\n+\n+    // Protect up to 25% of the candidates by disadvantaged network.",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 99,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "42530190d82ee1692a546a8daae89e3ba0f5a3a2",
      "in_reply_to_id": null,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "IIUC, in the worst-case scenario, at least 1 peer is protected among all the disadvantaged network, the one with the most candidates. \r\n\r\nI think that's an interesting property.",
      "created_at": "2021-06-11T17:43:22Z",
      "updated_at": "2021-06-11T18:35:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650164339",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650164339"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 929,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650167989",
      "pull_request_review_id": 682042627,
      "id": 650167989,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDE2Nzk4OQ==",
      "diff_hunk": "@@ -894,40 +902,58 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n+    // Networks to protect: localhost, onion, I2P. In case of equal counts, earlier array members\n+    // have the first opportunity to recover unused protection slots from the previous iteration.\n+    struct Net { Network id; size_t count; bool is_local; };\n+    std::array<Net, 3> networks{{{/* localhost */ NET_MAX, 0, 1}, {NET_ONION, 0, 0}, {NET_I2P, 0, 0}}};\n+\n+    for (Net& n : networks) { // Count and store the number of eviction candidates per network.\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(),\n+                                [&n](const NodeEvictionCandidate& c) { return n.is_local ? c.m_is_local : c.m_network == n.id; });\n+    }\n+    // Sort `networks` by descending candidate count, to give networks having more candidates\n+    // the first opportunity to recover unused protection slots from the previous iteration.\n+    std::stable_sort(networks.begin(), networks.end(), [](Net a, Net b) { return a.count > b.count; });\n+\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size{initial_size / 2};\n+\n+    // Protect up to 25% of the candidates by disadvantaged network.\n+    const size_t max_protect_by_network{total_protect_size / 2};\n+    size_t num_protected{0};\n+\n+    while (num_protected < max_protect_by_network) {\n+        const size_t remaining_to_protect{max_protect_by_network - num_protected};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 104,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "42530190d82ee1692a546a8daae89e3ba0f5a3a2",
      "in_reply_to_id": null,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: to reduce confusion among sets of eviction candidates, maybe called this variable `disadvantaged_to_protect\"\r\n\r\n`remaining_to_protect` is already used as another variable name at the end of this function.",
      "created_at": "2021-06-11T17:50:00Z",
      "updated_at": "2021-06-11T18:35:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650167989",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650167989"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 934,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650174352",
      "pull_request_review_id": 682042627,
      "id": 650174352,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDE3NDM1Mg==",
      "diff_hunk": "@@ -894,40 +902,58 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n+    // Networks to protect: localhost, onion, I2P. In case of equal counts, earlier array members\n+    // have the first opportunity to recover unused protection slots from the previous iteration.\n+    struct Net { Network id; size_t count; bool is_local; };\n+    std::array<Net, 3> networks{{{/* localhost */ NET_MAX, 0, 1}, {NET_ONION, 0, 0}, {NET_I2P, 0, 0}}};\n+\n+    for (Net& n : networks) { // Count and store the number of eviction candidates per network.\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(),\n+                                [&n](const NodeEvictionCandidate& c) { return n.is_local ? c.m_is_local : c.m_network == n.id; });\n+    }\n+    // Sort `networks` by descending candidate count, to give networks having more candidates\n+    // the first opportunity to recover unused protection slots from the previous iteration.\n+    std::stable_sort(networks.begin(), networks.end(), [](Net a, Net b) { return a.count > b.count; });",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 64,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "42530190d82ee1692a546a8daae89e3ba0f5a3a2",
      "in_reply_to_id": null,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think I would favor sorting network by ascending candidate count, otherwise I believe it would bias towards anonymity networks with abundant peers, decreasing our local diversity of anonymity network ?\r\n\r\nI think this point has been already discussed in this [thread](https://github.com/bitcoin/bitcoin/pull/21261#discussion_r647319655). I agree it's minor.",
      "created_at": "2021-06-11T18:01:07Z",
      "updated_at": "2021-06-11T18:35:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650174352",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650174352"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 918,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650190229",
      "pull_request_review_id": 682042627,
      "id": 650190229,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDE5MDIyOQ==",
      "diff_hunk": "@@ -894,40 +902,58 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n+    // Networks to protect: localhost, onion, I2P. In case of equal counts, earlier array members\n+    // have the first opportunity to recover unused protection slots from the previous iteration.\n+    struct Net { Network id; size_t count; bool is_local; };\n+    std::array<Net, 3> networks{{{/* localhost */ NET_MAX, 0, 1}, {NET_ONION, 0, 0}, {NET_I2P, 0, 0}}};\n+\n+    for (Net& n : networks) { // Count and store the number of eviction candidates per network.\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(),\n+                                [&n](const NodeEvictionCandidate& c) { return n.is_local ? c.m_is_local : c.m_network == n.id; });\n+    }\n+    // Sort `networks` by descending candidate count, to give networks having more candidates\n+    // the first opportunity to recover unused protection slots from the previous iteration.\n+    std::stable_sort(networks.begin(), networks.end(), [](Net a, Net b) { return a.count > b.count; });\n+\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size{initial_size / 2};\n+\n+    // Protect up to 25% of the candidates by disadvantaged network.\n+    const size_t max_protect_by_network{total_protect_size / 2};\n+    size_t num_protected{0};\n+\n+    while (num_protected < max_protect_by_network) {\n+        const size_t remaining_to_protect{max_protect_by_network - num_protected};\n+        const size_t protect_per_network{std::max(remaining_to_protect / networks.size(), static_cast<size_t>(1))};\n+        bool protected_at_least_one{false};\n+        for (const Net& n : networks) {\n+            if (n.count == 0) continue;\n+            const size_t before = candidates.size();\n+            EraseLastKElements(candidates, CompareNodeNetworkTime(n.is_local, n.id), protect_per_network,\n+                               [&n](const NodeEvictionCandidate& c) { return n.is_local ? c.m_is_local : c.m_network == n.id; });\n+            const size_t after = candidates.size();\n+            if (before > after) {\n+                protected_at_least_one = true;\n+                num_protected += before - after;\n+                if (num_protected >= max_protect_by_network) break;",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 116,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "42530190d82ee1692a546a8daae89e3ba0f5a3a2",
      "in_reply_to_id": null,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Following diff doesn't break `net_peer_eviction_tests`, is this an expected behavior ?\r\n\r\n```\r\n@@ -943,7 +943,7 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candid\r\n             if (before > after) {\r\n                 protected_at_least_one = true;\r\n                 num_protected += before - after;\r\n-                if (num_protected >= max_protect_by_network) break;\r\n+                if (num_protected == max_protect_by_network) break;\r\n             }\r\n         }\r\n         if (!protected_at_least_one) break;\r\n ```        ",
      "created_at": "2021-06-11T18:29:41Z",
      "updated_at": "2021-06-11T18:35:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650190229",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650190229"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 946,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650191749",
      "pull_request_review_id": 682042627,
      "id": 650191749,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDE5MTc0OQ==",
      "diff_hunk": "@@ -894,40 +902,58 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n+    // Networks to protect: localhost, onion, I2P. In case of equal counts, earlier array members\n+    // have the first opportunity to recover unused protection slots from the previous iteration.\n+    struct Net { Network id; size_t count; bool is_local; };\n+    std::array<Net, 3> networks{{{/* localhost */ NET_MAX, 0, 1}, {NET_ONION, 0, 0}, {NET_I2P, 0, 0}}};\n+\n+    for (Net& n : networks) { // Count and store the number of eviction candidates per network.\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(),\n+                                [&n](const NodeEvictionCandidate& c) { return n.is_local ? c.m_is_local : c.m_network == n.id; });\n+    }\n+    // Sort `networks` by descending candidate count, to give networks having more candidates\n+    // the first opportunity to recover unused protection slots from the previous iteration.\n+    std::stable_sort(networks.begin(), networks.end(), [](Net a, Net b) { return a.count > b.count; });\n+\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size{initial_size / 2};\n+\n+    // Protect up to 25% of the candidates by disadvantaged network.\n+    const size_t max_protect_by_network{total_protect_size / 2};\n+    size_t num_protected{0};\n+\n+    while (num_protected < max_protect_by_network) {\n+        const size_t remaining_to_protect{max_protect_by_network - num_protected};\n+        const size_t protect_per_network{std::max(remaining_to_protect / networks.size(), static_cast<size_t>(1))};\n+        bool protected_at_least_one{false};",
      "path": "src/net.cpp",
      "position": 120,
      "original_position": 106,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "42530190d82ee1692a546a8daae89e3ba0f5a3a2",
      "in_reply_to_id": null,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "What do you think about commenting the purpose of this variable ?\r\n\r\n\"If not more eviction candidates remain to protect among disadvantaged networks, ensure we exit cleanly\"",
      "created_at": "2021-06-11T18:32:23Z",
      "updated_at": "2021-06-11T18:35:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650191749",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650191749"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 944,
      "original_line": 944,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650414862",
      "pull_request_review_id": 682340479,
      "id": 650414862,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDQxNDg2Mg==",
      "diff_hunk": "@@ -894,40 +902,62 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n+    // Networks to protect: localhost, onion, I2P. In case of equal counts, earlier array members\n+    // have the first opportunity to recover unused protection slots from the previous iteration.\n+    struct Net { Network id; size_t count; bool is_local; };\n+    std::array<Net, 3> networks{{{/* localhost */ NET_MAX, 0, 1}, {NET_ONION, 0, 0}, {NET_I2P, 0, 0}}};\n+\n+    for (Net& n : networks) { // Count and store the number of eviction candidates per network.\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(),\n+                                [&n](const NodeEvictionCandidate& c) {\n+                                    return n.is_local ? c.m_is_local : c.m_network == n.id;\n+                                });\n+    }\n+    // Sort `networks` by descending candidate count, to give networks having more candidates\n+    // the first opportunity to recover unused protection slots from the previous iteration.\n+    std::stable_sort(networks.begin(), networks.end(), [](Net a, Net b) { return a.count > b.count; });\n+\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size{initial_size / 2};\n+\n+    // Protect up to 25% of the candidates by disadvantaged network.\n+    const size_t max_protect_by_network{total_protect_size / 2};\n+    size_t num_protected{0};\n+\n+    while (num_protected < max_protect_by_network) {\n+        const size_t remaining_to_protect{max_protect_by_network - num_protected};\n+        const size_t protect_per_network{std::max(remaining_to_protect / networks.size(), static_cast<size_t>(1))};\n+        bool protected_at_least_one{false};\n+        for (const Net& n : networks) {\n+            if (n.count == 0) continue;\n+            const size_t before = candidates.size();\n+            EraseLastKElements(candidates, CompareNodeNetworkTime(n.is_local, n.id), protect_per_network,\n+                               [&n](const NodeEvictionCandidate& c) {\n+                                   return n.is_local ? c.m_is_local : c.m_network == n.id;\n+                               });\n+            const size_t after = candidates.size();\n+            if (before > after) {\n+                protected_at_least_one = true;\n+                num_protected += before - after;\n+                if (num_protected >= max_protect_by_network) break;",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 120,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "22b1dae1e07326e9644cc0ffcb50196352f32a3d",
      "in_reply_to_id": 650032286,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Brackets and newlines added",
      "created_at": "2021-06-12T17:22:33Z",
      "updated_at": "2021-06-12T17:22:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650414862",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650414862"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 946,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650414880",
      "pull_request_review_id": 682340484,
      "id": 650414880,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDQxNDg4MA==",
      "diff_hunk": "@@ -36,7 +32,7 @@ std::vector<NodeEvictionCandidate> GetRandomNodeEvictionCandidates(const int n_c\n             /* nKeyedNetGroup */ random_context.randrange(100),\n             /* prefer_evict */ random_context.randbool(),\n             /* m_is_local */ random_context.randbool(),\n-            /* m_is_onion */ random_context.randbool(),\n+            /* m_network */ static_cast<Network>(random_context.randrange(static_cast<int>(Network::NET_INTERNAL))),",
      "path": "src/test/net_peer_eviction_tests.cpp",
      "position": null,
      "original_position": 25,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "42530190d82ee1692a546a8daae89e3ba0f5a3a2",
      "in_reply_to_id": 650041974,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2021-06-12T17:22:43Z",
      "updated_at": "2021-06-12T17:22:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650414880",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650414880"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 35,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650414897",
      "pull_request_review_id": 682340491,
      "id": 650414897,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDQxNDg5Nw==",
      "diff_hunk": "@@ -894,40 +902,58 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 51,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "42530190d82ee1692a546a8daae89e3ba0f5a3a2",
      "in_reply_to_id": 650133285,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "done",
      "created_at": "2021-06-12T17:22:48Z",
      "updated_at": "2021-06-12T17:22:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650414897",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650414897"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 905,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650414905",
      "pull_request_review_id": 682340500,
      "id": 650414905,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDQxNDkwNQ==",
      "diff_hunk": "@@ -894,40 +902,58 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n+    // Networks to protect: localhost, onion, I2P. In case of equal counts, earlier array members\n+    // have the first opportunity to recover unused protection slots from the previous iteration.\n+    struct Net { Network id; size_t count; bool is_local; };\n+    std::array<Net, 3> networks{{{/* localhost */ NET_MAX, 0, 1}, {NET_ONION, 0, 0}, {NET_I2P, 0, 0}}};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 56,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "42530190d82ee1692a546a8daae89e3ba0f5a3a2",
      "in_reply_to_id": 650141548,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "done",
      "created_at": "2021-06-12T17:22:58Z",
      "updated_at": "2021-06-12T17:22:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650414905",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650414905"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 910,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650414941",
      "pull_request_review_id": 682340511,
      "id": 650414941,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDQxNDk0MQ==",
      "diff_hunk": "@@ -894,40 +902,58 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n+    // Networks to protect: localhost, onion, I2P. In case of equal counts, earlier array members\n+    // have the first opportunity to recover unused protection slots from the previous iteration.\n+    struct Net { Network id; size_t count; bool is_local; };\n+    std::array<Net, 3> networks{{{/* localhost */ NET_MAX, 0, 1}, {NET_ONION, 0, 0}, {NET_I2P, 0, 0}}};\n+\n+    for (Net& n : networks) { // Count and store the number of eviction candidates per network.\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(),\n+                                [&n](const NodeEvictionCandidate& c) { return n.is_local ? c.m_is_local : c.m_network == n.id; });\n+    }\n+    // Sort `networks` by descending candidate count, to give networks having more candidates\n+    // the first opportunity to recover unused protection slots from the previous iteration.\n+    std::stable_sort(networks.begin(), networks.end(), [](Net a, Net b) { return a.count > b.count; });\n+\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size{initial_size / 2};\n+\n+    // Protect up to 25% of the candidates by disadvantaged network.",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 99,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "42530190d82ee1692a546a8daae89e3ba0f5a3a2",
      "in_reply_to_id": 650164339,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yes, if there are at least 4 eviction candidates. (Changed per your review feedback from the disadvantaged network with the most candidates to the one with the fewest.)",
      "created_at": "2021-06-12T17:23:11Z",
      "updated_at": "2021-06-12T17:23:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650414941",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650414941"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 929,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650414948",
      "pull_request_review_id": 682340517,
      "id": 650414948,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDQxNDk0OA==",
      "diff_hunk": "@@ -894,40 +902,58 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n+    // Networks to protect: localhost, onion, I2P. In case of equal counts, earlier array members\n+    // have the first opportunity to recover unused protection slots from the previous iteration.\n+    struct Net { Network id; size_t count; bool is_local; };\n+    std::array<Net, 3> networks{{{/* localhost */ NET_MAX, 0, 1}, {NET_ONION, 0, 0}, {NET_I2P, 0, 0}}};\n+\n+    for (Net& n : networks) { // Count and store the number of eviction candidates per network.\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(),\n+                                [&n](const NodeEvictionCandidate& c) { return n.is_local ? c.m_is_local : c.m_network == n.id; });\n+    }\n+    // Sort `networks` by descending candidate count, to give networks having more candidates\n+    // the first opportunity to recover unused protection slots from the previous iteration.\n+    std::stable_sort(networks.begin(), networks.end(), [](Net a, Net b) { return a.count > b.count; });\n+\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size{initial_size / 2};\n+\n+    // Protect up to 25% of the candidates by disadvantaged network.\n+    const size_t max_protect_by_network{total_protect_size / 2};\n+    size_t num_protected{0};\n+\n+    while (num_protected < max_protect_by_network) {\n+        const size_t remaining_to_protect{max_protect_by_network - num_protected};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 104,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "42530190d82ee1692a546a8daae89e3ba0f5a3a2",
      "in_reply_to_id": 650167989,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "done",
      "created_at": "2021-06-12T17:23:16Z",
      "updated_at": "2021-06-12T17:23:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650414948",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650414948"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 934,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650414986",
      "pull_request_review_id": 682340544,
      "id": 650414986,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDQxNDk4Ng==",
      "diff_hunk": "@@ -894,40 +902,58 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n+    // Networks to protect: localhost, onion, I2P. In case of equal counts, earlier array members\n+    // have the first opportunity to recover unused protection slots from the previous iteration.\n+    struct Net { Network id; size_t count; bool is_local; };\n+    std::array<Net, 3> networks{{{/* localhost */ NET_MAX, 0, 1}, {NET_ONION, 0, 0}, {NET_I2P, 0, 0}}};\n+\n+    for (Net& n : networks) { // Count and store the number of eviction candidates per network.\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(),\n+                                [&n](const NodeEvictionCandidate& c) { return n.is_local ? c.m_is_local : c.m_network == n.id; });\n+    }\n+    // Sort `networks` by descending candidate count, to give networks having more candidates\n+    // the first opportunity to recover unused protection slots from the previous iteration.\n+    std::stable_sort(networks.begin(), networks.end(), [](Net a, Net b) { return a.count > b.count; });",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 64,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "42530190d82ee1692a546a8daae89e3ba0f5a3a2",
      "in_reply_to_id": 650174352,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done. As the unit tests show, one peer can make a difference when the numbers are low, e.g. when -maxconnections has been reduced or only one candidate will be protected. ",
      "created_at": "2021-06-12T17:23:48Z",
      "updated_at": "2021-06-12T17:23:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650414986",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650414986"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 918,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650415002",
      "pull_request_review_id": 682340559,
      "id": 650415002,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDQxNTAwMg==",
      "diff_hunk": "@@ -894,40 +902,58 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n+    // Networks to protect: localhost, onion, I2P. In case of equal counts, earlier array members\n+    // have the first opportunity to recover unused protection slots from the previous iteration.\n+    struct Net { Network id; size_t count; bool is_local; };\n+    std::array<Net, 3> networks{{{/* localhost */ NET_MAX, 0, 1}, {NET_ONION, 0, 0}, {NET_I2P, 0, 0}}};\n+\n+    for (Net& n : networks) { // Count and store the number of eviction candidates per network.\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(),\n+                                [&n](const NodeEvictionCandidate& c) { return n.is_local ? c.m_is_local : c.m_network == n.id; });\n+    }\n+    // Sort `networks` by descending candidate count, to give networks having more candidates\n+    // the first opportunity to recover unused protection slots from the previous iteration.\n+    std::stable_sort(networks.begin(), networks.end(), [](Net a, Net b) { return a.count > b.count; });\n+\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size{initial_size / 2};\n+\n+    // Protect up to 25% of the candidates by disadvantaged network.\n+    const size_t max_protect_by_network{total_protect_size / 2};\n+    size_t num_protected{0};\n+\n+    while (num_protected < max_protect_by_network) {\n+        const size_t remaining_to_protect{max_protect_by_network - num_protected};\n+        const size_t protect_per_network{std::max(remaining_to_protect / networks.size(), static_cast<size_t>(1))};\n+        bool protected_at_least_one{false};",
      "path": "src/net.cpp",
      "position": 120,
      "original_position": 106,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "42530190d82ee1692a546a8daae89e3ba0f5a3a2",
      "in_reply_to_id": 650191749,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2021-06-12T17:24:16Z",
      "updated_at": "2021-06-12T17:24:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650415002",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650415002"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 944,
      "original_line": 944,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650416293",
      "pull_request_review_id": 682341347,
      "id": 650416293,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDQxNjI5Mw==",
      "diff_hunk": "@@ -894,40 +902,58 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n+    // Networks to protect: localhost, onion, I2P. In case of equal counts, earlier array members\n+    // have the first opportunity to recover unused protection slots from the previous iteration.\n+    struct Net { Network id; size_t count; bool is_local; };\n+    std::array<Net, 3> networks{{{/* localhost */ NET_MAX, 0, 1}, {NET_ONION, 0, 0}, {NET_I2P, 0, 0}}};\n+\n+    for (Net& n : networks) { // Count and store the number of eviction candidates per network.\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(),\n+                                [&n](const NodeEvictionCandidate& c) { return n.is_local ? c.m_is_local : c.m_network == n.id; });\n+    }\n+    // Sort `networks` by descending candidate count, to give networks having more candidates\n+    // the first opportunity to recover unused protection slots from the previous iteration.\n+    std::stable_sort(networks.begin(), networks.end(), [](Net a, Net b) { return a.count > b.count; });\n+\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size{initial_size / 2};\n+\n+    // Protect up to 25% of the candidates by disadvantaged network.\n+    const size_t max_protect_by_network{total_protect_size / 2};\n+    size_t num_protected{0};\n+\n+    while (num_protected < max_protect_by_network) {\n+        const size_t remaining_to_protect{max_protect_by_network - num_protected};\n+        const size_t protect_per_network{std::max(remaining_to_protect / networks.size(), static_cast<size_t>(1))};\n+        bool protected_at_least_one{false};\n+        for (const Net& n : networks) {\n+            if (n.count == 0) continue;\n+            const size_t before = candidates.size();\n+            EraseLastKElements(candidates, CompareNodeNetworkTime(n.is_local, n.id), protect_per_network,\n+                               [&n](const NodeEvictionCandidate& c) { return n.is_local ? c.m_is_local : c.m_network == n.id; });\n+            const size_t after = candidates.size();\n+            if (before > after) {\n+                protected_at_least_one = true;\n+                num_protected += before - after;\n+                if (num_protected >= max_protect_by_network) break;",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 116,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "42530190d82ee1692a546a8daae89e3ba0f5a3a2",
      "in_reply_to_id": 650190229,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks for checking this! Agree, the tests pass with this change:\r\n```diff\r\n-                if (num_protected >= max_protect_by_network) {\r\n+                assert(num_protected <= max_protect_by_network);\r\n+                if (num_protected == max_protect_by_network) {\r\n```\r\nI think it's expected behavior based on these lines:\r\n```cpp\r\n    while (num_protected < max_protect_by_network) {\r\n        const size_t disadvantaged_to_protect{max_protect_by_network - num_protected};\r\n        const size_t protect_per_network{std::max(disadvantaged_to_protect / networks.size(), static_cast<size_t>(1))};\r\n```\r\n\r\nEdit: This pull has seen several rewrites, so tomorrow I plan to re-verify the pertinence of each test and check for missing cases.",
      "created_at": "2021-06-12T17:37:49Z",
      "updated_at": "2021-06-13T08:50:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650416293",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650416293"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 946,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650553691",
      "pull_request_review_id": 682430070,
      "id": 650553691,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDU1MzY5MQ==",
      "diff_hunk": "@@ -36,7 +32,7 @@ std::vector<NodeEvictionCandidate> GetRandomNodeEvictionCandidates(const int n_c\n             /* nKeyedNetGroup */ random_context.randrange(100),\n             /* prefer_evict */ random_context.randbool(),\n             /* m_is_local */ random_context.randbool(),\n-            /* m_is_onion */ random_context.randbool(),\n+            /* m_network */ static_cast<Network>(random_context.randrange(static_cast<int>(Network::NET_INTERNAL))),",
      "path": "src/test/net_peer_eviction_tests.cpp",
      "position": null,
      "original_position": 25,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "42530190d82ee1692a546a8daae89e3ba0f5a3a2",
      "in_reply_to_id": 650041974,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Huh, the CI is barfing on this change. Strange.",
      "created_at": "2021-06-13T17:18:33Z",
      "updated_at": "2021-06-13T17:18:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650553691",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650553691"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 35,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650556232",
      "pull_request_review_id": 682431757,
      "id": 650556232,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDU1NjIzMg==",
      "diff_hunk": "@@ -36,7 +32,7 @@ std::vector<NodeEvictionCandidate> GetRandomNodeEvictionCandidates(const int n_c\n             /* nKeyedNetGroup */ random_context.randrange(100),\n             /* prefer_evict */ random_context.randbool(),\n             /* m_is_local */ random_context.randbool(),\n-            /* m_is_onion */ random_context.randbool(),\n+            /* m_network */ static_cast<Network>(random_context.randrange(static_cast<int>(Network::NET_INTERNAL))),",
      "path": "src/test/net_peer_eviction_tests.cpp",
      "position": null,
      "original_position": 25,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "42530190d82ee1692a546a8daae89e3ba0f5a3a2",
      "in_reply_to_id": 650041974,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This might be a compiler bug. I used `static constexpr auto ALL_FEE_ESTIMATE_HORIZONS = std::array{` to work around that.",
      "created_at": "2021-06-13T17:43:17Z",
      "updated_at": "2021-06-13T17:43:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650556232",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650556232"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 35,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650559654",
      "pull_request_review_id": 682433912,
      "id": 650559654,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDU1OTY1NA==",
      "diff_hunk": "@@ -36,7 +32,7 @@ std::vector<NodeEvictionCandidate> GetRandomNodeEvictionCandidates(const int n_c\n             /* nKeyedNetGroup */ random_context.randrange(100),\n             /* prefer_evict */ random_context.randbool(),\n             /* m_is_local */ random_context.randbool(),\n-            /* m_is_onion */ random_context.randbool(),\n+            /* m_network */ static_cast<Network>(random_context.randrange(static_cast<int>(Network::NET_INTERNAL))),",
      "path": "src/test/net_peer_eviction_tests.cpp",
      "position": null,
      "original_position": 25,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "42530190d82ee1692a546a8daae89e3ba0f5a3a2",
      "in_reply_to_id": 650041974,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks! Will try that.",
      "created_at": "2021-06-13T18:16:18Z",
      "updated_at": "2021-06-13T18:16:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650559654",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650559654"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 35,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650578603",
      "pull_request_review_id": 682445761,
      "id": 650578603,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDU3ODYwMw==",
      "diff_hunk": "@@ -36,7 +32,7 @@ std::vector<NodeEvictionCandidate> GetRandomNodeEvictionCandidates(const int n_c\n             /* nKeyedNetGroup */ random_context.randrange(100),\n             /* prefer_evict */ random_context.randbool(),\n             /* m_is_local */ random_context.randbool(),\n-            /* m_is_onion */ random_context.randbool(),\n+            /* m_network */ static_cast<Network>(random_context.randrange(static_cast<int>(Network::NET_INTERNAL))),",
      "path": "src/test/net_peer_eviction_tests.cpp",
      "position": null,
      "original_position": 25,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "42530190d82ee1692a546a8daae89e3ba0f5a3a2",
      "in_reply_to_id": 650041974,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It worked 👍",
      "created_at": "2021-06-13T21:17:39Z",
      "updated_at": "2021-06-13T21:17:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650578603",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650578603"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 35,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650818867",
      "pull_request_review_id": 682737970,
      "id": 650818867,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDgxODg2Nw==",
      "diff_hunk": "@@ -894,40 +903,71 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& eviction_candidates)\n {\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n+    // To favorise the diversity of our peer connections, reserve up to half of these protected\n+    // spots for Tor/onion, localhost and I2P peers, even if they're not longest uptime overall.\n+    // This helps protect these higher-latency peers that tend to be otherwise\n     // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    const size_t initial_size = eviction_candidates.size();\n+    const size_t total_protect_size{initial_size / 2};\n+\n+    // Disadvantaged networks to protect: I2P, localhost, Tor/onion. In case of equal counts, earlier\n+    // array members have first opportunity to recover unused slots from the previous iteration.\n+    struct Net { bool is_local; Network id; size_t count; };\n+    std::array<Net, 3> networks{{{0, NET_I2P, 0}, {/* localhost */ 1, NET_MAX, 0}, {0, NET_ONION, 0}}};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 96,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "a457f34e5039b75ee015b273028c3ee153656d5c",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: use `true` /  `false` for `bool`:\r\n\r\n```suggestion\r\n    std::array<Net, 3> networks{{{false, NET_I2P, 0}, {/* localhost */ true, NET_MAX, 0}, {false, NET_ONION, 0}}};\r\n```",
      "created_at": "2021-06-14T10:11:49Z",
      "updated_at": "2021-06-14T11:24:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650818867",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650818867"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 920,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650865137",
      "pull_request_review_id": 682800052,
      "id": 650865137,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDg2NTEzNw==",
      "diff_hunk": "@@ -894,40 +903,71 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& eviction_candidates)\n {\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n+    // To favorise the diversity of our peer connections, reserve up to half of these protected\n+    // spots for Tor/onion, localhost and I2P peers, even if they're not longest uptime overall.\n+    // This helps protect these higher-latency peers that tend to be otherwise\n     // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    const size_t initial_size = eviction_candidates.size();\n+    const size_t total_protect_size{initial_size / 2};\n+\n+    // Disadvantaged networks to protect: I2P, localhost, Tor/onion. In case of equal counts, earlier\n+    // array members have first opportunity to recover unused slots from the previous iteration.\n+    struct Net { bool is_local; Network id; size_t count; };\n+    std::array<Net, 3> networks{{{0, NET_I2P, 0}, {/* localhost */ 1, NET_MAX, 0}, {0, NET_ONION, 0}}};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 96,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "a457f34e5039b75ee015b273028c3ee153656d5c",
      "in_reply_to_id": 650818867,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yeah, I did this to keep the line length down as it's a standard conversion, but sure.",
      "created_at": "2021-06-14T11:29:32Z",
      "updated_at": "2021-06-14T11:29:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650865137",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650865137"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 920,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650869018",
      "pull_request_review_id": 682805251,
      "id": 650869018,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDg2OTAxOA==",
      "diff_hunk": "@@ -894,40 +902,58 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n+    // Networks to protect: localhost, onion, I2P. In case of equal counts, earlier array members\n+    // have the first opportunity to recover unused protection slots from the previous iteration.\n+    struct Net { Network id; size_t count; bool is_local; };\n+    std::array<Net, 3> networks{{{/* localhost */ NET_MAX, 0, 1}, {NET_ONION, 0, 0}, {NET_I2P, 0, 0}}};\n+\n+    for (Net& n : networks) { // Count and store the number of eviction candidates per network.\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(),\n+                                [&n](const NodeEvictionCandidate& c) { return n.is_local ? c.m_is_local : c.m_network == n.id; });\n+    }\n+    // Sort `networks` by descending candidate count, to give networks having more candidates\n+    // the first opportunity to recover unused protection slots from the previous iteration.\n+    std::stable_sort(networks.begin(), networks.end(), [](Net a, Net b) { return a.count > b.count; });\n+\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size{initial_size / 2};\n+\n+    // Protect up to 25% of the candidates by disadvantaged network.\n+    const size_t max_protect_by_network{total_protect_size / 2};\n+    size_t num_protected{0};\n+\n+    while (num_protected < max_protect_by_network) {\n+        const size_t remaining_to_protect{max_protect_by_network - num_protected};\n+        const size_t protect_per_network{std::max(remaining_to_protect / networks.size(), static_cast<size_t>(1))};\n+        bool protected_at_least_one{false};\n+        for (const Net& n : networks) {\n+            if (n.count == 0) continue;\n+            const size_t before = candidates.size();\n+            EraseLastKElements(candidates, CompareNodeNetworkTime(n.is_local, n.id), protect_per_network,\n+                               [&n](const NodeEvictionCandidate& c) { return n.is_local ? c.m_is_local : c.m_network == n.id; });\n+            const size_t after = candidates.size();\n+            if (before > after) {\n+                protected_at_least_one = true;\n+                num_protected += before - after;\n+                if (num_protected >= max_protect_by_network) break;",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 116,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "42530190d82ee1692a546a8daae89e3ba0f5a3a2",
      "in_reply_to_id": 650190229,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Given that `num_protected` is incremented with a non-constant number, that could be larger than `1`, I assume it could become larger than `max_protect_by_network` at some point. Thus `>=` for comparison instead of `==`.\r\n\r\nHow could replacing `>=` with `==` and an assert change anything? I think if it changes anything then it must be a trigger of the assert - if it was equal before, then behavior is unchanged (`>=` is the same as `==`) and if it was strictly larger, before we would have executed `break;` and after the change - triggered the assert.\r\n\r\nTo me that assert looks scary, even if some (non-obvious) arithmetic a few lines above mandates it will never be triggered. The code may be altered in the future which may change this. Also, even if it happens that `num_protected > max_protect_by_network`, then nothing really bad has happened - we protected some peers (more than we intended), the program can continue executing just fine.\r\n\r\n_(the code at the time I write this does not contain an assert (a457f34e5039b75ee015b273028c3ee153656d5c))_",
      "created_at": "2021-06-14T11:36:16Z",
      "updated_at": "2021-06-14T11:36:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650869018",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650869018"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 946,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650877124",
      "pull_request_review_id": 682816353,
      "id": 650877124,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDg3NzEyNA==",
      "diff_hunk": "@@ -894,40 +902,58 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& candidates)\n {\n+    // Networks to protect: localhost, onion, I2P. In case of equal counts, earlier array members\n+    // have the first opportunity to recover unused protection slots from the previous iteration.\n+    struct Net { Network id; size_t count; bool is_local; };\n+    std::array<Net, 3> networks{{{/* localhost */ NET_MAX, 0, 1}, {NET_ONION, 0, 0}, {NET_I2P, 0, 0}}};\n+\n+    for (Net& n : networks) { // Count and store the number of eviction candidates per network.\n+        n.count = std::count_if(candidates.cbegin(), candidates.cend(),\n+                                [&n](const NodeEvictionCandidate& c) { return n.is_local ? c.m_is_local : c.m_network == n.id; });\n+    }\n+    // Sort `networks` by descending candidate count, to give networks having more candidates\n+    // the first opportunity to recover unused protection slots from the previous iteration.\n+    std::stable_sort(networks.begin(), networks.end(), [](Net a, Net b) { return a.count > b.count; });\n+\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n-    // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    // To favorise the diversity of our peer connections, reserve up to half of\n+    // these protected spots for onion, localhost and I2P peers, even if they're\n+    // not longest uptime overall. This helps protect these higher-latency peers\n+    // that tend to be otherwise disadvantaged under our eviction criteria.\n+    const size_t initial_size = candidates.size();\n+    const size_t total_protect_size{initial_size / 2};\n+\n+    // Protect up to 25% of the candidates by disadvantaged network.\n+    const size_t max_protect_by_network{total_protect_size / 2};\n+    size_t num_protected{0};\n+\n+    while (num_protected < max_protect_by_network) {\n+        const size_t remaining_to_protect{max_protect_by_network - num_protected};\n+        const size_t protect_per_network{std::max(remaining_to_protect / networks.size(), static_cast<size_t>(1))};\n+        bool protected_at_least_one{false};\n+        for (const Net& n : networks) {\n+            if (n.count == 0) continue;\n+            const size_t before = candidates.size();\n+            EraseLastKElements(candidates, CompareNodeNetworkTime(n.is_local, n.id), protect_per_network,\n+                               [&n](const NodeEvictionCandidate& c) { return n.is_local ? c.m_is_local : c.m_network == n.id; });\n+            const size_t after = candidates.size();\n+            if (before > after) {\n+                protected_at_least_one = true;\n+                num_protected += before - after;\n+                if (num_protected >= max_protect_by_network) break;",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 116,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "42530190d82ee1692a546a8daae89e3ba0f5a3a2",
      "in_reply_to_id": 650190229,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Right, the assert was just for sanity testing (I wrote more tests but didn't find a way to hit the assert), no plan to add it. ",
      "created_at": "2021-06-14T11:50:25Z",
      "updated_at": "2021-06-14T11:50:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650877124",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650877124"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 946,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650885978",
      "pull_request_review_id": 682828264,
      "id": 650885978,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MDg4NTk3OA==",
      "diff_hunk": "@@ -894,40 +903,71 @@ static void EraseLastKElements(\n     elements.erase(std::remove_if(elements.end() - eraseSize, elements.end(), predicate), elements.end());\n }\n \n-void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& vEvictionCandidates)\n+void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& eviction_candidates)\n {\n     // Protect the half of the remaining nodes which have been connected the longest.\n     // This replicates the non-eviction implicit behavior, and precludes attacks that start later.\n-    // To favorise the diversity of our peer connections, reserve up to (half + 2) of\n-    // these protected spots for onion and localhost peers, if any, even if they're not\n-    // longest uptime overall. This helps protect tor peers, which tend to be otherwise\n+    // To favorise the diversity of our peer connections, reserve up to half of these protected\n+    // spots for Tor/onion, localhost and I2P peers, even if they're not longest uptime overall.\n+    // This helps protect these higher-latency peers that tend to be otherwise\n     // disadvantaged under our eviction criteria.\n-    const size_t initial_size = vEvictionCandidates.size();\n-    size_t total_protect_size = initial_size / 2;\n-    const size_t onion_protect_size = total_protect_size / 2;\n-\n-    if (onion_protect_size) {\n-        // Pick out up to 1/4 peers connected via our onion service, sorted by longest uptime.\n-        EraseLastKElements(vEvictionCandidates, CompareOnionTimeConnected, onion_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_onion; });\n-    }\n-\n-    const size_t localhost_min_protect_size{2};\n-    if (onion_protect_size >= localhost_min_protect_size) {\n-        // Allocate any remaining slots of the 1/4, or minimum 2 additional slots,\n-        // to localhost peers, sorted by longest uptime, as manually configured\n-        // hidden services not using `-bind=addr[:port]=onion` will not be detected\n-        // as inbound onion connections.\n-        const size_t remaining_tor_slots{onion_protect_size - (initial_size - vEvictionCandidates.size())};\n-        const size_t localhost_protect_size{std::max(remaining_tor_slots, localhost_min_protect_size)};\n-        EraseLastKElements(vEvictionCandidates, CompareLocalHostTimeConnected, localhost_protect_size,\n-                           [](const NodeEvictionCandidate& n) { return n.m_is_local; });\n+    const size_t initial_size = eviction_candidates.size();\n+    const size_t total_protect_size{initial_size / 2};\n+\n+    // Disadvantaged networks to protect: I2P, localhost, Tor/onion. In case of equal counts, earlier\n+    // array members have first opportunity to recover unused slots from the previous iteration.\n+    struct Net { bool is_local; Network id; size_t count; };\n+    std::array<Net, 3> networks{{{0, NET_I2P, 0}, {/* localhost */ 1, NET_MAX, 0}, {0, NET_ONION, 0}}};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 96,
      "commit_id": "1b1088d52fbff8b1c9438d6aa8c6edcbdd471457",
      "original_commit_id": "a457f34e5039b75ee015b273028c3ee153656d5c",
      "in_reply_to_id": 650818867,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2021-06-14T12:04:43Z",
      "updated_at": "2021-06-14T12:04:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21261#discussion_r650885978",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/650885978"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21261"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 920,
      "side": "RIGHT"
    }
  ]
}