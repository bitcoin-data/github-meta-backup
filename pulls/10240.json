{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240",
    "id": 116800026,
    "node_id": "MDExOlB1bGxSZXF1ZXN0MTE2ODAwMDI2",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/10240",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/10240.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/10240.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10240",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10240/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/4cbc21689c359fee67e877355c04f808b2f749d6",
    "number": 10240,
    "state": "closed",
    "locked": true,
    "maintainer_can_modify": false,
    "title": "Add HD wallet auto-restore functionality",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This PR ensures that we always check the keypool during SyncTransaction and, that the lookup window for HD restore is large enough (currently +20 keys).\r\nOnce the keypool size falls below the min gap limit (currently 20 keys) and the keypool can't be extended (locked wallet), the wallet then temporary pauses synchronisation.\r\n\r\n### unencrypted wallets\r\nFor unencrypted wallets, the key pool will always be topped up. During sync (SyncTransaction), we check for used keypool keys and mark all keys up to the matched key as used. Additionally we topup the keypool to ensure we not fall below the gap limit (20 keys).\r\n\r\n### encrypted wallets in non pruning mode\r\nSame as above, but, If we hit the gap limit with an encrypted wallet, we can't topup the keypool. In that case, we just pause the sync (not the node, only the wallet).\r\nOnce the user unlocks the wallet over `walletpassphrase`, we rescan down to the point where we have stopped previously to ensure we don't miss possible funds.\r\n\r\n### encrypted wallets in pruned mode\r\nSame as above, but, we also stop requesting and connecting blocks. The full node will \"pause\" in this case until the user did unlock his wallet (== topup, rescan, etc.).\r\n\r\nThis has a little bit of complexity and requires careful reviews.",
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "milestone": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/25",
      "html_url": "https://github.com/bitcoin/bitcoin/milestone/25",
      "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/25/labels",
      "id": 2174061,
      "node_id": "MDk6TWlsZXN0b25lMjE3NDA2MQ==",
      "number": 25,
      "state": "closed",
      "title": "0.15.0",
      "description": "",
      "creator": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "open_issues": 0,
      "closed_issues": 119,
      "created_at": "2016-12-04T13:31:14Z",
      "updated_at": "2020-04-28T13:15:17Z",
      "closed_at": "2017-10-12T19:32:58Z"
    },
    "active_lock_reason": "resolved",
    "created_at": "2017-04-20T15:30:35Z",
    "updated_at": "2021-09-08T11:44:01Z",
    "closed_at": "2017-07-14T21:22:53Z",
    "mergeable": false,
    "mergeable_state": "dirty",
    "merge_commit_sha": "4099db6c410649383a916480a68006fc92d1676d",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": false,
    "head": {
      "label": "jonasschnelli:2017/04/hd_rescan",
      "ref": "2017/04/hd_rescan",
      "sha": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "user": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 9264454,
        "node_id": "MDEwOlJlcG9zaXRvcnk5MjY0NDU0",
        "name": "bitcoin",
        "full_name": "jonasschnelli/bitcoin",
        "owner": {
          "login": "jonasschnelli",
          "id": 178464,
          "node_id": "MDQ6VXNlcjE3ODQ2NA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/jonasschnelli",
          "html_url": "https://github.com/jonasschnelli",
          "followers_url": "https://api.github.com/users/jonasschnelli/followers",
          "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
          "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
          "repos_url": "https://api.github.com/users/jonasschnelli/repos",
          "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/jonasschnelli/bitcoin",
        "fork": true,
        "url": "https://api.github.com/repos/jonasschnelli/bitcoin",
        "archive_url": "https://api.github.com/repos/jonasschnelli/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/jonasschnelli/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/jonasschnelli/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/jonasschnelli/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/jonasschnelli/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/jonasschnelli/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/jonasschnelli/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/jonasschnelli/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/jonasschnelli/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/jonasschnelli/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/jonasschnelli/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/jonasschnelli/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/jonasschnelli/bitcoin/events",
        "forks_url": "https://api.github.com/repos/jonasschnelli/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/jonasschnelli/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/jonasschnelli/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/jonasschnelli/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/jonasschnelli/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/jonasschnelli/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/jonasschnelli/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/jonasschnelli/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/jonasschnelli/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/jonasschnelli/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/jonasschnelli/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/jonasschnelli/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/jonasschnelli/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/jonasschnelli/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/jonasschnelli/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/jonasschnelli/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:jonasschnelli/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/jonasschnelli/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/jonasschnelli/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/jonasschnelli/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/jonasschnelli/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/jonasschnelli/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/jonasschnelli/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/jonasschnelli/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/jonasschnelli/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/jonasschnelli/bitcoin/hooks",
        "svn_url": "https://github.com/jonasschnelli/bitcoin",
        "homepage": "http://www.bitcoin.org",
        "language": "C++",
        "forks_count": 5,
        "stargazers_count": 10,
        "watchers_count": 10,
        "size": 194164,
        "default_branch": "master",
        "open_issues_count": 5,
        "is_template": false,
        "topics": [],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2022-08-07T18:33:53Z",
        "created_at": "2013-04-06T18:21:51Z",
        "updated_at": "2023-05-19T06:34:35Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "94e52273f30fc9f3f1a7b58778ed21781bb2a744",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 34324,
        "stargazers_count": 69818,
        "watchers_count": 69818,
        "size": 233879,
        "default_branch": "master",
        "open_issues_count": 627,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-06T22:42:00Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-06-06T22:16:48Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 477,
    "deletions": 63,
    "changed_files": 16,
    "commits": 11,
    "review_comments": 96,
    "comments": 9
  },
  "events": [
    {
      "event": "head_ref_force_pushed",
      "id": 1051123563,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MTA1MTEyMzU2Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1051123563",
      "actor": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-04-20T18:50:48Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 1051233294,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MTA1MTIzMzI5NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1051233294",
      "actor": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-04-20T19:59:46Z"
    },
    {
      "event": "labeled",
      "id": 1051237443,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDEwNTEyMzc0NDM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1051237443",
      "actor": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-04-20T20:02:24Z",
      "label": {
        "name": "Wallet",
        "color": "02d7e1"
      }
    },
    {
      "event": "commented",
      "id": 298399758,
      "node_id": "MDEyOklzc3VlQ29tbWVudDI5ODM5OTc1OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/298399758",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-05-01T18:46:02Z",
      "updated_at": "2017-05-01T18:46:02Z",
      "author_association": "MEMBER",
      "body": "I know there was discussion about this in IRC last week, but I didn't follow closely. Would it be better to review this PR now, or hold off for more changes?",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#issuecomment-298399758",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10240"
    },
    {
      "event": "commented",
      "id": 298630235,
      "node_id": "MDEyOklzc3VlQ29tbWVudDI5ODYzMDIzNQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/298630235",
      "actor": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-05-02T13:08:00Z",
      "updated_at": "2017-05-02T13:08:00Z",
      "author_association": "CONTRIBUTOR",
      "body": "I'm currently implementing the changes we discussed in last weeks RIC meeting. A review makes more sense after the overhaul.",
      "user": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#issuecomment-298630235",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10240"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 1067416582,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MTA2NzQxNjU4Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1067416582",
      "actor": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-05-03T15:07:58Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 1067422071,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MTA2NzQyMjA3MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1067422071",
      "actor": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-05-03T15:10:47Z"
    },
    {
      "event": "commented",
      "id": 298949058,
      "node_id": "MDEyOklzc3VlQ29tbWVudDI5ODk0OTA1OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/298949058",
      "actor": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-05-03T15:37:31Z",
      "updated_at": "2017-05-03T15:37:40Z",
      "author_association": "CONTRIBUTOR",
      "body": "Completely rewrote this PR. Keeping the WIP tag for now.\r\nThe current implementation takes care of encrypted and unencrypted wallets (also in conjunction with pruning).\r\n\r\n### unencrypted wallets\r\nFor unencrypted wallets, the key pool will always be topped up. During sync (SyncTransaction), we check for used keypool keys and mark all keys up to the matched key as used. Additionally we topup the keypool to ensure we not fall below the gap limit (20 keys).\r\n\r\n### encrypted wallets in non pruning mode\r\nSame as above, but, If we hit the gap limit with an encrypted wallet, we can't topup the keypool. In that case, we just pause the sync (not the node, only the wallet).\r\nOnce the user unlocks the wallet over `walletpassphrase`, we rescan down to the point where we have stopped previously to ensure we don't miss possible funds.\r\n\r\n### encrypted wallets in pruned mode\r\nSame as above, but, we also stop requesting and connecting blocks. The full node will \"pause\" in this case until the user did unlock his wallet (== topup, rescan, etc.).\r\n\r\nThis has a little bit of complexity and requires careful reviews.\r\nThanks for early feedback.\r\n",
      "user": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#issuecomment-298949058",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10240"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 1068420132,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MTA2ODQyMDEzMg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1068420132",
      "actor": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-05-04T06:54:41Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 1068569318,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MTA2ODU2OTMxOA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1068569318",
      "actor": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-05-04T09:08:13Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 1068803626,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MTA2ODgwMzYyNg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1068803626",
      "actor": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-05-04T12:13:35Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 1068856470,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MTA2ODg1NjQ3MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1068856470",
      "actor": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-05-04T12:49:15Z"
    },
    {
      "event": "renamed",
      "id": 1069171127,
      "node_id": "MDE3OlJlbmFtZWRUaXRsZUV2ZW50MTA2OTE3MTEyNw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1069171127",
      "actor": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-05-04T15:40:12Z",
      "rename": {
        "from": "[WIP] Add basic HD wallet restore functionality",
        "to": "Add basic HD wallet restore functionality"
      }
    },
    {
      "event": "commented",
      "id": 299226759,
      "node_id": "MDEyOklzc3VlQ29tbWVudDI5OTIyNjc1OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/299226759",
      "actor": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-05-04T15:48:50Z",
      "updated_at": "2017-05-04T15:48:50Z",
      "author_association": "CONTRIBUTOR",
      "body": "All tests are passing now.\r\nRemoved WIP tag.\r\nOverhauled PR description",
      "user": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#issuecomment-299226759",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10240"
    },
    {
      "event": "reviewed",
      "id": 36310520,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzMTA1MjA=",
      "url": null,
      "actor": null,
      "commit_id": "cada7263fa95dff17ec2bab3b3b081cfdec2ae8e",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "",
      "user": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#pullrequestreview-36310520",
      "submitted_at": "2017-05-04T15:53:35Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
    },
    {
      "event": "renamed",
      "id": 1069427918,
      "node_id": "MDE3OlJlbmFtZWRUaXRsZUV2ZW50MTA2OTQyNzkxOA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1069427918",
      "actor": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-05-04T18:19:06Z",
      "rename": {
        "from": "Add basic HD wallet restore functionality",
        "to": "Add HD wallet auto-restore functionality"
      }
    },
    {
      "event": "reviewed",
      "id": 36546706,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1NDY3MDY=",
      "url": null,
      "actor": null,
      "commit_id": "11cccadf1308976cd61de0a7286f2902e6d32426",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#pullrequestreview-36546706",
      "submitted_at": "2017-05-05T20:14:22Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
    },
    {
      "event": "milestoned",
      "id": 1078902745,
      "node_id": "MDE1Ok1pbGVzdG9uZWRFdmVudDEwNzg5MDI3NDU=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1078902745",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-05-11T19:53:45Z",
      "milestone": {
        "title": "0.15.0"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzowMDI0YjljN2VkY2M0YmE1NTdjMzllODk5NjQxOGMyY2QyY2RiNjU4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0024b9c7edcc4ba557c39e8996418c2cd2cdb658",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0024b9c7edcc4ba557c39e8996418c2cd2cdb658",
      "tree": {
        "sha": "a140e43ac961ad033a79da6440da25319c63c7a9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a140e43ac961ad033a79da6440da25319c63c7a9"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree a140e43ac961ad033a79da6440da25319c63c7a9\nparent 94e52273f30fc9f3f1a7b58778ed21781bb2a744\nauthor Jonas Schnelli <dev@jonasschnelli.ch> 1492691028 +0200\ncommitter Jonas Schnelli <dev@jonasschnelli.ch> 1494574732 +0200\n\n[MOVEONLY] move CAffectedKeysVisitor\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEyhopCNzi8TB0xizeHrd2uwPHki0FAlkVZowACgkQHrd2uwPH\nki2GnBAAuAz7Uwq4/bw4NM16D3d7QEp0xUvIRhaE/5PrxtrNlxhrGX5cIi/wBe8U\nmSRJ5ZkDko3HwCr2TxzSKl87Bwtfmc430T02/7Op+W8Uj25gtgES8vHpBlRLr/D9\nJ6XsdxW5zkvgpxCUW4Erkj4E8JsU7WucHma4xhKu9lxT4wBIJx86/0yVruL1oNte\nIRHGp5yKMGg4Pkeb12xoY4fYyrIipgTJaw5qVumi6IQLH18XFqfIQJLjloaouxfF\nK/ORpVWR7o23c0JH/4ZgPa9J5k9gBhlL/cHhy2EsHeMwEkChc1pNP1EoddL/jMVo\nmL2q0WDDWstqoLRwnBvOhKubHvll8Rv5qqwaltr6bJ/REPRs0kGBTH2T50urUNT1\nbg5gJP4oU2zJGnlC5K2ZSPTtCvKR4vUYK9BAMPqME/hmeXKpXQTOpTxaKjDNIOJj\nIZ1m4bQPkx7sM18oSinfgN2SQ380zI9a0BLfViiYHH49AgeSzJb9nR+zfcfwTsrO\nF+v/cMUtAWr6Zswv0TZ6mm9sKFn4KIk/fpdoLTOjRrYWV0/GNlzlsroJEqFkXomH\n1D/3p8xNKuLN8ZwmNhMOCLq8KRKva3trf8E68VaCrSHDk0xy5zEtsP917JvbyawU\nEpYM7msvXz5EwzbIASqMJzUyg27nxHuGvrinVafDE7BLO+QR+kc=\n=e/jD\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/94e52273f30fc9f3f1a7b58778ed21781bb2a744",
          "sha": "94e52273f30fc9f3f1a7b58778ed21781bb2a744",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/94e52273f30fc9f3f1a7b58778ed21781bb2a744"
        }
      ],
      "message": "[MOVEONLY] move CAffectedKeysVisitor",
      "committer": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2017-05-12T07:38:52Z"
      },
      "author": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2017-04-20T12:23:48Z"
      },
      "sha": "0024b9c7edcc4ba557c39e8996418c2cd2cdb658"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyYTIwM2I3M2ZkMmQ3YjAxNmNkNWY1NTk3NzEzNWExNWE5ODI0MTRk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2a203b73fd2d7b016cd5f55977135a15a982414d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/2a203b73fd2d7b016cd5f55977135a15a982414d",
      "tree": {
        "sha": "35ad1c42849485c787494b9fe2a4d43e75cc96d6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/35ad1c42849485c787494b9fe2a4d43e75cc96d6"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 35ad1c42849485c787494b9fe2a4d43e75cc96d6\nparent 0024b9c7edcc4ba557c39e8996418c2cd2cdb658\nauthor Jonas Schnelli <dev@jonasschnelli.ch> 1492695122 +0200\ncommitter Jonas Schnelli <dev@jonasschnelli.ch> 1494577538 +0200\n\nAdd basic HD wallet restore functionality\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEyhopCNzi8TB0xizeHrd2uwPHki0FAlkVcYMACgkQHrd2uwPH\nki06gw//VCWEeEhkm5iEyH8UGAgjHzL9lX0aSQgrlWvmbr+muvMJzidY+ddfu89W\nKbfKhA6ABZgw5k19gYf4u7jaQtq/XiRwAUXhzh901uihp1AXsBUPFkfLeYFk8+A1\nqI7zkM+/ZdUvbi7c6esFrC9Ndd9bSZXQ4bxthn7DbGh4qw5QajHJUVF22UkldqTo\nQ5B5FKpo5O+dW+4ENFNPjV66xczYlhmlTZ1f+K1/oFDiNSOMJRbCuta+8cZ3FgOR\nDpWt/GsEyAiXzMvMFqZBn4tKsBEHyH1jd7zAboLPXnOZyrgRvjK37m1pM0vsQcAz\nOQggoEteCbDtV/vjLkoc9EqoUn8bvotAKpD6R76jxUwUE7KrHc0jGhXxX1X+Tk4J\n+fIY7rz0gPO6KWq/wPsqyN1E3sykUQj9tlg6Dic8i1w6XNfDyuZ1BNnHIu3RXSNw\nKNRZa8uXEP5nDip6q03ZITVbICdTVluWDhk+1WaQNqrwQ/jOAEPkMzBjl/xIv7k5\nj5juNMbZ9BS0UZ6wPnE5ZjVCHEJAilvS9IygsBfFLCZAug4M4f+8Azjqg9Z/3edg\nUJElT7+YZA6hiXBWwKXvLfhv6XiIvINEL0TdcIa2D1Z/LQh88E5VMGBkUP1gxr45\nz90NUXaDSHqBGj7xlb+lLkM501F+Xb1W/x26aX5aeGXoch5TsPw=\n=9dFc\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0024b9c7edcc4ba557c39e8996418c2cd2cdb658",
          "sha": "0024b9c7edcc4ba557c39e8996418c2cd2cdb658",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/0024b9c7edcc4ba557c39e8996418c2cd2cdb658"
        }
      ],
      "message": "Add basic HD wallet restore functionality",
      "committer": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2017-05-12T08:25:38Z"
      },
      "author": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2017-04-20T13:32:02Z"
      },
      "sha": "2a203b73fd2d7b016cd5f55977135a15a982414d"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2OGQ2MDBiOGRhNjdmNTVlMzdlYjhiNGJlNDYyMTU0NTY0ZmU5OGFm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/68d600b8da67f55e37eb8b4be462154564fe98af",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/68d600b8da67f55e37eb8b4be462154564fe98af",
      "tree": {
        "sha": "3a83e136620fb539f303c7bf68f612f14b66120f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3a83e136620fb539f303c7bf68f612f14b66120f"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 3a83e136620fb539f303c7bf68f612f14b66120f\nparent 2a203b73fd2d7b016cd5f55977135a15a982414d\nauthor Jonas Schnelli <dev@jonasschnelli.ch> 1484069096 +0100\ncommitter Jonas Schnelli <dev@jonasschnelli.ch> 1494577544 +0200\n\nAdd option to pause block requests (is/setBlockRequestsPaused())\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEyhopCNzi8TB0xizeHrd2uwPHki0FAlkVcYgACgkQHrd2uwPH\nki2Qlw//ekt88iu7VQuLjoDoFg2O0BVTOWIa2lyYykO7w1TyGKbbN+LXI7L1EzpJ\nVYWLqecomSrJGezctdS3RTqUgWOop2Q3LnCyPorXbfM3oMd/GlEH1peV3u+Y7XwN\nffrnMYeOiPFPAlkz8EWztm9ba3FKTq+Ad4PHQ3ztNPPJDtE7bfJ1vCgn86x2e9Z+\nG+89hxL5onjnWdXrTg2jSpwak1zIOFPtRWxRzhpQA+hklnkmCcsz+yRw18P59kp8\nDNfskQjG5d5i0bKP5U4arOMFX419WnfrLdxUJYiI7ljbklIMu90jMh8ROMeWKY0+\nfhj/yXkxANI2r9YNtjizV5h41OAOjiyJEdnKc4m60im5CfoNgrzuQpPX9NCfdlSn\nIrxAp78+rSuaEFcGLvLJhPEMXLKHCEnNLIn/Yp2lpLE6L7rX5ta+53LU0E/eoNa6\nrZFIhkg+RsuWUYx8HMgcaI6aQyeUXTuToxgaWX5+4L4IXl9O7X+Wyo1z2ITWwOil\n2xO2VB/UtcsiqYIs1CdCJMMUQXaKE+HvF6gHUfsDaOqbWynQopoQ+rmlypt3c4YL\ncPy/uXntGGVaye1oFzPPLuofLgKRHO2jJzhafQVwGfoqXB4J9aViAS51AFcC94/i\nlrWyhGgDQ01jXMOCU/wiHlGOQB7SwPlnaEYvp1Xc2lgBhWjiX0g=\n=F7j3\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2a203b73fd2d7b016cd5f55977135a15a982414d",
          "sha": "2a203b73fd2d7b016cd5f55977135a15a982414d",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/2a203b73fd2d7b016cd5f55977135a15a982414d"
        }
      ],
      "message": "Add option to pause block requests (is/setBlockRequestsPaused())",
      "committer": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2017-05-12T08:25:44Z"
      },
      "author": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2017-01-10T17:24:56Z"
      },
      "sha": "68d600b8da67f55e37eb8b4be462154564fe98af"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxYTAyNzJhM2FmZDRmY2I5ZmEyZjViNDE5NmY5YTRiYTZiMzZmOWU4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1a0272a3afd4fcb9fa2f5b4196f9a4ba6b36f9e8",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/1a0272a3afd4fcb9fa2f5b4196f9a4ba6b36f9e8",
      "tree": {
        "sha": "93d5c96936e47f6a4799d1bf88751dba3a7e5515",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/93d5c96936e47f6a4799d1bf88751dba3a7e5515"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 93d5c96936e47f6a4799d1bf88751dba3a7e5515\nparent 68d600b8da67f55e37eb8b4be462154564fe98af\nauthor Jonas Schnelli <dev@jonasschnelli.ch> 1493815199 +0200\ncommitter Jonas Schnelli <dev@jonasschnelli.ch> 1494577544 +0200\n\nAdd option to pause tip updates (is/setTipUpdatesPaused())\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEyhopCNzi8TB0xizeHrd2uwPHki0FAlkVcYgACgkQHrd2uwPH\nki0YzQ//Y3XkycGwaUDOn4ymrNGgGcfJSvPRpIDYW8LjJmDsTj4BOq9uqioOXvDr\njNwDTFVMXathiUhzcVqmWBLco4+p+i0hH5yop/eZn+5JQdMF9CL7Dae8oeEyd69P\n/HT4gUifrBP7Man2Su/DQRnZ0R5740q1d3K2fCj6T31zYspdVi+KyZUGEKrs2Mps\ncH4A6x8RX/qaPQKxs92uRtDSJN42Gfef3Kd+lsrGGWacKk0xP3u/n3nTBXH407hT\n0BRS2UJyZXUuFGNvtNjPZgq8Yoj+Ah+g5RVNf73nDko8fQaXtB1eGI4njIP7uPzZ\nzFw9fbtJTTHha0aeY6ERnbGYeW/Wh5tk3p16SeEfdnjagLflZjm37hkd5Yu7YhXs\nmqz0uQPHI7cqypcyYWj7uc/R3qbQhgytlSaz1t6FrVOqbzOOccq6pWsUWZn0LGIT\npBE4cyiYT84cqT08PHE8d2Kn5q0ZWiyJyqkriNfx+bLvHFk/yrycMvldp1RZe2NK\nIbmNdb6w/bT0w9QW3h/PULscF2FQg56qG6aj88ZqjBgXu+r8n4mxvZQjs/FRR8DT\nTMgGTxGxoVmoqSAYynro5PiqbsJaKSeXDh/AxgNmHMTnyHJeaFeqUtg9F+NnB3wg\nB1otxag6odjYEW53SLKhlFRwnEo4Jj2vgy19xIikraluwfJlZsE=\n=A/j4\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/68d600b8da67f55e37eb8b4be462154564fe98af",
          "sha": "68d600b8da67f55e37eb8b4be462154564fe98af",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/68d600b8da67f55e37eb8b4be462154564fe98af"
        }
      ],
      "message": "Add option to pause tip updates (is/setTipUpdatesPaused())",
      "committer": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2017-05-12T08:25:44Z"
      },
      "author": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2017-05-03T12:39:59Z"
      },
      "sha": "1a0272a3afd4fcb9fa2f5b4196f9a4ba6b36f9e8"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1YTEwY2QzMzRhNzFiZTA2NGQyZTgyYmIyZDMzY2QzMWUzNjE3YmNk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5a10cd334a71be064d2e82bb2d33cd31e3617bcd",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5a10cd334a71be064d2e82bb2d33cd31e3617bcd",
      "tree": {
        "sha": "be98923b8fb15dd70beb3b5a9a065c6c517cd2a0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/be98923b8fb15dd70beb3b5a9a065c6c517cd2a0"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree be98923b8fb15dd70beb3b5a9a065c6c517cd2a0\nparent 1a0272a3afd4fcb9fa2f5b4196f9a4ba6b36f9e8\nauthor Jonas Schnelli <dev@jonasschnelli.ch> 1493743486 +0200\ncommitter Jonas Schnelli <dev@jonasschnelli.ch> 1494577544 +0200\n\nAdd request-halt flag to BlockConnected signal\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIyBAABCAAdFiEEyhopCNzi8TB0xizeHrd2uwPHki0FAlkVcYgACgkQHrd2uwPH\nki13XA/2OJgf9cqzIuwrlrrmGzqRfIggfby54HFzju4zqDrwcw+YBriVpzxLaiRD\njD86Ig39UMcgMjWRhZDT5xth9cwu6Y1VCnDFKoXKjGL4NMbXGdyJmZckjaUTJWMF\n2JRdCmn62M81Ir+1yZIsvngidC5gGnI4sEFu6/wcaBH9AfqKd0k5npvZoEMkHjfi\n5qPEwDH3VJhg7KywGWIawc/N6n1I7mFuzdhSViHu23MJeVFNWLKriqnEc/z7mhGu\nkTLwo/2AvwkKU8JBAqc+bJDYKAbR6de9MkrppkqaAPm254rpHFCpdT94CjbZy7n5\nMkDrg539R32B4SzmMlO661E55LjxrSQqsyDkTGHV7wbIGXDAZninyuSwblI59prw\nP9YkO0VpxWMrp1AgWJzR4d5stMWyXbRFKJa5I8sErYVxx4nCPkf7J9ywzETP52xZ\nZ6HHcL5/zxjuk9jpCUZzPPbjoQyTOGgSk7iWBMEnVXHJEfHhsn6MoEro+IcwhE5z\nDOTkwQjS2O9pAS9Y+mb9T3kFHgDCsyO7VPpbIJVqhPNFaIkuY+wvCgiPP7ul+F7J\nk4E39nqcwikSFTnCH4pcEeubucL7J1QCblfyWwlyg3FvaELJS6KFXxvC+BUAcPQg\nsheorVbK45lQahSK64cDZvXCaafsKIr9yl+B0RH/1qC4FGasuw==\n=hctz\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1a0272a3afd4fcb9fa2f5b4196f9a4ba6b36f9e8",
          "sha": "1a0272a3afd4fcb9fa2f5b4196f9a4ba6b36f9e8",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/1a0272a3afd4fcb9fa2f5b4196f9a4ba6b36f9e8"
        }
      ],
      "message": "Add request-halt flag to BlockConnected signal",
      "committer": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2017-05-12T08:25:44Z"
      },
      "author": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2017-05-02T16:44:46Z"
      },
      "sha": "5a10cd334a71be064d2e82bb2d33cd31e3617bcd"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1YjcwYTIyODllOTZmMGNlOGM0OTY3OGU2MTM4NDU1NzJkODIwM2Jj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5b70a2289e96f0ce8c49678e613845572d8203bc",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5b70a2289e96f0ce8c49678e613845572d8203bc",
      "tree": {
        "sha": "b7c43767a5d35ef165c0de9c29391a66a04b1171",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b7c43767a5d35ef165c0de9c29391a66a04b1171"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree b7c43767a5d35ef165c0de9c29391a66a04b1171\nparent 5a10cd334a71be064d2e82bb2d33cd31e3617bcd\nauthor Jonas Schnelli <dev@jonasschnelli.ch> 1493817447 +0200\ncommitter Jonas Schnelli <dev@jonasschnelli.ch> 1494577545 +0200\n\nWallet: allow to eventually pause verification if keypool requires more key to respect the gap limit\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEyhopCNzi8TB0xizeHrd2uwPHki0FAlkVcYkACgkQHrd2uwPH\nki0KuQ/8CjIbrAVvcM6Uc5a7QxXjvNaNEq/VnVyprV3VEO5cf09zcK2WnrNvFeny\nsNM0wEF0ULnZFsaDmw3I69xIxnkISTEJk2QxSejV6Pmxe2t4c78xjucwNYVZJO41\ntX5V1uGHreFZxI0pt6s9oxsPWLf/wGJwzK1gMPFdbr650GFBMkc676xbRqWqzSkq\nzPVc2SN+NVqSb4R7qeIoXi+FrlRwAqyjFmVC42R9Lt6mKU029YiyGzeL7Kr24sFb\nAYE5ZztoTW6ctymXw9K65bDdTS/c2PZ7NObNfoKxuOuYz5JUCRwVKq1uFajLnEYe\n15Az6Dh9D0NgHvle5x4x4dHUMSB/oCJQEv9WzILexgFg/OJWkg/Jef18UrPLq+XY\nkCZiZQXPwrAG//5FfL1JEU1wC5paOTJn6H4wqvINtXaPA39Gw6BKoP+dtOOGia3X\nybiAeMDsdoapdnJaeLaQneoUiUKce9lhOo2h8V8zBeE9mfNFQdJWisGsa8uUY22g\nbQaGDAt7lo+2DrcJ1gjO/BC+s+BUOcG2z//QkZi7BsUDU4peKS3oQKfBhVyAM/VP\n/IopZdTagGuJLIZ9dmW42bo9F6b/zbNeuVmoWGwM/pn4lYTyXU2Ml84iQ1RERq+y\nyube68+hmSsijdh/juZgJeifH7uJlbzWPsOJLLT8kruYgPt33ls=\n=Q4fs\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5a10cd334a71be064d2e82bb2d33cd31e3617bcd",
          "sha": "5a10cd334a71be064d2e82bb2d33cd31e3617bcd",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5a10cd334a71be064d2e82bb2d33cd31e3617bcd"
        }
      ],
      "message": "Wallet: allow to eventually pause verification if keypool requires more key to respect the gap limit",
      "committer": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2017-05-12T08:25:45Z"
      },
      "author": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2017-05-03T13:17:27Z"
      },
      "sha": "5b70a2289e96f0ce8c49678e613845572d8203bc"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyYThmMWY2ODU2ZjgyYmIxN2E5MmY2MWNjYTcwYzQyYWI3MDU0MTUw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2a8f1f6856f82bb17a92f61cca70c42ab7054150",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/2a8f1f6856f82bb17a92f61cca70c42ab7054150",
      "tree": {
        "sha": "d6edb1b2c36f764d01416a6d525d6e730c7d47cc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d6edb1b2c36f764d01416a6d525d6e730c7d47cc"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree d6edb1b2c36f764d01416a6d525d6e730c7d47cc\nparent 5b70a2289e96f0ce8c49678e613845572d8203bc\nauthor Jonas Schnelli <dev@jonasschnelli.ch> 1493820204 +0200\ncommitter Jonas Schnelli <dev@jonasschnelli.ch> 1494577545 +0200\n\nEnsure we pause wallet sync when the keypool requires extension\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEyhopCNzi8TB0xizeHrd2uwPHki0FAlkVcYkACgkQHrd2uwPH\nki3neRAArhYZvKZaOxkb3/QAwDy0FAp85RYc/TgBM/ijso5EkOEJvkDrcjCkVdeL\n5UOog4ucHYFLsHxLVx6svLM/U4lji+2CNOWFW+v4hWvXc2i0Vop8KhRBEVP4iFU4\nsYi7hg6o0535Itb9e3JCCu2okj8yBuuzLS0D+sh+yzQarBVzm3EY1rCNlMKa8O17\nFLCQbUt7UQCsIRhsg4bfYaM8JgKsuYTCLQuXwqVZy18edtNKIttBYOMLnp0unXjS\nexjCZs98p/I0uXxGRlmJg2ABkkCuxUdyFV/3aX92IzPe0xrT3ytZ3PdhCVHtdSTZ\njQTLk9HDNFJRucvapUOoalOF3SzQvBEMIEkSSt/4q8o6IRps0XFZ3tP2Z2Z7Gh2M\nNv1iK5EM48Em73Wff1pou7GPzxp/OnMwbNjJTkAp1porrFPMPOGiMUYA8C5aZtZB\naeTbCx43IO45XUgz0i+N50BHICsZv1e/rpDBFenHEhH3vXr5GG5BggXoKYaTczfx\nvP0D+FgjJfZ5sp1CXEVeiYJG6qQjFfMlZseeKRq2BZDp4e26tlvskU5bCSqSvtZh\nUCcVbqglIQ7GGrmo+EJN5n3y9tp9z9JJhFT9jWbrNw4HClpn6bQAFXDCHnbQCyhy\nHIqodwrdhUwMRDG/58Va3O/TUfrLAYlUiNhpl0HYmQJhUE2YLsE=\n=wimr\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5b70a2289e96f0ce8c49678e613845572d8203bc",
          "sha": "5b70a2289e96f0ce8c49678e613845572d8203bc",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5b70a2289e96f0ce8c49678e613845572d8203bc"
        }
      ],
      "message": "Ensure we pause wallet sync when the keypool requires extension",
      "committer": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2017-05-12T08:25:45Z"
      },
      "author": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2017-05-03T14:03:24Z"
      },
      "sha": "2a8f1f6856f82bb17a92f61cca70c42ab7054150"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzowOWRlMWNiZTVjMTU5ZjNiZTgyNjI0NTgwODcwYzRjOGUzYzM1YTJm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/09de1cbe5c159f3be82624580870c4c8e3c35a2f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/09de1cbe5c159f3be82624580870c4c8e3c35a2f",
      "tree": {
        "sha": "e4df181508c58035d0bd5649306bac4f9df0ef32",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e4df181508c58035d0bd5649306bac4f9df0ef32"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree e4df181508c58035d0bd5649306bac4f9df0ef32\nparent 2a8f1f6856f82bb17a92f61cca70c42ab7054150\nauthor Jonas Schnelli <dev@jonasschnelli.ch> 1493823111 +0200\ncommitter Jonas Schnelli <dev@jonasschnelli.ch> 1494577545 +0200\n\nExtend wallet hd restore functional test\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEyhopCNzi8TB0xizeHrd2uwPHki0FAlkVcYkACgkQHrd2uwPH\nki3IvA/+JMf6sfvrqibmxl4U4AQTIoTM+HlHqB6OJIpmLoi0hR+chVRsT2dk7+7V\nMAYvuJ3L3RWSl6CygSeTkOF0pbYwHAzxSj8DrGmvXGlRSq/CXXr+tA/1TVVOEMRc\nqdjtoLUBoB6xYuzJm3bEbJscfzUeQqiIg2UsZSUiG1MvmgW2TiVCuktQAJxHOWra\nu1MmncqGTJATuwvFoFCHxC+3c0kXCIWHneJOakOYayL+gbuk8O2/aQ1siK29excA\nJ2wHOeV3mB25sIh8BdqfD6tgV6pC0vbG0y47AArxxe1y0VZ3ZsLTGyNtftXEv7Bp\nK0BPO3blOCzox9rvG9ht1AGGZBrBjCRJg9HZ2aNQp5oDZuwakJOX3NpVX3WDjHS5\nJmfuW4hA/iVxPSlC1TM3UCLPc8Ew6lFpQip3Je2wumOD/gouAoReBCCwrd/TlPfy\nWkrFVU75FntkEaPwgCMlvx0UKYrXksWGeWw9PCgWT+IowZZ0qca5Gz4En4gSVTiU\nrd3NuQNZGsLwcLXbqTH/t5mCxABFfqK+4ZUub6FRzx2fB+lSuRX24OfweRRyEfQb\ndihu392D8I/aAWsIoDLQd4UKi2ez14WVxbHoFBkWbsSoDgTm2zGI3euHBDLvU4rC\nZsGqxSp9I0+9WFabOJ9fDl2W49pomqb/FI8JVkSKQO/UT8+p4jU=\n=X3+V\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2a8f1f6856f82bb17a92f61cca70c42ab7054150",
          "sha": "2a8f1f6856f82bb17a92f61cca70c42ab7054150",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/2a8f1f6856f82bb17a92f61cca70c42ab7054150"
        }
      ],
      "message": "Extend wallet hd restore functional test",
      "committer": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2017-05-12T08:25:45Z"
      },
      "author": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2017-05-03T14:51:51Z"
      },
      "sha": "09de1cbe5c159f3be82624580870c4c8e3c35a2f"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0NjA2MGMyNjFjMGVkYzdlZjEzYmJlZTc1NzU4MDFjOTg1MzRmNDQw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/46060c261c0edc7ef13bbee7575801c98534f440",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/46060c261c0edc7ef13bbee7575801c98534f440",
      "tree": {
        "sha": "c5502d262ec335f81d505d101fd7f42113a2cde9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c5502d262ec335f81d505d101fd7f42113a2cde9"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree c5502d262ec335f81d505d101fd7f42113a2cde9\nparent 09de1cbe5c159f3be82624580870c4c8e3c35a2f\nauthor Jonas Schnelli <dev@jonasschnelli.ch> 1493824026 +0200\ncommitter Jonas Schnelli <dev@jonasschnelli.ch> 1494577546 +0200\n\nMake sure we check the keypool min size during startup and when retriving a key\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEyhopCNzi8TB0xizeHrd2uwPHki0FAlkVcYoACgkQHrd2uwPH\nki1f8A//Y6xdJ1SSXBaKyIK1oJabHaS//DeWwZpukV6a/dD19j/6SriJ/ZtvbjvY\nghOI7BLQrzPc8IMcefoQmFaS86YzKAgbpzPjDV7KMCi1YmFGDIigzJ2hKhSyLbkp\nqSNWvqCrgmdRkg8iRrIgLYev8JMorDEV5fI12COf2Z/zhLC6gena3TmwgYEWT4IV\nnUVmc2L5UC+BwdNcEAYtZ2HZY/Mo5GNrAFmDTj23P1/d8dLlr348V5Bm3FQbexbH\nlqKQ/dJIz5RTOb6+NiBm6BGjtoWPt1H+OzT8yW0UGWRLZSrQxMlrQtJ/7yg8svdq\nImMBcSsoRgTO7RzNgMv7ZBiQU5HB1GNmBGkUiMj0zq/Kzook7ltKg1d4t18ho5RY\nq/+77vntIj6qAuWYgNQVGznDTtPvNAkhymMnkxOE175IgHwjX2xofUnB1jkNtbiB\nig0oYjHQPkVWzxzW1q7plCHjEXtc0nY3PUNidrzv4FfPlqbhcFArav9bjnlTRdDl\nxjXk/fjIhzITvSLVToHK56O2nE5r51jj4lf4Ue4O6KdAGcMpYV4uqNG+l5aioCVN\nW4+1pKl7btRsPAX/3SOSxsGeZAXynhCpZQkk7gKCnsuONMA+7bkcBcOR39r9Plo/\nlZU7za+zT/SSQgKTFCtptHFwfNXl0kixgjQ9SXo8axvKknSVLr4=\n=uoYy\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/09de1cbe5c159f3be82624580870c4c8e3c35a2f",
          "sha": "09de1cbe5c159f3be82624580870c4c8e3c35a2f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/09de1cbe5c159f3be82624580870c4c8e3c35a2f"
        }
      ],
      "message": "Make sure we check the keypool min size during startup and when retriving a key",
      "committer": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2017-05-12T08:25:46Z"
      },
      "author": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2017-05-03T15:07:06Z"
      },
      "sha": "46060c261c0edc7ef13bbee7575801c98534f440"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiZDllMWU4Zjg5ZTg0NzBlZWNiNTczMzhlMzU1YTk1MTlkYTY2Y2Q5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bd9e1e8f89e8470eecb57338e355a9519da66cd9",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/bd9e1e8f89e8470eecb57338e355a9519da66cd9",
      "tree": {
        "sha": "6aec9c152c732ca1991daed6504e07c3c0d16850",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6aec9c152c732ca1991daed6504e07c3c0d16850"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 6aec9c152c732ca1991daed6504e07c3c0d16850\nparent 46060c261c0edc7ef13bbee7575801c98534f440\nauthor Jonas Schnelli <dev@jonasschnelli.ch> 1493825196 +0200\ncommitter Jonas Schnelli <dev@jonasschnelli.ch> 1494577546 +0200\n\nSetSoftArg the keypool always to the minimum gap limit if HD is enabled\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEyhopCNzi8TB0xizeHrd2uwPHki0FAlkVcYoACgkQHrd2uwPH\nki1BTw/+NGsUP59SBt8AhUYDGalaoGhFi2KgTj5pYoiOtFkQklkJBsMFDGX3fOzZ\n2RveLHRUMWOh83pScCqCIJ6PQ3Nu7OkveYw7o6Q42ruZjBFxou9johxyxhbKKMN1\ndtC6Lu2yjrz45HTvEEEcqfy0MYIZ368KDflg2i2NA/2/pM7ZvN9latY9h/STuRZn\nFrvWSUheAxMtWaAliCdH0/D2CJcGXc4kiJeXiRzRbDWz1rvBw5St8VUo6uqXaFYs\nC4jEt4WSuTb31lOK5P5Aq3JsvjBdGwsLE/lQQDmahdrvtTJDlA72xXibnAkVtLzn\n0ACyqsb/efAXr1eEU5aQCL/NW+fsIfuIhhACn1xfjSWdv/wZZxtF0G85v1GkWuEG\n/GbWepJpKrHPZcOlGpfUvOaz1qE9OarYOgry6nxEHV+1zevBlqg+wLR8aoWCv5va\nzqxvYPQikG4X3D0nYA7HFuup+X9FMTJcB+ofANnqqh9EqjZujWiHOT/TAjfq+L/L\nWxKdMNmPqKuyoQgEar9u/D7TosgCz+3F6nsYPo2t/rI5O5Ph4wQAEqNyNsDWWRZg\n2k8haedDsJiATX8EC9wSLax7bKrbUAdHIrs4KAweonoCbMlym9ZWh7Sx5+pW4p5Y\nYtWnDY7wgW2A2Px6obZnBDP2ROG/dvadPn6OmACvzf07OBaNl0I=\n=rgYT\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/46060c261c0edc7ef13bbee7575801c98534f440",
          "sha": "46060c261c0edc7ef13bbee7575801c98534f440",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/46060c261c0edc7ef13bbee7575801c98534f440"
        }
      ],
      "message": "SetSoftArg the keypool always to the minimum gap limit if HD is enabled",
      "committer": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2017-05-12T08:25:46Z"
      },
      "author": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2017-05-03T15:26:36Z"
      },
      "sha": "bd9e1e8f89e8470eecb57338e355a9519da66cd9"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0Y2JjMjE2ODljMzU5ZmVlNjdlODc3MzU1YzA0ZjgwOGIyZjc0OWQ2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4cbc21689c359fee67e877355c04f808b2f749d6",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/4cbc21689c359fee67e877355c04f808b2f749d6",
      "tree": {
        "sha": "4b106e80501f1adc46089109e49261c5b5c0eee8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4b106e80501f1adc46089109e49261c5b5c0eee8"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 4b106e80501f1adc46089109e49261c5b5c0eee8\nparent bd9e1e8f89e8470eecb57338e355a9519da66cd9\nauthor Jonas Schnelli <dev@jonasschnelli.ch> 1493905644 +0200\ncommitter Jonas Schnelli <dev@jonasschnelli.ch> 1494577546 +0200\n\nMake sure we pause immediately if we receive a pause-request over the BlockConnected signal\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEyhopCNzi8TB0xizeHrd2uwPHki0FAlkVcYoACgkQHrd2uwPH\nki3aKRAAnBUScT4Jfs51ca4E3ScE0/LardJCsyerphOnnXAMXZF/ATkU4C7HiE3W\noh6sHZgX1xQLvKEgvjiQGOi8wvWnAW1zOWfXpg6lECoTKKMGTg4IXD0QJAlZ2vO4\nqswCD7+N/ExefbNp6V1sqIDdG2e5FtswsQhMO8Sx+brfS0brBDqOo//S3jX2HtRk\nL2miXGN17RC4zSTpLd1u4Ymo3m+SzgCzJeaQ6rbplDXaBVgoNKInYan0pKIK7XxZ\nBFSNxHn0RU5LPKLw3QTtVpxrKJqLrQJKS3KyUCrYXxCQOFuyd1KCxhd2mmfpq0gw\nOCdZWEQqqCowrc27vMNtCSriuFowNzmIbmKof21kgZReK9ZM2zpgUCPnqWncrB/8\nLf4exwY1VH1ujiPy8KUFNktX5AXM7V2cze3aWCtPgrSLtI4O07cSS4rOmQa/LoKM\nuVupV5eTX9zrixINuKd8q5TayEKW7nHsgXBhRFLm5pTAswQgu+HCzqPsE/d5Cuvu\n5wVGTjUAPVxDM9fEXnJVsqUsLQ0s8D40CB9NDSh3Wm4ETUDG0yqUe42hSdijN6Wq\nDE+xsayTQ6noGalkz8482M50nO41NKZ80DGomXQkRVnHdGw5Eq1psPaUIxBtsEo0\nZ785KhViSJzLrshayNQyNU6euuO8cSF2PXiCDyArC9imCp640E4=\n=n+Rc\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bd9e1e8f89e8470eecb57338e355a9519da66cd9",
          "sha": "bd9e1e8f89e8470eecb57338e355a9519da66cd9",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/bd9e1e8f89e8470eecb57338e355a9519da66cd9"
        }
      ],
      "message": "Make sure we pause immediately if we receive a pause-request over the BlockConnected signal",
      "committer": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2017-05-12T08:25:46Z"
      },
      "author": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2017-05-04T13:47:24Z"
      },
      "sha": "4cbc21689c359fee67e877355c04f808b2f749d6"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 1079582811,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MTA3OTU4MjgxMQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1079582811",
      "actor": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-05-12T08:29:10Z"
    },
    {
      "event": "commented",
      "id": 301017020,
      "node_id": "MDEyOklzc3VlQ29tbWVudDMwMTAxNzAyMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/301017020",
      "actor": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-05-12T08:29:55Z",
      "updated_at": "2017-05-12T08:30:01Z",
      "author_association": "CONTRIBUTOR",
      "body": "Needed rebase.\r\nAddressed most of @ryanofsky points.",
      "user": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#issuecomment-301017020",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10240"
    },
    {
      "event": "mentioned",
      "id": 1079583850,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MTA3OTU4Mzg1MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1079583850",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-05-12T08:29:55Z"
    },
    {
      "event": "subscribed",
      "id": 1079583851,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDEwNzk1ODM4NTE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1079583851",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-05-12T08:29:55Z"
    },
    {
      "event": "added_to_project",
      "id": 1087434361,
      "node_id": "MDE5OkFkZGVkVG9Qcm9qZWN0RXZlbnQxMDg3NDM0MzYx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1087434361",
      "actor": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-05-18T09:19:47Z",
      "project_card": {
        "id": 2970242,
        "url": "https://api.github.com/projects/columns/cards/2970242",
        "project_id": 481835,
        "project_url": "https://api.github.com/projects/481835",
        "column_name": "Blockers"
      }
    },
    {
      "event": "reviewed",
      "id": 42924281,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5MjQyODE=",
      "url": null,
      "actor": null,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#pullrequestreview-42924281",
      "submitted_at": "2017-06-08T19:16:48Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
    },
    {
      "event": "mentioned",
      "id": 1120359033,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MTEyMDM1OTAzMw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1120359033",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-06-12T22:06:24Z"
    },
    {
      "event": "subscribed",
      "id": 1120359034,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDExMjAzNTkwMzQ=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1120359034",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-06-12T22:06:24Z"
    },
    {
      "event": "commented",
      "id": 307952392,
      "node_id": "MDEyOklzc3VlQ29tbWVudDMwNzk1MjM5Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/307952392",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-06-12T22:31:12Z",
      "updated_at": "2017-06-12T22:31:12Z",
      "author_association": "MEMBER",
      "body": "Needs rebase.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#issuecomment-307952392",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10240"
    },
    {
      "event": "reviewed",
      "id": 43576283,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1NzYyODM=",
      "url": null,
      "actor": null,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Needs rebase. I've added a lot of mainly nitty comments. The most important thing to address is to make this compatible with multiwallet.",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#pullrequestreview-43576283",
      "submitted_at": "2017-06-12T23:06:01Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
    },
    {
      "event": "commented",
      "id": 308851475,
      "node_id": "MDEyOklzc3VlQ29tbWVudDMwODg1MTQ3NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/308851475",
      "actor": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-06-15T20:05:48Z",
      "updated_at": "2017-06-15T20:05:48Z",
      "author_association": "CONTRIBUTOR",
      "body": "Will begin code review post rebase.\r\n\r\nQuestion about the parameters--  Why 20? that is very small,  I am not aware of any reason to not have it be more like-- say-- 10,000.   With a large number the pause is hopefully seldom/never hit.  Electrum uses a very small number because its a single user wallet and has to send all these addresses for processing to a remote server.   In a commercial application getting reordering beyond 20 would be very easy. (e.g hand out 30 keys to different users and only the first one makes a payment). ",
      "user": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#issuecomment-308851475",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10240"
    },
    {
      "event": "commented",
      "id": 308856449,
      "node_id": "MDEyOklzc3VlQ29tbWVudDMwODg1NjQ0OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/308856449",
      "actor": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-06-15T20:27:07Z",
      "updated_at": "2017-06-15T20:27:07Z",
      "author_association": "CONTRIBUTOR",
      "body": "Agree that 20 is probably way to low.\r\nIt's just a single constant and I worry more about getting the PR on a level where everything works as expected. Changing the 20 to 1000 then is simple... once the PR is stable, we can also test performance better (maybe between 20 and 10k).",
      "user": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#issuecomment-308856449",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10240"
    },
    {
      "event": "removed_from_project",
      "id": 1153319955,
      "node_id": "MDIzOlJlbW92ZWRGcm9tUHJvamVjdEV2ZW50MTE1MzMxOTk1NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1153319955",
      "actor": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-07-06T19:03:33Z",
      "project_card": {
        "id": 2970242,
        "url": "https://api.github.com/projects/columns/cards/2970242",
        "project_id": 481835,
        "project_url": "https://api.github.com/projects/481835",
        "column_name": "Blockers"
      }
    },
    {
      "event": "reviewed",
      "id": 49644483,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2NDQ0ODM=",
      "url": null,
      "actor": null,
      "commit_id": "2a203b73fd2d7b016cd5f55977135a15a982414d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Some comments already.\r\n\r\nOverall question: why is any of this conditional on HD being enabled? I think we want to mark user and topup any key seen on the network at any time.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#pullrequestreview-49644483",
      "submitted_at": "2017-07-12T23:18:58Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
    },
    {
      "event": "added_to_project",
      "id": 1163169446,
      "node_id": "MDE5OkFkZGVkVG9Qcm9qZWN0RXZlbnQxMTYzMTY5NDQ2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1163169446",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-07-13T19:12:23Z",
      "project_card": {
        "id": 3770725,
        "url": "https://api.github.com/projects/columns/cards/3770725",
        "project_id": 481835,
        "project_url": "https://api.github.com/projects/481835",
        "column_name": "Blockers"
      }
    },
    {
      "event": "commented",
      "id": 315471237,
      "node_id": "MDEyOklzc3VlQ29tbWVudDMxNTQ3MTIzNw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/315471237",
      "actor": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-07-14T21:22:53Z",
      "updated_at": "2017-07-14T21:22:53Z",
      "author_association": "CONTRIBUTOR",
      "body": "Closing in favor of #10830",
      "user": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#issuecomment-315471237",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10240"
    },
    {
      "event": "closed",
      "id": 1164985398,
      "node_id": "MDExOkNsb3NlZEV2ZW50MTE2NDk4NTM5OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1164985398",
      "actor": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-07-14T21:22:53Z"
    },
    {
      "event": "removed_from_project",
      "id": 1166399557,
      "node_id": "MDIzOlJlbW92ZWRGcm9tUHJvamVjdEV2ZW50MTE2NjM5OTU1Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1166399557",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-07-17T13:12:50Z",
      "project_card": {
        "id": 3770725,
        "url": "https://api.github.com/projects/columns/cards/3770725",
        "project_id": 481835,
        "project_url": "https://api.github.com/projects/481835",
        "column_name": "Blockers"
      }
    },
    {
      "event": "locked",
      "id": 5271753768,
      "node_id": "LOE_lADOABII584NTFnbzwAAAAE6OJQo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5271753768",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-08T11:44:01Z",
      "lock_reason": "resolved"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114818486",
      "pull_request_review_id": 36310520,
      "id": 114818486,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNDgxODQ4Ng==",
      "diff_hunk": "@@ -970,6 +1004,22 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n         if (fExisted && !fUpdate) return false;\n         if (fExisted || IsMine(tx) || IsFromMe(tx))\n         {\n+            // check if we need to flag used keypool keys\n+            std::set<CKeyID> setKeyPool;\n+            GetAllReserveKeys(setKeyPool);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 61,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "cada7263fa95dff17ec2bab3b3b081cfdec2ae8e",
      "in_reply_to_id": null,
      "user": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I guess this is very inefficient and something like #10235 should allow to speed up things.",
      "created_at": "2017-05-04T15:53:27Z",
      "updated_at": "2017-05-12T08:29:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r114818486",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/114818486"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1009,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115032554",
      "pull_request_review_id": 36546706,
      "id": 115032554,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTAzMjU1NA==",
      "diff_hunk": "@@ -970,6 +1004,22 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n         if (fExisted && !fUpdate) return false;\n         if (fExisted || IsMine(tx) || IsFromMe(tx))\n         {\n+            // check if we need to flag used keypool keys\n+            std::set<CKeyID> setKeyPool;",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 60,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "11cccadf1308976cd61de0a7286f2902e6d32426",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add basic HD wallet restore functionality\"\r\n\r\nMaybe rename this variable. (It shadows CWallet::setKeyPool, which makes that variable more annoying to grep for.)",
      "created_at": "2017-05-05T16:03:34Z",
      "updated_at": "2017-06-08T16:48:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115032554",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115032554"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1008,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115037977",
      "pull_request_review_id": 36546706,
      "id": 115037977,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTAzNzk3Nw==",
      "diff_hunk": "@@ -970,6 +1004,22 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n         if (fExisted && !fUpdate) return false;\n         if (fExisted || IsMine(tx) || IsFromMe(tx))\n         {\n+            // check if we need to flag used keypool keys\n+            std::set<CKeyID> setKeyPool;\n+            GetAllReserveKeys(setKeyPool);\n+            // loop though all outputs\n+            BOOST_FOREACH(const CTxOut& txout, tx.vout) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 63,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "11cccadf1308976cd61de0a7286f2902e6d32426",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add basic HD wallet restore functionality\"\r\n\r\nMaybe avoid BOOST_FOREACH here and below.",
      "created_at": "2017-05-05T16:32:30Z",
      "updated_at": "2017-06-08T16:49:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115037977",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115037977"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1011,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115042948",
      "pull_request_review_id": 36546706,
      "id": 115042948,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA0Mjk0OA==",
      "diff_hunk": "@@ -3349,14 +3365,62 @@ void CReserveKey::ReturnKey()\n     vchPubKey = CPubKey();\n }\n \n+void CWallet::MarkReserveKeysAsUsed(const CKeyID& keyId)\n+{\n+    LOCK(cs_wallet);\n+    CWalletDB walletdb(*dbw);\n+    auto it = std::begin(setKeyPool);\n+\n+    bool foundInternal = false;\n+    int64_t foundIndex = -1;\n+    for (const int64_t& id : setKeyPool) {\n+        CKeyPool keypool;\n+        if (!walletdb.ReadPool(id, keypool))\n+            throw std::runtime_error(std::string(__func__) + \": read failed\");\n+\n+        if (keypool.vchPubKey.GetID() == keyId) {",
      "path": "src/wallet/wallet.cpp",
      "position": 253,
      "original_position": 40,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b5f9bc2c11d9793d3f7a3ffef5e0d881c8e60e6b",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add basic HD wallet restore functionality\"\r\n\r\nIt seems like this for-loop could be eliminated if you just changed GetAllReserveKeys to return `map<CKeyID, int64_t>` instead of `set<CKeyID>`. I think making this change would add less code than is written here.",
      "created_at": "2017-05-05T16:59:29Z",
      "updated_at": "2017-06-08T16:51:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115042948",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115042948"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3469,
      "original_line": 3469,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115043447",
      "pull_request_review_id": 36546706,
      "id": 115043447,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA0MzQ0Nw==",
      "diff_hunk": "@@ -3349,14 +3365,62 @@ void CReserveKey::ReturnKey()\n     vchPubKey = CPubKey();\n }\n \n+void CWallet::MarkReserveKeysAsUsed(const CKeyID& keyId)\n+{\n+    LOCK(cs_wallet);\n+    CWalletDB walletdb(*dbw);\n+    auto it = std::begin(setKeyPool);",
      "path": "src/wallet/wallet.cpp",
      "position": 244,
      "original_position": 31,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b5f9bc2c11d9793d3f7a3ffef5e0d881c8e60e6b",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add basic HD wallet restore functionality\"\r\n\r\nShould move this declaration closer to where it's actually used way below.",
      "created_at": "2017-05-05T17:01:52Z",
      "updated_at": "2017-06-08T16:51:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115043447",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115043447"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3460,
      "original_line": 3460,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115044224",
      "pull_request_review_id": 36546706,
      "id": 115044224,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA0NDIyNA==",
      "diff_hunk": "@@ -3349,14 +3365,62 @@ void CReserveKey::ReturnKey()\n     vchPubKey = CPubKey();\n }\n \n+void CWallet::MarkReserveKeysAsUsed(const CKeyID& keyId)\n+{\n+    LOCK(cs_wallet);\n+    CWalletDB walletdb(*dbw);\n+    auto it = std::begin(setKeyPool);\n+\n+    bool foundInternal = false;\n+    int64_t foundIndex = -1;\n+    for (const int64_t& id : setKeyPool) {\n+        CKeyPool keypool;\n+        if (!walletdb.ReadPool(id, keypool))\n+            throw std::runtime_error(std::string(__func__) + \": read failed\");\n+\n+        if (keypool.vchPubKey.GetID() == keyId) {\n+            foundInternal = keypool.fInternal;\n+            foundIndex = id;\n+            if (!keypool.fInternal) {\n+                SetAddressBook(keyId, \"\", \"receive\");\n+            }\n+            break;\n+        }\n+    }\n+\n+    // mark all keys up to the found key as used\n+    if (foundIndex >= 0) {\n+        while (it != std::end(setKeyPool)) {\n+            const int64_t& id = *(it);\n+            if (id <= foundIndex) {\n+                CKeyPool keypool;\n+                if (!walletdb.ReadPool(id, keypool))\n+                    throw std::runtime_error(std::string(__func__) + \": read failed\");\n+\n+                // only mark keys on the corresponding chain\n+                if (keypool.fInternal == foundInternal) {",
      "path": "src/wallet/wallet.cpp",
      "position": 273,
      "original_position": 60,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b5f9bc2c11d9793d3f7a3ffef5e0d881c8e60e6b",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add basic HD wallet restore functionality\"\r\n\r\nShouldn't it be an error if this condition is not true?",
      "created_at": "2017-05-05T17:05:46Z",
      "updated_at": "2017-06-08T16:49:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115044224",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115044224"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3489,
      "original_line": 3489,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115044903",
      "pull_request_review_id": 36546706,
      "id": 115044903,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA0NDkwMw==",
      "diff_hunk": "@@ -3349,14 +3365,62 @@ void CReserveKey::ReturnKey()\n     vchPubKey = CPubKey();\n }\n \n+void CWallet::MarkReserveKeysAsUsed(const CKeyID& keyId)\n+{\n+    LOCK(cs_wallet);\n+    CWalletDB walletdb(*dbw);\n+    auto it = std::begin(setKeyPool);\n+\n+    bool foundInternal = false;\n+    int64_t foundIndex = -1;\n+    for (const int64_t& id : setKeyPool) {\n+        CKeyPool keypool;\n+        if (!walletdb.ReadPool(id, keypool))\n+            throw std::runtime_error(std::string(__func__) + \": read failed\");\n+\n+        if (keypool.vchPubKey.GetID() == keyId) {\n+            foundInternal = keypool.fInternal;\n+            foundIndex = id;\n+            if (!keypool.fInternal) {\n+                SetAddressBook(keyId, \"\", \"receive\");\n+            }\n+            break;\n+        }\n+    }\n+\n+    // mark all keys up to the found key as used\n+    if (foundIndex >= 0) {\n+        while (it != std::end(setKeyPool)) {\n+            const int64_t& id = *(it);\n+            if (id <= foundIndex) {",
      "path": "src/wallet/wallet.cpp",
      "position": 267,
      "original_position": 54,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b5f9bc2c11d9793d3f7a3ffef5e0d881c8e60e6b",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add basic HD wallet restore functionality\"\r\n\r\nAs an simplification (and optimization), you can exit the loop if `id > foundIndex`, since `setKeyPool` is an ordered set.",
      "created_at": "2017-05-05T17:09:25Z",
      "updated_at": "2017-06-08T16:50:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115044903",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115044903"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3483,
      "original_line": 3483,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115049299",
      "pull_request_review_id": 36546706,
      "id": 115049299,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA0OTI5OQ==",
      "diff_hunk": "@@ -3725,6 +3789,19 @@ CWallet* CWallet::CreateWalletFromFile(const std::string walletFile)\n \n     RegisterValidationInterface(walletInstance);\n \n+    // HD Restore: Make sure we always have a reasonable keypool size if HD is enabled\n+    if (walletInstance->IsHDEnabled()) {\n+        if (walletInstance->IsCrypted()) {\n+            InitWarning(_(\"Your are using an encrypted HD wallet. In case you recover a HD wallet, you may miss incomming or outgoing funds.\"));",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 94,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b5f9bc2c11d9793d3f7a3ffef5e0d881c8e60e6b",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add basic HD wallet restore functionality\"\r\n\r\nPhrase \"In case you recover a HD wallet\" seems too vague to be meaningful. I might say something more detailed like, \"In the case where you just restored an old wallet.dat backup that was not topped-up with the most recently derived HD keys, transactions using those keys will not show up in the wallet, and funds that are available to spend may not appear. You can avoid this problem by either manually topping up your wallet keypool, or (less reliably) just leaving your wallet decrypted while it scans for relevant transactions.\"",
      "created_at": "2017-05-05T17:32:11Z",
      "updated_at": "2017-05-17T15:55:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115049299",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115049299"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3795,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115052129",
      "pull_request_review_id": 36546706,
      "id": 115052129,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA1MjEyOQ==",
      "diff_hunk": "@@ -3725,6 +3789,19 @@ CWallet* CWallet::CreateWalletFromFile(const std::string walletFile)\n \n     RegisterValidationInterface(walletInstance);\n \n+    // HD Restore: Make sure we always have a reasonable keypool size if HD is enabled\n+    if (walletInstance->IsHDEnabled()) {\n+        if (walletInstance->IsCrypted()) {\n+            InitWarning(_(\"Your are using an encrypted HD wallet. In case you recover a HD wallet, you may miss incomming or outgoing funds.\"));\n+        }\n+        else {\n+            if (GetArg(\"-keypool\", DEFAULT_KEYPOOL_SIZE) < HD_RESTORE_KEYPOOL_SIZE_MIN ) {\n+                InitWarning(_(\"Your keypool size is below the recommended limit for HD rescans. In case you recover a HD wallet, you may miss incomming or outgoing funds.\"));",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 98,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b5f9bc2c11d9793d3f7a3ffef5e0d881c8e60e6b",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add basic HD wallet restore functionality\"\r\n\r\nSince this is warning that the requested size is below the recommended limit, it would be good to mention what the recommended limit actually is. And again \"recover a HD wallet\" seems vague. I'd maybe write this as, \"Your keypool configured to store less than 20 keys. The recommended size is -keypool=100. Using a larger keypool will make it less likely that your wallet will be missing transactions and funds if it is restored from an old backup.\" (Substituting HD_RESTORE_KEYPOOL_SIZE_MIN and DEFAULT_KEYPOOL_SIZE for the 20 and 100 values.)",
      "created_at": "2017-05-05T17:46:36Z",
      "updated_at": "2017-05-17T15:55:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115052129",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115052129"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3799,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115055571",
      "pull_request_review_id": 36546706,
      "id": 115055571,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA1NTU3MQ==",
      "diff_hunk": "@@ -1002,6 +1002,22 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n         if (fExisted && !fUpdate) return false;\n         if (fExisted || IsMine(tx) || IsFromMe(tx))\n         {\n+            // check if we need to flag used keypool keys",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b5f9bc2c11d9793d3f7a3ffef5e0d881c8e60e6b",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add basic HD wallet restore functionality\"\r\n\r\nWould expand this comment. Maybe \"Check if any keys in the wallet keypool that were supposed to be unused have appeared in a new transaction. If so, remove those keys from the keypool. This can happen when restoring an old wallet backup that does not contain the mostly recently created transactions from newer versions of the wallet.\"",
      "created_at": "2017-05-05T18:03:36Z",
      "updated_at": "2017-06-08T16:46:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115055571",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115055571"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1005,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115060607",
      "pull_request_review_id": 36546706,
      "id": 115060607,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA2MDYwNw==",
      "diff_hunk": "@@ -1182,6 +1181,7 @@ void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const\n     }\n     for (size_t i = 0; i < pblock->vtx.size(); i++) {\n         SyncTransaction(pblock->vtx[i], pindex, i);\n+void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const CBlockIndex *pindex, const std::vector<CTransactionRef>& vtxConflicted, bool &requestPause) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 12,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "5e672d36d922a780de86bc0ca64e220d758ab14c",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add request-halt flag to BlockConnected signal\".\r\n\r\nCompile error here (line needs to be moved up)\r\n\r\n",
      "created_at": "2017-05-05T18:28:33Z",
      "updated_at": "2017-05-12T08:29:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115060607",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115060607"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1177,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115061522",
      "pull_request_review_id": 36546706,
      "id": 115061522,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA2MTUyMg==",
      "diff_hunk": "@@ -1163,33 +1164,51 @@ void CWallet::SyncTransaction(const CTransactionRef& ptx, const CBlockIndex *pin\n }\n \n void CWallet::TransactionAddedToMempool(const CTransactionRef& ptx) {\n-    LOCK2(cs_main, cs_wallet);\n-    SyncTransaction(ptx);\n-}\n+    if (fSyncPausedUntilKeypoolExt) return;\n \n-    LOCK2(cs_main, cs_wallet);\n-    // TODO: Temporarily ensure that mempool removals are notified before\n-    // connected transactions.  This shouldn't matter, but the abandoned\n-    // state of transactions in our wallet is currently cleared when we\n-    // receive another notification and there is a race condition where\n-    // notification of a connected conflict might cause an outside process\n-    // to abandon a transaction and then have it inadvertently cleared by\n-    // the notification that the conflicted transaction was evicted.\n-\n-    for (const CTransactionRef& ptx : vtxConflicted) {\n+    {\n+        LOCK2(cs_main, cs_wallet);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 28,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b9a95b08e587c722c0b0bb15adf805ba42584d9c",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Wallet: allow to eventually pause verification if keypool requires\"\r\n\r\nNo need to add the {} and extra indentation here in TransactionAddedToMempool. (It throws off the github diff and makes the other changes harder to follow).",
      "created_at": "2017-05-05T18:33:21Z",
      "updated_at": "2017-05-12T08:29:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115061522",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115061522"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1170,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115061963",
      "pull_request_review_id": 36546706,
      "id": 115061963,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA2MTk2Mw==",
      "diff_hunk": "@@ -1163,33 +1164,51 @@ void CWallet::SyncTransaction(const CTransactionRef& ptx, const CBlockIndex *pin\n }\n \n void CWallet::TransactionAddedToMempool(const CTransactionRef& ptx) {\n-    LOCK2(cs_main, cs_wallet);\n-    SyncTransaction(ptx);\n-}\n+    if (fSyncPausedUntilKeypoolExt) return;\n \n-    LOCK2(cs_main, cs_wallet);\n-    // TODO: Temporarily ensure that mempool removals are notified before\n-    // connected transactions.  This shouldn't matter, but the abandoned\n-    // state of transactions in our wallet is currently cleared when we\n-    // receive another notification and there is a race condition where\n-    // notification of a connected conflict might cause an outside process\n-    // to abandon a transaction and then have it inadvertently cleared by\n-    // the notification that the conflicted transaction was evicted.\n-\n-    for (const CTransactionRef& ptx : vtxConflicted) {\n+    {\n+        LOCK2(cs_main, cs_wallet);\n         SyncTransaction(ptx);\n     }\n-    for (size_t i = 0; i < pblock->vtx.size(); i++) {\n-        SyncTransaction(pblock->vtx[i], pindex, i);\n+}\n+\n void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const CBlockIndex *pindex, const std::vector<CTransactionRef>& vtxConflicted, bool &requestPause) {\n+    if (fSyncPausedUntilKeypoolExt) {\n+        requestPause = true;\n+        return;\n+    }\n+\n+    {\n+        LOCK2(cs_main, cs_wallet);\n+        // TODO: Temporarily ensure that mempool removals are notified before\n+        // connected transactions.  This shouldn't matter, but the abandoned\n+        // state of transactions in our wallet is currently cleared when we\n+        // receive another notification and there is a race condition where\n+        // notification of a connected conflict might cause an outside process\n+        // to abandon a transaction and then have it inadvertently cleared by\n+        // the notification that the conflicted transaction was evicted.\n+\n+        for (const CTransactionRef& ptx : vtxConflicted) {\n+            SyncTransaction(ptx);\n+        }\n+        for (size_t i = 0; i < pblock->vtx.size(); i++) {\n+            SyncTransaction(pblock->vtx[i], pindex, i);\n+        }\n+        if (fSyncPausedUntilKeypoolExt) {\n+            requestPause = true;\n+        }\n     }\n }\n \n void CWallet::BlockDisconnected(const std::shared_ptr<const CBlock>& pblock) {\n-    LOCK2(cs_main, cs_wallet);\n+    if (fSyncPausedUntilKeypoolExt) return;\n \n-    for (const CTransactionRef& ptx : pblock->vtx) {\n-        SyncTransaction(ptx);\n+    {\n+        LOCK2(cs_main, cs_wallet);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 70,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b9a95b08e587c722c0b0bb15adf805ba42584d9c",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Wallet: allow to eventually pause verification if keypool requires\"\r\n\r\nAgain unnecessary {} and indentation make the diff messy here in BlockDisconnected",
      "created_at": "2017-05-05T18:35:26Z",
      "updated_at": "2017-05-12T08:29:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115061963",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115061963"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1207,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115062815",
      "pull_request_review_id": 36546706,
      "id": 115062815,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA2MjgxNQ==",
      "diff_hunk": "@@ -1106,6 +1108,9 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n        caller must ensure the current wallet version is correct before calling\n        this function). */\n     bool SetHDMasterKey(const CPubKey& key);\n+\n+    bool IsSyncPausedUntilKeypoolExt() { return fSyncPausedUntilKeypoolExt; }",
      "path": "src/wallet/wallet.h",
      "position": null,
      "original_position": 21,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b9a95b08e587c722c0b0bb15adf805ba42584d9c",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Wallet: allow to eventually pause verification if keypool requires\"\r\n\r\nThese functions are never called anywhere, and appear to be deleted in the next commit. Would remove them from this commit.",
      "created_at": "2017-05-05T18:39:39Z",
      "updated_at": "2017-05-12T08:29:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115062815",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115062815"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1112,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115063131",
      "pull_request_review_id": 36546706,
      "id": 115063131,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA2MzEzMQ==",
      "diff_hunk": "@@ -3409,6 +3428,7 @@ void CWallet::MarkReserveKeysAsUsed(const CKeyID& keyId)\n     }\n \n     if (IsHDEnabled() && !TopUpKeyPool()) {\n+        fSyncPausedUntilKeypoolExt = true;\n         LogPrintf(\"%s: Topping up keypool failed (locked wallet)\\n\", __func__);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 83,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b9a95b08e587c722c0b0bb15adf805ba42584d9c",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Wallet: allow to eventually pause verification if keypool requires\"\r\n\r\nWould update the printf to say this is pausing downloads / transaction processing.",
      "created_at": "2017-05-05T18:41:29Z",
      "updated_at": "2017-05-12T08:29:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115063131",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115063131"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3432,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115063363",
      "pull_request_review_id": 36546706,
      "id": 115063363,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA2MzM2Mw==",
      "diff_hunk": "@@ -652,6 +652,7 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n     static std::atomic<bool> fFlushScheduled;\n     std::atomic<bool> fAbortRescan;\n     std::atomic<bool> fScanningWallet;\n+    std::atomic<bool> fSyncPausedUntilKeypoolExt;",
      "path": "src/wallet/wallet.h",
      "position": null,
      "original_position": 4,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b9a95b08e587c722c0b0bb15adf805ba42584d9c",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Wallet: allow to eventually pause verification if keypool requires\"\r\n\r\nThis variable should be better documented. I think you could basically take the text from your PR description and paste it here.",
      "created_at": "2017-05-05T18:42:46Z",
      "updated_at": "2017-05-12T08:29:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115063363",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115063363"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 664,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115064943",
      "pull_request_review_id": 36546706,
      "id": 115064943,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA2NDk0Mw==",
      "diff_hunk": "@@ -1163,33 +1164,51 @@ void CWallet::SyncTransaction(const CTransactionRef& ptx, const CBlockIndex *pin\n }\n \n void CWallet::TransactionAddedToMempool(const CTransactionRef& ptx) {\n-    LOCK2(cs_main, cs_wallet);\n-    SyncTransaction(ptx);\n-}\n+    if (fSyncPausedUntilKeypoolExt) return;\n \n-    LOCK2(cs_main, cs_wallet);\n-    // TODO: Temporarily ensure that mempool removals are notified before\n-    // connected transactions.  This shouldn't matter, but the abandoned\n-    // state of transactions in our wallet is currently cleared when we\n-    // receive another notification and there is a race condition where\n-    // notification of a connected conflict might cause an outside process\n-    // to abandon a transaction and then have it inadvertently cleared by\n-    // the notification that the conflicted transaction was evicted.\n-\n-    for (const CTransactionRef& ptx : vtxConflicted) {\n+    {\n+        LOCK2(cs_main, cs_wallet);\n         SyncTransaction(ptx);\n     }\n-    for (size_t i = 0; i < pblock->vtx.size(); i++) {\n-        SyncTransaction(pblock->vtx[i], pindex, i);\n+}\n+\n void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const CBlockIndex *pindex, const std::vector<CTransactionRef>& vtxConflicted, bool &requestPause) {\n+    if (fSyncPausedUntilKeypoolExt) {\n+        requestPause = true;\n+        return;\n+    }\n+\n+    {\n+        LOCK2(cs_main, cs_wallet);\n+        // TODO: Temporarily ensure that mempool removals are notified before\n+        // connected transactions.  This shouldn't matter, but the abandoned\n+        // state of transactions in our wallet is currently cleared when we\n+        // receive another notification and there is a race condition where\n+        // notification of a connected conflict might cause an outside process\n+        // to abandon a transaction and then have it inadvertently cleared by\n+        // the notification that the conflicted transaction was evicted.\n+\n+        for (const CTransactionRef& ptx : vtxConflicted) {\n+            SyncTransaction(ptx);\n+        }\n+        for (size_t i = 0; i < pblock->vtx.size(); i++) {\n+            SyncTransaction(pblock->vtx[i], pindex, i);\n+        }\n+        if (fSyncPausedUntilKeypoolExt) {\n+            requestPause = true;",
      "path": "src/wallet/wallet.cpp",
      "position": 128,
      "original_position": 58,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b9a95b08e587c722c0b0bb15adf805ba42584d9c",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add request-halt flag to BlockConnected signal\".\r\n\r\nWhat's the advantage of requesting a pause in this delayed and indirect way via BlockConnected instead of immediately setting `setBlockRequestsPaused(true); setTipUpdatesPaused(true);` when the keypool fails to top up in `MarkReserveKeysAsUsed()`? The indirect approach seems to add a lot of complexity.\r\n\r\n\r\n",
      "created_at": "2017-05-05T18:50:43Z",
      "updated_at": "2017-05-12T08:29:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115064943",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115064943"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1200,
      "original_line": 1200,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115065542",
      "pull_request_review_id": 36546706,
      "id": 115065542,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA2NTU0Mg==",
      "diff_hunk": "@@ -2533,6 +2533,14 @@ bool ActivateBestChain(CValidationState &state, const CChainParams& chainparams,\n             for (const PerBlockConnectTrace& trace : connectTrace.GetBlocksConnected()) {\n                 assert(trace.pblock && trace.pindex);\n                 GetMainSignals().BlockConnected(trace.pblock, trace.pindex, *trace.conflictedTxs, requestPause);\n+                if (requestPause) {",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "8ac56f8ebddb22e9281c4a7dab21939da18a543b",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Ensure we pause wallet sync when the keypool requires extension\"\r\n\r\nThis diff logically seems like it should be part of the \"Add request-halt flag to BlockConnected signal\" commit. Moving it there would make the commit history easier to understand.",
      "created_at": "2017-05-05T18:54:04Z",
      "updated_at": "2017-05-12T08:29:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115065542",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115065542"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2536,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115065830",
      "pull_request_review_id": 36546706,
      "id": 115065830,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA2NTgzMA==",
      "diff_hunk": "@@ -4316,6 +4324,7 @@ bool isBlockRequestsPaused() {\n }\n \n void setBlockRequestsPaused(bool state) {\n+    LogPrintf(\"%s Block Requests\\n\", (state ? \"Pause\" : \"Resume\"));",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 19,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "8ac56f8ebddb22e9281c4a7dab21939da18a543b",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Ensure we pause wallet sync when the keypool requires extension\"\r\n\r\nConsider moving this change to the \"Add option to pause block requests\" commit.",
      "created_at": "2017-05-05T18:55:33Z",
      "updated_at": "2017-05-12T08:29:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115065830",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115065830"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4327,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115065922",
      "pull_request_review_id": 36546706,
      "id": 115065922,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA2NTkyMg==",
      "diff_hunk": "@@ -4324,6 +4333,7 @@ bool isTipUpdatesPaused() {\n }\n \n void setTipUpdatesPaused(bool state) {\n+    LogPrintf(\"%s Tip Updates\\n\", (state ? \"Pause\" : \"Resume\"));",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 27,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "8ac56f8ebddb22e9281c4a7dab21939da18a543b",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Ensure we pause wallet sync when the keypool requires extension\"\r\n\r\nConsider moving this change to the \"Add option to pause tip updates\" commit.",
      "created_at": "2017-05-05T18:55:57Z",
      "updated_at": "2017-05-12T08:29:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115065922",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115065922"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4336,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115066863",
      "pull_request_review_id": 36546706,
      "id": 115066863,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA2Njg2Mw==",
      "diff_hunk": "@@ -2044,6 +2044,9 @@ UniValue walletpassphrase(const JSONRPCRequest& request)\n \n     pwallet->TopUpKeyPool();\n \n+    // give a hint to the wallet in case we have paused sync (we may have fall bellow the hd gap limit)\n+    pwallet->EventuallyRescanAfterKeypoolTopUp();",
      "path": "src/wallet/rpcwallet.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "8ac56f8ebddb22e9281c4a7dab21939da18a543b",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Ensure we pause wallet sync when the keypool requires extension\"\r\n\r\nWould it make sense to call this automatically inside TopUpKeyPool? Seems strange to have to implement it separately for RPC and Qt wallet interfaces.",
      "created_at": "2017-05-05T19:01:33Z",
      "updated_at": "2017-05-12T08:29:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115066863",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115066863"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2051,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115068537",
      "pull_request_review_id": 36546706,
      "id": 115068537,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA2ODUzNw==",
      "diff_hunk": "@@ -1417,6 +1418,57 @@ bool CWallet::IsHDEnabled() const\n     return !hdChain.masterKeyID.IsNull();\n }\n \n+void CWallet::EventuallyRescanAfterKeypoolTopUp() {\n+    if (fSyncPausedUntilKeypoolExt) {\n+\n+        // for now, enable block requests and tip updates via the states\n+        // this will only be sufficient as long as only a single wallet adjusts these stats\n+        // otherwise the net-/validation-logic needs to poll the state over a signal (or similar)\n+        ::setBlockRequestsPaused(false);\n+        ::setTipUpdatesPaused(false);\n+\n+        // disabled the per-wallet pause\n+        fSyncPausedUntilKeypoolExt = false;\n+\n+        const CChainParams& chainparams = Params();\n+        CValidationState state;\n+        if (!ActivateBestChain(state, chainparams)) {\n+            LogPrintf(\"Failed to connect best block\");\n+            StartShutdown();\n+        }\n+\n+        CBlockIndex *pindexRescan = chainActive.Genesis();\n+        CWalletDB walletdb(*dbw);\n+        CBlockLocator locator;\n+        if (walletdb.ReadBestBlock(locator))\n+            pindexRescan = FindForkInGlobalIndex(chainActive, locator);\n+\n+        if (chainActive.Tip() && chainActive.Tip() != pindexRescan)\n+        {\n+            //We can't rescan beyond non-pruned blocks, stop and throw an error\n+            //this might happen if a user uses a old wallet within a pruned node\n+            // or if he ran -disablewallet for a longer time, then decided to re-enable\n+            if (fPruneMode)\n+            {\n+                CBlockIndex *block = chainActive.Tip();\n+                while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && pindexRescan != block)\n+                    block = block->pprev;\n+\n+                if (pindexRescan != block) {\n+                    const static std::string pruneError = \"Prune: last wallet synchronisation goes beyond pruned data. You need to -reindex (download the whole blockchain again in case of pruned node)\";\n+                    uiInterface.ThreadSafeMessageBox(pruneError, \"\", CClientUIInterface::MSG_ERROR);\n+                    StartShutdown();",
      "path": "src/wallet/wallet.cpp",
      "position": 181,
      "original_position": 51,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "8ac56f8ebddb22e9281c4a7dab21939da18a543b",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Ensure we pause wallet sync when the keypool requires extension\"\r\n\r\nIt seems kind of abrupt and unfriendly that entering your passphrase to unlock the wallet could suddenly trigger a shutdown. Wouldn't it be better to detect this condition before unpausing, and if it happens, let the node stay up and paused instead of shutting it down?",
      "created_at": "2017-05-05T19:11:11Z",
      "updated_at": "2017-05-12T08:29:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115068537",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115068537"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1458,
      "original_line": 1458,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115069097",
      "pull_request_review_id": 36546706,
      "id": 115069097,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA2OTA5Nw==",
      "diff_hunk": "@@ -54,6 +54,7 @@\n     # Longest test should go first, to favor running tests in parallel\n     'wallet-hd.py',\n     'wallet-hd-restore.py',\n+    'wallet-hd-restore.py',",
      "path": "test/functional/test_runner.py",
      "position": null,
      "original_position": 4,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "ec5bf977339e30df1192a6bbdc259bcf5f702c45",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Extend wallet hd restore functional test\"\r\n\r\nAlready listed",
      "created_at": "2017-05-05T19:14:32Z",
      "updated_at": "2017-05-12T08:29:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115069097",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115069097"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 57,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115071463",
      "pull_request_review_id": 36546706,
      "id": 115071463,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA3MTQ2Mw==",
      "diff_hunk": "@@ -3881,12 +3888,11 @@ CWallet* CWallet::CreateWalletFromFile(const std::string walletFile)\n             InitWarning(_(\"Your are using an encrypted HD wallet. In case you recover a HD wallet, you may miss incomming or outgoing funds.\"));\n         }\n         else {\n-            if (GetArg(\"-keypool\", DEFAULT_KEYPOOL_SIZE) < HD_RESTORE_KEYPOOL_SIZE_MIN ) {\n-                InitWarning(_(\"Your keypool size is below the recommended limit for HD rescans. In case you recover a HD wallet, you may miss incomming or outgoing funds.\"));\n-            }\n             walletInstance->TopUpKeyPool();\n         }\n-\n+        if (!walletInstance->CheckKeypoolMinSize()) {\n+            InitWarning(_(\"Your keypool size is below the required limit for HD rescans. Wallet synchronisation is now paused until you have refilled the keypool.\"));",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 53,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "f6f09a8eb24c583eac8dd6abd04e97ba0dee0637",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Make sure we check the keypool min size during startup\"\r\n\r\nWarning should suggest how to fix the problem, and also ideally also include more background information (maybe consider using my previous suggestion for the -keypool limit warning).",
      "created_at": "2017-05-05T19:28:30Z",
      "updated_at": "2017-05-12T08:29:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115071463",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115071463"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3894,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115073522",
      "pull_request_review_id": 36546706,
      "id": 115073522,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA3MzUyMg==",
      "diff_hunk": "@@ -3442,6 +3443,18 @@ void CReserveKey::ReturnKey()\n     vchPubKey = CPubKey();\n }\n \n+bool CWallet::CheckKeypoolMinSize() {\n+    LOCK(cs_wallet);\n+    size_t extKeypoolSize = KeypoolCountExternalKeys();\n+    if (IsHDEnabled() && (extKeypoolSize < HD_RESTORE_KEYPOOL_SIZE_MIN || (setKeyPool.size()-extKeypoolSize) < HD_RESTORE_KEYPOOL_SIZE_MIN)) {\n+        // if the remaining keypool size is below the gap limit, refuse to continue with the sync\n+        fSyncPausedUntilKeypoolExt = true;",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 17,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "f6f09a8eb24c583eac8dd6abd04e97ba0dee0637",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Make sure we check the keypool min size during startup\"\r\n\r\nThis pausing behavior seems like it should be optional, because even in the worst case, you should be able to recover from any problem by topping up your keypool and doing a rescan. Maybe `HD_RESTORE_KEYPOOL_SIZE_MIN` should be renamed something like `PAUSE_SYNC_WHEN_KEYPOOL_SMALLER_THAN` and be a config option.",
      "created_at": "2017-05-05T19:41:06Z",
      "updated_at": "2017-05-12T08:29:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115073522",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115073522"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3449,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115074802",
      "pull_request_review_id": 36546706,
      "id": 115074802,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA3NDgwMg==",
      "diff_hunk": "@@ -2554,7 +2554,7 @@ bool ActivateBestChain(CValidationState &state, const CChainParams& chainparams,\n         if (pindexFork != pindexNewTip) {\n             uiInterface.NotifyBlockTip(fInitialDownload, pindexNewTip);\n         }\n-    } while (pindexNewTip != pindexMostWork);\n+    } while (pindexNewTip != pindexMostWork && !isTipUpdatesPaused());",
      "path": "src/validation.cpp",
      "position": 53,
      "original_position": 5,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "11cccadf1308976cd61de0a7286f2902e6d32426",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Make sure we pause immediately if we receive a pause-request\"\r\n\r\nWould squash this commit into the commit \"Add request-halt flag to BlockConnected signal\" (along with the other change I suggest moving there) so this is understandable in the correct context.",
      "created_at": "2017-05-05T19:48:49Z",
      "updated_at": "2017-05-12T08:29:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115074802",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115074802"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2557,
      "original_line": 2557,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115076481",
      "pull_request_review_id": 36546706,
      "id": 115076481,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA3NjQ4MQ==",
      "diff_hunk": "@@ -3764,6 +3764,7 @@ std::string CWallet::GetWalletHelpString(bool showDebug)\n         strUsage += HelpMessageOpt(\"-flushwallet\", strprintf(\"Run a thread to flush wallet periodically (default: %u)\", DEFAULT_FLUSHWALLET));\n         strUsage += HelpMessageOpt(\"-privdb\", strprintf(\"Sets the DB_PRIVATE flag in the wallet db environment (default: %u)\", DEFAULT_WALLET_PRIVDB));\n         strUsage += HelpMessageOpt(\"-walletrejectlongchains\", strprintf(_(\"Wallet will not create transactions that violate mempool chain limits (default: %u)\"), DEFAULT_WALLET_REJECT_LONG_CHAINS));\n+        strUsage += HelpMessageOpt(\"-hdignoregaplimit\", strprintf(_(\"Ignores the minimum keypool-size warning for HD restore (default: %u)\"), DEFAULT_IGNORE_HD_MIN_KEYPOOL_SIZE));",
      "path": "src/wallet/wallet.cpp",
      "position": 346,
      "original_position": 13,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "cada7263fa95dff17ec2bab3b3b081cfdec2ae8e",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"SetSoftArg the keypool always to the minimum gap limit if HD is enabled\"\r\n\r\nIt seems like it would be a lot harder to for someone to understand what this \"ignore gap limit\" option does than the `PAUSE_SYNC_WHEN_KEYPOOL_SMALLER_THAN` option I suggested in another comment. Would be curious to know what you think about it.",
      "created_at": "2017-05-05T19:58:36Z",
      "updated_at": "2017-05-12T08:29:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115076481",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115076481"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3765,
      "original_line": 3765,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115076701",
      "pull_request_review_id": 36546706,
      "id": 115076701,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA3NjcwMQ==",
      "diff_hunk": "@@ -3884,13 +3885,14 @@ CWallet* CWallet::CreateWalletFromFile(const std::string walletFile)\n \n     // HD Restore: Make sure we always have a reasonable keypool size if HD is enabled\n     if (walletInstance->IsHDEnabled()) {\n-        if (walletInstance->IsCrypted()) {\n-            InitWarning(_(\"Your are using an encrypted HD wallet. In case you recover a HD wallet, you may miss incomming or outgoing funds.\"));\n+        if (GetArg(\"-keypool\", DEFAULT_KEYPOOL_SIZE) < HD_RESTORE_KEYPOOL_SIZE_MIN && !GetBoolArg(\"-hdignoregaplimit\", DEFAULT_IGNORE_HD_MIN_KEYPOOL_SIZE)) {\n+            LogPrintf(\"Parameter Interaction: set keypool to required minimum for encrypted wallets (%d)\\n\", HD_RESTORE_KEYPOOL_SIZE_MIN);\n+            SoftSetArg(\"-keypool\", std::to_string(HD_RESTORE_KEYPOOL_SIZE_MIN));\n         }\n         else {\n             walletInstance->TopUpKeyPool();\n         }\n-        if (!walletInstance->CheckKeypoolMinSize()) {\n+        if (!walletInstance->CheckKeypoolMinSize() && !GetBoolArg(\"-hdignoregaplimit\", DEFAULT_IGNORE_HD_MIN_KEYPOOL_SIZE)) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 31,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "cada7263fa95dff17ec2bab3b3b081cfdec2ae8e",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"SetSoftArg the keypool always to the minimum gap limit if HD is enabled\"\r\n\r\nThis seems broken. It's still pausing but just no longer warning that the pause took place?",
      "created_at": "2017-05-05T19:59:54Z",
      "updated_at": "2017-05-12T08:29:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115076701",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115076701"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3893,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115077168",
      "pull_request_review_id": 36546706,
      "id": 115077168,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA3NzE2OA==",
      "diff_hunk": "@@ -75,10 +75,12 @@ def run_test (self):\n \n         self.log.info(\"Restore backup ...\")\n         self.stop_node(1)\n-        os.remove(self.options.tmpdir + \"/node1/regtest/wallet.dat\")\n+        # we need to delete the complete regtest directory\n+        # otherwise node1 would auto-recover all funds in flag the keypool keys as used",
      "path": "test/functional/wallet-hd.py",
      "position": 6,
      "original_position": 6,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "cada7263fa95dff17ec2bab3b3b081cfdec2ae8e",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"SetSoftArg the keypool always to the minimum gap limit if HD is enabled\"\r\n\r\nIs this change meant to be part of this commit? I don't think there's an interaction with hdignoregaplimit here.",
      "created_at": "2017-05-05T20:02:26Z",
      "updated_at": "2017-06-08T19:02:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115077168",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115077168"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 78,
      "original_line": 78,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115078268",
      "pull_request_review_id": 36546706,
      "id": 115078268,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNTA3ODI2OA==",
      "diff_hunk": "@@ -1417,6 +1418,57 @@ bool CWallet::IsHDEnabled() const\n     return !hdChain.masterKeyID.IsNull();\n }\n \n+void CWallet::EventuallyRescanAfterKeypoolTopUp() {\n+    if (fSyncPausedUntilKeypoolExt) {\n+\n+        // for now, enable block requests and tip updates via the states\n+        // this will only be sufficient as long as only a single wallet adjusts these stats\n+        // otherwise the net-/validation-logic needs to poll the state over a signal (or similar)",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 17,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "8ac56f8ebddb22e9281c4a7dab21939da18a543b",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Ensure we pause wallet sync when the keypool requires extension\"\r\n\r\nIt should be possible to handle this without any polling or notifications by making `fPauseBlockRequests` and `fPauseTipUpdates` counters instead of bools. The counters would need to be incremented whenever `fSyncPausedUntilKeypoolExt` changed from false to true in any wallet, and decremented when it changed from true to false. Block requesting or tip updating would be paused whenever its respective counter was greater than 0.",
      "created_at": "2017-05-05T20:08:57Z",
      "updated_at": "2017-05-12T08:29:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115078268",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/115078268"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1426,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/116170837",
      "pull_request_review_id": 37773294,
      "id": 116170837,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNjE3MDgzNw==",
      "diff_hunk": "@@ -1163,33 +1164,51 @@ void CWallet::SyncTransaction(const CTransactionRef& ptx, const CBlockIndex *pin\n }\n \n void CWallet::TransactionAddedToMempool(const CTransactionRef& ptx) {\n-    LOCK2(cs_main, cs_wallet);\n-    SyncTransaction(ptx);\n-}\n+    if (fSyncPausedUntilKeypoolExt) return;\n \n-    LOCK2(cs_main, cs_wallet);\n-    // TODO: Temporarily ensure that mempool removals are notified before\n-    // connected transactions.  This shouldn't matter, but the abandoned\n-    // state of transactions in our wallet is currently cleared when we\n-    // receive another notification and there is a race condition where\n-    // notification of a connected conflict might cause an outside process\n-    // to abandon a transaction and then have it inadvertently cleared by\n-    // the notification that the conflicted transaction was evicted.\n-\n-    for (const CTransactionRef& ptx : vtxConflicted) {\n+    {\n+        LOCK2(cs_main, cs_wallet);\n         SyncTransaction(ptx);\n     }\n-    for (size_t i = 0; i < pblock->vtx.size(); i++) {\n-        SyncTransaction(pblock->vtx[i], pindex, i);\n+}\n+\n void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const CBlockIndex *pindex, const std::vector<CTransactionRef>& vtxConflicted, bool &requestPause) {\n+    if (fSyncPausedUntilKeypoolExt) {\n+        requestPause = true;\n+        return;\n+    }\n+\n+    {\n+        LOCK2(cs_main, cs_wallet);\n+        // TODO: Temporarily ensure that mempool removals are notified before\n+        // connected transactions.  This shouldn't matter, but the abandoned\n+        // state of transactions in our wallet is currently cleared when we\n+        // receive another notification and there is a race condition where\n+        // notification of a connected conflict might cause an outside process\n+        // to abandon a transaction and then have it inadvertently cleared by\n+        // the notification that the conflicted transaction was evicted.\n+\n+        for (const CTransactionRef& ptx : vtxConflicted) {\n+            SyncTransaction(ptx);\n+        }\n+        for (size_t i = 0; i < pblock->vtx.size(); i++) {\n+            SyncTransaction(pblock->vtx[i], pindex, i);\n+        }\n+        if (fSyncPausedUntilKeypoolExt) {\n+            requestPause = true;",
      "path": "src/wallet/wallet.cpp",
      "position": 128,
      "original_position": 58,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b9a95b08e587c722c0b0bb15adf805ba42584d9c",
      "in_reply_to_id": 115064943,
      "user": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "As you mention, it would be much simpler to call `setBlockRequestsPaused()`, but, wouldn't it be a massive layer violation? Communicating through the signals doesn't require that the wallet needs to know what the full node parts is really doing. But maybe im overcomplicating things here.",
      "created_at": "2017-05-12T07:56:07Z",
      "updated_at": "2017-05-12T08:29:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r116170837",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/116170837"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1200,
      "original_line": 1200,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/116173110",
      "pull_request_review_id": 37775637,
      "id": 116173110,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNjE3MzExMA==",
      "diff_hunk": "@@ -3764,6 +3764,7 @@ std::string CWallet::GetWalletHelpString(bool showDebug)\n         strUsage += HelpMessageOpt(\"-flushwallet\", strprintf(\"Run a thread to flush wallet periodically (default: %u)\", DEFAULT_FLUSHWALLET));\n         strUsage += HelpMessageOpt(\"-privdb\", strprintf(\"Sets the DB_PRIVATE flag in the wallet db environment (default: %u)\", DEFAULT_WALLET_PRIVDB));\n         strUsage += HelpMessageOpt(\"-walletrejectlongchains\", strprintf(_(\"Wallet will not create transactions that violate mempool chain limits (default: %u)\"), DEFAULT_WALLET_REJECT_LONG_CHAINS));\n+        strUsage += HelpMessageOpt(\"-hdignoregaplimit\", strprintf(_(\"Ignores the minimum keypool-size warning for HD restore (default: %u)\"), DEFAULT_IGNORE_HD_MIN_KEYPOOL_SIZE));",
      "path": "src/wallet/wallet.cpp",
      "position": 346,
      "original_position": 13,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "cada7263fa95dff17ec2bab3b3b081cfdec2ae8e",
      "in_reply_to_id": 115076481,
      "user": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The `-hdignoregaplimit` is for debug purposes only. Our tests run with a keypool size of 1 and therefor would cause troubles running post this PR without a \"ignore\" option, and I don't think it matter how we \"ignore\" the gap limit and over a startup argument seems the be the simplest way.",
      "created_at": "2017-05-12T08:10:26Z",
      "updated_at": "2017-05-12T08:29:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r116173110",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/116173110"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3765,
      "original_line": 3765,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/116173407",
      "pull_request_review_id": 37775957,
      "id": 116173407,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNjE3MzQwNw==",
      "diff_hunk": "@@ -1417,6 +1418,57 @@ bool CWallet::IsHDEnabled() const\n     return !hdChain.masterKeyID.IsNull();\n }\n \n+void CWallet::EventuallyRescanAfterKeypoolTopUp() {\n+    if (fSyncPausedUntilKeypoolExt) {\n+\n+        // for now, enable block requests and tip updates via the states\n+        // this will only be sufficient as long as only a single wallet adjusts these stats\n+        // otherwise the net-/validation-logic needs to poll the state over a signal (or similar)",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 17,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "8ac56f8ebddb22e9281c4a7dab21939da18a543b",
      "in_reply_to_id": 115078268,
      "user": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yes. Thats a good idea. Do you think this should be done in this PR or can we tackle this once we have multiple places where the sync may get paused?\r\nCounters may also introduce the risk of unwillingly increasing it twice (while only decrease it once).",
      "created_at": "2017-05-12T08:12:12Z",
      "updated_at": "2017-05-12T08:29:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r116173407",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/116173407"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1426,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/116173980",
      "pull_request_review_id": 37776598,
      "id": 116173980,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNjE3Mzk4MA==",
      "diff_hunk": "@@ -3349,14 +3365,62 @@ void CReserveKey::ReturnKey()\n     vchPubKey = CPubKey();\n }\n \n+void CWallet::MarkReserveKeysAsUsed(const CKeyID& keyId)\n+{\n+    LOCK(cs_wallet);\n+    CWalletDB walletdb(*dbw);\n+    auto it = std::begin(setKeyPool);\n+\n+    bool foundInternal = false;\n+    int64_t foundIndex = -1;\n+    for (const int64_t& id : setKeyPool) {\n+        CKeyPool keypool;\n+        if (!walletdb.ReadPool(id, keypool))\n+            throw std::runtime_error(std::string(__func__) + \": read failed\");\n+\n+        if (keypool.vchPubKey.GetID() == keyId) {",
      "path": "src/wallet/wallet.cpp",
      "position": 253,
      "original_position": 40,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b5f9bc2c11d9793d3f7a3ffef5e0d881c8e60e6b",
      "in_reply_to_id": 115042948,
      "user": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It would also require to keep the `fInternal` flags in memory (for the address book internal/external change flagging). This is independently addresses in #10238.",
      "created_at": "2017-05-12T08:15:28Z",
      "updated_at": "2017-05-12T08:29:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r116173980",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/116173980"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3469,
      "original_line": 3469,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/116174946",
      "pull_request_review_id": 37777656,
      "id": 116174946,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDExNjE3NDk0Ng==",
      "diff_hunk": "@@ -1417,6 +1418,57 @@ bool CWallet::IsHDEnabled() const\n     return !hdChain.masterKeyID.IsNull();\n }\n \n+void CWallet::EventuallyRescanAfterKeypoolTopUp() {\n+    if (fSyncPausedUntilKeypoolExt) {\n+\n+        // for now, enable block requests and tip updates via the states\n+        // this will only be sufficient as long as only a single wallet adjusts these stats\n+        // otherwise the net-/validation-logic needs to poll the state over a signal (or similar)\n+        ::setBlockRequestsPaused(false);\n+        ::setTipUpdatesPaused(false);\n+\n+        // disabled the per-wallet pause\n+        fSyncPausedUntilKeypoolExt = false;\n+\n+        const CChainParams& chainparams = Params();\n+        CValidationState state;\n+        if (!ActivateBestChain(state, chainparams)) {\n+            LogPrintf(\"Failed to connect best block\");\n+            StartShutdown();\n+        }\n+\n+        CBlockIndex *pindexRescan = chainActive.Genesis();\n+        CWalletDB walletdb(*dbw);\n+        CBlockLocator locator;\n+        if (walletdb.ReadBestBlock(locator))\n+            pindexRescan = FindForkInGlobalIndex(chainActive, locator);\n+\n+        if (chainActive.Tip() && chainActive.Tip() != pindexRescan)\n+        {\n+            //We can't rescan beyond non-pruned blocks, stop and throw an error\n+            //this might happen if a user uses a old wallet within a pruned node\n+            // or if he ran -disablewallet for a longer time, then decided to re-enable\n+            if (fPruneMode)\n+            {\n+                CBlockIndex *block = chainActive.Tip();\n+                while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && pindexRescan != block)\n+                    block = block->pprev;\n+\n+                if (pindexRescan != block) {\n+                    const static std::string pruneError = \"Prune: last wallet synchronisation goes beyond pruned data. You need to -reindex (download the whole blockchain again in case of pruned node)\";\n+                    uiInterface.ThreadSafeMessageBox(pruneError, \"\", CClientUIInterface::MSG_ERROR);\n+                    StartShutdown();",
      "path": "src/wallet/wallet.cpp",
      "position": 181,
      "original_position": 51,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "8ac56f8ebddb22e9281c4a7dab21939da18a543b",
      "in_reply_to_id": 115068537,
      "user": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I guess it already tries to avoid this situation by disabling the block downloads if the wallet is encrypted and the node runes in prune-mode.\r\nBut there is no guarantee that we won't prune bellow the wallets best block,.. this why this shutdown/protection is here.",
      "created_at": "2017-05-12T08:20:00Z",
      "updated_at": "2017-05-12T08:29:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r116174946",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/116174946"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1458,
      "original_line": 1458,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120918741",
      "pull_request_review_id": 42924281,
      "id": 120918741,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDkxODc0MQ==",
      "diff_hunk": "@@ -2554,7 +2554,7 @@ bool ActivateBestChain(CValidationState &state, const CChainParams& chainparams,\n         if (pindexFork != pindexNewTip) {\n             uiInterface.NotifyBlockTip(fInitialDownload, pindexNewTip);\n         }\n-    } while (pindexNewTip != pindexMostWork);\n+    } while (pindexNewTip != pindexMostWork && !isTipUpdatesPaused());",
      "path": "src/validation.cpp",
      "position": 53,
      "original_position": 5,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "11cccadf1308976cd61de0a7286f2902e6d32426",
      "in_reply_to_id": 115074802,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Would squash this commit into the commit \"Add request-halt flag to BlockConnected signal\" (along with the other change I suggest moving there) so this is understandable in the correct context.\r\n\r\n(unchanged)",
      "created_at": "2017-06-08T15:22:10Z",
      "updated_at": "2017-06-08T19:16:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120918741",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120918741"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2557,
      "original_line": 2557,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120918877",
      "pull_request_review_id": 42924281,
      "id": 120918877,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDkxODg3Nw==",
      "diff_hunk": "@@ -1163,33 +1164,51 @@ void CWallet::SyncTransaction(const CTransactionRef& ptx, const CBlockIndex *pin\n }\n \n void CWallet::TransactionAddedToMempool(const CTransactionRef& ptx) {\n-    LOCK2(cs_main, cs_wallet);\n-    SyncTransaction(ptx);\n-}\n+    if (fSyncPausedUntilKeypoolExt) return;\n \n-    LOCK2(cs_main, cs_wallet);\n-    // TODO: Temporarily ensure that mempool removals are notified before\n-    // connected transactions.  This shouldn't matter, but the abandoned\n-    // state of transactions in our wallet is currently cleared when we\n-    // receive another notification and there is a race condition where\n-    // notification of a connected conflict might cause an outside process\n-    // to abandon a transaction and then have it inadvertently cleared by\n-    // the notification that the conflicted transaction was evicted.\n-\n-    for (const CTransactionRef& ptx : vtxConflicted) {\n+    {\n+        LOCK2(cs_main, cs_wallet);\n         SyncTransaction(ptx);\n     }\n-    for (size_t i = 0; i < pblock->vtx.size(); i++) {\n-        SyncTransaction(pblock->vtx[i], pindex, i);\n+}\n+\n void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const CBlockIndex *pindex, const std::vector<CTransactionRef>& vtxConflicted, bool &requestPause) {\n+    if (fSyncPausedUntilKeypoolExt) {\n+        requestPause = true;\n+        return;\n+    }\n+\n+    {\n+        LOCK2(cs_main, cs_wallet);\n+        // TODO: Temporarily ensure that mempool removals are notified before\n+        // connected transactions.  This shouldn't matter, but the abandoned\n+        // state of transactions in our wallet is currently cleared when we\n+        // receive another notification and there is a race condition where\n+        // notification of a connected conflict might cause an outside process\n+        // to abandon a transaction and then have it inadvertently cleared by\n+        // the notification that the conflicted transaction was evicted.\n+\n+        for (const CTransactionRef& ptx : vtxConflicted) {\n+            SyncTransaction(ptx);\n+        }\n+        for (size_t i = 0; i < pblock->vtx.size(); i++) {\n+            SyncTransaction(pblock->vtx[i], pindex, i);\n+        }\n+        if (fSyncPausedUntilKeypoolExt) {\n+            requestPause = true;",
      "path": "src/wallet/wallet.cpp",
      "position": 128,
      "original_position": 58,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b9a95b08e587c722c0b0bb15adf805ba42584d9c",
      "in_reply_to_id": 115064943,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> As you mention, it would be much simpler to call setBlockRequestsPaused(), but, wouldn't it be a massive layer violation? Communicating through the signals doesn't require that the wallet needs to know what the full node parts is really doing. But maybe im overcomplicating things here.\r\n\r\nI don't see why it would be a problem to call `setBlockRequestsPaused(true)` from `CWallet::MarkReserveKeysAsUsed`, especially if it isn't a problem to call `setBlockRequestsPaused(false)` from `CWallet::EventuallyRescanAfterKeypoolTopUp` which the current code already does. It seems like it would just make pausing simpler, and more consistent with unpausing.",
      "created_at": "2017-06-08T15:22:38Z",
      "updated_at": "2017-06-08T19:16:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120918877",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120918877"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1200,
      "original_line": 1200,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120919001",
      "pull_request_review_id": 42924281,
      "id": 120919001,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDkxOTAwMQ==",
      "diff_hunk": "@@ -1417,6 +1418,57 @@ bool CWallet::IsHDEnabled() const\n     return !hdChain.masterKeyID.IsNull();\n }\n \n+void CWallet::EventuallyRescanAfterKeypoolTopUp() {\n+    if (fSyncPausedUntilKeypoolExt) {\n+\n+        // for now, enable block requests and tip updates via the states\n+        // this will only be sufficient as long as only a single wallet adjusts these stats\n+        // otherwise the net-/validation-logic needs to poll the state over a signal (or similar)\n+        ::setBlockRequestsPaused(false);\n+        ::setTipUpdatesPaused(false);\n+\n+        // disabled the per-wallet pause\n+        fSyncPausedUntilKeypoolExt = false;\n+\n+        const CChainParams& chainparams = Params();\n+        CValidationState state;\n+        if (!ActivateBestChain(state, chainparams)) {\n+            LogPrintf(\"Failed to connect best block\");\n+            StartShutdown();\n+        }\n+\n+        CBlockIndex *pindexRescan = chainActive.Genesis();\n+        CWalletDB walletdb(*dbw);\n+        CBlockLocator locator;\n+        if (walletdb.ReadBestBlock(locator))\n+            pindexRescan = FindForkInGlobalIndex(chainActive, locator);\n+\n+        if (chainActive.Tip() && chainActive.Tip() != pindexRescan)\n+        {\n+            //We can't rescan beyond non-pruned blocks, stop and throw an error\n+            //this might happen if a user uses a old wallet within a pruned node\n+            // or if he ran -disablewallet for a longer time, then decided to re-enable\n+            if (fPruneMode)\n+            {\n+                CBlockIndex *block = chainActive.Tip();\n+                while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && pindexRescan != block)\n+                    block = block->pprev;\n+\n+                if (pindexRescan != block) {\n+                    const static std::string pruneError = \"Prune: last wallet synchronisation goes beyond pruned data. You need to -reindex (download the whole blockchain again in case of pruned node)\";\n+                    uiInterface.ThreadSafeMessageBox(pruneError, \"\", CClientUIInterface::MSG_ERROR);\n+                    StartShutdown();",
      "path": "src/wallet/wallet.cpp",
      "position": 181,
      "original_position": 51,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "8ac56f8ebddb22e9281c4a7dab21939da18a543b",
      "in_reply_to_id": 115068537,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> But there is no guarantee that we won't prune bellow the wallets best block,.. this why this shutdown/protection is here.\r\n\r\nWouldn't just staying paused in this case offer as much protection as briefly unpausing and then shutting down?",
      "created_at": "2017-06-08T15:23:03Z",
      "updated_at": "2017-06-08T19:16:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120919001",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120919001"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1458,
      "original_line": 1458,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120919053",
      "pull_request_review_id": 42924281,
      "id": 120919053,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDkxOTA1Mw==",
      "diff_hunk": "@@ -3349,14 +3365,62 @@ void CReserveKey::ReturnKey()\n     vchPubKey = CPubKey();\n }\n \n+void CWallet::MarkReserveKeysAsUsed(const CKeyID& keyId)\n+{\n+    LOCK(cs_wallet);\n+    CWalletDB walletdb(*dbw);\n+    auto it = std::begin(setKeyPool);",
      "path": "src/wallet/wallet.cpp",
      "position": 244,
      "original_position": 31,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b5f9bc2c11d9793d3f7a3ffef5e0d881c8e60e6b",
      "in_reply_to_id": 115043447,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Should move this declaration closer to where it's actually used way below.\r\n\r\n(unchanged)",
      "created_at": "2017-06-08T15:23:13Z",
      "updated_at": "2017-06-08T19:16:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120919053",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120919053"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3460,
      "original_line": 3460,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120919083",
      "pull_request_review_id": 42924281,
      "id": 120919083,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDkxOTA4Mw==",
      "diff_hunk": "@@ -3349,14 +3365,62 @@ void CReserveKey::ReturnKey()\n     vchPubKey = CPubKey();\n }\n \n+void CWallet::MarkReserveKeysAsUsed(const CKeyID& keyId)\n+{\n+    LOCK(cs_wallet);\n+    CWalletDB walletdb(*dbw);\n+    auto it = std::begin(setKeyPool);\n+\n+    bool foundInternal = false;\n+    int64_t foundIndex = -1;\n+    for (const int64_t& id : setKeyPool) {\n+        CKeyPool keypool;\n+        if (!walletdb.ReadPool(id, keypool))\n+            throw std::runtime_error(std::string(__func__) + \": read failed\");\n+\n+        if (keypool.vchPubKey.GetID() == keyId) {",
      "path": "src/wallet/wallet.cpp",
      "position": 253,
      "original_position": 40,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b5f9bc2c11d9793d3f7a3ffef5e0d881c8e60e6b",
      "in_reply_to_id": 115042948,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> It would also require to keep the fInternal flags in memory (for the address book internal/external change flagging). This is independently addresses in #10238.\r\n\r\nYeah probably not worth simplifying this if it will be obsoleted by #10238.",
      "created_at": "2017-06-08T15:23:19Z",
      "updated_at": "2017-06-08T19:16:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120919083",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120919083"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3469,
      "original_line": 3469,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120919114",
      "pull_request_review_id": 42924281,
      "id": 120919114,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDkxOTExNA==",
      "diff_hunk": "@@ -3349,14 +3365,62 @@ void CReserveKey::ReturnKey()\n     vchPubKey = CPubKey();\n }\n \n+void CWallet::MarkReserveKeysAsUsed(const CKeyID& keyId)\n+{\n+    LOCK(cs_wallet);\n+    CWalletDB walletdb(*dbw);\n+    auto it = std::begin(setKeyPool);\n+\n+    bool foundInternal = false;\n+    int64_t foundIndex = -1;\n+    for (const int64_t& id : setKeyPool) {\n+        CKeyPool keypool;\n+        if (!walletdb.ReadPool(id, keypool))\n+            throw std::runtime_error(std::string(__func__) + \": read failed\");\n+\n+        if (keypool.vchPubKey.GetID() == keyId) {\n+            foundInternal = keypool.fInternal;\n+            foundIndex = id;\n+            if (!keypool.fInternal) {\n+                SetAddressBook(keyId, \"\", \"receive\");\n+            }\n+            break;\n+        }\n+    }\n+\n+    // mark all keys up to the found key as used\n+    if (foundIndex >= 0) {\n+        while (it != std::end(setKeyPool)) {\n+            const int64_t& id = *(it);\n+            if (id <= foundIndex) {",
      "path": "src/wallet/wallet.cpp",
      "position": 267,
      "original_position": 54,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b5f9bc2c11d9793d3f7a3ffef5e0d881c8e60e6b",
      "in_reply_to_id": 115044903,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> As an simplification (and optimization), you can exit the loop if id > foundIndex, since setKeyPool is an ordered set.\r\n\r\n(unchanged)",
      "created_at": "2017-06-08T15:23:26Z",
      "updated_at": "2017-06-08T19:16:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120919114",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120919114"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3483,
      "original_line": 3483,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120919150",
      "pull_request_review_id": 42924281,
      "id": 120919150,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDkxOTE1MA==",
      "diff_hunk": "@@ -3349,14 +3365,62 @@ void CReserveKey::ReturnKey()\n     vchPubKey = CPubKey();\n }\n \n+void CWallet::MarkReserveKeysAsUsed(const CKeyID& keyId)\n+{\n+    LOCK(cs_wallet);\n+    CWalletDB walletdb(*dbw);\n+    auto it = std::begin(setKeyPool);\n+\n+    bool foundInternal = false;\n+    int64_t foundIndex = -1;\n+    for (const int64_t& id : setKeyPool) {\n+        CKeyPool keypool;\n+        if (!walletdb.ReadPool(id, keypool))\n+            throw std::runtime_error(std::string(__func__) + \": read failed\");\n+\n+        if (keypool.vchPubKey.GetID() == keyId) {\n+            foundInternal = keypool.fInternal;\n+            foundIndex = id;\n+            if (!keypool.fInternal) {\n+                SetAddressBook(keyId, \"\", \"receive\");\n+            }\n+            break;\n+        }\n+    }\n+\n+    // mark all keys up to the found key as used\n+    if (foundIndex >= 0) {\n+        while (it != std::end(setKeyPool)) {\n+            const int64_t& id = *(it);\n+            if (id <= foundIndex) {\n+                CKeyPool keypool;\n+                if (!walletdb.ReadPool(id, keypool))\n+                    throw std::runtime_error(std::string(__func__) + \": read failed\");\n+\n+                // only mark keys on the corresponding chain\n+                if (keypool.fInternal == foundInternal) {",
      "path": "src/wallet/wallet.cpp",
      "position": 273,
      "original_position": 60,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b5f9bc2c11d9793d3f7a3ffef5e0d881c8e60e6b",
      "in_reply_to_id": 115044224,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Shouldn't it be an error if this condition is not true?\r\n\r\n(unchanged)",
      "created_at": "2017-06-08T15:23:34Z",
      "updated_at": "2017-06-08T19:16:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120919150",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120919150"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3489,
      "original_line": 3489,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120919193",
      "pull_request_review_id": 42924281,
      "id": 120919193,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDkxOTE5Mw==",
      "diff_hunk": "@@ -75,10 +75,12 @@ def run_test (self):\n \n         self.log.info(\"Restore backup ...\")\n         self.stop_node(1)\n-        os.remove(self.options.tmpdir + \"/node1/regtest/wallet.dat\")\n+        # we need to delete the complete regtest directory\n+        # otherwise node1 would auto-recover all funds in flag the keypool keys as used",
      "path": "test/functional/wallet-hd.py",
      "position": 6,
      "original_position": 6,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "cada7263fa95dff17ec2bab3b3b081cfdec2ae8e",
      "in_reply_to_id": 115077168,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": ">Is this change meant to be part of this commit? I don't think there's an interaction with hdignoregaplimit here.\r\n\r\n(unchanged)",
      "created_at": "2017-06-08T15:23:42Z",
      "updated_at": "2017-06-08T19:16:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120919193",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120919193"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 78,
      "original_line": 78,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120919269",
      "pull_request_review_id": 42924281,
      "id": 120919269,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDkxOTI2OQ==",
      "diff_hunk": "@@ -3764,6 +3764,7 @@ std::string CWallet::GetWalletHelpString(bool showDebug)\n         strUsage += HelpMessageOpt(\"-flushwallet\", strprintf(\"Run a thread to flush wallet periodically (default: %u)\", DEFAULT_FLUSHWALLET));\n         strUsage += HelpMessageOpt(\"-privdb\", strprintf(\"Sets the DB_PRIVATE flag in the wallet db environment (default: %u)\", DEFAULT_WALLET_PRIVDB));\n         strUsage += HelpMessageOpt(\"-walletrejectlongchains\", strprintf(_(\"Wallet will not create transactions that violate mempool chain limits (default: %u)\"), DEFAULT_WALLET_REJECT_LONG_CHAINS));\n+        strUsage += HelpMessageOpt(\"-hdignoregaplimit\", strprintf(_(\"Ignores the minimum keypool-size warning for HD restore (default: %u)\"), DEFAULT_IGNORE_HD_MIN_KEYPOOL_SIZE));",
      "path": "src/wallet/wallet.cpp",
      "position": 346,
      "original_position": 13,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "cada7263fa95dff17ec2bab3b3b081cfdec2ae8e",
      "in_reply_to_id": 115076481,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> The -hdignoregaplimit is for debug purposes only\r\n\r\nMaybe it's not worth fixing, but even as a developer I think \"pause sync when keypool is smaller than\" is clearer than \"ignore hd gap limit\" because one name tells you literally what the option does, while the other refers obliquely to what the option doesn't do.",
      "created_at": "2017-06-08T15:23:56Z",
      "updated_at": "2017-06-08T19:16:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120919269",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120919269"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3765,
      "original_line": 3765,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120919546",
      "pull_request_review_id": 42924281,
      "id": 120919546,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDkxOTU0Ng==",
      "diff_hunk": "@@ -3409,6 +3428,7 @@ void CWallet::MarkReserveKeysAsUsed(const CKeyID& keyId)\n     }\n \n     if (IsHDEnabled() && !TopUpKeyPool()) {\n+        fSyncPausedUntilKeypoolExt = true;\n         LogPrintf(\"%s: Topping up keypool failed (locked wallet)\\n\", __func__);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 83,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b9a95b08e587c722c0b0bb15adf805ba42584d9c",
      "in_reply_to_id": 115063131,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Fixed in 5b70a2289e96f0ce8c49678e613845572d8203bc",
      "created_at": "2017-06-08T15:24:52Z",
      "updated_at": "2017-06-08T19:16:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120919546",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120919546"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3432,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120919583",
      "pull_request_review_id": 42924281,
      "id": 120919583,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDkxOTU4Mw==",
      "diff_hunk": "@@ -3725,6 +3789,19 @@ CWallet* CWallet::CreateWalletFromFile(const std::string walletFile)\n \n     RegisterValidationInterface(walletInstance);\n \n+    // HD Restore: Make sure we always have a reasonable keypool size if HD is enabled\n+    if (walletInstance->IsHDEnabled()) {\n+        if (walletInstance->IsCrypted()) {\n+            InitWarning(_(\"Your are using an encrypted HD wallet. In case you recover a HD wallet, you may miss incomming or outgoing funds.\"));",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 94,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b5f9bc2c11d9793d3f7a3ffef5e0d881c8e60e6b",
      "in_reply_to_id": 115049299,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Phrase \"In case you recover a HD wallet\" seems too vague to be meaningful.\r\n\r\n(unchanged)",
      "created_at": "2017-06-08T15:24:58Z",
      "updated_at": "2017-06-08T19:16:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120919583",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120919583"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3795,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120919724",
      "pull_request_review_id": 42924281,
      "id": 120919724,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDkxOTcyNA==",
      "diff_hunk": "@@ -3725,6 +3789,19 @@ CWallet* CWallet::CreateWalletFromFile(const std::string walletFile)\n \n     RegisterValidationInterface(walletInstance);\n \n+    // HD Restore: Make sure we always have a reasonable keypool size if HD is enabled\n+    if (walletInstance->IsHDEnabled()) {\n+        if (walletInstance->IsCrypted()) {\n+            InitWarning(_(\"Your are using an encrypted HD wallet. In case you recover a HD wallet, you may miss incomming or outgoing funds.\"));\n+        }\n+        else {\n+            if (GetArg(\"-keypool\", DEFAULT_KEYPOOL_SIZE) < HD_RESTORE_KEYPOOL_SIZE_MIN ) {\n+                InitWarning(_(\"Your keypool size is below the recommended limit for HD rescans. In case you recover a HD wallet, you may miss incomming or outgoing funds.\"));",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 98,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b5f9bc2c11d9793d3f7a3ffef5e0d881c8e60e6b",
      "in_reply_to_id": 115052129,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Since this is warning that the requested size is below the recommended limit, it would be good to mention what the recommended limit actually is.\r\n\r\n(unchanged)",
      "created_at": "2017-06-08T15:25:32Z",
      "updated_at": "2017-06-08T19:16:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120919724",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120919724"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3799,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120919944",
      "pull_request_review_id": 42924281,
      "id": 120919944,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDkxOTk0NA==",
      "diff_hunk": "@@ -1182,6 +1181,7 @@ void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const\n     }\n     for (size_t i = 0; i < pblock->vtx.size(); i++) {\n         SyncTransaction(pblock->vtx[i], pindex, i);\n+void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const CBlockIndex *pindex, const std::vector<CTransactionRef>& vtxConflicted, bool &requestPause) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 12,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "5e672d36d922a780de86bc0ca64e220d758ab14c",
      "in_reply_to_id": 115060607,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Compile error here (line needs to be moved up)\r\n\r\nError is still present (commit \"Add request-halt flag to BlockConnected signal)",
      "created_at": "2017-06-08T15:26:15Z",
      "updated_at": "2017-06-08T19:16:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120919944",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120919944"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1177,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120920008",
      "pull_request_review_id": 42924281,
      "id": 120920008,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDkyMDAwOA==",
      "diff_hunk": "@@ -652,6 +652,7 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n     static std::atomic<bool> fFlushScheduled;\n     std::atomic<bool> fAbortRescan;\n     std::atomic<bool> fScanningWallet;\n+    std::atomic<bool> fSyncPausedUntilKeypoolExt;",
      "path": "src/wallet/wallet.h",
      "position": null,
      "original_position": 4,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b9a95b08e587c722c0b0bb15adf805ba42584d9c",
      "in_reply_to_id": 115063363,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Added in 5b70a2289e96f0ce8c49678e613845572d8203bc.",
      "created_at": "2017-06-08T15:26:31Z",
      "updated_at": "2017-06-08T19:16:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120920008",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120920008"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 664,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120920174",
      "pull_request_review_id": 42924281,
      "id": 120920174,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDkyMDE3NA==",
      "diff_hunk": "@@ -2533,6 +2533,14 @@ bool ActivateBestChain(CValidationState &state, const CChainParams& chainparams,\n             for (const PerBlockConnectTrace& trace : connectTrace.GetBlocksConnected()) {\n                 assert(trace.pblock && trace.pindex);\n                 GetMainSignals().BlockConnected(trace.pblock, trace.pindex, *trace.conflictedTxs, requestPause);\n+                if (requestPause) {",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "8ac56f8ebddb22e9281c4a7dab21939da18a543b",
      "in_reply_to_id": 115065542,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": ">This diff logically seems like it should be part of the \"Add request-halt flag to BlockConnected signal\" commit. Moving it there would make the commit history easier to understand.\r\n\r\n(unchanged)",
      "created_at": "2017-06-08T15:27:02Z",
      "updated_at": "2017-06-08T19:16:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120920174",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120920174"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2536,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120920214",
      "pull_request_review_id": 42924281,
      "id": 120920214,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDkyMDIxNA==",
      "diff_hunk": "@@ -4316,6 +4324,7 @@ bool isBlockRequestsPaused() {\n }\n \n void setBlockRequestsPaused(bool state) {\n+    LogPrintf(\"%s Block Requests\\n\", (state ? \"Pause\" : \"Resume\"));",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 19,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "8ac56f8ebddb22e9281c4a7dab21939da18a543b",
      "in_reply_to_id": 115065830,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Consider moving this change to the \"Add option to pause block requests\" commit.\r\n\r\n(unchanged)",
      "created_at": "2017-06-08T15:27:09Z",
      "updated_at": "2017-06-08T19:16:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120920214",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120920214"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4327,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120920245",
      "pull_request_review_id": 42924281,
      "id": 120920245,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDkyMDI0NQ==",
      "diff_hunk": "@@ -4324,6 +4333,7 @@ bool isTipUpdatesPaused() {\n }\n \n void setTipUpdatesPaused(bool state) {\n+    LogPrintf(\"%s Tip Updates\\n\", (state ? \"Pause\" : \"Resume\"));",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 27,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "8ac56f8ebddb22e9281c4a7dab21939da18a543b",
      "in_reply_to_id": 115065922,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": ">Consider moving this change to the \"Add option to pause tip updates\" commit.\r\n\r\n(unchanged)",
      "created_at": "2017-06-08T15:27:15Z",
      "updated_at": "2017-06-08T19:16:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120920245",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120920245"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4336,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120920268",
      "pull_request_review_id": 42924281,
      "id": 120920268,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDkyMDI2OA==",
      "diff_hunk": "@@ -2044,6 +2044,9 @@ UniValue walletpassphrase(const JSONRPCRequest& request)\n \n     pwallet->TopUpKeyPool();\n \n+    // give a hint to the wallet in case we have paused sync (we may have fall bellow the hd gap limit)\n+    pwallet->EventuallyRescanAfterKeypoolTopUp();",
      "path": "src/wallet/rpcwallet.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "8ac56f8ebddb22e9281c4a7dab21939da18a543b",
      "in_reply_to_id": 115066863,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": ">Would it make sense to call this automatically inside TopUpKeyPool? Seems strange to have to implement it separately for RPC and Qt wallet interfaces\r\n\r\n(unchanged)",
      "created_at": "2017-06-08T15:27:21Z",
      "updated_at": "2017-06-08T19:16:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120920268",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120920268"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2051,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120920419",
      "pull_request_review_id": 42924281,
      "id": 120920419,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDkyMDQxOQ==",
      "diff_hunk": "@@ -54,6 +54,7 @@\n     # Longest test should go first, to favor running tests in parallel\n     'wallet-hd.py',\n     'wallet-hd-restore.py',\n+    'wallet-hd-restore.py',",
      "path": "test/functional/test_runner.py",
      "position": null,
      "original_position": 4,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "ec5bf977339e30df1192a6bbdc259bcf5f702c45",
      "in_reply_to_id": 115069097,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": ">Already listed\r\n\r\n(unchanged)",
      "created_at": "2017-06-08T15:27:52Z",
      "updated_at": "2017-06-08T19:16:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120920419",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120920419"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 57,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120920486",
      "pull_request_review_id": 42924281,
      "id": 120920486,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDkyMDQ4Ng==",
      "diff_hunk": "@@ -3442,6 +3443,18 @@ void CReserveKey::ReturnKey()\n     vchPubKey = CPubKey();\n }\n \n+bool CWallet::CheckKeypoolMinSize() {\n+    LOCK(cs_wallet);\n+    size_t extKeypoolSize = KeypoolCountExternalKeys();\n+    if (IsHDEnabled() && (extKeypoolSize < HD_RESTORE_KEYPOOL_SIZE_MIN || (setKeyPool.size()-extKeypoolSize) < HD_RESTORE_KEYPOOL_SIZE_MIN)) {\n+        // if the remaining keypool size is below the gap limit, refuse to continue with the sync\n+        fSyncPausedUntilKeypoolExt = true;",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 17,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "f6f09a8eb24c583eac8dd6abd04e97ba0dee0637",
      "in_reply_to_id": 115073522,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> This pausing behavior seems like it should be optional\r\n\r\nThe \"-hdignoregaplimit\" argument added in the next commit does make this optional (commit \"SetSoftArg the keypool always to the minimum gap limit\"), though I still think a single \"pause sync when keypool smaller than\" check would be a little cleaner than separate \"keypool size min\" and \"ignore gap limit\" checks.",
      "created_at": "2017-06-08T15:28:05Z",
      "updated_at": "2017-06-08T19:16:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120920486",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120920486"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3449,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120920557",
      "pull_request_review_id": 42924281,
      "id": 120920557,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDkyMDU1Nw==",
      "diff_hunk": "@@ -3881,12 +3888,11 @@ CWallet* CWallet::CreateWalletFromFile(const std::string walletFile)\n             InitWarning(_(\"Your are using an encrypted HD wallet. In case you recover a HD wallet, you may miss incomming or outgoing funds.\"));\n         }\n         else {\n-            if (GetArg(\"-keypool\", DEFAULT_KEYPOOL_SIZE) < HD_RESTORE_KEYPOOL_SIZE_MIN ) {\n-                InitWarning(_(\"Your keypool size is below the recommended limit for HD rescans. In case you recover a HD wallet, you may miss incomming or outgoing funds.\"));\n-            }\n             walletInstance->TopUpKeyPool();\n         }\n-\n+        if (!walletInstance->CheckKeypoolMinSize()) {\n+            InitWarning(_(\"Your keypool size is below the required limit for HD rescans. Wallet synchronisation is now paused until you have refilled the keypool.\"));",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 53,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "f6f09a8eb24c583eac8dd6abd04e97ba0dee0637",
      "in_reply_to_id": 115071463,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Warning should suggest how to fix the problem, and also ideally also include more background information (maybe consider using my previous suggestion for the -keypool limit warning).\r\n\r\n(unchanged)",
      "created_at": "2017-06-08T15:28:23Z",
      "updated_at": "2017-06-08T19:16:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120920557",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120920557"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3894,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120920775",
      "pull_request_review_id": 42924281,
      "id": 120920775,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDkyMDc3NQ==",
      "diff_hunk": "@@ -3884,13 +3885,14 @@ CWallet* CWallet::CreateWalletFromFile(const std::string walletFile)\n \n     // HD Restore: Make sure we always have a reasonable keypool size if HD is enabled\n     if (walletInstance->IsHDEnabled()) {\n-        if (walletInstance->IsCrypted()) {\n-            InitWarning(_(\"Your are using an encrypted HD wallet. In case you recover a HD wallet, you may miss incomming or outgoing funds.\"));\n+        if (GetArg(\"-keypool\", DEFAULT_KEYPOOL_SIZE) < HD_RESTORE_KEYPOOL_SIZE_MIN && !GetBoolArg(\"-hdignoregaplimit\", DEFAULT_IGNORE_HD_MIN_KEYPOOL_SIZE)) {\n+            LogPrintf(\"Parameter Interaction: set keypool to required minimum for encrypted wallets (%d)\\n\", HD_RESTORE_KEYPOOL_SIZE_MIN);\n+            SoftSetArg(\"-keypool\", std::to_string(HD_RESTORE_KEYPOOL_SIZE_MIN));\n         }\n         else {\n             walletInstance->TopUpKeyPool();\n         }\n-        if (!walletInstance->CheckKeypoolMinSize()) {\n+        if (!walletInstance->CheckKeypoolMinSize() && !GetBoolArg(\"-hdignoregaplimit\", DEFAULT_IGNORE_HD_MIN_KEYPOOL_SIZE)) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 31,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "cada7263fa95dff17ec2bab3b3b081cfdec2ae8e",
      "in_reply_to_id": 115076701,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> This seems broken. It's still pausing but just no longer warning that the pause took place?\r\n\r\nOn second look, this seems ok because CWallet::CheckKeypoolMinSize now checks for \"-hdignoregaplimit\" and disables the pause.",
      "created_at": "2017-06-08T15:29:14Z",
      "updated_at": "2017-06-08T19:16:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120920775",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120920775"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3893,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120965597",
      "pull_request_review_id": 42924281,
      "id": 120965597,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDk2NTU5Nw==",
      "diff_hunk": "@@ -3882,13 +3883,14 @@ CWallet* CWallet::CreateWalletFromFile(const std::string walletFile)\n \n     // HD Restore: Make sure we always have a reasonable keypool size if HD is enabled\n     if (walletInstance->IsHDEnabled()) {\n-        if (walletInstance->IsCrypted()) {\n-            InitWarning(_(\"Your are using an encrypted HD wallet. In case you recover a HD wallet, you may miss incomming or outgoing funds.\"));",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 22,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "bd9e1e8f89e8470eecb57338e355a9519da66cd9",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"SetSoftArg the keypool always to the minimum gap limit if HD is enabled\"\r\n\r\nIt might be a good idea to keep the warning about missing funds in the case where IsCrypted && size < KEYPOOL_SIZE_MIN && GetBool(\"-hdignoregaplimit\"). I also had a suggestion about this warning in\r\nhttps://github.com/bitcoin/bitcoin/pull/10240#discussion_r115049299",
      "created_at": "2017-06-08T18:33:52Z",
      "updated_at": "2017-06-08T19:16:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120965597",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120965597"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3886,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120969753",
      "pull_request_review_id": 42924281,
      "id": 120969753,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDk2OTc1Mw==",
      "diff_hunk": "@@ -3879,12 +3886,11 @@ CWallet* CWallet::CreateWalletFromFile(const std::string walletFile)\n             InitWarning(_(\"Your are using an encrypted HD wallet. In case you recover a HD wallet, you may miss incomming or outgoing funds.\"));\n         }\n         else {\n-            if (GetArg(\"-keypool\", DEFAULT_KEYPOOL_SIZE) < HD_RESTORE_KEYPOOL_SIZE_MIN ) {\n-                InitWarning(_(\"Your keypool size is below the recommended limit for HD rescans. In case you recover a HD wallet, you may miss incomming or outgoing funds.\"));",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 47,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "46060c261c0edc7ef13bbee7575801c98534f440",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Make sure we check the keypool min size during startup\"\r\n\r\nWhy drop this warning? It still seems useful to warn about the \"-keypool\" being too small even if KeypoolCountExternalKeys() is momentarily returning a high number of keys. (I also had another suggestion about this warning at https://github.com/bitcoin/bitcoin/pull/10240#discussion_r115052129)",
      "created_at": "2017-06-08T18:50:15Z",
      "updated_at": "2017-06-08T19:16:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120969753",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120969753"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3883,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120976622",
      "pull_request_review_id": 42988490,
      "id": 120976622,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDk3NjYyMg==",
      "diff_hunk": "@@ -1002,6 +1002,22 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n         if (fExisted && !fUpdate) return false;\n         if (fExisted || IsMine(tx) || IsFromMe(tx))\n         {\n+            // check if we need to flag used keypool keys",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b5f9bc2c11d9793d3f7a3ffef5e0d881c8e60e6b",
      "in_reply_to_id": 115055571,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": ">Would expand this comment\r\n\r\nDone in 2a203b73fd2d7b016cd5f55977135a15a982414d",
      "created_at": "2017-06-08T19:22:52Z",
      "updated_at": "2017-06-08T19:22:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120976622",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120976622"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1005,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120976859",
      "pull_request_review_id": 42988720,
      "id": 120976859,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDk3Njg1OQ==",
      "diff_hunk": "@@ -1417,6 +1418,57 @@ bool CWallet::IsHDEnabled() const\n     return !hdChain.masterKeyID.IsNull();\n }\n \n+void CWallet::EventuallyRescanAfterKeypoolTopUp() {\n+    if (fSyncPausedUntilKeypoolExt) {\n+\n+        // for now, enable block requests and tip updates via the states\n+        // this will only be sufficient as long as only a single wallet adjusts these stats\n+        // otherwise the net-/validation-logic needs to poll the state over a signal (or similar)",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 17,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "8ac56f8ebddb22e9281c4a7dab21939da18a543b",
      "in_reply_to_id": 115078268,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": ">Do you think this should be done in this PR or can we tackle this once we have multiple places where the sync may get paused?\r\n\r\nMaybe, this PR is already pretty complicated, so I wouldn't want to tack this on in extra commits, but it could be nice if implemented to replace the existing \"Add option to pause...\" commits.",
      "created_at": "2017-06-08T19:23:50Z",
      "updated_at": "2017-06-08T19:23:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120976859",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120976859"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1426,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120977058",
      "pull_request_review_id": 42988942,
      "id": 120977058,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDk3NzA1OA==",
      "diff_hunk": "@@ -970,6 +1004,22 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n         if (fExisted && !fUpdate) return false;\n         if (fExisted || IsMine(tx) || IsFromMe(tx))\n         {\n+            // check if we need to flag used keypool keys\n+            std::set<CKeyID> setKeyPool;",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 60,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "11cccadf1308976cd61de0a7286f2902e6d32426",
      "in_reply_to_id": 115032554,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Maybe rename this variable. (It shadows CWallet::setKeyPool, which makes that variable more annoying to grep for.)\r\n\r\nDone in 2a203b73fd2d7b016cd5f55977135a15a982414d\r\n",
      "created_at": "2017-06-08T19:24:42Z",
      "updated_at": "2017-06-08T19:24:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120977058",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120977058"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1008,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120977130",
      "pull_request_review_id": 42989025,
      "id": 120977130,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDk3NzEzMA==",
      "diff_hunk": "@@ -1163,33 +1164,51 @@ void CWallet::SyncTransaction(const CTransactionRef& ptx, const CBlockIndex *pin\n }\n \n void CWallet::TransactionAddedToMempool(const CTransactionRef& ptx) {\n-    LOCK2(cs_main, cs_wallet);\n-    SyncTransaction(ptx);\n-}\n+    if (fSyncPausedUntilKeypoolExt) return;\n \n-    LOCK2(cs_main, cs_wallet);\n-    // TODO: Temporarily ensure that mempool removals are notified before\n-    // connected transactions.  This shouldn't matter, but the abandoned\n-    // state of transactions in our wallet is currently cleared when we\n-    // receive another notification and there is a race condition where\n-    // notification of a connected conflict might cause an outside process\n-    // to abandon a transaction and then have it inadvertently cleared by\n-    // the notification that the conflicted transaction was evicted.\n-\n-    for (const CTransactionRef& ptx : vtxConflicted) {\n+    {\n+        LOCK2(cs_main, cs_wallet);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 28,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b9a95b08e587c722c0b0bb15adf805ba42584d9c",
      "in_reply_to_id": 115061522,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": ">No need to add the {} and extra indentation\r\n\r\n(unchanged)",
      "created_at": "2017-06-08T19:25:03Z",
      "updated_at": "2017-06-08T19:25:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120977130",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120977130"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1170,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120977187",
      "pull_request_review_id": 42989093,
      "id": 120977187,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDk3NzE4Nw==",
      "diff_hunk": "@@ -970,6 +1004,22 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n         if (fExisted && !fUpdate) return false;\n         if (fExisted || IsMine(tx) || IsFromMe(tx))\n         {\n+            // check if we need to flag used keypool keys\n+            std::set<CKeyID> setKeyPool;\n+            GetAllReserveKeys(setKeyPool);\n+            // loop though all outputs\n+            BOOST_FOREACH(const CTxOut& txout, tx.vout) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 63,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "11cccadf1308976cd61de0a7286f2902e6d32426",
      "in_reply_to_id": 115037977,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": ">Maybe avoid BOOST_FOREACH here and below.\r\n\r\nDone in 2a203b73fd2d7b016cd5f55977135a15a982414d",
      "created_at": "2017-06-08T19:25:22Z",
      "updated_at": "2017-06-08T19:25:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120977187",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120977187"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1011,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120977253",
      "pull_request_review_id": 42989178,
      "id": 120977253,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDk3NzI1Mw==",
      "diff_hunk": "@@ -1163,33 +1164,51 @@ void CWallet::SyncTransaction(const CTransactionRef& ptx, const CBlockIndex *pin\n }\n \n void CWallet::TransactionAddedToMempool(const CTransactionRef& ptx) {\n-    LOCK2(cs_main, cs_wallet);\n-    SyncTransaction(ptx);\n-}\n+    if (fSyncPausedUntilKeypoolExt) return;\n \n-    LOCK2(cs_main, cs_wallet);\n-    // TODO: Temporarily ensure that mempool removals are notified before\n-    // connected transactions.  This shouldn't matter, but the abandoned\n-    // state of transactions in our wallet is currently cleared when we\n-    // receive another notification and there is a race condition where\n-    // notification of a connected conflict might cause an outside process\n-    // to abandon a transaction and then have it inadvertently cleared by\n-    // the notification that the conflicted transaction was evicted.\n-\n-    for (const CTransactionRef& ptx : vtxConflicted) {\n+    {\n+        LOCK2(cs_main, cs_wallet);\n         SyncTransaction(ptx);\n     }\n-    for (size_t i = 0; i < pblock->vtx.size(); i++) {\n-        SyncTransaction(pblock->vtx[i], pindex, i);\n+}\n+\n void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const CBlockIndex *pindex, const std::vector<CTransactionRef>& vtxConflicted, bool &requestPause) {\n+    if (fSyncPausedUntilKeypoolExt) {\n+        requestPause = true;\n+        return;\n+    }\n+\n+    {\n+        LOCK2(cs_main, cs_wallet);\n+        // TODO: Temporarily ensure that mempool removals are notified before\n+        // connected transactions.  This shouldn't matter, but the abandoned\n+        // state of transactions in our wallet is currently cleared when we\n+        // receive another notification and there is a race condition where\n+        // notification of a connected conflict might cause an outside process\n+        // to abandon a transaction and then have it inadvertently cleared by\n+        // the notification that the conflicted transaction was evicted.\n+\n+        for (const CTransactionRef& ptx : vtxConflicted) {\n+            SyncTransaction(ptx);\n+        }\n+        for (size_t i = 0; i < pblock->vtx.size(); i++) {\n+            SyncTransaction(pblock->vtx[i], pindex, i);\n+        }\n+        if (fSyncPausedUntilKeypoolExt) {\n+            requestPause = true;\n+        }\n     }\n }\n \n void CWallet::BlockDisconnected(const std::shared_ptr<const CBlock>& pblock) {\n-    LOCK2(cs_main, cs_wallet);\n+    if (fSyncPausedUntilKeypoolExt) return;\n \n-    for (const CTransactionRef& ptx : pblock->vtx) {\n-        SyncTransaction(ptx);\n+    {\n+        LOCK2(cs_main, cs_wallet);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 70,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b9a95b08e587c722c0b0bb15adf805ba42584d9c",
      "in_reply_to_id": 115061963,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": ">Again unnecessary {} and indentation make the diff messy here in BlockDisconnected\r\n\r\n(unchanged)",
      "created_at": "2017-06-08T19:25:42Z",
      "updated_at": "2017-06-08T19:25:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120977253",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120977253"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1207,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120977350",
      "pull_request_review_id": 42989303,
      "id": 120977350,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMDk3NzM1MA==",
      "diff_hunk": "@@ -1106,6 +1108,9 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n        caller must ensure the current wallet version is correct before calling\n        this function). */\n     bool SetHDMasterKey(const CPubKey& key);\n+\n+    bool IsSyncPausedUntilKeypoolExt() { return fSyncPausedUntilKeypoolExt; }",
      "path": "src/wallet/wallet.h",
      "position": null,
      "original_position": 21,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "b9a95b08e587c722c0b0bb15adf805ba42584d9c",
      "in_reply_to_id": 115062815,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": ">These functions are never called anywhere, and appear to be deleted in the next commit. Would remove them from this commit.\r\n\r\nRemoved in 5b70a2289e96f0ce8c49678e613845572d8203bc\r\n",
      "created_at": "2017-06-08T19:26:09Z",
      "updated_at": "2017-06-08T19:26:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r120977350",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/120977350"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1112,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121538887",
      "pull_request_review_id": 43576283,
      "id": 121538887,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTUzODg4Nw==",
      "diff_hunk": "@@ -1115,29 +1169,41 @@ void CWallet::SyncTransaction(const CTransactionRef& ptx, const CBlockIndex *pin\n }\n \n void CWallet::TransactionAddedToMempool(const CTransactionRef& ptx) {\n+    if (fSyncPausedUntilKeypoolExt) return;\n     LOCK2(cs_main, cs_wallet);\n     SyncTransaction(ptx);\n }\n \n-void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const CBlockIndex *pindex, const std::vector<CTransactionRef>& vtxConflicted) {\n-    LOCK2(cs_main, cs_wallet);\n-    // TODO: Temporarily ensure that mempool removals are notified before\n-    // connected transactions.  This shouldn't matter, but the abandoned\n-    // state of transactions in our wallet is currently cleared when we\n-    // receive another notification and there is a race condition where\n-    // notification of a connected conflict might cause an outside process\n-    // to abandon a transaction and then have it inadvertently cleared by\n-    // the notification that the conflicted transaction was evicted.\n-\n-    for (const CTransactionRef& ptx : vtxConflicted) {\n-        SyncTransaction(ptx);\n+void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const CBlockIndex *pindex, const std::vector<CTransactionRef>& vtxConflicted, bool &requestPause) {",
      "path": "src/wallet/wallet.cpp",
      "position": 103,
      "original_position": 103,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I'm not going to comment on @ryanofsky's other comments regarding commit order (although they all sound sensible). This one should definitely be fixed in commit  \"Add request-halt flag to BlockConnected signal\" since it breaks the build and so breaks git bisect.",
      "created_at": "2017-06-12T22:06:24Z",
      "updated_at": "2017-06-12T23:06:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r121538887",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121538887"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1177,
      "original_line": 1177,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121538932",
      "pull_request_review_id": 43576283,
      "id": 121538932,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTUzODkzMg==",
      "diff_hunk": "@@ -480,6 +480,9 @@ void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vector<con\n     // Make sure pindexBestKnownBlock is up to date, we'll need it.\n     ProcessBlockAvailability(nodeid);\n \n+    if (isBlockRequestsPaused())",
      "path": "src/net_processing.cpp",
      "position": 4,
      "original_position": 4,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: braces",
      "created_at": "2017-06-12T22:06:38Z",
      "updated_at": "2017-06-12T23:06:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r121538932",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121538932"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 483,
      "original_line": 483,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121539814",
      "pull_request_review_id": 43576283,
      "id": 121539814,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTUzOTgxNA==",
      "diff_hunk": "@@ -287,6 +287,20 @@ CAmount GetBlockSubsidy(int nHeight, const Consensus::Params& consensusParams);\n double GuessVerificationProgress(const ChainTxData& data, CBlockIndex* pindex);\n \n /**\n+ * Pausing block requests will allow to temporary pause the verification process.",
      "path": "src/validation.h",
      "position": 4,
      "original_position": 4,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: s/will allow to temporary/will temporarily",
      "created_at": "2017-06-12T22:11:54Z",
      "updated_at": "2017-06-12T23:06:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r121539814",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121539814"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 290,
      "original_line": 290,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121539847",
      "pull_request_review_id": 43576283,
      "id": 121539847,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTUzOTg0Nw==",
      "diff_hunk": "@@ -287,6 +287,20 @@ CAmount GetBlockSubsidy(int nHeight, const Consensus::Params& consensusParams);\n double GuessVerificationProgress(const ChainTxData& data, CBlockIndex* pindex);\n \n /**\n+ * Pausing block requests will allow to temporary pause the verification process.\n+ * Pausing won't prevent ActivateBestChain from connecting blocks (that are in flight or already on disk)\n+ */\n+bool isBlockRequestsPaused();\n+void setBlockRequestsPaused(bool state);\n+\n+/**\n+ * Pausing tip updates will temporary pause connecting new blocks",
      "path": "src/validation.h",
      "position": 11,
      "original_position": 11,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: s/will temporary/will temporarily",
      "created_at": "2017-06-12T22:12:06Z",
      "updated_at": "2017-06-12T23:06:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r121539847",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121539847"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 297,
      "original_line": 297,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121540156",
      "pull_request_review_id": 43576283,
      "id": 121540156,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTU0MDE1Ng==",
      "diff_hunk": "@@ -2046,6 +2046,10 @@ UniValue walletpassphrase(const JSONRPCRequest& request)\n \n     pwallet->TopUpKeyPool();\n \n+    // give a hint to the wallet in case we have paused sync (we may have fall bellow the hd gap limit)\n+    // this runs synchronous, at least during the resync, we can be sure the keypool can be topped up",
      "path": "src/wallet/rpcwallet.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit:\r\n\r\n    // Give a hint to the wallet in case we have paused sync (we may have fallen bellow the hd gap limit).\r\n    // This runs synchronously, at least during the resync, we can be sure the keypool can be topped up",
      "created_at": "2017-06-12T22:14:03Z",
      "updated_at": "2017-06-12T23:06:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r121540156",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121540156"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2050,
      "original_line": 2050,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121540588",
      "pull_request_review_id": 43576283,
      "id": 121540588,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTU0MDU4OA==",
      "diff_hunk": "@@ -970,6 +1004,26 @@ bool CWallet::AddToWalletIfInvolvingMe(const CTransactionRef& ptx, const CBlockI\n         if (fExisted && !fUpdate) return false;\n         if (fExisted || IsMine(tx) || IsFromMe(tx))\n         {\n+            /* Check if any keys in the wallet keypool that were supposed to be unused\n+             * have appeared in a new transaction. If so, remove those keys from the keypool.\n+             * This can happen when restoring an old wallet backup that does not contain\n+             * the mostly recently created transactions from newer versions of the wallet.\n+             */\n+            std::set<CKeyID> keyPool;\n+            GetAllReserveKeys(keyPool);\n+            // loop though all outputs\n+            for(const CTxOut& txout: tx.vout) {\n+                // extract addresses and check if they match with an unused keypool key\n+                std::vector<CKeyID> vAffected;\n+                CAffectedKeysVisitor(*this, vAffected).Process(txout.scriptPubKey);\n+                BOOST_FOREACH(const CKeyID &keyid, vAffected) {",
      "path": "src/wallet/wallet.cpp",
      "position": 71,
      "original_position": 71,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: avoid `BOOST_FOREACH`",
      "created_at": "2017-06-12T22:16:54Z",
      "updated_at": "2017-06-12T23:06:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r121540588",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121540588"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1019,
      "original_line": 1019,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121541385",
      "pull_request_review_id": 43576283,
      "id": 121541385,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTU0MTM4NQ==",
      "diff_hunk": "@@ -1115,29 +1169,41 @@ void CWallet::SyncTransaction(const CTransactionRef& ptx, const CBlockIndex *pin\n }\n \n void CWallet::TransactionAddedToMempool(const CTransactionRef& ptx) {\n+    if (fSyncPausedUntilKeypoolExt) return;\n     LOCK2(cs_main, cs_wallet);\n     SyncTransaction(ptx);\n }\n \n-void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const CBlockIndex *pindex, const std::vector<CTransactionRef>& vtxConflicted) {\n-    LOCK2(cs_main, cs_wallet);\n-    // TODO: Temporarily ensure that mempool removals are notified before\n-    // connected transactions.  This shouldn't matter, but the abandoned\n-    // state of transactions in our wallet is currently cleared when we\n-    // receive another notification and there is a race condition where\n-    // notification of a connected conflict might cause an outside process\n-    // to abandon a transaction and then have it inadvertently cleared by\n-    // the notification that the conflicted transaction was evicted.\n-\n-    for (const CTransactionRef& ptx : vtxConflicted) {\n-        SyncTransaction(ptx);\n+void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const CBlockIndex *pindex, const std::vector<CTransactionRef>& vtxConflicted, bool &requestPause) {\n+    if (fSyncPausedUntilKeypoolExt) {\n+        requestPause = true;\n+        return;\n     }\n-    for (size_t i = 0; i < pblock->vtx.size(); i++) {\n-        SyncTransaction(pblock->vtx[i], pindex, i);\n+\n+    {",
      "path": "src/wallet/wallet.cpp",
      "position": 111,
      "original_position": 111,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't think there's any need to change the indentation here",
      "created_at": "2017-06-12T22:21:34Z",
      "updated_at": "2017-06-12T23:06:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r121541385",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121541385"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1183,
      "original_line": 1183,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121541946",
      "pull_request_review_id": 43576283,
      "id": 121541946,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTU0MTk0Ng==",
      "diff_hunk": "@@ -1350,6 +1416,57 @@ bool CWallet::IsHDEnabled() const\n     return !hdChain.masterKeyID.IsNull();\n }\n \n+void CWallet::EventuallyRescanAfterKeypoolTopUp() {\n+    if (fSyncPausedUntilKeypoolExt) {\n+\n+        // for now, enable block requests and tip updates via the states\n+        // this will only be sufficient as long as only a single wallet adjusts these stats\n+        // switch to counters (instead of a single boolean state) could solve this",
      "path": "src/wallet/wallet.cpp",
      "position": 147,
      "original_position": 147,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "As you note, this doesn't work with multiwallet, which has now been merged. I think the `setBlockRequestsPaused()` and `setTipUpdatesPaused()` logic will now need to be updated to store the BlockRequests and TipUpdates state for each of the wallets.",
      "created_at": "2017-06-12T22:25:14Z",
      "updated_at": "2017-06-12T23:06:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r121541946",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121541946"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1424,
      "original_line": 1424,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121542001",
      "pull_request_review_id": 43576283,
      "id": 121542001,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTU0MjAwMQ==",
      "diff_hunk": "@@ -1350,6 +1416,57 @@ bool CWallet::IsHDEnabled() const\n     return !hdChain.masterKeyID.IsNull();\n }\n \n+void CWallet::EventuallyRescanAfterKeypoolTopUp() {\n+    if (fSyncPausedUntilKeypoolExt) {\n+\n+        // for now, enable block requests and tip updates via the states\n+        // this will only be sufficient as long as only a single wallet adjusts these stats\n+        // switch to counters (instead of a single boolean state) could solve this\n+        ::setBlockRequestsPaused(false);\n+        ::setTipUpdatesPaused(false);\n+\n+        // disabled the per-wallet pause\n+        fSyncPausedUntilKeypoolExt = false;\n+\n+        const CChainParams& chainparams = Params();\n+        CValidationState state;\n+        if (!ActivateBestChain(state, chainparams)) {\n+            LogPrintf(\"Failed to connect best block\");\n+            StartShutdown();\n+        }\n+\n+        CBlockIndex *pindexRescan = chainActive.Genesis();\n+        CWalletDB walletdb(*dbw);\n+        CBlockLocator locator;\n+        if (walletdb.ReadBestBlock(locator))",
      "path": "src/wallet/wallet.cpp",
      "position": 164,
      "original_position": 164,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: braces",
      "created_at": "2017-06-12T22:25:35Z",
      "updated_at": "2017-06-12T23:06:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r121542001",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121542001"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1441,
      "original_line": 1441,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121542158",
      "pull_request_review_id": 43576283,
      "id": 121542158,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTU0MjE1OA==",
      "diff_hunk": "@@ -1350,6 +1416,57 @@ bool CWallet::IsHDEnabled() const\n     return !hdChain.masterKeyID.IsNull();\n }\n \n+void CWallet::EventuallyRescanAfterKeypoolTopUp() {\n+    if (fSyncPausedUntilKeypoolExt) {\n+\n+        // for now, enable block requests and tip updates via the states\n+        // this will only be sufficient as long as only a single wallet adjusts these stats\n+        // switch to counters (instead of a single boolean state) could solve this\n+        ::setBlockRequestsPaused(false);\n+        ::setTipUpdatesPaused(false);\n+\n+        // disabled the per-wallet pause\n+        fSyncPausedUntilKeypoolExt = false;\n+\n+        const CChainParams& chainparams = Params();\n+        CValidationState state;\n+        if (!ActivateBestChain(state, chainparams)) {\n+            LogPrintf(\"Failed to connect best block\");\n+            StartShutdown();\n+        }\n+\n+        CBlockIndex *pindexRescan = chainActive.Genesis();\n+        CWalletDB walletdb(*dbw);\n+        CBlockLocator locator;\n+        if (walletdb.ReadBestBlock(locator))\n+            pindexRescan = FindForkInGlobalIndex(chainActive, locator);\n+\n+        if (chainActive.Tip() && chainActive.Tip() != pindexRescan)\n+        {\n+            //We can't rescan beyond non-pruned blocks, stop and throw an error\n+            //this might happen if a user uses a old wallet within a pruned node\n+            // or if he ran -disablewallet for a longer time, then decided to re-enable\n+            if (fPruneMode)\n+            {\n+                CBlockIndex *block = chainActive.Tip();\n+                while (block && block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA) && block->pprev->nTx > 0 && pindexRescan != block)",
      "path": "src/wallet/wallet.cpp",
      "position": 175,
      "original_position": 175,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: braces",
      "created_at": "2017-06-12T22:26:32Z",
      "updated_at": "2017-06-12T23:06:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r121542158",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121542158"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1452,
      "original_line": 1452,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121544508",
      "pull_request_review_id": 43576283,
      "id": 121544508,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTU0NDUwOA==",
      "diff_hunk": "@@ -3317,14 +3441,77 @@ void CReserveKey::ReturnKey()\n     vchPubKey = CPubKey();\n }\n \n+bool CWallet::CheckKeypoolMinSize() {\n+    LOCK(cs_wallet);\n+    size_t extKeypoolSize = KeypoolCountExternalKeys();\n+    if (!GetBoolArg(\"-hdignoregaplimit\", DEFAULT_IGNORE_HD_MIN_KEYPOOL_SIZE) && IsHDEnabled() && (extKeypoolSize < HD_RESTORE_KEYPOOL_SIZE_MIN || (setKeyPool.size()-extKeypoolSize) < HD_RESTORE_KEYPOOL_SIZE_MIN)) {\n+        // if the remaining keypool size is below the gap limit, refuse to continue with the sync\n+        fSyncPausedUntilKeypoolExt = true;\n+        LogPrintf(\"%s: Keypool ran below min size, pause wallet sync\\n\", __func__);\n+        return false;\n+    }\n+    return true;\n+}\n+\n+void CWallet::MarkReserveKeysAsUsed(const CKeyID& keyId)\n+{\n+    LOCK(cs_wallet);\n+    CWalletDB walletdb(*dbw);\n+    auto it = std::begin(setKeyPool);\n+\n+    bool foundInternal = false;\n+    int64_t foundIndex = -1;\n+    for (const int64_t& id : setKeyPool) {\n+        CKeyPool keypool;\n+        if (!walletdb.ReadPool(id, keypool))\n+            throw std::runtime_error(std::string(__func__) + \": read failed\");\n+\n+        if (keypool.vchPubKey.GetID() == keyId) {\n+            foundInternal = keypool.fInternal;\n+            foundIndex = id;\n+            if (!keypool.fInternal) {\n+                SetAddressBook(keyId, \"\", \"receive\");\n+            }\n+            break;\n+        }\n+    }\n+\n+    // mark all keys up to the found key as used\n+    if (foundIndex >= 0) {\n+        while (it != std::end(setKeyPool)) {\n+            const int64_t& id = *(it);\n+            if (id <= foundIndex) {\n+                CKeyPool keypool;\n+                if (!walletdb.ReadPool(id, keypool))\n+                    throw std::runtime_error(std::string(__func__) + \": read failed\");\n+\n+                // only mark keys on the corresponding chain\n+                if (keypool.fInternal == foundInternal) {\n+                    KeepKey(id);\n+                    it = setKeyPool.erase(it);\n+                    continue;\n+                }\n+            }\n+            ++it;\n+        }\n+    }\n+\n+    if (IsHDEnabled() && !TopUpKeyPool()) {\n+        fSyncPausedUntilKeypoolExt = true;",
      "path": "src/wallet/wallet.cpp",
      "position": 284,
      "original_position": 284,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't think you need to set `fSyncPausedUntilKeypoolExt` and log here, since the call to `CheckKeypoolMinSize()` below will catch when the keypool is too small.\r\n\r\nI think this also prevents `-hdignoregaplimit` from working, since `TopUpKeyPool()` returns false without checking that argument.",
      "created_at": "2017-06-12T22:41:10Z",
      "updated_at": "2017-06-12T23:06:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r121544508",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121544508"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3500,
      "original_line": 3500,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121544804",
      "pull_request_review_id": 43576283,
      "id": 121544804,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTU0NDgwNA==",
      "diff_hunk": "@@ -3764,6 +3764,7 @@ std::string CWallet::GetWalletHelpString(bool showDebug)\n         strUsage += HelpMessageOpt(\"-flushwallet\", strprintf(\"Run a thread to flush wallet periodically (default: %u)\", DEFAULT_FLUSHWALLET));\n         strUsage += HelpMessageOpt(\"-privdb\", strprintf(\"Sets the DB_PRIVATE flag in the wallet db environment (default: %u)\", DEFAULT_WALLET_PRIVDB));\n         strUsage += HelpMessageOpt(\"-walletrejectlongchains\", strprintf(_(\"Wallet will not create transactions that violate mempool chain limits (default: %u)\"), DEFAULT_WALLET_REJECT_LONG_CHAINS));\n+        strUsage += HelpMessageOpt(\"-hdignoregaplimit\", strprintf(_(\"Ignores the minimum keypool-size warning for HD restore (default: %u)\"), DEFAULT_IGNORE_HD_MIN_KEYPOOL_SIZE));",
      "path": "src/wallet/wallet.cpp",
      "position": 346,
      "original_position": 13,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "cada7263fa95dff17ec2bab3b3b081cfdec2ae8e",
      "in_reply_to_id": 115076481,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> I think \"pause sync when keypool is smaller than\" is clearer than \"ignore hd gap limit\"\r\n\r\n:+1:\r\n\r\nnit: place this argument in the correct alphabetic order.",
      "created_at": "2017-06-12T22:43:05Z",
      "updated_at": "2017-06-12T23:06:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r121544804",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121544804"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3765,
      "original_line": 3765,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121545265",
      "pull_request_review_id": 43576283,
      "id": 121545265,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTU0NTI2NQ==",
      "diff_hunk": "@@ -3725,6 +3881,19 @@ CWallet* CWallet::CreateWalletFromFile(const std::string walletFile)\n \n     RegisterValidationInterface(walletInstance);\n \n+    // HD Restore: Make sure we always have a reasonable keypool size if HD is enabled\n+    if (walletInstance->IsHDEnabled()) {\n+        if (GetArg(\"-keypool\", DEFAULT_KEYPOOL_SIZE) < HD_RESTORE_KEYPOOL_SIZE_MIN && !GetBoolArg(\"-hdignoregaplimit\", DEFAULT_IGNORE_HD_MIN_KEYPOOL_SIZE)) {\n+            LogPrintf(\"Parameter Interaction: set keypool to required minimum for encrypted wallets (%d)\\n\", HD_RESTORE_KEYPOOL_SIZE_MIN);\n+            SoftSetArg(\"-keypool\", std::to_string(HD_RESTORE_KEYPOOL_SIZE_MIN));\n+        }\n+        else {\n+            walletInstance->TopUpKeyPool();",
      "path": "src/wallet/wallet.cpp",
      "position": 361,
      "original_position": 361,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't understand why you're calling `TopUpKeyPool()` here only if -keypool >= HD_RESTORE_KEYPOOL_SIZE_MIN or hdignoregaplimit is set.",
      "created_at": "2017-06-12T22:46:09Z",
      "updated_at": "2017-06-12T23:06:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r121545265",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121545265"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3891,
      "original_line": 3891,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121545587",
      "pull_request_review_id": 43576283,
      "id": 121545587,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTU0NTU4Nw==",
      "diff_hunk": "@@ -3725,6 +3881,19 @@ CWallet* CWallet::CreateWalletFromFile(const std::string walletFile)\n \n     RegisterValidationInterface(walletInstance);\n \n+    // HD Restore: Make sure we always have a reasonable keypool size if HD is enabled\n+    if (walletInstance->IsHDEnabled()) {\n+        if (GetArg(\"-keypool\", DEFAULT_KEYPOOL_SIZE) < HD_RESTORE_KEYPOOL_SIZE_MIN && !GetBoolArg(\"-hdignoregaplimit\", DEFAULT_IGNORE_HD_MIN_KEYPOOL_SIZE)) {\n+            LogPrintf(\"Parameter Interaction: set keypool to required minimum for encrypted wallets (%d)\\n\", HD_RESTORE_KEYPOOL_SIZE_MIN);\n+            SoftSetArg(\"-keypool\", std::to_string(HD_RESTORE_KEYPOOL_SIZE_MIN));\n+        }\n+        else {\n+            walletInstance->TopUpKeyPool();\n+        }\n+        if (!walletInstance->CheckKeypoolMinSize() && !GetBoolArg(\"-hdignoregaplimit\", DEFAULT_IGNORE_HD_MIN_KEYPOOL_SIZE)) {",
      "path": "src/wallet/wallet.cpp",
      "position": 363,
      "original_position": 363,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`-hdignoregaplimit` is checked within `CheckKeypoolMinSize()` so I don't think you need it here (CheckKeypoolMinSize() will not return false if `-hdignoregaplimit` is true)",
      "created_at": "2017-06-12T22:48:25Z",
      "updated_at": "2017-06-12T23:06:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r121545587",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121545587"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3893,
      "original_line": 3893,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121545860",
      "pull_request_review_id": 43576283,
      "id": 121545860,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTU0NTg2MA==",
      "diff_hunk": "@@ -285,7 +285,7 @@ def _initialize_chain(self, test_dir, num_nodes, cachedir):\n             # Create cache directories, run bitcoinds:\n             for i in range(MAX_NODES):\n                 datadir = initialize_datadir(cachedir, i)\n-                args = [os.getenv(\"BITCOIND\", \"bitcoind\"), \"-server\", \"-keypool=1\", \"-datadir=\" + datadir, \"-discover=0\"]\n+                args = [os.getenv(\"BITCOIND\", \"bitcoind\"), \"-server\", \"-keypool=1\", \"-hdignoregaplimit\", \"-datadir=\" + datadir, \"-discover=0\"]",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 5,
      "original_position": 5,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Why does this need to be changed for creating the cache directories?",
      "created_at": "2017-06-12T22:50:10Z",
      "updated_at": "2017-06-12T23:06:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r121545860",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121545860"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 288,
      "original_line": 288,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121546032",
      "pull_request_review_id": 43576283,
      "id": 121546032,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTU0NjAzMg==",
      "diff_hunk": "@@ -234,7 +234,7 @@ def start_node(i, dirname, extra_args=None, rpchost=None, timewait=None, binary=\n     datadir = os.path.join(dirname, \"node\"+str(i))\n     if binary is None:\n         binary = os.getenv(\"BITCOIND\", \"bitcoind\")\n-    args = [binary, \"-datadir=\" + datadir, \"-server\", \"-keypool=1\", \"-discover=0\", \"-rest\", \"-logtimemicros\", \"-debug\", \"-debugexclude=libevent\", \"-debugexclude=leveldb\", \"-mocktime=\" + str(get_mocktime()), \"-uacomment=testnode%d\" % i]\n+    args = [binary, \"-datadir=\" + datadir, \"-server\", \"-keypool=1\", \"-hdignoregaplimit\", \"-discover=0\", \"-rest\", \"-logtimemicros\", \"-debug\", \"-debugexclude=libevent\", \"-debugexclude=leveldb\", \"-mocktime=\" + str(get_mocktime()), \"-uacomment=testnode%d\" % i]",
      "path": "test/functional/test_framework/util.py",
      "position": 5,
      "original_position": 5,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't think you should be changing this command line argument for all tests.",
      "created_at": "2017-06-12T22:51:14Z",
      "updated_at": "2017-06-12T23:06:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r121546032",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121546032"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 237,
      "original_line": 237,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121546057",
      "pull_request_review_id": 43576283,
      "id": 121546057,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTU0NjA1Nw==",
      "diff_hunk": "@@ -53,6 +53,8 @@\n     # Scripts that are run by the travis build process.\n     # Longest test should go first, to favor running tests in parallel\n     'wallet-hd.py',\n+    'wallet-hd-restore.py',\n+    'wallet-hd-restore.py',",
      "path": "test/functional/test_runner.py",
      "position": 5,
      "original_position": 5,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "remove duplicate",
      "created_at": "2017-06-12T22:51:25Z",
      "updated_at": "2017-06-12T23:06:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r121546057",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121546057"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 57,
      "original_line": 57,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121546151",
      "pull_request_review_id": 43576283,
      "id": 121546151,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTU0NjE1MQ==",
      "diff_hunk": "@@ -0,0 +1,162 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test Hierarchical Deterministic wallet function.\"\"\"",
      "path": "test/functional/wallet-hd-restore.py",
      "position": 5,
      "original_position": 5,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Please update docstring to describe what this test is doing (I think you copied this directly from wallet-hd.py)",
      "created_at": "2017-06-12T22:52:06Z",
      "updated_at": "2017-06-12T23:06:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r121546151",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121546151"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 5,
      "original_line": 5,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121546215",
      "pull_request_review_id": 43576283,
      "id": 121546215,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTU0NjIxNQ==",
      "diff_hunk": "@@ -0,0 +1,162 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test Hierarchical Deterministic wallet function.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework",
      "path": "test/functional/wallet-hd-restore.py",
      "position": 7,
      "original_position": 7,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Please order imports in PEP8 ordering (std library, then 3rd party libraries, then local imports)",
      "created_at": "2017-06-12T22:52:30Z",
      "updated_at": "2017-06-12T23:06:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r121546215",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121546215"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 7,
      "original_line": 7,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121546260",
      "pull_request_review_id": 43576283,
      "id": 121546260,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTU0NjI2MA==",
      "diff_hunk": "@@ -0,0 +1,162 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test Hierarchical Deterministic wallet function.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+import os\n+import shutil\n+from pprint import pprint",
      "path": "test/functional/wallet-hd-restore.py",
      "position": 11,
      "original_position": 11,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "import not used",
      "created_at": "2017-06-12T22:52:48Z",
      "updated_at": "2017-06-12T23:06:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r121546260",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121546260"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 11,
      "original_line": 11,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121546394",
      "pull_request_review_id": 43576283,
      "id": 121546394,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTU0NjM5NA==",
      "diff_hunk": "@@ -0,0 +1,162 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test Hierarchical Deterministic wallet function.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+import os\n+import shutil\n+from pprint import pprint\n+\n+class WalletHDRestoreTest(BitcoinTestFramework):\n+\n+    def __init__(self):\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.node_args = [['-usehd=0'], ['-usehd=1', '-keypool=100', '-hdignoregaplimit=0']]",
      "path": "test/functional/wallet-hd-restore.py",
      "position": 19,
      "original_position": 19,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "you can set `self.extra_args` here, and then you won't need to override the `setup_network()` method below (the test framework will take care of everything if you set the extra_args here.",
      "created_at": "2017-06-12T22:53:47Z",
      "updated_at": "2017-06-12T23:06:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r121546394",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121546394"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 19,
      "original_line": 19,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121546471",
      "pull_request_review_id": 43576283,
      "id": 121546471,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTU0NjQ3MQ==",
      "diff_hunk": "@@ -0,0 +1,162 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test Hierarchical Deterministic wallet function.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+import os\n+import shutil\n+from pprint import pprint\n+\n+class WalletHDRestoreTest(BitcoinTestFramework):\n+\n+    def __init__(self):\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.node_args = [['-usehd=0'], ['-usehd=1', '-keypool=100', '-hdignoregaplimit=0']]\n+\n+    def setup_network(self):\n+        self.nodes = start_nodes(self.num_nodes, self.options.tmpdir, self.node_args)\n+        self.is_network_split = False\n+        connect_nodes_bi(self.nodes, 0, 1)\n+\n+    def run_test (self):\n+        tmpdir = self.options.tmpdir\n+\n+        print(\"Initialize wallet including backups of unencrypted and encrypted wallet\")",
      "path": "test/functional/wallet-hd-restore.py",
      "position": 29,
      "original_position": 29,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Please use self.log.info() instead of print for logging.",
      "created_at": "2017-06-12T22:54:15Z",
      "updated_at": "2017-06-12T23:06:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r121546471",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121546471"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 29,
      "original_line": 29,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121546980",
      "pull_request_review_id": 43576283,
      "id": 121546980,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTU0Njk4MA==",
      "diff_hunk": "@@ -0,0 +1,162 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test Hierarchical Deterministic wallet function.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+import os\n+import shutil\n+from pprint import pprint\n+\n+class WalletHDRestoreTest(BitcoinTestFramework):\n+\n+    def __init__(self):\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.node_args = [['-usehd=0'], ['-usehd=1', '-keypool=100', '-hdignoregaplimit=0']]\n+\n+    def setup_network(self):\n+        self.nodes = start_nodes(self.num_nodes, self.options.tmpdir, self.node_args)\n+        self.is_network_split = False\n+        connect_nodes_bi(self.nodes, 0, 1)\n+\n+    def run_test (self):\n+        tmpdir = self.options.tmpdir\n+\n+        print(\"Initialize wallet including backups of unencrypted and encrypted wallet\")\n+        # stop and backup original wallet (only keypool has been initialized)\n+        self.stop_node(1)\n+        shutil.copyfile(tmpdir + \"/node1/regtest/wallet.dat\", tmpdir + \"/hd.bak\")\n+\n+        # start again and encrypt wallet\n+        self.nodes[1] = start_node(1, self.options.tmpdir, self.node_args[1])\n+        self.nodes[1].encryptwallet('test')\n+        bitcoind_processes[1].wait()\n+        # node will be stopped during encryption, now do a backup\n+        shutil.copyfile(tmpdir + \"/node1/regtest/wallet.dat\", tmpdir + \"/hd.enc.bak\") \n+\n+        # start the node with encrypted wallet, get address in new pool at pos 50 (over the gap limit)\n+        self.nodes[1] = start_node(1, self.options.tmpdir, self.node_args[1])\n+        for _ in range(50):\n+            addr_enc_oldpool = self.nodes[1].getnewaddress()\n+\n+        # now make sure we retrive an address in the extended pool\n+        self.nodes[1].walletpassphrase(\"test\", 10)",
      "path": "test/functional/wallet-hd-restore.py",
      "position": 47,
      "original_position": 47,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Suggest you set the timeout higher, perhaps to 60 seconds. Tests should be robust to bitcoind hanging for several seconds, especially if running in parallel on Travis.",
      "created_at": "2017-06-12T22:58:12Z",
      "updated_at": "2017-06-12T23:06:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r121546980",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121546980"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 47,
      "original_line": 47,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121547328",
      "pull_request_review_id": 43576283,
      "id": 121547328,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTU0NzMyOA==",
      "diff_hunk": "@@ -0,0 +1,162 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test Hierarchical Deterministic wallet function.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+import os\n+import shutil\n+from pprint import pprint\n+\n+class WalletHDRestoreTest(BitcoinTestFramework):\n+\n+    def __init__(self):\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.node_args = [['-usehd=0'], ['-usehd=1', '-keypool=100', '-hdignoregaplimit=0']]\n+\n+    def setup_network(self):\n+        self.nodes = start_nodes(self.num_nodes, self.options.tmpdir, self.node_args)\n+        self.is_network_split = False\n+        connect_nodes_bi(self.nodes, 0, 1)\n+\n+    def run_test (self):\n+        tmpdir = self.options.tmpdir\n+\n+        print(\"Initialize wallet including backups of unencrypted and encrypted wallet\")\n+        # stop and backup original wallet (only keypool has been initialized)\n+        self.stop_node(1)\n+        shutil.copyfile(tmpdir + \"/node1/regtest/wallet.dat\", tmpdir + \"/hd.bak\")\n+\n+        # start again and encrypt wallet\n+        self.nodes[1] = start_node(1, self.options.tmpdir, self.node_args[1])\n+        self.nodes[1].encryptwallet('test')\n+        bitcoind_processes[1].wait()\n+        # node will be stopped during encryption, now do a backup\n+        shutil.copyfile(tmpdir + \"/node1/regtest/wallet.dat\", tmpdir + \"/hd.enc.bak\") \n+\n+        # start the node with encrypted wallet, get address in new pool at pos 50 (over the gap limit)\n+        self.nodes[1] = start_node(1, self.options.tmpdir, self.node_args[1])\n+        for _ in range(50):\n+            addr_enc_oldpool = self.nodes[1].getnewaddress()\n+\n+        # now make sure we retrive an address in the extended pool\n+        self.nodes[1].walletpassphrase(\"test\", 10)\n+        for _ in range(80):\n+            addr_enc_extpool = self.nodes[1].getnewaddress()\n+\n+        # stop and load initial backup of the unencrypted wallet\n+        self.stop_node(1)\n+        os.remove(tmpdir + \"/node1/regtest/wallet.dat\")\n+        shutil.copyfile(tmpdir + \"/hd.bak\", tmpdir + \"/node1/regtest/wallet.dat\")\n+        self.nodes[1] = start_node(1, self.options.tmpdir, self.node_args[1])\n+        connect_nodes_bi(self.nodes,0,1)\n+        for _ in range(10):\n+            addr = self.nodes[1].getnewaddress()\n+\n+        self.nodes[0].generate(101)\n+        addr = self.nodes[1].getnewaddress()\n+        assert_equal(self.nodes[1].validateaddress(addr)['hdkeypath'], \"m/0'/0'/11'\")\n+\n+        rawch = self.nodes[1].getrawchangeaddress()\n+        txid = self.nodes[0].sendtoaddress(addr, 1)\n+        n0addr = self.nodes[0].getnewaddress()\n+        txdata = self.nodes[0].createrawtransaction([], {rawch : 2.0, n0addr: 3.0})\n+\n+        txdata_f = self.nodes[0].fundrawtransaction(txdata)\n+        txdata_s = self.nodes[0].signrawtransaction(txdata_f['hex'])\n+        txid = self.nodes[0].sendrawtransaction(txdata_s['hex'])\n+\n+        self.sync_all()\n+        self.nodes[0].generate(1)\n+        self.sync_all()\n+\n+        assert_equal(self.nodes[1].getbalance(), 3)\n+        assert_equal(self.nodes[1].listtransactions()[0]['category'], \"receive\")\n+\n+        print(\"Testing with unencrypted wallet\")\n+        self.stop_node(1)\n+        shutil.rmtree(tmpdir + \"/node1/regtest\")",
      "path": "test/functional/wallet-hd-restore.py",
      "position": 82,
      "original_position": 82,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "please don't do this! It erases the debug.log file. Are you able to be more targeted in what you're erasing?",
      "created_at": "2017-06-12T23:00:35Z",
      "updated_at": "2017-06-12T23:06:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r121547328",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121547328"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 82,
      "original_line": 82,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121547598",
      "pull_request_review_id": 43576283,
      "id": 121547598,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTU0NzU5OA==",
      "diff_hunk": "@@ -0,0 +1,162 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test Hierarchical Deterministic wallet function.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+import os\n+import shutil\n+from pprint import pprint\n+\n+class WalletHDRestoreTest(BitcoinTestFramework):\n+\n+    def __init__(self):\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.node_args = [['-usehd=0'], ['-usehd=1', '-keypool=100', '-hdignoregaplimit=0']]\n+\n+    def setup_network(self):\n+        self.nodes = start_nodes(self.num_nodes, self.options.tmpdir, self.node_args)\n+        self.is_network_split = False\n+        connect_nodes_bi(self.nodes, 0, 1)\n+\n+    def run_test (self):\n+        tmpdir = self.options.tmpdir\n+\n+        print(\"Initialize wallet including backups of unencrypted and encrypted wallet\")\n+        # stop and backup original wallet (only keypool has been initialized)\n+        self.stop_node(1)\n+        shutil.copyfile(tmpdir + \"/node1/regtest/wallet.dat\", tmpdir + \"/hd.bak\")\n+\n+        # start again and encrypt wallet\n+        self.nodes[1] = start_node(1, self.options.tmpdir, self.node_args[1])\n+        self.nodes[1].encryptwallet('test')\n+        bitcoind_processes[1].wait()\n+        # node will be stopped during encryption, now do a backup\n+        shutil.copyfile(tmpdir + \"/node1/regtest/wallet.dat\", tmpdir + \"/hd.enc.bak\") \n+\n+        # start the node with encrypted wallet, get address in new pool at pos 50 (over the gap limit)\n+        self.nodes[1] = start_node(1, self.options.tmpdir, self.node_args[1])\n+        for _ in range(50):\n+            addr_enc_oldpool = self.nodes[1].getnewaddress()\n+\n+        # now make sure we retrive an address in the extended pool\n+        self.nodes[1].walletpassphrase(\"test\", 10)\n+        for _ in range(80):\n+            addr_enc_extpool = self.nodes[1].getnewaddress()\n+\n+        # stop and load initial backup of the unencrypted wallet\n+        self.stop_node(1)\n+        os.remove(tmpdir + \"/node1/regtest/wallet.dat\")\n+        shutil.copyfile(tmpdir + \"/hd.bak\", tmpdir + \"/node1/regtest/wallet.dat\")\n+        self.nodes[1] = start_node(1, self.options.tmpdir, self.node_args[1])\n+        connect_nodes_bi(self.nodes,0,1)\n+        for _ in range(10):\n+            addr = self.nodes[1].getnewaddress()\n+\n+        self.nodes[0].generate(101)\n+        addr = self.nodes[1].getnewaddress()\n+        assert_equal(self.nodes[1].validateaddress(addr)['hdkeypath'], \"m/0'/0'/11'\")\n+\n+        rawch = self.nodes[1].getrawchangeaddress()\n+        txid = self.nodes[0].sendtoaddress(addr, 1)",
      "path": "test/functional/wallet-hd-restore.py",
      "position": 65,
      "original_position": 65,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`txid` isn't used. No need to assign it here or below.",
      "created_at": "2017-06-12T23:02:31Z",
      "updated_at": "2017-06-12T23:06:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r121547598",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121547598"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 65,
      "original_line": 65,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121548023",
      "pull_request_review_id": 43576283,
      "id": 121548023,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyMTU0ODAyMw==",
      "diff_hunk": "@@ -75,10 +75,12 @@ def run_test (self):\n \n         self.log.info(\"Restore backup ...\")\n         self.stop_node(1)\n-        os.remove(self.options.tmpdir + \"/node1/regtest/wallet.dat\")\n+        # we need to delete the complete regtest directory\n+        # otherwise node1 would auto-recover all funds in flag the keypool keys as used",
      "path": "test/functional/wallet-hd.py",
      "position": 6,
      "original_position": 6,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "cada7263fa95dff17ec2bab3b3b081cfdec2ae8e",
      "in_reply_to_id": 115077168,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I'm also confused about why wallet-hd.py needs to be updated.",
      "created_at": "2017-06-12T23:05:12Z",
      "updated_at": "2017-06-12T23:06:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r121548023",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/121548023"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 78,
      "original_line": 78,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127095122",
      "pull_request_review_id": 49644483,
      "id": 127095122,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyNzA5NTEyMg==",
      "diff_hunk": "@@ -0,0 +1,162 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test Hierarchical Deterministic wallet function.\"\"\"",
      "path": "test/functional/wallet-hd-restore.py",
      "position": 5,
      "original_position": 5,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": 121546151,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Please address.",
      "created_at": "2017-07-12T23:10:44Z",
      "updated_at": "2017-07-12T23:18:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r127095122",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127095122"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 5,
      "original_line": 5,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127095162",
      "pull_request_review_id": 49644483,
      "id": 127095162,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyNzA5NTE2Mg==",
      "diff_hunk": "@@ -0,0 +1,162 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2017 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test Hierarchical Deterministic wallet function.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import *\n+import os\n+import shutil\n+from pprint import pprint\n+\n+class WalletHDRestoreTest(BitcoinTestFramework):\n+\n+    def __init__(self):\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.node_args = [['-usehd=0'], ['-usehd=1', '-keypool=100', '-hdignoregaplimit=0']]\n+\n+    def setup_network(self):\n+        self.nodes = start_nodes(self.num_nodes, self.options.tmpdir, self.node_args)\n+        self.is_network_split = False\n+        connect_nodes_bi(self.nodes, 0, 1)\n+\n+    def run_test (self):\n+        tmpdir = self.options.tmpdir\n+\n+        print(\"Initialize wallet including backups of unencrypted and encrypted wallet\")\n+        # stop and backup original wallet (only keypool has been initialized)\n+        self.stop_node(1)\n+        shutil.copyfile(tmpdir + \"/node1/regtest/wallet.dat\", tmpdir + \"/hd.bak\")\n+\n+        # start again and encrypt wallet\n+        self.nodes[1] = start_node(1, self.options.tmpdir, self.node_args[1])\n+        self.nodes[1].encryptwallet('test')\n+        bitcoind_processes[1].wait()\n+        # node will be stopped during encryption, now do a backup\n+        shutil.copyfile(tmpdir + \"/node1/regtest/wallet.dat\", tmpdir + \"/hd.enc.bak\") \n+\n+        # start the node with encrypted wallet, get address in new pool at pos 50 (over the gap limit)\n+        self.nodes[1] = start_node(1, self.options.tmpdir, self.node_args[1])\n+        for _ in range(50):\n+            addr_enc_oldpool = self.nodes[1].getnewaddress()\n+\n+        # now make sure we retrive an address in the extended pool\n+        self.nodes[1].walletpassphrase(\"test\", 10)\n+        for _ in range(80):\n+            addr_enc_extpool = self.nodes[1].getnewaddress()\n+\n+        # stop and load initial backup of the unencrypted wallet\n+        self.stop_node(1)\n+        os.remove(tmpdir + \"/node1/regtest/wallet.dat\")\n+        shutil.copyfile(tmpdir + \"/hd.bak\", tmpdir + \"/node1/regtest/wallet.dat\")\n+        self.nodes[1] = start_node(1, self.options.tmpdir, self.node_args[1])\n+        connect_nodes_bi(self.nodes,0,1)\n+        for _ in range(10):\n+            addr = self.nodes[1].getnewaddress()\n+\n+        self.nodes[0].generate(101)\n+        addr = self.nodes[1].getnewaddress()\n+        assert_equal(self.nodes[1].validateaddress(addr)['hdkeypath'], \"m/0'/0'/11'\")\n+\n+        rawch = self.nodes[1].getrawchangeaddress()\n+        txid = self.nodes[0].sendtoaddress(addr, 1)\n+        n0addr = self.nodes[0].getnewaddress()\n+        txdata = self.nodes[0].createrawtransaction([], {rawch : 2.0, n0addr: 3.0})\n+\n+        txdata_f = self.nodes[0].fundrawtransaction(txdata)\n+        txdata_s = self.nodes[0].signrawtransaction(txdata_f['hex'])\n+        txid = self.nodes[0].sendrawtransaction(txdata_s['hex'])\n+\n+        self.sync_all()\n+        self.nodes[0].generate(1)\n+        self.sync_all()\n+\n+        assert_equal(self.nodes[1].getbalance(), 3)\n+        assert_equal(self.nodes[1].listtransactions()[0]['category'], \"receive\")\n+\n+        print(\"Testing with unencrypted wallet\")\n+        self.stop_node(1)\n+        shutil.rmtree(tmpdir + \"/node1/regtest\")",
      "path": "test/functional/wallet-hd-restore.py",
      "position": 82,
      "original_position": 82,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": 121547328,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Please address.",
      "created_at": "2017-07-12T23:11:07Z",
      "updated_at": "2017-07-12T23:18:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r127095162",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127095162"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 82,
      "original_line": 82,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127095281",
      "pull_request_review_id": 49644483,
      "id": 127095281,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyNzA5NTI4MQ==",
      "diff_hunk": "@@ -3725,6 +3793,19 @@ CWallet* CWallet::CreateWalletFromFile(const std::string walletFile)\n \n     RegisterValidationInterface(walletInstance);\n \n+    // HD Restore: Make sure we always have a reasonable keypool size if HD is enabled\n+    if (walletInstance->IsHDEnabled()) {\n+        if (walletInstance->IsCrypted()) {\n+            InitWarning(_(\"Your are using an encrypted HD wallet. In case you recover a HD wallet, you may miss incomming or outgoing funds.\"));\n+        }\n+        else {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 100,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "2a203b73fd2d7b016cd5f55977135a15a982414d",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Nit: else on the same line as `}`",
      "created_at": "2017-07-12T23:11:48Z",
      "updated_at": "2017-07-12T23:18:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r127095281",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127095281"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3801,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127095453",
      "pull_request_review_id": 49644483,
      "id": 127095453,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDEyNzA5NTQ1Mw==",
      "diff_hunk": "@@ -480,6 +480,9 @@ void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vector<con\n     // Make sure pindexBestKnownBlock is up to date, we'll need it.\n     ProcessBlockAvailability(nodeid);\n \n+    if (isBlockRequestsPaused())",
      "path": "src/net_processing.cpp",
      "position": 4,
      "original_position": 4,
      "commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "original_commit_id": "4cbc21689c359fee67e877355c04f808b2f749d6",
      "in_reply_to_id": 121538932,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Please address.",
      "created_at": "2017-07-12T23:12:57Z",
      "updated_at": "2017-07-12T23:18:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/10240#discussion_r127095453",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/127095453"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10240"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 483,
      "original_line": 483,
      "side": "RIGHT"
    }
  ]
}