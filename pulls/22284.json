{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22284",
    "id": 673907152,
    "node_id": "MDExOlB1bGxSZXF1ZXN0NjczOTA3MTUy",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22284",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/22284.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/22284.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22284",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22284/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22284/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22284/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/b1d905c225e87a4a289c0cd3593c6c21cea3fba7",
    "number": 22284,
    "state": "closed",
    "locked": true,
    "maintainer_can_modify": false,
    "title": "p2p, refactor: performance improvements to ProtectEvictionCandidatesByRatio()",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This follow-up to #21261 improves `ProtectEvictionCandidatesByRatio()` for better performance. \r\n\r\nBenchmarks are added; the performance improvement is between 2x and 5x for the benchmarked cases (CPU 2.50GHz, Turbo off, performance mode, Debian Clang 11 non-debug build).\r\n\r\n```\r\n$ ./src/bench/bench_bitcoin -filter=\"EvictionProtection*.*\"\r\n```\r\n\r\nThe refactored code is well-covered by existing unit tests and also a fuzzer.\r\n\r\n- `$ ./src/test/test_bitcoin -t net_peer_eviction_tests`\r\n- `$ FUZZ=node_eviction ./src/test/fuzz/fuzz ../qa-assets/fuzz_seed_corpus/node_eviction`\r\n",
    "labels": [
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      }
    ],
    "active_lock_reason": "resolved",
    "created_at": "2021-06-19T16:59:25Z",
    "updated_at": "2022-08-18T18:31:59Z",
    "closed_at": "2021-07-15T12:50:15Z",
    "mergeable_state": "unknown",
    "merged_at": "2021-07-15T12:50:15Z",
    "merge_commit_sha": "21998bc028d6d72229ae826d2dd9d78981367952",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "head": {
      "label": "jonatack:ProtectEvictionCandidatesByRatio-perf-enhancements",
      "ref": "ProtectEvictionCandidatesByRatio-perf-enhancements",
      "sha": "b1d905c225e87a4a289c0cd3593c6c21cea3fba7",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 173103842,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNzMxMDM4NDI=",
        "name": "bitcoin",
        "full_name": "jonatack/bitcoin",
        "owner": {
          "login": "jonatack",
          "id": 2415484,
          "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/jonatack",
          "html_url": "https://github.com/jonatack",
          "followers_url": "https://api.github.com/users/jonatack/followers",
          "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
          "organizations_url": "https://api.github.com/users/jonatack/orgs",
          "repos_url": "https://api.github.com/users/jonatack/repos",
          "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/jonatack/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/jonatack/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/jonatack/bitcoin",
        "archive_url": "https://api.github.com/repos/jonatack/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/jonatack/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/jonatack/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/jonatack/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/jonatack/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/jonatack/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/jonatack/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/jonatack/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/jonatack/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/jonatack/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/jonatack/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/jonatack/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/jonatack/bitcoin/events",
        "forks_url": "https://api.github.com/repos/jonatack/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/jonatack/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/jonatack/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/jonatack/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/jonatack/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/jonatack/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/jonatack/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/jonatack/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/jonatack/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/jonatack/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/jonatack/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/jonatack/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/jonatack/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/jonatack/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/jonatack/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/jonatack/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:jonatack/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/jonatack/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/jonatack/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/jonatack/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/jonatack/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/jonatack/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/jonatack/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/jonatack/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/jonatack/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/jonatack/bitcoin/hooks",
        "svn_url": "https://github.com/jonatack/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 1,
        "stargazers_count": 1,
        "watchers_count": 1,
        "size": 217428,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-05-31T14:39:25Z",
        "created_at": "2019-02-28T11:57:18Z",
        "updated_at": "2023-01-03T22:00:49Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "4129134e844f78a89f8515cf30dad4b6074703c7",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 34324,
        "stargazers_count": 69819,
        "watchers_count": 69819,
        "size": 233879,
        "default_branch": "master",
        "open_issues_count": 627,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-06T22:42:00Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-06-07T04:47:18Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22284"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 194,
    "deletions": 27,
    "changed_files": 6,
    "commits": 5,
    "review_comments": 13,
    "comments": 10
  },
  "events": [
    {
      "event": "labeled",
      "id": 4912678349,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDQ5MTI2NzgzNDk=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4912678349",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-19T17:35:43Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4912738079,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDkxMjczODA3OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4912738079",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-19T19:05:02Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4912753190,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDkxMjc1MzE5MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4912753190",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-19T19:27:34Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4913469594,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDkxMzQ2OTU5NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4913469594",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-20T14:33:04Z"
    },
    {
      "event": "commented",
      "id": 864564794,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg2NDU2NDc5NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/864564794",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-20T14:39:43Z",
      "updated_at": "2021-06-20T15:26:32Z",
      "author_association": "MEMBER",
      "body": "Added benchmarks. This pull speeds up `ProtectEvictionCandidatesByRatio()` between 2x and 6x for the benchmarked cases. It's not a hotspot, but the improvement is significant.\r\n\r\n\r\n```\r\n$ ./src/bench/bench_bitcoin -filter=EvictionProtection*.*\r\n```\r\n\r\nmaster\r\n\r\n```rake\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|    5,403,043,444.00 |                0.19 |    1.8% |     59.74 | `EvictionProtection1Network250Candidates`\r\n|    2,946,547,379.00 |                0.34 |    2.7% |     33.45 | `EvictionProtection3Networks050Candidates`\r\n|    2,798,691,071.00 |                0.36 |    2.2% |     30.79 | `EvictionProtection3Networks100Candidates`\r\n|    7,288,364,370.00 |                0.14 |    0.7% |     80.16 | `EvictionProtection3Networks250Candidates`\r\n```\r\n\r\nthis PR\r\n\r\n```rake\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|    1,183,198,205.00 |                0.85 |    1.2% |     13.12 | `EvictionProtection1Network250Candidates`\r\n|    1,151,709,186.00 |                0.87 |    1.7% |     12.67 | `EvictionProtection3Networks050Candidates`\r\n|    1,261,170,266.00 |                0.79 |    2.9% |     14.26 | `EvictionProtection3Networks100Candidates`\r\n|    1,157,625,808.00 |                0.86 |    1.0% |     12.95 | `EvictionProtection3Networks250Candidates`\r\n```\r\n\r\n------\r\n\r\n(intermediate commits)\r\n\r\n*p2p: iterate over eviction candidates once instead of thrice*\r\n\r\n```rake\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|    3,952,529,089.00 |                0.25 |    1.8% |     43.47 | `EvictionProtection1Network250Candidates`\r\n|    2,239,435,919.00 |                0.45 |    3.8% |     25.85 | `EvictionProtection3Networks050Candidates`\r\n|    2,060,389,113.00 |                0.49 |    1.9% |     22.85 | `EvictionProtection3Networks100Candidates`\r\n|    5,258,681,959.00 |                0.19 |    1.0% |     58.26 | `EvictionProtection3Networks250Candidates`\r\n```\r\n\r\n*p2p: iterate eviction protection only on networks having candidates*\r\n\r\n```rake\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|    1,224,597,989.00 |                0.82 |    2.2% |     13.60 | `EvictionProtection1Network250Candidates`\r\n```\r\n",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#issuecomment-864564794",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22284"
    },
    {
      "event": "commented",
      "id": 864569995,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg2NDU2OTk5NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/864569995",
      "actor": {
        "login": "klementtan",
        "id": 49265907,
        "node_id": "MDQ6VXNlcjQ5MjY1OTA3",
        "avatar_url": "https://avatars.githubusercontent.com/u/49265907?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/klementtan",
        "html_url": "https://github.com/klementtan",
        "followers_url": "https://api.github.com/users/klementtan/followers",
        "following_url": "https://api.github.com/users/klementtan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/klementtan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/klementtan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/klementtan/subscriptions",
        "organizations_url": "https://api.github.com/users/klementtan/orgs",
        "repos_url": "https://api.github.com/users/klementtan/repos",
        "events_url": "https://api.github.com/users/klementtan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/klementtan/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-20T15:18:18Z",
      "updated_at": "2021-06-20T15:18:18Z",
      "author_association": "CONTRIBUTOR",
      "body": "Tested on macOs 11.4 and this PR indeed optimize it by 1.3x to 5x. \r\n\r\n<details> \r\n<summary> Test result </summary>\r\n\r\nOn 272f327fbfcb8bb61f8e1c9d65c665372cd60976(master with benchmarks):\r\n```\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|      756,331,588.00 |                1.32 |    1.2% |      8.38 | `EvictionProtection1Network250Candidates`\r\n|    1,579,971,776.00 |                0.63 |    1.1% |     17.45 | `EvictionProtection3Networks050Candidates`\r\n|    1,395,431,168.00 |                0.72 |    1.0% |     15.70 | `EvictionProtection3Networks100Candidates`\r\n|    3,716,091,921.00 |                0.27 |    1.0% |     41.32 | `EvictionProtection3Networks250Candidates`\r\n```\r\nThis PR:\r\n```          \r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|      492,425,456.00 |                2.03 |    0.9% |      5.45 | `EvictionProtection1Network250Candidates`\r\n|      739,073,603.00 |                1.35 |    1.3% |      8.13 | `EvictionProtection3Networks050Candidates`\r\n|      937,281,186.00 |                1.07 |    0.7% |     10.38 | `EvictionProtection3Networks100Candidates`\r\n|      828,820,224.00 |                1.21 |    1.6% |      9.10 | `EvictionProtection3Networks250Candidates`\r\n```\r\n</details>\r\n\r\nNot sure if it is an issue on my side but I had to test with `./src/bench/bench_bitcoin -filter=\"EvictionProtection*.*\"`(quotes around regex) instead of the command provided by the PR description. ",
      "user": {
        "login": "klementtan",
        "id": 49265907,
        "node_id": "MDQ6VXNlcjQ5MjY1OTA3",
        "avatar_url": "https://avatars.githubusercontent.com/u/49265907?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/klementtan",
        "html_url": "https://github.com/klementtan",
        "followers_url": "https://api.github.com/users/klementtan/followers",
        "following_url": "https://api.github.com/users/klementtan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/klementtan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/klementtan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/klementtan/subscriptions",
        "organizations_url": "https://api.github.com/users/klementtan/orgs",
        "repos_url": "https://api.github.com/users/klementtan/repos",
        "events_url": "https://api.github.com/users/klementtan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/klementtan/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#issuecomment-864569995",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22284"
    },
    {
      "event": "commented",
      "id": 864586340,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg2NDU4NjM0MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/864586340",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-20T17:24:58Z",
      "updated_at": "2021-06-24T13:40:42Z",
      "author_association": "MEMBER",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19377 by hebasto\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#issuecomment-864586340",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22284"
    },
    {
      "event": "reviewed",
      "id": 688883188,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Njg4ODgzMTg4",
      "url": null,
      "actor": null,
      "commit_id": "ab2993336fbdff72d125f906c2baec4c5dcb79e3",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK ab2993336fbdff72d125f906c2baec4c5dcb79e3\r\n\r\nThis is quite a performance improvement and is a clear change which is easy to follow. My benchmark tests confirm the performance improvement. Thanks for working on this improvement and for adding additional benchmark coverage.\r\n\r\nRan benchmarks upon each intermediate commit to test performance improvement at every stage. Cherry-picked each commit on top of current master and ran unit tests which each commit cherry-picked.\r\n\r\n**Master**\r\n```\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|    2,283,211,027.00 |                0.44 |    0.1% |     25.13 | `EvictionProtection1Network250Candidates`\r\n|    1,417,424,933.00 |                0.71 |    0.1% |     15.59 | `EvictionProtection3Networks050Candidates`\r\n|    1,293,719,559.00 |                0.77 |    0.1% |     14.25 | `EvictionProtection3Networks100Candidates`\r\n|    3,350,000,724.00 |                0.30 |    0.1% |     36.88 | `EvictionProtection3Networks250Candidates`\r\n```\r\n\r\n**PR**\r\n```\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|      778,011,162.00 |                1.29 |    0.3% |      8.56 | `EvictionProtection1Network250Candidates`\r\n|      811,555,934.00 |                1.23 |    0.1% |      8.93 | `EvictionProtection3Networks050Candidates`\r\n|      806,194,432.00 |                1.24 |    0.1% |      8.87 | `EvictionProtection3Networks100Candidates`\r\n|      776,191,251.00 |                1.29 |    0.1% |      8.54 | `EvictionProtection3Networks250Candidates`\r\n```\r\n\r\n### Notes on commits \r\n\r\n- [x] 272f327fbfcb8bb61f8e1c9d65c665372cd60976\r\n  - Definition of test is appropriate and effective in terms of benchmarking what we care about\r\n- [x] 99a25fb393c791bb6b6edeab3677d39bf6b1d97d\r\n  - the performance boost is from moving away from looping through each network and then interating through all `eviction_candidates` -> iterate through `eviction_candidates` once; for each candidate we iterate through add count to appropriate network\r\n  - Still appropriately counts eviction candidates per network\r\n  - Performance improvement at this stage is very modest compared to `master+272f327fbfcb8bb61f8e1c9d65c665372cd60976`\r\n- [x] 06b898c3e126ff7f1a17d8d3a5f7c9e1aad0ea06\r\n  - uses lambda expression in `std::count_if` to efficiently determine networks we have candidates from\r\n  - PR description states that \"... increase the number protected per peer iteration\", this would only come into play if there was a descrease in the number of networks to protect because we detected there were no candidates in that network. If you have to retouch, can you document this more clearly?\r\n  - this and 99a25fb393c791bb6b6edeab3677d39bf6b1d97d make up the bulk of the performance improvement\r\n- [x] 478534340e9b30f4e906da290e3b763dec6c945c \r\n  - makes sense 🥃\r\n- [x] ab2993336fbdff72d125f906c2baec4c5dcb79e3\r\n  - Is an additional performance improvement ",
      "user": {
        "login": "jarolrod",
        "id": 23396902,
        "node_id": "MDQ6VXNlcjIzMzk2OTAy",
        "avatar_url": "https://avatars.githubusercontent.com/u/23396902?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jarolrod",
        "html_url": "https://github.com/jarolrod",
        "followers_url": "https://api.github.com/users/jarolrod/followers",
        "following_url": "https://api.github.com/users/jarolrod/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jarolrod/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jarolrod/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jarolrod/subscriptions",
        "organizations_url": "https://api.github.com/users/jarolrod/orgs",
        "repos_url": "https://api.github.com/users/jarolrod/repos",
        "events_url": "https://api.github.com/users/jarolrod/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jarolrod/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#pullrequestreview-688883188",
      "submitted_at": "2021-06-21T21:39:48Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22284"
    },
    {
      "event": "commented",
      "id": 866133352,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg2NjEzMzM1Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/866133352",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-22T16:22:17Z",
      "updated_at": "2021-06-22T16:22:17Z",
      "author_association": "MEMBER",
      "body": "Concept ACK",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#issuecomment-866133352",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22284"
    },
    {
      "event": "mentioned",
      "id": 4943208706,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDk0MzIwODcwNg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4943208706",
      "actor": {
        "login": "jarolrod",
        "id": 23396902,
        "node_id": "MDQ6VXNlcjIzMzk2OTAy",
        "avatar_url": "https://avatars.githubusercontent.com/u/23396902?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jarolrod",
        "html_url": "https://github.com/jarolrod",
        "followers_url": "https://api.github.com/users/jarolrod/followers",
        "following_url": "https://api.github.com/users/jarolrod/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jarolrod/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jarolrod/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jarolrod/subscriptions",
        "organizations_url": "https://api.github.com/users/jarolrod/orgs",
        "repos_url": "https://api.github.com/users/jarolrod/repos",
        "events_url": "https://api.github.com/users/jarolrod/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jarolrod/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-26T18:18:33Z"
    },
    {
      "event": "subscribed",
      "id": 4943208707,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ5NDMyMDg3MDc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4943208707",
      "actor": {
        "login": "jarolrod",
        "id": 23396902,
        "node_id": "MDQ6VXNlcjIzMzk2OTAy",
        "avatar_url": "https://avatars.githubusercontent.com/u/23396902?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jarolrod",
        "html_url": "https://github.com/jarolrod",
        "followers_url": "https://api.github.com/users/jarolrod/followers",
        "following_url": "https://api.github.com/users/jarolrod/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jarolrod/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jarolrod/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jarolrod/subscriptions",
        "organizations_url": "https://api.github.com/users/jarolrod/orgs",
        "repos_url": "https://api.github.com/users/jarolrod/repos",
        "events_url": "https://api.github.com/users/jarolrod/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jarolrod/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-26T18:18:33Z"
    },
    {
      "event": "reviewed",
      "id": 695881962,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Njk1ODgxOTYy",
      "url": null,
      "actor": null,
      "commit_id": "ab2993336fbdff72d125f906c2baec4c5dcb79e3",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#pullrequestreview-695881962",
      "submitted_at": "2021-06-30T09:48:30Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22284"
    },
    {
      "event": "referenced",
      "id": 4975710327,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDQ5NzU3MTAzMjc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4975710327",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "c609e10545492aba480ff17aff7eefc13a0b5cd8",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c609e10545492aba480ff17aff7eefc13a0b5cd8",
      "created_at": "2021-07-05T00:48:11Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1NjYzNTdmOGY3NDcxZjc0NzI5Mjk3ODY4OTE3YWEzMmY2ZDNjMzkw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/566357f8f7471f74729297868917aa32f6d3c390",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/566357f8f7471f74729297868917aa32f6d3c390",
      "tree": {
        "sha": "1ae0de3c612f40af7af9cbc76adc88f6935ec48f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1ae0de3c612f40af7af9cbc76adc88f6935ec48f"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 1ae0de3c612f40af7af9cbc76adc88f6935ec48f\nparent 088b348dbe82689ce1782653c8fdcebb3b636eb5\nauthor Jon Atack <jon@atack.com> 1625136531 +0200\ncommitter Jon Atack <jon@atack.com> 1625585295 +0200\n\nrefactor: move GetRandomNodeEvictionCandidates() to test utilities\n\nCo-authored-by: Vasil Dimov <vd@FreeBSD.org>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmDkdpAACgkQT1chs9Dj\nkh1yABAApNw3iZEQNUUxZJrTAH/oozi/yubDKcDvWM9ihcfbGf4UKX3JQ1ZRkkUW\n9Ahei/hSUcJvnmKU4+Qy5sKz1+SKto0Qd0pda4qanfS2W+0Jc9owDsPjPsSWx3tk\np+65/H1PtkiPKHQmHxFC6kgWXsobwdW4WDgOYowrmbQlGi9EkQl+YzfRV/Vf1zIG\nAWep/8dx74EiOjGOeEsvw1e9WY2ydCIdH2wdVmbgkl571ahoNhbI1OjtvkKd59xE\n1dNCNuM44vkmcOSayB2TMt3BNH6xozdh4WMjeCU/qUF4NJnyAbCFCl6YOaeLwFQm\nlAHFB5JCgkm2RblM6Ttp2aFnQ2jvoCnhMD1L7gOd7fP8Hu6bQ0WMLNy3joNEUsBi\njqCGycNY4cDcX5x5JNjKHeD+L5wpYwgA1BSoc0Ata3iJ9rCWMOUelqHOqZAatoBC\n2BG1EORcYE2QXAW5C45MXZFZ2xjwKfrxEnlYMTxX6mfHrmAZdkHICXD4UI5GDogq\nnawy8qaA4wWPrmy5CwgCmDEera7kjQ/SxxZhz/NOe4+OFgmOhKl6vZJM7t/kXwi2\nFODnGEd0DbvD1VcU3RKkRKpyCtTWAnJlJnLRkeyNRY/bK8V/DmljYnQlncKQDf6I\nMDMv9kVWnXJWOSOeYDEwIPknWgXFnYJQRpTl/xSw7Ic1uJ+A4Aw=\n=Ssmz\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwICgTAjWfVX9JI54MCE+PCvhFRL0guAia9Vvcz4R282fDCP/wEAUpgjGId9Ry\nwIxjh9iYW2EI8SBFjcuZgdOfCDZbtc1Vt7bbx6/16iYcE4WHoHJCDSet8wjxBGDk\ndpLwCJJxi25sa8XuAIPf4w0u+QyOLi1odHRwczovL2FsaWNlLmJ0Yy5jYWxlbmRh\nci5vcGVudGltZXN0YW1wcy5vcmf/8BAnwv7YNAOQaKP2eyDal6dTCPEEYOR2kvAI\nrzpNP7tgmV8Ag9/jDS75DI4sK2h0dHBzOi8vYm9iLmJ0Yy5jYWxlbmRhci5vcGVu\ndGltZXN0YW1wcy5vcmf/8BBJxTme/Au5IWKknLFZpvFQCPEEYOR2kfAIDzILc4Fe\nx/sAg9/jDS75DI4jImh0dHBzOi8vYnRjLmNhbGVuZGFyLmNhdGFsbGF4eS5jb23w\nEJhbr47f16WiUyAeTpdvh+cI8QRg5HaR8Aj6BZwsvb/gSwCD3+MNLvkMjikoaHR0\ncHM6Ly9maW5uZXkuY2FsZW5kYXIuZXRlcm5pdHl3YWxsLmNvbQ==\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/088b348dbe82689ce1782653c8fdcebb3b636eb5",
          "sha": "088b348dbe82689ce1782653c8fdcebb3b636eb5",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/088b348dbe82689ce1782653c8fdcebb3b636eb5"
        }
      ],
      "message": "refactor: move GetRandomNodeEvictionCandidates() to test utilities\n\nCo-authored-by: Vasil Dimov <vd@FreeBSD.org>",
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-07-06T15:28:15Z"
      },
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-07-01T10:48:51Z"
      },
      "sha": "566357f8f7471f74729297868917aa32f6d3c390"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4984384791,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDk4NDM4NDc5MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4984384791",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-06T16:41:06Z"
    },
    {
      "event": "commented",
      "id": 874919226,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3NDkxOTIyNg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/874919226",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-06T16:46:07Z",
      "updated_at": "2021-07-06T16:46:07Z",
      "author_association": "MEMBER",
      "body": "Thank you @vasild, @jarolrod, @klementtan and @theStack; feedback taken (and rebased, apologies).",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#issuecomment-874919226",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22284"
    },
    {
      "event": "mentioned",
      "id": 4984407639,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDk4NDQwNzYzOQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4984407639",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-06T16:46:07Z"
    },
    {
      "event": "subscribed",
      "id": 4984407642,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ5ODQ0MDc2NDI=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4984407642",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-06T16:46:08Z"
    },
    {
      "event": "mentioned",
      "id": 4984407643,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDk4NDQwNzY0Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4984407643",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-06T16:46:08Z"
    },
    {
      "event": "subscribed",
      "id": 4984407645,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ5ODQ0MDc2NDU=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4984407645",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-06T16:46:08Z"
    },
    {
      "event": "mentioned",
      "id": 4984407647,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDk4NDQwNzY0Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4984407647",
      "actor": {
        "login": "jarolrod",
        "id": 23396902,
        "node_id": "MDQ6VXNlcjIzMzk2OTAy",
        "avatar_url": "https://avatars.githubusercontent.com/u/23396902?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jarolrod",
        "html_url": "https://github.com/jarolrod",
        "followers_url": "https://api.github.com/users/jarolrod/followers",
        "following_url": "https://api.github.com/users/jarolrod/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jarolrod/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jarolrod/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jarolrod/subscriptions",
        "organizations_url": "https://api.github.com/users/jarolrod/orgs",
        "repos_url": "https://api.github.com/users/jarolrod/repos",
        "events_url": "https://api.github.com/users/jarolrod/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jarolrod/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-06T16:46:08Z"
    },
    {
      "event": "subscribed",
      "id": 4984407650,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ5ODQ0MDc2NTA=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4984407650",
      "actor": {
        "login": "jarolrod",
        "id": 23396902,
        "node_id": "MDQ6VXNlcjIzMzk2OTAy",
        "avatar_url": "https://avatars.githubusercontent.com/u/23396902?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jarolrod",
        "html_url": "https://github.com/jarolrod",
        "followers_url": "https://api.github.com/users/jarolrod/followers",
        "following_url": "https://api.github.com/users/jarolrod/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jarolrod/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jarolrod/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jarolrod/subscriptions",
        "organizations_url": "https://api.github.com/users/jarolrod/orgs",
        "repos_url": "https://api.github.com/users/jarolrod/repos",
        "events_url": "https://api.github.com/users/jarolrod/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jarolrod/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-06T16:46:08Z"
    },
    {
      "event": "mentioned",
      "id": 4984407656,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDk4NDQwNzY1Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4984407656",
      "actor": {
        "login": "klementtan",
        "id": 49265907,
        "node_id": "MDQ6VXNlcjQ5MjY1OTA3",
        "avatar_url": "https://avatars.githubusercontent.com/u/49265907?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/klementtan",
        "html_url": "https://github.com/klementtan",
        "followers_url": "https://api.github.com/users/klementtan/followers",
        "following_url": "https://api.github.com/users/klementtan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/klementtan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/klementtan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/klementtan/subscriptions",
        "organizations_url": "https://api.github.com/users/klementtan/orgs",
        "repos_url": "https://api.github.com/users/klementtan/repos",
        "events_url": "https://api.github.com/users/klementtan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/klementtan/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-06T16:46:08Z"
    },
    {
      "event": "subscribed",
      "id": 4984407658,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ5ODQ0MDc2NTg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4984407658",
      "actor": {
        "login": "klementtan",
        "id": 49265907,
        "node_id": "MDQ6VXNlcjQ5MjY1OTA3",
        "avatar_url": "https://avatars.githubusercontent.com/u/49265907?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/klementtan",
        "html_url": "https://github.com/klementtan",
        "followers_url": "https://api.github.com/users/klementtan/followers",
        "following_url": "https://api.github.com/users/klementtan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/klementtan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/klementtan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/klementtan/subscriptions",
        "organizations_url": "https://api.github.com/users/klementtan/orgs",
        "repos_url": "https://api.github.com/users/klementtan/repos",
        "events_url": "https://api.github.com/users/klementtan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/klementtan/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-06T16:46:08Z"
    },
    {
      "event": "commented",
      "id": 875202761,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3NTIwMjc2MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/875202761",
      "actor": {
        "login": "klementtan",
        "id": 49265907,
        "node_id": "MDQ6VXNlcjQ5MjY1OTA3",
        "avatar_url": "https://avatars.githubusercontent.com/u/49265907?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/klementtan",
        "html_url": "https://github.com/klementtan",
        "followers_url": "https://api.github.com/users/klementtan/followers",
        "following_url": "https://api.github.com/users/klementtan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/klementtan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/klementtan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/klementtan/subscriptions",
        "organizations_url": "https://api.github.com/users/klementtan/orgs",
        "repos_url": "https://api.github.com/users/klementtan/repos",
        "events_url": "https://api.github.com/users/klementtan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/klementtan/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-07T01:41:33Z",
      "updated_at": "2021-07-08T13:49:52Z",
      "author_association": "CONTRIBUTOR",
      "body": "Tested on 524aa5dc6a6f20f2fd16a63bd1356d577794d510\r\n- Didn't notice any significant improvement with c0d658f1806a81ae5bf20355861979eb7f7ea1f4\r\n- d2bb6231aaa798590b85700e03dac79f32204aec reduced time for `EvictionProtection1Network250Candidates` by about **40%**\r\n- Didn't notice any significant improvement with edc59d08fc57f5f10657a044224a0b3ae2d2b9bc\r\n- 524aa5dc6a6f20f2fd16a63bd1356d577794d510 reduced time for `EvictionProtection3Networks050Candidates` by about **50%**, `EvictionProtection3Networks100Candidates` by about **40%** and `EvictionProtection3Networks250Candidates` by about **75%**\r\n- Not sure if it is intended but the warning message `:wavy_dash: EvictionProtection3Networks100Candidates (Unstable with ~100.0 iters. Increase minEpochIterations to e.g. 1000)` seems to be quite flaky\r\n\r\n<details> \r\n<summary> Bench Results </summary>\r\n\r\n\r\n**Note:** Results are in reverse chronological order of commits\r\n\r\n<details>\r\n<summary>Master + Bench(edebbe7375de02df544ba9c2b566d62b435c0ab1) results </summary>\r\n\r\n```\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|           14,383.08 |           69,526.14 |    5.1% |      0.02 | :wavy_dash: `EvictionProtection1Network250Candidates` (Unstable with ~100.0 iters. Increase `minEpochIterations` to e.g. 1000)\r\n|            5,818.85 |          171,855.12 |    0.3% |      0.01 | `EvictionProtection3Networks050Candidates`\r\n|           13,127.23 |           76,177.56 |    1.8% |      0.01 | `EvictionProtection3Networks100Candidates`\r\n|           92,835.73 |           10,771.71 |    7.0% |      0.09 | :wavy_dash: `EvictionProtection3Networks250Candidates` (Unstable with ~100.0 iters. Increase `minEpochIterations` to e.g. 1000)\r\n```\r\n\r\n</details>\r\n\r\n\r\n<details>\r\n<summary>c0d658f1806a81ae5bf20355861979eb7f7ea1f4 results </summary>\r\n\r\n```\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|           13,408.72 |           74,578.36 |    1.7% |      0.01 | `EvictionProtection1Network250Candidates`\r\n|            5,610.19 |          178,247.08 |    0.1% |      0.01 | `EvictionProtection3Networks050Candidates`\r\n|           13,536.82 |           73,872.57 |    6.3% |      0.01 | :wavy_dash: `EvictionProtection3Networks100Candidates` (Unstable with ~100.0 iters. Increase `minEpochIterations` to e.g. 1000)\r\n|           87,720.01 |           11,399.91 |    2.2% |      0.09 | `EvictionProtection3Networks250Candidates`\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>d2bb6231aaa798590b85700e03dac79f32204aec results </summary>\r\n\r\n```\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|            8,080.88 |          123,748.98 |    2.8% |      0.01 | `EvictionProtection1Network250Candidates`\r\n|            5,650.52 |          176,974.71 |    0.1% |      0.01 | `EvictionProtection3Networks050Candidates`\r\n|           13,847.64 |           72,214.45 |   11.6% |      0.01 | :wavy_dash: `EvictionProtection3Networks100Candidates` (Unstable with ~100.0 iters. Increase `minEpochIterations` to e.g. 1000)\r\n|           88,185.71 |           11,339.71 |    1.8% |      0.09 | `EvictionProtection3Networks250Candidates`\r\n```\r\n</details>\r\n\r\n\r\n<details>\r\n<summary> edc59d08fc57f5f10657a044224a0b3ae2d2b9bc resutls</summary>\r\n```\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|            7,874.32 |          126,995.09 |    0.9% |      0.01 | `EvictionProtection1Network250Candidates`\r\n|            5,736.20 |          174,331.44 |    1.0% |      0.01 | `EvictionProtection3Networks050Candidates`\r\n|           13,836.98 |           72,270.11 |    9.0% |      0.02 | :wavy_dash: `EvictionProtection3Networks100Candidates` (Unstable with ~100.0 iters. Increase `minEpochIterations` to e.g. 1000)\r\n|           98,370.21 |           10,165.68 |    5.4% |      0.10 | :wavy_dash: `EvictionProtection3Networks250Candidates` (Unstable with ~100.0 iters. Increase `minEpochIterations` to e.g. 1000)\r\n```\r\n</details>\r\n\r\n\r\n<details>\r\n<summary> 524aa5dc6a6f20f2fd16a63bd1356d577794d510 results </summary>\r\n\r\n```\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|            7,854.82 |          127,310.36 |    0.6% |      0.01 | `EvictionProtection1Network250Candidates`\r\n|            2,774.58 |          360,414.26 |    0.1% |      0.00 | `EvictionProtection3Networks050Candidates`\r\n|            8,513.58 |          117,459.47 |    0.1% |      0.01 | `EvictionProtection3Networks100Candidates`\r\n|           22,571.88 |           44,302.90 |   10.1% |      0.02 | :wavy_dash: `EvictionProtection3Networks250Candidates` (Unstable with ~100.0 iters. Increase `minEpochIterations` to e.g. 1000)\r\n```\r\n</details>\r\n</details>",
      "user": {
        "login": "klementtan",
        "id": 49265907,
        "node_id": "MDQ6VXNlcjQ5MjY1OTA3",
        "avatar_url": "https://avatars.githubusercontent.com/u/49265907?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/klementtan",
        "html_url": "https://github.com/klementtan",
        "followers_url": "https://api.github.com/users/klementtan/followers",
        "following_url": "https://api.github.com/users/klementtan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/klementtan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/klementtan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/klementtan/subscriptions",
        "organizations_url": "https://api.github.com/users/klementtan/orgs",
        "repos_url": "https://api.github.com/users/klementtan/repos",
        "events_url": "https://api.github.com/users/klementtan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/klementtan/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#issuecomment-875202761",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22284"
    },
    {
      "event": "commented",
      "id": 875523082,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3NTUyMzA4Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/875523082",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-07T11:23:42Z",
      "updated_at": "2021-07-08T13:52:29Z",
      "author_association": "MEMBER",
      "body": "Thanks for testing @klementtan!\r\n\r\n> Didn't notice any significant improvement with [c0d658f](https://github.com/bitcoin/bitcoin/commit/c0d658f1806a81ae5bf20355861979eb7f7ea1f4)\r\n\r\nThanks for pointing this out. The benchmarks don't test it. Will look at adding a bench with no protected networks.\r\n\r\n> Didn't notice any significant improvement with [edc59d0](https://github.com/bitcoin/bitcoin/commit/edc59d08fc57f5f10657a044224a0b3ae2d2b9bc)\r\n\r\nThis commit doesn't help performance <strike>but fixes an off-by-one in the logic that doesn't affect the protection currently, but without it, the last commit would fail the `node_eviction` fuzzer by trying to save (1 - 2) = -1 into `Net::count`, which is `size_t` (unsigned long).</strike> The CI initially reported this, but I can no longer reproduce it locally (thanks @vasild for testing this) and have dropped the commit.\r\n\r\n> Not sure if it is intended but the warning message `:wavy_dash: EvictionProtection3Networks100Candidates (Unstable with ~100.0 iters. Increase `minEpochIterations` to e.g. 1000)` seems to be quite flaky\r\n\r\nThanks for reporting.  The benchmark was sped up in the last push, but am looking at maybe increasing the iterations to improve this.\r\n",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#issuecomment-875523082",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22284"
    },
    {
      "event": "mentioned",
      "id": 4988534433,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDk4ODUzNDQzMw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4988534433",
      "actor": {
        "login": "klementtan",
        "id": 49265907,
        "node_id": "MDQ6VXNlcjQ5MjY1OTA3",
        "avatar_url": "https://avatars.githubusercontent.com/u/49265907?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/klementtan",
        "html_url": "https://github.com/klementtan",
        "followers_url": "https://api.github.com/users/klementtan/followers",
        "following_url": "https://api.github.com/users/klementtan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/klementtan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/klementtan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/klementtan/subscriptions",
        "organizations_url": "https://api.github.com/users/klementtan/orgs",
        "repos_url": "https://api.github.com/users/klementtan/repos",
        "events_url": "https://api.github.com/users/klementtan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/klementtan/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-07T11:23:42Z"
    },
    {
      "event": "subscribed",
      "id": 4988534436,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ5ODg1MzQ0MzY=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4988534436",
      "actor": {
        "login": "klementtan",
        "id": 49265907,
        "node_id": "MDQ6VXNlcjQ5MjY1OTA3",
        "avatar_url": "https://avatars.githubusercontent.com/u/49265907?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/klementtan",
        "html_url": "https://github.com/klementtan",
        "followers_url": "https://api.github.com/users/klementtan/followers",
        "following_url": "https://api.github.com/users/klementtan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/klementtan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/klementtan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/klementtan/subscriptions",
        "organizations_url": "https://api.github.com/users/klementtan/orgs",
        "repos_url": "https://api.github.com/users/klementtan/repos",
        "events_url": "https://api.github.com/users/klementtan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/klementtan/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-07T11:23:42Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4993852337,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDk5Mzg1MjMzNw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4993852337",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-08T09:42:02Z"
    },
    {
      "event": "mentioned",
      "id": 4993854156,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDk5Mzg1NDE1Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4993854156",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-08T09:42:26Z"
    },
    {
      "event": "subscribed",
      "id": 4993854159,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ5OTM4NTQxNTk=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4993854159",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-08T09:42:26Z"
    },
    {
      "event": "commented",
      "id": 876322380,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3NjMyMjM4MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876322380",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-08T10:25:20Z",
      "updated_at": "2021-07-08T14:02:54Z",
      "author_association": "MEMBER",
      "body": "Updated per `git diff 524aa5d b1d905c`\r\n- adjusted the benchmarks to use the default `Epochs` of 11, increased the `epochIterations` from 100 to 1000, and added a warmup of 100; I didn't find a magic sweet spot (I have to run it several times) but this seems to improve the `err%` somewhat while keeping the benchmark fast\r\n- added two benchmarks, EvictionProtection0Networks250Candidates and EvictionProtection2Networks250Candidates\r\n- dropped commit https://github.com/bitcoin/bitcoin/commit/edc59d08fc57f5f10657a044224a0b3ae2d2b9bc \"p2p: don't protect more than the network candidates count\"\r\n\r\n<details><summary>benchmark results, CPU 2.50GHz, Turbo off, performance mode, Debian Clang 11 non-debug build, lowest <code>err%</code> runs of several</summary><p>\r\n\r\n```\r\n5adb064 bench: add peer eviction protection benchmarks\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|           74,657.56 |           13,394.49 |    2.5% |      0.85 | `EvictionProtection0Networks250Candidates`\r\n|           71,502.14 |           13,985.60 |    1.1% |      0.78 | `EvictionProtection1Networks250Candidates`\r\n|           74,242.65 |           13,469.35 |    2.1% |      0.88 | `EvictionProtection2Networks250Candidates`\r\n|            9,280.36 |          107,754.43 |    3.0% |      0.11 | `EvictionProtection3Networks050Candidates`\r\n|           22,320.52 |           44,801.83 |    2.5% |      0.25 | `EvictionProtection3Networks100Candidates`\r\n|          149,821.48 |            6,674.61 |    2.7% |      1.64 | `EvictionProtection3Networks250Candidates`\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|           73,715.17 |           13,565.73 |    1.9% |      0.82 | `EvictionProtection0Networks250Candidates`\r\n|           71,505.03 |           13,985.03 |    1.7% |      0.79 | `EvictionProtection1Networks250Candidates`\r\n|           74,924.25 |           13,346.81 |    2.6% |      0.86 | `EvictionProtection2Networks250Candidates`\r\n|            9,493.08 |          105,339.84 |    4.4% |      0.11 | `EvictionProtection3Networks050Candidates`\r\n|           23,528.00 |           42,502.55 |    2.7% |      0.26 | `EvictionProtection3Networks100Candidates`\r\n|          148,696.37 |            6,725.11 |    0.6% |      1.68 | `EvictionProtection3Networks250Candidates`\r\n\r\n\r\nb1d905c p2p: earlier continuation when no remaining eviction candidates\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|           19,051.62 |           52,488.98 |    2.6% |      0.21 | `EvictionProtection0Networks250Candidates`\r\n|           25,607.00 |           39,051.82 |    1.9% |      0.28 | `EvictionProtection1Networks250Candidates`\r\n|           31,392.03 |           31,855.22 |    3.5% |      0.40 | `EvictionProtection2Networks250Candidates`\r\n|            4,873.49 |          205,191.84 |    2.1% |      0.06 | `EvictionProtection3Networks050Candidates`\r\n|           13,827.88 |           72,317.64 |    3.9% |      0.16 | `EvictionProtection3Networks100Candidates`\r\n|           34,605.17 |           28,897.42 |    1.5% |      0.39 | `EvictionProtection3Networks250Candidates`\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|           19,255.11 |           51,934.26 |    2.9% |      0.21 | `EvictionProtection0Networks250Candidates`\r\n|           26,797.82 |           37,316.47 |    3.4% |      0.30 | `EvictionProtection1Networks250Candidates`\r\n|           31,007.27 |           32,250.50 |    1.8% |      0.35 | `EvictionProtection2Networks250Candidates`\r\n|            5,075.53 |          197,023.62 |    3.3% |      0.06 | `EvictionProtection3Networks050Candidates`\r\n|           13,964.15 |           71,611.94 |    3.5% |      0.16 | `EvictionProtection3Networks100Candidates`\r\n|           34,294.63 |           29,159.08 |    1.6% |      0.39 | `EvictionProtection3Networks250Candidates`\r\n```\r\n</p></details>\r\n\r\nIt looks like the performance gains of 2x-5x will be even higher when additional disadvantaged networks are added.",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#issuecomment-876322380",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22284"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1YWRiMDY0NTc0MDNmOGMxZDg3NGU5YzY3NDhlY2JiNzhlZjhmYTJi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5adb06457403f8c1d874e9c6748ecbb78ef8fa2b",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5adb06457403f8c1d874e9c6748ecbb78ef8fa2b",
      "tree": {
        "sha": "b4b66f51f14a7c79fcd2522577e91baaab3d5123",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b4b66f51f14a7c79fcd2522577e91baaab3d5123"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree b4b66f51f14a7c79fcd2522577e91baaab3d5123\nparent 566357f8f7471f74729297868917aa32f6d3c390\nauthor Jon Atack <jon@atack.com> 1624187085 +0200\ncommitter Jon Atack <jon@atack.com> 1625740103 +0200\n\nbench: add peer eviction protection benchmarks\n\nCo-authored-by: Vasil Dimov <vd@FreeBSD.org>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmDm01EACgkQT1chs9Dj\nkh2UUg//Qw8N+pdeULXrSqlZprb6e+QmW8bUmW7uarcqgNElihK64UulPROcyzVb\nAkMohygOwUsfoF+2Y4If8E3qCyXdckcNyw5gZAuX7/Z3hvwkiMq/MVzkxO2Wme+b\nPQE5OgvE56w4XTI/f4Fua6xMbLdygiPzGn5YUWHsTAyt9db/FkRq10gdk1V2Cm/W\nElIU1ti20Ek9Ypu+AtcXi/M8jJa1WWPFriYl8Od88onW+X9CS9my66lDyfhWyXup\nfYI/EIvpjKwz6Vt799gFHihzk6hJC0ZGxy3fYH8YagKYltbZOWEotuwgct5mDrO9\n55U+XYdg1FXLbHit+zmwRdgCS8JvFG6YN99hLNuEr9NlyyfB1Q9uy5y+WitFz8mJ\n4QCSBA+BhFYJF2+T/Yp1cJpJIehqOdbXcnJdcRkQQoth8t8PDTM2ZCSfBrAfr0LA\nHjevzFZ8zBPXWbFt/DRz5auOZlGU9tGMe6I86ksbKBpkh1/pgqr5I3OtjU8Enu5+\n+3fG4mhmC8LjcqSpVTqGFpVrm5lpT55XaaJFl7HIeqZNZIMJJF7feVEC2HKgcgXP\nHAyphh+5eOUk8qIydQDFd9iCms5yEW4R5coNENZAtjmi5E98wTUv3Ca4u1bxYUvJ\n3/sHR8Rd8H4WEEJleM5MeykEKMyr1bxR9/4L3aki7nT1NWT9DpI=\n=YEpZ\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwIBCJ6ZcfCa26GIFvvDCvEvo+ZwUsQEQs2FPwk3mWuNJuCP/wEAt09qWQm56i\nxPAI/AbPYQcI8QRg5tNS8AiurtT6+xo2RACD3+MNLvkMjiwraHR0cHM6Ly9ib2Iu\nYnRjLmNhbGVuZGFyLm9wZW50aW1lc3RhbXBzLm9yZ//wECcyvf932YNKFOvhVrUr\nV18I8SCmzYAdbAG2A8MNCNIxYbcilhosyB3I4t7ftrb20cQ5EwjwIJ3e0zrQ+1oJ\nSaL1hEeGpDqM9HUeLuZRZemChPjj97OcCPEEYObTU/AIPAGFBfqtq2oAg9/jDS75\nDI4pKGh0dHBzOi8vZmlubmV5LmNhbGVuZGFyLmV0ZXJuaXR5d2FsbC5jb23/8BBM\ny09ABSW0bXIKGgPQW0SuCPEEYObTUvAIoI0Wyv4Uu/YAg9/jDS75DI4jImh0dHBz\nOi8vYnRjLmNhbGVuZGFyLmNhdGFsbGF4eS5jb23wEK7xKt4xI3zvN+sjZif/w7EI\n8QRg5tNS8AjRxi7MJNs5SwCD3+MNLvkMji4taHR0cHM6Ly9hbGljZS5idGMuY2Fs\nZW5kYXIub3BlbnRpbWVzdGFtcHMub3Jn\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/566357f8f7471f74729297868917aa32f6d3c390",
          "sha": "566357f8f7471f74729297868917aa32f6d3c390",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/566357f8f7471f74729297868917aa32f6d3c390"
        }
      ],
      "message": "bench: add peer eviction protection benchmarks\n\nCo-authored-by: Vasil Dimov <vd@FreeBSD.org>",
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-07-08T10:28:23Z"
      },
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-06-20T11:04:45Z"
      },
      "sha": "5adb06457403f8c1d874e9c6748ecbb78ef8fa2b"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzowMmU0MTFlYzQ1NmFmODBkMWRhNzYwODVhODE0YzY4YmIzYWNhNmRl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/02e411ec456af80d1da76085a814c68bb3aca6de",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/02e411ec456af80d1da76085a814c68bb3aca6de",
      "tree": {
        "sha": "e0ededf60f9f9734d6388e5df90f1634561afa1e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e0ededf60f9f9734d6388e5df90f1634561afa1e"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree e0ededf60f9f9734d6388e5df90f1634561afa1e\nparent 5adb06457403f8c1d874e9c6748ecbb78ef8fa2b\nauthor Jon Atack <jon@atack.com> 1624115978 +0200\ncommitter Jon Atack <jon@atack.com> 1625740115 +0200\n\np2p: iterate eviction protection only on networks having candidates\n\nin ProtectEvictionCandidatesByRatio().\n\nThank you to Vasil Dimov, whose suggestions during a post-merge\ndiscussion about PR 21261 reminded me that I had done this in\nearlier versions of the PR, e.g. commits like ef411cd2.\n\nCo-authored-by: Vasil Dimov <vd@FreeBSD.org>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmDm01QACgkQT1chs9Dj\nkh0YxRAAqNdNwNAaS3yK894Yo4j7wugj5sBAH8bkYL2lttd2To6R+PdXaHjqtUMq\n5/HiDh40MJ9QYHvMnaPEcYgjs4+L5XPgwqW/q1c8z8/QIlkAX2YnaZ9/Rs28Chse\nxmUvzDtJRA/sLjyL6Qi/AIwYtHb7MMxa0qeV1K20iBF75NOYKASbTQu9TyUhgYHr\ndkh9IDldpmTKSDifYUb5WhC6lBZr/eQkwXJmgbi97UHmZO4fC2d8/db/HCx113Ft\nwWznEgnlSvrSUU6Z2ui/IFF9lp9pJpxLjteS5TBbkVQ+Mh+iLhGQuvSMKgtnACNZ\nqrOHP5bw2/1qgtpz2CJRkA53Y/XFOiUOvzyZby2ZZH4Uqb1VD74DHsJ5qZAy+3oa\nMo9UES5rbk++w09rm0/k0KSNLCeQp5XwNn7cdT6LcGCT2nBNi3y1mnlnL90mqhxa\npu/J1/Bp8/9pOfVOLtZMp1LN6BaaVq/uhzcZb2ard8lCrEkqcx2QubzGRbNnhrEH\nMemx9LtJaFV0VuaDlrduGHNTSSl3cjkzfvoJjCj2mBz71UFAkbzO5cm2y6azNDA3\nEz0ON9BckEW89w33x0VMOpb/yo9dCCG+EN+IsEpCNNC1x4DB5eOtauckD3hjpHgN\nuhN06Y29EKUsBexrqhKYN7JBWs5HK6WoBzTRC0Xx/enrAmUJ6og=\n=J/wG\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwIEnzYaes4cp4T5NKXPRU3EewIaIj98HQ8lWijaeD6McsCP/wEFFqC+M1GruG\nlSlgFFM4EnYI8QRg5tNV8Ah8fLNNR2rTQACD3+MNLvkMji4taHR0cHM6Ly9hbGlj\nZS5idGMuY2FsZW5kYXIub3BlbnRpbWVzdGFtcHMub3Jn//AQXJE2E+0t1cbA4+7Z\nfPhrFgjwIG8u3+m5DKNVuJ2tYCLsTYZ+KlTrAJuJMMAgOMfS3FxoCPAgxHn4U3iG\nQilXpIqblbHq6gHFi7W8dRkqWfhNs+XgesQI8QRg5tNV8Ajq0kJ24sdSNwCD3+MN\nLvkMjiwraHR0cHM6Ly9ib2IuYnRjLmNhbGVuZGFyLm9wZW50aW1lc3RhbXBzLm9y\nZ//wELfGMC7G2o9koPTnaNhYYW0I8QRg5tNV8Ahl16MS2e51wgCD3+MNLvkMjiko\naHR0cHM6Ly9maW5uZXkuY2FsZW5kYXIuZXRlcm5pdHl3YWxsLmNvbfAQxpmb+f1E\nyRxpu7l1uMpITgjxBGDm01XwCBrtcPx+t653AIPf4w0u+QyOIyJodHRwczovL2J0\nYy5jYWxlbmRhci5jYXRhbGxheHkuY29t\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5adb06457403f8c1d874e9c6748ecbb78ef8fa2b",
          "sha": "5adb06457403f8c1d874e9c6748ecbb78ef8fa2b",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5adb06457403f8c1d874e9c6748ecbb78ef8fa2b"
        }
      ],
      "message": "p2p: iterate eviction protection only on networks having candidates\n\nin ProtectEvictionCandidatesByRatio().\n\nThank you to Vasil Dimov, whose suggestions during a post-merge\ndiscussion about PR 21261 reminded me that I had done this in\nearlier versions of the PR, e.g. commits like ef411cd2.\n\nCo-authored-by: Vasil Dimov <vd@FreeBSD.org>",
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-07-08T10:28:35Z"
      },
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-06-19T15:19:38Z"
      },
      "sha": "02e411ec456af80d1da76085a814c68bb3aca6de"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjOWU4ZDhmOWIxNjhkZWMyYmM3Yjg0NWRhMzg0NDllOTY3MDhjZjhl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c9e8d8f9b168dec2bc7b845da38449e96708cf8e",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/c9e8d8f9b168dec2bc7b845da38449e96708cf8e",
      "tree": {
        "sha": "71c7fc6042432899fd99324faf26257e8082d1c1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/71c7fc6042432899fd99324faf26257e8082d1c1"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 71c7fc6042432899fd99324faf26257e8082d1c1\nparent 02e411ec456af80d1da76085a814c68bb3aca6de\nauthor Jon Atack <jon@atack.com> 1625583675 +0200\ncommitter Jon Atack <jon@atack.com> 1625740118 +0200\n\np2p: process more candidates per protection iteration\n\nfor the usual case when some of the protected networks\ndon't have eviction candidates, to reduce the number\nof iterations in ProtectEvictionCandidatesByRatio().\n\nPicks up an idea in ef411cd2 that I had dropped.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmDm01YACgkQT1chs9Dj\nkh3tRg//Xm66YKK5RGrOHNRJB05FFwBur/GXpLzWK9a5BsJKJhgCr3Ki7bJvXADJ\nskX/a7fgr1fQDwDwlMVx11AppWGnN2bRIODEmdQFyNz8Q8akiT4ca0T7JNhhnXuk\ngl2hZktWCNsL9QvRHsNqWkSJQrOTT4cI1MHTA9V5qKqsIMveSGvtIYBB4VDrtF5H\nUoe/u9+JSKuPJFvK3pQDIr/+6RE1QVQk8yLzTgw8FKH7E0BxKPvAiW1EtkFA4WRE\n9PMlU5y9YS5IQ0pIGkW14WezEa5W5sp5BU22sAmWmo/4t8/SRYLRWIhj62SXy0nI\ndTIz/kU8ZanYNEe8aYS26fhAE/V861Ui4C/i9as4+D4XJLvkhCLSk5zwrwgjM/gp\njHYymlK2UntbRjkl5sOPWuur6JAT1LA0TgPC6kiMr7QI6o7uEQXWA3ZYNckrwG6g\n33ZKq/ku+uHfHqJDfD+L1G93msTxVio+W3A2pPvyXS9H/0436gaoN4HCWvfbkWKE\neRWCD+uE/dGKyndg8smEZlhqtfg3AovKbMiMT2iun5escXk9gAHgsRkJex+M/ad3\nx7B8x3VfUVhrwbeY0X1UiGwnn0q24TPsrx5lBrfe1aZmKjfgUUEqLIsePe9aRefI\noKvfT5+FLyTcQL0Idq4SZzKmv7p+TZhYzO4l/lGiiT+XE/0mKY0=\n=F5G1\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwII4sVLzuFv0MbFg0PUgv2i0H4pDNlToaODhLQHEqxqm8CP/wEAtNEujkHbVx\nDZch72445aAI8QRg5tNX8AgBK575EokwrwCD3+MNLvkMjikoaHR0cHM6Ly9maW5u\nZXkuY2FsZW5kYXIuZXRlcm5pdHl3YWxsLmNvbf/wEED8CSOBbW9DdG0TL/k4vucI\n8QRg5tNX8AhKSS4FpFYlXgCD3+MNLvkMjiMiaHR0cHM6Ly9idGMuY2FsZW5kYXIu\nY2F0YWxsYXh5LmNvbf/wEJLhCVgvV7KtObEGj8FLKeEI8QRg5tNX8AgtpenyRrr8\nFACD3+MNLvkMjiwraHR0cHM6Ly9ib2IuYnRjLmNhbGVuZGFyLm9wZW50aW1lc3Rh\nbXBzLm9yZ/AQ0WnGKuw5nTPOQeAkdEVlQAjxBGDm01fwCEryaPP8m9SWAIPf4w0u\n+QyOLi1odHRwczovL2FsaWNlLmJ0Yy5jYWxlbmRhci5vcGVudGltZXN0YW1wcy5v\ncmc=\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/02e411ec456af80d1da76085a814c68bb3aca6de",
          "sha": "02e411ec456af80d1da76085a814c68bb3aca6de",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/02e411ec456af80d1da76085a814c68bb3aca6de"
        }
      ],
      "message": "p2p: process more candidates per protection iteration\n\nfor the usual case when some of the protected networks\ndon't have eviction candidates, to reduce the number\nof iterations in ProtectEvictionCandidatesByRatio().\n\nPicks up an idea in ef411cd2 that I had dropped.",
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-07-08T10:28:38Z"
      },
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-07-06T15:01:15Z"
      },
      "sha": "c9e8d8f9b168dec2bc7b845da38449e96708cf8e"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiMWQ5MDVjMjI1ZTg3YTRhMjg5YzBjZDM1OTNjNmMyMWNlYTNmYmE3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b1d905c225e87a4a289c0cd3593c6c21cea3fba7",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b1d905c225e87a4a289c0cd3593c6c21cea3fba7",
      "tree": {
        "sha": "1e351bba3f84d5ca0f8f795304da3a44fe29abb7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1e351bba3f84d5ca0f8f795304da3a44fe29abb7"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 1e351bba3f84d5ca0f8f795304da3a44fe29abb7\nparent c9e8d8f9b168dec2bc7b845da38449e96708cf8e\nauthor Vasil Dimov <vd@FreeBSD.org> 1624115221 +0200\ncommitter Jon Atack <jon@atack.com> 1625740120 +0200\n\np2p: earlier continuation when no remaining eviction candidates\n\nin ProtectEvictionCandidatesByRatio().\n\nWith this change, `if (n.count == 0) continue;` will be true\nif a network had candidates protected in the first iterations\nand has no candidates remaining to be protected in later iterations.\n\nCo-authored-by: Jon Atack <jon@atack.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmDm01gACgkQT1chs9Dj\nkh36bQ/+LGtYWhK0lfoFTi+FC0tpdzwaAMTUILfP36eNt64yzRczWy8X7A1ir54y\nXfLKuhoQSl4EKrMSeB/a03RsxfvXDi8sYTsSdMO62OigVYS2Wd1BrUn6ALRupmvl\n3dkSEDIjJ8s78RC5bgVMEP5flJe891MEZc4srlj6GRN8c3a234awE+90kjDmCQFI\nUbkipgawL7j+culZY3d9iSlkhbMsVwkZyJVIEF3CB0x6VKG+2GiPzjflqUNW9S3b\niHGcX77cnUrc7FNeNnHYvmf4D1ULf4CTuRQw/Jl5V97H4pQC95B/Ns9XAMyvYsSg\ngoXjnTJ9XLMRWfbwF5kKHRa1WqsaJILjHlL0AOZun9nosueZD/b9RtT8SMJRkU9W\nEHCjF8g1QM7bh3AxIgqiAeok/qpPn8zccSKTDC/5UxQHebpGFSijHXZvAhMlmm5V\nBSR1CN9jGmvYHP+VeSERwfyMAQXF4NutokyT8qyUB5/LnLu/5e21BgbRNyPS2A3A\ncnTAhvfsUAboa52ble/6o99CPl1mkuhqTXEws9Y9IxwH/FL/iHmZXfsAUE/nD5XS\nD87GTdsQ+EtA8lxYFXvn9sElZ69IEuM+6llGepuL0FfI4YiAq0tnI+ucJBcrrLFn\ns50TgpoDrj9uyI5NdbB1QKwxsbW/OYq/m8YIXkSd+kQNuXLo7qo=\n=/6UC\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwIFK0FyH3Etirowk+TjMM9MZh8vnn84ktwT9bYMLUG5cXCP/wEDXo/ePcEIBA\nUqTYkvoPZFUI8CDv15qT0wG9rNB3vHaJxopfVE5H1IFNr5r9nXiLIoXchgjxBGDm\n01nwCMRINnMU5v+AAIPf4w0u+QyOIyJodHRwczovL2J0Yy5jYWxlbmRhci5jYXRh\nbGxheHkuY29t//AQTxpCuoJqvmn1YnBnzWynrwjwIILu2wJwtuUq3e71LTNEdf0X\n8WBYrNV8eMitZQK4j8XdCPEEYObTWfAIMUDCi45qDpoAg9/jDS75DI4uLWh0dHBz\nOi8vYWxpY2UuYnRjLmNhbGVuZGFyLm9wZW50aW1lc3RhbXBzLm9yZ//wENYCVUJ4\ni/bHOWZM3iHFcDoI8CCHBcG2/MAoEOV7JGsyfcTzY9UCRzoT3IjvI0Bq8LfhEQjx\nBGDm01nwCCYmeXaEEdLwAIPf4w0u+QyOLCtodHRwczovL2JvYi5idGMuY2FsZW5k\nYXIub3BlbnRpbWVzdGFtcHMub3Jn8BDd84yB7DlIfuw3Su4jlTM5CPEg/bLqxJJf\nfHR1N+sVoSF6k0LBxLLrCeDhS6DB0Anse5cI8QRg5tNZ8AhYRaMI0U96rQCD3+MN\nLvkMjikoaHR0cHM6Ly9maW5uZXkuY2FsZW5kYXIuZXRlcm5pdHl3YWxsLmNvbQ==\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c9e8d8f9b168dec2bc7b845da38449e96708cf8e",
          "sha": "c9e8d8f9b168dec2bc7b845da38449e96708cf8e",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/c9e8d8f9b168dec2bc7b845da38449e96708cf8e"
        }
      ],
      "message": "p2p: earlier continuation when no remaining eviction candidates\n\nin ProtectEvictionCandidatesByRatio().\n\nWith this change, `if (n.count == 0) continue;` will be true\nif a network had candidates protected in the first iterations\nand has no candidates remaining to be protected in later iterations.\n\nCo-authored-by: Jon Atack <jon@atack.com>",
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-07-08T10:28:40Z"
      },
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2021-06-19T15:07:01Z"
      },
      "sha": "b1d905c225e87a4a289c0cd3593c6c21cea3fba7"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4994096750,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDk5NDA5Njc1MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4994096750",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-08T10:29:46Z"
    },
    {
      "event": "commented",
      "id": 876455300,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3NjQ1NTMwMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876455300",
      "actor": {
        "login": "klementtan",
        "id": 49265907,
        "node_id": "MDQ6VXNlcjQ5MjY1OTA3",
        "avatar_url": "https://avatars.githubusercontent.com/u/49265907?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/klementtan",
        "html_url": "https://github.com/klementtan",
        "followers_url": "https://api.github.com/users/klementtan/followers",
        "following_url": "https://api.github.com/users/klementtan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/klementtan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/klementtan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/klementtan/subscriptions",
        "organizations_url": "https://api.github.com/users/klementtan/orgs",
        "repos_url": "https://api.github.com/users/klementtan/repos",
        "events_url": "https://api.github.com/users/klementtan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/klementtan/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-08T13:49:29Z",
      "updated_at": "2021-07-08T13:49:29Z",
      "author_association": "CONTRIBUTOR",
      "body": "Tested and code review ACK b1d905c2. \r\n\r\nAlso no longer seeing `... Unstable with ~100.0 iters. Increase minEpochIterations to e.g. 1000)` warning. \r\n\r\n<details>\r\n<summary> Bench results </summary>\r\n\r\n5adb0645:\r\n\r\n```\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|           18,612.89 |           53,726.22 |    1.3% |      0.21 | `EvictionProtection0Networks250Candidates`\r\n|           15,604.12 |           64,085.64 |    1.1% |      0.17 | `EvictionProtection1Networks250Candidates`\r\n|           46,098.96 |           21,692.46 |    1.4% |      0.51 | `EvictionProtection2Networks250Candidates`\r\n|            7,573.28 |          132,043.17 |    2.2% |      0.09 | `EvictionProtection3Networks050Candidates`\r\n|           16,631.50 |           60,126.87 |    3.2% |      0.18 | `EvictionProtection3Networks100Candidates`\r\n|           97,775.81 |           10,227.48 |    3.3% |      1.09 | `EvictionProtection3Networks250Candidates`\r\n```\r\n\r\n02e411ec\r\n```\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|           18,389.64 |           54,378.44 |    1.7% |      0.20 | `EvictionProtection0Networks250Candidates`\r\n|           13,869.52 |           72,100.52 |    1.3% |      0.15 | `EvictionProtection1Networks250Candidates`\r\n|           46,016.06 |           21,731.55 |    3.4% |      0.50 | `EvictionProtection2Networks250Candidates`\r\n|            6,408.73 |          156,037.13 |    3.6% |      0.07 | `EvictionProtection3Networks050Candidates`\r\n|           16,160.17 |           61,880.55 |    2.1% |      0.18 | `EvictionProtection3Networks100Candidates`\r\n|           96,984.48 |           10,310.93 |    4.5% |      1.07 | `EvictionProtection3Networks250Candidates`\r\n```\r\n\r\nc9e8d8f9\r\n```\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|           13,422.68 |           74,500.80 |    1.3% |      0.15 | `EvictionProtection0Networks250Candidates`\r\n|           10,170.63 |           98,322.35 |    1.5% |      0.11 | `EvictionProtection1Networks250Candidates`\r\n|           17,204.80 |           58,123.30 |    1.0% |      0.19 | `EvictionProtection2Networks250Candidates`\r\n|            7,508.82 |          133,176.80 |    2.6% |      0.08 | `EvictionProtection3Networks050Candidates`\r\n|           16,172.34 |           61,833.97 |    1.1% |      0.17 | `EvictionProtection3Networks100Candidates`\r\n|           95,083.59 |           10,517.06 |    4.0% |      1.05 | `EvictionProtection3Networks250Candidates`\r\n\r\n```\r\nb1d905c2\r\n```\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|           23,721.76 |           42,155.39 |    1.2% |      0.27 | `EvictionProtection0Networks250Candidates`\r\n|           17,557.76 |           56,954.87 |    0.2% |      0.20 | `EvictionProtection1Networks250Candidates`\r\n|           29,148.45 |           34,307.14 |    0.4% |      0.33 | `EvictionProtection2Networks250Candidates`\r\n|            6,159.56 |          162,349.31 |    0.1% |      0.07 | `EvictionProtection3Networks050Candidates`\r\n|           19,989.47 |           50,026.33 |    0.6% |      0.22 | `EvictionProtection3Networks100Candidates`\r\n|           42,009.48 |           23,804.15 |    0.8% |      0.47 | `EvictionProtection3Networks250Candidates`\r\n```\r\n</details>",
      "user": {
        "login": "klementtan",
        "id": 49265907,
        "node_id": "MDQ6VXNlcjQ5MjY1OTA3",
        "avatar_url": "https://avatars.githubusercontent.com/u/49265907?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/klementtan",
        "html_url": "https://github.com/klementtan",
        "followers_url": "https://api.github.com/users/klementtan/followers",
        "following_url": "https://api.github.com/users/klementtan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/klementtan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/klementtan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/klementtan/subscriptions",
        "organizations_url": "https://api.github.com/users/klementtan/orgs",
        "repos_url": "https://api.github.com/users/klementtan/repos",
        "events_url": "https://api.github.com/users/klementtan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/klementtan/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#issuecomment-876455300",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22284"
    },
    {
      "event": "reviewed",
      "id": 702175730,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzAyMTc1NzMw",
      "url": null,
      "actor": null,
      "commit_id": "b1d905c225e87a4a289c0cd3593c6c21cea3fba7",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK b1d905c225e87a4a289c0cd3593c6c21cea3fba7\r\n\r\nbase (5adb06457403f8c1d874e9c6748ecbb78ef8fa2b bench: add peer eviction protection benchmarks)\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|           15,636.87 |           63,951.43 |    0.6% |      0.17 | `EvictionProtection0Networks250Candidates`\r\n|           12,885.39 |           77,607.27 |    0.5% |      0.14 | `EvictionProtection1Networks250Candidates`\r\n|           35,732.17 |           27,985.99 |    0.3% |      0.39 | `EvictionProtection2Networks250Candidates`\r\n|            5,514.20 |          181,349.88 |    1.9% |      0.06 | `EvictionProtection3Networks050Candidates`\r\n|           12,243.04 |           81,679.08 |    0.2% |      0.13 | `EvictionProtection3Networks100Candidates`\r\n|           76,015.27 |           13,155.25 |    0.4% |      0.85 | `EvictionProtection3Networks250Candidates`\r\n\r\nall improvements (b1d905c225e87a4a289c0cd3593c6c21cea3fba7 p2p: earlier continuation when no remaining eviction candidates)\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|           10,587.04 |           94,455.10 |    0.7% |      0.12 | `EvictionProtection0Networks250Candidates`\r\n|            8,046.60 |          124,276.05 |    0.8% |      0.09 | `EvictionProtection1Networks250Candidates`\r\n|           12,479.92 |           80,128.74 |    1.0% |      0.14 | `EvictionProtection2Networks250Candidates`\r\n|            2,784.53 |          359,127.39 |    4.3% |      0.03 | `EvictionProtection3Networks050Candidates`\r\n|            8,286.96 |          120,671.54 |    0.4% |      0.09 | `EvictionProtection3Networks100Candidates`\r\n|           18,450.28 |           54,199.71 |    0.7% |      0.20 | `EvictionProtection3Networks250Candidates`\r\n\r\nBenchmarks complete in ~2 seconds.\r\n\r\n",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#pullrequestreview-702175730",
      "submitted_at": "2021-07-08T14:59:45Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22284"
    },
    {
      "event": "reviewed",
      "id": 702684629,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzAyNjg0NjI5",
      "url": null,
      "actor": null,
      "commit_id": "b1d905c225e87a4a289c0cd3593c6c21cea3fba7",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK b1d905c225e87a4a289c0cd3593c6c21cea3fba7\r\n\r\nThe way this has progressed since my last review makes sense. This is still a performance and improvement and code looks good.\r\n\r\nI do still run into instability:\r\n```\r\nUnstable with ~1,001.0 iters. Increase `minEpochIterations` to e.g. 10010\r\n```\r\n\r\nNot sure what to make of it because I'm running the `macOS 12` Beta (not a super stable system overall). Just wanted to document that I am running into that, I will have time later today to try on other systems. If no one else is running into it, let's assume it's my system.\r\n\r\nThe warning is flaky though, here's the results of my runs where I didn't run into the warning:\r\n\r\n**Base:** Master + (566357f8f7471f74729297868917aa32f6d3c390 + 5adb06457403f8c1d874e9c6748ecbb78ef8fa2b)\r\n\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|           18,439.40 |           54,231.71 |    4.0% |      0.21 | `EvictionProtection0Networks250Candidates`\r\n|           16,029.50 |           62,384.99 |    3.1% |      0.18 | `EvictionProtection1Networks250Candidates`\r\n|           43,125.31 |           23,188.24 |    2.6% |      0.47 | `EvictionProtection2Networks250Candidates`\r\n|            7,225.39 |          138,400.78 |    3.1% |      0.08 | `EvictionProtection3Networks050Candidates`\r\n|           15,869.58 |           63,013.65 |    3.5% |      0.18 | `EvictionProtection3Networks100Candidates`\r\n|           97,586.25 |           10,247.35 |    1.1% |      1.06 | `EvictionProtection3Networks250Candidates`\r\n\r\n\r\n**All Improvements:** b1d905c225e87a4a289c0cd3593c6c21cea3fba7\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|           12,764.72 |           78,340.94 |    2.1% |      0.14 | `EvictionProtection0Networks250Candidates`\r\n|            9,367.04 |          106,757.28 |    3.0% |      0.10 | `EvictionProtection1Networks250Candidates`\r\n|           14,846.86 |           67,354.33 |    1.4% |      0.16 | `EvictionProtection2Networks250Candidates`\r\n|            3,493.85 |          286,217.28 |    4.8% |      0.04 | `EvictionProtection3Networks050Candidates`\r\n|           10,208.73 |           97,955.35 |    2.0% |      0.11 | `EvictionProtection3Networks100Candidates`\r\n|           22,498.62 |           44,447.18 |    0.9% |      0.25 | `EvictionProtection3Networks250Candidates`\r\n",
      "user": {
        "login": "jarolrod",
        "id": 23396902,
        "node_id": "MDQ6VXNlcjIzMzk2OTAy",
        "avatar_url": "https://avatars.githubusercontent.com/u/23396902?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jarolrod",
        "html_url": "https://github.com/jarolrod",
        "followers_url": "https://api.github.com/users/jarolrod/followers",
        "following_url": "https://api.github.com/users/jarolrod/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jarolrod/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jarolrod/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jarolrod/subscriptions",
        "organizations_url": "https://api.github.com/users/jarolrod/orgs",
        "repos_url": "https://api.github.com/users/jarolrod/repos",
        "events_url": "https://api.github.com/users/jarolrod/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jarolrod/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#pullrequestreview-702684629",
      "submitted_at": "2021-07-09T05:05:56Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22284"
    },
    {
      "event": "commented",
      "id": 877286823,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3NzI4NjgyMw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/877286823",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-09T15:56:37Z",
      "updated_at": "2021-07-09T15:56:37Z",
      "author_association": "MEMBER",
      "body": "> Not sure what to make of it because I'm running the `macOS 12` Beta (not a super stable system overall).\r\n\r\nYes, I tuned my system and yet still see that most of the time on at least half of the benchmarks when running all of them with `./src/bench/bench_bitcoin`.  It came down to the preference of being able to run these new benchmarks 10 times in ~20 seconds rather than once in 30-60 seconds, and having a rapid result that works for the most people.  There just seems to be decreasing utility in adding iterations.",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#issuecomment-877286823",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22284"
    },
    {
      "event": "merged",
      "id": 5025221755,
      "node_id": "MDExOk1lcmdlZEV2ZW50NTAyNTIyMTc1NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5025221755",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "21998bc028d6d72229ae826d2dd9d78981367952",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/21998bc028d6d72229ae826d2dd9d78981367952",
      "created_at": "2021-07-15T12:50:15Z"
    },
    {
      "event": "closed",
      "id": 5025221777,
      "node_id": "MDExOkNsb3NlZEV2ZW50NTAyNTIyMTc3Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5025221777",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-15T12:50:15Z"
    },
    {
      "event": "head_ref_deleted",
      "id": 5025338291,
      "node_id": "MDE5OkhlYWRSZWZEZWxldGVkRXZlbnQ1MDI1MzM4Mjkx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5025338291",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-15T13:11:44Z"
    },
    {
      "event": "referenced",
      "id": 5058786307,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDUwNTg3ODYzMDc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5058786307",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "4745a73c52fc0791a5f786e31f2ced4565ee1378",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/4745a73c52fc0791a5f786e31f2ced4565ee1378",
      "created_at": "2021-07-23T01:27:00Z"
    },
    {
      "event": "referenced",
      "id": 6091553046,
      "node_id": "REFE_lADOABII5843KPcuzwAAAAFrFbkW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6091553046",
      "actor": {
        "login": "Fabcien",
        "id": 44533924,
        "node_id": "MDQ6VXNlcjQ0NTMzOTI0",
        "avatar_url": "https://avatars.githubusercontent.com/u/44533924?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Fabcien",
        "html_url": "https://github.com/Fabcien",
        "followers_url": "https://api.github.com/users/Fabcien/followers",
        "following_url": "https://api.github.com/users/Fabcien/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Fabcien/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Fabcien/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Fabcien/subscriptions",
        "organizations_url": "https://api.github.com/users/Fabcien/orgs",
        "repos_url": "https://api.github.com/users/Fabcien/repos",
        "events_url": "https://api.github.com/users/Fabcien/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Fabcien/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "ee65041c3462ea35da2d79eca0a8c81c2072a956",
      "commit_url": "https://api.github.com/repos/Bitcoin-ABC/bitcoin-abc/commits/ee65041c3462ea35da2d79eca0a8c81c2072a956",
      "created_at": "2022-02-17T16:11:32Z"
    },
    {
      "event": "referenced",
      "id": 6723199362,
      "node_id": "REFE_lADOABII5843KPcuzwAAAAGQu-GC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6723199362",
      "actor": {
        "login": "gwillen",
        "id": 458997,
        "node_id": "MDQ6VXNlcjQ1ODk5Nw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/458997?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gwillen",
        "html_url": "https://github.com/gwillen",
        "followers_url": "https://api.github.com/users/gwillen/followers",
        "following_url": "https://api.github.com/users/gwillen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gwillen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gwillen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gwillen/subscriptions",
        "organizations_url": "https://api.github.com/users/gwillen/orgs",
        "repos_url": "https://api.github.com/users/gwillen/repos",
        "events_url": "https://api.github.com/users/gwillen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gwillen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "84b41b323a8c0620f874e1c8b2637ee3420e9aef",
      "commit_url": "https://api.github.com/repos/ElementsProject/elements/commits/84b41b323a8c0620f874e1c8b2637ee3420e9aef",
      "created_at": "2022-06-01T21:22:39Z"
    },
    {
      "event": "locked",
      "id": 7216586045,
      "node_id": "LOE_lADOABII5843KPcuzwAAAAGuJF09",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7216586045",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-18T18:31:59Z",
      "lock_reason": "resolved"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/661275001",
      "pull_request_review_id": 695881962,
      "id": 661275001,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MTI3NTAwMQ==",
      "diff_hunk": "@@ -0,0 +1,169 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <net.h>\n+#include <netaddress.h>\n+#include <random.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <vector>\n+\n+std::vector<NodeEvictionCandidate> GetRandomNodeEvictionCandidates(int num_peers, FastRandomContext& random_context)\n+{\n+    std::vector<NodeEvictionCandidate> candidates;\n+    for (int id = 0; id < num_peers; ++id) {\n+        candidates.push_back({\n+            /* id */ id,\n+            /* nTimeConnected */ static_cast<int64_t>(random_context.randrange(100)),\n+            /* m_min_ping_time */ std::chrono::microseconds{random_context.randrange(100)},\n+            /* nLastBlockTime */ static_cast<int64_t>(random_context.randrange(100)),\n+            /* nLastTXTime */ static_cast<int64_t>(random_context.randrange(100)),\n+            /* fRelevantServices */ random_context.randbool(),\n+            /* fRelayTxes */ random_context.randbool(),\n+            /* fBloomFilter */ random_context.randbool(),\n+            /* nKeyedNetGroup */ random_context.randrange(100),\n+            /* prefer_evict */ random_context.randbool(),\n+            /* m_is_local */ random_context.randbool(),\n+            /* m_network */ ALL_NETWORKS[random_context.randrange(ALL_NETWORKS.size())],\n+        });\n+    }\n+    return candidates;\n+}",
      "path": "src/bench/peer_eviction.cpp",
      "position": null,
      "original_position": 36,
      "commit_id": "b1d905c225e87a4a289c0cd3593c6c21cea3fba7",
      "original_commit_id": "ab2993336fbdff72d125f906c2baec4c5dcb79e3",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This function already exists in `src/test/net_peer_eviction_tests.cpp`. Dedup:\r\n\r\n```diff\r\n    test: make GetRandomNodeEvictionCandidates() reusable\r\n\r\n    Move `GetRandomNodeEvictionCandidates()` from\r\n    `src/test/net_peer_eviction_tests.cpp` to `src/test/util/net.h` and\r\n    `src/test/util/net.cpp` so that it can be reused by other tests.\r\n\r\ndiff --git a/src/test/net_peer_eviction_tests.cpp b/src/test/net_peer_eviction_tests.cpp\r\nindex 4bfd487b86..5eb280b498 100644\r\n--- a/src/test/net_peer_eviction_tests.cpp\r\n+++ b/src/test/net_peer_eviction_tests.cpp\r\n@@ -14,34 +14,12 @@\r\n #include <optional>\r\n #include <unordered_set>\r\n #include <vector>\r\n\r\n BOOST_FIXTURE_TEST_SUITE(net_peer_eviction_tests, BasicTestingSetup)\r\n\r\n-std::vector<NodeEvictionCandidate> GetRandomNodeEvictionCandidates(const int n_candidates, FastRandomContext& random_context)\r\n-{\r\n-    std::vector<NodeEvictionCandidate> candidates;\r\n-    for (int id = 0; id < n_candidates; ++id) {\r\n-        candidates.push_back({\r\n-            /* id */ id,\r\n-            /* nTimeConnected */ static_cast<int64_t>(random_context.randrange(100)),\r\n-            /* m_min_ping_time */ std::chrono::microseconds{random_context.randrange(100)},\r\n-            /* nLastBlockTime */ static_cast<int64_t>(random_context.randrange(100)),\r\n-            /* nLastTXTime */ static_cast<int64_t>(random_context.randrange(100)),\r\n-            /* fRelevantServices */ random_context.randbool(),\r\n-            /* fRelayTxes */ random_context.randbool(),\r\n-            /* fBloomFilter */ random_context.randbool(),\r\n-            /* nKeyedNetGroup */ random_context.randrange(100),\r\n-            /* prefer_evict */ random_context.randbool(),\r\n-            /* m_is_local */ random_context.randbool(),\r\n-            /* m_network */ ALL_NETWORKS[random_context.randrange(ALL_NETWORKS.size())],\r\n-        });\r\n-    }\r\n-    return candidates;\r\n-}\r\n-\r\n // Create `num_peers` random nodes, apply setup function `candidate_setup_fn`,\r\n // call ProtectEvictionCandidatesByRatio() to apply protection logic, and then\r\n // return true if all of `protected_peer_ids` and none of `unprotected_peer_ids`\r\n // are protected from eviction, i.e. removed from the eviction candidates.\r\n bool IsProtected(int num_peers,\r\n                  std::function<void(NodeEvictionCandidate&)> candidate_setup_fn,\r\ndiff --git a/src/test/util/net.cpp b/src/test/util/net.cpp\r\nindex 847a490e03..64b70a61f0 100644\r\n--- a/src/test/util/net.cpp\r\n+++ b/src/test/util/net.cpp\r\n@@ -34,6 +34,28 @@ bool ConnmanTestMsg::ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) con\r\n\r\n     bool complete;\r\n     NodeReceiveMsgBytes(node, ser_msg_header, complete);\r\n     NodeReceiveMsgBytes(node, ser_msg.data, complete);\r\n     return complete;\r\n }\r\n+\r\n+std::vector<NodeEvictionCandidate> GetRandomNodeEvictionCandidates(const int n_candidates, FastRandomContext& random_context)\r\n+{\r\n+    std::vector<NodeEvictionCandidate> candidates;\r\n+    for (int id = 0; id < n_candidates; ++id) {\r\n+        candidates.push_back({\r\n+            /* id */ id,\r\n+            /* nTimeConnected */ static_cast<int64_t>(random_context.randrange(100)),\r\n+            /* m_min_ping_time */ std::chrono::microseconds{random_context.randrange(100)},\r\n+            /* nLastBlockTime */ static_cast<int64_t>(random_context.randrange(100)),\r\n+            /* nLastTXTime */ static_cast<int64_t>(random_context.randrange(100)),\r\n+            /* fRelevantServices */ random_context.randbool(),\r\n+            /* fRelayTxes */ random_context.randbool(),\r\n+            /* fBloomFilter */ random_context.randbool(),\r\n+            /* nKeyedNetGroup */ random_context.randrange(100),\r\n+            /* prefer_evict */ random_context.randbool(),\r\n+            /* m_is_local */ random_context.randbool(),\r\n+            /* m_network */ ALL_NETWORKS[random_context.randrange(ALL_NETWORKS.size())],\r\n+        });\r\n+    }\r\n+    return candidates;\r\n+}\r\ndiff --git a/src/test/util/net.h b/src/test/util/net.h\r\nindex 1b49a671bd..66f6cc61b8 100644\r\n--- a/src/test/util/net.h\r\n+++ b/src/test/util/net.h\r\n@@ -138,7 +138,9 @@ public:\r\n\r\n private:\r\n     const std::string m_contents;\r\n     mutable size_t m_consumed;\r\n };\r\n\r\n+std::vector<NodeEvictionCandidate> GetRandomNodeEvictionCandidates(const int n_candidates, FastRandomContext& random_context);\r\n+\r\n #endif // BITCOIN_TEST_UTIL_NET_H\r\n```\r\n",
      "created_at": "2021-06-30T09:09:09Z",
      "updated_at": "2021-06-30T09:48:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#discussion_r661275001",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/661275001"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22284"
        }
      },
      "start_line": null,
      "original_start_line": 16,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 36,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/661285594",
      "pull_request_review_id": 695881962,
      "id": 661285594,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MTI4NTU5NA==",
      "diff_hunk": "@@ -0,0 +1,169 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <net.h>\n+#include <netaddress.h>\n+#include <random.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <vector>\n+\n+std::vector<NodeEvictionCandidate> GetRandomNodeEvictionCandidates(int num_peers, FastRandomContext& random_context)\n+{\n+    std::vector<NodeEvictionCandidate> candidates;\n+    for (int id = 0; id < num_peers; ++id) {\n+        candidates.push_back({\n+            /* id */ id,\n+            /* nTimeConnected */ static_cast<int64_t>(random_context.randrange(100)),\n+            /* m_min_ping_time */ std::chrono::microseconds{random_context.randrange(100)},\n+            /* nLastBlockTime */ static_cast<int64_t>(random_context.randrange(100)),\n+            /* nLastTXTime */ static_cast<int64_t>(random_context.randrange(100)),\n+            /* fRelevantServices */ random_context.randbool(),\n+            /* fRelayTxes */ random_context.randbool(),\n+            /* fBloomFilter */ random_context.randbool(),\n+            /* nKeyedNetGroup */ random_context.randrange(100),\n+            /* prefer_evict */ random_context.randbool(),\n+            /* m_is_local */ random_context.randbool(),\n+            /* m_network */ ALL_NETWORKS[random_context.randrange(ALL_NETWORKS.size())],\n+        });\n+    }\n+    return candidates;\n+}\n+\n+static std::vector<NodeEvictionCandidate> CreateEvictionCandidates(int num_peers, std::function<void(NodeEvictionCandidate&)> candidate_setup_fn, FastRandomContext& random_context)\n+{\n+    std::vector<NodeEvictionCandidate> candidates{GetRandomNodeEvictionCandidates(num_peers, random_context)};\n+    for (NodeEvictionCandidate& candidate : candidates) {\n+        candidate_setup_fn(candidate);\n+    }\n+    return candidates;\n+}\n+\n+/* Benchmarks */\n+\n+static void EvictionProtection1Network250Candidates(benchmark::Bench& bench)\n+{\n+    const int num_peers{250};\n+    FastRandomContext random_context{true};\n+\n+    const std::vector<NodeEvictionCandidate> eviction_candidates{\n+        CreateEvictionCandidates(\n+            num_peers, [](NodeEvictionCandidate& c) {\n+                c.nTimeConnected = c.id;\n+                c.m_is_local = false;\n+                if (c.id >= 130 && c.id < 240) { // 110 Tor\n+                    c.m_network = NET_ONION;\n+                } else {\n+                    c.m_network = NET_IPV6;\n+                }\n+            },\n+            random_context)};\n+\n+    bench.run([&] {\n+        std::vector<NodeEvictionCandidate> candidates;\n+        for (int id = 0; id < 60000; ++id) {\n+            candidates = eviction_candidates;\n+            ProtectEvictionCandidatesByRatio(candidates);\n+        }\n+    });",
      "path": "src/bench/peer_eviction.cpp",
      "position": null,
      "original_position": 73,
      "commit_id": "b1d905c225e87a4a289c0cd3593c6c21cea3fba7",
      "original_commit_id": "ab2993336fbdff72d125f906c2baec4c5dcb79e3",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think [nanobench](https://nanobench.ankerl.com/reference.html#_CPPv4N6ankerl9nanobench5Bench6epochsE6size_t) is designed to make such loops unnecessary. It can provide stable results even if the test function is very fast/short, no need to loop 60k times.\r\n\r\nAlso, the above benchmarks the copying of the data which could add noise to the test. Given that the input is not huge we can create a separate copy for each iteration of the test, this consumes a few tens of megabytes which is ok. Here is an example (that also uses the de-duplicated `GetRandomNodeEvictionCandidates()` from `test/util/net.h`):\r\n\r\n```cpp\r\n// Copyright (c) 2021 The Bitcoin Core developers\r\n// Distributed under the MIT software license, see the accompanying\r\n// file COPYING or http://www.opensource.org/licenses/mit-license.php.\r\n\r\n#include <bench/bench.h>\r\n#include <net.h>\r\n#include <netaddress.h>\r\n#include <random.h>\r\n#include <test/util/net.h>\r\n#include <test/util/setup_common.h>\r\n\r\n#include <algorithm>\r\n#include <functional>\r\n#include <vector>\r\n\r\nstatic void EvictionProtectionCommon(\r\n    benchmark::Bench& bench,\r\n    int num_candidates,\r\n    std::function<void(NodeEvictionCandidate&)> candidate_setup_fn,\r\n    size_t epochs,\r\n    uint64_t epoch_iterations)\r\n{\r\n    using Candidates = std::vector<NodeEvictionCandidate>;\r\n\r\n    FastRandomContext random_context{true};\r\n\r\n    bench.epochs(epochs).epochIterations(epoch_iterations);\r\n\r\n    Candidates candidates{GetRandomNodeEvictionCandidates(num_candidates, random_context)};\r\n    for (auto& c : candidates) {\r\n        candidate_setup_fn(c);\r\n    }\r\n\r\n    std::vector<Candidates> copies{bench.epochs() * bench.epochIterations(), candidates};\r\n    size_t i{0};\r\n    bench.run([&] {\r\n        ProtectEvictionCandidatesByRatio(copies.at(i));\r\n        ++i;\r\n    });\r\n}\r\n\r\n/* Benchmarks */\r\n\r\nstatic void EvictionProtection1Network250Candidates(benchmark::Bench& bench)\r\n{\r\n    EvictionProtectionCommon(\r\n        bench,\r\n        250 /* num_candidates */,\r\n        [](NodeEvictionCandidate& c) {\r\n            c.nTimeConnected = c.id;\r\n            c.m_is_local = false;\r\n            if (c.id >= 130 && c.id < 240) { // 110 Tor\r\n                c.m_network = NET_ONION;\r\n            } else {\r\n                c.m_network = NET_IPV6;\r\n            }\r\n        },\r\n        10 /* epochs */,\r\n        100 /* epoch_iterations */);\r\n}\r\n\r\nstatic void EvictionProtection3Networks050Candidates(benchmark::Bench& bench)\r\n{\r\n    EvictionProtectionCommon(\r\n        bench,\r\n        50 /* num_candidates */,\r\n        [](NodeEvictionCandidate& c) {\r\n            c.nTimeConnected = c.id;\r\n            c.m_is_local = (c.id == 28 || c.id == 47); //  2 localhost\r\n            if (c.id >= 30 && c.id < 47) {             // 17 I2P\r\n                c.m_network = NET_I2P;\r\n            } else if (c.id >= 24 && c.id < 28) { //  4 Tor\r\n                c.m_network = NET_ONION;\r\n            } else {\r\n                c.m_network = NET_IPV4;\r\n            }\r\n        },\r\n        10 /* epochs */,\r\n        100 /* epoch_iterations */);\r\n}\r\n\r\nstatic void EvictionProtection3Networks100Candidates(benchmark::Bench& bench)\r\n{\r\n    EvictionProtectionCommon(\r\n        bench,\r\n        100 /* num_candidates */,\r\n        [](NodeEvictionCandidate& c) {\r\n            c.nTimeConnected = c.id;\r\n            c.m_is_local = (c.id >= 55 && c.id < 60); //  5 localhost\r\n            if (c.id >= 70 && c.id < 80) {            // 10 I2P\r\n                c.m_network = NET_I2P;\r\n            } else if (c.id >= 80 && c.id < 96) { // 16 Tor\r\n                c.m_network = NET_ONION;\r\n            } else {\r\n                c.m_network = NET_IPV4;\r\n            }\r\n        },\r\n        10 /* epochs */,\r\n        100 /* epoch_iterations */);\r\n}\r\n\r\nstatic void EvictionProtection3Networks250Candidates(benchmark::Bench& bench)\r\n{\r\n    EvictionProtectionCommon(\r\n        bench,\r\n        250 /* num_candidates */,\r\n        [](NodeEvictionCandidate& c) {\r\n            c.nTimeConnected = c.id;\r\n            c.m_is_local = (c.id >= 140 && c.id < 160); // 20 localhost\r\n            if (c.id >= 170 && c.id < 180) {            // 10 I2P\r\n                c.m_network = NET_I2P;\r\n            } else if (c.id >= 190 && c.id < 240) { // 50 Tor\r\n                c.m_network = NET_ONION;\r\n            } else {\r\n                c.m_network = NET_IPV4;\r\n            }\r\n        },\r\n        10 /* epochs */,\r\n        100 /* epoch_iterations */);\r\n}\r\n\r\n// 1 disadvantaged network (Tor) with 250 eviction candidates.\r\nBENCHMARK(EvictionProtection1Network250Candidates);\r\n\r\n// 3 disadvantaged networks (I2P/localhost/Tor) with 50/100/250 eviction candidates.\r\nBENCHMARK(EvictionProtection3Networks050Candidates);\r\nBENCHMARK(EvictionProtection3Networks100Candidates);\r\nBENCHMARK(EvictionProtection3Networks250Candidates);\r\n```",
      "created_at": "2021-06-30T09:23:24Z",
      "updated_at": "2021-06-30T09:48:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#discussion_r661285594",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/661285594"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22284"
        }
      },
      "start_line": null,
      "original_start_line": 67,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 73,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/661294200",
      "pull_request_review_id": 695881962,
      "id": 661294200,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MTI5NDIwMA==",
      "diff_hunk": "@@ -921,11 +921,13 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\n         {{false, NET_I2P, 0}, {/* localhost */ true, NET_MAX, 0}, {false, NET_ONION, 0}}};\n \n     // Count and store the number of eviction candidates per network.\n-    for (Net& n : networks) {\n-        n.count = std::count_if(eviction_candidates.cbegin(), eviction_candidates.cend(),\n-                                [&n](const NodeEvictionCandidate& c) {\n-                                    return n.is_local ? c.m_is_local : c.m_network == n.id;\n-                                });\n+    for (auto& c : eviction_candidates) {\n+        for (int i{networks.size() - 1}; i >= 0; --i) {\n+            if (networks[i].is_local ? c.m_is_local : c.m_network == networks[i].id) {\n+                ++networks[i].count;\n+                break;\n+            }\n+        }\n     }",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 16,
      "commit_id": "b1d905c225e87a4a289c0cd3593c6c21cea3fba7",
      "original_commit_id": "ab2993336fbdff72d125f906c2baec4c5dcb79e3",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "99a25fb393 `p2p: iterate over eviction candidates once instead of thrice`\r\n\r\nI did not observe any difference in performance due to this commit.\r\n\r\nIt changes the complexity from `O(num networks * num candidates)` to `O(num candidates * num networks)`. The early `break` optimization maybe makes it `O(num candidates * num networks * 0.5)` on average, but that is equal to `O(num candidates * num networks)`.\r\n\r\nJust to experiment I made this `O(num candidates)` which is as fast as it could be (unfortunately a bit hackish due to the hardcoded indexes):\r\n\r\n```diff\r\n--- a/src/net.cpp\r\n+++ b/src/net.cpp\r\n@@ -918,18 +918,26 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\r\n     // array members have first opportunity to recover unused slots from the previous iteration.\r\n     struct Net { bool is_local; Network id; size_t count; };\r\n     std::array<Net, 3> networks{\r\n         {{false, NET_I2P, 0}, {/* localhost */ true, NET_MAX, 0}, {false, NET_ONION, 0}}};\r\n \r\n     // Count and store the number of eviction candidates per network.\r\n-    for (auto& c : eviction_candidates) {\r\n-        for (int i{networks.size() - 1}; i >= 0; --i) {\r\n-            if (networks[i].is_local ? c.m_is_local : c.m_network == networks[i].id) {\r\n-                ++networks[i].count;\r\n-                break;\r\n-            }\r\n+    for (const auto& c : eviction_candidates) {\r\n+        const Network net = c.m_is_local ? NET_MAX : c.m_network;\r\n+        switch (net) {\r\n+        case NET_I2P:\r\n+            ++networks[0].count;\r\n+            break;\r\n+        case NET_MAX:\r\n+            ++networks[1].count;\r\n+            break;\r\n+        case NET_ONION:\r\n+            ++networks[2].count;\r\n+            break;\r\n+        default:\r\n+            break;\r\n         }\r\n     }\r\n     // Sort `networks` by ascending candidate count, to give networks having fewer candidates\r\n     // the first opportunity to recover unused protected slots from the previous iteration.\r\n```\r\n\r\nNo difference in performance either. I guess this is operating on too small amount of data to make any performance impact and so this commit can be dropped if its purpose is to improve performance and we can't observe any changes.",
      "created_at": "2021-06-30T09:34:42Z",
      "updated_at": "2021-06-30T09:48:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#discussion_r661294200",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/661294200"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22284"
        }
      },
      "start_line": null,
      "original_start_line": 924,
      "start_side": "LEFT",
      "line": null,
      "original_line": 929,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/661302739",
      "pull_request_review_id": 695881962,
      "id": 661302739,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MTMwMjczOQ==",
      "diff_hunk": "@@ -936,27 +938,34 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\n     size_t num_protected{0};\n \n     while (num_protected < max_protect_by_network) {\n+        // Count the number of disadvantaged networks from which we have peers to protect.\n+        auto num_networks = std::count_if(networks.begin(), networks.end(), [](const Net& n) { return n.count; });\n+        if (num_networks == 0) {\n+            break;\n+        }",
      "path": "src/net.cpp",
      "position": 8,
      "original_position": 27,
      "commit_id": "b1d905c225e87a4a289c0cd3593c6c21cea3fba7",
      "original_commit_id": "ab2993336fbdff72d125f906c2baec4c5dcb79e3",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "06b898c3e1 `p2p: iterate eviction protection only on networks having candidates`\r\n\r\nLooking at this commit - there is no need to re-calculate `num_networks` inside the loop because `networks` is not changed in the loop. It can be calculated just once before the loop:\r\n\r\n```cpp\r\nauto num_networks = std::count_if(networks.begin(), networks.end(), [](const Net& n) { return n.count; });\r\nif (networks > 0) {\r\n    while (num_protected < max_protect_by_network) {\r\n        ...\r\n```\r\n\r\nI did not observe any performance change due to this commit.\r\n\r\nBut considering the subsequent ab2993336f `p2p: earlier continuation when no remaining eviction candidates` (this one brings pefromance boost!) it should be inside the loop because then we change `networks[].count` in the loop. Maybe squash both commits into one?",
      "created_at": "2021-06-30T09:46:31Z",
      "updated_at": "2021-06-30T09:48:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#discussion_r661302739",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/661302739"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22284"
        }
      },
      "start_line": 938,
      "original_start_line": 940,
      "start_side": "RIGHT",
      "line": 943,
      "original_line": 943,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/661341225",
      "pull_request_review_id": 695969918,
      "id": 661341225,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MTM0MTIyNQ==",
      "diff_hunk": "@@ -921,11 +921,13 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\n         {{false, NET_I2P, 0}, {/* localhost */ true, NET_MAX, 0}, {false, NET_ONION, 0}}};\n \n     // Count and store the number of eviction candidates per network.\n-    for (Net& n : networks) {\n-        n.count = std::count_if(eviction_candidates.cbegin(), eviction_candidates.cend(),\n-                                [&n](const NodeEvictionCandidate& c) {\n-                                    return n.is_local ? c.m_is_local : c.m_network == n.id;\n-                                });\n+    for (auto& c : eviction_candidates) {\n+        for (int i{networks.size() - 1}; i >= 0; --i) {\n+            if (networks[i].is_local ? c.m_is_local : c.m_network == networks[i].id) {\n+                ++networks[i].count;\n+                break;\n+            }\n+        }\n     }",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 16,
      "commit_id": "b1d905c225e87a4a289c0cd3593c6c21cea3fba7",
      "original_commit_id": "ab2993336fbdff72d125f906c2baec4c5dcb79e3",
      "in_reply_to_id": 661294200,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> I did not observe any difference in performance due to this commit.\r\n\r\nHere are the results I get:\r\n\r\n272f327fbf `bench: add peer eviction protection benchmarks`\r\n```\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|      706,673,971.00 |                1.42 |    1.7% |      7.79 | `EvictionProtection1Network250Candidates`\r\n|    1,299,063,388.00 |                0.77 |    0.7% |     14.30 | `EvictionProtection3Networks050Candidates`\r\n|    1,155,171,747.00 |                0.87 |    0.5% |     12.73 | `EvictionProtection3Networks100Candidates`\r\n|    2,900,919,398.00 |                0.34 |    1.3% |     31.93 | `EvictionProtection3Networks250Candidates`\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|      714,684,192.00 |                1.40 |    1.0% |      7.91 | `EvictionProtection1Network250Candidates`\r\n|    1,296,579,234.00 |                0.77 |    0.5% |     14.22 | `EvictionProtection3Networks050Candidates`\r\n|    1,159,393,440.00 |                0.86 |    0.7% |     12.71 | `EvictionProtection3Networks100Candidates`\r\n|    2,854,527,930.00 |                0.35 |    0.7% |     31.44 | `EvictionProtection3Networks250Candidates`\r\n```\r\n\r\n99a25fb393 `p2p: iterate over eviction candidates once instead of thrice`\r\n```\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|      709,622,212.00 |                1.41 |    1.0% |      7.79 | `EvictionProtection1Network250Candidates`\r\n|    1,310,376,054.00 |                0.76 |    1.2% |     14.39 | `EvictionProtection3Networks050Candidates`\r\n|    1,160,800,660.00 |                0.86 |    0.4% |     12.72 | `EvictionProtection3Networks100Candidates`\r\n|    2,983,258,845.00 |                0.34 |    0.5% |     32.71 | `EvictionProtection3Networks250Candidates`\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|      711,091,374.00 |                1.41 |    0.5% |      7.82 | `EvictionProtection1Network250Candidates`\r\n|    1,318,781,548.00 |                0.76 |    0.3% |     14.38 | `EvictionProtection3Networks050Candidates`\r\n|    1,142,837,118.00 |                0.88 |    0.2% |     12.40 | `EvictionProtection3Networks100Candidates`\r\n|    2,943,154,182.00 |                0.34 |    0.4% |     32.22 | `EvictionProtection3Networks250Candidates`\r\n```",
      "created_at": "2021-06-30T10:44:33Z",
      "updated_at": "2021-06-30T10:44:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#discussion_r661341225",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/661341225"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22284"
        }
      },
      "start_line": null,
      "original_start_line": 924,
      "start_side": "LEFT",
      "line": null,
      "original_line": 929,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662277055",
      "pull_request_review_id": 697227746,
      "id": 662277055,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MjI3NzA1NQ==",
      "diff_hunk": "@@ -0,0 +1,169 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <net.h>\n+#include <netaddress.h>\n+#include <random.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <vector>\n+\n+std::vector<NodeEvictionCandidate> GetRandomNodeEvictionCandidates(int num_peers, FastRandomContext& random_context)\n+{\n+    std::vector<NodeEvictionCandidate> candidates;\n+    for (int id = 0; id < num_peers; ++id) {\n+        candidates.push_back({\n+            /* id */ id,\n+            /* nTimeConnected */ static_cast<int64_t>(random_context.randrange(100)),\n+            /* m_min_ping_time */ std::chrono::microseconds{random_context.randrange(100)},\n+            /* nLastBlockTime */ static_cast<int64_t>(random_context.randrange(100)),\n+            /* nLastTXTime */ static_cast<int64_t>(random_context.randrange(100)),\n+            /* fRelevantServices */ random_context.randbool(),\n+            /* fRelayTxes */ random_context.randbool(),\n+            /* fBloomFilter */ random_context.randbool(),\n+            /* nKeyedNetGroup */ random_context.randrange(100),\n+            /* prefer_evict */ random_context.randbool(),\n+            /* m_is_local */ random_context.randbool(),\n+            /* m_network */ ALL_NETWORKS[random_context.randrange(ALL_NETWORKS.size())],\n+        });\n+    }\n+    return candidates;\n+}",
      "path": "src/bench/peer_eviction.cpp",
      "position": null,
      "original_position": 36,
      "commit_id": "b1d905c225e87a4a289c0cd3593c6c21cea3fba7",
      "original_commit_id": "ab2993336fbdff72d125f906c2baec4c5dcb79e3",
      "in_reply_to_id": 661275001,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done (thanks!)",
      "created_at": "2021-07-01T13:13:17Z",
      "updated_at": "2021-07-01T13:13:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#discussion_r662277055",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662277055"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22284"
        }
      },
      "start_line": null,
      "original_start_line": 16,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 36,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662283296",
      "pull_request_review_id": 697236534,
      "id": 662283296,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MjI4MzI5Ng==",
      "diff_hunk": "@@ -0,0 +1,169 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <net.h>\n+#include <netaddress.h>\n+#include <random.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <vector>\n+\n+std::vector<NodeEvictionCandidate> GetRandomNodeEvictionCandidates(int num_peers, FastRandomContext& random_context)\n+{\n+    std::vector<NodeEvictionCandidate> candidates;\n+    for (int id = 0; id < num_peers; ++id) {\n+        candidates.push_back({\n+            /* id */ id,\n+            /* nTimeConnected */ static_cast<int64_t>(random_context.randrange(100)),\n+            /* m_min_ping_time */ std::chrono::microseconds{random_context.randrange(100)},\n+            /* nLastBlockTime */ static_cast<int64_t>(random_context.randrange(100)),\n+            /* nLastTXTime */ static_cast<int64_t>(random_context.randrange(100)),\n+            /* fRelevantServices */ random_context.randbool(),\n+            /* fRelayTxes */ random_context.randbool(),\n+            /* fBloomFilter */ random_context.randbool(),\n+            /* nKeyedNetGroup */ random_context.randrange(100),\n+            /* prefer_evict */ random_context.randbool(),\n+            /* m_is_local */ random_context.randbool(),\n+            /* m_network */ ALL_NETWORKS[random_context.randrange(ALL_NETWORKS.size())],\n+        });\n+    }\n+    return candidates;\n+}\n+\n+static std::vector<NodeEvictionCandidate> CreateEvictionCandidates(int num_peers, std::function<void(NodeEvictionCandidate&)> candidate_setup_fn, FastRandomContext& random_context)\n+{\n+    std::vector<NodeEvictionCandidate> candidates{GetRandomNodeEvictionCandidates(num_peers, random_context)};\n+    for (NodeEvictionCandidate& candidate : candidates) {\n+        candidate_setup_fn(candidate);\n+    }\n+    return candidates;\n+}\n+\n+/* Benchmarks */\n+\n+static void EvictionProtection1Network250Candidates(benchmark::Bench& bench)\n+{\n+    const int num_peers{250};\n+    FastRandomContext random_context{true};\n+\n+    const std::vector<NodeEvictionCandidate> eviction_candidates{\n+        CreateEvictionCandidates(\n+            num_peers, [](NodeEvictionCandidate& c) {\n+                c.nTimeConnected = c.id;\n+                c.m_is_local = false;\n+                if (c.id >= 130 && c.id < 240) { // 110 Tor\n+                    c.m_network = NET_ONION;\n+                } else {\n+                    c.m_network = NET_IPV6;\n+                }\n+            },\n+            random_context)};\n+\n+    bench.run([&] {\n+        std::vector<NodeEvictionCandidate> candidates;\n+        for (int id = 0; id < 60000; ++id) {\n+            candidates = eviction_candidates;\n+            ProtectEvictionCandidatesByRatio(candidates);\n+        }\n+    });",
      "path": "src/bench/peer_eviction.cpp",
      "position": null,
      "original_position": 73,
      "commit_id": "b1d905c225e87a4a289c0cd3593c6c21cea3fba7",
      "original_commit_id": "ab2993336fbdff72d125f906c2baec4c5dcb79e3",
      "in_reply_to_id": 661285594,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I tried this, and am playing with your proposal that looks good! but as before when I was trying to use these options, nanobench kept saying it was unstable and to increase the iterations, beyond even the numbers I settled on in my manual loops that yielded slowish but stableish results for me.\r\n```\r\n:wavy_dash: ... (Unstable with ~1,000.0 iters. Increase `minEpochIterations` to e.g. 10000)\r\n:wavy_dash: ... (Unstable with ~1,000.0 iters. Increase `minEpochIterations` to e.g. 10000)\r\n```\r\nSo I'm still looking at this and may punt on using the options.  \r\n\r\nYes, I benched the data copying alone, and it seemed insignificant relative to the call under test, not worth messing with by making (potentially many, e.g. 100k) copies instead.  That could be ok if we don't need so many copies, so I understand why you proposed reducing the number of iters.",
      "created_at": "2021-07-01T13:21:12Z",
      "updated_at": "2021-07-01T13:22:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#discussion_r662283296",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662283296"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22284"
        }
      },
      "start_line": null,
      "original_start_line": 67,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 73,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662288417",
      "pull_request_review_id": 697243615,
      "id": 662288417,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MjI4ODQxNw==",
      "diff_hunk": "@@ -921,11 +921,13 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\n         {{false, NET_I2P, 0}, {/* localhost */ true, NET_MAX, 0}, {false, NET_ONION, 0}}};\n \n     // Count and store the number of eviction candidates per network.\n-    for (Net& n : networks) {\n-        n.count = std::count_if(eviction_candidates.cbegin(), eviction_candidates.cend(),\n-                                [&n](const NodeEvictionCandidate& c) {\n-                                    return n.is_local ? c.m_is_local : c.m_network == n.id;\n-                                });\n+    for (auto& c : eviction_candidates) {\n+        for (int i{networks.size() - 1}; i >= 0; --i) {\n+            if (networks[i].is_local ? c.m_is_local : c.m_network == networks[i].id) {\n+                ++networks[i].count;\n+                break;\n+            }\n+        }\n     }",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 16,
      "commit_id": "b1d905c225e87a4a289c0cd3593c6c21cea3fba7",
      "original_commit_id": "ab2993336fbdff72d125f906c2baec4c5dcb79e3",
      "in_reply_to_id": 661294200,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "99a25fb393c791bb6b6edeab3677d39bf6b1d97d I agree that it's probably not worth it.",
      "created_at": "2021-07-01T13:27:36Z",
      "updated_at": "2021-07-01T13:27:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#discussion_r662288417",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662288417"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22284"
        }
      },
      "start_line": null,
      "original_start_line": 924,
      "start_side": "LEFT",
      "line": null,
      "original_line": 929,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662428128",
      "pull_request_review_id": 697435315,
      "id": 662428128,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MjQyODEyOA==",
      "diff_hunk": "@@ -0,0 +1,169 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <net.h>\n+#include <netaddress.h>\n+#include <random.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <vector>\n+\n+std::vector<NodeEvictionCandidate> GetRandomNodeEvictionCandidates(int num_peers, FastRandomContext& random_context)\n+{\n+    std::vector<NodeEvictionCandidate> candidates;\n+    for (int id = 0; id < num_peers; ++id) {\n+        candidates.push_back({\n+            /* id */ id,\n+            /* nTimeConnected */ static_cast<int64_t>(random_context.randrange(100)),\n+            /* m_min_ping_time */ std::chrono::microseconds{random_context.randrange(100)},\n+            /* nLastBlockTime */ static_cast<int64_t>(random_context.randrange(100)),\n+            /* nLastTXTime */ static_cast<int64_t>(random_context.randrange(100)),\n+            /* fRelevantServices */ random_context.randbool(),\n+            /* fRelayTxes */ random_context.randbool(),\n+            /* fBloomFilter */ random_context.randbool(),\n+            /* nKeyedNetGroup */ random_context.randrange(100),\n+            /* prefer_evict */ random_context.randbool(),\n+            /* m_is_local */ random_context.randbool(),\n+            /* m_network */ ALL_NETWORKS[random_context.randrange(ALL_NETWORKS.size())],\n+        });\n+    }\n+    return candidates;\n+}\n+\n+static std::vector<NodeEvictionCandidate> CreateEvictionCandidates(int num_peers, std::function<void(NodeEvictionCandidate&)> candidate_setup_fn, FastRandomContext& random_context)\n+{\n+    std::vector<NodeEvictionCandidate> candidates{GetRandomNodeEvictionCandidates(num_peers, random_context)};\n+    for (NodeEvictionCandidate& candidate : candidates) {\n+        candidate_setup_fn(candidate);\n+    }\n+    return candidates;\n+}\n+\n+/* Benchmarks */\n+\n+static void EvictionProtection1Network250Candidates(benchmark::Bench& bench)\n+{\n+    const int num_peers{250};\n+    FastRandomContext random_context{true};\n+\n+    const std::vector<NodeEvictionCandidate> eviction_candidates{\n+        CreateEvictionCandidates(\n+            num_peers, [](NodeEvictionCandidate& c) {\n+                c.nTimeConnected = c.id;\n+                c.m_is_local = false;\n+                if (c.id >= 130 && c.id < 240) { // 110 Tor\n+                    c.m_network = NET_ONION;\n+                } else {\n+                    c.m_network = NET_IPV6;\n+                }\n+            },\n+            random_context)};\n+\n+    bench.run([&] {\n+        std::vector<NodeEvictionCandidate> candidates;\n+        for (int id = 0; id < 60000; ++id) {\n+            candidates = eviction_candidates;\n+            ProtectEvictionCandidatesByRatio(candidates);\n+        }\n+    });",
      "path": "src/bench/peer_eviction.cpp",
      "position": null,
      "original_position": 73,
      "commit_id": "b1d905c225e87a4a289c0cd3593c6c21cea3fba7",
      "original_commit_id": "ab2993336fbdff72d125f906c2baec4c5dcb79e3",
      "in_reply_to_id": 661285594,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Here are some numbers:\r\n\r\n* `sizeof(NodeEvictionCandidate)` is 64\r\n* number of candidates is 250\r\n* the current test contains 60k iterations\r\n\r\nSo that would make 64 * 250 * 60000 = 916 MiB.\r\n\r\nIn the changes above I suggested 10 epochs * 100 iterations (1000 copies): 64 * 250 * 1000 = 15 MiB.\r\n\r\n> so I understand why you proposed reducing the number of iters\r\n\r\nYes, I was concerned about the memory usage, but also I stopped getting the \"unstable results\" warning at around 500 iters so I decided to double it to 1000 just in case, since 15 MiB is not too much. I guess a few times more than that would also be ok.",
      "created_at": "2021-07-01T16:18:27Z",
      "updated_at": "2021-07-01T16:18:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#discussion_r662428128",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662428128"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22284"
        }
      },
      "start_line": null,
      "original_start_line": 67,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 73,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663886898",
      "pull_request_review_id": 699119908,
      "id": 663886898,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mzg4Njg5OA==",
      "diff_hunk": "@@ -0,0 +1,169 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <net.h>\n+#include <netaddress.h>\n+#include <random.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <vector>\n+\n+std::vector<NodeEvictionCandidate> GetRandomNodeEvictionCandidates(int num_peers, FastRandomContext& random_context)\n+{\n+    std::vector<NodeEvictionCandidate> candidates;\n+    for (int id = 0; id < num_peers; ++id) {\n+        candidates.push_back({\n+            /* id */ id,\n+            /* nTimeConnected */ static_cast<int64_t>(random_context.randrange(100)),\n+            /* m_min_ping_time */ std::chrono::microseconds{random_context.randrange(100)},\n+            /* nLastBlockTime */ static_cast<int64_t>(random_context.randrange(100)),\n+            /* nLastTXTime */ static_cast<int64_t>(random_context.randrange(100)),\n+            /* fRelevantServices */ random_context.randbool(),\n+            /* fRelayTxes */ random_context.randbool(),\n+            /* fBloomFilter */ random_context.randbool(),\n+            /* nKeyedNetGroup */ random_context.randrange(100),\n+            /* prefer_evict */ random_context.randbool(),\n+            /* m_is_local */ random_context.randbool(),\n+            /* m_network */ ALL_NETWORKS[random_context.randrange(ALL_NETWORKS.size())],\n+        });\n+    }\n+    return candidates;\n+}\n+\n+static std::vector<NodeEvictionCandidate> CreateEvictionCandidates(int num_peers, std::function<void(NodeEvictionCandidate&)> candidate_setup_fn, FastRandomContext& random_context)\n+{\n+    std::vector<NodeEvictionCandidate> candidates{GetRandomNodeEvictionCandidates(num_peers, random_context)};\n+    for (NodeEvictionCandidate& candidate : candidates) {\n+        candidate_setup_fn(candidate);\n+    }\n+    return candidates;\n+}\n+\n+/* Benchmarks */\n+\n+static void EvictionProtection1Network250Candidates(benchmark::Bench& bench)\n+{\n+    const int num_peers{250};\n+    FastRandomContext random_context{true};\n+\n+    const std::vector<NodeEvictionCandidate> eviction_candidates{\n+        CreateEvictionCandidates(\n+            num_peers, [](NodeEvictionCandidate& c) {\n+                c.nTimeConnected = c.id;\n+                c.m_is_local = false;\n+                if (c.id >= 130 && c.id < 240) { // 110 Tor\n+                    c.m_network = NET_ONION;\n+                } else {\n+                    c.m_network = NET_IPV6;\n+                }\n+            },\n+            random_context)};\n+\n+    bench.run([&] {\n+        std::vector<NodeEvictionCandidate> candidates;\n+        for (int id = 0; id < 60000; ++id) {\n+            candidates = eviction_candidates;\n+            ProtectEvictionCandidatesByRatio(candidates);\n+        }\n+    });",
      "path": "src/bench/peer_eviction.cpp",
      "position": null,
      "original_position": 73,
      "commit_id": "b1d905c225e87a4a289c0cd3593c6c21cea3fba7",
      "original_commit_id": "ab2993336fbdff72d125f906c2baec4c5dcb79e3",
      "in_reply_to_id": 661285594,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Two random thoughts:\r\n\r\n1. Do you get \"unstable results\" warnings when running other benchmarks from `src/bench`?\r\n2. Nanobench's [`warmup()`](https://nanobench.ankerl.com/reference.html#_CPPv4N6ankerl9nanobench5Bench6warmupE8uint64_t) may help?",
      "created_at": "2021-07-05T12:18:56Z",
      "updated_at": "2021-07-05T12:18:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#discussion_r663886898",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663886898"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22284"
        }
      },
      "start_line": null,
      "original_start_line": 67,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 73,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664666909",
      "pull_request_review_id": 700104496,
      "id": 664666909,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDY2NjkwOQ==",
      "diff_hunk": "@@ -936,27 +938,34 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\n     size_t num_protected{0};\n \n     while (num_protected < max_protect_by_network) {\n+        // Count the number of disadvantaged networks from which we have peers to protect.\n+        auto num_networks = std::count_if(networks.begin(), networks.end(), [](const Net& n) { return n.count; });\n+        if (num_networks == 0) {\n+            break;\n+        }",
      "path": "src/net.cpp",
      "position": 8,
      "original_position": 27,
      "commit_id": "b1d905c225e87a4a289c0cd3593c6c21cea3fba7",
      "original_commit_id": "ab2993336fbdff72d125f906c2baec4c5dcb79e3",
      "in_reply_to_id": 661302739,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Reorganized to be step by step, with no anticipatory changes.",
      "created_at": "2021-07-06T15:35:18Z",
      "updated_at": "2021-07-06T15:35:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#discussion_r664666909",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664666909"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22284"
        }
      },
      "start_line": 938,
      "original_start_line": 940,
      "start_side": "RIGHT",
      "line": 943,
      "original_line": 943,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664667111",
      "pull_request_review_id": 700104762,
      "id": 664667111,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDY2NzExMQ==",
      "diff_hunk": "@@ -921,11 +921,13 @@ void ProtectEvictionCandidatesByRatio(std::vector<NodeEvictionCandidate>& evicti\n         {{false, NET_I2P, 0}, {/* localhost */ true, NET_MAX, 0}, {false, NET_ONION, 0}}};\n \n     // Count and store the number of eviction candidates per network.\n-    for (Net& n : networks) {\n-        n.count = std::count_if(eviction_candidates.cbegin(), eviction_candidates.cend(),\n-                                [&n](const NodeEvictionCandidate& c) {\n-                                    return n.is_local ? c.m_is_local : c.m_network == n.id;\n-                                });\n+    for (auto& c : eviction_candidates) {\n+        for (int i{networks.size() - 1}; i >= 0; --i) {\n+            if (networks[i].is_local ? c.m_is_local : c.m_network == networks[i].id) {\n+                ++networks[i].count;\n+                break;\n+            }\n+        }\n     }",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 16,
      "commit_id": "b1d905c225e87a4a289c0cd3593c6c21cea3fba7",
      "original_commit_id": "ab2993336fbdff72d125f906c2baec4c5dcb79e3",
      "in_reply_to_id": 661294200,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Dropped.",
      "created_at": "2021-07-06T15:35:32Z",
      "updated_at": "2021-07-06T15:35:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#discussion_r664667111",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664667111"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22284"
        }
      },
      "start_line": null,
      "original_start_line": 924,
      "start_side": "LEFT",
      "line": null,
      "original_line": 929,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664668934",
      "pull_request_review_id": 700107138,
      "id": 664668934,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDY2ODkzNA==",
      "diff_hunk": "@@ -0,0 +1,169 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <net.h>\n+#include <netaddress.h>\n+#include <random.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <vector>\n+\n+std::vector<NodeEvictionCandidate> GetRandomNodeEvictionCandidates(int num_peers, FastRandomContext& random_context)\n+{\n+    std::vector<NodeEvictionCandidate> candidates;\n+    for (int id = 0; id < num_peers; ++id) {\n+        candidates.push_back({\n+            /* id */ id,\n+            /* nTimeConnected */ static_cast<int64_t>(random_context.randrange(100)),\n+            /* m_min_ping_time */ std::chrono::microseconds{random_context.randrange(100)},\n+            /* nLastBlockTime */ static_cast<int64_t>(random_context.randrange(100)),\n+            /* nLastTXTime */ static_cast<int64_t>(random_context.randrange(100)),\n+            /* fRelevantServices */ random_context.randbool(),\n+            /* fRelayTxes */ random_context.randbool(),\n+            /* fBloomFilter */ random_context.randbool(),\n+            /* nKeyedNetGroup */ random_context.randrange(100),\n+            /* prefer_evict */ random_context.randbool(),\n+            /* m_is_local */ random_context.randbool(),\n+            /* m_network */ ALL_NETWORKS[random_context.randrange(ALL_NETWORKS.size())],\n+        });\n+    }\n+    return candidates;\n+}\n+\n+static std::vector<NodeEvictionCandidate> CreateEvictionCandidates(int num_peers, std::function<void(NodeEvictionCandidate&)> candidate_setup_fn, FastRandomContext& random_context)\n+{\n+    std::vector<NodeEvictionCandidate> candidates{GetRandomNodeEvictionCandidates(num_peers, random_context)};\n+    for (NodeEvictionCandidate& candidate : candidates) {\n+        candidate_setup_fn(candidate);\n+    }\n+    return candidates;\n+}\n+\n+/* Benchmarks */\n+\n+static void EvictionProtection1Network250Candidates(benchmark::Bench& bench)\n+{\n+    const int num_peers{250};\n+    FastRandomContext random_context{true};\n+\n+    const std::vector<NodeEvictionCandidate> eviction_candidates{\n+        CreateEvictionCandidates(\n+            num_peers, [](NodeEvictionCandidate& c) {\n+                c.nTimeConnected = c.id;\n+                c.m_is_local = false;\n+                if (c.id >= 130 && c.id < 240) { // 110 Tor\n+                    c.m_network = NET_ONION;\n+                } else {\n+                    c.m_network = NET_IPV6;\n+                }\n+            },\n+            random_context)};\n+\n+    bench.run([&] {\n+        std::vector<NodeEvictionCandidate> candidates;\n+        for (int id = 0; id < 60000; ++id) {\n+            candidates = eviction_candidates;\n+            ProtectEvictionCandidatesByRatio(candidates);\n+        }\n+    });",
      "path": "src/bench/peer_eviction.cpp",
      "position": null,
      "original_position": 73,
      "commit_id": "b1d905c225e87a4a289c0cd3593c6c21cea3fba7",
      "original_commit_id": "ab2993336fbdff72d125f906c2baec4c5dcb79e3",
      "in_reply_to_id": 661285594,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I've tuned my system for benchmarking, and nevertheless, any iterations less than in my original proposal still return bench error rates above 5%, often 10-25%, rendering the benchmark somewhat useless for me.\r\n\r\nI'm going to consider that my system (2 physical cores, 4 logical ones, with an open source coreboot) is unusual and unsuited to running these benchmarks and use this feedback provided that reviewers find the results stable for them.",
      "created_at": "2021-07-06T15:37:46Z",
      "updated_at": "2021-07-06T15:37:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22284#discussion_r664668934",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664668934"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22284"
        }
      },
      "start_line": null,
      "original_start_line": 67,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 73,
      "side": "RIGHT"
    }
  ]
}