{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943",
    "id": 643936505,
    "node_id": "MDExOlB1bGxSZXF1ZXN0NjQzOTM2NTA1",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21943",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/21943.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/21943.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21943",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21943/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/f52b6b2d9f482353821da0ef4c485c402a396c8d",
    "number": 21943,
    "state": "closed",
    "locked": true,
    "maintainer_can_modify": false,
    "title": "Dedup and RAII-fy the creation of a copy of CConnman::vNodes",
    "user": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "_This is a piece of https://github.com/bitcoin/bitcoin/pull/21878, chopped off to ease review._\r\n\r\nThe following pattern was duplicated in CConnman:\r\n\r\n```cpp\r\nlock\r\ncreate a copy of vNodes, add a reference to each one \r\nunlock\r\n... use the copy ... \r\nlock\r\nrelease each node from the copy\r\nunlock\r\n```\r\n\r\nPut that code in a RAII helper that reduces it to: \r\n\r\n```cpp\r\ncreate snapshot \"snap\"\r\n... use the copy ... \r\n// release happens when \"snap\" goes out of scope\r\n",
    "labels": [
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      }
    ],
    "created_at": "2021-05-13T12:30:51Z",
    "updated_at": "2022-11-26T09:59:46Z",
    "closed_at": "2021-11-24T16:50:17Z",
    "mergeable": false,
    "mergeable_state": "dirty",
    "merge_commit_sha": "0124de36641ad56c6209a79e90227e6811dcbbf3",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": false,
    "head": {
      "label": "vasild:raiify_copying_vnodes",
      "ref": "raiify_copying_vnodes",
      "sha": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 120608826,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMjA2MDg4MjY=",
        "name": "bitcoin",
        "full_name": "vasild/bitcoin",
        "owner": {
          "login": "vasild",
          "id": 266751,
          "node_id": "MDQ6VXNlcjI2Njc1MQ==",
          "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/vasild",
          "html_url": "https://github.com/vasild",
          "followers_url": "https://api.github.com/users/vasild/followers",
          "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
          "organizations_url": "https://api.github.com/users/vasild/orgs",
          "repos_url": "https://api.github.com/users/vasild/repos",
          "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/vasild/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/vasild/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/vasild/bitcoin",
        "archive_url": "https://api.github.com/repos/vasild/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/vasild/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/vasild/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/vasild/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/vasild/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/vasild/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/vasild/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/vasild/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/vasild/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/vasild/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/vasild/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/vasild/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/vasild/bitcoin/events",
        "forks_url": "https://api.github.com/repos/vasild/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/vasild/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/vasild/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/vasild/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/vasild/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/vasild/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/vasild/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/vasild/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/vasild/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/vasild/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/vasild/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/vasild/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/vasild/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/vasild/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/vasild/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/vasild/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:vasild/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/vasild/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/vasild/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/vasild/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/vasild/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/vasild/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/vasild/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/vasild/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/vasild/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/vasild/bitcoin/hooks",
        "svn_url": "https://github.com/vasild/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 1,
        "stargazers_count": 3,
        "watchers_count": 3,
        "size": 211824,
        "default_branch": "master",
        "open_issues_count": 2,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-06T10:22:48Z",
        "created_at": "2018-02-07T11:52:47Z",
        "updated_at": "2023-01-31T16:56:52Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "fe03f7a37fd0ef05149161f6b95a25493e1fe38f",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 34324,
        "stargazers_count": 69819,
        "watchers_count": 69819,
        "size": 233879,
        "default_branch": "master",
        "open_issues_count": 627,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-06T22:42:00Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-06-07T04:47:18Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 182,
    "deletions": 101,
    "changed_files": 2,
    "commits": 4,
    "review_comments": 82,
    "comments": 19
  },
  "events": [
    {
      "event": "labeled",
      "id": 4741696774,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDQ3NDE2OTY3NzQ=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4741696774",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-05-13T12:51:26Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    },
    {
      "event": "commented",
      "id": 840631813,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg0MDYzMTgxMw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/840631813",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-05-13T15:17:05Z",
      "updated_at": "2021-11-19T11:16:26Z",
      "author_association": "MEMBER",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#22829](https://github.com/bitcoin/bitcoin/pull/22829) (refactor: various RecursiveMutex replacements in CConnman by theStack)\n* [#21879](https://github.com/bitcoin/bitcoin/pull/21879) (Wrap accept() and extend usage of Sock by vasild)\n* [#21878](https://github.com/bitcoin/bitcoin/pull/21878) (Make all networking code mockable by vasild)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#issuecomment-840631813",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21943"
    },
    {
      "event": "reviewed",
      "id": 659359605,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjU5MzU5NjA1",
      "url": null,
      "actor": null,
      "commit_id": "157674ef213e6329215d1b7eb85dacbc23c468db",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#pullrequestreview-659359605",
      "submitted_at": "2021-05-13T22:50:43Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
    },
    {
      "event": "commented",
      "id": 841130784,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg0MTEzMDc4NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/841130784",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-05-14T09:31:56Z",
      "updated_at": "2021-05-14T09:31:56Z",
      "author_association": "MEMBER",
      "body": "Concept ACK",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#issuecomment-841130784",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21943"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4746435571,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDc0NjQzNTU3MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4746435571",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-05-14T10:54:13Z"
    },
    {
      "event": "commented",
      "id": 841173328,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg0MTE3MzMyOA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/841173328",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-05-14T11:00:18Z",
      "updated_at": "2021-05-14T11:00:18Z",
      "author_association": "MEMBER",
      "body": "`644726117...92f62d9ea`: add an explicit commit that shows we intentionally don't process newly accepted nodes, as discussed in https://github.com/bitcoin/bitcoin/pull/21943#discussion_r632150326",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#issuecomment-841173328",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21943"
    },
    {
      "event": "reviewed",
      "id": 660007293,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjYwMDA3Mjkz",
      "url": null,
      "actor": null,
      "commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#pullrequestreview-660007293",
      "submitted_at": "2021-05-14T16:30:40Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
    },
    {
      "event": "commented",
      "id": 841617954,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg0MTYxNzk1NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/841617954",
      "actor": {
        "login": "practicalswift",
        "id": 7826565,
        "node_id": "MDQ6VXNlcjc4MjY1NjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/practicalswift",
        "html_url": "https://github.com/practicalswift",
        "followers_url": "https://api.github.com/users/practicalswift/followers",
        "following_url": "https://api.github.com/users/practicalswift/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/practicalswift/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/practicalswift/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
        "organizations_url": "https://api.github.com/users/practicalswift/orgs",
        "repos_url": "https://api.github.com/users/practicalswift/repos",
        "events_url": "https://api.github.com/users/practicalswift/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/practicalswift/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-05-15T07:51:32Z",
      "updated_at": "2021-05-15T07:51:32Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK",
      "user": {
        "login": "practicalswift",
        "id": 7826565,
        "node_id": "MDQ6VXNlcjc4MjY1NjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/practicalswift",
        "html_url": "https://github.com/practicalswift",
        "followers_url": "https://api.github.com/users/practicalswift/followers",
        "following_url": "https://api.github.com/users/practicalswift/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/practicalswift/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/practicalswift/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
        "organizations_url": "https://api.github.com/users/practicalswift/orgs",
        "repos_url": "https://api.github.com/users/practicalswift/repos",
        "events_url": "https://api.github.com/users/practicalswift/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/practicalswift/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#issuecomment-841617954",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21943"
    },
    {
      "event": "reviewed",
      "id": 660366732,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjYwMzY2NzMy",
      "url": null,
      "actor": null,
      "commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "concept ACK, some thoughts & questions as I familiarize myself with the code ",
      "user": {
        "login": "amitiuttarwar",
        "id": 1500952,
        "node_id": "MDQ6VXNlcjE1MDA5NTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/amitiuttarwar",
        "html_url": "https://github.com/amitiuttarwar",
        "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
        "following_url": "https://api.github.com/users/amitiuttarwar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/amitiuttarwar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/amitiuttarwar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
        "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
        "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
        "events_url": "https://api.github.com/users/amitiuttarwar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#pullrequestreview-660366732",
      "submitted_at": "2021-05-15T15:48:49Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
    },
    {
      "event": "reviewed",
      "id": 660378433,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjYwMzc4NDMz",
      "url": null,
      "actor": null,
      "commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#pullrequestreview-660378433",
      "submitted_at": "2021-05-15T18:07:45Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4755099622,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDc1NTA5OTYyMg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4755099622",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-05-17T14:47:21Z"
    },
    {
      "event": "commented",
      "id": 842411377,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg0MjQxMTM3Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/842411377",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-05-17T15:19:31Z",
      "updated_at": "2021-05-17T15:19:31Z",
      "author_association": "MEMBER",
      "body": "`92f62d9...00a8c94`: address review suggestions",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#issuecomment-842411377",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21943"
    },
    {
      "event": "reviewed",
      "id": 661458210,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjYxNDU4MjEw",
      "url": null,
      "actor": null,
      "commit_id": "00a8c943d7df3e5a58e55928a8600e062c5b4ad5",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Code review ACK 00a8c943d7df3e5a58e55928a8600e062c5b4ad5.",
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#pullrequestreview-661458210",
      "submitted_at": "2021-05-17T21:57:39Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
    },
    {
      "event": "labeled",
      "id": 4895260934,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDQ4OTUyNjA5MzQ=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4895260934",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-16T04:16:43Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4921501075,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDkyMTUwMTA3NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4921501075",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-22T09:25:00Z"
    },
    {
      "event": "commented",
      "id": 865809778,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg2NTgwOTc3OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/865809778",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-22T09:25:08Z",
      "updated_at": "2021-06-22T09:25:08Z",
      "author_association": "MEMBER",
      "body": "`00a8c943d7...072896b7cf`: rebase due to conflicts",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#issuecomment-865809778",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21943"
    },
    {
      "event": "unlabeled",
      "id": 4921703954,
      "node_id": "MDE0OlVubGFiZWxlZEV2ZW50NDkyMTcwMzk1NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4921703954",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-22T10:02:39Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 922506073,
      "node_id": "IC_kwDOABII5842_FNZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/922506073",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-19T17:08:55Z",
      "updated_at": "2021-09-19T17:08:55Z",
      "author_association": "MEMBER",
      "body": "Concept ACK, particularly if this can reduce `vNodes` lock contentions in these areas that are among the most frequent and long-lasting of those I'm seeing on my nodes with `-debug=lock`.\r\n\r\nIt looks like the CI stalled out on the last push. In any case, it rebases cleanly onto current master, the debug build is clean, and the unit/functional test suite is green for me locally. Reviewing.",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#issuecomment-922506073",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21943"
    },
    {
      "event": "reviewed",
      "id": 758400122,
      "node_id": "PRR_kwDOABII584tNER6",
      "url": null,
      "actor": null,
      "commit_id": "072896b7cf5e69c11a2e6d9e7163df4e0472f504",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Tested ACK 072896b7cf5e69c11a2e6d9e7163df4e0472f504 rebased to current master. Reviewed, debug built, and ran unit tests on each commit. Ran a node with this branch rebased to master on mainnet for a day (edit: 3 days) with -debug=lock and 30-40 peers and seeing an impressive reduction in the frequent vNodes lock contentions with `grep \"lock contention cs_vNodes\" ~/.bitcoin/debug.log` and very few contentions with `grep \"connman.cs_vNodes\" ~/.bitcoin/debug.log`\r\n\r\nNice work!\r\n",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#pullrequestreview-758400122",
      "submitted_at": "2021-09-20T10:14:28Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
    },
    {
      "event": "added_to_project",
      "id": 5350996295,
      "node_id": "ATPE_lADOABII5841G5QuzwAAAAE-8blH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5350996295",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-23T16:12:27Z",
      "project_card": {
        "id": 69392979,
        "url": "https://api.github.com/projects/columns/cards/69392979",
        "project_id": 481835,
        "project_url": "https://api.github.com/projects/481835",
        "column_name": "Blockers"
      }
    },
    {
      "event": "commented",
      "id": 927096514,
      "node_id": "IC_kwDOABII5843Ql7C",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/927096514",
      "actor": {
        "login": "rebroad",
        "id": 1530283,
        "node_id": "MDQ6VXNlcjE1MzAyODM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rebroad",
        "html_url": "https://github.com/rebroad",
        "followers_url": "https://api.github.com/users/rebroad/followers",
        "following_url": "https://api.github.com/users/rebroad/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rebroad/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rebroad/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
        "organizations_url": "https://api.github.com/users/rebroad/orgs",
        "repos_url": "https://api.github.com/users/rebroad/repos",
        "events_url": "https://api.github.com/users/rebroad/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rebroad/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-25T09:46:52Z",
      "updated_at": "2021-09-25T09:46:52Z",
      "author_association": "CONTRIBUTOR",
      "body": "concept ACK ",
      "user": {
        "login": "rebroad",
        "id": 1530283,
        "node_id": "MDQ6VXNlcjE1MzAyODM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rebroad",
        "html_url": "https://github.com/rebroad",
        "followers_url": "https://api.github.com/users/rebroad/followers",
        "following_url": "https://api.github.com/users/rebroad/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rebroad/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rebroad/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
        "organizations_url": "https://api.github.com/users/rebroad/orgs",
        "repos_url": "https://api.github.com/users/rebroad/repos",
        "events_url": "https://api.github.com/users/rebroad/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rebroad/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#issuecomment-927096514",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21943"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 5371725610,
      "node_id": "HRFPE_lADOABII5841G5QuzwAAAAFALgcq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5371725610",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-28T07:29:15Z"
    },
    {
      "event": "commented",
      "id": 928930542,
      "node_id": "IC_kwDOABII5843Xlru",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/928930542",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-28T07:29:44Z",
      "updated_at": "2021-09-28T07:34:54Z",
      "author_association": "MEMBER",
      "body": "`072896b7cf...a4fbf1ba59`: rebase and address review suggestions\r\n\r\nInvalidates ACK from @jonatack.",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#issuecomment-928930542",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21943"
    },
    {
      "event": "mentioned",
      "id": 5371757406,
      "node_id": "MEE_lADOABII5841G5QuzwAAAAFALoNe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5371757406",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-28T07:34:54Z"
    },
    {
      "event": "subscribed",
      "id": 5371757412,
      "node_id": "SE_lADOABII5841G5QuzwAAAAFALoNk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5371757412",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-28T07:34:54Z"
    },
    {
      "event": "commented",
      "id": 929004503,
      "node_id": "IC_kwDOABII5843X3vX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/929004503",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-28T09:10:42Z",
      "updated_at": "2021-09-28T09:10:42Z",
      "author_association": "MEMBER",
      "body": "Diff-review ACK a4fbf1ba594b03379a65e780892b70bb7d4c1e4e per `git range-diff a9d0cec 072896b a4fbf1b` following my earlier full review (https://github.com/bitcoin/bitcoin/pull/21943#pullrequestreview-758400122) ",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#issuecomment-929004503",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21943"
    },
    {
      "event": "reviewed",
      "id": 765262970,
      "node_id": "PRR_kwDOABII584tnPx6",
      "url": null,
      "actor": null,
      "commit_id": "a4fbf1ba594b03379a65e780892b70bb7d4c1e4e",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Code review ACK a4fbf1ba594b03379a65e780892b70bb7d4c1e4e.",
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#pullrequestreview-765262970",
      "submitted_at": "2021-09-28T10:34:38Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 5373805435,
      "node_id": "HRFPE_lADOABII5841G5QuzwAAAAFATcN7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5373805435",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-28T13:15:26Z"
    },
    {
      "event": "commented",
      "id": 929201658,
      "node_id": "IC_kwDOABII5843Yn36",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/929201658",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-28T13:18:12Z",
      "updated_at": "2021-09-28T13:18:12Z",
      "author_association": "MEMBER",
      "body": "`a4fbf1ba59...40e0bc8de2`: rebase and switch to `/*description=*/123` following https://github.com/bitcoin/bitcoin/pull/21943#discussion_r711994001.\r\n\r\nSorry for the noise, I hope no more changes to this PR.\r\n\r\nInvalidates ACKs from @jonatack, @promag.",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#issuecomment-929201658",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21943"
    },
    {
      "event": "mentioned",
      "id": 5373825343,
      "node_id": "MEE_lADOABII5841G5QuzwAAAAFAThE_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5373825343",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-28T13:18:13Z"
    },
    {
      "event": "subscribed",
      "id": 5373825349,
      "node_id": "SE_lADOABII5841G5QuzwAAAAFAThFF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5373825349",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-28T13:18:13Z"
    },
    {
      "event": "mentioned",
      "id": 5373825360,
      "node_id": "MEE_lADOABII5841G5QuzwAAAAFAThFQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5373825360",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-28T13:18:13Z"
    },
    {
      "event": "subscribed",
      "id": 5373825369,
      "node_id": "SE_lADOABII5841G5QuzwAAAAFAThFZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5373825369",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-28T13:18:13Z"
    },
    {
      "event": "commented",
      "id": 929213552,
      "node_id": "IC_kwDOABII5843Yqxw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/929213552",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-28T13:32:06Z",
      "updated_at": "2021-09-28T13:32:06Z",
      "author_association": "MEMBER",
      "body": "No need to invalidate ACKs. I was planning a scripted-diff some day to clean everything up, which would have covered this.",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#issuecomment-929213552",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21943"
    },
    {
      "event": "commented",
      "id": 929384060,
      "node_id": "IC_kwDOABII5843ZUZ8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/929384060",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-28T16:24:03Z",
      "updated_at": "2021-09-28T16:24:03Z",
      "author_association": "MEMBER",
      "body": "Diff-review re-ACK 40e0bc8de29eab1aec4464e93fb42eccb9a81f5d following my earlier full review (https://github.com/bitcoin/bitcoin/pull/21943#pullrequestreview-758400122) ",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#issuecomment-929384060",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21943"
    },
    {
      "event": "labeled",
      "id": 5407008784,
      "node_id": "LE_lADOABII5841G5QuzwAAAAFCSGgQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5407008784",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-10-04T22:25:55Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 5433452315,
      "node_id": "HRFPE_lADOABII5841G5QuzwAAAAFD2-cb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5433452315",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-10-08T09:13:12Z"
    },
    {
      "event": "commented",
      "id": 938488261,
      "node_id": "IC_kwDOABII58438DHF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/938488261",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-10-08T09:21:52Z",
      "updated_at": "2021-10-08T09:21:52Z",
      "author_association": "MEMBER",
      "body": "`40e0bc8de2...99c1af5a8f`: rebase due to conflicts\r\n\r\nInvalidates ACK from @jonatack \r\n\r\nPreviously invalidated ACK from @promag \r\n",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#issuecomment-938488261",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21943"
    },
    {
      "event": "mentioned",
      "id": 5433500437,
      "node_id": "MEE_lADOABII5841G5QuzwAAAAFD3KMV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5433500437",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-10-08T09:21:52Z"
    },
    {
      "event": "subscribed",
      "id": 5433500442,
      "node_id": "SE_lADOABII5841G5QuzwAAAAFD3KMa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5433500442",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-10-08T09:21:53Z"
    },
    {
      "event": "mentioned",
      "id": 5433500448,
      "node_id": "MEE_lADOABII5841G5QuzwAAAAFD3KMg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5433500448",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-10-08T09:21:53Z"
    },
    {
      "event": "subscribed",
      "id": 5433500450,
      "node_id": "SE_lADOABII5841G5QuzwAAAAFD3KMi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5433500450",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-10-08T09:21:53Z"
    },
    {
      "event": "unlabeled",
      "id": 5433828461,
      "node_id": "UNLE_lADOABII5841G5QuzwAAAAFD4aRt",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5433828461",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-10-08T10:24:56Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 774927928,
      "node_id": "PRR_kwDOABII584uMHY4",
      "url": null,
      "actor": null,
      "commit_id": "99c1af5a8f95051e98ad4b9486eef70919ab2708",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "re-ACK 99c1af5a8f95051e98ad4b9486eef70919ab2708 per `git range-diff 927586 40e0bc8 99c1af5` following my earlier full review https://github.com/bitcoin/bitcoin/pull/21943#pullrequestreview-758400122, only change is rebase\r\n",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#pullrequestreview-774927928",
      "submitted_at": "2021-10-08T12:04:30Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
    },
    {
      "event": "reviewed",
      "id": 775111135,
      "node_id": "PRR_kwDOABII584uM0Hf",
      "url": null,
      "actor": null,
      "commit_id": "99c1af5a8f95051e98ad4b9486eef70919ab2708",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Near ACK with one suggestion for clarifying the logic sequence.",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#pullrequestreview-775111135",
      "submitted_at": "2021-10-08T14:50:57Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
    },
    {
      "event": "reviewed",
      "id": 779123140,
      "node_id": "PRR_kwDOABII584ucHnE",
      "url": null,
      "actor": null,
      "commit_id": "99c1af5a8f95051e98ad4b9486eef70919ab2708",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Perhaps this is outside the scope of the PR, but I'd like:\r\n```diff\r\n     void Release()\r\n     {\r\n+        assert(nRefCount > 0);\r\n         nRefCount--;\r\n     }\r\n```",
      "user": {
        "login": "LarryRuane",
        "id": 8321330,
        "node_id": "MDQ6VXNlcjgzMjEzMzA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8321330?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/LarryRuane",
        "html_url": "https://github.com/LarryRuane",
        "followers_url": "https://api.github.com/users/LarryRuane/followers",
        "following_url": "https://api.github.com/users/LarryRuane/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/LarryRuane/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/LarryRuane/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/LarryRuane/subscriptions",
        "organizations_url": "https://api.github.com/users/LarryRuane/orgs",
        "repos_url": "https://api.github.com/users/LarryRuane/repos",
        "events_url": "https://api.github.com/users/LarryRuane/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/LarryRuane/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#pullrequestreview-779123140",
      "submitted_at": "2021-10-14T16:57:23Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 5518618850,
      "node_id": "HRFPE_lADOABII5841G5QuzwAAAAFI73Di",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5518618850",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-10-26T08:01:42Z"
    },
    {
      "event": "commented",
      "id": 951672368,
      "node_id": "IC_kwDOABII5844uV4w",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/951672368",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-10-26T08:10:39Z",
      "updated_at": "2021-10-26T08:34:26Z",
      "author_association": "MEMBER",
      "body": "`99c1af5a8f...8589c55e27`: rebase and reorganize `CConnMan::SocketHandler()`, following comments from above: [1](https://github.com/bitcoin/bitcoin/pull/21943#discussion_r632150326) and [2](https://github.com/bitcoin/bitcoin/pull/21943#discussion_r725079584).\r\n\r\nAccepting new connections does not require the snapshot of the existing connected nodes, so make this explicit by accepting new connections after the snapshot has been destroyed, at the end of `CConnMan::SocketHandler()`. Move the pieces of code from `CConnMan::SocketHandler()` that handle existing connections and accept new ones into their own methods and call those methods from `CConnMan::SocketHandler()` to improve the readability.\r\n\r\nInvalidates ACK from @jonatack\r\n\r\nPreviously invalidated ACK from @promag",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#issuecomment-951672368",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21943"
    },
    {
      "event": "mentioned",
      "id": 5518838791,
      "node_id": "MEE_lADOABII5841G5QuzwAAAAFI8swH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5518838791",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-10-26T08:34:26Z"
    },
    {
      "event": "subscribed",
      "id": 5518838799,
      "node_id": "SE_lADOABII5841G5QuzwAAAAFI8swP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5518838799",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-10-26T08:34:26Z"
    },
    {
      "event": "mentioned",
      "id": 5518838809,
      "node_id": "MEE_lADOABII5841G5QuzwAAAAFI8swZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5518838809",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-10-26T08:34:26Z"
    },
    {
      "event": "subscribed",
      "id": 5518838816,
      "node_id": "SE_lADOABII5841G5QuzwAAAAFI8swg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5518838816",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-10-26T08:34:26Z"
    },
    {
      "event": "reviewed",
      "id": 791851693,
      "node_id": "PRR_kwDOABII584vMrKt",
      "url": null,
      "actor": null,
      "commit_id": "3c8fcb94691584871edaa1a142bfa0ebadc01d67",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Code review ACK 8589c55e2777d9fac169cfa52586d67c2a4c42b2.",
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#pullrequestreview-791851693",
      "submitted_at": "2021-10-28T13:21:01Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 5608565881,
      "node_id": "HRFPE_lADOABII5841G5QuzwAAAAFOS-x5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5608565881",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-11-12T09:51:43Z"
    },
    {
      "event": "commented",
      "id": 966969216,
      "node_id": "IC_kwDOABII5845oseA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/966969216",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-11-12T09:54:17Z",
      "updated_at": "2021-11-12T09:54:17Z",
      "author_association": "MEMBER",
      "body": "`8589c55e27...db0a01e0d1`: remove unnecessary `interruptNet` check from `SocketEvents()`, add such a check to `SocketHandlerListening()`. Thanks, @promag, https://github.com/bitcoin/bitcoin/pull/21943#discussion_r738379450 !\r\n\r\nInvalidates ACK from @promag \r\n\r\nPreviously invalidated ACK from @jonatack ",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#issuecomment-966969216",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21943"
    },
    {
      "event": "mentioned",
      "id": 5608578845,
      "node_id": "MEE_lADOABII5841G5QuzwAAAAFOTB8d",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5608578845",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-11-12T09:54:19Z"
    },
    {
      "event": "subscribed",
      "id": 5608578851,
      "node_id": "SE_lADOABII5841G5QuzwAAAAFOTB8j",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5608578851",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-11-12T09:54:19Z"
    },
    {
      "event": "mentioned",
      "id": 5608578861,
      "node_id": "MEE_lADOABII5841G5QuzwAAAAFOTB8t",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5608578861",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-11-12T09:54:19Z"
    },
    {
      "event": "subscribed",
      "id": 5608578865,
      "node_id": "SE_lADOABII5841G5QuzwAAAAFOTB8x",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5608578865",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-11-12T09:54:19Z"
    },
    {
      "event": "reviewed",
      "id": 804610959,
      "node_id": "PRR_kwDOABII584v9WOP",
      "url": null,
      "actor": null,
      "commit_id": "db0a01e0d1ab4462b70a44c255c602ea074b96ef",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Code review ACK db0a01e0d1ab4462b70a44c255c602ea074b96ef, moved the early return to a loop where it makes more sense.",
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#pullrequestreview-804610959",
      "submitted_at": "2021-11-12T10:11:44Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
    },
    {
      "event": "reviewed",
      "id": 804875630,
      "node_id": "PRR_kwDOABII584v-W1u",
      "url": null,
      "actor": null,
      "commit_id": "db0a01e0d1ab4462b70a44c255c602ea074b96ef",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Following up on my feedback https://github.com/bitcoin/bitcoin/pull/21943#discussion_r712022174, as of db0a01e0d1a the commits are now out of order. The last commit\r\n\r\n    style: remove unnecessary braces\r\n\r\n    They were needed to define the scope of `LOCK(cs_vNodes)` which was\r\n    removed in the previous commit.\r\n\r\nshould be after the second commit `net: keep reference to each node during socket wait` (or squashed).\r\n\r\nAlmost-ACK  db0a01e0d1a with some suggestions below if you retouch.",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#pullrequestreview-804875630",
      "submitted_at": "2021-11-17T12:44:44Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDc1ZThiZjU1ZjVhMDE0ZmFhZGE3NzEyYTk2NDBkYzM1ZThjODZmMTU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/75e8bf55f5a014faada7712a9640dc35e8c86f15",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/75e8bf55f5a014faada7712a9640dc35e8c86f15",
      "tree": {
        "sha": "e008c898e12afe42bf673a15a48de49028c0803d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e008c898e12afe42bf673a15a48de49028c0803d"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree e008c898e12afe42bf673a15a48de49028c0803d\nparent b9cf505bdfade074f3d2b0473d56d2cbc2711cb3\nauthor Vasil Dimov <vd@FreeBSD.org> 1619446927 +0200\ncommitter Vasil Dimov <vd@FreeBSD.org> 1637238563 +0100\n\nnet: dedup and RAII-fy the creation of a copy of CConnman::vNodes\n\nThe following pattern was duplicated in CConnman:\n\n```cpp\nlock\ncreate a copy of vNodes, add a reference to each one\nunlock\n... use the copy ...\nlock\nrelease each node from the copy\nunlock\n```\n\nPut that code in a RAII helper that reduces it to:\n\n```cpp\ncreate snapshot \"snap\"\n... use the copy ...\n// release happens when \"snap\" goes out of scope\n```\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAmGWRyUACgkQVN8G9ktV\ny78KlCAAmWhmPFmVqmMsdcECSjKx0WcIrZa/+kSu5El9YxOmWD5sUBl+FQCrpfSM\nX/mufOehYFQFUcB/nUPSgaLFaFlnz8toX0EDTuiKq/IOnr4jCrTPKgqukQj+gfQg\nS2cvrTTwDokLWEQY83BBIubbcO7OVmySE4VjLIGG67euVsOvgewG+x4235+et10y\nf6oIqMLxUAuIX105P0Vuru1PaLOK41lyJ/h9i8mwNwsSW5lVNuEwWUVkwoA2sDW4\noUkxVNkd6p3t0YMo4XcieGeU6LPid/ZgVfmxp/77w3AOVBD4HPNKMGQEMghfBIeF\nHohmQtBki1bUJVHr9Sg1Ops9HM/4RtPEChkwR+R4Z1wp62nJr1wjGq73cWmlUYjv\nOvMHiJZuK4ma5IxbIYgkFUgPO2KHXn5j1P2vwByKsFC6s8hTzJwUY1soFkh7WHoF\noYeK1HM45XWth3vePCkaZ5sIyDOX8iBWYGtbqCJO1vH+rEKL0Dg16paL91u13hcJ\nOQnBdcoyuHrimuiMET1G1B38TCVbehE8ClQITzYaWe2L1xs20mh/t41e1VzqzjX3\nYDLwu4G9aflnVgM5angtPydNC3wqSsyuNyXW7utONTkT+tAEwnQAVOI81mRUrCzQ\n8aSwj4/u7cwi60LTe48OC9rjCHJs4HGbumEKCGKrwz2rqN5/sXa7o3nATSA3/EEN\n6XNnclvISQ+/E1mPUrOc1Vg22N/OD6a72CC6CQjm9tadKFbHmbzzrI1krhb6B92M\nnOSeh41ABidcPqB8EyvrsjQyVKUmxn0LQ2fcPqVxLWjXnaDvrcjd//qSDpE9G0h8\nVILP8o17ldvxCvjY3l7H6FANoga8kzzvjO1tFze7GGn3vI43eBP983VzYSrcotEA\n+7Sv8bB5H1UcfEqZ1TsmpaOq69+R+jeIzU5fkClvHKMQ/8lawZ5vS05obMLGjtZf\nNDq2FWX72qHYyGixkk7E8p8XNEOHrySqGjlgEBEu0cIQGV0Z3bctsRaJjv1GNMmZ\nSH6At0RS8tlstB3VvXwPoe4VsRIIXCg30rkldYL6QywM6rO0g07Al7E4oMtEuRf6\nzXaf662ovq+GjTx9dQJDAqdtVRBCJCp21B1ILfROK4PZKsUTxbEignDDK0G93Gkz\nPZH3JBQAnR95TPP0KfQNfWWM+O3/MsIwfVoJNkxH7r3uqu8RmQsSKGld5+b0hKEQ\nI6hxWV/UP8xPS8SHnwOvJU4+P2+jl7VlWaTBAhpNt0CrYD7emjXisYu0IytKf8Hv\nLmy2QbX+HhLcwoi2QcASZheJa4yzHY2E+tlEH+6hwjR4Zn3WpXuF4iVtDPkVCTlc\ndRyVEl+Rhe8MLCRL8j7sK2jgm4L6vQ==\n=GKjT\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b9cf505bdfade074f3d2b0473d56d2cbc2711cb3",
          "sha": "b9cf505bdfade074f3d2b0473d56d2cbc2711cb3",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b9cf505bdfade074f3d2b0473d56d2cbc2711cb3"
        }
      ],
      "message": "net: dedup and RAII-fy the creation of a copy of CConnman::vNodes\n\nThe following pattern was duplicated in CConnman:\n\n```cpp\nlock\ncreate a copy of vNodes, add a reference to each one\nunlock\n... use the copy ...\nlock\nrelease each node from the copy\nunlock\n```\n\nPut that code in a RAII helper that reduces it to:\n\n```cpp\ncreate snapshot \"snap\"\n... use the copy ...\n// release happens when \"snap\" goes out of scope\n```",
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2021-11-18T12:29:23Z"
      },
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2021-04-26T14:22:07Z"
      },
      "sha": "75e8bf55f5a014faada7712a9640dc35e8c86f15"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDY2NGFjMjJjNTM3OWRiNjU3NTdmYzNhYWI5MWZmZjg3NjU2ODNlN2Y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/664ac22c5379db65757fc3aab91fff8765683e7f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/664ac22c5379db65757fc3aab91fff8765683e7f",
      "tree": {
        "sha": "3198887177c5920ef47f4d9c3d1effc00af6da31",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3198887177c5920ef47f4d9c3d1effc00af6da31"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 3198887177c5920ef47f4d9c3d1effc00af6da31\nparent 75e8bf55f5a014faada7712a9640dc35e8c86f15\nauthor Vasil Dimov <vd@FreeBSD.org> 1619627372 +0200\ncommitter Vasil Dimov <vd@FreeBSD.org> 1637239122 +0100\n\nnet: keep reference to each node during socket wait\n\nCreate the snapshot of `CConnman::vNodes` to operate on earlier in\n`CConnman::SocketHandler()`, before calling `CConnman::SocketEvents()`\nand pass the `vNodes` copy from the snapshot to `SocketEvents()`.\n\nThis will keep the refcount of each node incremented during\n`SocketEvents()` so that the `CNode` object is not destroyed before\n`SocketEvents()` has finished.\n\nCurrently in `SocketEvents()` we only remember file descriptor numbers\n(when not holding `CConnman::cs_vNodes`) which is safe, but we will\nchange this to remember pointers to `CNode::m_sock`.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAmGWSVQACgkQVN8G9ktV\ny7+wWB/8CH7DtaS669Mm4QKqKCYkakmVpo0tRzF9Tt0IG4xksLNPcI8LZNJ++Zlk\njklOpGP9JoaDm07KXqyxDZs84yda8Ra/RBXZ7k88z2pjfoDNZOirIH3xzuyFtxVC\n/adW7Gqt76wcIAjTkqHoUcuuRocH+zrPo9A0OuHYCwzoUHLDlXCV5w1njGJQ0gPp\n81vGO51iWQQdQT+IkQ22/1HJ5Q6WSvzaXtz9wa70Lv4Dhj9sHW5B5luSLFeKZpIE\nAMZiXBNUCCUH6t1XWbRFs3iYLh0lvF02oRVKFbSPMqMYTTAeH4MZ/DLS6VJkcmQP\n7T5uzuPnY7u2g+NqEndKmc0HFWyKM5adhy9gWdRZN+xi3GcFnVKtlUEOgK85Wkfn\n0LiMGlSOJ8B2SLgXlvsVbm6/+Rwn1u8VaJOMBOFulh2+8LdDCww6aFQV16HX4FgG\nZWhlODzqClWFWH0fdhByldYUW//aJeEydgfbi/s7mBNQ8tQKJrbC0NmVEzzQD/UF\nARZgqKj3TkkIGb+uxiE7z0XT5hcs50vK44N2XRjh0cDgW0FC7BGAMsUKJ34cfqoB\nPsF/roHAziB9fU1K6ck3SuCVYo4moz2cUYrWttJP6b/v/GjtV7gAaxhUBX16m64E\nyTEHS7UCFag5GbSC5DfZkrLDrs1pMHjUrH70Fv9rSivv7TEzqItkJO/cY8HsbAY2\nzCZ/TPQoyZd/xPo6t8gZIJ26r4Z+TVOdzuGBbsh7BStswEBrnDLMXYkP2ziJ0alH\n2mC2YWPb6Q2fdvh4kzbdxsZc24m//ZY0TPyviOX+kpHQgkRKmalD5WgCY6MP0fAU\nTPD1DOIIK1hJxGLGga4R705Nwv7k/4ilI3HVtTnHdPpbvOfpKM6CGnRRNyLI56X0\nuh5d1xGkqefJE0wJ56OYZAz8mhrvN+/dgJZhtjjj5UUT+4Sm4ta/dNbxvlW+lhyx\nozpPGvh7FBgXA6y5gsFl+/LQrczwUtXeln9O5BonIfMg+QyXouNl8EnEHvtnfIUU\n/Q4qkGmXWr5ipkVOraewZRD9fXOAGWd2JcScNp57Z/npfl07HdF9VqhL8SQFNCQ0\nMKP1z//OKgd5Jp4/WEo9F7A/CkKRzdSVzf7pWkTmZLZMEYJ+M5Z/+zq4huDCbnTB\nOdqJVL0uHQsyoKfLqTVLJ8mLs5yY0BQHdKcoQ2vGAr0JEnhcU+7jnBoiOJddngsw\niNf8Yj3XW1nxKUtedzIUjjO4lEin/Deqe+QRrYvZ91ntJccT2UU0mJUakYedzZq9\nM9SfO6P7fKFvEkLM2LWUE4ZdhTGW5VV2XTNnZzIFkix4ZqPgktPTtt2HZ72ajI3S\nvTzqvfDeCqFAEcxV8Ezl8T18AFFUDg==\n=wcki\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/75e8bf55f5a014faada7712a9640dc35e8c86f15",
          "sha": "75e8bf55f5a014faada7712a9640dc35e8c86f15",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/75e8bf55f5a014faada7712a9640dc35e8c86f15"
        }
      ],
      "message": "net: keep reference to each node during socket wait\n\nCreate the snapshot of `CConnman::vNodes` to operate on earlier in\n`CConnman::SocketHandler()`, before calling `CConnman::SocketEvents()`\nand pass the `vNodes` copy from the snapshot to `SocketEvents()`.\n\nThis will keep the refcount of each node incremented during\n`SocketEvents()` so that the `CNode` object is not destroyed before\n`SocketEvents()` has finished.\n\nCurrently in `SocketEvents()` we only remember file descriptor numbers\n(when not holding `CConnman::cs_vNodes`) which is safe, but we will\nchange this to remember pointers to `CNode::m_sock`.",
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2021-11-18T12:38:42Z"
      },
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2021-04-28T16:29:32Z"
      },
      "sha": "664ac22c5379db65757fc3aab91fff8765683e7f"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGM3ZWIxOWVjODMwMmU2YTVhYmQ4OWMwNTY2NTQwYzJjODYyZTkxMjE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c7eb19ec8302e6a5abd89c0566540c2c862e9121",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/c7eb19ec8302e6a5abd89c0566540c2c862e9121",
      "tree": {
        "sha": "de33d628e8a36e11ef302e2fc71a9bd9963167a4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/de33d628e8a36e11ef302e2fc71a9bd9963167a4"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree de33d628e8a36e11ef302e2fc71a9bd9963167a4\nparent 664ac22c5379db65757fc3aab91fff8765683e7f\nauthor Vasil Dimov <vd@FreeBSD.org> 1635162573 +0200\ncommitter Vasil Dimov <vd@FreeBSD.org> 1637239149 +0100\n\nstyle: remove unnecessary braces\n\nThey were needed to define the scope of `LOCK(cs_vNodes)` which was\nremoved in the previous commit. Re-indent in a separate commit to ease\nreview (use `--ignore-space-change`).\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAmGWSW0ACgkQVN8G9ktV\ny7+V4R/+Mf0Tfp2oKfE7u9J11hBMTiCwjNXwn7KqbBNXEIrOhlw6BRyKINESgge9\nLXQ/oHKK3w3CujJESlhKGroOQldsmY/emImuuLC5nfW+D66jvc20two8jS7tR8Sk\nZeSLaCvm4tKWVstRoG5y8+iSmllCRYzpH0kZXgnJ+qaYxEtmDMt1QD6B11ppse5I\nw96mfjHeRAAgvLT3VcKuIO1UhaufZzmT3jzpMeglX9XfK2aDElygdoGSUVWOKshY\ncTSLrPzBx2q/vGNSBRm+bjf2dS83WEXoq+yTrWE/+t6xWOzxWQ/KjOUjUV5Qb9CG\nbvu3hRn/P1HHmiEvxyU/Lk5lN2lPEDF62YgxNLp52zqt1q65yKTH7I5w/1bHAEEn\n4kY0L1/wr435ZHYfSDL2Qr3QWsQWWyve388prhm/Pl8IXM5Pmc3O4aCHp1DhywV7\nkp2dFGUJsNzQ4b+Cy9ctH51gfpOE5VuRz1RMuRWnMSYsxQJ9uTt8PQLonTgM3Tnn\ntnNc96xGAiafEUhSUCk5YMkfCCQWeomNuu8WX6kdoqjDMHtwdAkqklOdtikeBO/K\ngITorXmSYxnnS3Qn+VJSx31p6nWS2zvZ5VG5I3yXlTFwfkxwEqtedD0+h5OoZ/WJ\naB/bS+OkYJpAjVWY0eZFEuMt9WLyrKcyFq7h6uGLjNxSAdVMWFqjnLvmIjkDcnGL\nMUX4AZ8mnwGRHLNHkx3ixsQq+OpThNwK1NXyAwuvTh5PAqNpf1ZUTMCdh5V8GZGA\n0jKMrtuIJMk1vyBtJmJT6tInsPz+JnMMue7lbxf1+fOV28dSRdBa7sWvl5LXRy/y\no4U6yvfd7ZNXy7/fFi1birGN+/alnyL4M/o/q5tW9Q1O+EM1EtrUQZt2NFWd/KM8\nY0ArWrg1T9ryv6kgIYB7rIcJcdu7VBb1562e7DERO488Sxm1b185JwcL1mnRTVaK\nYbkGZ5RPXa9pd7JfmPIyAYbm+sC4UuzA5pwbr+yq1EZvQN3HsS9u1lUW5ElTb9X6\n/4bzOPsYmQ/o7LUdmIeAoDPmY5t7E5nm7dO4HSLeZ/kQFVdRKvnm6++K4OYHvbpS\n2yBC7kP0ysleib2/X1VINbTbLrnT8O1yrjTaQb3yU+VvQCo0In6mIxKgIbg6hch3\nm5GMAYbAFxE2Z3LPF7fFlhmBAWrZ2z0uKDF29l900bjowl2xXaiyVYlEu3a9QMj9\nkdcw1GWpYSx0OrMU8mF3b2MyiQCytxDqwvg0USgrYnU9yYFWUTWzEIY0hUSp7QqM\nCmsITvXHC+VlAkI7VPVVHjgJsMP/UMfv20fWOYHUMbjjAE3jxLKypNaL4uAEAXIq\nuLMZgFHxYICkPasU4W3MzcsDFV1O8Q==\n=nPBo\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/664ac22c5379db65757fc3aab91fff8765683e7f",
          "sha": "664ac22c5379db65757fc3aab91fff8765683e7f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/664ac22c5379db65757fc3aab91fff8765683e7f"
        }
      ],
      "message": "style: remove unnecessary braces\n\nThey were needed to define the scope of `LOCK(cs_vNodes)` which was\nremoved in the previous commit. Re-indent in a separate commit to ease\nreview (use `--ignore-space-change`).",
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2021-11-18T12:39:09Z"
      },
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2021-10-25T11:49:33Z"
      },
      "sha": "c7eb19ec8302e6a5abd89c0566540c2c862e9121"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGY1MmI2YjJkOWY0ODIzNTM4MjFkYTBlZjRjNDg1YzQwMmEzOTZjOGQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "tree": {
        "sha": "71100049a61ca06f6eebb7570d2ef765ac1f4f01",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/71100049a61ca06f6eebb7570d2ef765ac1f4f01"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 71100049a61ca06f6eebb7570d2ef765ac1f4f01\nparent c7eb19ec8302e6a5abd89c0566540c2c862e9121\nauthor Vasil Dimov <vd@FreeBSD.org> 1635152638 +0200\ncommitter Vasil Dimov <vd@FreeBSD.org> 1637239150 +0100\n\nnet: split CConnman::SocketHandler()\n\n`CConnman::SocketHandler()` does 3 things:\n1. Check sockets for readiness\n2. Process ready listening sockets\n3. Process ready connected sockets\n\nSplit the processing (2. and 3.) into separate methods to make the code\neasier to grasp.\n\nAlso, move the processing of listening sockets after the processing of\nconnected sockets to make it obvious that there is no dependency and\nalso explicitly release the snapshot before dealing with listening\nsockets - it is only necessary for the connected sockets part.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAmGWSW4ACgkQVN8G9ktV\ny79FUR/+Mmaz1txYV5wgGc+BiuIYyLQoLpk52rkduCjGYoAZW2LLXssYKZV+LPrI\nawmCIJmPCQCc1NWKL1MS/B89RO1VkeXt+Cg0zMM+f2jHpCBYfUIyDV2Of84WbN9T\n57BffayIABsq9p1JqI2QKP4L9v/ftZHxVcwFsUrWJlt2npNgD/ik0sleV+9Y5dBj\ndOgywZnVQJNnPwdNNowGCXXE2rsHc/dlUeAT/U8OCCx9i9HORxMgL9eV7jqHxyZs\npvRqUz3dgTUr1F0ROMOi8tw1rcyWbkbNb/yFsLiAmDQ8rGw4zDH9X1GIa5Xlm1Ox\nHfoiS12jK0oSPCsZIHiVIUUCelQ4No8gsw/FPAaL4bQBmHvYKOfx3dxZ63CJqnoE\nN3t1rXpCV/PxMZF2crrxTgDChJX6zUsDKjg9Qdw+HEob3RpwOTM58ShxwLfHn31T\nvWa+BVsE68UvGrOVB+Sh3eeYb663gudsydTgE17wokdmdJxymDsVuestrDGbLMSM\nAZKPh+B3CkpBtEleH8+fSqCx1D3xBTEyFOEiOtl0a/NBQ77gvUHcOr7SpIUQLGap\nXy7kw1hHFo2xqRLWIbCD1QbBq57uIDDv1tqjuM5/7zxfgNWZzuRwenNDJthLduTU\nlc5V2MWzxm6SZ09IBZ5l96nPQqpLIuAAGC8EAf5xY86zpAlSYODHaXyuKljVvY+q\nNa88o2TyocsEXn9Q9rKocjTitJnEwlO5OY+qFJVY/7OnzYSjG2K9154LWcUY9oMf\naVI4gPAPCShSOx6VjrLAv3to4/5JAzhBTKvW2cyJV6m0ejBa2J10rt8wHJT4uh2K\nvBys4ZlQGf75L8AakYmOgTGFBIUanTg0/vYsjkQ2dfIjJdeDrU6r+4cYnEaqziM9\nFImidpx6WI/yGvvhHPSLxLmNLJroOH7qfHdOo+YfAj8CawmEf2QZ1LYRFk54bBEm\nozgAYb551xnsF5INEiZtwVVR6e3HcgN7Mu5NO9mWUxAQPdKd70A7ZbnP7yr71/zZ\nZsfH9HCuCAkVa41hOCcxqVg9O/w4r4TTluth1TK5WQGNH2cOblZ3e7PU+oAH1RTx\nqu+mhfPt3ZtqwUqAPUdX4Ba6cZ6+g+mJ6UkJ7FQwn7XY7hiIMZslkhxOvxk+hle4\nKPyxuj74EbnghFO1Y4mh6CZs8JC+UPUe150TevYVTlbazzCE9Ul6QC6YHstwcEgM\n0khyC4pna2gc3oYO7Pis2Ma+maX+RHFnMSjC//Boyx9SbMtPHADfPMQSMLw4ztr6\nFQR2xU91joiS1MGWA06N1nD1b+xHUcalZKdIR8c4ZabH++UrD5A3Pttqd9WAHThb\n5h9YvM4uqehvi1pAX8SQgzv4xnQ/nw==\n=HOOy\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c7eb19ec8302e6a5abd89c0566540c2c862e9121",
          "sha": "c7eb19ec8302e6a5abd89c0566540c2c862e9121",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/c7eb19ec8302e6a5abd89c0566540c2c862e9121"
        }
      ],
      "message": "net: split CConnman::SocketHandler()\n\n`CConnman::SocketHandler()` does 3 things:\n1. Check sockets for readiness\n2. Process ready listening sockets\n3. Process ready connected sockets\n\nSplit the processing (2. and 3.) into separate methods to make the code\neasier to grasp.\n\nAlso, move the processing of listening sockets after the processing of\nconnected sockets to make it obvious that there is no dependency and\nalso explicitly release the snapshot before dealing with listening\nsockets - it is only necessary for the connected sockets part.",
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2021-11-18T12:39:10Z"
      },
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2021-10-25T09:03:58Z"
      },
      "sha": "f52b6b2d9f482353821da0ef4c485c402a396c8d"
    },
    {
      "event": "commented",
      "id": 972830829,
      "node_id": "IC_kwDOABII5845_Dht",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/972830829",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-11-18T12:41:45Z",
      "updated_at": "2021-11-18T12:51:11Z",
      "author_association": "MEMBER",
      "body": "`db0a01e0d1...f52b6b2d9f`: pick nits\r\n\r\nInvalidates ACK from @promag\r\n\r\nPreviously invalidated ACK from @jonatack",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#issuecomment-972830829",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21943"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 5638510538,
      "node_id": "HRFPE_lADOABII5841G5QuzwAAAAFQFNfK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5638510538",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-11-18T12:42:34Z"
    },
    {
      "event": "mentioned",
      "id": 5638555819,
      "node_id": "MEE_lADOABII5841G5QuzwAAAAFQFYir",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5638555819",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-11-18T12:51:12Z"
    },
    {
      "event": "subscribed",
      "id": 5638555828,
      "node_id": "SE_lADOABII5841G5QuzwAAAAFQFYi0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5638555828",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-11-18T12:51:12Z"
    },
    {
      "event": "mentioned",
      "id": 5638555836,
      "node_id": "MEE_lADOABII5841G5QuzwAAAAFQFYi8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5638555836",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-11-18T12:51:12Z"
    },
    {
      "event": "subscribed",
      "id": 5638555842,
      "node_id": "SE_lADOABII5841G5QuzwAAAAFQFYjC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5638555842",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-11-18T12:51:12Z"
    },
    {
      "event": "reviewed",
      "id": 811664007,
      "node_id": "PRR_kwDOABII584wYQKH",
      "url": null,
      "actor": null,
      "commit_id": "75e8bf55f5a014faada7712a9640dc35e8c86f15",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "code review ACK f52b6b2d9f482353821da0ef4c485c402a396c8d\r\ncomments are optional",
      "user": {
        "login": "LarryRuane",
        "id": 8321330,
        "node_id": "MDQ6VXNlcjgzMjEzMzA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8321330?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/LarryRuane",
        "html_url": "https://github.com/LarryRuane",
        "followers_url": "https://api.github.com/users/LarryRuane/followers",
        "following_url": "https://api.github.com/users/LarryRuane/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/LarryRuane/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/LarryRuane/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/LarryRuane/subscriptions",
        "organizations_url": "https://api.github.com/users/LarryRuane/orgs",
        "repos_url": "https://api.github.com/users/LarryRuane/repos",
        "events_url": "https://api.github.com/users/LarryRuane/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/LarryRuane/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#pullrequestreview-811664007",
      "submitted_at": "2021-11-19T21:26:40Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
    },
    {
      "event": "reviewed",
      "id": 814022186,
      "node_id": "PRR_kwDOABII584whP4q",
      "url": null,
      "actor": null,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Code review ACK f52b6b2d9f482353821da0ef4c485c402a396c8d, only format changes and comment tweaks since last review.",
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#pullrequestreview-814022186",
      "submitted_at": "2021-11-23T18:10:00Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
    },
    {
      "event": "commented",
      "id": 977201905,
      "node_id": "IC_kwDOABII5846Purx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/977201905",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-11-23T21:55:24Z",
      "updated_at": "2021-11-23T21:56:19Z",
      "author_association": "MEMBER",
      "body": "ACK  f52b6b2d9f482353821da0ef4c485c402a396c8d changes since last review are reordered commits, removing an unneeded local variable, and code formatting and documentation improvements ",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#issuecomment-977201905",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21943"
    },
    {
      "event": "referenced",
      "id": 5668215795,
      "node_id": "REFE_lADOABII5841G5QuzwAAAAFR2hvz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5668215795",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "64059b78f59e45cc4200ca76d0af8c6dff8a20d4",
      "commit_url": "https://api.github.com/repos/bitcoin-core/gui/commits/64059b78f59e45cc4200ca76d0af8c6dff8a20d4",
      "created_at": "2021-11-24T16:45:00Z"
    },
    {
      "event": "removed_from_project",
      "id": 5668219369,
      "node_id": "RFPE_lADOABII5841G5QuzwAAAAFR2inp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5668219369",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-11-24T16:45:34Z",
      "project_card": {
        "id": 69392979,
        "url": "https://api.github.com/projects/columns/cards/69392979",
        "project_id": 481835,
        "project_url": "https://api.github.com/projects/481835",
        "column_name": "Blockers"
      }
    },
    {
      "event": "commented",
      "id": 978053383,
      "node_id": "IC_kwDOABII5846S-kH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/978053383",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-11-24T16:50:17Z",
      "updated_at": "2021-11-24T16:50:17Z",
      "author_association": "MEMBER",
      "body": "Looks like github didn't detect the merge, closing.",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#issuecomment-978053383",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21943"
    },
    {
      "event": "closed",
      "id": 5668249113,
      "node_id": "CE_lADOABII5841G5QuzwAAAAFR2p4Z",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5668249113",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-11-24T16:50:17Z"
    },
    {
      "event": "head_ref_deleted",
      "id": 5671369068,
      "node_id": "HRDE_lADOABII5841G5QuzwAAAAFSCjls",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5671369068",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-11-25T08:35:31Z"
    },
    {
      "event": "referenced",
      "id": 5674148239,
      "node_id": "REFE_lADOABII5841G5QuzwAAAAFSNKGP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5674148239",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "3f723e2c80b058f4a4e92190726a20e183e42895",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/3f723e2c80b058f4a4e92190726a20e183e42895",
      "created_at": "2021-11-25T17:08:40Z"
    },
    {
      "event": "locked",
      "id": 7896024669,
      "node_id": "LOE_lADOABII5841G5QuzwAAAAHWo8Zd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7896024669",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-26T09:59:46Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632150326",
      "pull_request_review_id": 659359605,
      "id": 632150326,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjE1MDMyNg==",
      "diff_hunk": "@@ -1467,8 +1467,6 @@ void CConnman::SocketHandler()\n         }\n     }\n \n-    NodesSnapshot snap{*this};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 61,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "157674ef213e6329215d1b7eb85dacbc23c468db",
      "in_reply_to_id": null,
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "157674ef213e6329215d1b7eb85dacbc23c468db\r\n\r\nThis snap catches nodes added in the above `AcceptConnection` where the new snap at the beginning doesn't. Is this intentional?",
      "created_at": "2021-05-13T22:50:29Z",
      "updated_at": "2021-05-13T22:50:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r632150326",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632150326"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1470,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632355737",
      "pull_request_review_id": 659612587,
      "id": 632355737,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjM1NTczNw==",
      "diff_hunk": "@@ -1467,8 +1467,6 @@ void CConnman::SocketHandler()\n         }\n     }\n \n-    NodesSnapshot snap{*this};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 61,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "157674ef213e6329215d1b7eb85dacbc23c468db",
      "in_reply_to_id": 632150326,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Hmm, good catch! No, that is not intentional.\r\n\r\nSo, the previous code did:\r\n\r\n1. `SocketEvents()`, adding ready sockets from `vNodes` to `{recv,send,error}_set`.\r\n2. `AcceptConnection()`, adding new entries to `vNodes`.\r\n3. Loop over `vNodes`, for each node:\r\n3.1. Check whether its socket is in one of `{recv,send,error}_set`. Observation - the sockets of nodes that were added in 2. will not be in any of `{recv,send,error}_set`, so for them all of `recvSet`, `sendSet` and `errorSet` will be `false`.\r\n3.2. `InactivityCheck()` - will also be done for nodes added in 2.\r\n\r\nThe new code will skip nodes added in 2. in the 3. loop. That's the same as the old code with respect to 3.1. The only difference is that the new code will not do `InactivityCheck()` for newly accepted nodes. I think that is ok because it is unlikely that a newly accepted peer would be considered inactive. In the rare case where this might have happened in the old code and will not happen in the new code, the new code will do the check on the next call to `SocketHandler()`.\r\n\r\nWhat do you think? Leave it as is or somehow ensure that new and old behave in an identical way?",
      "created_at": "2021-05-14T08:01:48Z",
      "updated_at": "2021-05-14T08:01:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r632355737",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632355737"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1470,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632360108",
      "pull_request_review_id": 659617416,
      "id": 632360108,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjM2MDEwOA==",
      "diff_hunk": "@@ -1467,8 +1467,6 @@ void CConnman::SocketHandler()\n         }\n     }\n \n-    NodesSnapshot snap{*this};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 61,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "157674ef213e6329215d1b7eb85dacbc23c468db",
      "in_reply_to_id": 632150326,
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "if `InactivityCheck` for new nodes is pointless then maybe move `// Accept new connections` to the end?",
      "created_at": "2021-05-14T08:08:49Z",
      "updated_at": "2021-05-14T08:08:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r632360108",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632360108"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1470,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632451114",
      "pull_request_review_id": 659736046,
      "id": 632451114,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjQ1MTExNA==",
      "diff_hunk": "@@ -1467,8 +1467,6 @@ void CConnman::SocketHandler()\n         }\n     }\n \n-    NodesSnapshot snap{*this};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 61,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "157674ef213e6329215d1b7eb85dacbc23c468db",
      "in_reply_to_id": 632150326,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Added an explicit commit (a71b3f426) to show the intention. Putting the accept at the end somehow looked strange to me.\r\n\r\nMaybe these two actions deserve to be split in separate functions (ie split `SocketHandler()`): 1. checking which of the listening sockets are ready for IO and accepting connections on them and 2. checking which of the already connected sockets are ready for IO and processing them. Would require even more changes.",
      "created_at": "2021-05-14T10:58:33Z",
      "updated_at": "2021-05-14T10:58:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r632451114",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632451114"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1470,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632622357",
      "pull_request_review_id": 659968284,
      "id": 632622357,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjYyMjM1Nw==",
      "diff_hunk": "@@ -1467,8 +1467,6 @@ void CConnman::SocketHandler()\n         }\n     }\n \n-    NodesSnapshot snap{*this};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 61,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "157674ef213e6329215d1b7eb85dacbc23c468db",
      "in_reply_to_id": 632150326,
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Since you are not splitting maybe add a comment for now like `// Take a snapshot of current nodes before acceptation new ones - new nodes are irrelevant below` or something like that.",
      "created_at": "2021-05-14T15:45:27Z",
      "updated_at": "2021-05-14T15:45:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r632622357",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632622357"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1470,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632651133",
      "pull_request_review_id": 660007293,
      "id": 632651133,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjY1MTEzMw==",
      "diff_hunk": "@@ -1451,8 +1447,10 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n+    NodesSnapshot snap{*this};\n+\n     std::set<SOCKET> recv_set, send_set, error_set;\n-    SocketEvents(recv_set, send_set, error_set);\n+    SocketEvents(snap.Nodes(), recv_set, send_set, error_set);",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 109,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Could we move this call to `SocketEvents()` to below the _Accept new connections_ logic? I think it's simpler to reason about if we're not holding the nodes snapshot across the _Accept new connections_ logic.",
      "created_at": "2021-05-14T16:30:39Z",
      "updated_at": "2021-05-14T16:30:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r632651133",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632651133"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1500,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632966401",
      "pull_request_review_id": 660365073,
      "id": 632966401,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjk2NjQwMQ==",
      "diff_hunk": "@@ -1451,8 +1447,10 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n+    NodesSnapshot snap{*this};\n+\n     std::set<SOCKET> recv_set, send_set, error_set;\n-    SocketEvents(recv_set, send_set, error_set);\n+    SocketEvents(snap.Nodes(), recv_set, send_set, error_set);",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 109,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "in_reply_to_id": 632651133,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Sorry, ignore this. I've just realized that the _Accept new connections_ logic is using the `recv_set` that's populated by `SocketEvents()`.",
      "created_at": "2021-05-15T14:58:09Z",
      "updated_at": "2021-05-15T14:58:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r632966401",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632966401"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1500,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632972362",
      "pull_request_review_id": 660366732,
      "id": 632972362,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjk3MjM2Mg==",
      "diff_hunk": "@@ -1257,6 +1276,40 @@ class CConnman\n      */\n     std::vector<CService> m_onion_binds;\n \n+    /**\n+     * RAII helper to atomically create a copy of `vNodes` and add a reference\n+     * to each of the nodes. The nodes are released when this object is destroyed.\n+     */\n+    class NodesSnapshot",
      "path": "src/net.h",
      "position": 68,
      "original_position": 38,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "in_reply_to_id": null,
      "user": {
        "login": "amitiuttarwar",
        "id": 1500952,
        "node_id": "MDQ6VXNlcjE1MDA5NTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/amitiuttarwar",
        "html_url": "https://github.com/amitiuttarwar",
        "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
        "following_url": "https://api.github.com/users/amitiuttarwar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/amitiuttarwar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/amitiuttarwar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
        "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
        "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
        "events_url": "https://api.github.com/users/amitiuttarwar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I'm guessing you've defined this class within `CConnman` to enable access to the private members. You could instead define the class in `net.cpp` as a standalone by making `vNodes` and `cs_vNodes` protected & declaring `friend class NodesSnapshot` here. Seems nice to keep this mechanism that's only used internally out of the header file.\r\n\r\ndiff 👇🏽\r\n(also includes constifying `m_nodes_copy`)\r\n```diff \r\ndiff --git a/src/net.cpp b/src/net.cpp\r\nindex 5fd1bf754d..6040ee86be 100644\r\n--- a/src/net.cpp\r\n+++ b/src/net.cpp\r\n@@ -110,6 +110,39 @@ std::map<CNetAddr, LocalServiceInfo> mapLocalHost GUARDED_BY(cs_mapLocalHost);\r\n static bool vfLimited[NET_MAX] GUARDED_BY(cs_mapLocalHost) = {};\r\n std::string strSubVersion;\r\n\r\n+/**\r\n+ * RAII helper to atomically create a copy of `vNodes` and add a reference\r\n+ * to each of the nodes. The nodes are released when this object is destroyed.\r\n+ */\r\n+class NodesSnapshot\r\n+{\r\n+    public:\r\n+        explicit NodesSnapshot(const CConnman& connman) : m_connman{connman}, m_nodes_copy{m_connman.vNodes}\r\n+        {\r\n+            LOCK(m_connman.cs_vNodes);\r\n+            for (auto& node : m_nodes_copy) {\r\n+                node->AddRef();\r\n+            }\r\n+        }\r\n+\r\n+        ~NodesSnapshot()\r\n+        {\r\n+            LOCK(m_connman.cs_vNodes);\r\n+            for (auto& node : m_nodes_copy) {\r\n+                node->Release();\r\n+            }\r\n+        }\r\n+\r\n+        const std::vector<CNode*>& Nodes() const\r\n+        {\r\n+            return m_nodes_copy;\r\n+        }\r\n+\r\n+    private:\r\n+        const CConnman& m_connman;\r\n+        const CConnman& m_connman;\r\n+        const std::vector<CNode*> m_nodes_copy;\r\n+};\r\n+\r\n void CConnman::AddAddrFetch(const std::string& strDest)\r\n {\r\n     LOCK(m_addr_fetches_mutex);\r\ndiff --git a/src/net.h b/src/net.h\r\nindex 846c4c0ece..f39c46c166 100644\r\n--- a/src/net.h\r\n+++ b/src/net.h\r\n@@ -1021,6 +1021,10 @@ public:\r\n     /** Return true if we should disconnect the peer for failing an inactivity check. */\r\n     bool ShouldRunInactivityChecks(const CNode& node, std::optional<int64_t> now=std::nullopt) const;\r\n\r\n+protected:\r\n+    std::vector<CNode*> vNodes GUARDED_BY(cs_vNodes);\r\n+    mutable RecursiveMutex cs_vNodes;\r\n+\r\n private:\r\n     struct ListenSocket {\r\n     public:\r\n@@ -1153,9 +1157,7 @@ private:\r\n     RecursiveMutex m_addr_fetches_mutex;\r\n     std::vector<std::string> vAddedNodes GUARDED_BY(cs_vAddedNodes);\r\n     mutable RecursiveMutex cs_vAddedNodes;\r\n-    std::vector<CNode*> vNodes GUARDED_BY(cs_vNodes);\r\n     std::list<CNode*> vNodesDisconnected;\r\n-    mutable RecursiveMutex cs_vNodes;\r\n     std::atomic<NodeId> nLastNodeId{0};\r\n     unsigned int nPrevNodeCount{0};\r\n\r\n@@ -1276,40 +1278,7 @@ private:\r\n      */\r\n     std::vector<CService> m_onion_binds;\r\n\r\n-    /**\r\n-     * RAII helper to atomically create a copy of `vNodes` and add a reference\r\n-     * to each of the nodes. The nodes are released when this object is destroyed.\r\n-     */\r\n-    class NodesSnapshot\r\n-    {\r\n-    public:\r\n-        explicit NodesSnapshot(const CConnman& connman) : m_connman{connman}\r\n-        {\r\n-            LOCK(m_connman.cs_vNodes);\r\n-            m_nodes_copy = m_connman.vNodes;\r\n-            for (auto& node : m_nodes_copy) {\r\n-                node->AddRef();\r\n-            }\r\n-        }\r\n-\r\n-        ~NodesSnapshot()\r\n-        {\r\n-            LOCK(m_connman.cs_vNodes);\r\n-            for (auto& node : m_nodes_copy) {\r\n-                node->Release();\r\n-            }\r\n-        }\r\n-\r\n-        const std::vector<CNode*>& Nodes() const\r\n-        {\r\n-            return m_nodes_copy;\r\n-        }\r\n-\r\n-    private:\r\n-        const CConnman& m_connman;\r\n-        std::vector<CNode*> m_nodes_copy;\r\n-    };\r\n-\r\n+    friend class NodesSnapshot;\r\n     friend struct CConnmanTest;\r\n     friend struct ConnmanTestMsg;\r\n };\r\n```",
      "created_at": "2021-05-15T15:20:46Z",
      "updated_at": "2021-05-15T15:49:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r632972362",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632972362"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1232,
      "original_line": 1232,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632972531",
      "pull_request_review_id": 660366732,
      "id": 632972531,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjk3MjUzMQ==",
      "diff_hunk": "@@ -1451,8 +1447,10 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n+    NodesSnapshot snap{*this};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 105,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "in_reply_to_id": null,
      "user": {
        "login": "amitiuttarwar",
        "id": 1500952,
        "node_id": "MDQ6VXNlcjE1MDA5NTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/amitiuttarwar",
        "html_url": "https://github.com/amitiuttarwar",
        "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
        "following_url": "https://api.github.com/users/amitiuttarwar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/amitiuttarwar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/amitiuttarwar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
        "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
        "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
        "events_url": "https://api.github.com/users/amitiuttarwar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```suggestion\r\n    const NodesSnapshot snap{*this};\r\n```",
      "created_at": "2021-05-15T15:22:20Z",
      "updated_at": "2021-05-15T15:48:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r632972531",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632972531"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1450,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632972552",
      "pull_request_review_id": 660366732,
      "id": 632972552,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjk3MjU1Mg==",
      "diff_hunk": "@@ -2174,41 +2159,29 @@ void CConnman::ThreadMessageHandler()\n {\n     while (!flagInterruptMsgProc)\n     {\n-        std::vector<CNode*> vNodesCopy;\n-        {\n-            LOCK(cs_vNodes);\n-            vNodesCopy = vNodes;\n-            for (CNode* pnode : vNodesCopy) {\n-                pnode->AddRef();\n-            }\n-        }\n-\n         bool fMoreWork = false;\n \n-        for (CNode* pnode : vNodesCopy)\n         {\n-            if (pnode->fDisconnect)\n-                continue;\n+            NodesSnapshot snap{*this};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 161,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "in_reply_to_id": null,
      "user": {
        "login": "amitiuttarwar",
        "id": 1500952,
        "node_id": "MDQ6VXNlcjE1MDA5NTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/amitiuttarwar",
        "html_url": "https://github.com/amitiuttarwar",
        "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
        "following_url": "https://api.github.com/users/amitiuttarwar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/amitiuttarwar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/amitiuttarwar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
        "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
        "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
        "events_url": "https://api.github.com/users/amitiuttarwar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```suggestion\r\n            const NodesSnapshot snap{*this};\r\n```",
      "created_at": "2021-05-15T15:22:32Z",
      "updated_at": "2021-05-15T15:48:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r632972552",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632972552"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2165,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632973688",
      "pull_request_review_id": 660366732,
      "id": 632973688,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjk3MzY4OA==",
      "diff_hunk": "@@ -1257,6 +1276,40 @@ class CConnman\n      */\n     std::vector<CService> m_onion_binds;\n \n+    /**\n+     * RAII helper to atomically create a copy of `vNodes` and add a reference\n+     * to each of the nodes. The nodes are released when this object is destroyed.\n+     */\n+    class NodesSnapshot\n+    {\n+    public:\n+        explicit NodesSnapshot(const CConnman& connman) : m_connman{connman}\n+        {\n+            LOCK(m_connman.cs_vNodes);\n+            m_nodes_copy = m_connman.vNodes;\n+            for (auto& node : m_nodes_copy) {\n+                node->AddRef();\n+            }\n+        }\n+\n+        ~NodesSnapshot()\n+        {\n+            LOCK(m_connman.cs_vNodes);\n+            for (auto& node : m_nodes_copy) {\n+                node->Release();\n+            }\n+        }\n+\n+        const std::vector<CNode*>& Nodes() const\n+        {\n+            return m_nodes_copy;\n+        }\n+\n+    private:\n+        const CConnman& m_connman;\n+        std::vector<CNode*> m_nodes_copy;",
      "path": "src/net.h",
      "position": 98,
      "original_position": 65,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "in_reply_to_id": null,
      "user": {
        "login": "amitiuttarwar",
        "id": 1500952,
        "node_id": "MDQ6VXNlcjE1MDA5NTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/amitiuttarwar",
        "html_url": "https://github.com/amitiuttarwar",
        "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
        "following_url": "https://api.github.com/users/amitiuttarwar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/amitiuttarwar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/amitiuttarwar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
        "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
        "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
        "events_url": "https://api.github.com/users/amitiuttarwar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```suggestion\r\n        const std::vector<CNode*> m_nodes_copy;\r\n```\r\n\r\nCan `const` this if you add the constructor assignment to the initializer list (done in https://github.com/bitcoin/bitcoin/pull/21943#discussion_r632972362 diff) ",
      "created_at": "2021-05-15T15:33:32Z",
      "updated_at": "2021-05-15T15:49:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r632973688",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632973688"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1262,
      "original_line": 1262,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632974904",
      "pull_request_review_id": 660366732,
      "id": 632974904,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjk3NDkwNA==",
      "diff_hunk": "@@ -1257,6 +1276,40 @@ class CConnman\n      */\n     std::vector<CService> m_onion_binds;\n \n+    /**\n+     * RAII helper to atomically create a copy of `vNodes` and add a reference\n+     * to each of the nodes. The nodes are released when this object is destroyed.\n+     */\n+    class NodesSnapshot\n+    {\n+    public:\n+        explicit NodesSnapshot(const CConnman& connman) : m_connman{connman}\n+        {\n+            LOCK(m_connman.cs_vNodes);\n+            m_nodes_copy = m_connman.vNodes;\n+            for (auto& node : m_nodes_copy) {\n+                node->AddRef();\n+            }\n+        }\n+\n+        ~NodesSnapshot()\n+        {\n+            LOCK(m_connman.cs_vNodes);\n+            for (auto& node : m_nodes_copy) {\n+                node->Release();",
      "path": "src/net.h",
      "position": 88,
      "original_position": 54,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "in_reply_to_id": null,
      "user": {
        "login": "amitiuttarwar",
        "id": 1500952,
        "node_id": "MDQ6VXNlcjE1MDA5NTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/amitiuttarwar",
        "html_url": "https://github.com/amitiuttarwar",
        "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
        "following_url": "https://api.github.com/users/amitiuttarwar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/amitiuttarwar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/amitiuttarwar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
        "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
        "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
        "events_url": "https://api.github.com/users/amitiuttarwar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I see that you haven't changed the behavior here, but I'm curious about the pre-existing logic: \r\n\r\nIs it necessary for `Release()` to be under the lock? \r\n\r\nIt makes sense that `AddRef` has to be under the lock so there isn't a race between a thread that is trying to operate on the node, and a thread that is evaluating for disconnect. However, with `Release`, I don't think there is actually potential for a race.. if `GetRefCount` returns > 0, `DisconnectNodes` will delay processing it. And since `nRefCount` is atomic, it shouldn't be a problem if multiple threads are trying to increment / decrement at the same time. Does this reasoning seem sound? Am I missing something? \r\n\r\ncc @narula ",
      "created_at": "2021-05-15T15:44:42Z",
      "updated_at": "2021-05-15T16:03:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r632974904",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632974904"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1252,
      "original_line": 1252,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632986434",
      "pull_request_review_id": 660376603,
      "id": 632986434,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjk4NjQzNA==",
      "diff_hunk": "@@ -1257,6 +1276,40 @@ class CConnman\n      */\n     std::vector<CService> m_onion_binds;\n \n+    /**\n+     * RAII helper to atomically create a copy of `vNodes` and add a reference\n+     * to each of the nodes. The nodes are released when this object is destroyed.\n+     */\n+    class NodesSnapshot",
      "path": "src/net.h",
      "position": 68,
      "original_position": 38,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "in_reply_to_id": 632972362,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I like this. A few notes:\r\n\r\n- the diff as shown is corrupted (contains the `+        const CConnman& m_connman;` line twice) and so doesn't apply with `git apply`.\r\n- `vNodes` and `cs_vNodes` don't need to change to be protected. Friend classes have access to private members.\r\n- `NodesSnapshot` can be in the unnamed namespace since it's only needed in the net.cpp translation unit.",
      "created_at": "2021-05-15T17:38:06Z",
      "updated_at": "2021-05-15T17:38:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r632986434",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632986434"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1232,
      "original_line": 1232,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632987235",
      "pull_request_review_id": 660377240,
      "id": 632987235,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjk4NzIzNQ==",
      "diff_hunk": "@@ -1257,6 +1276,40 @@ class CConnman\n      */\n     std::vector<CService> m_onion_binds;\n \n+    /**\n+     * RAII helper to atomically create a copy of `vNodes` and add a reference\n+     * to each of the nodes. The nodes are released when this object is destroyed.\n+     */\n+    class NodesSnapshot",
      "path": "src/net.h",
      "position": 68,
      "original_position": 38,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "in_reply_to_id": 632972362,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The `m_nodes_copy{m_connman.vNodes}` in the initializer list is accessing `vNodes` without the `cs_vNodes` lock. You could update it to take the lock:\r\n\r\n```diff\r\ndiff --git a/src/net.cpp b/src/net.cpp\r\nindex 6040ee86be..d39aa14b20 100644\r\n--- a/src/net.cpp\r\n+++ b/src/net.cpp\r\n@@ -117,7 +117,9 @@ std::string strSubVersion;\r\n class NodesSnapshot\r\n {\r\n     public:\r\n-        explicit NodesSnapshot(const CConnman& connman) : m_connman{connman}, m_nodes_copy{m_connman.vNodes}\r\n+        explicit NodesSnapshot(const CConnman& connman) :\r\n+            m_connman{connman},\r\n+            m_nodes_copy{WITH_LOCK(m_connman.cs_vNodes, return m_connman.vNodes;)}\r\n         {\r\n             LOCK(m_connman.cs_vNodes);\r\n             for (auto& node : m_nodes_copy) {\r\n```\r\n\r\nBut that would introduce a race condition if another thread deleted a node between the initializer list and the ctor being run.\r\n\r\nI think better just to assign `m_nodes_copy` in the ctor.",
      "created_at": "2021-05-15T17:47:12Z",
      "updated_at": "2021-05-15T17:47:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r632987235",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632987235"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1232,
      "original_line": 1232,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632987838",
      "pull_request_review_id": 660377592,
      "id": 632987838,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjk4NzgzOA==",
      "diff_hunk": "@@ -1257,6 +1276,40 @@ class CConnman\n      */\n     std::vector<CService> m_onion_binds;\n \n+    /**\n+     * RAII helper to atomically create a copy of `vNodes` and add a reference\n+     * to each of the nodes. The nodes are released when this object is destroyed.\n+     */\n+    class NodesSnapshot\n+    {\n+    public:\n+        explicit NodesSnapshot(const CConnman& connman) : m_connman{connman}\n+        {\n+            LOCK(m_connman.cs_vNodes);\n+            m_nodes_copy = m_connman.vNodes;\n+            for (auto& node : m_nodes_copy) {\n+                node->AddRef();\n+            }\n+        }\n+\n+        ~NodesSnapshot()\n+        {\n+            LOCK(m_connman.cs_vNodes);\n+            for (auto& node : m_nodes_copy) {\n+                node->Release();",
      "path": "src/net.h",
      "position": 88,
      "original_position": 54,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "in_reply_to_id": 632974904,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think this is correct. There's no need to hold `cs_vNodes` when calling `node->Release();`\r\n\r\nRemoving this lock means that the `m_connman` member is no longer required.",
      "created_at": "2021-05-15T17:52:59Z",
      "updated_at": "2021-05-15T17:52:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r632987838",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632987838"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1252,
      "original_line": 1252,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632989196",
      "pull_request_review_id": 660378433,
      "id": 632989196,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjk4OTE5Ng==",
      "diff_hunk": "@@ -1257,6 +1276,40 @@ class CConnman\n      */\n     std::vector<CService> m_onion_binds;\n \n+    /**\n+     * RAII helper to atomically create a copy of `vNodes` and add a reference\n+     * to each of the nodes. The nodes are released when this object is destroyed.\n+     */\n+    class NodesSnapshot\n+    {\n+    public:\n+        explicit NodesSnapshot(const CConnman& connman) : m_connman{connman}\n+        {\n+            LOCK(m_connman.cs_vNodes);\n+            m_nodes_copy = m_connman.vNodes;\n+            for (auto& node : m_nodes_copy) {\n+                node->AddRef();\n+            }\n+        }\n+\n+        ~NodesSnapshot()\n+        {\n+            LOCK(m_connman.cs_vNodes);\n+            for (auto& node : m_nodes_copy) {\n+                node->Release();\n+            }\n+        }\n+\n+        const std::vector<CNode*>& Nodes() const",
      "path": "src/net.h",
      "position": 92,
      "original_position": 58,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "What do you think about just wrapping the m_nodes_copy `begin()` and `end()` functions:\r\n\r\n```diff\r\ndiff --git a/src/net.cpp b/src/net.cpp\r\nindex 6040ee86be..5388af02e3 100644\r\n--- a/src/net.cpp\r\n+++ b/src/net.cpp\r\n@@ -116,6 +116,10 @@ std::string strSubVersion;\r\n  */\r\n class NodesSnapshot\r\n {\r\n+    private:\r\n+        const CConnman& m_connman;\r\n+        const std::vector<CNode*> m_nodes_copy;\r\n+\r\n     public:\r\n         explicit NodesSnapshot(const CConnman& connman) : m_connman{connman}, m_nodes_copy{m_connman.vNodes}\r\n         {\r\n@@ -133,14 +137,18 @@ class NodesSnapshot\r\n             }\r\n         }\r\n \r\n-        const std::vector<CNode*>& Nodes() const\r\n+        using iterator = decltype(m_nodes_copy.begin());\r\n+\r\n+        iterator begin()\r\n         {\r\n-            return m_nodes_copy;\r\n+            return m_nodes_copy.begin();\r\n+        }\r\n+\r\n+        iterator end()\r\n+        {\r\n+            return m_nodes_copy.end();\r\n         }\r\n \r\n-    private:\r\n-        const CConnman& m_connman;\r\n-        const std::vector<CNode*> m_nodes_copy;\r\n };\r\n```\r\n\r\nand then the client code can use a `NodeSnapshot` in range-based loops, eg:\r\n\r\n```diff\r\n→ git d\r\ndiff --git a/src/net.cpp b/src/net.cpp\r\nindex 6040ee86be..5388af02e3 100644\r\n--- a/src/net.cpp\r\n+++ b/src/net.cpp\r\n@@ -1501,7 +1509,7 @@ void CConnman::SocketHandler()\r\n     //\r\n     // Service each socket\r\n     //\r\n-    for (CNode* pnode : snap.Nodes()) {\r\n+    for (CNode* pnode : snap) {\r\n         if (interruptNet)\r\n             return;\r\n \r\n```",
      "created_at": "2021-05-15T18:07:45Z",
      "updated_at": "2021-05-15T18:07:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r632989196",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/632989196"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1256,
      "original_line": 1256,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/633599186",
      "pull_request_review_id": 661060828,
      "id": 633599186,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMzU5OTE4Ng==",
      "diff_hunk": "@@ -1467,8 +1467,6 @@ void CConnman::SocketHandler()\n         }\n     }\n \n-    NodesSnapshot snap{*this};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 61,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "157674ef213e6329215d1b7eb85dacbc23c468db",
      "in_reply_to_id": 632150326,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Right, a comment is warranted. Added:\r\n\r\n```cpp\r\n    // Accept new connections. Done after taking a snapshot of the nodes because\r\n    // `AcceptConnection()` will add new entries to `vNodes` which are unwanted\r\n    // in the loop below because:\r\n    // - all of `recvSet`, `sendSet` and `errorSet` will be `false` for them\r\n    // - `InactivityCheck()` will either be a noop or will wrongly command to\r\n    //   disconnect the node before we have tried sending or receiving anything\r\n    //   to it.\r\n```",
      "created_at": "2021-05-17T14:48:38Z",
      "updated_at": "2021-05-17T14:48:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r633599186",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/633599186"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1470,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/633613085",
      "pull_request_review_id": 661079909,
      "id": 633613085,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMzYxMzA4NQ==",
      "diff_hunk": "@@ -1257,6 +1276,40 @@ class CConnman\n      */\n     std::vector<CService> m_onion_binds;\n \n+    /**\n+     * RAII helper to atomically create a copy of `vNodes` and add a reference\n+     * to each of the nodes. The nodes are released when this object is destroyed.\n+     */\n+    class NodesSnapshot",
      "path": "src/net.h",
      "position": 68,
      "original_position": 38,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "in_reply_to_id": 632972362,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> I'm guessing you've defined this class within CConnman to enable access to the private members.\r\n\r\nNo, I did it to minimize the scope of the newly added class.\r\n\r\n> Seems nice to keep this mechanism that's only used internally out of the header file.\r\n\r\nWhy? It is used internally by `CConnman` and is defined in its `private:` section. If defined in `net.cpp` that would broaden its scope unnecessary.",
      "created_at": "2021-05-17T15:04:40Z",
      "updated_at": "2021-05-17T15:04:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r633613085",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/633613085"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1232,
      "original_line": 1232,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/633614762",
      "pull_request_review_id": 661082288,
      "id": 633614762,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMzYxNDc2Mg==",
      "diff_hunk": "@@ -1451,8 +1447,10 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n+    NodesSnapshot snap{*this};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 105,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "in_reply_to_id": 632972531,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2021-05-17T15:06:47Z",
      "updated_at": "2021-05-17T15:06:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r633614762",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/633614762"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1450,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/633614896",
      "pull_request_review_id": 661082490,
      "id": 633614896,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMzYxNDg5Ng==",
      "diff_hunk": "@@ -2174,41 +2159,29 @@ void CConnman::ThreadMessageHandler()\n {\n     while (!flagInterruptMsgProc)\n     {\n-        std::vector<CNode*> vNodesCopy;\n-        {\n-            LOCK(cs_vNodes);\n-            vNodesCopy = vNodes;\n-            for (CNode* pnode : vNodesCopy) {\n-                pnode->AddRef();\n-            }\n-        }\n-\n         bool fMoreWork = false;\n \n-        for (CNode* pnode : vNodesCopy)\n         {\n-            if (pnode->fDisconnect)\n-                continue;\n+            NodesSnapshot snap{*this};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 161,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "in_reply_to_id": 632972552,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2021-05-17T15:06:57Z",
      "updated_at": "2021-05-17T15:06:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r633614896",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/633614896"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2165,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/633616340",
      "pull_request_review_id": 661084484,
      "id": 633616340,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMzYxNjM0MA==",
      "diff_hunk": "@@ -1257,6 +1276,40 @@ class CConnman\n      */\n     std::vector<CService> m_onion_binds;\n \n+    /**\n+     * RAII helper to atomically create a copy of `vNodes` and add a reference\n+     * to each of the nodes. The nodes are released when this object is destroyed.\n+     */\n+    class NodesSnapshot\n+    {\n+    public:\n+        explicit NodesSnapshot(const CConnman& connman) : m_connman{connman}\n+        {\n+            LOCK(m_connman.cs_vNodes);\n+            m_nodes_copy = m_connman.vNodes;\n+            for (auto& node : m_nodes_copy) {\n+                node->AddRef();\n+            }\n+        }\n+\n+        ~NodesSnapshot()\n+        {\n+            LOCK(m_connman.cs_vNodes);\n+            for (auto& node : m_nodes_copy) {\n+                node->Release();\n+            }\n+        }\n+\n+        const std::vector<CNode*>& Nodes() const\n+        {\n+            return m_nodes_copy;\n+        }\n+\n+    private:\n+        const CConnman& m_connman;\n+        std::vector<CNode*> m_nodes_copy;",
      "path": "src/net.h",
      "position": 98,
      "original_position": 65,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "in_reply_to_id": 632973688,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The copying and `AddRef()` should be done under the lock.",
      "created_at": "2021-05-17T15:08:39Z",
      "updated_at": "2021-05-17T15:08:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r633616340",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/633616340"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1262,
      "original_line": 1262,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/633617646",
      "pull_request_review_id": 661087509,
      "id": 633617646,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMzYxNzY0Ng==",
      "diff_hunk": "@@ -1257,6 +1276,40 @@ class CConnman\n      */\n     std::vector<CService> m_onion_binds;\n \n+    /**\n+     * RAII helper to atomically create a copy of `vNodes` and add a reference\n+     * to each of the nodes. The nodes are released when this object is destroyed.\n+     */\n+    class NodesSnapshot\n+    {\n+    public:\n+        explicit NodesSnapshot(const CConnman& connman) : m_connman{connman}\n+        {\n+            LOCK(m_connman.cs_vNodes);\n+            m_nodes_copy = m_connman.vNodes;\n+            for (auto& node : m_nodes_copy) {\n+                node->AddRef();\n+            }\n+        }\n+\n+        ~NodesSnapshot()\n+        {\n+            LOCK(m_connman.cs_vNodes);\n+            for (auto& node : m_nodes_copy) {\n+                node->Release();",
      "path": "src/net.h",
      "position": 88,
      "original_position": 54,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "in_reply_to_id": 632974904,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Is it necessary for `Release()` to be under the lock?\r\n\r\nThe lock has two effects:\r\n* All `Release()`s happen atomically together. If removed, then other threads could observe some nodes from the snapshot released and some not yet released. I think that is ok.\r\n* No memory reordering can happen. The `nRefCount--` on the atomic variable has the same effect because `--` is equivalent to [`fetch_sub()`](https://en.cppreference.com/w/cpp/atomic/atomic/fetch_sub) which uses [`memory_order_seq_cst`](https://en.cppreference.com/w/cpp/atomic/memory_order) by default.\r\n\r\n\r\nRemoved the lock and simplified `NodesSnapshot`, thanks!",
      "created_at": "2021-05-17T15:10:02Z",
      "updated_at": "2021-05-17T15:10:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r633617646",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/633617646"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1252,
      "original_line": 1252,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/633625021",
      "pull_request_review_id": 661096340,
      "id": 633625021,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMzYyNTAyMQ==",
      "diff_hunk": "@@ -1257,6 +1276,40 @@ class CConnman\n      */\n     std::vector<CService> m_onion_binds;\n \n+    /**\n+     * RAII helper to atomically create a copy of `vNodes` and add a reference\n+     * to each of the nodes. The nodes are released when this object is destroyed.\n+     */\n+    class NodesSnapshot\n+    {\n+    public:\n+        explicit NodesSnapshot(const CConnman& connman) : m_connman{connman}\n+        {\n+            LOCK(m_connman.cs_vNodes);\n+            m_nodes_copy = m_connman.vNodes;\n+            for (auto& node : m_nodes_copy) {\n+                node->AddRef();\n+            }\n+        }\n+\n+        ~NodesSnapshot()\n+        {\n+            LOCK(m_connman.cs_vNodes);\n+            for (auto& node : m_nodes_copy) {\n+                node->Release();\n+            }\n+        }\n+\n+        const std::vector<CNode*>& Nodes() const",
      "path": "src/net.h",
      "position": 92,
      "original_position": 58,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "in_reply_to_id": 632989196,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think both ways would work.\r\n\r\nThe begin/end variant seems to be a bit more code - it saves just `.Nodes()` from the callers but has two methods and is also less friendly to grepping and code navigation - now I can point my \"IDE\" to `Nodes()` on the line `for (CNode* pnode : snap.Nodes()) {` and see what it returns or its definition. Not so with the `for (CNode* pnode : snap) {` line.\r\n\r\nThat said, I am fine either way but have a slight preference for the `.Nodes()` variant.",
      "created_at": "2021-05-17T15:17:35Z",
      "updated_at": "2021-05-17T15:17:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r633625021",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/633625021"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1256,
      "original_line": 1256,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/633628981",
      "pull_request_review_id": 661101634,
      "id": 633628981,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMzYyODk4MQ==",
      "diff_hunk": "@@ -1257,6 +1276,40 @@ class CConnman\n      */\n     std::vector<CService> m_onion_binds;\n \n+    /**\n+     * RAII helper to atomically create a copy of `vNodes` and add a reference\n+     * to each of the nodes. The nodes are released when this object is destroyed.\n+     */\n+    class NodesSnapshot\n+    {\n+    public:\n+        explicit NodesSnapshot(const CConnman& connman) : m_connman{connman}\n+        {\n+            LOCK(m_connman.cs_vNodes);\n+            m_nodes_copy = m_connman.vNodes;\n+            for (auto& node : m_nodes_copy) {\n+                node->AddRef();\n+            }\n+        }\n+\n+        ~NodesSnapshot()\n+        {\n+            LOCK(m_connman.cs_vNodes);\n+            for (auto& node : m_nodes_copy) {\n+                node->Release();\n+            }\n+        }\n+\n+        const std::vector<CNode*>& Nodes() const",
      "path": "src/net.h",
      "position": 92,
      "original_position": 58,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "in_reply_to_id": 632989196,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "No strong preference. Just pointing out an alternative. I'll mark this as resolved.",
      "created_at": "2021-05-17T15:22:19Z",
      "updated_at": "2021-05-17T15:22:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r633628981",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/633628981"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1256,
      "original_line": 1256,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/633891308",
      "pull_request_review_id": 661454158,
      "id": 633891308,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMzg5MTMwOA==",
      "diff_hunk": "@@ -1257,6 +1276,40 @@ class CConnman\n      */\n     std::vector<CService> m_onion_binds;\n \n+    /**\n+     * RAII helper to atomically create a copy of `vNodes` and add a reference\n+     * to each of the nodes. The nodes are released when this object is destroyed.\n+     */\n+    class NodesSnapshot\n+    {\n+    public:\n+        explicit NodesSnapshot(const CConnman& connman) : m_connman{connman}\n+        {\n+            LOCK(m_connman.cs_vNodes);\n+            m_nodes_copy = m_connman.vNodes;\n+            for (auto& node : m_nodes_copy) {\n+                node->AddRef();\n+            }\n+        }\n+\n+        ~NodesSnapshot()\n+        {\n+            LOCK(m_connman.cs_vNodes);\n+            for (auto& node : m_nodes_copy) {\n+                node->Release();\n+            }\n+        }\n+\n+        const std::vector<CNode*>& Nodes() const\n+        {\n+            return m_nodes_copy;\n+        }\n+\n+    private:\n+        const CConnman& m_connman;\n+        std::vector<CNode*> m_nodes_copy;",
      "path": "src/net.h",
      "position": 98,
      "original_position": 65,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "in_reply_to_id": 632973688,
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Why `AddRef`? @amitiuttarwar suggestion can be accomplished with\r\n```diff\r\n         explicit NodesSnapshot(const CConnman& connman)\r\n+            : m_nodes_copy(WITH_LOCK(connman.cs_vNodes, return connman.vNodes))\r\n         {\r\n-            LOCK(connman.cs_vNodes);\r\n-            m_nodes_copy = connman.vNodes;\r\n             for (auto& node : m_nodes_copy) {\r\n                 node->AddRef();\r\n             }\r\n@@ -1305,7 +1304,7 @@ private:\r\n         }\r\n\r\n     private:\r\n-        std::vector<CNode*> m_nodes_copy;\r\n+        const std::vector<CNode*> m_nodes_copy;\r\n     };\r\n```\r\n\r\nNever mind, I see why `AddRef` needs to be under the lock. It's still possible to use the `WITH_LOCK` approach so `m_nodes_copy` could be is const, but not worth it IMO.",
      "created_at": "2021-05-17T21:50:41Z",
      "updated_at": "2021-05-17T21:53:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r633891308",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/633891308"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1262,
      "original_line": 1262,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634141685",
      "pull_request_review_id": 661765027,
      "id": 634141685,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDE0MTY4NQ==",
      "diff_hunk": "@@ -1257,6 +1276,40 @@ class CConnman\n      */\n     std::vector<CService> m_onion_binds;\n \n+    /**\n+     * RAII helper to atomically create a copy of `vNodes` and add a reference\n+     * to each of the nodes. The nodes are released when this object is destroyed.\n+     */\n+    class NodesSnapshot\n+    {\n+    public:\n+        explicit NodesSnapshot(const CConnman& connman) : m_connman{connman}\n+        {\n+            LOCK(m_connman.cs_vNodes);\n+            m_nodes_copy = m_connman.vNodes;\n+            for (auto& node : m_nodes_copy) {\n+                node->AddRef();\n+            }\n+        }\n+\n+        ~NodesSnapshot()\n+        {\n+            LOCK(m_connman.cs_vNodes);\n+            for (auto& node : m_nodes_copy) {\n+                node->Release();\n+            }\n+        }\n+\n+        const std::vector<CNode*>& Nodes() const\n+        {\n+            return m_nodes_copy;\n+        }\n+\n+    private:\n+        const CConnman& m_connman;\n+        std::vector<CNode*> m_nodes_copy;",
      "path": "src/net.h",
      "position": 98,
      "original_position": 65,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "in_reply_to_id": 632973688,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yeah :) `AddRef()` needs to be under the same lock that did the copy (without release in between) because otherwise some of the copied elements may be destroyed in the meantime and `node->` to try to dereference a dangling pointer while trying to call `AddRef()`.\r\n\r\nIt should work with something like\r\n```cpp\r\nexplicit NodesSnapshot(const CConnman& connman)\r\n            : m_nodes_copy(WITH_LOCK(connman.cs_vNodes, for (auto& node : connman.vNodes) { node->AddRef(); } ; return connman.vNodes))\r\n```\r\n\r\nbut that is not worth it indeed :)",
      "created_at": "2021-05-18T08:04:05Z",
      "updated_at": "2021-05-18T08:04:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r634141685",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634141685"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1262,
      "original_line": 1262,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634196764",
      "pull_request_review_id": 661837870,
      "id": 634196764,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDE5Njc2NA==",
      "diff_hunk": "@@ -1257,6 +1276,40 @@ class CConnman\n      */\n     std::vector<CService> m_onion_binds;\n \n+    /**\n+     * RAII helper to atomically create a copy of `vNodes` and add a reference\n+     * to each of the nodes. The nodes are released when this object is destroyed.\n+     */\n+    class NodesSnapshot",
      "path": "src/net.h",
      "position": 68,
      "original_position": 38,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "in_reply_to_id": 632972362,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> > Seems nice to keep this mechanism that's only used internally out of the header file.\r\n\r\n> Why?\r\n\r\nBecause it's good to keep header files limited to what's required to be included into other translation units (as far as is possible). That's beneficial for both build time and code management reasons.\r\n\r\nI think both ways are fine, and that eventually we'll want to virtualize both `CNode`'s and `CConnman`'s public interfaces so that they can be mocked out for testing, at which point the private methods could all be moved to the implementation file.",
      "created_at": "2021-05-18T09:15:34Z",
      "updated_at": "2021-05-18T09:15:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r634196764",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634196764"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1232,
      "original_line": 1232,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634254981",
      "pull_request_review_id": 661915095,
      "id": 634254981,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDI1NDk4MQ==",
      "diff_hunk": "@@ -1257,6 +1276,40 @@ class CConnman\n      */\n     std::vector<CService> m_onion_binds;\n \n+    /**\n+     * RAII helper to atomically create a copy of `vNodes` and add a reference\n+     * to each of the nodes. The nodes are released when this object is destroyed.\n+     */\n+    class NodesSnapshot",
      "path": "src/net.h",
      "position": 68,
      "original_position": 38,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "in_reply_to_id": 632972362,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> That's beneficial for both build time...\r\n\r\nI do not think it is justified to put private class members as globals in the `.cpp` file in order to minimize the header file so that it compiles faster.\r\n\r\n> ... and code management reasons.\r\n\r\nUnnecessary broadened scope has an adverse effect on code management.",
      "created_at": "2021-05-18T10:35:22Z",
      "updated_at": "2021-05-18T10:35:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r634254981",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634254981"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1232,
      "original_line": 1232,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634777026",
      "pull_request_review_id": 662612291,
      "id": 634777026,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDc3NzAyNg==",
      "diff_hunk": "@@ -1257,6 +1276,40 @@ class CConnman\n      */\n     std::vector<CService> m_onion_binds;\n \n+    /**\n+     * RAII helper to atomically create a copy of `vNodes` and add a reference\n+     * to each of the nodes. The nodes are released when this object is destroyed.\n+     */\n+    class NodesSnapshot",
      "path": "src/net.h",
      "position": 68,
      "original_position": 38,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "in_reply_to_id": 632972362,
      "user": {
        "login": "amitiuttarwar",
        "id": 1500952,
        "node_id": "MDQ6VXNlcjE1MDA5NTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/amitiuttarwar",
        "html_url": "https://github.com/amitiuttarwar",
        "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
        "following_url": "https://api.github.com/users/amitiuttarwar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/amitiuttarwar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/amitiuttarwar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
        "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
        "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
        "events_url": "https://api.github.com/users/amitiuttarwar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "If `NodesSnapshot` was defined as a standalone class in `net.cpp`, it could be added to the unnamed namespace so it would only be accessible within the same translation unit, but it would broaden the scope beyond `CConnman` to within the translation unit. \r\n\r\nMy preference for it to be in the `.cpp` is because I find it easier to understand responsibilities & maneuver the files when the headers capture the way the classes interact with external callers. But I totally understand the point about broadening scope, and think this ultimately comes down to a preference.\r\n\r\nI'm going to resolve this conversation, thanks for the feedback @vasild & @jnewbery :) ",
      "created_at": "2021-05-18T22:00:44Z",
      "updated_at": "2021-05-18T22:00:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r634777026",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/634777026"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1232,
      "original_line": 1232,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/635077910",
      "pull_request_review_id": 662980191,
      "id": 635077910,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNTA3NzkxMA==",
      "diff_hunk": "@@ -1257,6 +1276,40 @@ class CConnman\n      */\n     std::vector<CService> m_onion_binds;\n \n+    /**\n+     * RAII helper to atomically create a copy of `vNodes` and add a reference\n+     * to each of the nodes. The nodes are released when this object is destroyed.\n+     */\n+    class NodesSnapshot",
      "path": "src/net.h",
      "position": 68,
      "original_position": 38,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "in_reply_to_id": 632972362,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@amitiuttarwar, maybe you would like the following pattern to be more widespread:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/1ed859e90e18384376e3a1ff0cb76f3e9ab11c2d/src/txrequest.h#L96-L101",
      "created_at": "2021-05-19T09:40:06Z",
      "updated_at": "2021-05-19T09:40:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r635077910",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/635077910"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1232,
      "original_line": 1232,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/635470619",
      "pull_request_review_id": 663513225,
      "id": 635470619,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNTQ3MDYxOQ==",
      "diff_hunk": "@@ -1257,6 +1276,40 @@ class CConnman\n      */\n     std::vector<CService> m_onion_binds;\n \n+    /**\n+     * RAII helper to atomically create a copy of `vNodes` and add a reference\n+     * to each of the nodes. The nodes are released when this object is destroyed.\n+     */\n+    class NodesSnapshot",
      "path": "src/net.h",
      "position": 68,
      "original_position": 38,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "in_reply_to_id": 632972362,
      "user": {
        "login": "amitiuttarwar",
        "id": 1500952,
        "node_id": "MDQ6VXNlcjE1MDA5NTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/amitiuttarwar",
        "html_url": "https://github.com/amitiuttarwar",
        "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
        "following_url": "https://api.github.com/users/amitiuttarwar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/amitiuttarwar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/amitiuttarwar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
        "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
        "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
        "events_url": "https://api.github.com/users/amitiuttarwar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "yeah, I'm def a fan of the pimpl / related patterns. Another example is how its used in `net_processing` since #20811.",
      "created_at": "2021-05-19T18:03:51Z",
      "updated_at": "2021-05-19T18:03:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r635470619",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/635470619"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1232,
      "original_line": 1232,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711994001",
      "pull_request_review_id": 758400122,
      "id": 711994001,
      "node_id": "PRRC_kwDOABII584qcCqR",
      "diff_hunk": "@@ -1492,13 +1488,21 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n+    const NodesSnapshot snap{*this, false};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 105,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "072896b7cf5e69c11a2e6d9e7163df4e0472f504",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "0d706a6 if you retouch or have to rebase\r\n```suggestion\r\n    const NodesSnapshot snap{*this, /* shuffle=*/ false};\r\n```",
      "created_at": "2021-09-20T09:08:22Z",
      "updated_at": "2021-09-20T10:14:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r711994001",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711994001"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1491,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711994365",
      "pull_request_review_id": 758400122,
      "id": 711994365,
      "node_id": "PRRC_kwDOABII584qcCv9",
      "diff_hunk": "@@ -2213,49 +2204,34 @@ void CConnman::OpenNetworkConnection(const CAddress& addrConnect, bool fCountFai\n \n void CConnman::ThreadMessageHandler()\n {\n-    FastRandomContext rng;\n     while (!flagInterruptMsgProc)\n     {\n-        std::vector<CNode*> vNodesCopy;\n-        {\n-            LOCK(cs_vNodes);\n-            vNodesCopy = vNodes;\n-            for (CNode* pnode : vNodesCopy) {\n-                pnode->AddRef();\n-            }\n-        }\n-\n         bool fMoreWork = false;\n \n-        // Randomize the order in which we process messages from/to our peers.\n-        // This prevents attacks in which an attacker exploits having multiple\n-        // consecutive connections in the vNodes list.\n-        Shuffle(vNodesCopy.begin(), vNodesCopy.end(), rng);\n-\n-        for (CNode* pnode : vNodesCopy)\n         {\n-            if (pnode->fDisconnect)\n-                continue;\n+            // Randomize the order in which we process messages from/to our peers.\n+            // This prevents attacks in which an attacker exploits having multiple\n+            // consecutive connections in the vNodes list.\n+            const NodesSnapshot snap{*this, true};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 184,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "072896b7cf5e69c11a2e6d9e7163df4e0472f504",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "0d706a6 if you retouch or have to rebase, I think the comment about randomizing makes more sense with a named arg for `shuffle` \r\n```suggestion\r\n            const NodesSnapshot snap{*this, /* shuffle=*/ true};\r\n```",
      "created_at": "2021-09-20T09:08:52Z",
      "updated_at": "2021-09-20T10:14:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r711994365",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/711994365"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2215,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/712014389",
      "pull_request_review_id": 758400122,
      "id": 712014389,
      "node_id": "PRRC_kwDOABII584qcHo1",
      "diff_hunk": "@@ -992,8 +992,27 @@ class CConnman\n     void NotifyNumConnectionsChanged();\n     /** Return true if the peer is inactive and should be disconnected. */\n     bool InactivityCheck(const CNode& node) const;\n-    bool GenerateSelectSet(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_set, std::set<SOCKET> &error_set);\n-    void SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_set, std::set<SOCKET> &error_set);\n+\n+    /**\n+     * Generate a collection of sockets that we want to be checked for readiness for IO.",
      "path": "src/net.h",
      "position": null,
      "original_position": 8,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "072896b7cf5e69c11a2e6d9e7163df4e0472f504",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "bf0dc73 nit doc suggestion, `s/readiness for IO/IO readiness/` or the pithier\r\n\r\n```suggestion\r\n     * Generate a collection of sockets to check for IO readiness.\r\n```",
      "created_at": "2021-09-20T09:39:04Z",
      "updated_at": "2021-09-20T10:14:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r712014389",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/712014389"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 997,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/712022174",
      "pull_request_review_id": 758400122,
      "id": 712022174,
      "node_id": "PRRC_kwDOABII584qcJie",
      "diff_hunk": "@@ -1326,57 +1326,53 @@ bool CConnman::InactivityCheck(const CNode& node) const\n     return false;\n }\n \n-bool CConnman::GenerateSelectSet(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_set, std::set<SOCKET> &error_set)\n+bool CConnman::GenerateSelectSet(const std::vector<CNode*>& nodes, std::set<SOCKET> &recv_set, std::set<SOCKET> &send_set, std::set<SOCKET> &error_set)\n {\n     for (const ListenSocket& hListenSocket : vhListenSocket) {\n         recv_set.insert(hListenSocket.socket);\n     }\n \n-    {",
      "path": "src/net.cpp",
      "position": 14,
      "original_position": 11,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "072896b7cf5e69c11a2e6d9e7163df4e0472f504",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "072896b these braces were needed to define the scope for the `LOCK(cs_vNodes);` mutex lock that is removed in the previous commit, so it may be a bit clearer to remove them at the same time as the lock. No strong opinion though. ",
      "created_at": "2021-09-20T09:50:56Z",
      "updated_at": "2021-09-20T10:17:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r712022174",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/712022174"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1340,
      "original_line": 1340,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/717301345",
      "pull_request_review_id": 765069220,
      "id": 717301345,
      "node_id": "PRRC_kwDOABII584qwSZh",
      "diff_hunk": "@@ -1492,13 +1488,21 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n+    const NodesSnapshot snap{*this, false};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 105,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "072896b7cf5e69c11a2e6d9e7163df4e0472f504",
      "in_reply_to_id": 711994001,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Added the comment. Some grepping showed the most common form of this is `func(/* description */ param);`",
      "created_at": "2021-09-28T07:31:07Z",
      "updated_at": "2021-09-28T07:31:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r717301345",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/717301345"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1491,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/717301455",
      "pull_request_review_id": 765069330,
      "id": 717301455,
      "node_id": "PRRC_kwDOABII584qwSbP",
      "diff_hunk": "@@ -2213,49 +2204,34 @@ void CConnman::OpenNetworkConnection(const CAddress& addrConnect, bool fCountFai\n \n void CConnman::ThreadMessageHandler()\n {\n-    FastRandomContext rng;\n     while (!flagInterruptMsgProc)\n     {\n-        std::vector<CNode*> vNodesCopy;\n-        {\n-            LOCK(cs_vNodes);\n-            vNodesCopy = vNodes;\n-            for (CNode* pnode : vNodesCopy) {\n-                pnode->AddRef();\n-            }\n-        }\n-\n         bool fMoreWork = false;\n \n-        // Randomize the order in which we process messages from/to our peers.\n-        // This prevents attacks in which an attacker exploits having multiple\n-        // consecutive connections in the vNodes list.\n-        Shuffle(vNodesCopy.begin(), vNodesCopy.end(), rng);\n-\n-        for (CNode* pnode : vNodesCopy)\n         {\n-            if (pnode->fDisconnect)\n-                continue;\n+            // Randomize the order in which we process messages from/to our peers.\n+            // This prevents attacks in which an attacker exploits having multiple\n+            // consecutive connections in the vNodes list.\n+            const NodesSnapshot snap{*this, true};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 184,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "072896b7cf5e69c11a2e6d9e7163df4e0472f504",
      "in_reply_to_id": 711994365,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Added the comment. Some grepping showed the most common form of this is `func(/* description */ param);`",
      "created_at": "2021-09-28T07:31:14Z",
      "updated_at": "2021-09-28T07:31:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r717301455",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/717301455"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2215,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/717301573",
      "pull_request_review_id": 765069500,
      "id": 717301573,
      "node_id": "PRRC_kwDOABII584qwSdF",
      "diff_hunk": "@@ -992,8 +992,27 @@ class CConnman\n     void NotifyNumConnectionsChanged();\n     /** Return true if the peer is inactive and should be disconnected. */\n     bool InactivityCheck(const CNode& node) const;\n-    bool GenerateSelectSet(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_set, std::set<SOCKET> &error_set);\n-    void SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_set, std::set<SOCKET> &error_set);\n+\n+    /**\n+     * Generate a collection of sockets that we want to be checked for readiness for IO.",
      "path": "src/net.h",
      "position": null,
      "original_position": 8,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "072896b7cf5e69c11a2e6d9e7163df4e0472f504",
      "in_reply_to_id": 712014389,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2021-09-28T07:31:24Z",
      "updated_at": "2021-09-28T07:31:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r717301573",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/717301573"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 997,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/717303767",
      "pull_request_review_id": 765072250,
      "id": 717303767,
      "node_id": "PRRC_kwDOABII584qwS_X",
      "diff_hunk": "@@ -1326,57 +1326,53 @@ bool CConnman::InactivityCheck(const CNode& node) const\n     return false;\n }\n \n-bool CConnman::GenerateSelectSet(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_set, std::set<SOCKET> &error_set)\n+bool CConnman::GenerateSelectSet(const std::vector<CNode*>& nodes, std::set<SOCKET> &recv_set, std::set<SOCKET> &send_set, std::set<SOCKET> &error_set)\n {\n     for (const ListenSocket& hListenSocket : vhListenSocket) {\n         recv_set.insert(hListenSocket.socket);\n     }\n \n-    {",
      "path": "src/net.cpp",
      "position": 14,
      "original_position": 11,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "072896b7cf5e69c11a2e6d9e7163df4e0472f504",
      "in_reply_to_id": 712022174,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I deliberately did the white-space change in a separate commit to ease review which would be harder if logic changes are mixed with lots of white-space changes. I extended the commit message though, so that it is easier to answer \"how did we end up with those unnecessary braces\".",
      "created_at": "2021-09-28T07:34:14Z",
      "updated_at": "2021-09-28T07:34:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r717303767",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/717303767"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1340,
      "original_line": 1340,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/717379468",
      "pull_request_review_id": 765175113,
      "id": 717379468,
      "node_id": "PRRC_kwDOABII584qwleM",
      "diff_hunk": "@@ -1492,13 +1488,21 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n+    const NodesSnapshot snap{*this, false};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 105,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "072896b7cf5e69c11a2e6d9e7163df4e0472f504",
      "in_reply_to_id": 711994001,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yes. I've very recently started to switch to the `/*named_arg=*/` format for `bugprone-argument-comment` added in fa57fa1a2e7. Not sure how picky clang is about it though.\r\n\r\nhttps://releases.llvm.org/12.0.0/tools/clang/tools/extra/docs/clang-tidy/checks/bugprone-argument-comment.html.",
      "created_at": "2021-09-28T09:08:46Z",
      "updated_at": "2021-10-03T17:34:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r717379468",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/717379468"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1491,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/717384169",
      "pull_request_review_id": 765181441,
      "id": 717384169,
      "node_id": "PRRC_kwDOABII584qwmnp",
      "diff_hunk": "@@ -1326,57 +1326,53 @@ bool CConnman::InactivityCheck(const CNode& node) const\n     return false;\n }\n \n-bool CConnman::GenerateSelectSet(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_set, std::set<SOCKET> &error_set)\n+bool CConnman::GenerateSelectSet(const std::vector<CNode*>& nodes, std::set<SOCKET> &recv_set, std::set<SOCKET> &send_set, std::set<SOCKET> &error_set)\n {\n     for (const ListenSocket& hListenSocket : vhListenSocket) {\n         recv_set.insert(hListenSocket.socket);\n     }\n \n-    {",
      "path": "src/net.cpp",
      "position": 14,
      "original_position": 11,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "072896b7cf5e69c11a2e6d9e7163df4e0472f504",
      "in_reply_to_id": 712022174,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yes, no worries. Since some time now my `.gitconfig` has this set by default to simplify whitespace review (open to suggestions).\r\n```\r\n[diff]\r\n  renames = copies\r\n\tcolorMoved = dimmed-zebra\r\n\tcolorMovedWs = allow-indentation-change\r\n```\r\n",
      "created_at": "2021-09-28T09:14:31Z",
      "updated_at": "2021-09-28T09:14:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r717384169",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/717384169"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1340,
      "original_line": 1340,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/717405324",
      "pull_request_review_id": 765210141,
      "id": 717405324,
      "node_id": "PRRC_kwDOABII584qwryM",
      "diff_hunk": "@@ -1492,13 +1488,21 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n+    const NodesSnapshot snap{*this, false};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 105,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "072896b7cf5e69c11a2e6d9e7163df4e0472f504",
      "in_reply_to_id": 711994001,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "My testing revealed that the `=` is needed for clang-tidy. I am likely going to use `(/*foo_bar=*/123, ` from now on (I think clang-format \"mirrors\" the whitespace, so clang-format valid options are `(/*foo_bar=*/123, /*bar_foor=*/321, ` or `(/* foo_bar = */ 123, /* bar_foor = */ 321, `",
      "created_at": "2021-09-28T09:41:37Z",
      "updated_at": "2021-09-28T09:41:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r717405324",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/717405324"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1491,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/717427120",
      "pull_request_review_id": 765239667,
      "id": 717427120,
      "node_id": "PRRC_kwDOABII584qwxGw",
      "diff_hunk": "@@ -1492,13 +1488,21 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n+    const NodesSnapshot snap{*this, false};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 105,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "072896b7cf5e69c11a2e6d9e7163df4e0472f504",
      "in_reply_to_id": 711994001,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks, good to know.",
      "created_at": "2021-09-28T10:09:46Z",
      "updated_at": "2021-09-28T10:09:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r717427120",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/717427120"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1491,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/717530409",
      "pull_request_review_id": 765380171,
      "id": 717530409,
      "node_id": "PRRC_kwDOABII584qxKUp",
      "diff_hunk": "@@ -1492,13 +1488,21 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n+    const NodesSnapshot snap{*this, false};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 105,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "072896b7cf5e69c11a2e6d9e7163df4e0472f504",
      "in_reply_to_id": 711994001,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`/* bar_foor= */ 321` is also ok for clang-format (re-formatting that with clang-format leaves it unmodified). I don't care which one as long as it is consistent through the code. I will use `/*foo_bar=*/123` too.",
      "created_at": "2021-09-28T12:37:04Z",
      "updated_at": "2021-09-28T12:37:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r717530409",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/717530409"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1491,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/725079584",
      "pull_request_review_id": 775111135,
      "id": 725079584,
      "node_id": "PRRC_kwDOABII584rN9Yg",
      "diff_hunk": "@@ -1498,13 +1494,21 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n+    const NodesSnapshot snap{*this, /*shuffle=*/false};\n+\n     std::set<SOCKET> recv_set, send_set, error_set;\n-    SocketEvents(recv_set, send_set, error_set);\n+    SocketEvents(snap.Nodes(), recv_set, send_set, error_set);\n \n     if (interruptNet) return;\n \n     //\n-    // Accept new connections\n+    // Accept new connections. Done after taking a snapshot of the nodes because",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 115,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "99c1af5a8f95051e98ad4b9486eef70919ab2708",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think the logical flow of this function would be clearer if this logic was either moved to the bottom of the function, or pulled out of `SocketHandler()` entirely and put in `ThreadSocketHandler()` (or a dedicated function for accepting new connections). It's difficult to get my head around creating a NodesSnapshot, receiving events for those nodes, then updating vNodes and finally processing the events for the nodes in the snapshot.",
      "created_at": "2021-10-08T14:50:21Z",
      "updated_at": "2021-10-08T14:50:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r725079584",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/725079584"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1505,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/725096927",
      "pull_request_review_id": 775135162,
      "id": 725096927,
      "node_id": "PRRC_kwDOABII584rOBnf",
      "diff_hunk": "@@ -1498,13 +1494,21 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n+    const NodesSnapshot snap{*this, /*shuffle=*/false};\n+\n     std::set<SOCKET> recv_set, send_set, error_set;\n-    SocketEvents(recv_set, send_set, error_set);\n+    SocketEvents(snap.Nodes(), recv_set, send_set, error_set);\n \n     if (interruptNet) return;\n \n     //\n-    // Accept new connections\n+    // Accept new connections. Done after taking a snapshot of the nodes because",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 115,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "99c1af5a8f95051e98ad4b9486eef70919ab2708",
      "in_reply_to_id": 725079584,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Alright, I think you are on the same page as @promag: https://github.com/bitcoin/bitcoin/pull/21943#discussion_r632360108. I will move it to the bottom or see how many more changes to split it (pull it out). @jonatack, what do you think?",
      "created_at": "2021-10-08T15:12:15Z",
      "updated_at": "2021-10-08T15:12:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r725096927",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/725096927"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1505,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/725119190",
      "pull_request_review_id": 775165468,
      "id": 725119190,
      "node_id": "PRRC_kwDOABII584rOHDW",
      "diff_hunk": "@@ -1498,13 +1494,21 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n+    const NodesSnapshot snap{*this, /*shuffle=*/false};\n+\n     std::set<SOCKET> recv_set, send_set, error_set;\n-    SocketEvents(recv_set, send_set, error_set);\n+    SocketEvents(snap.Nodes(), recv_set, send_set, error_set);\n \n     if (interruptNet) return;\n \n     //\n-    // Accept new connections\n+    // Accept new connections. Done after taking a snapshot of the nodes because",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 115,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "99c1af5a8f95051e98ad4b9486eef70919ab2708",
      "in_reply_to_id": 725079584,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Agree, I recall writing the same comment during my main review, moving the code to the end, then thinking it maybe made the most sense to make it a separate function, then deciding to not hold up this pull with that since it's been open a while and you have more steps in #21878. But yes.",
      "created_at": "2021-10-08T15:42:18Z",
      "updated_at": "2021-10-08T15:42:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r725119190",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/725119190"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1505,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/728473929",
      "pull_request_review_id": 779123140,
      "id": 728473929,
      "node_id": "PRRC_kwDOABII584ra6FJ",
      "diff_hunk": "@@ -1332,57 +1332,53 @@ bool CConnman::InactivityCheck(const CNode& node) const\n     return false;\n }\n \n-bool CConnman::GenerateSelectSet(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_set, std::set<SOCKET> &error_set)\n+bool CConnman::GenerateSelectSet(const std::vector<CNode*>& nodes, std::set<SOCKET> &recv_set, std::set<SOCKET> &send_set, std::set<SOCKET> &error_set)",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "99c1af5a8f95051e98ad4b9486eef70919ab2708",
      "in_reply_to_id": null,
      "user": {
        "login": "LarryRuane",
        "id": 8321330,
        "node_id": "MDQ6VXNlcjgzMjEzMzA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8321330?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/LarryRuane",
        "html_url": "https://github.com/LarryRuane",
        "followers_url": "https://api.github.com/users/LarryRuane/followers",
        "following_url": "https://api.github.com/users/LarryRuane/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/LarryRuane/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/LarryRuane/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/LarryRuane/subscriptions",
        "organizations_url": "https://api.github.com/users/LarryRuane/orgs",
        "repos_url": "https://api.github.com/users/LarryRuane/repos",
        "events_url": "https://api.github.com/users/LarryRuane/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/LarryRuane/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: since you're changing this line anyway, maybe reverse the space and `&` for the 3 set arguments (to conform to style convention)?\r\n(Same comment for `SocketEvents()` below, and also in `net.h`.)",
      "created_at": "2021-10-13T21:52:35Z",
      "updated_at": "2021-10-14T16:57:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r728473929",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/728473929"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1334,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/728483006",
      "pull_request_review_id": 779123140,
      "id": 728483006,
      "node_id": "PRRC_kwDOABII584ra8S-",
      "diff_hunk": "@@ -1257,6 +1276,40 @@ class CConnman\n      */\n     std::vector<CService> m_onion_binds;\n \n+    /**\n+     * RAII helper to atomically create a copy of `vNodes` and add a reference\n+     * to each of the nodes. The nodes are released when this object is destroyed.\n+     */\n+    class NodesSnapshot\n+    {\n+    public:\n+        explicit NodesSnapshot(const CConnman& connman) : m_connman{connman}\n+        {\n+            LOCK(m_connman.cs_vNodes);\n+            m_nodes_copy = m_connman.vNodes;\n+            for (auto& node : m_nodes_copy) {\n+                node->AddRef();\n+            }\n+        }\n+\n+        ~NodesSnapshot()\n+        {\n+            LOCK(m_connman.cs_vNodes);\n+            for (auto& node : m_nodes_copy) {\n+                node->Release();",
      "path": "src/net.h",
      "position": 88,
      "original_position": 54,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "92f62d9ea43c6861409916256a403417d80c0932",
      "in_reply_to_id": 632974904,
      "user": {
        "login": "LarryRuane",
        "id": 8321330,
        "node_id": "MDQ6VXNlcjgzMjEzMzA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8321330?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/LarryRuane",
        "html_url": "https://github.com/LarryRuane",
        "followers_url": "https://api.github.com/users/LarryRuane/followers",
        "following_url": "https://api.github.com/users/LarryRuane/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/LarryRuane/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/LarryRuane/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/LarryRuane/subscriptions",
        "organizations_url": "https://api.github.com/users/LarryRuane/orgs",
        "repos_url": "https://api.github.com/users/LarryRuane/repos",
        "events_url": "https://api.github.com/users/LarryRuane/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/LarryRuane/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Perhaps beyond the scope of this PR, but it may be better if [`Release()`](https://github.com/bitcoin/bitcoin/blob/71a85fbd09b5a450edc53a8ba4131f32e7136ca7/src/net.h#L630) asserted that the count is valid:\r\n```\r\nvoid Release()\r\n{\r\n    assert(nRefCount > 0);\r\n    nRefCount--;\r\n}\r\n```\r\nThe count validity is asserted in `GetRefCount()` but it would be better to catch the malefactor in the act :).",
      "created_at": "2021-10-13T22:10:01Z",
      "updated_at": "2021-10-14T16:57:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r728483006",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/728483006"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1252,
      "original_line": 1252,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/729167321",
      "pull_request_review_id": 779123140,
      "id": 729167321,
      "node_id": "PRRC_kwDOABII584rdjXZ",
      "diff_hunk": "@@ -1177,6 +1196,44 @@ class CConnman\n      */\n     std::vector<CService> m_onion_binds;\n \n+    /**\n+     * RAII helper to atomically create a copy of `vNodes` and add a reference\n+     * to each of the nodes. The nodes are released when this object is destroyed.\n+     */\n+    class NodesSnapshot\n+    {\n+    public:\n+        explicit NodesSnapshot(const CConnman& connman, bool shuffle)\n+        {\n+            {\n+                LOCK(connman.cs_vNodes);\n+                m_nodes_copy = connman.vNodes;\n+                for (auto& node : m_nodes_copy) {\n+                    node->AddRef();\n+                }\n+            }\n+            if (shuffle) {\n+                FastRandomContext rng;\n+                Shuffle(m_nodes_copy.begin(), m_nodes_copy.end(), rng);\n+            }\n+        }",
      "path": "src/net.h",
      "position": null,
      "original_position": 54,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "99c1af5a8f95051e98ad4b9486eef70919ab2708",
      "in_reply_to_id": null,
      "user": {
        "login": "LarryRuane",
        "id": 8321330,
        "node_id": "MDQ6VXNlcjgzMjEzMzA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8321330?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/LarryRuane",
        "html_url": "https://github.com/LarryRuane",
        "followers_url": "https://api.github.com/users/LarryRuane/followers",
        "following_url": "https://api.github.com/users/LarryRuane/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/LarryRuane/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/LarryRuane/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/LarryRuane/subscriptions",
        "organizations_url": "https://api.github.com/users/LarryRuane/orgs",
        "repos_url": "https://api.github.com/users/LarryRuane/repos",
        "events_url": "https://api.github.com/users/LarryRuane/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/LarryRuane/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I would do this a little differently:\r\n```\r\nNodesSnapshot(const CConnman& connman)\r\n{\r\n    LOCK(connman.cs_vNodes);\r\n    m_nodes_copy = connman.vNodes;\r\n    for (auto& node : m_nodes_copy) {\r\n        node->AddRef();\r\n    }\r\n}\r\nstd::vector<CNode*>& Shuffle() {\r\n    FastRandomContext rng;\r\n    ::Shuffle(m_nodes_copy.begin(), m_nodes_copy.end(), rng);\r\n    return m_nodes_copy;\r\n}\r\n```",
      "created_at": "2021-10-14T16:48:48Z",
      "updated_at": "2021-10-14T18:15:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r729167321",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/729167321"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": 1206,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1247,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/729170603",
      "pull_request_review_id": 779123140,
      "id": 729170603,
      "node_id": "PRRC_kwDOABII584rdkKr",
      "diff_hunk": "@@ -1498,13 +1494,21 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n+    const NodesSnapshot snap{*this, /*shuffle=*/false};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 105,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "99c1af5a8f95051e98ad4b9486eef70919ab2708",
      "in_reply_to_id": null,
      "user": {
        "login": "LarryRuane",
        "id": 8321330,
        "node_id": "MDQ6VXNlcjgzMjEzMzA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8321330?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/LarryRuane",
        "html_url": "https://github.com/LarryRuane",
        "followers_url": "https://api.github.com/users/LarryRuane/followers",
        "following_url": "https://api.github.com/users/LarryRuane/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/LarryRuane/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/LarryRuane/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/LarryRuane/subscriptions",
        "organizations_url": "https://api.github.com/users/LarryRuane/orgs",
        "repos_url": "https://api.github.com/users/LarryRuane/repos",
        "events_url": "https://api.github.com/users/LarryRuane/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/LarryRuane/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Suggestion, this may be a little more elegant than the boolean shuffle argument (see suggested changes to `NodesSnapshot`)\r\n```suggestion\r\n    const NodesSnapshot snap{*this};\r\n```",
      "created_at": "2021-10-14T16:53:01Z",
      "updated_at": "2021-10-14T16:57:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r729170603",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/729170603"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1497,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/730243473",
      "pull_request_review_id": 781348101,
      "id": 730243473,
      "node_id": "PRRC_kwDOABII584rhqGR",
      "diff_hunk": "@@ -1498,13 +1494,21 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n+    const NodesSnapshot snap{*this, /*shuffle=*/false};\n+\n     std::set<SOCKET> recv_set, send_set, error_set;\n-    SocketEvents(recv_set, send_set, error_set);\n+    SocketEvents(snap.Nodes(), recv_set, send_set, error_set);\n \n     if (interruptNet) return;\n \n     //\n-    // Accept new connections\n+    // Accept new connections. Done after taking a snapshot of the nodes because",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 115,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "99c1af5a8f95051e98ad4b9486eef70919ab2708",
      "in_reply_to_id": 725079584,
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yup, what @jnewbery says makes sense to me as I previously stumbled on the same thing. I'd prefer to review that refactor in a follow-up but am also happy to review here.",
      "created_at": "2021-10-16T10:19:27Z",
      "updated_at": "2021-10-16T10:19:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r730243473",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/730243473"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1505,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/736268482",
      "pull_request_review_id": 789009361,
      "id": 736268482,
      "node_id": "PRRC_kwDOABII584r4pDC",
      "diff_hunk": "@@ -1467,8 +1467,6 @@ void CConnman::SocketHandler()\n         }\n     }\n \n-    NodesSnapshot snap{*this};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 61,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "157674ef213e6329215d1b7eb85dacbc23c468db",
      "in_reply_to_id": 632150326,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This was changed, see https://github.com/bitcoin/bitcoin/pull/21943#issuecomment-951672368",
      "created_at": "2021-10-26T08:11:16Z",
      "updated_at": "2021-10-26T08:11:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r736268482",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/736268482"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1470,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/736278978",
      "pull_request_review_id": 789024606,
      "id": 736278978,
      "node_id": "PRRC_kwDOABII584r4rnC",
      "diff_hunk": "@@ -1498,13 +1494,21 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n+    const NodesSnapshot snap{*this, /*shuffle=*/false};\n+\n     std::set<SOCKET> recv_set, send_set, error_set;\n-    SocketEvents(recv_set, send_set, error_set);\n+    SocketEvents(snap.Nodes(), recv_set, send_set, error_set);\n \n     if (interruptNet) return;\n \n     //\n-    // Accept new connections\n+    // Accept new connections. Done after taking a snapshot of the nodes because",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 115,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "99c1af5a8f95051e98ad4b9486eef70919ab2708",
      "in_reply_to_id": 725079584,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I split the accepting of the new connections into its own method, that is independent of `CConnMan::SocketHandler()`, does its own socket polling and can be called independently from `CConnMan::SocketHandler()`. However after doing that, the following realization dawned on me (tldr: I ditched that):\r\n\r\n:bulb: We don't want to wait separately for incoming connections because that event is \"rare\", meaning most of the time we would just sleep for some time until `poll(2)` times out, signaling no socket is ready for IO (no new incoming connections). This would have an adverse effect on the throughput - even on busy nodes that constantly have incoming/outgoing data, we would needlessly sleep for a short while, frequently.\r\n\r\nSo, we want to `poll(2)` the already connected sockets and the listening ones together, in one `poll(2)` call.\r\n\r\nI made some changes to `CConnMan::SocketHander()` to (hopefully) make it easier to read, see https://github.com/bitcoin/bitcoin/pull/21943#issuecomment-951672368",
      "created_at": "2021-10-26T08:23:44Z",
      "updated_at": "2021-10-26T08:23:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r736278978",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/736278978"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1505,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/736283980",
      "pull_request_review_id": 789031243,
      "id": 736283980,
      "node_id": "PRRC_kwDOABII584r4s1M",
      "diff_hunk": "@@ -1177,6 +1196,44 @@ class CConnman\n      */\n     std::vector<CService> m_onion_binds;\n \n+    /**\n+     * RAII helper to atomically create a copy of `vNodes` and add a reference\n+     * to each of the nodes. The nodes are released when this object is destroyed.\n+     */\n+    class NodesSnapshot\n+    {\n+    public:\n+        explicit NodesSnapshot(const CConnman& connman, bool shuffle)\n+        {\n+            {\n+                LOCK(connman.cs_vNodes);\n+                m_nodes_copy = connman.vNodes;\n+                for (auto& node : m_nodes_copy) {\n+                    node->AddRef();\n+                }\n+            }\n+            if (shuffle) {\n+                FastRandomContext rng;\n+                Shuffle(m_nodes_copy.begin(), m_nodes_copy.end(), rng);\n+            }\n+        }",
      "path": "src/net.h",
      "position": null,
      "original_position": 54,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "99c1af5a8f95051e98ad4b9486eef70919ab2708",
      "in_reply_to_id": 729167321,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This would require an extra call to `Shuffle()` right after construction. I don't see the benefit of it. It would require the snapshot variable to be non-`const`.",
      "created_at": "2021-10-26T08:29:24Z",
      "updated_at": "2021-10-26T08:29:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r736283980",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/736283980"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": 1206,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1247,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/736287423",
      "pull_request_review_id": 789035914,
      "id": 736287423,
      "node_id": "PRRC_kwDOABII584r4tq_",
      "diff_hunk": "@@ -1498,13 +1494,21 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n+    const NodesSnapshot snap{*this, /*shuffle=*/false};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 105,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "99c1af5a8f95051e98ad4b9486eef70919ab2708",
      "in_reply_to_id": 729170603,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think it is ok as it is now. We are not frowning upon boolean arguments, are we? If the boolean argument looks too bad, then a 2-value enum can be introduced so call sites look like:\r\n```cpp\r\nconst NodesSnapshot snap{*this, NodesSnapshot::SHUFFLE};\r\n// or\r\nconst NodesSnapshot snap{*this, NodesSnapshot::NO_SHUFFLE};\r\n```\r\nbut I think this would be an overkill.",
      "created_at": "2021-10-26T08:33:30Z",
      "updated_at": "2021-10-26T08:33:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r736287423",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/736287423"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1497,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/738379450",
      "pull_request_review_id": 791851693,
      "id": 738379450,
      "node_id": "PRRC_kwDOABII584sAsa6",
      "diff_hunk": "@@ -1495,28 +1495,33 @@ void CConnman::SocketEvents(const std::vector<CNode*>& nodes, std::set<SOCKET> &\n \n void CConnman::SocketHandler()\n {\n-    const NodesSnapshot snap{*this, /*shuffle=*/false};\n+    std::set<SOCKET> recv_set;\n+    std::set<SOCKET> send_set;\n+    std::set<SOCKET> error_set;\n \n-    std::set<SOCKET> recv_set, send_set, error_set;\n-    SocketEvents(snap.Nodes(), recv_set, send_set, error_set);\n+    {\n+        const NodesSnapshot snap{*this, /*shuffle=*/false};\n \n-    if (interruptNet) return;\n+        // Check for readiness the already connected sockets and the listening sockets\n+        // in one call. If none is ready, wait for a short while and return empty sets.\n+        SocketEvents(snap.Nodes(), recv_set, send_set, error_set);\n \n-    //\n-    // Accept new connections\n-    //\n-    for (const ListenSocket& hListenSocket : vhListenSocket)\n-    {\n-        if (hListenSocket.socket != INVALID_SOCKET && recv_set.count(hListenSocket.socket) > 0)\n-        {\n-            AcceptConnection(hListenSocket);\n+        if (interruptNet) {",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 27,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "3c8fcb94691584871edaa1a142bfa0ebadc01d67",
      "in_reply_to_id": null,
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "3c8fcb94691584871edaa1a142bfa0ebadc01d67\r\n\r\nI think you can ditch this?",
      "created_at": "2021-10-28T13:16:41Z",
      "updated_at": "2021-10-28T13:21:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r738379450",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/738379450"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1509,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/746951383",
      "pull_request_review_id": 803098736,
      "id": 746951383,
      "node_id": "PRRC_kwDOABII584shZLX",
      "diff_hunk": "@@ -1498,13 +1494,21 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n+    const NodesSnapshot snap{*this, /*shuffle=*/false};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 105,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "99c1af5a8f95051e98ad4b9486eef70919ab2708",
      "in_reply_to_id": 729170603,
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think with the named argument this is fine.",
      "created_at": "2021-11-10T20:12:51Z",
      "updated_at": "2021-11-10T20:12:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r746951383",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/746951383"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1497,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/747639993",
      "pull_request_review_id": 803984837,
      "id": 747639993,
      "node_id": "PRRC_kwDOABII584skBS5",
      "diff_hunk": "@@ -1495,28 +1495,33 @@ void CConnman::SocketEvents(const std::vector<CNode*>& nodes, std::set<SOCKET> &\n \n void CConnman::SocketHandler()\n {\n-    const NodesSnapshot snap{*this, /*shuffle=*/false};\n+    std::set<SOCKET> recv_set;\n+    std::set<SOCKET> send_set;\n+    std::set<SOCKET> error_set;\n \n-    std::set<SOCKET> recv_set, send_set, error_set;\n-    SocketEvents(snap.Nodes(), recv_set, send_set, error_set);\n+    {\n+        const NodesSnapshot snap{*this, /*shuffle=*/false};\n \n-    if (interruptNet) return;\n+        // Check for readiness the already connected sockets and the listening sockets\n+        // in one call. If none is ready, wait for a short while and return empty sets.\n+        SocketEvents(snap.Nodes(), recv_set, send_set, error_set);\n \n-    //\n-    // Accept new connections\n-    //\n-    for (const ListenSocket& hListenSocket : vhListenSocket)\n-    {\n-        if (hListenSocket.socket != INVALID_SOCKET && recv_set.count(hListenSocket.socket) > 0)\n-        {\n-            AcceptConnection(hListenSocket);\n+        if (interruptNet) {",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 27,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "3c8fcb94691584871edaa1a142bfa0ebadc01d67",
      "in_reply_to_id": 738379450,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "You are right - the surrounding `SocketEvents()` and `SocketHandlerConnected()` both contain a similar check and would quit \"quickly\" if `interruptNet` becomes true.\r\n\r\nMaybe the newly added `SocketHandlerListening()` deserves such a check too, once per each listening socket to be processed?",
      "created_at": "2021-11-11T16:21:32Z",
      "updated_at": "2021-11-11T16:21:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r747639993",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/747639993"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1509,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/747642620",
      "pull_request_review_id": 803988240,
      "id": 747642620,
      "node_id": "PRRC_kwDOABII584skB78",
      "diff_hunk": "@@ -1495,28 +1495,33 @@ void CConnman::SocketEvents(const std::vector<CNode*>& nodes, std::set<SOCKET> &\n \n void CConnman::SocketHandler()\n {\n-    const NodesSnapshot snap{*this, /*shuffle=*/false};\n+    std::set<SOCKET> recv_set;\n+    std::set<SOCKET> send_set;\n+    std::set<SOCKET> error_set;\n \n-    std::set<SOCKET> recv_set, send_set, error_set;\n-    SocketEvents(snap.Nodes(), recv_set, send_set, error_set);\n+    {\n+        const NodesSnapshot snap{*this, /*shuffle=*/false};\n \n-    if (interruptNet) return;\n+        // Check for readiness the already connected sockets and the listening sockets\n+        // in one call. If none is ready, wait for a short while and return empty sets.\n+        SocketEvents(snap.Nodes(), recv_set, send_set, error_set);\n \n-    //\n-    // Accept new connections\n-    //\n-    for (const ListenSocket& hListenSocket : vhListenSocket)\n-    {\n-        if (hListenSocket.socket != INVALID_SOCKET && recv_set.count(hListenSocket.socket) > 0)\n-        {\n-            AcceptConnection(hListenSocket);\n+        if (interruptNet) {",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 27,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "3c8fcb94691584871edaa1a142bfa0ebadc01d67",
      "in_reply_to_id": 738379450,
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yes, doesn't hurt I guess.",
      "created_at": "2021-11-11T16:24:54Z",
      "updated_at": "2021-11-11T16:24:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r747642620",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/747642620"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1509,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748117765",
      "pull_request_review_id": 804595561,
      "id": 748117765,
      "node_id": "PRRC_kwDOABII584sl18F",
      "diff_hunk": "@@ -1495,28 +1495,33 @@ void CConnman::SocketEvents(const std::vector<CNode*>& nodes, std::set<SOCKET> &\n \n void CConnman::SocketHandler()\n {\n-    const NodesSnapshot snap{*this, /*shuffle=*/false};\n+    std::set<SOCKET> recv_set;\n+    std::set<SOCKET> send_set;\n+    std::set<SOCKET> error_set;\n \n-    std::set<SOCKET> recv_set, send_set, error_set;\n-    SocketEvents(snap.Nodes(), recv_set, send_set, error_set);\n+    {\n+        const NodesSnapshot snap{*this, /*shuffle=*/false};\n \n-    if (interruptNet) return;\n+        // Check for readiness the already connected sockets and the listening sockets\n+        // in one call. If none is ready, wait for a short while and return empty sets.\n+        SocketEvents(snap.Nodes(), recv_set, send_set, error_set);\n \n-    //\n-    // Accept new connections\n-    //\n-    for (const ListenSocket& hListenSocket : vhListenSocket)\n-    {\n-        if (hListenSocket.socket != INVALID_SOCKET && recv_set.count(hListenSocket.socket) > 0)\n-        {\n-            AcceptConnection(hListenSocket);\n+        if (interruptNet) {",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 27,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "3c8fcb94691584871edaa1a142bfa0ebadc01d67",
      "in_reply_to_id": 738379450,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2021-11-12T09:54:27Z",
      "updated_at": "2021-11-12T09:54:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r748117765",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748117765"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1509,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748339454",
      "pull_request_review_id": 804875630,
      "id": 748339454,
      "node_id": "PRRC_kwDOABII584smsD-",
      "diff_hunk": "@@ -1497,34 +1493,29 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n-    std::set<SOCKET> recv_set, send_set, error_set;\n-    SocketEvents(recv_set, send_set, error_set);\n-\n-    if (interruptNet) return;\n+    std::set<SOCKET> recv_set;\n+    std::set<SOCKET> send_set;\n+    std::set<SOCKET> error_set;\n \n-    //\n-    // Accept new connections\n-    //\n-    for (const ListenSocket& hListenSocket : vhListenSocket)\n     {\n-        if (hListenSocket.socket != INVALID_SOCKET && recv_set.count(hListenSocket.socket) > 0)\n-        {\n-            AcceptConnection(hListenSocket);\n-        }\n-    }\n+        const NodesSnapshot snap{*this, /*shuffle=*/false};\n \n-    //\n-    // Service each socket\n-    //\n-    std::vector<CNode*> vNodesCopy;\n-    {\n-        LOCK(cs_vNodes);\n-        vNodesCopy = vNodes;\n-        for (CNode* pnode : vNodesCopy)\n-            pnode->AddRef();\n+        // Check for readiness the already connected sockets and the listening sockets",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 134,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "db0a01e0d1ab4462b70a44c255c602ea074b96ef",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "4097d14 `s/readiness/the readiness of/` ? Perhaps also clarify \"ready\". Also `s/none is/none are/`.",
      "created_at": "2021-11-12T14:40:58Z",
      "updated_at": "2021-11-17T12:44:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r748339454",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748339454"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1503,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748343811",
      "pull_request_review_id": 804875630,
      "id": 748343811,
      "node_id": "PRRC_kwDOABII584smtID",
      "diff_hunk": "@@ -1497,34 +1493,29 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n-    std::set<SOCKET> recv_set, send_set, error_set;\n-    SocketEvents(recv_set, send_set, error_set);\n-\n-    if (interruptNet) return;\n+    std::set<SOCKET> recv_set;\n+    std::set<SOCKET> send_set;\n+    std::set<SOCKET> error_set;\n \n-    //\n-    // Accept new connections\n-    //\n-    for (const ListenSocket& hListenSocket : vhListenSocket)\n     {\n-        if (hListenSocket.socket != INVALID_SOCKET && recv_set.count(hListenSocket.socket) > 0)\n-        {\n-            AcceptConnection(hListenSocket);\n-        }\n-    }\n+        const NodesSnapshot snap{*this, /*shuffle=*/false};",
      "path": "src/net.cpp",
      "position": 132,
      "original_position": 123,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "db0a01e0d1ab4462b70a44c255c602ea074b96ef",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "9ca6dac0 naming nit: \"snap\" is a verb similar to \"break\"; if you retouch, `s/snap/snapshot/` would be clearer",
      "created_at": "2021-11-12T14:46:37Z",
      "updated_at": "2021-11-17T12:44:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r748343811",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748343811"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1510,
      "original_line": 1510,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/751165699",
      "pull_request_review_id": 804875630,
      "id": 751165699,
      "node_id": "PRRC_kwDOABII584sxeED",
      "diff_hunk": "@@ -1177,6 +1219,44 @@ class CConnman\n      */\n     std::vector<CService> m_onion_binds;\n \n+    /**\n+     * RAII helper to atomically create a copy of `vNodes` and add a reference\n+     * to each of the nodes. The nodes are released when this object is destroyed.\n+     */\n+    class NodesSnapshot\n+    {\n+    public:\n+        explicit NodesSnapshot(const CConnman& connman, bool shuffle)\n+        {\n+            {\n+                LOCK(connman.cs_vNodes);\n+                m_nodes_copy = connman.vNodes;\n+                for (auto& node : m_nodes_copy) {\n+                    node->AddRef();\n+                }\n+            }\n+            if (shuffle) {\n+                FastRandomContext rng;\n+                Shuffle(m_nodes_copy.begin(), m_nodes_copy.end(), rng);",
      "path": "src/net.h",
      "position": null,
      "original_position": 76,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "db0a01e0d1ab4462b70a44c255c602ea074b96ef",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "9ca6dac0 can omit localvar `rng`\r\n```diff\r\n             if (shuffle) {\r\n-                FastRandomContext rng;\r\n-                Shuffle(m_nodes_copy.begin(), m_nodes_copy.end(), rng);\r\n+                Shuffle(m_nodes_copy.begin(), m_nodes_copy.end(), FastRandomContext());\r\n             }\r\n```\r\n",
      "created_at": "2021-11-17T11:50:21Z",
      "updated_at": "2021-11-17T12:44:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r751165699",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/751165699"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1240,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/751179588",
      "pull_request_review_id": 804875630,
      "id": 751179588,
      "node_id": "PRRC_kwDOABII584sxhdE",
      "diff_hunk": "@@ -1497,34 +1493,29 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n-    std::set<SOCKET> recv_set, send_set, error_set;\n-    SocketEvents(recv_set, send_set, error_set);\n-\n-    if (interruptNet) return;\n+    std::set<SOCKET> recv_set;\n+    std::set<SOCKET> send_set;\n+    std::set<SOCKET> error_set;",
      "path": "src/net.cpp",
      "position": 120,
      "original_position": 111,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "db0a01e0d1ab4462b70a44c255c602ea074b96ef",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "4097d14 unneeded style change, would leave as-is (and as currently exists in both of the `SocketEvents()` functions)\r\n```diff\r\n-    std::set<SOCKET> recv_set;\r\n-    std::set<SOCKET> send_set;\r\n-    std::set<SOCKET> error_set;\r\n-\r\n+    std::set<SOCKET> recv_set, send_set, error_set;\r\n```\r\n",
      "created_at": "2021-11-17T12:10:10Z",
      "updated_at": "2021-11-17T12:44:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r751179588",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/751179588"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1507,
      "original_line": 1507,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/751190044",
      "pull_request_review_id": 804875630,
      "id": 751190044,
      "node_id": "PRRC_kwDOABII584sxkAc",
      "diff_hunk": "@@ -1497,34 +1493,29 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n-    std::set<SOCKET> recv_set, send_set, error_set;\n-    SocketEvents(recv_set, send_set, error_set);\n-\n-    if (interruptNet) return;\n+    std::set<SOCKET> recv_set;\n+    std::set<SOCKET> send_set;\n+    std::set<SOCKET> error_set;\n \n-    //\n-    // Accept new connections\n-    //\n-    for (const ListenSocket& hListenSocket : vhListenSocket)\n     {\n-        if (hListenSocket.socket != INVALID_SOCKET && recv_set.count(hListenSocket.socket) > 0)\n-        {\n-            AcceptConnection(hListenSocket);\n-        }\n-    }\n+        const NodesSnapshot snap{*this, /*shuffle=*/false};\n \n-    //\n-    // Service each socket\n-    //\n-    std::vector<CNode*> vNodesCopy;\n-    {\n-        LOCK(cs_vNodes);\n-        vNodesCopy = vNodes;\n-        for (CNode* pnode : vNodesCopy)\n-            pnode->AddRef();\n+        // Check for readiness the already connected sockets and the listening sockets\n+        // in one call. If none is ready, wait for a short while and return empty sets.\n+        SocketEvents(snap.Nodes(), recv_set, send_set, error_set);\n+\n+        SocketHandlerConnected(snap.Nodes(), recv_set, send_set, error_set);",
      "path": "src/net.cpp",
      "position": 150,
      "original_position": 138,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "db0a01e0d1ab4462b70a44c255c602ea074b96ef",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "4097d14 found these comments helpful, would keep\r\n```diff\r\n+        // Service each socket\r\n         SocketHandlerConnected(snap.Nodes(), recv_set, send_set, error_set);\r\n     }\r\n \r\n+    // Accept new connections\r\n     SocketHandlerListening(recv_set);\r\n```\r\n",
      "created_at": "2021-11-17T12:24:40Z",
      "updated_at": "2021-11-17T12:44:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r751190044",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/751190044"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1519,
      "original_line": 1519,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/751192944",
      "pull_request_review_id": 804875630,
      "id": 751192944,
      "node_id": "PRRC_kwDOABII584sxktw",
      "diff_hunk": "@@ -983,9 +983,51 @@ class CConnman\n     void NotifyNumConnectionsChanged();\n     /** Return true if the peer is inactive and should be disconnected. */\n     bool InactivityCheck(const CNode& node) const;\n-    bool GenerateSelectSet(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_set, std::set<SOCKET> &error_set);\n-    void SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_set, std::set<SOCKET> &error_set);\n+\n+    /**\n+     * Generate a collection of sockets to check for IO readiness.\n+     * @param[in] nodes Select from these nodes' sockets.\n+     * @param[out] recv_set Sockets to check for read readiness.\n+     * @param[out] send_set Sockets to check for write readiness.\n+     * @param[out] error_set Sockets to check for errors.\n+     * @return true if at least one socket is to be checked (the returned set is not empty)\n+     */\n+    bool GenerateSelectSet(const std::vector<CNode*>& nodes, std::set<SOCKET> &recv_set, std::set<SOCKET> &send_set, std::set<SOCKET> &error_set);\n+\n+    /**\n+     * Check which sockets are ready for IO.\n+     * @param[in] nodes Select from these nodes' sockets.\n+     * @param[out] recv_set Sockets which are ready for read.\n+     * @param[out] send_set Sockets which are ready for write.\n+     * @param[out] error_set Sockets which have errors.\n+     * This calls `GenerateSelectSet()` to gather a list of sockets to check.\n+     */\n+    void SocketEvents(const std::vector<CNode*>& nodes, std::set<SOCKET> &recv_set, std::set<SOCKET> &send_set, std::set<SOCKET> &error_set);\n+\n+    /**\n+     * Check connected and listening sockets for IO readiness and process them accordingly.\n+     */\n     void SocketHandler();\n+\n+    /**\n+     * Do the read/write for connected sockets that are ready for IO.\n+     * @param[in] nodes Nodes to process. The socket of each node is checked against\n+     * `recv_set`, `send_set` and `error_set`.\n+     * @param[in] recv_set Sockets that are ready for read.\n+     * @param[in] send_set Sockets that are ready for send.\n+     * @param[in] error_set Sockets that have an exceptional condition (error).\n+     */\n+    void SocketHandlerConnected(const std::vector<CNode*>& nodes,\n+                                const std::set<SOCKET>& recv_set,\n+                                const std::set<SOCKET>& send_set,\n+                                const std::set<SOCKET>& error_set);\n+\n+    /**\n+     * Accept an incoming connection from listening sockets that are ready for read.",
      "path": "src/net.h",
      "position": null,
      "original_position": 46,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "db0a01e0d1ab4462b70a44c255c602ea074b96ef",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "4097d14 the existing \"Accept incoming connections\" comment is an easier-to-understand description for me than this one. \r\n\r\nMaybe:\r\n```suggestion\r\n     * Accept incoming connections, i.e. one from each read-ready listening socket.\r\n```",
      "created_at": "2021-11-17T12:28:39Z",
      "updated_at": "2021-11-17T12:44:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r751192944",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/751192944"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1026,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/752203361",
      "pull_request_review_id": 809869717,
      "id": 752203361,
      "node_id": "PRRC_kwDOABII584s1bZh",
      "diff_hunk": "@@ -983,9 +983,51 @@ class CConnman\n     void NotifyNumConnectionsChanged();\n     /** Return true if the peer is inactive and should be disconnected. */\n     bool InactivityCheck(const CNode& node) const;\n-    bool GenerateSelectSet(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_set, std::set<SOCKET> &error_set);\n-    void SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_set, std::set<SOCKET> &error_set);\n+\n+    /**\n+     * Generate a collection of sockets to check for IO readiness.\n+     * @param[in] nodes Select from these nodes' sockets.\n+     * @param[out] recv_set Sockets to check for read readiness.\n+     * @param[out] send_set Sockets to check for write readiness.\n+     * @param[out] error_set Sockets to check for errors.\n+     * @return true if at least one socket is to be checked (the returned set is not empty)\n+     */\n+    bool GenerateSelectSet(const std::vector<CNode*>& nodes, std::set<SOCKET> &recv_set, std::set<SOCKET> &send_set, std::set<SOCKET> &error_set);\n+\n+    /**\n+     * Check which sockets are ready for IO.\n+     * @param[in] nodes Select from these nodes' sockets.\n+     * @param[out] recv_set Sockets which are ready for read.\n+     * @param[out] send_set Sockets which are ready for write.\n+     * @param[out] error_set Sockets which have errors.\n+     * This calls `GenerateSelectSet()` to gather a list of sockets to check.\n+     */\n+    void SocketEvents(const std::vector<CNode*>& nodes, std::set<SOCKET> &recv_set, std::set<SOCKET> &send_set, std::set<SOCKET> &error_set);\n+\n+    /**\n+     * Check connected and listening sockets for IO readiness and process them accordingly.\n+     */\n     void SocketHandler();\n+\n+    /**\n+     * Do the read/write for connected sockets that are ready for IO.\n+     * @param[in] nodes Nodes to process. The socket of each node is checked against\n+     * `recv_set`, `send_set` and `error_set`.\n+     * @param[in] recv_set Sockets that are ready for read.\n+     * @param[in] send_set Sockets that are ready for send.\n+     * @param[in] error_set Sockets that have an exceptional condition (error).\n+     */\n+    void SocketHandlerConnected(const std::vector<CNode*>& nodes,\n+                                const std::set<SOCKET>& recv_set,\n+                                const std::set<SOCKET>& send_set,\n+                                const std::set<SOCKET>& error_set);\n+\n+    /**\n+     * Accept an incoming connection from listening sockets that are ready for read.",
      "path": "src/net.h",
      "position": null,
      "original_position": 46,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "db0a01e0d1ab4462b70a44c255c602ea074b96ef",
      "in_reply_to_id": 751192944,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2021-11-18T12:41:58Z",
      "updated_at": "2021-11-18T12:41:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r752203361",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/752203361"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1026,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/752203519",
      "pull_request_review_id": 809869935,
      "id": 752203519,
      "node_id": "PRRC_kwDOABII584s1bb_",
      "diff_hunk": "@@ -1497,34 +1493,29 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n-    std::set<SOCKET> recv_set, send_set, error_set;\n-    SocketEvents(recv_set, send_set, error_set);\n-\n-    if (interruptNet) return;\n+    std::set<SOCKET> recv_set;\n+    std::set<SOCKET> send_set;\n+    std::set<SOCKET> error_set;\n \n-    //\n-    // Accept new connections\n-    //\n-    for (const ListenSocket& hListenSocket : vhListenSocket)\n     {\n-        if (hListenSocket.socket != INVALID_SOCKET && recv_set.count(hListenSocket.socket) > 0)\n-        {\n-            AcceptConnection(hListenSocket);\n-        }\n-    }\n+        const NodesSnapshot snap{*this, /*shuffle=*/false};\n \n-    //\n-    // Service each socket\n-    //\n-    std::vector<CNode*> vNodesCopy;\n-    {\n-        LOCK(cs_vNodes);\n-        vNodesCopy = vNodes;\n-        for (CNode* pnode : vNodesCopy)\n-            pnode->AddRef();\n+        // Check for readiness the already connected sockets and the listening sockets\n+        // in one call. If none is ready, wait for a short while and return empty sets.\n+        SocketEvents(snap.Nodes(), recv_set, send_set, error_set);\n+\n+        SocketHandlerConnected(snap.Nodes(), recv_set, send_set, error_set);",
      "path": "src/net.cpp",
      "position": 150,
      "original_position": 138,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "db0a01e0d1ab4462b70a44c255c602ea074b96ef",
      "in_reply_to_id": 751190044,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2021-11-18T12:42:09Z",
      "updated_at": "2021-11-18T12:42:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r752203519",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/752203519"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1519,
      "original_line": 1519,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/752205516",
      "pull_request_review_id": 809872731,
      "id": 752205516,
      "node_id": "PRRC_kwDOABII584s1b7M",
      "diff_hunk": "@@ -1497,34 +1493,29 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n-    std::set<SOCKET> recv_set, send_set, error_set;\n-    SocketEvents(recv_set, send_set, error_set);\n-\n-    if (interruptNet) return;\n+    std::set<SOCKET> recv_set;\n+    std::set<SOCKET> send_set;\n+    std::set<SOCKET> error_set;",
      "path": "src/net.cpp",
      "position": 120,
      "original_position": 111,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "db0a01e0d1ab4462b70a44c255c602ea074b96ef",
      "in_reply_to_id": 751179588,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think it is good to always declare one variable per line.",
      "created_at": "2021-11-18T12:44:55Z",
      "updated_at": "2021-11-18T12:44:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r752205516",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/752205516"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1507,
      "original_line": 1507,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/752205608",
      "pull_request_review_id": 809872873,
      "id": 752205608,
      "node_id": "PRRC_kwDOABII584s1b8o",
      "diff_hunk": "@@ -1177,6 +1219,44 @@ class CConnman\n      */\n     std::vector<CService> m_onion_binds;\n \n+    /**\n+     * RAII helper to atomically create a copy of `vNodes` and add a reference\n+     * to each of the nodes. The nodes are released when this object is destroyed.\n+     */\n+    class NodesSnapshot\n+    {\n+    public:\n+        explicit NodesSnapshot(const CConnman& connman, bool shuffle)\n+        {\n+            {\n+                LOCK(connman.cs_vNodes);\n+                m_nodes_copy = connman.vNodes;\n+                for (auto& node : m_nodes_copy) {\n+                    node->AddRef();\n+                }\n+            }\n+            if (shuffle) {\n+                FastRandomContext rng;\n+                Shuffle(m_nodes_copy.begin(), m_nodes_copy.end(), rng);",
      "path": "src/net.h",
      "position": null,
      "original_position": 76,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "db0a01e0d1ab4462b70a44c255c602ea074b96ef",
      "in_reply_to_id": 751165699,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2021-11-18T12:45:04Z",
      "updated_at": "2021-11-18T12:45:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r752205608",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/752205608"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1240,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/752207151",
      "pull_request_review_id": 809874982,
      "id": 752207151,
      "node_id": "PRRC_kwDOABII584s1cUv",
      "diff_hunk": "@@ -1497,34 +1493,29 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n-    std::set<SOCKET> recv_set, send_set, error_set;\n-    SocketEvents(recv_set, send_set, error_set);\n-\n-    if (interruptNet) return;\n+    std::set<SOCKET> recv_set;\n+    std::set<SOCKET> send_set;\n+    std::set<SOCKET> error_set;\n \n-    //\n-    // Accept new connections\n-    //\n-    for (const ListenSocket& hListenSocket : vhListenSocket)\n     {\n-        if (hListenSocket.socket != INVALID_SOCKET && recv_set.count(hListenSocket.socket) > 0)\n-        {\n-            AcceptConnection(hListenSocket);\n-        }\n-    }\n+        const NodesSnapshot snap{*this, /*shuffle=*/false};",
      "path": "src/net.cpp",
      "position": 132,
      "original_position": 123,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "db0a01e0d1ab4462b70a44c255c602ea074b96ef",
      "in_reply_to_id": 748343811,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`snap` is used as a short for `snapshot`, not in the \"verb\" sense. I have seen this elsewhere too. For example `zfs list -t snapshot` and `zfs list -t snap` both do the same thing.",
      "created_at": "2021-11-18T12:47:09Z",
      "updated_at": "2021-11-18T12:47:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r752207151",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/752207151"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1510,
      "original_line": 1510,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/752207254",
      "pull_request_review_id": 809875138,
      "id": 752207254,
      "node_id": "PRRC_kwDOABII584s1cWW",
      "diff_hunk": "@@ -1497,34 +1493,29 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n-    std::set<SOCKET> recv_set, send_set, error_set;\n-    SocketEvents(recv_set, send_set, error_set);\n-\n-    if (interruptNet) return;\n+    std::set<SOCKET> recv_set;\n+    std::set<SOCKET> send_set;\n+    std::set<SOCKET> error_set;\n \n-    //\n-    // Accept new connections\n-    //\n-    for (const ListenSocket& hListenSocket : vhListenSocket)\n     {\n-        if (hListenSocket.socket != INVALID_SOCKET && recv_set.count(hListenSocket.socket) > 0)\n-        {\n-            AcceptConnection(hListenSocket);\n-        }\n-    }\n+        const NodesSnapshot snap{*this, /*shuffle=*/false};\n \n-    //\n-    // Service each socket\n-    //\n-    std::vector<CNode*> vNodesCopy;\n-    {\n-        LOCK(cs_vNodes);\n-        vNodesCopy = vNodes;\n-        for (CNode* pnode : vNodesCopy)\n-            pnode->AddRef();\n+        // Check for readiness the already connected sockets and the listening sockets",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 134,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "db0a01e0d1ab4462b70a44c255c602ea074b96ef",
      "in_reply_to_id": 748339454,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2021-11-18T12:47:19Z",
      "updated_at": "2021-11-18T12:47:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r752207254",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/752207254"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1503,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/752209237",
      "pull_request_review_id": 809877988,
      "id": 752209237,
      "node_id": "PRRC_kwDOABII584s1c1V",
      "diff_hunk": "@@ -1332,57 +1332,53 @@ bool CConnman::InactivityCheck(const CNode& node) const\n     return false;\n }\n \n-bool CConnman::GenerateSelectSet(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_set, std::set<SOCKET> &error_set)\n+bool CConnman::GenerateSelectSet(const std::vector<CNode*>& nodes, std::set<SOCKET> &recv_set, std::set<SOCKET> &send_set, std::set<SOCKET> &error_set)",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "99c1af5a8f95051e98ad4b9486eef70919ab2708",
      "in_reply_to_id": 728473929,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Sometimes reviewers ask for minimal changes, without combining \"real\" changes with whitespace ones. So I refrained from running `clang-format` on this line. Done now.",
      "created_at": "2021-11-18T12:50:03Z",
      "updated_at": "2021-11-18T12:50:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r752209237",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/752209237"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1334,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/753523180",
      "pull_request_review_id": 811664007,
      "id": 753523180,
      "node_id": "PRRC_kwDOABII584s6dns",
      "diff_hunk": "@@ -1513,18 +1513,12 @@ void CConnman::SocketHandler()\n         }\n     }\n \n+    const NodesSnapshot snap{*this, /*shuffle=*/false};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "75e8bf55f5a014faada7712a9640dc35e8c86f15",
      "in_reply_to_id": null,
      "user": {
        "login": "LarryRuane",
        "id": 8321330,
        "node_id": "MDQ6VXNlcjgzMjEzMzA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8321330?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/LarryRuane",
        "html_url": "https://github.com/LarryRuane",
        "followers_url": "https://api.github.com/users/LarryRuane/followers",
        "following_url": "https://api.github.com/users/LarryRuane/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/LarryRuane/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/LarryRuane/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/LarryRuane/subscriptions",
        "organizations_url": "https://api.github.com/users/LarryRuane/orgs",
        "repos_url": "https://api.github.com/users/LarryRuane/repos",
        "events_url": "https://api.github.com/users/LarryRuane/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/LarryRuane/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I guess it's just me, but I still don't like this boolean (but I do agree with you that it's better than an `enum`). In general, I dislike making a decision at run time (in this case, the constructor evaluating the `shuffle` argument) that is actually being decided at compile (in this case, all the callers pass a constant bool for this argument), if possible (sometimes it's not).\r\n\r\nWhat do you think about always shuffling? Just make that part of the semantics of this object? Could there ever be any harm (other than a very slight performance hit)?",
      "created_at": "2021-11-19T20:48:49Z",
      "updated_at": "2021-11-19T21:26:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r753523180",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/753523180"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1516,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/753539733",
      "pull_request_review_id": 811664007,
      "id": 753539733,
      "node_id": "PRRC_kwDOABII584s6hqV",
      "diff_hunk": "@@ -1497,34 +1493,29 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n-    std::set<SOCKET> recv_set, send_set, error_set;\n-    SocketEvents(recv_set, send_set, error_set);\n-\n-    if (interruptNet) return;\n+    std::set<SOCKET> recv_set;\n+    std::set<SOCKET> send_set;\n+    std::set<SOCKET> error_set;",
      "path": "src/net.cpp",
      "position": 120,
      "original_position": 111,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "db0a01e0d1ab4462b70a44c255c602ea074b96ef",
      "in_reply_to_id": 751179588,
      "user": {
        "login": "LarryRuane",
        "id": 8321330,
        "node_id": "MDQ6VXNlcjgzMjEzMzA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8321330?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/LarryRuane",
        "html_url": "https://github.com/LarryRuane",
        "followers_url": "https://api.github.com/users/LarryRuane/followers",
        "following_url": "https://api.github.com/users/LarryRuane/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/LarryRuane/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/LarryRuane/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/LarryRuane/subscriptions",
        "organizations_url": "https://api.github.com/users/LarryRuane/orgs",
        "repos_url": "https://api.github.com/users/LarryRuane/repos",
        "events_url": "https://api.github.com/users/LarryRuane/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/LarryRuane/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Consider:\r\n```cpp\r\nstruct SocketSets {\r\n    std::set<SOCKET> recv;\r\n    std::set<SOCKET> send;\r\n    std::set<SOCKET> error;\r\n}\r\n```",
      "created_at": "2021-11-19T21:22:21Z",
      "updated_at": "2021-11-19T21:26:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r753539733",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/753539733"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1507,
      "original_line": 1507,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755105857",
      "pull_request_review_id": 813634796,
      "id": 755105857,
      "node_id": "PRRC_kwDOABII584tAgBB",
      "diff_hunk": "@@ -1497,34 +1493,29 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n-    std::set<SOCKET> recv_set, send_set, error_set;\n-    SocketEvents(recv_set, send_set, error_set);\n-\n-    if (interruptNet) return;\n+    std::set<SOCKET> recv_set;\n+    std::set<SOCKET> send_set;\n+    std::set<SOCKET> error_set;",
      "path": "src/net.cpp",
      "position": 120,
      "original_position": 111,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "db0a01e0d1ab4462b70a44c255c602ea074b96ef",
      "in_reply_to_id": 751179588,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@LarryRuane, something like this is coming as a subsequent change from https://github.com/bitcoin/bitcoin/pull/21878 (see commit `net: introduce Sock::WaitMany()` and the structures `WaitEvents` and `WaitData` introduced in that commit).\r\n\r\nThe current combination of sets stores the sockets in \"one pile of sockets that are ready for read\" and \"one pile of sockets that are ready for write\" (notice that a given socket may be in both). It is more convenient to have just one pile of sockets each one with attached ready-for-read and ready-for-write flags.",
      "created_at": "2021-11-23T13:08:25Z",
      "updated_at": "2021-11-23T13:08:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r755105857",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755105857"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1507,
      "original_line": 1507,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755114947",
      "pull_request_review_id": 813647737,
      "id": 755114947,
      "node_id": "PRRC_kwDOABII584tAiPD",
      "diff_hunk": "@@ -1513,18 +1513,12 @@ void CConnman::SocketHandler()\n         }\n     }\n \n+    const NodesSnapshot snap{*this, /*shuffle=*/false};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "75e8bf55f5a014faada7712a9640dc35e8c86f15",
      "in_reply_to_id": 753523180,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> What do you think about always shuffling?\r\n\r\nI do not have a strong opinion. My main point with the current code is to preserve behavior - it was not shuffled before, it will not be shuffled with this PR. This PR has a different purpose.\r\n\r\nIn general, I try to avoid such unnecessary behavioral changes. _They may have very subtle effects._\r\n\r\nMaybe it is ok to always shuffle and remove the boolean argument from the `NodesSnapshot` constructor? What do other reviewers think?",
      "created_at": "2021-11-23T13:19:48Z",
      "updated_at": "2021-11-23T13:19:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r755114947",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755114947"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1516,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755390067",
      "pull_request_review_id": 814021503,
      "id": 755390067,
      "node_id": "PRRC_kwDOABII584tBlZz",
      "diff_hunk": "@@ -1513,18 +1513,12 @@ void CConnman::SocketHandler()\n         }\n     }\n \n+    const NodesSnapshot snap{*this, /*shuffle=*/false};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "75e8bf55f5a014faada7712a9640dc35e8c86f15",
      "in_reply_to_id": 753523180,
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Slight preference to keep behavior here and simplify in a follow-up.",
      "created_at": "2021-11-23T18:09:16Z",
      "updated_at": "2021-11-23T18:09:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r755390067",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755390067"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1516,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756202735",
      "pull_request_review_id": 815081452,
      "id": 756202735,
      "node_id": "PRRC_kwDOABII584tErzv",
      "diff_hunk": "@@ -1497,34 +1493,29 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n-    std::set<SOCKET> recv_set, send_set, error_set;\n-    SocketEvents(recv_set, send_set, error_set);\n-\n-    if (interruptNet) return;\n+    std::set<SOCKET> recv_set;\n+    std::set<SOCKET> send_set;\n+    std::set<SOCKET> error_set;",
      "path": "src/net.cpp",
      "position": 120,
      "original_position": 111,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "db0a01e0d1ab4462b70a44c255c602ea074b96ef",
      "in_reply_to_id": 751179588,
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I like the idea of abstracting this but it seems out of scope of this PR.\r\n\r\n> It is more convenient to have just one pile of sockets each one with attached ready-for-read and ready-for-write flags.\r\n\r\nEventually it depends on the selection mechanism used isn't it? When it's abstracted, might as well store it in a format ready to feed to say, `poll()` or `select()` whatever is used.",
      "created_at": "2021-11-24T15:43:31Z",
      "updated_at": "2021-11-24T15:43:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r756202735",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756202735"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1507,
      "original_line": 1507,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756226265",
      "pull_request_review_id": 815110132,
      "id": 756226265,
      "node_id": "PRRC_kwDOABII584tExjZ",
      "diff_hunk": "@@ -1497,34 +1493,29 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n-    std::set<SOCKET> recv_set, send_set, error_set;\n-    SocketEvents(recv_set, send_set, error_set);\n-\n-    if (interruptNet) return;\n+    std::set<SOCKET> recv_set;\n+    std::set<SOCKET> send_set;\n+    std::set<SOCKET> error_set;",
      "path": "src/net.cpp",
      "position": 120,
      "original_position": 111,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "db0a01e0d1ab4462b70a44c255c602ea074b96ef",
      "in_reply_to_id": 751179588,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yes, those 3 sets are dragged around as parameters to functions and as local variables. It is an obvious improvement to pack them together somehow. Not the purpose of this PR. Once this is PR is merged I will chop off another piece from #21878 into a smaller/manageable PR that will contain the commit which introduces such a packing `net: introduce Sock::WaitMany()`. We can discuss it there, I don't have a strong opinion on how they are packed exactly. Or if this PR is stuck we can move the discussion to #21878 where `WaitData` is introduced.",
      "created_at": "2021-11-24T16:06:25Z",
      "updated_at": "2021-11-24T16:06:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r756226265",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756226265"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1507,
      "original_line": 1507,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757474099",
      "pull_request_review_id": 816753105,
      "id": 757474099,
      "node_id": "PRRC_kwDOABII584tJiMz",
      "diff_hunk": "@@ -1497,34 +1493,29 @@ void CConnman::SocketEvents(std::set<SOCKET> &recv_set, std::set<SOCKET> &send_s\n \n void CConnman::SocketHandler()\n {\n-    std::set<SOCKET> recv_set, send_set, error_set;\n-    SocketEvents(recv_set, send_set, error_set);\n-\n-    if (interruptNet) return;\n+    std::set<SOCKET> recv_set;\n+    std::set<SOCKET> send_set;\n+    std::set<SOCKET> error_set;",
      "path": "src/net.cpp",
      "position": 120,
      "original_position": 111,
      "commit_id": "f52b6b2d9f482353821da0ef4c485c402a396c8d",
      "original_commit_id": "db0a01e0d1ab4462b70a44c255c602ea074b96ef",
      "in_reply_to_id": 751179588,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Once this is PR is merged I will chop off another piece from #21878 into a smaller/manageable PR that will contain the commit which introduces such a packing `net: introduce Sock::WaitMany()`\r\n\r\nThere are too many conflicts if I try to cherry-pick the `WaitMany()` stuff on top of bare `master` - it touches the same areas of code as the preceding commits from #21878. I chopped off those preceding commits in separate PRs instead: https://github.com/bitcoin/bitcoin/pull/23601 and https://github.com/bitcoin/bitcoin/pull/23604.\r\n\r\n```\r\nWaitMany | net: use Sock::WaitMany() instead of CConnman::SocketEvents()\r\nstuff    | net: introduce Sock::WaitMany()\r\n         | net: also wait for exceptional events in Sock::Wait()\r\n\r\n#23601   | net: don't check if the listening socket is valid\r\n\r\n         | scripted-diff: rename CNode::cs_hSocket to CNode::m_sock_mutex\r\n#23604   | net: use Sock in CNode\r\n         | fuzz: move FuzzedSock earlier in src/test/fuzz/util.h\r\n\r\n         | net: change CreateNodeFromAcceptedSocket() to take Sock\r\n#21879   | net: use Sock in CConnman::ListenSocket\r\n         | net: add new method Sock::Accept() that wraps accept()\r\n```\r\n",
      "created_at": "2021-11-26T12:49:31Z",
      "updated_at": "2021-11-26T12:49:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21943#discussion_r757474099",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/757474099"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21943"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1507,
      "original_line": 1507,
      "side": "RIGHT"
    }
  ]
}