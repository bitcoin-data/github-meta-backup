{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193",
    "id": 214446561,
    "node_id": "MDExOlB1bGxSZXF1ZXN0MjE0NDQ2NTYx",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/14193",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/14193.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/14193.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14193",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14193/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/fa2b083c3feb0522baf652045efa6b73458761a3",
    "number": 14193,
    "state": "closed",
    "locked": true,
    "maintainer_can_modify": false,
    "title": "validation: Add missing mempool locks",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Take the mempool read lock during reorgs, so that we don't accidentally read an inconsistent mempool.",
    "labels": [
      {
        "id": 64585,
        "node_id": "MDU6TGFiZWw2NDU4NQ==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug",
        "name": "Bug",
        "color": "FBBAAB",
        "default": false
      },
      {
        "id": 118379652,
        "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
        "name": "Validation",
        "color": "6060aa",
        "default": false
      }
    ],
    "milestone": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/37",
      "html_url": "https://github.com/bitcoin/bitcoin/milestone/37",
      "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/37/labels",
      "id": 3391434,
      "node_id": "MDk6TWlsZXN0b25lMzM5MTQzNA==",
      "number": 37,
      "state": "closed",
      "title": "0.19.0",
      "description": "",
      "creator": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "open_issues": 0,
      "closed_issues": 155,
      "created_at": "2018-05-31T19:40:07Z",
      "updated_at": "2020-04-24T16:46:17Z",
      "closed_at": "2019-11-10T11:39:07Z"
    },
    "active_lock_reason": "resolved",
    "created_at": "2018-09-10T21:15:43Z",
    "updated_at": "2021-12-16T13:59:21Z",
    "closed_at": "2019-07-02T14:29:44Z",
    "mergeable_state": "unknown",
    "merged_at": "2019-07-02T14:29:43Z",
    "merge_commit_sha": "fa2b083c3feb0522baf652045efa6b73458761a3",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "head": {
      "label": "MarcoFalke:Mf1809-valLocksMempool",
      "ref": "Mf1809-valLocksMempool",
      "sha": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 40046254,
        "node_id": "MDEwOlJlcG9zaXRvcnk0MDA0NjI1NA==",
        "name": "b-c",
        "full_name": "MarcoFalke/b-c",
        "owner": {
          "login": "MarcoFalke",
          "id": 6399679,
          "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
          "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/MarcoFalke",
          "html_url": "https://github.com/MarcoFalke",
          "followers_url": "https://api.github.com/users/MarcoFalke/followers",
          "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
          "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
          "repos_url": "https://api.github.com/users/MarcoFalke/repos",
          "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/MarcoFalke/b-c",
        "fork": true,
        "url": "https://api.github.com/repos/MarcoFalke/b-c",
        "archive_url": "https://api.github.com/repos/MarcoFalke/b-c/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/MarcoFalke/b-c/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/MarcoFalke/b-c/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/MarcoFalke/b-c/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/MarcoFalke/b-c/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/MarcoFalke/b-c/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/MarcoFalke/b-c/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/MarcoFalke/b-c/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/MarcoFalke/b-c/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/MarcoFalke/b-c/contributors",
        "deployments_url": "https://api.github.com/repos/MarcoFalke/b-c/deployments",
        "downloads_url": "https://api.github.com/repos/MarcoFalke/b-c/downloads",
        "events_url": "https://api.github.com/repos/MarcoFalke/b-c/events",
        "forks_url": "https://api.github.com/repos/MarcoFalke/b-c/forks",
        "git_commits_url": "https://api.github.com/repos/MarcoFalke/b-c/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/MarcoFalke/b-c/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/MarcoFalke/b-c/git/tags%7B/sha%7D",
        "git_url": "git://github.com/MarcoFalke/b-c.git",
        "issue_comment_url": "https://api.github.com/repos/MarcoFalke/b-c/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/MarcoFalke/b-c/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/MarcoFalke/b-c/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/MarcoFalke/b-c/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/MarcoFalke/b-c/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/MarcoFalke/b-c/languages",
        "merges_url": "https://api.github.com/repos/MarcoFalke/b-c/merges",
        "milestones_url": "https://api.github.com/repos/MarcoFalke/b-c/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/MarcoFalke/b-c/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/MarcoFalke/b-c/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/MarcoFalke/b-c/releases%7B/id%7D",
        "ssh_url": "git@github.com:MarcoFalke/b-c.git",
        "stargazers_url": "https://api.github.com/repos/MarcoFalke/b-c/stargazers",
        "statuses_url": "https://api.github.com/repos/MarcoFalke/b-c/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/MarcoFalke/b-c/subscribers",
        "subscription_url": "https://api.github.com/repos/MarcoFalke/b-c/subscription",
        "tags_url": "https://api.github.com/repos/MarcoFalke/b-c/tags",
        "teams_url": "https://api.github.com/repos/MarcoFalke/b-c/teams",
        "trees_url": "https://api.github.com/repos/MarcoFalke/b-c/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/MarcoFalke/b-c.git",
        "hooks_url": "https://api.github.com/repos/MarcoFalke/b-c/hooks",
        "svn_url": "https://github.com/MarcoFalke/b-c",
        "homepage": "",
        "language": "C++",
        "forks_count": 12,
        "stargazers_count": 25,
        "watchers_count": 25,
        "size": 205775,
        "default_branch": "master",
        "open_issues_count": 25,
        "is_template": false,
        "topics": [],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-06T19:05:17Z",
        "created_at": "2015-08-01T12:42:47Z",
        "updated_at": "2023-05-28T20:12:34Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "d0f81a96d9c158a9226dc946bdd61d48c4d42959",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 34324,
        "stargazers_count": 69817,
        "watchers_count": 69817,
        "size": 233879,
        "default_branch": "master",
        "open_issues_count": 627,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-06T22:42:00Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-06-07T01:13:41Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 183,
    "deletions": 45,
    "changed_files": 6,
    "commits": 3,
    "review_comments": 46,
    "comments": 18
  },
  "events": [
    {
      "event": "labeled",
      "id": 1837079321,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDE4MzcwNzkzMjE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1837079321",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-09-10T21:15:53Z",
      "label": {
        "name": "Validation",
        "color": "6060aa"
      }
    },
    {
      "event": "reviewed",
      "id": 153972481,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MTUzOTcyNDgx",
      "url": null,
      "actor": null,
      "commit_id": "fa3e0471a81252e333886b97d8d33bb275061d42",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "practicalswift",
        "id": 7826565,
        "node_id": "MDQ6VXNlcjc4MjY1NjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/practicalswift",
        "html_url": "https://github.com/practicalswift",
        "followers_url": "https://api.github.com/users/practicalswift/followers",
        "following_url": "https://api.github.com/users/practicalswift/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/practicalswift/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/practicalswift/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
        "organizations_url": "https://api.github.com/users/practicalswift/orgs",
        "repos_url": "https://api.github.com/users/practicalswift/repos",
        "events_url": "https://api.github.com/users/practicalswift/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/practicalswift/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#pullrequestreview-153972481",
      "submitted_at": "2018-09-10T21:34:05Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
    },
    {
      "event": "commented",
      "id": 420098592,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQyMDA5ODU5Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/420098592",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-09-10T23:50:59Z",
      "updated_at": "2019-06-28T23:03:06Z",
      "author_association": "MEMBER",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#16273](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16273.html) (refactor: Remove unused includes by practicalswift)\n* [#16194](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16194.html) (refactor: share blockmetadata with BlockManager by jamesob)\n* [#16066](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16066.html) (mempool: Skip estimator if block is older than X by promag)\n* [#15192](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15192.html) (Add missing cs_main locks in ThreadImport(...)/Shutdown(...)/gettxoutsetinfo(...)/InitScriptExecutionCache(). Add missing locking annotations. by practicalswift)\n* [#13949](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/13949.html) (Introduce MempoolObserver interface to break \"policy/fees -> txmempool -> policy/fees\" circular dependency by Empact)\n* [#10443](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/10443.html) (Add fee_est tool for debugging fee estimation code by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#issuecomment-420098592",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14193"
    },
    {
      "event": "reviewed",
      "id": 154844614,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MTU0ODQ0NjE0",
      "url": null,
      "actor": null,
      "commit_id": "fa3e0471a81252e333886b97d8d33bb275061d42",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#pullrequestreview-154844614",
      "submitted_at": "2018-09-12T21:07:53Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
    },
    {
      "event": "commented",
      "id": 421375559,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQyMTM3NTU1OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/421375559",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-09-14T14:26:44Z",
      "updated_at": "2018-09-14T14:27:26Z",
      "author_association": "MEMBER",
      "body": "Is the idea that you're trying to prevent RPC users from having an inconsistent state, like if they call getbestblockhash() and then call getrawmempool(), the latter should be consistent with the former?\r\n\r\nThat may be reasonable, but I think it'd be good to have some documentation (whether a project document or even a gist explaining our thinking) explaining the consistency guarantees for RPC calls with respect to the mempool, validation, and the wallet.  I feel like this kind of thing has come up before in a haphazard way and caused issues when we didn't think things through or missed an implication of a change.\r\n\r\n(Also, I think it would aid RPC users if they knew what our consistency guarantees were.)",
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#issuecomment-421375559",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14193"
    },
    {
      "event": "commented",
      "id": 421429944,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQyMTQyOTk0NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/421429944",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-09-14T17:31:35Z",
      "updated_at": "2018-09-14T17:31:35Z",
      "author_association": "MEMBER",
      "body": "> Is the idea that you're trying to prevent RPC users from having an inconsistent state\r\n\r\nFrom the description, I assumed the intent of the PR was to prevent RPCs like `getmempoolentry`, which acquire `mempool.cs` but not `cs_main`, from returning garbage or segfaulting during reorgs because `UpdateMempoolForReorg` and `InvalidateBlock` functions were apparently not acquiring `mempool.cs` while updating the mempool.\r\n\r\nBut actually it seems like in all the places where the mempool is updated, the code already has both `cs_main` and `mempool.cs` locks. So it should be perfectly safe to read the mempool while holding either of the two locks, and trying to acquire both is wasteful.\r\n\r\nSo maybe this PR is not doing what it intended to do, and instead it would be better just to add comments and fix thread safety annotations somehow. Maybe it would be possible to annotate `cs_main` and `mempool.cs` individually as shared locks needed for reading mempool data, and `cs_main`+`mempool.cs` both together as an exclusive lock needed for updating mempool data?",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#issuecomment-421429944",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14193"
    },
    {
      "event": "commented",
      "id": 421435147,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQyMTQzNTE0Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/421435147",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-09-14T17:50:17Z",
      "updated_at": "2018-09-14T17:50:17Z",
      "author_association": "MEMBER",
      "body": "@ryanofsky With inconsistent I don't mean invalid reads, but rather transactions that are invalid (and still in the process of removal) as of our current block tip.",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#issuecomment-421435147",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14193"
    },
    {
      "event": "mentioned",
      "id": 1846687036,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MTg0NjY4NzAzNg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1846687036",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-09-14T17:50:17Z"
    },
    {
      "event": "subscribed",
      "id": 1846687037,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDE4NDY2ODcwMzc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1846687037",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-09-14T17:50:17Z"
    },
    {
      "event": "reviewed",
      "id": 155624627,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MTU1NjI0NjI3",
      "url": null,
      "actor": null,
      "commit_id": "fa3e0471a81252e333886b97d8d33bb275061d42",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Code utACK fa3e0471a81252e333886b97d8d33bb275061d42. Code change seems perfectly fine, and it could perhaps lead to more consistency in some cases, but like the previous comment https://github.com/bitcoin/bitcoin/pull/14193#issuecomment-421375559 says, it's unclear which cases are better off after this change or what case motivated this PR. More comments and documentation would be helpful.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#pullrequestreview-155624627",
      "submitted_at": "2018-09-14T19:05:31Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 1930342099,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MTkzMDM0MjA5OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1930342099",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-10-27T14:35:30Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 1930352401,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MTkzMDM1MjQwMQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1930352401",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-10-27T14:58:03Z"
    },
    {
      "event": "commented",
      "id": 433628304,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQzMzYyODMwNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/433628304",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-10-27T15:04:34Z",
      "updated_at": "2018-10-27T15:04:34Z",
      "author_association": "MEMBER",
      "body": "@sdaftuar, @ryanofsky: Added a test with comments to illustrate my motivation a bit more.",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#issuecomment-433628304",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14193"
    },
    {
      "event": "mentioned",
      "id": 1930355357,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MTkzMDM1NTM1Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1930355357",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-10-27T15:04:34Z"
    },
    {
      "event": "subscribed",
      "id": 1930355358,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDE5MzAzNTUzNTg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1930355358",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-10-27T15:04:34Z"
    },
    {
      "event": "mentioned",
      "id": 1930355359,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MTkzMDM1NTM1OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1930355359",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-10-27T15:04:34Z"
    },
    {
      "event": "subscribed",
      "id": 1930355360,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDE5MzAzNTUzNjA=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1930355360",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-10-27T15:04:34Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 1930414967,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MTkzMDQxNDk2Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1930414967",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-10-27T17:28:48Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 1930671501,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MTkzMDY3MTUwMQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1930671501",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-10-28T08:35:40Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 1930679204,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MTkzMDY3OTIwNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1930679204",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-10-28T08:59:57Z"
    },
    {
      "event": "reviewed",
      "id": 174491669,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MTc0NDkxNjY5",
      "url": null,
      "actor": null,
      "commit_id": "dea5dbf2d5ca0177d3a4be665790288bef40e27e",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Started review:\r\n- [X] dea5dbf2d5ca0177d3a4be665790288bef40e27e validation: Add missing mempool locks (1/2)\r\n- [ ] fa27735e0f1fd52f03a17d7e9b94a66f310ddfa1 [test] Add test to check mempool consistency in case of reorgs (2/2)\r\n\r\nI didn't look closely at the test yet, since it seems pretty complex. If you could a write a one or two sentence comment before the test describing how it works, that might be helpful.\r\n\r\nI also think it would be useful to have a comment on the `mempool::cs` variable. It's definitely being used in a way I wouldn't have expected. From first appearance, it looks like it's just being used to protect `mapTx` and allow maybe reads & writes from multiple threads:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/5d605b27457dd307e31ac320c83f3b01a41e1ae1/src/txmempool.h#L488-L489\r\n\r\nBut apparently it's supposed to not just provide thread safety, but also guarantee consistency between `mempool` and `chainActive`? Would suggest maybe:\r\n\r\n```c++\r\n    /**\r\n     * Lock to guarantee consistency between mempool and external chain state.\r\n     *\r\n     * Lock must be held whenever mempool is read from or written to and\r\n     * whenever a block is connected. Lock can be released when the mempool\r\n     * contains no transactions that conflict internally or externally. It\r\n     * should be acquired after `cs_main` if both locks need to be held at the\r\n     * same time.\r\n     */\r\n    mutable CCriticalSection cs;\r\n```\r\n\r\nre: https://github.com/bitcoin/bitcoin/pull/14193#issuecomment-421375559\r\n\r\n> I think it'd be good to have some documentation (whether a project document or even a gist explaining our thinking) explaining the consistency guarantees for RPC calls with respect to the mempool, validation, and the wallet\r\n\r\nDocumentation was added in #14592.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#pullrequestreview-174491669",
      "submitted_at": "2018-11-13T21:34:56Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
    },
    {
      "event": "commented",
      "id": 440504118,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ0MDUwNDExOA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/440504118",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-11-21T02:19:14Z",
      "updated_at": "2018-11-21T02:19:14Z",
      "author_association": "MEMBER",
      "body": "The test is trivial, but looks scary because of the boilerplate overhead of the cpp unit tests. Pretty much the only thing it is doing is to check that during a reorg a (simulated) rpc thread (e.g. getrawmempool) would either return a consistent mempool as of before the reorg or a consistent mempool as of after the reorg and never something inconsistent in the middle of a reorg.",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#issuecomment-440504118",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14193"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 1993325661,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MTk5MzMyNTY2MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1993325661",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-11-28T19:03:37Z"
    },
    {
      "event": "commented",
      "id": 442569470,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ0MjU2OTQ3MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/442569470",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-11-28T19:15:28Z",
      "updated_at": "2018-11-28T19:15:28Z",
      "author_association": "MEMBER",
      "body": "Added a commit with further comments and documentation.",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#issuecomment-442569470",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14193"
    },
    {
      "event": "reviewed",
      "id": 179871886,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MTc5ODcxODg2",
      "url": null,
      "actor": null,
      "commit_id": "fad0712c6e12ccf2a823602c953ccd1af635edbc",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "The change in general seems fine to me (mempool state should update atomically after a contiguous batch of chain maintenance and not during) and the test is great, but it might be nice to:\r\n\r\n- explain what the motivations are. There's an argument for RPC client consistency, but IIRC this may also be a prereq for Dandelion?\r\n- add comments for new lock acquisitions explaining why we're grabbing a seemingly unrelated lock at a coarse grain (in line with what @ryanofsky is saying).\r\n\r\nIn practice, `ActivateBestChain` calls are very short and so I don't think there are any real-world downsides to locking `::mempool.cs` for their duration - although I'm curious if this affects mempool access during IBD/reindex.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#pullrequestreview-179871886",
      "submitted_at": "2018-11-29T17:24:05Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 1996298163,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MTk5NjI5ODE2Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1996298163",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-11-29T20:15:21Z"
    },
    {
      "event": "commented",
      "id": 442978333,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ0Mjk3ODMzMw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/442978333",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-11-29T20:17:06Z",
      "updated_at": "2018-11-29T20:17:06Z",
      "author_association": "MEMBER",
      "body": "> add comments for new lock acquisitions explaining why we're grabbing a seemingly unrelated lock at a coarse grain (in line with what @ryanofsky is saying).\r\n\r\nI think I already did that. Let me know if any of them are still unclear.",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#issuecomment-442978333",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14193"
    },
    {
      "event": "mentioned",
      "id": 1996301864,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MTk5NjMwMTg2NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1996301864",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-11-29T20:17:06Z"
    },
    {
      "event": "subscribed",
      "id": 1996301865,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDE5OTYzMDE4NjU=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1996301865",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-11-29T20:17:06Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 1998697079,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MTk5ODY5NzA3OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1998697079",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-11-30T18:59:30Z"
    },
    {
      "event": "reviewed",
      "id": 180431962,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MTgwNDMxOTYy",
      "url": null,
      "actor": null,
      "commit_id": "fae71ffc99b04bbcb96f4e2b6fa25ed2fe258912",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "utACK https://github.com/bitcoin/bitcoin/pull/14193/commits/fae71ffc99b04bbcb96f4e2b6fa25ed2fe258912\r\n\r\nJust a few clarifying questions.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#pullrequestreview-180431962",
      "submitted_at": "2018-11-30T20:22:29Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
    },
    {
      "event": "reviewed",
      "id": 182291568,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MTgyMjkxNTY4",
      "url": null,
      "actor": null,
      "commit_id": "fae71ffc99b04bbcb96f4e2b6fa25ed2fe258912",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "practicalswift",
        "id": 7826565,
        "node_id": "MDQ6VXNlcjc4MjY1NjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/practicalswift",
        "html_url": "https://github.com/practicalswift",
        "followers_url": "https://api.github.com/users/practicalswift/followers",
        "following_url": "https://api.github.com/users/practicalswift/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/practicalswift/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/practicalswift/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
        "organizations_url": "https://api.github.com/users/practicalswift/orgs",
        "repos_url": "https://api.github.com/users/practicalswift/repos",
        "events_url": "https://api.github.com/users/practicalswift/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/practicalswift/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#pullrequestreview-182291568",
      "submitted_at": "2018-12-06T15:22:46Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
    },
    {
      "event": "mentioned",
      "id": 2010174396,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjAxMDE3NDM5Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2010174396",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-06T15:36:37Z"
    },
    {
      "event": "subscribed",
      "id": 2010174410,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDIwMTAxNzQ0MTA=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2010174410",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-06T15:36:37Z"
    },
    {
      "event": "reviewed",
      "id": 183347740,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MTgzMzQ3NzQw",
      "url": null,
      "actor": null,
      "commit_id": "fae71ffc99b04bbcb96f4e2b6fa25ed2fe258912",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "I requested this in my last review (https://github.com/bitcoin/bitcoin/pull/14193#pullrequestreview-174491669) but I really think [`mempool.cs`](https://github.com/bitcoin/bitcoin/blob/5f23460c7e316fe7c944680f3feff07ebb867f70/src/txmempool.h#L488-L489) needs a comment saying how it's supposed to be used and what invariants it guarantees. Here's an attempt at a comment based on what I currently understand about what you're trying to do with this PR:\r\n\r\n```c++\r\n//! Recursive mutex ensuring internal consistency of transactions within the\r\n//! mempool, and external consistency between transactions in the mempool and\r\n//! the current chain tip. This mutex must be locked:\r\n//!\r\n//! - whenever reading or writing to `mempool::mapTx`\r\n//! - whenever writing to `chainActive` or `pcoinsTip`\r\n//!\r\n//! and be held as long as mempool state and chain state are not consistent with\r\n//! each other.\r\n//!\r\n//! Locking either the `cs_main` mutex or the `mempool::cs` mutex will lock the\r\n//! chain tip and prevent it from being updated. But having two mutexes does\r\n//! allow some useful concurrency, because it lets a thread that reads or writes\r\n//! to the mempool run at the same time as a thread that reads the chain state.\r\nmutable CCriticalSection cs;\r\n```",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#pullrequestreview-183347740",
      "submitted_at": "2018-12-11T00:44:06Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
    },
    {
      "event": "commented",
      "id": 446040973,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NjA0MDk3Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/446040973",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-11T01:42:04Z",
      "updated_at": "2018-12-11T01:42:04Z",
      "author_association": "MEMBER",
      "body": "I'm probably missing some context, but what is wrong with a simpler design where you just acquire `cs_main` to get a consistent view of chain state, and `mempool::cs` to get a consistent view of the mempool, and both to get a consistent view of both together?\r\n\r\nThe new unit test and the getrawmempool example both seem very contrived. Why do these cases need to only acquire `mempool::cs` without acquiring `cs_main`? If they need to views of the mempool consistent with the current chain tip, why don't they just acquire both mutexes?",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#issuecomment-446040973",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14193"
    },
    {
      "event": "labeled",
      "id": 2025432663,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDIwMjU0MzI2NjM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2025432663",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-13T21:54:50Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 447956395,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ0Nzk1NjM5NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/447956395",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-17T18:51:56Z",
      "updated_at": "2018-12-17T18:51:56Z",
      "author_association": "MEMBER",
      "body": "It looks like #14963 replaces this PR. Perhaps this should be closed, or marked dependent.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#issuecomment-447956395",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14193"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2042136651,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjA0MjEzNjY1MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2042136651",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-22T15:08:10Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2042137691,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjA0MjEzNzY5MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2042137691",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-22T15:11:30Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2042176366,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjA0MjE3NjM2Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2042176366",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-22T17:16:11Z"
    },
    {
      "event": "unlabeled",
      "id": 2043058332,
      "node_id": "MDE0OlVubGFiZWxlZEV2ZW50MjA0MzA1ODMzMg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2043058332",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-12-24T12:21:53Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 451520802,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MTUyMDgwMg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/451520802",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-04T18:03:14Z",
      "updated_at": "2019-01-04T18:04:22Z",
      "author_association": "MEMBER",
      "body": "re: https://github.com/bitcoin/bitcoin/pull/14193#issuecomment-447956395\r\n> It looks like #14963 replaces this PR. Perhaps this should be closed, or marked dependent.\r\n\r\nTurns out #14963 doesn't really replace this PR, it just documents a bug which this PR (which is currently WIP) will fix:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/fa5c346c5a336ccdce8e50befb53746c280f053e/src/txmempool.h#L515-L522\r\n\r\nre: https://github.com/bitcoin/bitcoin/pull/14193#issuecomment-446040973\r\n> I'm probably missing some context, but what is wrong with a simpler design where you just acquire cs_main to get a consistent view of chain state, and mempool::cs to get a consistent view of the mempool, and both to get a consistent view of both together?\r\n\r\nResponding to my own question, but answer from conversation seems to be that we want to allow applications that frequently query the mempool to (1) only acquire cs.mempool without cs_main for better performance and (2) not see any missing transactions if they happen to query the mempool in the middle of a reorg.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#issuecomment-451520802",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14193"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2075450356,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjA3NTQ1MDM1Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2075450356",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-15T18:46:57Z"
    },
    {
      "event": "commented",
      "id": 454507036,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NDUwNzAzNg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454507036",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-15T18:52:01Z",
      "updated_at": "2019-01-15T18:52:01Z",
      "author_association": "MEMBER",
      "body": "Addressed some of @ryanofsky's feedback",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#issuecomment-454507036",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14193"
    },
    {
      "event": "mentioned",
      "id": 2075462646,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjA3NTQ2MjY0Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2075462646",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-15T18:52:01Z"
    },
    {
      "event": "subscribed",
      "id": 2075462647,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDIwNzU0NjI2NDc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2075462647",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-01-15T18:52:01Z"
    },
    {
      "event": "labeled",
      "id": 2187864146,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDIxODc4NjQxNDY=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2187864146",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-03-07T17:05:39Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2187967310,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjE4Nzk2NzMxMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2187967310",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-03-07T17:43:32Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2188051940,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjE4ODA1MTk0MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2188051940",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-03-07T18:17:32Z"
    },
    {
      "event": "unlabeled",
      "id": 2188092518,
      "node_id": "MDE0OlVubGFiZWxlZEV2ZW50MjE4ODA5MjUxOA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2188092518",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-03-07T18:33:45Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 216840225,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjE2ODQwMjI1",
      "url": null,
      "actor": null,
      "commit_id": "fadeeadd93a928c8ececa8c96ad2afa45bd25a29",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "utACK fa33e8f41fe14cfd136ac7c96e192a9e14f1d0d3. Looks good! This makes a lot more sense to me now, and the test is actually pretty clear too.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#pullrequestreview-216840225",
      "submitted_at": "2019-03-20T16:36:22Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
    },
    {
      "event": "milestoned",
      "id": 2217594905,
      "node_id": "MDE1Ok1pbGVzdG9uZWRFdmVudDIyMTc1OTQ5MDU=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2217594905",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-03-20T17:18:22Z",
      "milestone": {
        "title": "0.19.0"
      }
    },
    {
      "event": "labeled",
      "id": 2217595309,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDIyMTc1OTUzMDk=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2217595309",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-03-20T17:18:29Z",
      "label": {
        "name": "Bug",
        "color": "FBBAAB"
      }
    },
    {
      "event": "reviewed",
      "id": 226664144,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjI2NjY0MTQ0",
      "url": null,
      "actor": null,
      "commit_id": "fa33e8f41fe14cfd136ac7c96e192a9e14f1d0d3",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "practicalswift",
        "id": 7826565,
        "node_id": "MDQ6VXNlcjc4MjY1NjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/practicalswift",
        "html_url": "https://github.com/practicalswift",
        "followers_url": "https://api.github.com/users/practicalswift/followers",
        "following_url": "https://api.github.com/users/practicalswift/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/practicalswift/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/practicalswift/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
        "organizations_url": "https://api.github.com/users/practicalswift/orgs",
        "repos_url": "https://api.github.com/users/practicalswift/repos",
        "events_url": "https://api.github.com/users/practicalswift/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/practicalswift/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#pullrequestreview-226664144",
      "submitted_at": "2019-04-15T14:02:17Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
    },
    {
      "event": "reviewed",
      "id": 226953674,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjI2OTUzNjc0",
      "url": null,
      "actor": null,
      "commit_id": "fa33e8f41fe14cfd136ac7c96e192a9e14f1d0d3",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "body": "تکراری از #",
      "user": {
        "login": "CLEANSKY97",
        "id": 40016691,
        "node_id": "MDQ6VXNlcjQwMDE2Njkx",
        "avatar_url": "https://avatars.githubusercontent.com/u/40016691?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/CLEANSKY97",
        "html_url": "https://github.com/CLEANSKY97",
        "followers_url": "https://api.github.com/users/CLEANSKY97/followers",
        "following_url": "https://api.github.com/users/CLEANSKY97/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/CLEANSKY97/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/CLEANSKY97/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/CLEANSKY97/subscriptions",
        "organizations_url": "https://api.github.com/users/CLEANSKY97/orgs",
        "repos_url": "https://api.github.com/users/CLEANSKY97/repos",
        "events_url": "https://api.github.com/users/CLEANSKY97/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/CLEANSKY97/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#pullrequestreview-226953674",
      "submitted_at": "2019-04-16T01:50:52Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2281054955,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjI4MTA1NDk1NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2281054955",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-04-16T21:48:50Z"
    },
    {
      "event": "reviewed",
      "id": 227883160,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjI3ODgzMTYw",
      "url": null,
      "actor": null,
      "commit_id": "fa81e866ebb2533489cea13618af0d58a1a355fd",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "utACK fa81e866ebb2533489cea13618af0d58a1a355fd. Only change since last review is rebase after #15788 and fixing DisconnetTip spelling in comment",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#pullrequestreview-227883160",
      "submitted_at": "2019-04-17T17:05:27Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2300574520,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjMwMDU3NDUyMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2300574520",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-04-25T15:10:10Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2301026299,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjMwMTAyNjI5OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2301026299",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-04-25T17:56:42Z"
    },
    {
      "event": "commented",
      "id": 486775996,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ4Njc3NTk5Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/486775996",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-04-25T17:58:06Z",
      "updated_at": "2019-04-25T17:58:06Z",
      "author_association": "MEMBER",
      "body": "rewritten test now that segwit is always active in unit tests:\r\n\r\n* Add missing call to `GenerateCoinbaseCommitment`\r\n* Mine the reorg before adding txs to mempool, to not include them in the reorg blocks",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#issuecomment-486775996",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14193"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2301119808,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjMwMTExOTgwOA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2301119808",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-04-25T18:34:25Z"
    },
    {
      "event": "labeled",
      "id": 2324725532,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDIzMjQ3MjU1MzI=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2324725532",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-05-07T16:07:17Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2324745904,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjMyNDc0NTkwNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2324745904",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-05-07T16:14:12Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2324756272,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjMyNDc1NjI3Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2324756272",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-05-07T16:17:37Z"
    },
    {
      "event": "unlabeled",
      "id": 2324861677,
      "node_id": "MDE0OlVubGFiZWxlZEV2ZW50MjMyNDg2MTY3Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2324861677",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-05-07T16:57:17Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 234775875,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjM0Nzc1ODc1",
      "url": null,
      "actor": null,
      "commit_id": "faa0d61f8ab42cc921bdcd73d6fd4b8b680aa22e",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "utACK faa0d61f8ab42cc921bdcd73d6fd4b8b680aa22e. Only changes since last review are rebase and described test changes.\r\n\r\n> Mine the reorg before adding txs to mempool, to not include them in the reorg blocks.\r\n\r\nI don't understand how it'd be possible for transactions in the mempool to end up in the reorg, if the reorg code is just calling `Block()` and generating empty blocks. I also don't understand what changed in the rebase if mining the reorg after adding transactions used to work, but now stopped working. In any case, it'd be useful to have a comment in the test saying that it's important to mine the reorg before adding transactions, and why, assuming it is important.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#pullrequestreview-234775875",
      "submitted_at": "2019-05-07T21:41:02Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
    },
    {
      "event": "commented",
      "id": 490268840,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MDI2ODg0MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/490268840",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-05-07T21:52:56Z",
      "updated_at": "2019-05-07T21:52:56Z",
      "author_association": "MEMBER",
      "body": "The mining is using CreateNewBlock, which gets txs from the mempool (if available).\r\n\r\nWhy this worked previously, IIRC, was that segwit wasn't active on regtest in unit tests, but non-standard txs would be accepted to the mempool. (See https://github.com/bitcoin/bitcoin/pull/15788/files#diff-01edb0ae76ec7f6061ec6ddbdb18375aL45 and #15891). Since the txs have witness, they wouldn't be mined previously, but now that segwit is always active on regtest, they are.\r\n\r\nIn this test we don't want to mine any txs from the mempool, so we mine the reorg when the mempool is empty and then add the txs to the mempool.",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#issuecomment-490268840",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14193"
    },
    {
      "event": "commented",
      "id": 492246200,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MjI0NjIwMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/492246200",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-05-14T13:51:39Z",
      "updated_at": "2019-05-14T13:51:39Z",
      "author_association": "MEMBER",
      "body": "Also, the test is already clear on this: `// Mine a reorg (and hold it back) before adding the txs to the mempool`. If you have specific concerns, please suggest a rewording of that sentence.",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#issuecomment-492246200",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14193"
    },
    {
      "event": "reviewed",
      "id": 237326067,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjM3MzI2MDY3",
      "url": null,
      "actor": null,
      "commit_id": "faa0d61f8ab42cc921bdcd73d6fd4b8b680aa22e",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "body": "",
      "user": {
        "login": "CLEANSKY97",
        "id": 40016691,
        "node_id": "MDQ6VXNlcjQwMDE2Njkx",
        "avatar_url": "https://avatars.githubusercontent.com/u/40016691?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/CLEANSKY97",
        "html_url": "https://github.com/CLEANSKY97",
        "followers_url": "https://api.github.com/users/CLEANSKY97/followers",
        "following_url": "https://api.github.com/users/CLEANSKY97/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/CLEANSKY97/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/CLEANSKY97/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/CLEANSKY97/subscriptions",
        "organizations_url": "https://api.github.com/users/CLEANSKY97/orgs",
        "repos_url": "https://api.github.com/users/CLEANSKY97/repos",
        "events_url": "https://api.github.com/users/CLEANSKY97/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/CLEANSKY97/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#pullrequestreview-237326067",
      "submitted_at": "2019-05-14T15:28:04Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
    },
    {
      "event": "reviewed",
      "id": 240899453,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQwODk5NDUz",
      "url": null,
      "actor": null,
      "commit_id": "fa84fdbb1eb3c842e7f9248bceab98e91445ad0d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#pullrequestreview-240899453",
      "submitted_at": "2019-05-22T21:52:45Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2363189882,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjM2MzE4OTg4Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2363189882",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-05-23T17:19:06Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2363277283,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjM2MzI3NzI4Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2363277283",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-05-23T17:52:27Z"
    },
    {
      "event": "labeled",
      "id": 2390767998,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDIzOTA3Njc5OTg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2390767998",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-06-05T10:22:03Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2390873571,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjM5MDg3MzU3MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2390873571",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-06-05T11:08:31Z"
    },
    {
      "event": "unlabeled",
      "id": 2390915815,
      "node_id": "MDE0OlVubGFiZWxlZEV2ZW50MjM5MDkxNTgxNQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2390915815",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-06-05T11:28:03Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2396570824,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjM5NjU3MDgyNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2396570824",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-06-07T08:20:37Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYTBjOWRiZjkxNTZkNjRhNGI5YmZmODU4ZGE5NzgyNTM2OWE5MTM0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa0c9dbf9156d64a4b9bff858da97825369a9134",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/fa0c9dbf9156d64a4b9bff858da97825369a9134",
      "tree": {
        "sha": "e54ed5513a012acbe92cb553814f30ace3e54f16",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e54ed5513a012acbe92cb553814f30ace3e54f16"
      },
      "verification": {
        "verified": false,
        "reason": "no_user",
        "payload": "tree e54ed5513a012acbe92cb553814f30ace3e54f16\nparent d0f81a96d9c158a9226dc946bdd61d48c4d42959\nauthor MarcoFalke <falke.marco@gmail.com> 1558631829 +0200\ncommitter MarcoFalke <falke.marco@gmail.com> 1559898360 +0200\n\ntxpool: Make nTransactionsUpdated atomic\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUi+Bgv/deyXdF+BoF43SLyp2V1XeyFK/e53li7VUj7XenpJyTa6dnbkMLOpl3D9\nH+JEG5QQyPnJ3BopSvxZMw8aoyG1TOZCm9fMwOU6ubnMgbFcR6+OxU18kY/NUj6T\nJP9ehqOaMV+v3VhPVzgQAOV8djmqc3SpBW+AxJZU5Ag2hhT5e3WLFWM3k0UpkNSP\nRiEsylLfXXhE568YTGaJbQ1pa8T2zaIgTtZ1HGq7uOiCpTP8YtqNK58fmM7Bx4GY\nDSFjwkUK9DrDu8K51Oisj/mcQczz/aIW3dJM9DxPPsn2hHJIFmhZjBzgc3za8Eo9\nYHerbMPfhlm31u6EunWPiEVmLf7tYFCdZ/7l4lz92qnZ5c35NbipOKPoKT2srHUN\nFatBKjniuBDZCz9B6gfViDyxX01/VFMO7malSoOqBPJzBQl3qgvCbf8JqRcidx+4\nFJP+cPpeS0cs5sbxJWQ9cSm7GH770iXtwIyxKFtqvg/dTgMaaNvAN007kntSCGmr\ntm8QGPcS\n=zS3T\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d0f81a96d9c158a9226dc946bdd61d48c4d42959",
          "sha": "d0f81a96d9c158a9226dc946bdd61d48c4d42959",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/d0f81a96d9c158a9226dc946bdd61d48c4d42959"
        }
      ],
      "message": "txpool: Make nTransactionsUpdated atomic",
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2019-06-07T09:06:00Z"
      },
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2019-05-23T17:17:09Z"
      },
      "sha": "fa0c9dbf9156d64a4b9bff858da97825369a9134"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYWJlYjFmNjEzNjUzYThjMTU2MGU0YTA5M2E5YjZiN2EwNjliNjBi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fabeb1f613653a8c1560e4a093a9b6b7a069b60b",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/fabeb1f613653a8c1560e4a093a9b6b7a069b60b",
      "tree": {
        "sha": "d4cebfd9246f3ab39199cb6de9f6834f4484ff7c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d4cebfd9246f3ab39199cb6de9f6834f4484ff7c"
      },
      "verification": {
        "verified": false,
        "reason": "no_user",
        "payload": "tree d4cebfd9246f3ab39199cb6de9f6834f4484ff7c\nparent fa0c9dbf9156d64a4b9bff858da97825369a9134\nauthor MarcoFalke <falke.marco@gmail.com> 1545492834 +0100\ncommitter MarcoFalke <falke.marco@gmail.com> 1559898429 +0200\n\nvalidation: Add missing mempool locks\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUhN7gv7BDebVzKulnpiIfnveEztlstwUCHncBkeEhAPOKHaC0KF/y6ceJbdYSPb\noaJb9yL5iJpOGaOLFu7wI6k4l5ebzR4vg0Lzg8LaKMVVWVLVTK+TcB+aHKxHf8r8\nM6KLx813m4LBZEYJyhB50MKCUZTIoyU+Wh4hWurst+t55TxcIUXcS0YnBy30P2TX\nZx48reqkX55YFjNKqD8H+T4Am9XVDMVkjH+02azDpdDcHhOv5ut61g80gO31IekG\nBvXtVmdnQxZplIrsUuiXOMhDrTnkzINTZ8vVBHVz0WftkiF5JyIMifm2LTk7aylq\nvgEtcdPOlTDkzDo8q1g1q2JR3gLr8zOJRhZU4XhLFlKuT0PUceFmc1jZGs2rtwkw\nQFY6QYUbcQzP/4Em0opAOXp7bfLmNRMCa9b2UKd89boB7KDOskGsC3Fm+Wx9kdr5\nJIzOMh8R6Rcb1xq2AGUGSGzxHyqnkFnqLleCgqdBy0Aq14rnmiP8jdpstqxXl/Lv\nZgyGxS+Q\n=0Mix\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa0c9dbf9156d64a4b9bff858da97825369a9134",
          "sha": "fa0c9dbf9156d64a4b9bff858da97825369a9134",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/fa0c9dbf9156d64a4b9bff858da97825369a9134"
        }
      ],
      "message": "validation: Add missing mempool locks",
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2019-06-07T09:07:09Z"
      },
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2018-12-22T15:33:54Z"
      },
      "sha": "fabeb1f613653a8c1560e4a093a9b6b7a069b60b"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYTJiMDgzYzNmZWIwNTIyYmFmNjUyMDQ1ZWZhNmI3MzQ1ODc2MWEz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa2b083c3feb0522baf652045efa6b73458761a3",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/fa2b083c3feb0522baf652045efa6b73458761a3",
      "tree": {
        "sha": "795525a5cebe1b4ea2ad82a41ff072f98165d263",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/795525a5cebe1b4ea2ad82a41ff072f98165d263"
      },
      "verification": {
        "verified": false,
        "reason": "no_user",
        "payload": "tree 795525a5cebe1b4ea2ad82a41ff072f98165d263\nparent fabeb1f613653a8c1560e4a093a9b6b7a069b60b\nauthor MarcoFalke <falke.marco@gmail.com> 1540642597 +0200\ncommitter MarcoFalke <falke.marco@gmail.com> 1559898443 +0200\n\n[test] Add test to check mempool consistency in case of reorgs\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUhRmgv+KLQv+MhHYJGZQv69HoZaAuqfA8n14UG4s4Jyta9QZ/FPY8Lbi6HPEoH6\nmZ1y7fUejdsmx4V97UX4kKZ6vnnLJgwVm9WnPZgareNyAI3bPwmhZDDaN7g94/tF\nPDWG6b0Bbd7bEB7Rj1hEzU+WPBw6BEH6oFn2+hAc+3PHNXrwm2r5tGwn39WBsZsw\nDm13xtgzOJctte4fycfQ+2yBzqSEoG4bhoR2jwI0BELJKglzvhw4g/NpwJUh9R4c\nPQ3gZwMoSONiqB5RAe6+WSdpudGqQJR/D+2viVXe0hUiy1vrW5OJhZmbgjXLRE/t\n+SfUL+Ggt1y3S00t/hnEZugjTBXmKDVg9DncxWCAFakGeH3cgr40Hes8ErMXYalv\nSUDbdfIWC2hZQMGECcQIhe3xy7aztOZI/R6sFMWhWnxgooh6GdHy6ntSNe0/418/\nssYw6PWzSpTP8DEwShk7M5YsCGyvV8sQGxAFi0A0IIjWcmHJB7K2dNKJ0qz3XqUi\nTsYP3AsP\n=o+G5\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fabeb1f613653a8c1560e4a093a9b6b7a069b60b",
          "sha": "fabeb1f613653a8c1560e4a093a9b6b7a069b60b",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/fabeb1f613653a8c1560e4a093a9b6b7a069b60b"
        }
      ],
      "message": "[test] Add test to check mempool consistency in case of reorgs",
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2019-06-07T09:07:23Z"
      },
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2018-10-27T12:16:37Z"
      },
      "sha": "fa2b083c3feb0522baf652045efa6b73458761a3"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2396687512,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjM5NjY4NzUxMg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2396687512",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-06-07T09:09:04Z"
    },
    {
      "event": "added_to_project",
      "id": 2411631459,
      "node_id": "MDE5OkFkZGVkVG9Qcm9qZWN0RXZlbnQyNDExNjMxNDU5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2411631459",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-06-13T19:06:44Z",
      "project_card": {
        "id": 22752064,
        "url": "https://api.github.com/projects/columns/cards/22752064",
        "project_id": 481835,
        "project_url": "https://api.github.com/projects/481835",
        "column_name": "Blockers"
      }
    },
    {
      "event": "moved_columns_in_project",
      "id": 2411635314,
      "node_id": "MDI2Ok1vdmVkQ29sdW1uc0luUHJvamVjdEV2ZW50MjQxMTYzNTMxNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2411635314",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-06-13T19:08:22Z",
      "project_card": {
        "id": 22752064,
        "url": "https://api.github.com/projects/columns/cards/22752064",
        "project_id": 481835,
        "project_url": "https://api.github.com/projects/481835",
        "column_name": "Bugfixes",
        "previous_column_name": "Blockers"
      }
    },
    {
      "event": "reviewed",
      "id": 255403869,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjU1NDAzODY5",
      "url": null,
      "actor": null,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "utACK fa2b083c3feb0522baf652045efa6b73458761a3 [EDIT: was ~e284e422e75189794e24fe482819d8b1407857c3~, from bad copy and paste]. Changes since last review: rebase after #15976, adding vTxHashes lock annotation, adding new commit dropping mempool lock for nTransactionsUpdated and making it atomic to avoid deadlock between mempool lock and g_best_block_mutex ",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#pullrequestreview-255403869",
      "submitted_at": "2019-06-27T18:27:47Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
    },
    {
      "event": "reviewed",
      "id": 256052741,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjU2MDUyNzQx",
      "url": null,
      "actor": null,
      "commit_id": "fa0c9dbf9156d64a4b9bff858da97825369a9134",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Concept ACK, some comments.",
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#pullrequestreview-256052741",
      "submitted_at": "2019-06-29T23:08:00Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
    },
    {
      "event": "commented",
      "id": 507692011,
      "node_id": "MDEyOklzc3VlQ29tbWVudDUwNzY5MjAxMQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/507692011",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-07-02T14:05:05Z",
      "updated_at": "2019-07-02T14:05:43Z",
      "author_association": "MEMBER",
      "body": "code review ACK fa2b083c3feb0522baf652045efa6b73458761a3\r\n\r\n@ryanofsky didn't you ack the wrong commit above ? e284e422e75189794e24fe482819d8b1407857c3 (\"Remove getBlockDepth method from Chain::interface\") isn't part of this PR",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#issuecomment-507692011",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14193"
    },
    {
      "event": "mentioned",
      "id": 2454495629,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjQ1NDQ5NTYyOQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2454495629",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-07-02T14:05:05Z"
    },
    {
      "event": "subscribed",
      "id": 2454495630,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDI0NTQ0OTU2MzA=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2454495630",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-07-02T14:05:05Z"
    },
    {
      "event": "commented",
      "id": 507698546,
      "node_id": "MDEyOklzc3VlQ29tbWVudDUwNzY5ODU0Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/507698546",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-07-02T14:20:00Z",
      "updated_at": "2019-07-02T14:20:00Z",
      "author_association": "MEMBER",
      "body": "> @ryanofsky didn't you ack the wrong commit above\r\n\r\nSorry, bad copy and paste from the command line. Edited https://github.com/bitcoin/bitcoin/pull/14193#pullrequestreview-255403869 to fix.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#issuecomment-507698546",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14193"
    },
    {
      "event": "mentioned",
      "id": 2454543401,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjQ1NDU0MzQwMQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2454543401",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-07-02T14:20:01Z"
    },
    {
      "event": "subscribed",
      "id": 2454543403,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDI0NTQ1NDM0MDM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2454543403",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-07-02T14:20:01Z"
    },
    {
      "event": "commented",
      "id": 507702985,
      "node_id": "MDEyOklzc3VlQ29tbWVudDUwNzcwMjk4NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/507702985",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-07-02T14:29:21Z",
      "updated_at": "2019-07-02T14:29:21Z",
      "author_association": "MEMBER",
      "body": "Thanks!",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#issuecomment-507702985",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14193"
    },
    {
      "event": "merged",
      "id": 2454577706,
      "node_id": "MDExOk1lcmdlZEV2ZW50MjQ1NDU3NzcwNg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2454577706",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa2b083c3feb0522baf652045efa6b73458761a3",
      "created_at": "2019-07-02T14:29:43Z"
    },
    {
      "event": "closed",
      "id": 2454577721,
      "node_id": "MDExOkNsb3NlZEV2ZW50MjQ1NDU3NzcyMQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2454577721",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-07-02T14:29:44Z"
    },
    {
      "event": "referenced",
      "id": 2454580926,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDI0NTQ1ODA5MjY=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2454580926",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "c6e42f1ca9c8a2eeb315c68e66dc7e9e8153882a",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c6e42f1ca9c8a2eeb315c68e66dc7e9e8153882a",
      "created_at": "2019-07-02T14:30:41Z"
    },
    {
      "event": "head_ref_deleted",
      "id": 2454668087,
      "node_id": "MDE5OkhlYWRSZWZEZWxldGVkRXZlbnQyNDU0NjY4MDg3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2454668087",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-07-02T14:55:06Z"
    },
    {
      "event": "removed_from_project",
      "id": 2455265523,
      "node_id": "MDIzOlJlbW92ZWRGcm9tUHJvamVjdEV2ZW50MjQ1NTI2NTUyMw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2455265523",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-07-02T18:21:31Z",
      "project_card": {
        "id": 22752064,
        "url": "https://api.github.com/projects/columns/cards/22752064",
        "project_id": 481835,
        "project_url": "https://api.github.com/projects/481835",
        "column_name": "Bugfixes"
      }
    },
    {
      "event": "referenced",
      "id": 2456060769,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDI0NTYwNjA3Njk=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2456060769",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "4408967f3312e8d5bde65de9480515ceb3c162a1",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/4408967f3312e8d5bde65de9480515ceb3c162a1",
      "created_at": "2019-07-03T01:19:20Z"
    },
    {
      "event": "referenced",
      "id": 2745984979,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDI3NDU5ODQ5Nzk=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2745984979",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "e9f73b839ad9732d7c8f2f4fcbf6ef8eaa267fa3",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e9f73b839ad9732d7c8f2f4fcbf6ef8eaa267fa3",
      "created_at": "2019-10-26T09:50:08Z"
    },
    {
      "event": "referenced",
      "id": 3808710673,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDM4MDg3MTA2NzM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3808710673",
      "actor": {
        "login": "jasonbcox",
        "id": 602513,
        "node_id": "MDQ6VXNlcjYwMjUxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/602513?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jasonbcox",
        "html_url": "https://github.com/jasonbcox",
        "followers_url": "https://api.github.com/users/jasonbcox/followers",
        "following_url": "https://api.github.com/users/jasonbcox/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jasonbcox/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jasonbcox/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jasonbcox/subscriptions",
        "organizations_url": "https://api.github.com/users/jasonbcox/orgs",
        "repos_url": "https://api.github.com/users/jasonbcox/repos",
        "events_url": "https://api.github.com/users/jasonbcox/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jasonbcox/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "bcc81a56901219595ddcbb3ea58fcbdcb31345e4",
      "commit_url": "https://api.github.com/repos/Bitcoin-ABC/bitcoin-abc/commits/bcc81a56901219595ddcbb3ea58fcbdcb31345e4",
      "created_at": "2020-09-25T17:30:09Z"
    },
    {
      "event": "referenced",
      "id": 3809648800,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDM4MDk2NDg4MDA=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3809648800",
      "actor": {
        "login": "jasonbcox",
        "id": 602513,
        "node_id": "MDQ6VXNlcjYwMjUxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/602513?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jasonbcox",
        "html_url": "https://github.com/jasonbcox",
        "followers_url": "https://api.github.com/users/jasonbcox/followers",
        "following_url": "https://api.github.com/users/jasonbcox/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jasonbcox/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jasonbcox/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jasonbcox/subscriptions",
        "organizations_url": "https://api.github.com/users/jasonbcox/orgs",
        "repos_url": "https://api.github.com/users/jasonbcox/repos",
        "events_url": "https://api.github.com/users/jasonbcox/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jasonbcox/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "58e79dae40e0273ff0f5c0bcc1ed57edf880533d",
      "commit_url": "https://api.github.com/repos/Bitcoin-ABC/bitcoin-abc/commits/58e79dae40e0273ff0f5c0bcc1ed57edf880533d",
      "created_at": "2020-09-25T22:49:51Z"
    },
    {
      "event": "referenced",
      "id": 3809741057,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDM4MDk3NDEwNTc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3809741057",
      "actor": {
        "login": "jasonbcox",
        "id": 602513,
        "node_id": "MDQ6VXNlcjYwMjUxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/602513?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jasonbcox",
        "html_url": "https://github.com/jasonbcox",
        "followers_url": "https://api.github.com/users/jasonbcox/followers",
        "following_url": "https://api.github.com/users/jasonbcox/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jasonbcox/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jasonbcox/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jasonbcox/subscriptions",
        "organizations_url": "https://api.github.com/users/jasonbcox/orgs",
        "repos_url": "https://api.github.com/users/jasonbcox/repos",
        "events_url": "https://api.github.com/users/jasonbcox/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jasonbcox/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "472a674203368ff0ea8cb28bb58f6b22119d158e",
      "commit_url": "https://api.github.com/repos/Bitcoin-ABC/bitcoin-abc/commits/472a674203368ff0ea8cb28bb58f6b22119d158e",
      "created_at": "2020-09-25T23:33:46Z"
    },
    {
      "event": "referenced",
      "id": 3809741062,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDM4MDk3NDEwNjI=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3809741062",
      "actor": {
        "login": "jasonbcox",
        "id": 602513,
        "node_id": "MDQ6VXNlcjYwMjUxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/602513?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jasonbcox",
        "html_url": "https://github.com/jasonbcox",
        "followers_url": "https://api.github.com/users/jasonbcox/followers",
        "following_url": "https://api.github.com/users/jasonbcox/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jasonbcox/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jasonbcox/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jasonbcox/subscriptions",
        "organizations_url": "https://api.github.com/users/jasonbcox/orgs",
        "repos_url": "https://api.github.com/users/jasonbcox/repos",
        "events_url": "https://api.github.com/users/jasonbcox/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jasonbcox/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "211afcf44c1cb51dee89f4705d0ff5518a0b9828",
      "commit_url": "https://api.github.com/repos/Bitcoin-ABC/bitcoin-abc/commits/211afcf44c1cb51dee89f4705d0ff5518a0b9828",
      "created_at": "2020-09-25T23:33:46Z"
    },
    {
      "event": "referenced",
      "id": 4721109190,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDQ3MjExMDkxOTA=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4721109190",
      "actor": {
        "login": "LarryRuane",
        "id": 8321330,
        "node_id": "MDQ6VXNlcjgzMjEzMzA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8321330?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/LarryRuane",
        "html_url": "https://github.com/LarryRuane",
        "followers_url": "https://api.github.com/users/LarryRuane/followers",
        "following_url": "https://api.github.com/users/LarryRuane/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/LarryRuane/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/LarryRuane/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/LarryRuane/subscriptions",
        "organizations_url": "https://api.github.com/users/LarryRuane/orgs",
        "repos_url": "https://api.github.com/users/LarryRuane/repos",
        "events_url": "https://api.github.com/users/LarryRuane/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/LarryRuane/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "b02e36c230d5d8b13f04bfb5b7ae673e1c4d2714",
      "commit_url": "https://api.github.com/repos/LarryRuane/zcash/commits/b02e36c230d5d8b13f04bfb5b7ae673e1c4d2714",
      "created_at": "2021-05-10T22:02:39Z"
    },
    {
      "event": "referenced",
      "id": 4721109196,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDQ3MjExMDkxOTY=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4721109196",
      "actor": {
        "login": "LarryRuane",
        "id": 8321330,
        "node_id": "MDQ6VXNlcjgzMjEzMzA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8321330?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/LarryRuane",
        "html_url": "https://github.com/LarryRuane",
        "followers_url": "https://api.github.com/users/LarryRuane/followers",
        "following_url": "https://api.github.com/users/LarryRuane/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/LarryRuane/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/LarryRuane/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/LarryRuane/subscriptions",
        "organizations_url": "https://api.github.com/users/LarryRuane/orgs",
        "repos_url": "https://api.github.com/users/LarryRuane/repos",
        "events_url": "https://api.github.com/users/LarryRuane/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/LarryRuane/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "9ee6369bcba23e901fa53b02381052feac12749b",
      "commit_url": "https://api.github.com/repos/LarryRuane/zcash/commits/9ee6369bcba23e901fa53b02381052feac12749b",
      "created_at": "2021-05-10T22:02:39Z"
    },
    {
      "event": "referenced",
      "id": 5566056907,
      "node_id": "REFE_lADOABII584VYtG3zwAAAAFLw0nL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5566056907",
      "actor": {
        "login": "Munkybooty",
        "id": 52090345,
        "node_id": "MDQ6VXNlcjUyMDkwMzQ1",
        "avatar_url": "https://avatars.githubusercontent.com/u/52090345?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Munkybooty",
        "html_url": "https://github.com/Munkybooty",
        "followers_url": "https://api.github.com/users/Munkybooty/followers",
        "following_url": "https://api.github.com/users/Munkybooty/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Munkybooty/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Munkybooty/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Munkybooty/subscriptions",
        "organizations_url": "https://api.github.com/users/Munkybooty/orgs",
        "repos_url": "https://api.github.com/users/Munkybooty/repos",
        "events_url": "https://api.github.com/users/Munkybooty/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Munkybooty/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "5fdbb0b6de5f2c7a3437586acec5dca6843923c3",
      "commit_url": "https://api.github.com/repos/Munkybooty/dash/commits/5fdbb0b6de5f2c7a3437586acec5dca6843923c3",
      "created_at": "2021-11-04T04:08:03Z"
    },
    {
      "event": "locked",
      "id": 5778540832,
      "node_id": "LOE_lADOABII584VYtG3zwAAAAFYbYkg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5778540832",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-16T13:59:21Z",
      "lock_reason": "resolved"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/216480494",
      "pull_request_review_id": 153972481,
      "id": 216480494,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNjQ4MDQ5NA==",
      "diff_hunk": "@@ -2686,6 +2686,7 @@ bool CChainState::ActivateBestChain(CValidationState &state, const CChainParams&\n \n         {\n             LOCK(cs_main);\n+            LOCK(::mempool.cs);",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 31,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fa3e0471a81252e333886b97d8d33bb275061d42",
      "in_reply_to_id": null,
      "user": {
        "login": "practicalswift",
        "id": 7826565,
        "node_id": "MDQ6VXNlcjc4MjY1NjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/practicalswift",
        "html_url": "https://github.com/practicalswift",
        "followers_url": "https://api.github.com/users/practicalswift/followers",
        "following_url": "https://api.github.com/users/practicalswift/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/practicalswift/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/practicalswift/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
        "organizations_url": "https://api.github.com/users/practicalswift/orgs",
        "repos_url": "https://api.github.com/users/practicalswift/repos",
        "events_url": "https://api.github.com/users/practicalswift/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/practicalswift/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Nit: `LOCK2(cs_main, ::mempool.cs);`",
      "created_at": "2018-09-10T21:34:05Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r216480494",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/216480494"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2689,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217189574",
      "pull_request_review_id": 154844614,
      "id": 217189574,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNzE4OTU3NA==",
      "diff_hunk": "@@ -2686,6 +2686,7 @@ bool CChainState::ActivateBestChain(CValidationState &state, const CChainParams&\n \n         {\n             LOCK(cs_main);\n+            LOCK(::mempool.cs);",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 31,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fa3e0471a81252e333886b97d8d33bb275061d42",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "What's the reason for acquiring mempool lock at a broad scope instead of more narrowly where the mempool is actually accessed? Would be nice to have comments in the places where this PR adds locking to indicate purpose of locks and reasoning behind placement.",
      "created_at": "2018-09-12T21:07:33Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r217189574",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217189574"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2689,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/233145184",
      "pull_request_review_id": 174491669,
      "id": 233145184,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMzE0NTE4NA==",
      "diff_hunk": "@@ -2794,6 +2795,7 @@ bool PreciousBlock(CValidationState& state, const CChainParams& params, CBlockIn\n bool CChainState::InvalidateBlock(CValidationState& state, const CChainParams& chainparams, CBlockIndex *pindex)\n {\n     AssertLockHeld(cs_main);\n+    LOCK(::mempool.cs);",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 39,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "dea5dbf2d5ca0177d3a4be665790288bef40e27e",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: Add missing mempool locks\" (dea5dbf2d5ca0177d3a4be665790288bef40e27e)\r\n\r\nCan you add a comment about what this is for? Do you actually need to hold the lock at the broad scope, or could it be acquired just before calling UpdateMempoolForReorg? Maybe:\r\n\r\n```c++\r\n// Mempool lock for UpdateMempool calls below. (Could be released between calls.)\r\nLOCK(::mempool.cs);\r\n```",
      "created_at": "2018-11-13T17:27:15Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r233145184",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/233145184"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2798,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/233150812",
      "pull_request_review_id": 174491669,
      "id": 233150812,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMzE1MDgxMg==",
      "diff_hunk": "@@ -2686,6 +2686,7 @@ bool CChainState::ActivateBestChain(CValidationState &state, const CChainParams&\n \n         {\n             LOCK(cs_main);\n+            LOCK(::mempool.cs);",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 31,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fa3e0471a81252e333886b97d8d33bb275061d42",
      "in_reply_to_id": 217189574,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: Add missing mempool locks\" (dea5dbf2d5ca0177d3a4be665790288bef40e27e)\r\n\r\nIt's not clear why the lock is being acquired here instead of before calling ActivateBestChainStep. It's fine to acquire locks at a broad scope, but it's scary to work with code that acquires locks in unexpected places and gives you no clue where or whether the locks are safe to move. Would suggest either moving the lock to where it is more obviously needed or commenting:\r\n\r\n```c++\r\n// Mempool lock for ActivateBestChainStep calls below. (Could be released between calls.)\r\nLOCK(::mempool.cs);\r\n```\r\n\r\nOr else explaining why it's held more broadly.",
      "created_at": "2018-11-13T17:40:11Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r233150812",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/233150812"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2689,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/233224490",
      "pull_request_review_id": 174491669,
      "id": 233224490,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMzIyNDQ5MA==",
      "diff_hunk": "@@ -468,21 +468,29 @@ static UniValue getblocktemplate(const JSONRPCRequest& request)\n             nTransactionsUpdatedLastLP = nTransactionsUpdatedLast;\n         }\n \n-        // Release the wallet and main lock while waiting\n+        // Release lock while waiting",
      "path": "src/rpc/mining.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "dea5dbf2d5ca0177d3a4be665790288bef40e27e",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: Add missing mempool locks\" (dea5dbf2d5ca0177d3a4be665790288bef40e27e)\r\n\r\nThis is hard to follow. Can you mention this change the commit description? It seems like there is no difference in behavior here except to avoid holding `g_best_block_mutex` while calling `mempool.GetTransactionsUpdated()`? Or am I misinterpreting the diff? If that is the change, it seems good to release the lock, but why is it important do to that now when it wasn't needed before?",
      "created_at": "2018-11-13T21:16:33Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r233224490",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/233224490"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 472,
      "original_line": 472,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/235229141",
      "pull_request_review_id": 177047493,
      "id": 235229141,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzNTIyOTE0MQ==",
      "diff_hunk": "@@ -468,21 +468,29 @@ static UniValue getblocktemplate(const JSONRPCRequest& request)\n             nTransactionsUpdatedLastLP = nTransactionsUpdatedLast;\n         }\n \n-        // Release the wallet and main lock while waiting\n+        // Release lock while waiting",
      "path": "src/rpc/mining.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "dea5dbf2d5ca0177d3a4be665790288bef40e27e",
      "in_reply_to_id": 233224490,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> It seems like there is no difference in behavior here except to avoid holding g_best_block_mutex while calling mempool.GetTransactionsUpdated()?\r\n\r\nThat is indeed the motivation and required to avoid a deadlock. (You should be able to see the deadlock stack by reverting this hunk and running the functional test suite)",
      "created_at": "2018-11-21T01:41:04Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r235229141",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/235229141"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 472,
      "original_line": 472,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/235230718",
      "pull_request_review_id": 177049504,
      "id": 235230718,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzNTIzMDcxOA==",
      "diff_hunk": "@@ -2686,6 +2686,7 @@ bool CChainState::ActivateBestChain(CValidationState &state, const CChainParams&\n \n         {\n             LOCK(cs_main);\n+            LOCK(::mempool.cs);",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 31,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fa3e0471a81252e333886b97d8d33bb275061d42",
      "in_reply_to_id": 217189574,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It is held just as long as cs_main, because anything shorter would allow other threads (potentially rpc threads) to read from the mempool and get a result that is most likely useless in case we are in the middle of a larger reorg.",
      "created_at": "2018-11-21T01:53:19Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r235230718",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/235230718"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2689,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/235230815",
      "pull_request_review_id": 177049619,
      "id": 235230815,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzNTIzMDgxNQ==",
      "diff_hunk": "@@ -468,21 +468,29 @@ static UniValue getblocktemplate(const JSONRPCRequest& request)\n             nTransactionsUpdatedLastLP = nTransactionsUpdatedLast;\n         }\n \n-        // Release the wallet and main lock while waiting\n+        // Release lock while waiting",
      "path": "src/rpc/mining.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "dea5dbf2d5ca0177d3a4be665790288bef40e27e",
      "in_reply_to_id": 233224490,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Oh, and the wallet lock was removed a long time ago, but the comment was never updated.",
      "created_at": "2018-11-21T01:53:57Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r235230815",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/235230815"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 472,
      "original_line": 472,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/235233233",
      "pull_request_review_id": 177052609,
      "id": 235233233,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzNTIzMzIzMw==",
      "diff_hunk": "@@ -2794,6 +2795,7 @@ bool PreciousBlock(CValidationState& state, const CChainParams& params, CBlockIn\n bool CChainState::InvalidateBlock(CValidationState& state, const CChainParams& chainparams, CBlockIndex *pindex)\n {\n     AssertLockHeld(cs_main);\n+    LOCK(::mempool.cs);",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 39,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "dea5dbf2d5ca0177d3a4be665790288bef40e27e",
      "in_reply_to_id": 233145184,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Calling it right before UpdateMempoolForReorg is too fragile and exactly the issue I want to avoid. (E.g. we `DisconnetTip` and then fail to call `UpdateMempoolForReorg`, because another thread acquired the lock)\r\n\r\nAt the very least the mempool lock should be held as long as disconnectpool sits on the stack.",
      "created_at": "2018-11-21T02:11:20Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r235233233",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/235233233"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2798,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/237252285",
      "pull_request_review_id": 179506604,
      "id": 237252285,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzNzI1MjI4NQ==",
      "diff_hunk": "@@ -468,21 +468,29 @@ static UniValue getblocktemplate(const JSONRPCRequest& request)\n             nTransactionsUpdatedLastLP = nTransactionsUpdatedLast;\n         }\n \n-        // Release the wallet and main lock while waiting\n+        // Release lock while waiting",
      "path": "src/rpc/mining.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "dea5dbf2d5ca0177d3a4be665790288bef40e27e",
      "in_reply_to_id": 233224490,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This hunk as-is seems a little overcomplicated to me too if all we want to do is release `g_best_block_mutex` for the mempool operation. This patch (atop `master`) should do:\r\n```patch\r\ndiff --git a/src/rpc/mining.cpp b/src/rpc/mining.cpp\r\nindex c0287ec17..b7f324a97 100644\r\n--- a/src/rpc/mining.cpp\r\n+++ b/src/rpc/mining.cpp\r\n@@ -514,9 +514,14 @@ static UniValue getblocktemplate(const JSONRPCRequest& request)\r\n             {\r\n                 if (g_best_block_cv.wait_until(lock, checktxtime) == std::cv_status::timeout)\r\n                 {\r\n-                    // Timeout: Check transactions for update\r\n+                    // Drop the best block mutex while accessing the mempool to avoid deadlock with\r\n+                    // ::mempool.cs.\r\n+                    LEAVE_CRITICAL_SECTION(lock);\r\n+                    // Break if we've seen new transactions after the timeout has elapsed.\r\n                     if (mempool.GetTransactionsUpdated() != nTransactionsUpdatedLastLP)\r\n                         break;\r\n+                    ENTER_CRITICAL_SECTION(lock);\r\n+\r\n                     checktxtime += std::chrono::seconds(10);\r\n                 }\r\n             }\r\n```\r\n\r\nEdit: ah wait, this isn't exactly the same behavior since it'd be `LOCK`ish and not `WAIT_LOCK`ish... back to the drawing board.\r\nEdit 2: on second inspection, this *should* work since `ENTER_CRITICAL_SECTION` blocks in the same way `WAIT_LOCK` does.",
      "created_at": "2018-11-28T20:41:44Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r237252285",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/237252285"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 472,
      "original_line": 472,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/237546802",
      "pull_request_review_id": 179871886,
      "id": 237546802,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzNzU0NjgwMg==",
      "diff_hunk": "@@ -181,4 +197,101 @@ BOOST_AUTO_TEST_CASE(processnewblock_signals_ordering)\n     BOOST_CHECK_EQUAL(sub.m_expected_tip, chainActive.Tip()->GetBlockHash());\n }\n \n+BOOST_AUTO_TEST_CASE(mempool_locks_reorg)",
      "path": "src/test/validation_block_tests.cpp",
      "position": 87,
      "original_position": 61,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fad0712c6e12ccf2a823602c953ccd1af635edbc",
      "in_reply_to_id": null,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Here's a diff with some added doc and cosmetics:\r\n```patch\r\ndiff --git a/src/test/validation_block_tests.cpp b/src/test/validation_block_tests.cpp\r\nindex 8c285c7e5..f23e299b1 100644\r\n--- a/src/test/validation_block_tests.cpp\r\n+++ b/src/test/validation_block_tests.cpp\r\n@@ -197,14 +197,29 @@ BOOST_AUTO_TEST_CASE(processnewblock_signals_ordering)\r\n     BOOST_CHECK_EQUAL(sub.m_expected_tip, chainActive.Tip()->GetBlockHash());\r\n }\r\n \r\n+/**\r\n+ * Test that mempool updates happen atomically with reorgs.\r\n+ *\r\n+ * This prevents RPC clients, among others, from retrieving immediately-out-of-date mempool data\r\n+ * during large reorgs.\r\n+ *\r\n+ * The test verifies this by creating a chain of `num_txs` blocks, matures their coinbases, and then\r\n+ * submits txns spending from their coinbase to the mempool. A fork chain is then processed,\r\n+ * invalidating the txns and evicting them from the mempool.\r\n+ *\r\n+ * We verify that the mempool updates atomically by polling it continuously from another thread\r\n+ * during the reorg and checking that its size only changes once.\r\n+ */\r\n BOOST_AUTO_TEST_CASE(mempool_locks_reorg)\r\n {\r\n     auto last_mined = GoodBlock(Params().GenesisBlock().GetHash());\r\n-\r\n     bool ignored;\r\n+    auto ProcessBlock = [&ignored](std::shared_ptr<const CBlock> block) -> bool  {\r\n+        return ProcessNewBlock(Params(), block, /* fForceProcessing */ true, /* fNewBlock */ &ignored);\r\n+    };\r\n     // Process all mined blocks\r\n-    BOOST_REQUIRE(ProcessNewBlock(Params(), std::make_shared<CBlock>(Params().GenesisBlock()), /* fForceProcessing */ true, /* fNewBlock */ &ignored));\r\n-    BOOST_REQUIRE(ProcessNewBlock(Params(), last_mined, /* fForceProcessing */ true, /* fNewBlock */ &ignored));\r\n+    BOOST_REQUIRE(ProcessBlock(std::make_shared<CBlock>(Params().GenesisBlock())));\r\n+    BOOST_REQUIRE(ProcessBlock(last_mined));\r\n \r\n     // Run the test multiple times\r\n     for (int test_runs = 3; !!test_runs; --test_runs) {\r\n@@ -225,13 +240,13 @@ BOOST_AUTO_TEST_CASE(mempool_locks_reorg)\r\n             txs.push_back(MakeTransactionRef(mtx));\r\n \r\n             last_mined = GoodBlock(last_mined->GetHash());\r\n-            BOOST_REQUIRE(ProcessNewBlock(Params(), last_mined, /* fForceProcessing */ true, /* fNewBlock */ &ignored));\r\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\r\n         }\r\n \r\n         // Mature the inputs of the txs\r\n         for (int j = COINBASE_MATURITY; !!j; --j) {\r\n             last_mined = GoodBlock(last_mined->GetHash());\r\n-            BOOST_REQUIRE(ProcessNewBlock(Params(), last_mined, /* fForceProcessing */ true, /* fNewBlock */ &ignored));\r\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\r\n         }\r\n \r\n         // Add the txs to the tx pool\r\n@@ -282,10 +297,10 @@ BOOST_AUTO_TEST_CASE(mempool_locks_reorg)\r\n \r\n         // Mine a reorg in this thread to invalidate and remove the txs from the tx pool\r\n         last_mined = GoodBlock(split_hash);\r\n-        ProcessNewBlock(Params(), last_mined, /* fForceProcessing */ true, /* fNewBlock */ &ignored);\r\n+        ProcessBlock(last_mined);\r\n         for (size_t j = COINBASE_MATURITY + txs.size() + 1; j; --j) {\r\n             last_mined = GoodBlock(last_mined->GetHash());\r\n-            ProcessNewBlock(Params(), last_mined, /* fForceProcessing */ true, /* fNewBlock */ &ignored);\r\n+            ProcessBlock(last_mined);\r\n         }\r\n         // Check that the reorg was eventually successful\r\n         BOOST_CHECK_EQUAL(last_mined->GetHash(), ::chainActive.Tip()->GetBlockHash());\r\n```",
      "created_at": "2018-11-29T15:58:25Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r237546802",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/237546802"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 224,
      "original_line": 224,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/237989280",
      "pull_request_review_id": 180431962,
      "id": 237989280,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzNzk4OTI4MA==",
      "diff_hunk": "@@ -559,7 +559,7 @@ class CTxMemPool\n      * Check that none of this transactions inputs are in the mempool, and thus\n      * the tx is not dependent on other mempool transactions to be included in a block.\n      */\n-    bool HasNoInputsOf(const CTransaction& tx) const;\n+    bool HasNoInputsOf(const CTransaction& tx) const EXCLUSIVE_LOCKS_REQUIRED(cs);",
      "path": "src/txmempool.h",
      "position": 69,
      "original_position": 5,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fae71ffc99b04bbcb96f4e2b6fa25ed2fe258912",
      "in_reply_to_id": null,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Would it be clearer to just add `LOCK(cs);` to the top of [the function definition](https://github.com/jamesob/bitcoin/blob/81bd349c9c8dd247d32ece1adcc6db1254ef8971/src/txmempool.cpp#L885-L886) instead of this annotation since there's a recursive lock acquisition in `CTxMempool::exists` anyway?",
      "created_at": "2018-11-30T20:14:01Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r237989280",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/237989280"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 593,
      "original_line": 593,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/237990805",
      "pull_request_review_id": 180431962,
      "id": 237990805,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzNzk5MDgwNQ==",
      "diff_hunk": "@@ -436,7 +436,7 @@ bool CheckSequenceLocks(const CTxMemPool& pool, const CTransaction& tx, int flag\n // Returns the script flags which should be checked for a given block\n static unsigned int GetBlockScriptFlags(const CBlockIndex* pindex, const Consensus::Params& chainparams);\n \n-static void LimitMempoolSize(CTxMemPool& pool, size_t limit, unsigned long age) {\n+static void LimitMempoolSize(CTxMemPool& pool, size_t limit, unsigned long age) EXCLUSIVE_LOCKS_REQUIRED(pool.cs) {",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fae71ffc99b04bbcb96f4e2b6fa25ed2fe258912",
      "in_reply_to_id": null,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "We require the `pool.cs` lock for the duration of this function (instead of just relying on the lock in `pool.Expire`) because we want to keep the mempool from changing while `pcoinsTip` modifications happen, correct?",
      "created_at": "2018-11-30T20:19:28Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r237990805",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/237990805"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 439,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/238000878",
      "pull_request_review_id": 180447452,
      "id": 238000878,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzODAwMDg3OA==",
      "diff_hunk": "@@ -559,7 +559,7 @@ class CTxMemPool\n      * Check that none of this transactions inputs are in the mempool, and thus\n      * the tx is not dependent on other mempool transactions to be included in a block.\n      */\n-    bool HasNoInputsOf(const CTransaction& tx) const;\n+    bool HasNoInputsOf(const CTransaction& tx) const EXCLUSIVE_LOCKS_REQUIRED(cs);",
      "path": "src/txmempool.h",
      "position": 69,
      "original_position": 5,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fae71ffc99b04bbcb96f4e2b6fa25ed2fe258912",
      "in_reply_to_id": 237989280,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Imo it is clearer to let the caller figure out how long the lock is required to be held. Imagine this is called in a loop, the you, most likely, wouldn't want to release the lock in between each iteration? Also, it happens that all callers already have the lock taken, since this annotation can be added without any other changes.",
      "created_at": "2018-11-30T21:01:02Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r238000878",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/238000878"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 593,
      "original_line": 593,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/238001324",
      "pull_request_review_id": 180448049,
      "id": 238001324,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzODAwMTMyNA==",
      "diff_hunk": "@@ -436,7 +436,7 @@ bool CheckSequenceLocks(const CTxMemPool& pool, const CTransaction& tx, int flag\n // Returns the script flags which should be checked for a given block\n static unsigned int GetBlockScriptFlags(const CBlockIndex* pindex, const Consensus::Params& chainparams);\n \n-static void LimitMempoolSize(CTxMemPool& pool, size_t limit, unsigned long age) {\n+static void LimitMempoolSize(CTxMemPool& pool, size_t limit, unsigned long age) EXCLUSIVE_LOCKS_REQUIRED(pool.cs) {",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fae71ffc99b04bbcb96f4e2b6fa25ed2fe258912",
      "in_reply_to_id": 237990805,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yeah, calling `LimitMempoolSize` only makes sense after you have written to the mempool, in which case you already have acquired the lock and can keep it for `LimitMempoolSize`.",
      "created_at": "2018-11-30T21:02:57Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r238001324",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/238001324"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 439,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/238439300",
      "pull_request_review_id": 180982067,
      "id": 238439300,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzODQzOTMwMA==",
      "diff_hunk": "@@ -559,7 +559,7 @@ class CTxMemPool\n      * Check that none of this transactions inputs are in the mempool, and thus\n      * the tx is not dependent on other mempool transactions to be included in a block.\n      */\n-    bool HasNoInputsOf(const CTransaction& tx) const;\n+    bool HasNoInputsOf(const CTransaction& tx) const EXCLUSIVE_LOCKS_REQUIRED(cs);",
      "path": "src/txmempool.h",
      "position": 69,
      "original_position": 5,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fae71ffc99b04bbcb96f4e2b6fa25ed2fe258912",
      "in_reply_to_id": 237989280,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yep, makes sense.",
      "created_at": "2018-12-03T21:13:26Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r238439300",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/238439300"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 593,
      "original_line": 593,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/239493241",
      "pull_request_review_id": 182291568,
      "id": 239493241,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzOTQ5MzI0MQ==",
      "diff_hunk": "@@ -478,9 +478,14 @@ static UniValue getblocktemplate(const JSONRPCRequest& request)\n             {\n                 if (g_best_block_cv.wait_until(lock, checktxtime) == std::cv_status::timeout)\n                 {\n-                    // Timeout: Check transactions for update\n+                    // Drop the best block mutex while accessing the mempool to avoid deadlock with\n+                    // ::mempool.cs.\n+                    LEAVE_CRITICAL_SECTION(lock);\n+                    // Break if we've seen new transactions after the timeout has elapsed.\n                     if (mempool.GetTransactionsUpdated() != nTransactionsUpdatedLastLP)\n                         break;\n+                    ENTER_CRITICAL_SECTION(lock);",
      "path": "src/rpc/mining.cpp",
      "position": null,
      "original_position": 20,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fae71ffc99b04bbcb96f4e2b6fa25ed2fe258912",
      "in_reply_to_id": null,
      "user": {
        "login": "practicalswift",
        "id": 7826565,
        "node_id": "MDQ6VXNlcjc4MjY1NjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/practicalswift",
        "html_url": "https://github.com/practicalswift",
        "followers_url": "https://api.github.com/users/practicalswift/followers",
        "following_url": "https://api.github.com/users/practicalswift/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/practicalswift/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/practicalswift/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
        "organizations_url": "https://api.github.com/users/practicalswift/orgs",
        "repos_url": "https://api.github.com/users/practicalswift/repos",
        "events_url": "https://api.github.com/users/practicalswift/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/practicalswift/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`ENTER_CRITICAL_SECTION(…);` isn't RAII, right?\r\n\r\n~Do we need to explicitly `LEAVE_CRITICAL_SECTION(…);` when exiting the loop?~",
      "created_at": "2018-12-06T15:22:45Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r239493241",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/239493241"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 488,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/239497470",
      "pull_request_review_id": 182297013,
      "id": 239497470,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzOTQ5NzQ3MA==",
      "diff_hunk": "@@ -478,9 +478,14 @@ static UniValue getblocktemplate(const JSONRPCRequest& request)\n             {\n                 if (g_best_block_cv.wait_until(lock, checktxtime) == std::cv_status::timeout)\n                 {\n-                    // Timeout: Check transactions for update\n+                    // Drop the best block mutex while accessing the mempool to avoid deadlock with\n+                    // ::mempool.cs.\n+                    LEAVE_CRITICAL_SECTION(lock);\n+                    // Break if we've seen new transactions after the timeout has elapsed.\n                     if (mempool.GetTransactionsUpdated() != nTransactionsUpdatedLastLP)\n                         break;\n+                    ENTER_CRITICAL_SECTION(lock);",
      "path": "src/rpc/mining.cpp",
      "position": null,
      "original_position": 20,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fae71ffc99b04bbcb96f4e2b6fa25ed2fe258912",
      "in_reply_to_id": 239493241,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Nope; the `unlock()`/debug stack pop that `LEAVE_CRITICAL_SECTION(...)` would perform is implicit to the destruction of `lock` when it falls out of scope after the `break`.",
      "created_at": "2018-12-06T15:32:56Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r239497470",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/239497470"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 488,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/239498987",
      "pull_request_review_id": 182298981,
      "id": 239498987,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzOTQ5ODk4Nw==",
      "diff_hunk": "@@ -478,9 +478,14 @@ static UniValue getblocktemplate(const JSONRPCRequest& request)\n             {\n                 if (g_best_block_cv.wait_until(lock, checktxtime) == std::cv_status::timeout)\n                 {\n-                    // Timeout: Check transactions for update\n+                    // Drop the best block mutex while accessing the mempool to avoid deadlock with\n+                    // ::mempool.cs.\n+                    LEAVE_CRITICAL_SECTION(lock);\n+                    // Break if we've seen new transactions after the timeout has elapsed.\n                     if (mempool.GetTransactionsUpdated() != nTransactionsUpdatedLastLP)\n                         break;\n+                    ENTER_CRITICAL_SECTION(lock);",
      "path": "src/rpc/mining.cpp",
      "position": null,
      "original_position": 20,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fae71ffc99b04bbcb96f4e2b6fa25ed2fe258912",
      "in_reply_to_id": 239493241,
      "user": {
        "login": "practicalswift",
        "id": 7826565,
        "node_id": "MDQ6VXNlcjc4MjY1NjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/practicalswift",
        "html_url": "https://github.com/practicalswift",
        "followers_url": "https://api.github.com/users/practicalswift/followers",
        "following_url": "https://api.github.com/users/practicalswift/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/practicalswift/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/practicalswift/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
        "organizations_url": "https://api.github.com/users/practicalswift/orgs",
        "repos_url": "https://api.github.com/users/practicalswift/repos",
        "events_url": "https://api.github.com/users/practicalswift/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/practicalswift/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@jamesob Makes perfect sense: saw the `WAIT_LOCK(g_best_block_mutex, lock);` now. Thanks.",
      "created_at": "2018-12-06T15:36:36Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r239498987",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/239498987"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 488,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240339698",
      "pull_request_review_id": 183347740,
      "id": 240339698,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MDMzOTY5OA==",
      "diff_hunk": "@@ -181,4 +197,116 @@ BOOST_AUTO_TEST_CASE(processnewblock_signals_ordering)\n     BOOST_CHECK_EQUAL(sub.m_expected_tip, chainActive.Tip()->GetBlockHash());\n }\n \n+/**\n+ * Test that mempool updates happen atomically with reorgs.\n+ *\n+ * This prevents RPC clients, among others, from retrieving immediately-out-of-date mempool data\n+ * during large reorgs.\n+ *\n+ * The test verifies this by creating a chain of `num_txs` blocks, matures their coinbases, and then\n+ * submits txns spending from their coinbase to the mempool. A fork chain is then processed,\n+ * invalidating the txns and evicting them from the mempool.\n+ *\n+ * We verify that the mempool updates atomically by polling it continuously from another thread\n+ * during the reorg and checking that its size only changes once.",
      "path": "src/test/validation_block_tests.cpp",
      "position": null,
      "original_position": 72,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fae71ffc99b04bbcb96f4e2b6fa25ed2fe258912",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It wasn't clear from reading this why size changing once was a useful thing to check. It would help to add some more explanation from your comment in https://github.com/bitcoin/bitcoin/pull/14193#issuecomment-440504118. Maybe an additional sentence: \"The size changing exactly once indicates that the polling thread's view of the mempool is either consistent with the chain state before reorg, or consistent with the chain state after the reorg, and not just consistent with some intermediate state during the reorg.\r\n\r\n",
      "created_at": "2018-12-10T19:03:47Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r240339698",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240339698"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 211,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240341166",
      "pull_request_review_id": 183347740,
      "id": 240341166,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MDM0MTE2Ng==",
      "diff_hunk": "@@ -181,4 +197,116 @@ BOOST_AUTO_TEST_CASE(processnewblock_signals_ordering)\n     BOOST_CHECK_EQUAL(sub.m_expected_tip, chainActive.Tip()->GetBlockHash());\n }\n \n+/**\n+ * Test that mempool updates happen atomically with reorgs.\n+ *\n+ * This prevents RPC clients, among others, from retrieving immediately-out-of-date mempool data\n+ * during large reorgs.\n+ *\n+ * The test verifies this by creating a chain of `num_txs` blocks, matures their coinbases, and then\n+ * submits txns spending from their coinbase to the mempool. A fork chain is then processed,\n+ * invalidating the txns and evicting them from the mempool.\n+ *\n+ * We verify that the mempool updates atomically by polling it continuously from another thread\n+ * during the reorg and checking that its size only changes once.\n+ */\n+BOOST_AUTO_TEST_CASE(mempool_locks_reorg)\n+{\n+    auto last_mined = GoodBlock(Params().GenesisBlock().GetHash());",
      "path": "src/test/validation_block_tests.cpp",
      "position": null,
      "original_position": 76,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fae71ffc99b04bbcb96f4e2b6fa25ed2fe258912",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Maybe declare `last_mined` below where it is used. It was confusing to see it not used at all in the lambda and then later referenced below.",
      "created_at": "2018-12-10T19:08:12Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r240341166",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240341166"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 215,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240342002",
      "pull_request_review_id": 183347740,
      "id": 240342002,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MDM0MjAwMg==",
      "diff_hunk": "@@ -181,4 +197,116 @@ BOOST_AUTO_TEST_CASE(processnewblock_signals_ordering)\n     BOOST_CHECK_EQUAL(sub.m_expected_tip, chainActive.Tip()->GetBlockHash());\n }\n \n+/**\n+ * Test that mempool updates happen atomically with reorgs.\n+ *\n+ * This prevents RPC clients, among others, from retrieving immediately-out-of-date mempool data\n+ * during large reorgs.\n+ *\n+ * The test verifies this by creating a chain of `num_txs` blocks, matures their coinbases, and then\n+ * submits txns spending from their coinbase to the mempool. A fork chain is then processed,\n+ * invalidating the txns and evicting them from the mempool.\n+ *\n+ * We verify that the mempool updates atomically by polling it continuously from another thread\n+ * during the reorg and checking that its size only changes once.\n+ */\n+BOOST_AUTO_TEST_CASE(mempool_locks_reorg)\n+{\n+    auto last_mined = GoodBlock(Params().GenesisBlock().GetHash());\n+    bool ignored;\n+    auto ProcessBlock = [&ignored](std::shared_ptr<const CBlock> block) -> bool  {\n+        return ProcessNewBlock(Params(), block, /* fForceProcessing */ true, /* fNewBlock */ &ignored);\n+    };\n+    // Process all mined blocks\n+    BOOST_REQUIRE(ProcessBlock(std::make_shared<CBlock>(Params().GenesisBlock())));\n+    BOOST_REQUIRE(ProcessBlock(last_mined));\n+\n+    // Run the test multiple times\n+    for (int test_runs = 3; !!test_runs; --test_runs) {",
      "path": "src/test/validation_block_tests.cpp",
      "position": null,
      "original_position": 86,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fae71ffc99b04bbcb96f4e2b6fa25ed2fe258912",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Why `!!test_runs` everywhere in this PR instead of `test_runs > 0`? This seems strange, and less readable. Also, why count backwards instead of forwards?",
      "created_at": "2018-12-10T19:10:37Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r240342002",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240342002"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 225,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240345505",
      "pull_request_review_id": 183347740,
      "id": 240345505,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MDM0NTUwNQ==",
      "diff_hunk": "@@ -181,4 +197,116 @@ BOOST_AUTO_TEST_CASE(processnewblock_signals_ordering)\n     BOOST_CHECK_EQUAL(sub.m_expected_tip, chainActive.Tip()->GetBlockHash());\n }\n \n+/**\n+ * Test that mempool updates happen atomically with reorgs.\n+ *\n+ * This prevents RPC clients, among others, from retrieving immediately-out-of-date mempool data\n+ * during large reorgs.\n+ *\n+ * The test verifies this by creating a chain of `num_txs` blocks, matures their coinbases, and then\n+ * submits txns spending from their coinbase to the mempool. A fork chain is then processed,\n+ * invalidating the txns and evicting them from the mempool.\n+ *\n+ * We verify that the mempool updates atomically by polling it continuously from another thread\n+ * during the reorg and checking that its size only changes once.\n+ */\n+BOOST_AUTO_TEST_CASE(mempool_locks_reorg)\n+{\n+    auto last_mined = GoodBlock(Params().GenesisBlock().GetHash());\n+    bool ignored;\n+    auto ProcessBlock = [&ignored](std::shared_ptr<const CBlock> block) -> bool  {\n+        return ProcessNewBlock(Params(), block, /* fForceProcessing */ true, /* fNewBlock */ &ignored);\n+    };\n+    // Process all mined blocks\n+    BOOST_REQUIRE(ProcessBlock(std::make_shared<CBlock>(Params().GenesisBlock())));\n+    BOOST_REQUIRE(ProcessBlock(last_mined));\n+\n+    // Run the test multiple times\n+    for (int test_runs = 3; !!test_runs; --test_runs) {\n+        BOOST_CHECK_EQUAL(last_mined->GetHash(), ::chainActive.Tip()->GetBlockHash());\n+\n+        // Later on split from here\n+        const uint256 split_hash{last_mined->hashPrevBlock};\n+\n+        // Create a bunch of transactions to spend the miner rewards of the\n+        // most recent blocks\n+        std::vector<CTransactionRef> txs;\n+        for (int num_txs = 22; !!num_txs; --num_txs) {\n+            CMutableTransaction mtx;\n+            mtx.vin.push_back(CTxIn{COutPoint{last_mined->vtx[0]->GetHash(), 1}, CScript{}});\n+            mtx.vin[0].scriptWitness.stack.push_back(V_OP_TRUE);\n+            mtx.vout.push_back(last_mined->vtx[0]->vout[1]);\n+            mtx.vout[0].nValue -= 1000;\n+            txs.push_back(MakeTransactionRef(mtx));\n+\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\n+        }\n+\n+        // Mature the inputs of the txs\n+        for (int j = COINBASE_MATURITY; !!j; --j) {\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\n+        }\n+\n+        // Add the txs to the tx pool\n+        {\n+            LOCK(cs_main);\n+            CValidationState state;\n+            std::list<CTransactionRef> plTxnReplaced;\n+            for (const auto& tx : txs) {\n+                BOOST_REQUIRE(AcceptToMemoryPool(\n+                    ::mempool,\n+                    state,\n+                    tx,\n+                    /* pfMissingInputs */ &ignored,\n+                    &plTxnReplaced,\n+                    /* bypass_limits */ false,\n+                    /* nAbsurdFee */ 0));\n+            }\n+        }\n+\n+        // Check that all txs are in the pool\n+        {\n+            LOCK(::mempool.cs);\n+            BOOST_CHECK_EQUAL(::mempool.mapTx.size(), txs.size());\n+        }\n+\n+        // Run a thread that simulates an RPC caller that is polling while\n+        // validation is doing a reorg\n+        const uint256 tip_init{last_mined->GetHash()};\n+        std::thread rpc_thread{[&]() {\n+            while (true) {\n+                LOCK(::mempool.cs);\n+                if (::mempool.mapTx.size() == 0) {\n+                    // We are done with the reorg\n+                    break;\n+                }\n+                // Internally, we might be in the middle of the reorg, but\n+                // externally the reorg to the most-proof-of-work chain should\n+                // be atomic. So the caller assumes that the returned mempool\n+                // is consistent. That is, it has all txs that were there\n+                // before the reorg.\n+                assert(::mempool.mapTx.size() == txs.size());\n+                continue;\n+            }\n+            LOCK(cs_main);\n+            // We are done with the reorg, so the tip must have changed\n+            assert(tip_init != ::chainActive.Tip()->GetBlockHash());\n+        }};\n+\n+        // Mine a reorg in this thread to invalidate and remove the txs from the tx pool\n+        last_mined = GoodBlock(split_hash);\n+        ProcessBlock(last_mined);\n+        for (size_t j = COINBASE_MATURITY + txs.size() + 1; j; --j) {",
      "path": "src/test/validation_block_tests.cpp",
      "position": null,
      "original_position": 162,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fae71ffc99b04bbcb96f4e2b6fa25ed2fe258912",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "No more !! here? And I was just getting used to it...",
      "created_at": "2018-12-10T19:20:55Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r240345505",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240345505"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 301,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240347801",
      "pull_request_review_id": 183347740,
      "id": 240347801,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MDM0NzgwMQ==",
      "diff_hunk": "@@ -181,4 +197,116 @@ BOOST_AUTO_TEST_CASE(processnewblock_signals_ordering)\n     BOOST_CHECK_EQUAL(sub.m_expected_tip, chainActive.Tip()->GetBlockHash());\n }\n \n+/**\n+ * Test that mempool updates happen atomically with reorgs.\n+ *\n+ * This prevents RPC clients, among others, from retrieving immediately-out-of-date mempool data\n+ * during large reorgs.\n+ *\n+ * The test verifies this by creating a chain of `num_txs` blocks, matures their coinbases, and then\n+ * submits txns spending from their coinbase to the mempool. A fork chain is then processed,\n+ * invalidating the txns and evicting them from the mempool.\n+ *\n+ * We verify that the mempool updates atomically by polling it continuously from another thread\n+ * during the reorg and checking that its size only changes once.\n+ */\n+BOOST_AUTO_TEST_CASE(mempool_locks_reorg)\n+{\n+    auto last_mined = GoodBlock(Params().GenesisBlock().GetHash());\n+    bool ignored;\n+    auto ProcessBlock = [&ignored](std::shared_ptr<const CBlock> block) -> bool  {\n+        return ProcessNewBlock(Params(), block, /* fForceProcessing */ true, /* fNewBlock */ &ignored);\n+    };\n+    // Process all mined blocks\n+    BOOST_REQUIRE(ProcessBlock(std::make_shared<CBlock>(Params().GenesisBlock())));\n+    BOOST_REQUIRE(ProcessBlock(last_mined));\n+\n+    // Run the test multiple times\n+    for (int test_runs = 3; !!test_runs; --test_runs) {\n+        BOOST_CHECK_EQUAL(last_mined->GetHash(), ::chainActive.Tip()->GetBlockHash());\n+\n+        // Later on split from here\n+        const uint256 split_hash{last_mined->hashPrevBlock};\n+\n+        // Create a bunch of transactions to spend the miner rewards of the\n+        // most recent blocks\n+        std::vector<CTransactionRef> txs;\n+        for (int num_txs = 22; !!num_txs; --num_txs) {\n+            CMutableTransaction mtx;\n+            mtx.vin.push_back(CTxIn{COutPoint{last_mined->vtx[0]->GetHash(), 1}, CScript{}});\n+            mtx.vin[0].scriptWitness.stack.push_back(V_OP_TRUE);\n+            mtx.vout.push_back(last_mined->vtx[0]->vout[1]);\n+            mtx.vout[0].nValue -= 1000;\n+            txs.push_back(MakeTransactionRef(mtx));\n+\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\n+        }\n+\n+        // Mature the inputs of the txs\n+        for (int j = COINBASE_MATURITY; !!j; --j) {\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\n+        }\n+\n+        // Add the txs to the tx pool\n+        {\n+            LOCK(cs_main);\n+            CValidationState state;\n+            std::list<CTransactionRef> plTxnReplaced;\n+            for (const auto& tx : txs) {\n+                BOOST_REQUIRE(AcceptToMemoryPool(\n+                    ::mempool,\n+                    state,\n+                    tx,\n+                    /* pfMissingInputs */ &ignored,\n+                    &plTxnReplaced,\n+                    /* bypass_limits */ false,\n+                    /* nAbsurdFee */ 0));\n+            }\n+        }\n+\n+        // Check that all txs are in the pool\n+        {\n+            LOCK(::mempool.cs);\n+            BOOST_CHECK_EQUAL(::mempool.mapTx.size(), txs.size());\n+        }\n+\n+        // Run a thread that simulates an RPC caller that is polling while\n+        // validation is doing a reorg\n+        const uint256 tip_init{last_mined->GetHash()};\n+        std::thread rpc_thread{[&]() {\n+            while (true) {\n+                LOCK(::mempool.cs);\n+                if (::mempool.mapTx.size() == 0) {\n+                    // We are done with the reorg\n+                    break;\n+                }\n+                // Internally, we might be in the middle of the reorg, but\n+                // externally the reorg to the most-proof-of-work chain should\n+                // be atomic. So the caller assumes that the returned mempool\n+                // is consistent. That is, it has all txs that were there\n+                // before the reorg.\n+                assert(::mempool.mapTx.size() == txs.size());",
      "path": "src/test/validation_block_tests.cpp",
      "position": 178,
      "original_position": 151,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fae71ffc99b04bbcb96f4e2b6fa25ed2fe258912",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This is actually doing more than checking that \"size only changes once\" as described in the summary comment above. It is checking that the mempool either contains **all** of the transactions invalidated by the reorg, or **none** of them, and not some intermediate amount. Could update the comment above to say this instead.",
      "created_at": "2018-12-10T19:27:34Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r240347801",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240347801"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 315,
      "original_line": 315,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240361372",
      "pull_request_review_id": 183347740,
      "id": 240361372,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MDM2MTM3Mg==",
      "diff_hunk": "@@ -478,9 +478,14 @@ static UniValue getblocktemplate(const JSONRPCRequest& request)\n             {\n                 if (g_best_block_cv.wait_until(lock, checktxtime) == std::cv_status::timeout)\n                 {\n-                    // Timeout: Check transactions for update\n+                    // Drop the best block mutex while accessing the mempool to avoid deadlock with\n+                    // ::mempool.cs.",
      "path": "src/rpc/mining.cpp",
      "position": null,
      "original_position": 15,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "d9e6cb497bd540078dbf32536825fa3bfd60df42",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This seems less than ideal. I would guess that we don't actually need `ConnectTip` and `DisconnectTip` be holding on to `mempool.cs` while they wait to notify this RPC. At least would seem more straightforward if `g_best_block_cv` got notified after the fact, when `mempool.cs` was already released.\r\n\r\nI think it would be good to add a TODO to untangle these locks on the future, or a normal comment if mixing these locks has some benefits which are not apparent. The best place to comment would be on the `g_best_block_mutex` variable. It might also be good to add `ACQUIRED_AFTER` annotations there to prevent another deadlock like this.",
      "created_at": "2018-12-10T20:06:13Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r240361372",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240361372"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 483,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240414928",
      "pull_request_review_id": 183347740,
      "id": 240414928,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MDQxNDkyOA==",
      "diff_hunk": "@@ -2686,6 +2686,7 @@ bool CChainState::ActivateBestChain(CValidationState &state, const CChainParams&\n \n         {\n             LOCK(cs_main);\n+            LOCK(::mempool.cs); // Lock for at least as long as it takes for connectTrace to be consumed",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 31,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "d9e6cb497bd540078dbf32536825fa3bfd60df42",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: Add missing mempool locks\" (d9e6cb497bd540078dbf32536825fa3bfd60df42)\r\n\r\nre:https://github.com/bitcoin/bitcoin/pull/14193#discussion_r233150812\r\n\r\n> It's not clear why the lock is being acquired here instead of before calling ActivateBestChainStep.\r\n\r\nThank you for adding the comment. But this is still not clear to me. If this code locked the `mempool.cs` before calling `ActivateBestChainStep` and unlocked it immediately after it returned, would there be a bug? `ActivateBestChainStep` already updates the mempool, so if this code isn't locking to maintain the invariant that views of the mempool are consistent with chainActive, what invariant is it trying to maintain?",
      "created_at": "2018-12-10T23:01:00Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r240414928",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240414928"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2689,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240423959",
      "pull_request_review_id": 183347740,
      "id": 240423959,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI0MDQyMzk1OQ==",
      "diff_hunk": "@@ -2794,6 +2795,7 @@ bool PreciousBlock(CValidationState& state, const CChainParams& params, CBlockIn\n bool CChainState::InvalidateBlock(CValidationState& state, const CChainParams& chainparams, CBlockIndex *pindex)\n {\n     AssertLockHeld(cs_main);\n+    LOCK(::mempool.cs); // Lock for as long as disconnectpool is in scope to make sure UpdateMempoolForReorg is called after DisconnetTip without unlocking in between",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 39,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "d9e6cb497bd540078dbf32536825fa3bfd60df42",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"[test] Add test to check mempool consistency in case of reorgs\" (fae71ffc99b04bbcb96f4e2b6fa25ed2fe258912)\r\n\r\n> Calling it right before UpdateMempoolForReorg is too fragile and exactly the issue I want to avoid. (E.g. we DisconnetTip and then fail to call UpdateMempoolForReorg, because another thread acquired the lock)\r\n\r\nThanks for explaining and adding the comment. It is clear if mempool.cs needs to provide views of the mempool that are consistent with chainActive, then it needs to be locked between the first DisconnectTip call and the final UpdateMempoolForReorg call. But it would seem clearer and safer to lock the mempool right where `disconnectpool` is declared and to unlock it right after UpdateMempoolForReorg returns, instead of continuing to hold it while sending UI notifications.\r\n\r\nAlso it seems like both DisconnectTip and ConnectTip should be annotated with `EXCLUSIVE_LOCKS_REQUIRED(cs_main, ::mempool.cs)`, and for some reason they aren't.",
      "created_at": "2018-12-10T23:38:19Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r240423959",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/240423959"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2801,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255661199",
      "pull_request_review_id": 202298204,
      "id": 255661199,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTY2MTE5OQ==",
      "diff_hunk": "@@ -478,9 +478,14 @@ static UniValue getblocktemplate(const JSONRPCRequest& request)\n             {\n                 if (g_best_block_cv.wait_until(lock, checktxtime) == std::cv_status::timeout)\n                 {\n-                    // Timeout: Check transactions for update\n+                    // Drop the best block mutex while accessing the mempool to avoid deadlock with\n+                    // ::mempool.cs.",
      "path": "src/rpc/mining.cpp",
      "position": null,
      "original_position": 15,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "d9e6cb497bd540078dbf32536825fa3bfd60df42",
      "in_reply_to_id": 240361372,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Does you comment still apply after my latest rebase? Also, `ACQUIRED_AFTER` only works in very limited setttings (e.g. not across translation units or even function bodies). We don't use it anywhere else, so I will leave this as is for now.",
      "created_at": "2019-02-11T19:36:08Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r255661199",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255661199"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 483,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255661638",
      "pull_request_review_id": 202298743,
      "id": 255661638,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTY2MTYzOA==",
      "diff_hunk": "@@ -181,4 +197,116 @@ BOOST_AUTO_TEST_CASE(processnewblock_signals_ordering)\n     BOOST_CHECK_EQUAL(sub.m_expected_tip, chainActive.Tip()->GetBlockHash());\n }\n \n+/**\n+ * Test that mempool updates happen atomically with reorgs.\n+ *\n+ * This prevents RPC clients, among others, from retrieving immediately-out-of-date mempool data\n+ * during large reorgs.\n+ *\n+ * The test verifies this by creating a chain of `num_txs` blocks, matures their coinbases, and then\n+ * submits txns spending from their coinbase to the mempool. A fork chain is then processed,\n+ * invalidating the txns and evicting them from the mempool.\n+ *\n+ * We verify that the mempool updates atomically by polling it continuously from another thread\n+ * during the reorg and checking that its size only changes once.\n+ */\n+BOOST_AUTO_TEST_CASE(mempool_locks_reorg)\n+{\n+    auto last_mined = GoodBlock(Params().GenesisBlock().GetHash());\n+    bool ignored;\n+    auto ProcessBlock = [&ignored](std::shared_ptr<const CBlock> block) -> bool  {\n+        return ProcessNewBlock(Params(), block, /* fForceProcessing */ true, /* fNewBlock */ &ignored);\n+    };\n+    // Process all mined blocks\n+    BOOST_REQUIRE(ProcessBlock(std::make_shared<CBlock>(Params().GenesisBlock())));\n+    BOOST_REQUIRE(ProcessBlock(last_mined));\n+\n+    // Run the test multiple times\n+    for (int test_runs = 3; !!test_runs; --test_runs) {\n+        BOOST_CHECK_EQUAL(last_mined->GetHash(), ::chainActive.Tip()->GetBlockHash());\n+\n+        // Later on split from here\n+        const uint256 split_hash{last_mined->hashPrevBlock};\n+\n+        // Create a bunch of transactions to spend the miner rewards of the\n+        // most recent blocks\n+        std::vector<CTransactionRef> txs;\n+        for (int num_txs = 22; !!num_txs; --num_txs) {\n+            CMutableTransaction mtx;\n+            mtx.vin.push_back(CTxIn{COutPoint{last_mined->vtx[0]->GetHash(), 1}, CScript{}});\n+            mtx.vin[0].scriptWitness.stack.push_back(V_OP_TRUE);\n+            mtx.vout.push_back(last_mined->vtx[0]->vout[1]);\n+            mtx.vout[0].nValue -= 1000;\n+            txs.push_back(MakeTransactionRef(mtx));\n+\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\n+        }\n+\n+        // Mature the inputs of the txs\n+        for (int j = COINBASE_MATURITY; !!j; --j) {\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\n+        }\n+\n+        // Add the txs to the tx pool\n+        {\n+            LOCK(cs_main);\n+            CValidationState state;\n+            std::list<CTransactionRef> plTxnReplaced;\n+            for (const auto& tx : txs) {\n+                BOOST_REQUIRE(AcceptToMemoryPool(\n+                    ::mempool,\n+                    state,\n+                    tx,\n+                    /* pfMissingInputs */ &ignored,\n+                    &plTxnReplaced,\n+                    /* bypass_limits */ false,\n+                    /* nAbsurdFee */ 0));\n+            }\n+        }\n+\n+        // Check that all txs are in the pool\n+        {\n+            LOCK(::mempool.cs);\n+            BOOST_CHECK_EQUAL(::mempool.mapTx.size(), txs.size());\n+        }\n+\n+        // Run a thread that simulates an RPC caller that is polling while\n+        // validation is doing a reorg\n+        const uint256 tip_init{last_mined->GetHash()};\n+        std::thread rpc_thread{[&]() {\n+            while (true) {\n+                LOCK(::mempool.cs);\n+                if (::mempool.mapTx.size() == 0) {\n+                    // We are done with the reorg\n+                    break;\n+                }\n+                // Internally, we might be in the middle of the reorg, but\n+                // externally the reorg to the most-proof-of-work chain should\n+                // be atomic. So the caller assumes that the returned mempool\n+                // is consistent. That is, it has all txs that were there\n+                // before the reorg.\n+                assert(::mempool.mapTx.size() == txs.size());",
      "path": "src/test/validation_block_tests.cpp",
      "position": 178,
      "original_position": 151,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fae71ffc99b04bbcb96f4e2b6fa25ed2fe258912",
      "in_reply_to_id": 240347801,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The test has a ton of comments. Let me know if I need to add anything else to parts where the code is not self-explanatory.",
      "created_at": "2019-02-11T19:37:18Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r255661638",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255661638"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 315,
      "original_line": 315,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255661836",
      "pull_request_review_id": 202299001,
      "id": 255661836,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI1NTY2MTgzNg==",
      "diff_hunk": "@@ -2794,6 +2795,7 @@ bool PreciousBlock(CValidationState& state, const CChainParams& params, CBlockIn\n bool CChainState::InvalidateBlock(CValidationState& state, const CChainParams& chainparams, CBlockIndex *pindex)\n {\n     AssertLockHeld(cs_main);\n+    LOCK(::mempool.cs); // Lock for as long as disconnectpool is in scope to make sure UpdateMempoolForReorg is called after DisconnetTip without unlocking in between",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 39,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "d9e6cb497bd540078dbf32536825fa3bfd60df42",
      "in_reply_to_id": 240423959,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Added locking annotations.",
      "created_at": "2019-02-11T19:37:53Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r255661836",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/255661836"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2801,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/267433314",
      "pull_request_review_id": 216840225,
      "id": 267433314,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2NzQzMzMxNA==",
      "diff_hunk": "@@ -511,15 +511,6 @@ class CTxMemPool\n      * `mempool.cs` whenever adding transactions to the mempool and whenever\n      * changing the chain tip. It's necessary to keep both mutexes locked until\n      * the mempool is consistent with the new chain tip and fully populated.\n-     *\n-     * @par Consistency bug\n-     *\n-     * The second guarantee above is not currently enforced, but\n-     * https://github.com/bitcoin/bitcoin/pull/14193 will fix it. No known code\n-     * in bitcoin currently depends on second guarantee, but it is important to\n-     * fix for third party code that needs be able to frequently poll the",
      "path": "src/txmempool.h",
      "position": 36,
      "original_position": 10,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fadeeadd93a928c8ececa8c96ad2afa45bd25a29",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: Add missing mempool locks\" (fadeeadd93a928c8ececa8c96ad2afa45bd25a29)\r\n\r\nMight be worth keeping text that says why guarantee 2 is useful. James also asked about it here https://github.com/bitcoin/bitcoin/pull/14193#pullrequestreview-179871886, wondering if it might be useful for dandelion.",
      "created_at": "2019-03-20T16:33:19Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r267433314",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/267433314"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 522,
      "original_line": 522,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/267453955",
      "pull_request_review_id": 216866580,
      "id": 267453955,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2NzQ1Mzk1NQ==",
      "diff_hunk": "@@ -511,15 +511,6 @@ class CTxMemPool\n      * `mempool.cs` whenever adding transactions to the mempool and whenever\n      * changing the chain tip. It's necessary to keep both mutexes locked until\n      * the mempool is consistent with the new chain tip and fully populated.\n-     *\n-     * @par Consistency bug\n-     *\n-     * The second guarantee above is not currently enforced, but\n-     * https://github.com/bitcoin/bitcoin/pull/14193 will fix it. No known code\n-     * in bitcoin currently depends on second guarantee, but it is important to\n-     * fix for third party code that needs be able to frequently poll the",
      "path": "src/txmempool.h",
      "position": 36,
      "original_position": 10,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fadeeadd93a928c8ececa8c96ad2afa45bd25a29",
      "in_reply_to_id": 267433314,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Not sure about that. We generally don't update (forget to update) comments when adding new features. So if a feature is added in the far future (e.g. Dandelion has no chance to hit any time soon), the phrase \"No known code in bitcoin currently depends on second guarantee\" might no longer reflect reality.\r\n\r\nI believe the test that I added serves a a nice documentation that if this guarantee is violated, it will fail. The motivation to fix this bug for (enterprise) rpc users that poll the mempool should be enough motivation on its own.",
      "created_at": "2019-03-20T17:18:03Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r267453955",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/267453955"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 522,
      "original_line": 522,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/275375166",
      "pull_request_review_id": 226664144,
      "id": 275375166,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NTM3NTE2Ng==",
      "diff_hunk": "@@ -2793,6 +2794,7 @@ bool CChainState::InvalidateBlock(CValidationState& state, const CChainParams& c\n         LimitValidationInterfaceQueue();\n \n         LOCK(cs_main);\n+        LOCK(::mempool.cs); // Lock for as long as disconnectpool is in scope to make sure UpdateMempoolForReorg is called after DisconnetTip without unlocking in between",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 52,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fa33e8f41fe14cfd136ac7c96e192a9e14f1d0d3",
      "in_reply_to_id": null,
      "user": {
        "login": "practicalswift",
        "id": 7826565,
        "node_id": "MDQ6VXNlcjc4MjY1NjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/practicalswift",
        "html_url": "https://github.com/practicalswift",
        "followers_url": "https://api.github.com/users/practicalswift/followers",
        "following_url": "https://api.github.com/users/practicalswift/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/practicalswift/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/practicalswift/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
        "organizations_url": "https://api.github.com/users/practicalswift/orgs",
        "repos_url": "https://api.github.com/users/practicalswift/repos",
        "events_url": "https://api.github.com/users/practicalswift/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/practicalswift/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Nit: Should be \"DisconnectTip\" :-)",
      "created_at": "2019-04-15T14:02:17Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r275375166",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/275375166"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2797,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/286703079",
      "pull_request_review_id": 240899453,
      "id": 286703079,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NjcwMzA3OQ==",
      "diff_hunk": "@@ -479,9 +479,14 @@ static UniValue getblocktemplate(const JSONRPCRequest& request)\n             {\n                 if (g_best_block_cv.wait_until(lock, checktxtime) == std::cv_status::timeout)\n                 {\n-                    // Timeout: Check transactions for update\n+                    // Drop the best block mutex while accessing the mempool to avoid deadlock with\n+                    // ::mempool.cs.\n+                    LEAVE_CRITICAL_SECTION(lock);",
      "path": "src/rpc/mining.cpp",
      "position": null,
      "original_position": 16,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fa84fdbb1eb3c842e7f9248bceab98e91445ad0d",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This is a pretty weird construction; generally you shouldn't be releasing the lock that protects the state you're waiting to change while inspecting it.\r\n\r\nWhat about making `CTxMemPool::nTransactionsUpdated` an atomic, and making `CTxMemPool::GetTransactionsUpdated` not grap `cs`? Would it still be needed to release `lock` here then?\r\n\r\nWould you be able to write this as `g_best_block_cv.wait_until(lock, checktxtime, [&](){ return g_best_block != hashWatchedChain || !IsRPCRunning() || mempool.GetTransactionsUpdate() != nTransactionsUpdatedLastLP; });`?",
      "created_at": "2019-05-22T21:52:44Z",
      "updated_at": "2019-06-07T09:09:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r286703079",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/286703079"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 484,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/291539216",
      "pull_request_review_id": 247025031,
      "id": 291539216,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5MTUzOTIxNg==",
      "diff_hunk": "@@ -479,9 +479,14 @@ static UniValue getblocktemplate(const JSONRPCRequest& request)\n             {\n                 if (g_best_block_cv.wait_until(lock, checktxtime) == std::cv_status::timeout)\n                 {\n-                    // Timeout: Check transactions for update\n+                    // Drop the best block mutex while accessing the mempool to avoid deadlock with\n+                    // ::mempool.cs.\n+                    LEAVE_CRITICAL_SECTION(lock);",
      "path": "src/rpc/mining.cpp",
      "position": null,
      "original_position": 16,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fa84fdbb1eb3c842e7f9248bceab98e91445ad0d",
      "in_reply_to_id": 286703079,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Made it atomic, but I left the refactoring change for a future pull request.",
      "created_at": "2019-06-07T10:35:32Z",
      "updated_at": "2019-06-07T10:35:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r291539216",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/291539216"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 484,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/298813180",
      "pull_request_review_id": 256052741,
      "id": 298813180,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5ODgxMzE4MA==",
      "diff_hunk": "@@ -322,8 +322,8 @@ void CTxMemPoolEntry::UpdateAncestorState(int64_t modifySize, CAmount modifyFee,\n     assert(int(nSigOpCostWithAncestors) >= 0);\n }\n \n-CTxMemPool::CTxMemPool(CBlockPolicyEstimator* estimator) :\n-    nTransactionsUpdated(0), minerPolicyEstimator(estimator)\n+CTxMemPool::CTxMemPool(CBlockPolicyEstimator* estimator)\n+    : nTransactionsUpdated(0), minerPolicyEstimator(estimator)",
      "path": "src/txmempool.cpp",
      "position": 16,
      "original_position": 7,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fa0c9dbf9156d64a4b9bff858da97825369a9134",
      "in_reply_to_id": null,
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": ":eyes:",
      "created_at": "2019-06-29T22:55:32Z",
      "updated_at": "2019-06-29T23:08:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r298813180",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/298813180"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 326,
      "original_line": 326,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/298813325",
      "pull_request_review_id": 256052741,
      "id": 298813325,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5ODgxMzMyNQ==",
      "diff_hunk": "@@ -185,4 +204,131 @@ BOOST_AUTO_TEST_CASE(processnewblock_signals_ordering)\n     BOOST_CHECK_EQUAL(sub.m_expected_tip, ::ChainActive().Tip()->GetBlockHash());\n }\n \n+/**\n+ * Test that mempool updates happen atomically with reorgs.\n+ *\n+ * This prevents RPC clients, among others, from retrieving immediately-out-of-date mempool data\n+ * during large reorgs.\n+ *\n+ * The test verifies this by creating a chain of `num_txs` blocks, matures their coinbases, and then\n+ * submits txns spending from their coinbase to the mempool. A fork chain is then processed,\n+ * invalidating the txns and evicting them from the mempool.\n+ *\n+ * We verify that the mempool updates atomically by polling it continuously\n+ * from another thread during the reorg and checking that its size only changes\n+ * once. The size changing exactly once indicates that the polling thread's\n+ * view of the mempool is either consistent with the chain state before reorg,\n+ * or consistent with the chain state after the reorg, and not just consistent\n+ * with some intermediate state during the reorg.\n+ */\n+BOOST_AUTO_TEST_CASE(mempool_locks_reorg)\n+{\n+    bool ignored;\n+    auto ProcessBlock = [&ignored](std::shared_ptr<const CBlock> block) -> bool {\n+        return ProcessNewBlock(Params(), block, /* fForceProcessing */ true, /* fNewBlock */ &ignored);\n+    };\n+\n+    // Process all mined blocks\n+    BOOST_REQUIRE(ProcessBlock(std::make_shared<CBlock>(Params().GenesisBlock())));\n+    auto last_mined = GoodBlock(Params().GenesisBlock().GetHash());\n+    BOOST_REQUIRE(ProcessBlock(last_mined));\n+\n+    // Run the test multiple times\n+    for (int test_runs = 3; test_runs > 0; --test_runs) {\n+        BOOST_CHECK_EQUAL(last_mined->GetHash(), ::ChainActive().Tip()->GetBlockHash());\n+\n+        // Later on split from here\n+        const uint256 split_hash{last_mined->hashPrevBlock};\n+\n+        // Create a bunch of transactions to spend the miner rewards of the\n+        // most recent blocks\n+        std::vector<CTransactionRef> txs;\n+        for (int num_txs = 22; num_txs > 0; --num_txs) {\n+            CMutableTransaction mtx;\n+            mtx.vin.push_back(CTxIn{COutPoint{last_mined->vtx[0]->GetHash(), 1}, CScript{}});\n+            mtx.vin[0].scriptWitness.stack.push_back(V_OP_TRUE);\n+            mtx.vout.push_back(last_mined->vtx[0]->vout[1]);\n+            mtx.vout[0].nValue -= 1000;\n+            txs.push_back(MakeTransactionRef(mtx));\n+\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\n+        }\n+\n+        // Mature the inputs of the txs\n+        for (int j = COINBASE_MATURITY; j > 0; --j) {\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\n+        }\n+\n+        // Mine a reorg (and hold it back) before adding the txs to the mempool\n+        const uint256 tip_init{last_mined->GetHash()};\n+\n+        std::vector<std::shared_ptr<const CBlock>> reorg;\n+        last_mined = GoodBlock(split_hash);\n+        reorg.push_back(last_mined);\n+        for (size_t j = COINBASE_MATURITY + txs.size() + 1; j > 0; --j) {\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            reorg.push_back(last_mined);\n+        }\n+\n+        // Add the txs to the tx pool\n+        {\n+            LOCK(cs_main);\n+            CValidationState state;\n+            std::list<CTransactionRef> plTxnReplaced;\n+            for (const auto& tx : txs) {\n+                BOOST_REQUIRE(AcceptToMemoryPool(\n+                    ::mempool,\n+                    state,\n+                    tx,\n+                    /* pfMissingInputs */ &ignored,\n+                    &plTxnReplaced,\n+                    /* bypass_limits */ false,\n+                    /* nAbsurdFee */ 0));\n+            }\n+        }\n+\n+        // Check that all txs are in the pool\n+        {\n+            LOCK(::mempool.cs);\n+            BOOST_CHECK_EQUAL(::mempool.mapTx.size(), txs.size());\n+        }\n+\n+        // Run a thread that simulates an RPC caller that is polling while\n+        // validation is doing a reorg\n+        std::thread rpc_thread{[&]() {\n+            // This thread is checking that the mempool either contains all of\n+            // the transactions invalidated by the reorg, or none of them, and\n+            // not some intermediate amount.\n+            while (true) {\n+                LOCK(::mempool.cs);\n+                if (::mempool.mapTx.size() == 0) {\n+                    // We are done with the reorg\n+                    break;\n+                }\n+                // Internally, we might be in the middle of the reorg, but\n+                // externally the reorg to the most-proof-of-work chain should\n+                // be atomic. So the caller assumes that the returned mempool\n+                // is consistent. That is, it has all txs that were there\n+                // before the reorg.\n+                assert(::mempool.mapTx.size() == txs.size());\n+                continue;",
      "path": "src/test/validation_block_tests.cpp",
      "position": 179,
      "original_position": 179,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "in_reply_to_id": null,
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "fa2b083c3feb0522baf652045efa6b73458761a3\r\n\r\nWhy `continue`?",
      "created_at": "2019-06-29T23:07:24Z",
      "updated_at": "2019-06-29T23:08:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r298813325",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/298813325"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 316,
      "original_line": 316,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/298813327",
      "pull_request_review_id": 256052741,
      "id": 298813327,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5ODgxMzMyNw==",
      "diff_hunk": "@@ -185,4 +204,131 @@ BOOST_AUTO_TEST_CASE(processnewblock_signals_ordering)\n     BOOST_CHECK_EQUAL(sub.m_expected_tip, ::ChainActive().Tip()->GetBlockHash());\n }\n \n+/**\n+ * Test that mempool updates happen atomically with reorgs.\n+ *\n+ * This prevents RPC clients, among others, from retrieving immediately-out-of-date mempool data\n+ * during large reorgs.\n+ *\n+ * The test verifies this by creating a chain of `num_txs` blocks, matures their coinbases, and then\n+ * submits txns spending from their coinbase to the mempool. A fork chain is then processed,\n+ * invalidating the txns and evicting them from the mempool.\n+ *\n+ * We verify that the mempool updates atomically by polling it continuously\n+ * from another thread during the reorg and checking that its size only changes\n+ * once. The size changing exactly once indicates that the polling thread's\n+ * view of the mempool is either consistent with the chain state before reorg,\n+ * or consistent with the chain state after the reorg, and not just consistent\n+ * with some intermediate state during the reorg.\n+ */\n+BOOST_AUTO_TEST_CASE(mempool_locks_reorg)\n+{\n+    bool ignored;\n+    auto ProcessBlock = [&ignored](std::shared_ptr<const CBlock> block) -> bool {\n+        return ProcessNewBlock(Params(), block, /* fForceProcessing */ true, /* fNewBlock */ &ignored);\n+    };\n+\n+    // Process all mined blocks\n+    BOOST_REQUIRE(ProcessBlock(std::make_shared<CBlock>(Params().GenesisBlock())));\n+    auto last_mined = GoodBlock(Params().GenesisBlock().GetHash());\n+    BOOST_REQUIRE(ProcessBlock(last_mined));\n+\n+    // Run the test multiple times\n+    for (int test_runs = 3; test_runs > 0; --test_runs) {\n+        BOOST_CHECK_EQUAL(last_mined->GetHash(), ::ChainActive().Tip()->GetBlockHash());\n+\n+        // Later on split from here\n+        const uint256 split_hash{last_mined->hashPrevBlock};\n+\n+        // Create a bunch of transactions to spend the miner rewards of the\n+        // most recent blocks\n+        std::vector<CTransactionRef> txs;\n+        for (int num_txs = 22; num_txs > 0; --num_txs) {\n+            CMutableTransaction mtx;\n+            mtx.vin.push_back(CTxIn{COutPoint{last_mined->vtx[0]->GetHash(), 1}, CScript{}});\n+            mtx.vin[0].scriptWitness.stack.push_back(V_OP_TRUE);\n+            mtx.vout.push_back(last_mined->vtx[0]->vout[1]);\n+            mtx.vout[0].nValue -= 1000;\n+            txs.push_back(MakeTransactionRef(mtx));\n+\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\n+        }\n+\n+        // Mature the inputs of the txs\n+        for (int j = COINBASE_MATURITY; j > 0; --j) {\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\n+        }\n+\n+        // Mine a reorg (and hold it back) before adding the txs to the mempool\n+        const uint256 tip_init{last_mined->GetHash()};\n+\n+        std::vector<std::shared_ptr<const CBlock>> reorg;\n+        last_mined = GoodBlock(split_hash);\n+        reorg.push_back(last_mined);\n+        for (size_t j = COINBASE_MATURITY + txs.size() + 1; j > 0; --j) {\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            reorg.push_back(last_mined);\n+        }\n+\n+        // Add the txs to the tx pool\n+        {\n+            LOCK(cs_main);\n+            CValidationState state;\n+            std::list<CTransactionRef> plTxnReplaced;\n+            for (const auto& tx : txs) {\n+                BOOST_REQUIRE(AcceptToMemoryPool(\n+                    ::mempool,\n+                    state,\n+                    tx,\n+                    /* pfMissingInputs */ &ignored,\n+                    &plTxnReplaced,\n+                    /* bypass_limits */ false,\n+                    /* nAbsurdFee */ 0));\n+            }\n+        }\n+\n+        // Check that all txs are in the pool\n+        {\n+            LOCK(::mempool.cs);\n+            BOOST_CHECK_EQUAL(::mempool.mapTx.size(), txs.size());\n+        }\n+\n+        // Run a thread that simulates an RPC caller that is polling while\n+        // validation is doing a reorg\n+        std::thread rpc_thread{[&]() {\n+            // This thread is checking that the mempool either contains all of\n+            // the transactions invalidated by the reorg, or none of them, and\n+            // not some intermediate amount.\n+            while (true) {",
      "path": "src/test/validation_block_tests.cpp",
      "position": 167,
      "original_position": 167,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "in_reply_to_id": null,
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "fa2b083c3feb0522baf652045efa6b73458761a3\r\n\r\nI think this is flawless, what guarantees that there's a non-atomic change once `mempool.cs` is released?",
      "created_at": "2019-06-29T23:07:37Z",
      "updated_at": "2019-06-29T23:08:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r298813327",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/298813327"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 304,
      "original_line": 304,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/298838858",
      "pull_request_review_id": 256079344,
      "id": 298838858,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5ODgzODg1OA==",
      "diff_hunk": "@@ -185,4 +204,131 @@ BOOST_AUTO_TEST_CASE(processnewblock_signals_ordering)\n     BOOST_CHECK_EQUAL(sub.m_expected_tip, ::ChainActive().Tip()->GetBlockHash());\n }\n \n+/**\n+ * Test that mempool updates happen atomically with reorgs.\n+ *\n+ * This prevents RPC clients, among others, from retrieving immediately-out-of-date mempool data\n+ * during large reorgs.\n+ *\n+ * The test verifies this by creating a chain of `num_txs` blocks, matures their coinbases, and then\n+ * submits txns spending from their coinbase to the mempool. A fork chain is then processed,\n+ * invalidating the txns and evicting them from the mempool.\n+ *\n+ * We verify that the mempool updates atomically by polling it continuously\n+ * from another thread during the reorg and checking that its size only changes\n+ * once. The size changing exactly once indicates that the polling thread's\n+ * view of the mempool is either consistent with the chain state before reorg,\n+ * or consistent with the chain state after the reorg, and not just consistent\n+ * with some intermediate state during the reorg.\n+ */\n+BOOST_AUTO_TEST_CASE(mempool_locks_reorg)\n+{\n+    bool ignored;\n+    auto ProcessBlock = [&ignored](std::shared_ptr<const CBlock> block) -> bool {\n+        return ProcessNewBlock(Params(), block, /* fForceProcessing */ true, /* fNewBlock */ &ignored);\n+    };\n+\n+    // Process all mined blocks\n+    BOOST_REQUIRE(ProcessBlock(std::make_shared<CBlock>(Params().GenesisBlock())));\n+    auto last_mined = GoodBlock(Params().GenesisBlock().GetHash());\n+    BOOST_REQUIRE(ProcessBlock(last_mined));\n+\n+    // Run the test multiple times\n+    for (int test_runs = 3; test_runs > 0; --test_runs) {\n+        BOOST_CHECK_EQUAL(last_mined->GetHash(), ::ChainActive().Tip()->GetBlockHash());\n+\n+        // Later on split from here\n+        const uint256 split_hash{last_mined->hashPrevBlock};\n+\n+        // Create a bunch of transactions to spend the miner rewards of the\n+        // most recent blocks\n+        std::vector<CTransactionRef> txs;\n+        for (int num_txs = 22; num_txs > 0; --num_txs) {\n+            CMutableTransaction mtx;\n+            mtx.vin.push_back(CTxIn{COutPoint{last_mined->vtx[0]->GetHash(), 1}, CScript{}});\n+            mtx.vin[0].scriptWitness.stack.push_back(V_OP_TRUE);\n+            mtx.vout.push_back(last_mined->vtx[0]->vout[1]);\n+            mtx.vout[0].nValue -= 1000;\n+            txs.push_back(MakeTransactionRef(mtx));\n+\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\n+        }\n+\n+        // Mature the inputs of the txs\n+        for (int j = COINBASE_MATURITY; j > 0; --j) {\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\n+        }\n+\n+        // Mine a reorg (and hold it back) before adding the txs to the mempool\n+        const uint256 tip_init{last_mined->GetHash()};\n+\n+        std::vector<std::shared_ptr<const CBlock>> reorg;\n+        last_mined = GoodBlock(split_hash);\n+        reorg.push_back(last_mined);\n+        for (size_t j = COINBASE_MATURITY + txs.size() + 1; j > 0; --j) {\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            reorg.push_back(last_mined);\n+        }\n+\n+        // Add the txs to the tx pool\n+        {\n+            LOCK(cs_main);\n+            CValidationState state;\n+            std::list<CTransactionRef> plTxnReplaced;\n+            for (const auto& tx : txs) {\n+                BOOST_REQUIRE(AcceptToMemoryPool(\n+                    ::mempool,\n+                    state,\n+                    tx,\n+                    /* pfMissingInputs */ &ignored,\n+                    &plTxnReplaced,\n+                    /* bypass_limits */ false,\n+                    /* nAbsurdFee */ 0));\n+            }\n+        }\n+\n+        // Check that all txs are in the pool\n+        {\n+            LOCK(::mempool.cs);\n+            BOOST_CHECK_EQUAL(::mempool.mapTx.size(), txs.size());\n+        }\n+\n+        // Run a thread that simulates an RPC caller that is polling while\n+        // validation is doing a reorg\n+        std::thread rpc_thread{[&]() {\n+            // This thread is checking that the mempool either contains all of\n+            // the transactions invalidated by the reorg, or none of them, and\n+            // not some intermediate amount.\n+            while (true) {",
      "path": "src/test/validation_block_tests.cpp",
      "position": 167,
      "original_position": 167,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "in_reply_to_id": 298813327,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The code changes in this pull request should guarantee that this doesn't happen here in the test (you can check it by running the test before the code changes and after), as well as for \"real\" rpc polling threads. Though, I didn't write a functional test for this.",
      "created_at": "2019-06-30T15:18:37Z",
      "updated_at": "2019-06-30T15:18:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r298838858",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/298838858"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 304,
      "original_line": 304,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/298838888",
      "pull_request_review_id": 256079367,
      "id": 298838888,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5ODgzODg4OA==",
      "diff_hunk": "@@ -185,4 +204,131 @@ BOOST_AUTO_TEST_CASE(processnewblock_signals_ordering)\n     BOOST_CHECK_EQUAL(sub.m_expected_tip, ::ChainActive().Tip()->GetBlockHash());\n }\n \n+/**\n+ * Test that mempool updates happen atomically with reorgs.\n+ *\n+ * This prevents RPC clients, among others, from retrieving immediately-out-of-date mempool data\n+ * during large reorgs.\n+ *\n+ * The test verifies this by creating a chain of `num_txs` blocks, matures their coinbases, and then\n+ * submits txns spending from their coinbase to the mempool. A fork chain is then processed,\n+ * invalidating the txns and evicting them from the mempool.\n+ *\n+ * We verify that the mempool updates atomically by polling it continuously\n+ * from another thread during the reorg and checking that its size only changes\n+ * once. The size changing exactly once indicates that the polling thread's\n+ * view of the mempool is either consistent with the chain state before reorg,\n+ * or consistent with the chain state after the reorg, and not just consistent\n+ * with some intermediate state during the reorg.\n+ */\n+BOOST_AUTO_TEST_CASE(mempool_locks_reorg)\n+{\n+    bool ignored;\n+    auto ProcessBlock = [&ignored](std::shared_ptr<const CBlock> block) -> bool {\n+        return ProcessNewBlock(Params(), block, /* fForceProcessing */ true, /* fNewBlock */ &ignored);\n+    };\n+\n+    // Process all mined blocks\n+    BOOST_REQUIRE(ProcessBlock(std::make_shared<CBlock>(Params().GenesisBlock())));\n+    auto last_mined = GoodBlock(Params().GenesisBlock().GetHash());\n+    BOOST_REQUIRE(ProcessBlock(last_mined));\n+\n+    // Run the test multiple times\n+    for (int test_runs = 3; test_runs > 0; --test_runs) {\n+        BOOST_CHECK_EQUAL(last_mined->GetHash(), ::ChainActive().Tip()->GetBlockHash());\n+\n+        // Later on split from here\n+        const uint256 split_hash{last_mined->hashPrevBlock};\n+\n+        // Create a bunch of transactions to spend the miner rewards of the\n+        // most recent blocks\n+        std::vector<CTransactionRef> txs;\n+        for (int num_txs = 22; num_txs > 0; --num_txs) {\n+            CMutableTransaction mtx;\n+            mtx.vin.push_back(CTxIn{COutPoint{last_mined->vtx[0]->GetHash(), 1}, CScript{}});\n+            mtx.vin[0].scriptWitness.stack.push_back(V_OP_TRUE);\n+            mtx.vout.push_back(last_mined->vtx[0]->vout[1]);\n+            mtx.vout[0].nValue -= 1000;\n+            txs.push_back(MakeTransactionRef(mtx));\n+\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\n+        }\n+\n+        // Mature the inputs of the txs\n+        for (int j = COINBASE_MATURITY; j > 0; --j) {\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\n+        }\n+\n+        // Mine a reorg (and hold it back) before adding the txs to the mempool\n+        const uint256 tip_init{last_mined->GetHash()};\n+\n+        std::vector<std::shared_ptr<const CBlock>> reorg;\n+        last_mined = GoodBlock(split_hash);\n+        reorg.push_back(last_mined);\n+        for (size_t j = COINBASE_MATURITY + txs.size() + 1; j > 0; --j) {\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            reorg.push_back(last_mined);\n+        }\n+\n+        // Add the txs to the tx pool\n+        {\n+            LOCK(cs_main);\n+            CValidationState state;\n+            std::list<CTransactionRef> plTxnReplaced;\n+            for (const auto& tx : txs) {\n+                BOOST_REQUIRE(AcceptToMemoryPool(\n+                    ::mempool,\n+                    state,\n+                    tx,\n+                    /* pfMissingInputs */ &ignored,\n+                    &plTxnReplaced,\n+                    /* bypass_limits */ false,\n+                    /* nAbsurdFee */ 0));\n+            }\n+        }\n+\n+        // Check that all txs are in the pool\n+        {\n+            LOCK(::mempool.cs);\n+            BOOST_CHECK_EQUAL(::mempool.mapTx.size(), txs.size());\n+        }\n+\n+        // Run a thread that simulates an RPC caller that is polling while\n+        // validation is doing a reorg\n+        std::thread rpc_thread{[&]() {\n+            // This thread is checking that the mempool either contains all of\n+            // the transactions invalidated by the reorg, or none of them, and\n+            // not some intermediate amount.\n+            while (true) {\n+                LOCK(::mempool.cs);\n+                if (::mempool.mapTx.size() == 0) {\n+                    // We are done with the reorg\n+                    break;\n+                }\n+                // Internally, we might be in the middle of the reorg, but\n+                // externally the reorg to the most-proof-of-work chain should\n+                // be atomic. So the caller assumes that the returned mempool\n+                // is consistent. That is, it has all txs that were there\n+                // before the reorg.\n+                assert(::mempool.mapTx.size() == txs.size());\n+                continue;",
      "path": "src/test/validation_block_tests.cpp",
      "position": 179,
      "original_position": 179,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "in_reply_to_id": 298813325,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Because the thread should continue and not exit (for now)",
      "created_at": "2019-06-30T15:19:15Z",
      "updated_at": "2019-06-30T15:19:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r298838888",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/298838888"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 316,
      "original_line": 316,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299204848",
      "pull_request_review_id": 256546009,
      "id": 299204848,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5OTIwNDg0OA==",
      "diff_hunk": "@@ -185,4 +204,131 @@ BOOST_AUTO_TEST_CASE(processnewblock_signals_ordering)\n     BOOST_CHECK_EQUAL(sub.m_expected_tip, ::ChainActive().Tip()->GetBlockHash());\n }\n \n+/**\n+ * Test that mempool updates happen atomically with reorgs.\n+ *\n+ * This prevents RPC clients, among others, from retrieving immediately-out-of-date mempool data\n+ * during large reorgs.\n+ *\n+ * The test verifies this by creating a chain of `num_txs` blocks, matures their coinbases, and then\n+ * submits txns spending from their coinbase to the mempool. A fork chain is then processed,\n+ * invalidating the txns and evicting them from the mempool.\n+ *\n+ * We verify that the mempool updates atomically by polling it continuously\n+ * from another thread during the reorg and checking that its size only changes\n+ * once. The size changing exactly once indicates that the polling thread's\n+ * view of the mempool is either consistent with the chain state before reorg,\n+ * or consistent with the chain state after the reorg, and not just consistent\n+ * with some intermediate state during the reorg.\n+ */\n+BOOST_AUTO_TEST_CASE(mempool_locks_reorg)\n+{\n+    bool ignored;\n+    auto ProcessBlock = [&ignored](std::shared_ptr<const CBlock> block) -> bool {\n+        return ProcessNewBlock(Params(), block, /* fForceProcessing */ true, /* fNewBlock */ &ignored);\n+    };\n+\n+    // Process all mined blocks\n+    BOOST_REQUIRE(ProcessBlock(std::make_shared<CBlock>(Params().GenesisBlock())));\n+    auto last_mined = GoodBlock(Params().GenesisBlock().GetHash());\n+    BOOST_REQUIRE(ProcessBlock(last_mined));\n+\n+    // Run the test multiple times\n+    for (int test_runs = 3; test_runs > 0; --test_runs) {\n+        BOOST_CHECK_EQUAL(last_mined->GetHash(), ::ChainActive().Tip()->GetBlockHash());\n+\n+        // Later on split from here\n+        const uint256 split_hash{last_mined->hashPrevBlock};\n+\n+        // Create a bunch of transactions to spend the miner rewards of the\n+        // most recent blocks\n+        std::vector<CTransactionRef> txs;\n+        for (int num_txs = 22; num_txs > 0; --num_txs) {\n+            CMutableTransaction mtx;\n+            mtx.vin.push_back(CTxIn{COutPoint{last_mined->vtx[0]->GetHash(), 1}, CScript{}});\n+            mtx.vin[0].scriptWitness.stack.push_back(V_OP_TRUE);\n+            mtx.vout.push_back(last_mined->vtx[0]->vout[1]);\n+            mtx.vout[0].nValue -= 1000;\n+            txs.push_back(MakeTransactionRef(mtx));\n+\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\n+        }\n+\n+        // Mature the inputs of the txs\n+        for (int j = COINBASE_MATURITY; j > 0; --j) {\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\n+        }\n+\n+        // Mine a reorg (and hold it back) before adding the txs to the mempool\n+        const uint256 tip_init{last_mined->GetHash()};\n+\n+        std::vector<std::shared_ptr<const CBlock>> reorg;\n+        last_mined = GoodBlock(split_hash);\n+        reorg.push_back(last_mined);\n+        for (size_t j = COINBASE_MATURITY + txs.size() + 1; j > 0; --j) {\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            reorg.push_back(last_mined);\n+        }\n+\n+        // Add the txs to the tx pool\n+        {\n+            LOCK(cs_main);\n+            CValidationState state;\n+            std::list<CTransactionRef> plTxnReplaced;\n+            for (const auto& tx : txs) {\n+                BOOST_REQUIRE(AcceptToMemoryPool(\n+                    ::mempool,\n+                    state,\n+                    tx,\n+                    /* pfMissingInputs */ &ignored,\n+                    &plTxnReplaced,\n+                    /* bypass_limits */ false,\n+                    /* nAbsurdFee */ 0));\n+            }\n+        }\n+\n+        // Check that all txs are in the pool\n+        {\n+            LOCK(::mempool.cs);\n+            BOOST_CHECK_EQUAL(::mempool.mapTx.size(), txs.size());\n+        }\n+\n+        // Run a thread that simulates an RPC caller that is polling while\n+        // validation is doing a reorg\n+        std::thread rpc_thread{[&]() {\n+            // This thread is checking that the mempool either contains all of\n+            // the transactions invalidated by the reorg, or none of them, and\n+            // not some intermediate amount.\n+            while (true) {\n+                LOCK(::mempool.cs);\n+                if (::mempool.mapTx.size() == 0) {\n+                    // We are done with the reorg\n+                    break;\n+                }\n+                // Internally, we might be in the middle of the reorg, but\n+                // externally the reorg to the most-proof-of-work chain should\n+                // be atomic. So the caller assumes that the returned mempool\n+                // is consistent. That is, it has all txs that were there\n+                // before the reorg.\n+                assert(::mempool.mapTx.size() == txs.size());\n+                continue;",
      "path": "src/test/validation_block_tests.cpp",
      "position": 179,
      "original_position": 179,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "in_reply_to_id": 298813325,
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Why would it exit?",
      "created_at": "2019-07-01T20:28:33Z",
      "updated_at": "2019-07-01T20:28:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r299204848",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299204848"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 316,
      "original_line": 316,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299210818",
      "pull_request_review_id": 256553538,
      "id": 299210818,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5OTIxMDgxOA==",
      "diff_hunk": "@@ -185,4 +204,131 @@ BOOST_AUTO_TEST_CASE(processnewblock_signals_ordering)\n     BOOST_CHECK_EQUAL(sub.m_expected_tip, ::ChainActive().Tip()->GetBlockHash());\n }\n \n+/**\n+ * Test that mempool updates happen atomically with reorgs.\n+ *\n+ * This prevents RPC clients, among others, from retrieving immediately-out-of-date mempool data\n+ * during large reorgs.\n+ *\n+ * The test verifies this by creating a chain of `num_txs` blocks, matures their coinbases, and then\n+ * submits txns spending from their coinbase to the mempool. A fork chain is then processed,\n+ * invalidating the txns and evicting them from the mempool.\n+ *\n+ * We verify that the mempool updates atomically by polling it continuously\n+ * from another thread during the reorg and checking that its size only changes\n+ * once. The size changing exactly once indicates that the polling thread's\n+ * view of the mempool is either consistent with the chain state before reorg,\n+ * or consistent with the chain state after the reorg, and not just consistent\n+ * with some intermediate state during the reorg.\n+ */\n+BOOST_AUTO_TEST_CASE(mempool_locks_reorg)\n+{\n+    bool ignored;\n+    auto ProcessBlock = [&ignored](std::shared_ptr<const CBlock> block) -> bool {\n+        return ProcessNewBlock(Params(), block, /* fForceProcessing */ true, /* fNewBlock */ &ignored);\n+    };\n+\n+    // Process all mined blocks\n+    BOOST_REQUIRE(ProcessBlock(std::make_shared<CBlock>(Params().GenesisBlock())));\n+    auto last_mined = GoodBlock(Params().GenesisBlock().GetHash());\n+    BOOST_REQUIRE(ProcessBlock(last_mined));\n+\n+    // Run the test multiple times\n+    for (int test_runs = 3; test_runs > 0; --test_runs) {\n+        BOOST_CHECK_EQUAL(last_mined->GetHash(), ::ChainActive().Tip()->GetBlockHash());\n+\n+        // Later on split from here\n+        const uint256 split_hash{last_mined->hashPrevBlock};\n+\n+        // Create a bunch of transactions to spend the miner rewards of the\n+        // most recent blocks\n+        std::vector<CTransactionRef> txs;\n+        for (int num_txs = 22; num_txs > 0; --num_txs) {\n+            CMutableTransaction mtx;\n+            mtx.vin.push_back(CTxIn{COutPoint{last_mined->vtx[0]->GetHash(), 1}, CScript{}});\n+            mtx.vin[0].scriptWitness.stack.push_back(V_OP_TRUE);\n+            mtx.vout.push_back(last_mined->vtx[0]->vout[1]);\n+            mtx.vout[0].nValue -= 1000;\n+            txs.push_back(MakeTransactionRef(mtx));\n+\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\n+        }\n+\n+        // Mature the inputs of the txs\n+        for (int j = COINBASE_MATURITY; j > 0; --j) {\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\n+        }\n+\n+        // Mine a reorg (and hold it back) before adding the txs to the mempool\n+        const uint256 tip_init{last_mined->GetHash()};\n+\n+        std::vector<std::shared_ptr<const CBlock>> reorg;\n+        last_mined = GoodBlock(split_hash);\n+        reorg.push_back(last_mined);\n+        for (size_t j = COINBASE_MATURITY + txs.size() + 1; j > 0; --j) {\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            reorg.push_back(last_mined);\n+        }\n+\n+        // Add the txs to the tx pool\n+        {\n+            LOCK(cs_main);\n+            CValidationState state;\n+            std::list<CTransactionRef> plTxnReplaced;\n+            for (const auto& tx : txs) {\n+                BOOST_REQUIRE(AcceptToMemoryPool(\n+                    ::mempool,\n+                    state,\n+                    tx,\n+                    /* pfMissingInputs */ &ignored,\n+                    &plTxnReplaced,\n+                    /* bypass_limits */ false,\n+                    /* nAbsurdFee */ 0));\n+            }\n+        }\n+\n+        // Check that all txs are in the pool\n+        {\n+            LOCK(::mempool.cs);\n+            BOOST_CHECK_EQUAL(::mempool.mapTx.size(), txs.size());\n+        }\n+\n+        // Run a thread that simulates an RPC caller that is polling while\n+        // validation is doing a reorg\n+        std::thread rpc_thread{[&]() {\n+            // This thread is checking that the mempool either contains all of\n+            // the transactions invalidated by the reorg, or none of them, and\n+            // not some intermediate amount.\n+            while (true) {\n+                LOCK(::mempool.cs);\n+                if (::mempool.mapTx.size() == 0) {\n+                    // We are done with the reorg\n+                    break;\n+                }\n+                // Internally, we might be in the middle of the reorg, but\n+                // externally the reorg to the most-proof-of-work chain should\n+                // be atomic. So the caller assumes that the returned mempool\n+                // is consistent. That is, it has all txs that were there\n+                // before the reorg.\n+                assert(::mempool.mapTx.size() == txs.size());\n+                continue;",
      "path": "src/test/validation_block_tests.cpp",
      "position": 179,
      "original_position": 179,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "in_reply_to_id": 298813325,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It would exit when it `break`s. I think this is well documented in the test case and I am not sure what you are asking exactly.\r\n\r\nIf you are asking about cpp syntax, I find cppreference really helpful. E.g. https://en.cppreference.com/w/cpp/language/break\r\n\r\nIf you are asking about this test case logic, please write a more verbose question.",
      "created_at": "2019-07-01T20:46:19Z",
      "updated_at": "2019-07-01T20:46:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r299210818",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299210818"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 316,
      "original_line": 316,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299503348",
      "pull_request_review_id": 256919435,
      "id": 299503348,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5OTUwMzM0OA==",
      "diff_hunk": "@@ -185,4 +204,131 @@ BOOST_AUTO_TEST_CASE(processnewblock_signals_ordering)\n     BOOST_CHECK_EQUAL(sub.m_expected_tip, ::ChainActive().Tip()->GetBlockHash());\n }\n \n+/**\n+ * Test that mempool updates happen atomically with reorgs.\n+ *\n+ * This prevents RPC clients, among others, from retrieving immediately-out-of-date mempool data\n+ * during large reorgs.\n+ *\n+ * The test verifies this by creating a chain of `num_txs` blocks, matures their coinbases, and then\n+ * submits txns spending from their coinbase to the mempool. A fork chain is then processed,\n+ * invalidating the txns and evicting them from the mempool.\n+ *\n+ * We verify that the mempool updates atomically by polling it continuously\n+ * from another thread during the reorg and checking that its size only changes\n+ * once. The size changing exactly once indicates that the polling thread's\n+ * view of the mempool is either consistent with the chain state before reorg,\n+ * or consistent with the chain state after the reorg, and not just consistent\n+ * with some intermediate state during the reorg.\n+ */\n+BOOST_AUTO_TEST_CASE(mempool_locks_reorg)\n+{\n+    bool ignored;\n+    auto ProcessBlock = [&ignored](std::shared_ptr<const CBlock> block) -> bool {\n+        return ProcessNewBlock(Params(), block, /* fForceProcessing */ true, /* fNewBlock */ &ignored);\n+    };\n+\n+    // Process all mined blocks\n+    BOOST_REQUIRE(ProcessBlock(std::make_shared<CBlock>(Params().GenesisBlock())));\n+    auto last_mined = GoodBlock(Params().GenesisBlock().GetHash());\n+    BOOST_REQUIRE(ProcessBlock(last_mined));\n+\n+    // Run the test multiple times\n+    for (int test_runs = 3; test_runs > 0; --test_runs) {\n+        BOOST_CHECK_EQUAL(last_mined->GetHash(), ::ChainActive().Tip()->GetBlockHash());\n+\n+        // Later on split from here\n+        const uint256 split_hash{last_mined->hashPrevBlock};\n+\n+        // Create a bunch of transactions to spend the miner rewards of the\n+        // most recent blocks\n+        std::vector<CTransactionRef> txs;\n+        for (int num_txs = 22; num_txs > 0; --num_txs) {\n+            CMutableTransaction mtx;\n+            mtx.vin.push_back(CTxIn{COutPoint{last_mined->vtx[0]->GetHash(), 1}, CScript{}});\n+            mtx.vin[0].scriptWitness.stack.push_back(V_OP_TRUE);\n+            mtx.vout.push_back(last_mined->vtx[0]->vout[1]);\n+            mtx.vout[0].nValue -= 1000;\n+            txs.push_back(MakeTransactionRef(mtx));\n+\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\n+        }\n+\n+        // Mature the inputs of the txs\n+        for (int j = COINBASE_MATURITY; j > 0; --j) {\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\n+        }\n+\n+        // Mine a reorg (and hold it back) before adding the txs to the mempool\n+        const uint256 tip_init{last_mined->GetHash()};\n+\n+        std::vector<std::shared_ptr<const CBlock>> reorg;\n+        last_mined = GoodBlock(split_hash);\n+        reorg.push_back(last_mined);\n+        for (size_t j = COINBASE_MATURITY + txs.size() + 1; j > 0; --j) {\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            reorg.push_back(last_mined);\n+        }\n+\n+        // Add the txs to the tx pool\n+        {\n+            LOCK(cs_main);\n+            CValidationState state;\n+            std::list<CTransactionRef> plTxnReplaced;\n+            for (const auto& tx : txs) {\n+                BOOST_REQUIRE(AcceptToMemoryPool(\n+                    ::mempool,\n+                    state,\n+                    tx,\n+                    /* pfMissingInputs */ &ignored,\n+                    &plTxnReplaced,\n+                    /* bypass_limits */ false,\n+                    /* nAbsurdFee */ 0));\n+            }\n+        }\n+\n+        // Check that all txs are in the pool\n+        {\n+            LOCK(::mempool.cs);\n+            BOOST_CHECK_EQUAL(::mempool.mapTx.size(), txs.size());\n+        }\n+\n+        // Run a thread that simulates an RPC caller that is polling while\n+        // validation is doing a reorg\n+        std::thread rpc_thread{[&]() {\n+            // This thread is checking that the mempool either contains all of\n+            // the transactions invalidated by the reorg, or none of them, and\n+            // not some intermediate amount.\n+            while (true) {\n+                LOCK(::mempool.cs);\n+                if (::mempool.mapTx.size() == 0) {\n+                    // We are done with the reorg\n+                    break;\n+                }\n+                // Internally, we might be in the middle of the reorg, but\n+                // externally the reorg to the most-proof-of-work chain should\n+                // be atomic. So the caller assumes that the returned mempool\n+                // is consistent. That is, it has all txs that were there\n+                // before the reorg.\n+                assert(::mempool.mapTx.size() == txs.size());\n+                continue;",
      "path": "src/test/validation_block_tests.cpp",
      "position": 179,
      "original_position": 179,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "in_reply_to_id": 298813325,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't get this either. If you have a loop, and an unconditional continue is the last statement in the loop, the continue isn't doing anything and could be removed.\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/fa2b083c3feb0522baf652045efa6b73458761a3/src/test/validation_block_tests.cpp#L316",
      "created_at": "2019-07-02T14:11:10Z",
      "updated_at": "2019-07-02T14:11:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r299503348",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299503348"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 316,
      "original_line": 316,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299526825",
      "pull_request_review_id": 256950040,
      "id": 299526825,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5OTUyNjgyNQ==",
      "diff_hunk": "@@ -185,4 +204,131 @@ BOOST_AUTO_TEST_CASE(processnewblock_signals_ordering)\n     BOOST_CHECK_EQUAL(sub.m_expected_tip, ::ChainActive().Tip()->GetBlockHash());\n }\n \n+/**\n+ * Test that mempool updates happen atomically with reorgs.\n+ *\n+ * This prevents RPC clients, among others, from retrieving immediately-out-of-date mempool data\n+ * during large reorgs.\n+ *\n+ * The test verifies this by creating a chain of `num_txs` blocks, matures their coinbases, and then\n+ * submits txns spending from their coinbase to the mempool. A fork chain is then processed,\n+ * invalidating the txns and evicting them from the mempool.\n+ *\n+ * We verify that the mempool updates atomically by polling it continuously\n+ * from another thread during the reorg and checking that its size only changes\n+ * once. The size changing exactly once indicates that the polling thread's\n+ * view of the mempool is either consistent with the chain state before reorg,\n+ * or consistent with the chain state after the reorg, and not just consistent\n+ * with some intermediate state during the reorg.\n+ */\n+BOOST_AUTO_TEST_CASE(mempool_locks_reorg)\n+{\n+    bool ignored;\n+    auto ProcessBlock = [&ignored](std::shared_ptr<const CBlock> block) -> bool {\n+        return ProcessNewBlock(Params(), block, /* fForceProcessing */ true, /* fNewBlock */ &ignored);\n+    };\n+\n+    // Process all mined blocks\n+    BOOST_REQUIRE(ProcessBlock(std::make_shared<CBlock>(Params().GenesisBlock())));\n+    auto last_mined = GoodBlock(Params().GenesisBlock().GetHash());\n+    BOOST_REQUIRE(ProcessBlock(last_mined));\n+\n+    // Run the test multiple times\n+    for (int test_runs = 3; test_runs > 0; --test_runs) {\n+        BOOST_CHECK_EQUAL(last_mined->GetHash(), ::ChainActive().Tip()->GetBlockHash());\n+\n+        // Later on split from here\n+        const uint256 split_hash{last_mined->hashPrevBlock};\n+\n+        // Create a bunch of transactions to spend the miner rewards of the\n+        // most recent blocks\n+        std::vector<CTransactionRef> txs;\n+        for (int num_txs = 22; num_txs > 0; --num_txs) {\n+            CMutableTransaction mtx;\n+            mtx.vin.push_back(CTxIn{COutPoint{last_mined->vtx[0]->GetHash(), 1}, CScript{}});\n+            mtx.vin[0].scriptWitness.stack.push_back(V_OP_TRUE);\n+            mtx.vout.push_back(last_mined->vtx[0]->vout[1]);\n+            mtx.vout[0].nValue -= 1000;\n+            txs.push_back(MakeTransactionRef(mtx));\n+\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\n+        }\n+\n+        // Mature the inputs of the txs\n+        for (int j = COINBASE_MATURITY; j > 0; --j) {\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\n+        }\n+\n+        // Mine a reorg (and hold it back) before adding the txs to the mempool\n+        const uint256 tip_init{last_mined->GetHash()};\n+\n+        std::vector<std::shared_ptr<const CBlock>> reorg;\n+        last_mined = GoodBlock(split_hash);\n+        reorg.push_back(last_mined);\n+        for (size_t j = COINBASE_MATURITY + txs.size() + 1; j > 0; --j) {\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            reorg.push_back(last_mined);\n+        }\n+\n+        // Add the txs to the tx pool\n+        {\n+            LOCK(cs_main);\n+            CValidationState state;\n+            std::list<CTransactionRef> plTxnReplaced;\n+            for (const auto& tx : txs) {\n+                BOOST_REQUIRE(AcceptToMemoryPool(\n+                    ::mempool,\n+                    state,\n+                    tx,\n+                    /* pfMissingInputs */ &ignored,\n+                    &plTxnReplaced,\n+                    /* bypass_limits */ false,\n+                    /* nAbsurdFee */ 0));\n+            }\n+        }\n+\n+        // Check that all txs are in the pool\n+        {\n+            LOCK(::mempool.cs);\n+            BOOST_CHECK_EQUAL(::mempool.mapTx.size(), txs.size());\n+        }\n+\n+        // Run a thread that simulates an RPC caller that is polling while\n+        // validation is doing a reorg\n+        std::thread rpc_thread{[&]() {\n+            // This thread is checking that the mempool either contains all of\n+            // the transactions invalidated by the reorg, or none of them, and\n+            // not some intermediate amount.\n+            while (true) {\n+                LOCK(::mempool.cs);\n+                if (::mempool.mapTx.size() == 0) {\n+                    // We are done with the reorg\n+                    break;\n+                }\n+                // Internally, we might be in the middle of the reorg, but\n+                // externally the reorg to the most-proof-of-work chain should\n+                // be atomic. So the caller assumes that the returned mempool\n+                // is consistent. That is, it has all txs that were there\n+                // before the reorg.\n+                assert(::mempool.mapTx.size() == txs.size());\n+                continue;",
      "path": "src/test/validation_block_tests.cpp",
      "position": 179,
      "original_position": 179,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "in_reply_to_id": 298813325,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Oh, I now I understand that you were asking why I put a *redundant* `continue` there.\r\n\r\nThat was intentional, because I felt it was more clear back when I wrote the test. Happy to remove, but I think we shouldn't spend too much time on style of tests.",
      "created_at": "2019-07-02T14:54:57Z",
      "updated_at": "2019-07-02T14:54:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r299526825",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299526825"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 316,
      "original_line": 316,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299531945",
      "pull_request_review_id": 256956583,
      "id": 299531945,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5OTUzMTk0NQ==",
      "diff_hunk": "@@ -185,4 +204,131 @@ BOOST_AUTO_TEST_CASE(processnewblock_signals_ordering)\n     BOOST_CHECK_EQUAL(sub.m_expected_tip, ::ChainActive().Tip()->GetBlockHash());\n }\n \n+/**\n+ * Test that mempool updates happen atomically with reorgs.\n+ *\n+ * This prevents RPC clients, among others, from retrieving immediately-out-of-date mempool data\n+ * during large reorgs.\n+ *\n+ * The test verifies this by creating a chain of `num_txs` blocks, matures their coinbases, and then\n+ * submits txns spending from their coinbase to the mempool. A fork chain is then processed,\n+ * invalidating the txns and evicting them from the mempool.\n+ *\n+ * We verify that the mempool updates atomically by polling it continuously\n+ * from another thread during the reorg and checking that its size only changes\n+ * once. The size changing exactly once indicates that the polling thread's\n+ * view of the mempool is either consistent with the chain state before reorg,\n+ * or consistent with the chain state after the reorg, and not just consistent\n+ * with some intermediate state during the reorg.\n+ */\n+BOOST_AUTO_TEST_CASE(mempool_locks_reorg)\n+{\n+    bool ignored;\n+    auto ProcessBlock = [&ignored](std::shared_ptr<const CBlock> block) -> bool {\n+        return ProcessNewBlock(Params(), block, /* fForceProcessing */ true, /* fNewBlock */ &ignored);\n+    };\n+\n+    // Process all mined blocks\n+    BOOST_REQUIRE(ProcessBlock(std::make_shared<CBlock>(Params().GenesisBlock())));\n+    auto last_mined = GoodBlock(Params().GenesisBlock().GetHash());\n+    BOOST_REQUIRE(ProcessBlock(last_mined));\n+\n+    // Run the test multiple times\n+    for (int test_runs = 3; test_runs > 0; --test_runs) {\n+        BOOST_CHECK_EQUAL(last_mined->GetHash(), ::ChainActive().Tip()->GetBlockHash());\n+\n+        // Later on split from here\n+        const uint256 split_hash{last_mined->hashPrevBlock};\n+\n+        // Create a bunch of transactions to spend the miner rewards of the\n+        // most recent blocks\n+        std::vector<CTransactionRef> txs;\n+        for (int num_txs = 22; num_txs > 0; --num_txs) {\n+            CMutableTransaction mtx;\n+            mtx.vin.push_back(CTxIn{COutPoint{last_mined->vtx[0]->GetHash(), 1}, CScript{}});\n+            mtx.vin[0].scriptWitness.stack.push_back(V_OP_TRUE);\n+            mtx.vout.push_back(last_mined->vtx[0]->vout[1]);\n+            mtx.vout[0].nValue -= 1000;\n+            txs.push_back(MakeTransactionRef(mtx));\n+\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\n+        }\n+\n+        // Mature the inputs of the txs\n+        for (int j = COINBASE_MATURITY; j > 0; --j) {\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\n+        }\n+\n+        // Mine a reorg (and hold it back) before adding the txs to the mempool\n+        const uint256 tip_init{last_mined->GetHash()};\n+\n+        std::vector<std::shared_ptr<const CBlock>> reorg;\n+        last_mined = GoodBlock(split_hash);\n+        reorg.push_back(last_mined);\n+        for (size_t j = COINBASE_MATURITY + txs.size() + 1; j > 0; --j) {\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            reorg.push_back(last_mined);\n+        }\n+\n+        // Add the txs to the tx pool\n+        {\n+            LOCK(cs_main);\n+            CValidationState state;\n+            std::list<CTransactionRef> plTxnReplaced;\n+            for (const auto& tx : txs) {\n+                BOOST_REQUIRE(AcceptToMemoryPool(\n+                    ::mempool,\n+                    state,\n+                    tx,\n+                    /* pfMissingInputs */ &ignored,\n+                    &plTxnReplaced,\n+                    /* bypass_limits */ false,\n+                    /* nAbsurdFee */ 0));\n+            }\n+        }\n+\n+        // Check that all txs are in the pool\n+        {\n+            LOCK(::mempool.cs);\n+            BOOST_CHECK_EQUAL(::mempool.mapTx.size(), txs.size());\n+        }\n+\n+        // Run a thread that simulates an RPC caller that is polling while\n+        // validation is doing a reorg\n+        std::thread rpc_thread{[&]() {\n+            // This thread is checking that the mempool either contains all of\n+            // the transactions invalidated by the reorg, or none of them, and\n+            // not some intermediate amount.\n+            while (true) {\n+                LOCK(::mempool.cs);\n+                if (::mempool.mapTx.size() == 0) {\n+                    // We are done with the reorg\n+                    break;\n+                }\n+                // Internally, we might be in the middle of the reorg, but\n+                // externally the reorg to the most-proof-of-work chain should\n+                // be atomic. So the caller assumes that the returned mempool\n+                // is consistent. That is, it has all txs that were there\n+                // before the reorg.\n+                assert(::mempool.mapTx.size() == txs.size());\n+                continue;",
      "path": "src/test/validation_block_tests.cpp",
      "position": 179,
      "original_position": 179,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "in_reply_to_id": 298813325,
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I didn't mean to discuss style! I honestly though something was wrong because of the pointless `continue`, like missing code or something else.",
      "created_at": "2019-07-02T15:04:10Z",
      "updated_at": "2019-07-02T15:04:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r299531945",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299531945"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 316,
      "original_line": 316,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299533826",
      "pull_request_review_id": 256958959,
      "id": 299533826,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI5OTUzMzgyNg==",
      "diff_hunk": "@@ -185,4 +204,131 @@ BOOST_AUTO_TEST_CASE(processnewblock_signals_ordering)\n     BOOST_CHECK_EQUAL(sub.m_expected_tip, ::ChainActive().Tip()->GetBlockHash());\n }\n \n+/**\n+ * Test that mempool updates happen atomically with reorgs.\n+ *\n+ * This prevents RPC clients, among others, from retrieving immediately-out-of-date mempool data\n+ * during large reorgs.\n+ *\n+ * The test verifies this by creating a chain of `num_txs` blocks, matures their coinbases, and then\n+ * submits txns spending from their coinbase to the mempool. A fork chain is then processed,\n+ * invalidating the txns and evicting them from the mempool.\n+ *\n+ * We verify that the mempool updates atomically by polling it continuously\n+ * from another thread during the reorg and checking that its size only changes\n+ * once. The size changing exactly once indicates that the polling thread's\n+ * view of the mempool is either consistent with the chain state before reorg,\n+ * or consistent with the chain state after the reorg, and not just consistent\n+ * with some intermediate state during the reorg.\n+ */\n+BOOST_AUTO_TEST_CASE(mempool_locks_reorg)\n+{\n+    bool ignored;\n+    auto ProcessBlock = [&ignored](std::shared_ptr<const CBlock> block) -> bool {\n+        return ProcessNewBlock(Params(), block, /* fForceProcessing */ true, /* fNewBlock */ &ignored);\n+    };\n+\n+    // Process all mined blocks\n+    BOOST_REQUIRE(ProcessBlock(std::make_shared<CBlock>(Params().GenesisBlock())));\n+    auto last_mined = GoodBlock(Params().GenesisBlock().GetHash());\n+    BOOST_REQUIRE(ProcessBlock(last_mined));\n+\n+    // Run the test multiple times\n+    for (int test_runs = 3; test_runs > 0; --test_runs) {\n+        BOOST_CHECK_EQUAL(last_mined->GetHash(), ::ChainActive().Tip()->GetBlockHash());\n+\n+        // Later on split from here\n+        const uint256 split_hash{last_mined->hashPrevBlock};\n+\n+        // Create a bunch of transactions to spend the miner rewards of the\n+        // most recent blocks\n+        std::vector<CTransactionRef> txs;\n+        for (int num_txs = 22; num_txs > 0; --num_txs) {\n+            CMutableTransaction mtx;\n+            mtx.vin.push_back(CTxIn{COutPoint{last_mined->vtx[0]->GetHash(), 1}, CScript{}});\n+            mtx.vin[0].scriptWitness.stack.push_back(V_OP_TRUE);\n+            mtx.vout.push_back(last_mined->vtx[0]->vout[1]);\n+            mtx.vout[0].nValue -= 1000;\n+            txs.push_back(MakeTransactionRef(mtx));\n+\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\n+        }\n+\n+        // Mature the inputs of the txs\n+        for (int j = COINBASE_MATURITY; j > 0; --j) {\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            BOOST_REQUIRE(ProcessBlock(last_mined));\n+        }\n+\n+        // Mine a reorg (and hold it back) before adding the txs to the mempool\n+        const uint256 tip_init{last_mined->GetHash()};\n+\n+        std::vector<std::shared_ptr<const CBlock>> reorg;\n+        last_mined = GoodBlock(split_hash);\n+        reorg.push_back(last_mined);\n+        for (size_t j = COINBASE_MATURITY + txs.size() + 1; j > 0; --j) {\n+            last_mined = GoodBlock(last_mined->GetHash());\n+            reorg.push_back(last_mined);\n+        }\n+\n+        // Add the txs to the tx pool\n+        {\n+            LOCK(cs_main);\n+            CValidationState state;\n+            std::list<CTransactionRef> plTxnReplaced;\n+            for (const auto& tx : txs) {\n+                BOOST_REQUIRE(AcceptToMemoryPool(\n+                    ::mempool,\n+                    state,\n+                    tx,\n+                    /* pfMissingInputs */ &ignored,\n+                    &plTxnReplaced,\n+                    /* bypass_limits */ false,\n+                    /* nAbsurdFee */ 0));\n+            }\n+        }\n+\n+        // Check that all txs are in the pool\n+        {\n+            LOCK(::mempool.cs);\n+            BOOST_CHECK_EQUAL(::mempool.mapTx.size(), txs.size());\n+        }\n+\n+        // Run a thread that simulates an RPC caller that is polling while\n+        // validation is doing a reorg\n+        std::thread rpc_thread{[&]() {\n+            // This thread is checking that the mempool either contains all of\n+            // the transactions invalidated by the reorg, or none of them, and\n+            // not some intermediate amount.\n+            while (true) {\n+                LOCK(::mempool.cs);\n+                if (::mempool.mapTx.size() == 0) {\n+                    // We are done with the reorg\n+                    break;\n+                }\n+                // Internally, we might be in the middle of the reorg, but\n+                // externally the reorg to the most-proof-of-work chain should\n+                // be atomic. So the caller assumes that the returned mempool\n+                // is consistent. That is, it has all txs that were there\n+                // before the reorg.\n+                assert(::mempool.mapTx.size() == txs.size());\n+                continue;",
      "path": "src/test/validation_block_tests.cpp",
      "position": 179,
      "original_position": 179,
      "commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "original_commit_id": "fa2b083c3feb0522baf652045efa6b73458761a3",
      "in_reply_to_id": 298813325,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Ah, good point. Sorry for the confusion.",
      "created_at": "2019-07-02T15:07:49Z",
      "updated_at": "2019-07-02T15:07:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/14193#discussion_r299533826",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/299533826"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/14193"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 316,
      "original_line": 316,
      "side": "RIGHT"
    }
  ]
}