{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560",
    "id": 1133669552,
    "node_id": "PR_kwDOABII585Dkmyw",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/26560",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/26560.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/26560.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26560",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26560/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
    "number": 26560,
    "state": "closed",
    "locked": false,
    "maintainer_can_modify": false,
    "title": "wallet: bugfix, invalid CoinsResult cached total amount",
    "user": {
      "login": "furszy",
      "id": 5377650,
      "node_id": "MDQ6VXNlcjUzNzc2NTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/furszy",
      "html_url": "https://github.com/furszy",
      "followers_url": "https://api.github.com/users/furszy/followers",
      "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
      "organizations_url": "https://api.github.com/users/furszy/orgs",
      "repos_url": "https://api.github.com/users/furszy/repos",
      "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/furszy/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This comes with #26559.\r\n\r\nSolving few bugs inside the wallet's transaction creation\r\nprocess and adding test coverage for them.\r\nPlus, making use of the `CoinsResult::total_amount` cached value\r\ninside the Coin Selection process to return early if we don't have\r\nenough funds to cover the target amount.\r\n\r\n### Bugs\r\n\r\n1) The `CoinsResult::Erase` method removes only one\r\noutput from the available coins vector (there is a [loop break](https://github.com/bitcoin/bitcoin/blob/c1061be14a515b0ed4f4d646fcd0378c62e6ded3/src/wallet/spend.cpp#L112)\r\nthat should have never been there) and not all the preset inputs.\r\n\r\n   Which on master is not a problem, because since [#25685](https://github.com/bitcoin/bitcoin/pull/25685)\r\n   we are no longer using the method. But, it's a bug on v24\r\n   (check [#26559](https://github.com/bitcoin/bitcoin/pull/26559)).\r\n\r\n   This method it's being fixed and not removed because I'm later using it to solve\r\n   another bug inside this PR.\r\n\r\n2) As we update the total cached amount of the `CoinsResult` object inside\r\n   `AvailableCoins` and we don't use such function inside the coin selection\r\n   tests (we manually load up the `CoinsResult` object), there is a discrepancy\r\n   between the outputs that we add/erase and the total amount cached value.\r\n\r\n### Improvements\r\n\r\n* This makes use of the `CoinsResult` total amount field to early return\r\n  with an \"Insufficient funds\" error inside Coin Selection if the tx target\r\n  amount is greater than the sum of all the wallet available coins plus the\r\n  preset inputs amounts (we don't need to perform the entire coin selection\r\n  process if we already know that there aren't enough funds inside our wallet).\r\n\r\n### Test Coverage\r\n\r\n1) Adds test coverage for the duplicated preset input selection bug that we have in v24.\r\n  Where the wallet invalidly selects the preset inputs twice during the Coin Selection\r\n  process. Which ends up with a \"good\" Coin Selection result that does not cover the\r\n  total tx target amount. Which, alone, crashes the wallet due an insane fee.\r\n  But.. to make it worst, adding the subtract fee from output functionality\r\n  to this mix ends up with the wallet by-passing the \"insane\" fee assertion,\r\n  decreasing the output amount to fulfill the insane fee, and.. sadly,\r\n  broadcasting the tx to the network.\r\n\r\n2) Adds test coverage for the `CoinsResult::Erase` method.\r\n\r\n------------------------------------\r\n\r\nTO DO:\r\n* [Â ] Update [#26559 ](https://github.com/bitcoin/bitcoin/pull/26559) description.",
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "created_at": "2022-11-23T15:13:40Z",
    "updated_at": "2023-05-27T01:47:07Z",
    "closed_at": "2022-12-05T17:01:36Z",
    "mergeable": false,
    "mergeable_state": "dirty",
    "merged_at": "2022-12-05T17:01:36Z",
    "merge_commit_sha": "f0c4807a6a9b7391dcbadc4c7abcd0b5b95caf86",
    "assignees": [],
    "requested_reviewers": [
      {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      }
    ],
    "requested_teams": [],
    "rebaseable": false,
    "head": {
      "label": "furszy:2022_wallet_bugfix_coinsresult",
      "ref": "2022_wallet_bugfix_coinsresult",
      "sha": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 143624913,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNDM2MjQ5MTM=",
        "name": "bitcoin-core",
        "full_name": "furszy/bitcoin-core",
        "owner": {
          "login": "furszy",
          "id": 5377650,
          "node_id": "MDQ6VXNlcjUzNzc2NTA=",
          "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/furszy",
          "html_url": "https://github.com/furszy",
          "followers_url": "https://api.github.com/users/furszy/followers",
          "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
          "organizations_url": "https://api.github.com/users/furszy/orgs",
          "repos_url": "https://api.github.com/users/furszy/repos",
          "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/furszy/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/furszy/bitcoin-core",
        "description": "Bitcoin-Core",
        "fork": true,
        "url": "https://api.github.com/repos/furszy/bitcoin-core",
        "archive_url": "https://api.github.com/repos/furszy/bitcoin-core/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/furszy/bitcoin-core/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/furszy/bitcoin-core/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/furszy/bitcoin-core/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/furszy/bitcoin-core/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/furszy/bitcoin-core/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/furszy/bitcoin-core/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/furszy/bitcoin-core/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/furszy/bitcoin-core/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/furszy/bitcoin-core/contributors",
        "deployments_url": "https://api.github.com/repos/furszy/bitcoin-core/deployments",
        "downloads_url": "https://api.github.com/repos/furszy/bitcoin-core/downloads",
        "events_url": "https://api.github.com/repos/furszy/bitcoin-core/events",
        "forks_url": "https://api.github.com/repos/furszy/bitcoin-core/forks",
        "git_commits_url": "https://api.github.com/repos/furszy/bitcoin-core/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/furszy/bitcoin-core/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/furszy/bitcoin-core/git/tags%7B/sha%7D",
        "git_url": "git://github.com/furszy/bitcoin-core.git",
        "issue_comment_url": "https://api.github.com/repos/furszy/bitcoin-core/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/furszy/bitcoin-core/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/furszy/bitcoin-core/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/furszy/bitcoin-core/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/furszy/bitcoin-core/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/furszy/bitcoin-core/languages",
        "merges_url": "https://api.github.com/repos/furszy/bitcoin-core/merges",
        "milestones_url": "https://api.github.com/repos/furszy/bitcoin-core/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/furszy/bitcoin-core/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/furszy/bitcoin-core/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/furszy/bitcoin-core/releases%7B/id%7D",
        "ssh_url": "git@github.com:furszy/bitcoin-core.git",
        "stargazers_url": "https://api.github.com/repos/furszy/bitcoin-core/stargazers",
        "statuses_url": "https://api.github.com/repos/furszy/bitcoin-core/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/furszy/bitcoin-core/subscribers",
        "subscription_url": "https://api.github.com/repos/furszy/bitcoin-core/subscription",
        "tags_url": "https://api.github.com/repos/furszy/bitcoin-core/tags",
        "teams_url": "https://api.github.com/repos/furszy/bitcoin-core/teams",
        "trees_url": "https://api.github.com/repos/furszy/bitcoin-core/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/furszy/bitcoin-core.git",
        "hooks_url": "https://api.github.com/repos/furszy/bitcoin-core/hooks",
        "svn_url": "https://github.com/furszy/bitcoin-core",
        "homepage": "",
        "language": "C++",
        "forks_count": 2,
        "stargazers_count": 1,
        "watchers_count": 1,
        "size": 380259,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-06T20:18:24Z",
        "created_at": "2018-08-05T15:28:43Z",
        "updated_at": "2023-02-27T18:01:49Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "78aee0fe2ca72e7bc0f36e7479574ebc1f6a9bee",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 34324,
        "stargazers_count": 69818,
        "watchers_count": 69818,
        "size": 233879,
        "default_branch": "master",
        "open_issues_count": 627,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-07T07:15:46Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-06-07T06:49:43Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 181,
    "deletions": 18,
    "changed_files": 7,
    "commits": 7,
    "review_comments": 69,
    "comments": 16
  },
  "events": [
    {
      "event": "commented",
      "id": 1325231872,
      "node_id": "IC_kwDOABII585O_W8A",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1325231872",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-23T15:13:43Z",
      "updated_at": "2022-12-05T16:53:19Z",
      "author_association": "MEMBER",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [achow101](https://github.com/bitcoin/bitcoin/pull/26560#issuecomment-1337720637), [josibake](https://github.com/bitcoin/bitcoin/pull/26560#pullrequestreview-1204899567) |\n| Stale ACK | [Xekyo](https://github.com/bitcoin/bitcoin/pull/26560#pullrequestreview-1199933874), [S3RK](https://github.com/bitcoin/bitcoin/pull/26560#issuecomment-1332724607), [glozow](https://github.com/bitcoin/bitcoin/pull/26560#pullrequestreview-1204227563) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#26573](https://github.com/bitcoin/bitcoin/pull/26573) (Wallet: don't underestimate the fees when spending a Taproot output by darosior)\n* [#26567](https://github.com/bitcoin/bitcoin/pull/26567) (Wallet: estimate the size of signed inputs using descriptors by darosior)\n* [#25729](https://github.com/bitcoin/bitcoin/pull/25729) (wallet: Check max transaction weight in CoinSelection by aureleoules)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#issuecomment-1325231872",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26560"
    },
    {
      "event": "labeled",
      "id": 7878221184,
      "node_id": "LE_lADOABII585XI28czwAAAAHVlB2A",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7878221184",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-23T15:13:45Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "reviewed",
      "id": 1191984507,
      "node_id": "PRR_kwDOABII585HDD17",
      "url": null,
      "actor": null,
      "commit_id": "0fd9be14af28a5c707f2d5be03d252d2b5cb7ad7",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Good catch! Unfortunate that this was found right as we're doing the 24.0 release.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#pullrequestreview-1191984507",
      "submitted_at": "2022-11-23T16:39:46Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7881636414,
      "node_id": "HRFPE_lADOABII585XI28czwAAAAHVyDo-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7881636414",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-24T00:32:25Z"
    },
    {
      "event": "review_requested",
      "id": 7885649448,
      "node_id": "RRE_lADOABII585XI28czwAAAAHWBXYo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7885649448",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-24T12:30:15Z",
      "requested_reviewer": {
        "login": "Xekyo",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Xekyo",
        "html_url": "https://github.com/Xekyo",
        "followers_url": "https://api.github.com/users/Xekyo/followers",
        "following_url": "https://api.github.com/users/Xekyo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Xekyo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Xekyo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Xekyo/subscriptions",
        "organizations_url": "https://api.github.com/users/Xekyo/orgs",
        "repos_url": "https://api.github.com/users/Xekyo/repos",
        "events_url": "https://api.github.com/users/Xekyo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Xekyo/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "review_requested",
      "id": 7885649455,
      "node_id": "RRE_lADOABII585XI28czwAAAAHWBXYv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7885649455",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-24T12:30:15Z",
      "requested_reviewer": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "reviewed",
      "id": 1194885937,
      "node_id": "PRR_kwDOABII585HOIMx",
      "url": null,
      "actor": null,
      "commit_id": "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "oh wow, that's a nasty bug. \r\n\r\nAlmost Code Review ACK modulo use of `available_coins.total_amount` with SFFO in the last commit.\r\n\r\nI was quite surprised something like this wasn't caught by some assert. So I dig up and maybe we can add something like e783af37a77bbe91cd6ec8802292838377d9a0aa while you're at it ",
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#pullrequestreview-1194885937",
      "submitted_at": "2022-11-26T17:33:38Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
    },
    {
      "event": "commented",
      "id": 1329146984,
      "node_id": "IC_kwDOABII585POSxo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1329146984",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-28T13:54:40Z",
      "updated_at": "2022-11-28T13:54:40Z",
      "author_association": "MEMBER",
      "body": "Asking here instead of in the backport: is this only in v24 or also earlier versions?",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#issuecomment-1329146984",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26560"
    },
    {
      "event": "commented",
      "id": 1329161687,
      "node_id": "IC_kwDOABII585POWXX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1329161687",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-28T14:03:16Z",
      "updated_at": "2022-11-28T14:03:16Z",
      "author_association": "MEMBER",
      "body": "> Asking here instead of in the backport: is this only in v24 or also earlier versions?\r\n\r\nMy understanding is only v24.x. Seems like the buggy behaviour was introduced in #24584 + #25734?",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#issuecomment-1329161687",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26560"
    },
    {
      "event": "review_requested",
      "id": 7903266823,
      "node_id": "RRE_lADOABII585XI28czwAAAAHXEkgH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7903266823",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-28T14:04:23Z",
      "requested_reviewer": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "commented",
      "id": 1329163697,
      "node_id": "IC_kwDOABII585POW2x",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1329163697",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-28T14:04:31Z",
      "updated_at": "2022-11-28T14:28:38Z",
      "author_association": "MEMBER",
      "body": "> Asking here instead of in the backport: is this only in v24 or also earlier versions?\r\n\r\nYeah. @Sjors only for v24. The dangerous bug was introduced in #25734 which is only on v24, and after branching off, we merged #25685 which fixed it without noticing it.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#issuecomment-1329163697",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26560"
    },
    {
      "event": "mentioned",
      "id": 7903268119,
      "node_id": "MEE_lADOABII585XI28czwAAAAHXEk0X",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7903268119",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-28T14:04:31Z"
    },
    {
      "event": "subscribed",
      "id": 7903268143,
      "node_id": "SE_lADOABII585XI28czwAAAAHXEk0v",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7903268143",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-28T14:04:31Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7906208895,
      "node_id": "HRFPE_lADOABII585XI28czwAAAAHXPyx_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7906208895",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-28T19:32:17Z"
    },
    {
      "event": "commented",
      "id": 1329665367,
      "node_id": "IC_kwDOABII585PQRVX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1329665367",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-28T19:48:05Z",
      "updated_at": "2022-11-28T19:48:05Z",
      "author_association": "MEMBER",
      "body": "Feedback tackled, thanks @S3RK and @achow101.\r\n\r\nChanges:\r\n1) In the tests, removed the unneeded coins lock.\r\n2) Now `SelectCoins` returns early if the wallet's available coins `total_effective_amount` is not available (it does not fallback to use the raw total amount anymore).",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#issuecomment-1329665367",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26560"
    },
    {
      "event": "mentioned",
      "id": 7906313985,
      "node_id": "MEE_lADOABII585XI28czwAAAAHXQMcB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7906313985",
      "actor": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-28T19:48:06Z"
    },
    {
      "event": "subscribed",
      "id": 7906313991,
      "node_id": "SE_lADOABII585XI28czwAAAAHXQMcH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7906313991",
      "actor": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-28T19:48:06Z"
    },
    {
      "event": "mentioned",
      "id": 7906314004,
      "node_id": "MEE_lADOABII585XI28czwAAAAHXQMcU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7906314004",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-28T19:48:06Z"
    },
    {
      "event": "subscribed",
      "id": 7906314011,
      "node_id": "SE_lADOABII585XI28czwAAAAHXQMcb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7906314011",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-28T19:48:06Z"
    },
    {
      "event": "commented",
      "id": 1330050199,
      "node_id": "IC_kwDOABII585PRvSX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1330050199",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-29T04:10:40Z",
      "updated_at": "2022-11-29T04:10:40Z",
      "author_association": "MEMBER",
      "body": "I think probably `CoinsResult::coins` should be a `std::map<OutputType, std::unordered_set<COutput>>` instead of [map of] vectors. It's too strange that we could end up with the same output in there twice. Maybe even an assert failure if we try to add the same ones twice?",
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#issuecomment-1330050199",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26560"
    },
    {
      "event": "reviewed",
      "id": 1196862786,
      "node_id": "PRR_kwDOABII585HVq1C",
      "url": null,
      "actor": null,
      "commit_id": "1b14bd7ac77027351a1e5b3ef21fb2d1de659efd",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "The bugfix should also be done in its own commit, absent any refactoring.\r\n\r\nI think this means just dropping the `break` and replacing the `find_if` with `remove_if`?",
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#pullrequestreview-1196862786",
      "submitted_at": "2022-11-29T04:12:58Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
    },
    {
      "event": "reviewed",
      "id": 1197593313,
      "node_id": "PRR_kwDOABII585HYdLh",
      "url": null,
      "actor": null,
      "commit_id": "1b14bd7ac77027351a1e5b3ef21fb2d1de659efd",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK https://github.com/bitcoin/bitcoin/pull/26560/commits/1b14bd7ac77027351a1e5b3ef21fb2d1de659efd\r\n\r\nGlad you caught this! Surprised and pretty bummed this slipped through in #25734 :disappointed: \r\n\r\nLeft a few suggestions, but non-blocking.",
      "user": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#pullrequestreview-1197593313",
      "submitted_at": "2022-11-29T14:23:37Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
    },
    {
      "event": "commented",
      "id": 1330799911,
      "node_id": "IC_kwDOABII585PUmUn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1330799911",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-29T15:10:42Z",
      "updated_at": "2022-11-29T15:32:24Z",
      "author_association": "MEMBER",
      "body": "> I think probably `CoinsResult::coins` should be a `std::map<OutputType, std::unordered_set<COutput>>` instead of [map of] vectors. It's too strange that we could end up with the same output in there twice. Maybe even an assert failure if we try to add the same ones twice?\r\n\r\n@luke-jr: we can't end up with the same output twice there. That struct is loaded inside `AvailableCoins` which traverses the wallet's txes map once.\r\nIn v24, where we don't have https://github.com/bitcoin/bitcoin/pull/25685 merge, the preset inputs were fetched twice: first inside `AvailableCoins` which was appending them to the `CoinsResult` vectors and secondly inside `SelectCoins` where we were manually fetching them from the wallet txes map [here](https://github.com/bitcoin/bitcoin/blob/c1061be14a515b0ed4f4d646fcd0378c62e6ded3/src/wallet/spend.cpp#L542-L587) (by calling `GetWalletTx(outpoint)`). \r\nThen, `SelectCoins` was removing the preset inputs from the `CoinsResult` vectors before start the automatic coin selection process so the process does not select them (bug was here, the `Erase` function was not removing them). Then, at the end of the selection process, we merge both results (the preset inputs selection result and the automatic coin selection result).",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#issuecomment-1330799911",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26560"
    },
    {
      "event": "mentioned",
      "id": 7913582873,
      "node_id": "MEE_lADOABII585XI28czwAAAAHXr7EZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7913582873",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-29T15:10:42Z"
    },
    {
      "event": "subscribed",
      "id": 7913582893,
      "node_id": "SE_lADOABII585XI28czwAAAAHXr7Et",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7913582893",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-29T15:10:42Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGY5MzBhZWZmZjk2OTBhMWU4MzBkODk3ZDBhOGM1M2Y0MjE5YWU0YTg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f930aefff9690a1e830d897d0a8c53f4219ae4a8",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/f930aefff9690a1e830d897d0a8c53f4219ae4a8",
      "tree": {
        "sha": "623fb71dacc4fb175ba8cd32e8f03e8ca1354696",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/623fb71dacc4fb175ba8cd32e8f03e8ca1354696"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 623fb71dacc4fb175ba8cd32e8f03e8ca1354696\nparent 38d06e1561013f4ca845fd5ba6ffcc64de67f9c0\nauthor furszy <matiasfurszyfer@protonmail.com> 1669127975 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1669735831 -0300\n\nwallet: bugfix, 'CoinsResult::Erase' is erasing only one output of the set\n\nThe loop break shouldn't have being there.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmOGJZcACgkQXdI8zGhq\npiPOcBAAs+hC2q81sDaSd9rkNp74hLodDeg6VbwK1Uo0uAZjTig6gIEqAiNyRYCq\nMMajY9975SSe2EtLb46mKKYO9b/GhsC6NpXodEhSCtGw+oIfKm1oQek08Pm8jBZo\nkVBix4ySU5ADEcuTy7jOyHazG7nlmjGvyVdzwsJPhAqIme75HLs/sBOHhyHIrC0H\nC1XVkWszascgFVjn0rBO6C/fWLsVGT7knRn8lWUWIoCmwX9cT+6BDxRpctNbuOlF\nSPKWXtxyCyeboPeZSiHf0vK362H/X2juVIY+ogL+wJXyaT+e9ridY6VwSzOLrEsL\nF/YGHOohiDH7jWDTA77iGMz5gs19dRFBxRv2RgCyBk+XRpGYSpV1d/XruZ7loCBX\nSL4JpNiTstsOZUcS2MMjDZRr6NOSTcrt6z9ZWnTBiIKDmxX3eqUozEtNb3EhEIYL\na4dignKnOFD+dR9Hx9kQEdCpCXEMl6uy4LOJxp2qeJ8+vz+UbG0pl4Q25U+7OmWy\nJiOiCWZ0E4X2e1oPstWbyq2vabdL2gRAMn3979b6EzykNNw2Qn93VAv84lJeE3O0\n0ONu5CkdaDKMezn4xZQhZVa13GpE9FEl4c6nufDNpS7wPFFEKHrTKrVWG+k6hctq\n5ChCPgA62FNTfNtZZMQa1PMaRbvo8guSADmhBGPV7XVN4X4OHvs=\n=lvik\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/38d06e1561013f4ca845fd5ba6ffcc64de67f9c0",
          "sha": "38d06e1561013f4ca845fd5ba6ffcc64de67f9c0",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/38d06e1561013f4ca845fd5ba6ffcc64de67f9c0"
        }
      ],
      "message": "wallet: bugfix, 'CoinsResult::Erase' is erasing only one output of the set\n\nThe loop break shouldn't have being there.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2022-11-29T15:30:31Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2022-11-22T14:39:35Z"
      },
      "sha": "f930aefff9690a1e830d897d0a8c53f4219ae4a8"
    },
    {
      "event": "commented",
      "id": 1330975637,
      "node_id": "IC_kwDOABII585PVROV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1330975637",
      "actor": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-29T17:03:35Z",
      "updated_at": "2022-11-29T17:03:35Z",
      "author_association": "MEMBER",
      "body": "fwiw, I ran the failing CI test locally and it passed, so I think all you need to do is restart the test",
      "user": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#issuecomment-1330975637",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26560"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7917097976,
      "node_id": "HRFPE_lADOABII585XI28czwAAAAHX5VP4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7917097976",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-29T22:45:20Z"
    },
    {
      "event": "commented",
      "id": 1331424471,
      "node_id": "IC_kwDOABII585PW-zX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1331424471",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-29T22:57:47Z",
      "updated_at": "2022-11-29T23:00:39Z",
      "author_association": "MEMBER",
      "body": "Updated per feedback, thanks everyone. [Small diff](https://github.com/bitcoin/bitcoin/compare/1b14bd7ac77027351a1e5b3ef21fb2d1de659efd..8f9bd177255f285a53871fa278528338407af267).\r\n\r\nChanges:\r\n1) Per @S3RK feedback, cherry-picked the simple fallback assertion (eb76557).\r\n   I still think that we might want to merge different `SelectionResult` objects that share some outputs in the future but.. now it's definitely not the right time to do it.\r\n2) Per @josibake feedback, added [#26559](https://github.com/bitcoin/bitcoin/pull/26559) mention in the functional test cases and few more details in the comments.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#issuecomment-1331424471",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26560"
    },
    {
      "event": "mentioned",
      "id": 7917153391,
      "node_id": "MEE_lADOABII585XI28czwAAAAHX5ixv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7917153391",
      "actor": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-29T22:57:47Z"
    },
    {
      "event": "subscribed",
      "id": 7917153397,
      "node_id": "SE_lADOABII585XI28czwAAAAHX5ix1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7917153397",
      "actor": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-29T22:57:47Z"
    },
    {
      "event": "mentioned",
      "id": 7917153402,
      "node_id": "MEE_lADOABII585XI28czwAAAAHX5ix6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7917153402",
      "actor": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-29T22:57:47Z"
    },
    {
      "event": "subscribed",
      "id": 7917153406,
      "node_id": "SE_lADOABII585XI28czwAAAAHX5ix-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7917153406",
      "actor": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-29T22:57:47Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7917163654,
      "node_id": "HRFPE_lADOABII585XI28czwAAAAHX5lSG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7917163654",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-29T23:00:09Z"
    },
    {
      "event": "commented",
      "id": 1331432988,
      "node_id": "IC_kwDOABII585PXA4c",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1331432988",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-29T23:06:59Z",
      "updated_at": "2022-12-01T17:11:07Z",
      "author_association": "MEMBER",
      "body": "~ACK eb76557331b4f34b568da1d9c589c7005d7ab46d~",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#issuecomment-1331432988",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26560"
    },
    {
      "event": "commented",
      "id": 1331900188,
      "node_id": "IC_kwDOABII585PYy8c",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1331900188",
      "actor": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-30T09:56:52Z",
      "updated_at": "2022-11-30T09:56:52Z",
      "author_association": "MEMBER",
      "body": "ACK https://github.com/bitcoin/bitcoin/commit/eb76557331b4f34b568da1d9c589c7005d7ab46d\r\n\r\nreviewed the diff, looks good",
      "user": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#issuecomment-1331900188",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26560"
    },
    {
      "event": "reviewed",
      "id": 1199933874,
      "node_id": "PRR_kwDOABII585HhYmy",
      "url": null,
      "actor": null,
      "commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "user": {
        "login": "Xekyo",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Xekyo",
        "html_url": "https://github.com/Xekyo",
        "followers_url": "https://api.github.com/users/Xekyo/followers",
        "following_url": "https://api.github.com/users/Xekyo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Xekyo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Xekyo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Xekyo/subscriptions",
        "organizations_url": "https://api.github.com/users/Xekyo/orgs",
        "repos_url": "https://api.github.com/users/Xekyo/repos",
        "events_url": "https://api.github.com/users/Xekyo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Xekyo/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#pullrequestreview-1199933874",
      "submitted_at": "2022-11-30T20:43:36Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
    },
    {
      "event": "reviewed",
      "id": 1199994539,
      "node_id": "PRR_kwDOABII585Hhnar",
      "url": null,
      "actor": null,
      "commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#pullrequestreview-1199994539",
      "submitted_at": "2022-11-30T20:49:27Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
    },
    {
      "event": "commented",
      "id": 1332724607,
      "node_id": "IC_kwDOABII585Pb8N_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1332724607",
      "actor": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-30T20:55:10Z",
      "updated_at": "2022-11-30T20:55:10Z",
      "author_association": "MEMBER",
      "body": "ACK eb76557331b4f34b568da1d9c589c7005d7ab46d\r\n\r\nWill reack if you address nits",
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#issuecomment-1332724607",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26560"
    },
    {
      "event": "reviewed",
      "id": 1199471979,
      "node_id": "PRR_kwDOABII585Hfn1r",
      "url": null,
      "actor": null,
      "commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#pullrequestreview-1199471979",
      "submitted_at": "2022-12-01T10:26:56Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
    },
    {
      "event": "reviewed",
      "id": 1201300739,
      "node_id": "PRR_kwDOABII585HmmUD",
      "url": null,
      "actor": null,
      "commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#pullrequestreview-1201300739",
      "submitted_at": "2022-12-01T16:18:51Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
    },
    {
      "event": "reviewed",
      "id": 1201306217,
      "node_id": "PRR_kwDOABII585Hmnpp",
      "url": null,
      "actor": null,
      "commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#pullrequestreview-1201306217",
      "submitted_at": "2022-12-01T16:22:16Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
    },
    {
      "event": "commented",
      "id": 1334090387,
      "node_id": "IC_kwDOABII585PhJqT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1334090387",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-12-01T17:11:53Z",
      "updated_at": "2022-12-01T17:11:53Z",
      "author_association": "MEMBER",
      "body": "Retracting my ACK for now. It seems that the comment wordings is confusing several people, so it would be good to have those be clear as to what the bugs are to avoid confusion in the future.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#issuecomment-1334090387",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26560"
    },
    {
      "event": "reviewed",
      "id": 1201406725,
      "node_id": "PRR_kwDOABII585HnAMF",
      "url": null,
      "actor": null,
      "commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "strong Concept ACK, I understand the bug has a significant impact and agree with the fix, but the documentation should be changed as I think it is currently incorrect and could be misleading to someone in the future trying to debug / reproduce what was wrong with v24.0.\r\n\r\nTLDR I don't think the \"insane fee\" bug is actually possible? I've made some suggestions for what I think the documentation should be inline (same suggestion wrt the commit messages).",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#pullrequestreview-1201406725",
      "submitted_at": "2022-12-01T17:58:33Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
    },
    {
      "event": "commented",
      "id": 1334201650,
      "node_id": "IC_kwDOABII585Phk0y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1334201650",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-12-01T18:51:46Z",
      "updated_at": "2022-12-01T18:51:46Z",
      "author_association": "MEMBER",
      "body": "Ok great, thanks everyone. Now I see where the confusion arises.\r\nWill be tackling all the feedback and updating the PR soon.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#issuecomment-1334201650",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26560"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDM0MWJhN2ZmZDhjZGI1NmI0Y2RlMWYyNTE3NjhjM2QyYzJhOWI0ZTk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/341ba7ffd8cdb56b4cde1f251768c3d2c2a9b4e9",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/341ba7ffd8cdb56b4cde1f251768c3d2c2a9b4e9",
      "tree": {
        "sha": "0f32f34106d22d769854f654fa95a0b77d5dc6b2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0f32f34106d22d769854f654fa95a0b77d5dc6b2"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 0f32f34106d22d769854f654fa95a0b77d5dc6b2\nparent f930aefff9690a1e830d897d0a8c53f4219ae4a8\nauthor furszy <matiasfurszyfer@protonmail.com> 1669132699 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1669995555 -0300\n\ntest: wallet, coverage for CoinsResult::Erase function\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmOKHCMACgkQXdI8zGhq\npiPWiBAAuzyJjaxqQErzutzrCUYmDHPcUg/uSyyysSGXDRsxRPZirC1YZVvqbxe/\n2KR+z/ggyjHjaYLOBuFbPbLLYlU9o6Gvq10IEM9odpHIM6XMvOzlc8XkhrPMXQMv\nIuQcHiWQTGmj1UnL3fVGhj18x8+xVyhE7J6maOisLwZ1pE+EnZFqCtKJ5tNoiJdi\nff4J+zDj+5X18MZK0q6UZIaOpRqhahpSRyc/ZzL6HPkMRwxRj3Xw6xSZm2vZsuBT\n8pPP5B/TOrVy0I7s104SWXRVEwQk58MLmmauBKKsCckxeOcnKmx/EiVR6z2gl7XK\nawkgY+aOugDG3Ix9dZVmGEYLm84eOPZA96h39au32+a9dYleuVD395FDXdEmuzn8\n0h0R7up8pJW31cg0KKamYLvIM7jMBM1RvlBprqthS6zAd9rXGU0p1gXxJem2TSgm\nO7ekgCnyMUZwFdGQsf+1q1hT6Hd0Q9NTJjqOJrsM8qGF9KMctrgtd73d5rnd1+1d\n+HdN0A6ZtKorpxymVaMgVVWiEJJUoV3GDoHOvdN2KwsAk6VQyyLZkq0vLld/rjX+\nVCZrKEwuSIFzbjweNAK+Bg61hxrGicvX4Zou0LKRPLiGp131i8JiVBjR+lHXkhoj\nu4TUUnbpNNEGjLMrdoQ1JgC0r+awgRYKekiXXgn17P6pzsJulb8=\n=Ble4\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f930aefff9690a1e830d897d0a8c53f4219ae4a8",
          "sha": "f930aefff9690a1e830d897d0a8c53f4219ae4a8",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/f930aefff9690a1e830d897d0a8c53f4219ae4a8"
        }
      ],
      "message": "test: wallet, coverage for CoinsResult::Erase function",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2022-12-02T15:39:15Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2022-11-22T15:58:19Z"
      },
      "sha": "341ba7ffd8cdb56b4cde1f251768c3d2c2a9b4e9"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGNmNzkzODQ2OTc4YTg3ODNjMjNiNjZiYTZiNGYzZjMwZTgzZmYzZWI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cf793846978a8783c23b66ba6b4f3f30e83ff3eb",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/cf793846978a8783c23b66ba6b4f3f30e83ff3eb",
      "tree": {
        "sha": "42061f34008801992d22b159973dfd14d1ba8840",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/42061f34008801992d22b159973dfd14d1ba8840"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 42061f34008801992d22b159973dfd14d1ba8840\nparent 341ba7ffd8cdb56b4cde1f251768c3d2c2a9b4e9\nauthor furszy <matiasfurszyfer@protonmail.com> 1669209770 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1669995555 -0300\n\ntest: Coin Selection, duplicated preset inputs selection\n\nThis exercises the bug inside CoinsResult::Erase that\nends up on (1) a wallet crash or (2) a created and\nbroadcasted tx that contains a reduced recipient's amount.\n\nThis is covered by making the wallet selects the preset\ninputs twice during the coin selection process.\n\nMaking the wallet think that the selection process result covers\nthe entire tx target when it does not. It's actually creating\na tx that sends more coins than what inputs are covering for.\n\nWhich, combined with the SFFO option, makes the wallet\nincorrectly reduce the recipient's amount by the difference\nbetween the original target and the wrongly counted inputs.\nWhich means, a created and relayed tx sending less coins to\nthe destination than what the user inputted.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmOKHCMACgkQXdI8zGhq\npiNy/BAAz47TsEv1ScFHhN7xGvxUFFoQAjgP4eeEFj4t2Lh/E5ty4i3l8MNRQ5a1\nSiaxzEgM3bpdFtOa/TpB8wWSkdeDE+kgsd8ASsg0SS2c3VY+0kxhADqSESTrcj98\nqy/mQ5pdG40kGxzWvsP/e1Qy4nYyH9/C9gkXK9JM8D3LSzGhtsGH8+37jAWIELUT\nOKRo5514KKwx2DV8tOs0KozJu7FHdRDgQmqquB2ko082hDkkkQhqjo5ZcRlHPWB+\nRb4cPygwSl+mo806I97TVaG2fc13VWQrmdz9Bjil/kJjy41iC0MrzTU9p6tLYGW0\nqqhT3cP/Hwy3aQ+8dDg0ZyVwYnZbR5mBJsy1cMX4wWrJvQdKVUQmuDvzivfHnurt\nMYvIX+S0zuLwyeRz2IG7SQlDY9mXTUqCVdJimO8w7aGpNCxAFX0yLjoZFpy0tI/p\nFes7N/LlB2Z8Gf7jTlCu49MSBIE8pZQEESZyZE4V4vqtUkiYFKY2DZLpHDJEvaQy\nhYpEv82bVjt3AYKYnHF7ndok9BC8CeHBs67uoQ7uJWKuJOTrqe34upleg8GoY896\n3Y6VpUSTbefkxpwv530U+UdJg64H0sdpyo7aT2cNUwK3CzhEoSwfGx6QqQeu0YYy\nonRPpBuN/pp7VeQyCxI6eLVyE/vGl8li9aKLAkeL7TrWEHA7oY0=\n=n0sO\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/341ba7ffd8cdb56b4cde1f251768c3d2c2a9b4e9",
          "sha": "341ba7ffd8cdb56b4cde1f251768c3d2c2a9b4e9",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/341ba7ffd8cdb56b4cde1f251768c3d2c2a9b4e9"
        }
      ],
      "message": "test: Coin Selection, duplicated preset inputs selection\n\nThis exercises the bug inside CoinsResult::Erase that\nends up on (1) a wallet crash or (2) a created and\nbroadcasted tx that contains a reduced recipient's amount.\n\nThis is covered by making the wallet selects the preset\ninputs twice during the coin selection process.\n\nMaking the wallet think that the selection process result covers\nthe entire tx target when it does not. It's actually creating\na tx that sends more coins than what inputs are covering for.\n\nWhich, combined with the SFFO option, makes the wallet\nincorrectly reduce the recipient's amount by the difference\nbetween the original target and the wrongly counted inputs.\nWhich means, a created and relayed tx sending less coins to\nthe destination than what the user inputted.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2022-12-02T15:39:15Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2022-11-23T13:22:50Z"
      },
      "sha": "cf793846978a8783c23b66ba6b4f3f30e83ff3eb"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGNhYzI3MjVmZDBmNWJhZWI3NDFkZmUwNzlhODczMzI3ODRjMmFkYzc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cac2725fd0f5baeb741dfe079a87332784c2adc7",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/cac2725fd0f5baeb741dfe079a87332784c2adc7",
      "tree": {
        "sha": "47a0a2ce309fcc10efc1501bad0a0301f2d067e3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/47a0a2ce309fcc10efc1501bad0a0301f2d067e3"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 47a0a2ce309fcc10efc1501bad0a0301f2d067e3\nparent cf793846978a8783c23b66ba6b4f3f30e83ff3eb\nauthor furszy <matiasfurszyfer@protonmail.com> 1669128224 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1669995555 -0300\n\ntest: bugfix, coinselector_test, use 'CoinsResult::Erase/Add' instead of direct member access\n\nAside from the cleanup, this solves a bug in the following-up commit. Because, in these\ntests, we are manually adding/erasing outputs from the CoinsResult object but never\nupdating the internal total amount field.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmOKHCMACgkQXdI8zGhq\npiPjyQ/+JLA0LVOpSCTIEsjEmj9wWEa94pw4y439dI40U8RBhVOuEi9SN7ReGtim\nfFAFj7O3hib/6XkD4AkTcpV2OpPXui2GqgqJIK0zl4nLA8OWLKMZcQzkM4fDxCvD\ncTQjpOOwnfDKQV0kmen59k4Y6/W+zD9nEHgc1gqm4AxqP8z9lYydBD2ecostOx1L\n4PoM7mvWjw4pNosgexVn7rXxzJIB7BlFrsD5QEDl+adPdyumJxHbZbiIC2QDEFVb\nsD5Ldr5iO6Q51QF4x3rJLhvhhwHsxhdPCA36l+dO152Jii9n+Oy0mo+6TrEID4hB\nnu4+EDJ9umsNEh2LQjCd43E14rf0TDlWFXIibKuC2hPWwlHd1rSTAfzz7gO2sjp9\nhDj4gTA5TI/7oa6hDICpkXfvRiQO45Z7JTYuejUYS7y/ZsPeTZF4PUUIEwbWLaiy\nBTMQfj1idD5dFvv9pQjbZLtyrILThPgZRtm2Kv/TgNecqjPaMX+5fq6pmQxqQyWK\n6wY+UxyBG+om6eqc1Gokk6CaprFnVQHRlP3IlPBymMbQlJGTnTOZ7cQhs25lPc7J\n3mfU19e9nPAV/faBnF/VYjTkTphKRc7LTfiEPywpNcmERJ7iP2WXsB5JGOmivGFY\n25/xZpP57HFClwI5/lVzZa9H1iQ4bPYFuFSGeFN07sjKGvutUEY=\n=hix1\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cf793846978a8783c23b66ba6b4f3f30e83ff3eb",
          "sha": "cf793846978a8783c23b66ba6b4f3f30e83ff3eb",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/cf793846978a8783c23b66ba6b4f3f30e83ff3eb"
        }
      ],
      "message": "test: bugfix, coinselector_test, use 'CoinsResult::Erase/Add' instead of direct member access\n\nAside from the cleanup, this solves a bug in the following-up commit. Because, in these\ntests, we are manually adding/erasing outputs from the CoinsResult object but never\nupdating the internal total amount field.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2022-12-02T15:39:15Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2022-11-22T14:43:44Z"
      },
      "sha": "cac2725fd0f5baeb741dfe079a87332784c2adc7"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGM0ZTNiN2Q2YTE1NGU4MmNkYjkwMmZkN2JjYjdiNzI1YWViZGU1ZWE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c4e3b7d6a154e82cdb902fd7bcb7b725aebde5ea",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/c4e3b7d6a154e82cdb902fd7bcb7b725aebde5ea",
      "tree": {
        "sha": "e675087c7edfe2b57d071702e51b66cd0bfd6770",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e675087c7edfe2b57d071702e51b66cd0bfd6770"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree e675087c7edfe2b57d071702e51b66cd0bfd6770\nparent cac2725fd0f5baeb741dfe079a87332784c2adc7\nauthor furszy <matiasfurszyfer@protonmail.com> 1669128693 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1669995555 -0300\n\nwallet: SelectCoins, return early if wallet's UTXOs cannot cover the target\n\nThe CoinsResult class will now count the raw total amount and the effective\ntotal amount internally (inside the 'CoinsResult::Add' and 'CoinsResult::Erase'\nmethods).\nSo there is no discrepancy between what we add/erase and the total values.\n(which is what was happening on the coinselector_test because the 'CoinsResult'\nobject is manually created there, and we were not keeping the total amount\nin sync with the outputs being added/removed).\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmOKHCMACgkQXdI8zGhq\npiOF8w//VwOKnni98dvKRI5jxADKln1PErZK7OzASQoRopq5RZgO4dTjgvg8E6SE\ndoBXs2N+GGwaIK7E4kNOmX/t5BImSSztvy1vWVyTABC3zXHkN8W7hdt7qBZ4Fesc\nb3IF+5DC2U3IqB+Mf2XDjMuSXZPv+5AdFahkB13oKO+azvsRNfyG3hkkYpTj3mYy\nqkYBVQBn6GgH4PFH0AZda+Kkarlczw1jv//6kBinSivZFuWdXbbaRVjIRDImwauZ\nZ/6n3x+fV12ZWRzRBWBHxkSluOlMTX3VqDWeA6Ym4Y5MrGsFq0A/lp7rwOCZHs7c\ndO+xw82/HcaUlzFq1giMCub66MaFS/OZrGgfA5Tv+9Reb8/h60iPxf2OiX8ITcCV\n6bfXS1NNz+ceLGN9nW8zy4kDKZl+tNJV1WZCxES+y26LZgdCsIwjx24GVFqUtHF5\nYF1WZsXihP75WcfchA047Aqn+21ZVIGhRHqfg7bPF6PfmBxLxcW9a453PnluISOp\nmwWwFHtDlZyujVGyXvjRfEHDEeO54akg/B7nJC2tggNVGlnp+VC5cM9hl7zjw4lq\nNpEZ4DiNk4hOUNzxw2VaOVd40cLHeYIZQmvxls5DZroq1SKwERh+O6f8KhNJtRIo\nKO0h+paQY7WJhDadSSHxrGpWrzhIiuVx8vmUX6V/W2Na2Qf6Cdw=\n=JguS\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cac2725fd0f5baeb741dfe079a87332784c2adc7",
          "sha": "cac2725fd0f5baeb741dfe079a87332784c2adc7",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/cac2725fd0f5baeb741dfe079a87332784c2adc7"
        }
      ],
      "message": "wallet: SelectCoins, return early if wallet's UTXOs cannot cover the target\n\nThe CoinsResult class will now count the raw total amount and the effective\ntotal amount internally (inside the 'CoinsResult::Add' and 'CoinsResult::Erase'\nmethods).\nSo there is no discrepancy between what we add/erase and the total values.\n(which is what was happening on the coinselector_test because the 'CoinsResult'\nobject is manually created there, and we were not keeping the total amount\nin sync with the outputs being added/removed).",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2022-12-02T15:39:15Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2022-11-22T14:51:33Z"
      },
      "sha": "c4e3b7d6a154e82cdb902fd7bcb7b725aebde5ea"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDMyODJmYWQ1OTkwOGRhMzI4ZjgzMjNlMTIxMzM0NGZlNThjY2Y2OWU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3282fad59908da328f8323e1213344fe58ccf69e",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/3282fad59908da328f8323e1213344fe58ccf69e",
      "tree": {
        "sha": "1b4617d78a0fb72b0727e8b4c733540d7e1a0323",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1b4617d78a0fb72b0727e8b4c733540d7e1a0323"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 1b4617d78a0fb72b0727e8b4c733540d7e1a0323\nparent c4e3b7d6a154e82cdb902fd7bcb7b725aebde5ea\nauthor S3RK <1466284+s3rk@users.noreply.github.com> 1669761640 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1669995555 -0300\n\nwallet: add assert to SelectionResult::Merge for safety\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmOKHCMACgkQXdI8zGhq\npiOP0Q/+I3yGpNxAJinuNuI45p68SMT7fP8d6FUTDGPLWQXV/6HG/cqie99eVw0B\nZp78dUw62I0/JTYIx3MTFED8AWwr99JymHQhzIgxZQhluz/qJBEGAhvRIMSMmnoS\nYbUjBKXI9XS11jiWSogen+MdXSIDLPevk7IA/bkWXahYLhIRSRTW0KjDxp5qyfmm\nw/8J16MOnGaNY49AfhdItZd5eMK5LpdD/sxJuOcw/o0FqIyvomb0gll5E084Xxjd\nWKvj3llrzsRXfagWwCaYaspbyOkFZq4pRNbLt0tsCf8fXHcas3SRXvG8Px8MsWZE\nxyQzVCJUQNPWo8igJgq8uVut6tdvOgZzF4WG3FKY1+M46MdNVPYQ1fPlXZgS3s75\nNIHzuXb3mfOXOEmzLGyng2CunKtM4+EbPXo5PDZ5jeUI//nkJp5iByeJxSWgB2gj\n6WJ+huETMOxhMZ3iZzvf7WdBVx1eyiuZWksR1TbcHrjRjahBjDvD9YtpPJgtC2tm\nOVjJv2yX+XuHMi6qLd1VD6Y7DriR8QTM9x5Ot7USbJnXfL+M6E9lYYbjGDTkjhEp\nDKERyValgBab/0CeilocxRmObVUdO/PXS11q4hDjUJxfOfcpnXmIhCsh3/tMRgCN\nqZU73lSIoT3a1j6/atUnadA6QpDya+qQJ6ZGfALkGv4F5XITb/Y=\n=KHeO\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c4e3b7d6a154e82cdb902fd7bcb7b725aebde5ea",
          "sha": "c4e3b7d6a154e82cdb902fd7bcb7b725aebde5ea",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/c4e3b7d6a154e82cdb902fd7bcb7b725aebde5ea"
        }
      ],
      "message": "wallet: add assert to SelectionResult::Merge for safety",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2022-12-02T15:39:15Z"
      },
      "author": {
        "name": "S3RK",
        "email": "1466284+s3rk@users.noreply.github.com",
        "date": "2022-11-29T22:40:40Z"
      },
      "sha": "3282fad59908da328f8323e1213344fe58ccf69e"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDczNjJmOGU1ZTI0OTdiYzFlZjI3YmZhODcxZmM2ZGQzMDZkZDMzYzM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "tree": {
        "sha": "cb2b8df5cc02af838217135df819f8ceb900f2fc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/cb2b8df5cc02af838217135df819f8ceb900f2fc"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree cb2b8df5cc02af838217135df819f8ceb900f2fc\nparent 3282fad59908da328f8323e1213344fe58ccf69e\nauthor furszy <matiasfurszyfer@protonmail.com> 1669995202 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1669995556 -0300\n\nrefactor: make CoinsResult total amounts members private\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmOKHCQACgkQXdI8zGhq\npiMJCxAAv1xCJx3sghn4A3oWZu0jveR/7GxBIpEWfto0WwOsPDM5+conHsKHPu0G\nMN7kfHO2wHpXG4QI6pvVXEessF6CxkyjYIs0ms+awMZOR+xVWl4rYzJRKeF/Me9U\nugrAuFcwW/ZBNFZehhjqNELIVmZ2cSmp6XD4f9/gkis/r8RyIuDLxu5jI82GUx3b\ndG3PIwHLocW9McqW8AZhTopPopghT8SjrS+yHHSYHTtpRqcoQJ+bwuhbr7cqOdZ5\noiiYfyBtWCnPNk8PGy1nYEpiv2BhGYqs9HPGy7r7QhL6h2iLbL7VNJ/yEf9jdKWC\ncOfkiWhZwHSG2R+Oq9XhtVfv9QfCbMNbVFdjhunmHKxgma88KGrSEvgp1ZiApmIu\n5M01Yfntxfc5c7ZDMQxU9oOJb1CH3lNwjGRuCOonPU0qsxL1brHb/ElWp7NVz9CL\nItDrLAg739/pox2OpzxbqgZrT3m0rjgVzWTa1ZWCzDpZAGkHL4Wq0iApGkjVlI9l\n43lPy3U0KGUeyCA/L3qwlzGRaTY6V9w8NNu9CkiYDWdZ7BQOeLDk9knyrj08ia+O\nMhN8zToIDCD63bbrH8HS85Flbchgm/psaOjk25LEAk1nqjFiOTPb3X81D8r+Xprj\nJqH74eG5el3ukF1CHUnKhunJRHdv34MUrE+fGbgf09BbnWpveLE=\n=/PcH\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3282fad59908da328f8323e1213344fe58ccf69e",
          "sha": "3282fad59908da328f8323e1213344fe58ccf69e",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/3282fad59908da328f8323e1213344fe58ccf69e"
        }
      ],
      "message": "refactor: make CoinsResult total amounts members private",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2022-12-02T15:39:16Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2022-12-02T15:33:22Z"
      },
      "sha": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7942083330,
      "node_id": "HRFPE_lADOABII585XI28czwAAAAHZYpMC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7942083330",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-12-02T16:23:19Z"
    },
    {
      "event": "reviewed",
      "id": 1204227563,
      "node_id": "PRR_kwDOABII585Hxw3r",
      "url": null,
      "actor": null,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK cf793846978a8783c23b66ba6b4f3f30e83ff3eb (I assume these 3 are the backport commits) Verified that the tests in cf793846978a8783c23b66ba6b4f3f30e83ff3eb pass with the fix, fail on 24.x without the fix. I now think the documentation is accurate and would be helpful in a situation in which the test has broken again - thanks for taking the feedback!\r\n\r\nACK 7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3, I assume there will be a followup PR to add coin selection sanity checks and we can discuss the best way to do that there.",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#pullrequestreview-1204227563",
      "submitted_at": "2022-12-05T11:10:24Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
    },
    {
      "event": "review_requested",
      "id": 7953743332,
      "node_id": "RRE_lADOABII585XI28czwAAAAHaFH3k",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7953743332",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-12-05T11:12:05Z",
      "requested_reviewer": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "review_requested",
      "id": 7953744089,
      "node_id": "RRE_lADOABII585XI28czwAAAAHaFIDZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7953744089",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-12-05T11:12:10Z",
      "requested_reviewer": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "commented",
      "id": 1337720637,
      "node_id": "IC_kwDOABII585Pu_89",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1337720637",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-12-05T16:50:37Z",
      "updated_at": "2022-12-05T16:50:37Z",
      "author_association": "MEMBER",
      "body": "ACK 7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#issuecomment-1337720637",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26560"
    },
    {
      "event": "reviewed",
      "id": 1204899567,
      "node_id": "PRR_kwDOABII585H0U7v",
      "url": null,
      "actor": null,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK [7362f8e](https://github.com/bitcoin/bitcoin/pull/26560/commits/7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3)\r\n\r\nGive the discussion, I think it's best if we drop https://github.com/bitcoin/bitcoin/pull/26560/commits/3282fad59908da328f8323e1213344fe58ccf69e and address it in a follow-up, but not worth holding the PR up if the author feels differently.\r\n\r\nA big thanks to furszy for incorporating all of the feedback regarding the tests and documentation: everything is very clear now as to what's being tested and why",
      "user": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#pullrequestreview-1204899567",
      "submitted_at": "2022-12-05T16:53:16Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
    },
    {
      "event": "merged",
      "id": 7957050942,
      "node_id": "ME_lADOABII585XI28czwAAAAHaRvY-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7957050942",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "f0c4807a6a9b7391dcbadc4c7abcd0b5b95caf86",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f0c4807a6a9b7391dcbadc4c7abcd0b5b95caf86",
      "created_at": "2022-12-05T17:01:36Z"
    },
    {
      "event": "closed",
      "id": 7957050980,
      "node_id": "CE_lADOABII585XI28czwAAAAHaRvZk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7957050980",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-12-05T17:01:36Z"
    },
    {
      "event": "referenced",
      "id": 7957391752,
      "node_id": "REFE_lADOABII585XI28czwAAAAHaTCmI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7957391752",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "8dde7021c52f0603912b89b581b99d7e9944019e",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/8dde7021c52f0603912b89b581b99d7e9944019e",
      "created_at": "2022-12-05T17:39:39Z"
    },
    {
      "event": "referenced",
      "id": 7957442365,
      "node_id": "REFE_lADOABII585XI28czwAAAAHaTO89",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7957442365",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "195f0dfd0ec7fadfbbb3d86decb3f6d96beae159",
      "commit_url": "https://api.github.com/repos/fanquake/bitcoin/commits/195f0dfd0ec7fadfbbb3d86decb3f6d96beae159",
      "created_at": "2022-12-05T17:46:31Z"
    },
    {
      "event": "referenced",
      "id": 7957442376,
      "node_id": "REFE_lADOABII585XI28czwAAAAHaTO9I",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7957442376",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "9d73176d00a013e1383ae18cb5c0f8cbdd186cba",
      "commit_url": "https://api.github.com/repos/fanquake/bitcoin/commits/9d73176d00a013e1383ae18cb5c0f8cbdd186cba",
      "created_at": "2022-12-05T17:46:31Z"
    },
    {
      "event": "referenced",
      "id": 7957442382,
      "node_id": "REFE_lADOABII585XI28czwAAAAHaTO9O",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7957442382",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "8b726bf556e05edf02946d4b1c3356df17fd0d57",
      "commit_url": "https://api.github.com/repos/fanquake/bitcoin/commits/8b726bf556e05edf02946d4b1c3356df17fd0d57",
      "created_at": "2022-12-05T17:46:31Z"
    },
    {
      "event": "commented",
      "id": 1337893928,
      "node_id": "IC_kwDOABII585PvqQo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1337893928",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-12-05T18:17:24Z",
      "updated_at": "2022-12-05T18:17:24Z",
      "author_association": "MEMBER",
      "body": "Backported the 3 commits in #26616.",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#issuecomment-1337893928",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26560"
    },
    {
      "event": "referenced",
      "id": 7965575854,
      "node_id": "REFE_lADOABII585XI28czwAAAAHayQqu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7965575854",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "3afbc7d67d8e6225db73cbd298bcf738df11f03a",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3afbc7d67d8e6225db73cbd298bcf738df11f03a",
      "created_at": "2022-12-06T11:36:10Z"
    },
    {
      "event": "referenced",
      "id": 8146861629,
      "node_id": "REFE_lADOABII585XI28czwAAAAHllz49",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8146861629",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "3f8591d46b46cec2c4effc01f8822222087d74c4",
      "commit_url": "https://api.github.com/repos/bitcoin-core/gui/commits/3f8591d46b46cec2c4effc01f8822222087d74c4",
      "created_at": "2023-01-03T23:53:49Z"
    },
    {
      "event": "referenced",
      "id": 8152729036,
      "node_id": "REFE_lADOABII585XI28czwAAAAHl8MXM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8152729036",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "cab438784eadd1e80e44981c8ed23d54cb5e3c40",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/cab438784eadd1e80e44981c8ed23d54cb5e3c40",
      "created_at": "2023-01-04T16:27:32Z"
    },
    {
      "event": "reviewed",
      "id": 1359834973,
      "node_id": "PRR_kwDOABII585RDW9d",
      "url": null,
      "actor": null,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "body": "Gj",
      "user": {
        "login": "484812",
        "id": 89008005,
        "node_id": "MDQ6VXNlcjg5MDA4MDA1",
        "avatar_url": "https://avatars.githubusercontent.com/u/89008005?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/484812",
        "html_url": "https://github.com/484812",
        "followers_url": "https://api.github.com/users/484812/followers",
        "following_url": "https://api.github.com/users/484812/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/484812/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/484812/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/484812/subscriptions",
        "organizations_url": "https://api.github.com/users/484812/orgs",
        "repos_url": "https://api.github.com/users/484812/repos",
        "events_url": "https://api.github.com/users/484812/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/484812/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#pullrequestreview-1359834973",
      "submitted_at": "2023-03-27T20:37:08Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
    },
    {
      "event": "head_ref_deleted",
      "id": 9355562007,
      "node_id": "HRDE_lADOABII585XI28czwAAAAItoowX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9355562007",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-27T01:47:07Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1030669464",
      "pull_request_review_id": 1191984507,
      "id": 1030669464,
      "node_id": "PRRC_kwDOABII5849bsSY",
      "diff_hunk": "@@ -102,15 +102,19 @@ void CoinsResult::Clear() {\n     coins.clear();\n }\n \n-void CoinsResult::Erase(std::set<COutPoint>& preset_coins)\n+void CoinsResult::Erase(const std::set<COutPoint>& outs)\n {\n-    for (auto& it : coins) {\n-        auto& vec = it.second;\n-        auto i = std::find_if(vec.begin(), vec.end(), [&](const COutput &c) { return preset_coins.count(c.outpoint);});\n-        if (i != vec.end()) {\n-            vec.erase(i);\n-            break;\n-        }\n+    std::set<COutPoint> coins_to_remove = outs;\n+    for (auto& [type, vec] : coins) {\n+        auto remove_it = std::remove_if(vec.begin(), vec.end(), [&](const COutput& coin) {\n+            auto it = coins_to_remove.find(coin.outpoint);\n+            if (it == coins_to_remove.end()) return false;\n+\n+            // remove coin\n+            coins_to_remove.erase(it);",
      "path": "src/wallet/spend.cpp",
      "position": null,
      "original_position": 21,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "7f6abb39159cd55b6c9193630ca4c3d9ae551be6",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In 7f6abb39159cd55b6c9193630ca4c3d9ae551be6 \"wallet: bugfix, 'CoinsResult::Erase' is erasing only one output of the set\"\r\n\r\nHow come we need to have `coins_to_remove` and erase the removed coins from it? `coins_to_remove` isn't being used anywhere else so this doesn't seem to be doing anything?",
      "created_at": "2022-11-23T16:39:27Z",
      "updated_at": "2022-11-23T16:39:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1030669464",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1030669464"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 114,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1030884532",
      "pull_request_review_id": 1192284295,
      "id": 1030884532,
      "node_id": "PRRC_kwDOABII5849cgy0",
      "diff_hunk": "@@ -102,15 +102,19 @@ void CoinsResult::Clear() {\n     coins.clear();\n }\n \n-void CoinsResult::Erase(std::set<COutPoint>& preset_coins)\n+void CoinsResult::Erase(const std::set<COutPoint>& outs)\n {\n-    for (auto& it : coins) {\n-        auto& vec = it.second;\n-        auto i = std::find_if(vec.begin(), vec.end(), [&](const COutput &c) { return preset_coins.count(c.outpoint);});\n-        if (i != vec.end()) {\n-            vec.erase(i);\n-            break;\n-        }\n+    std::set<COutPoint> coins_to_remove = outs;\n+    for (auto& [type, vec] : coins) {\n+        auto remove_it = std::remove_if(vec.begin(), vec.end(), [&](const COutput& coin) {\n+            auto it = coins_to_remove.find(coin.outpoint);\n+            if (it == coins_to_remove.end()) return false;\n+\n+            // remove coin\n+            coins_to_remove.erase(it);",
      "path": "src/wallet/spend.cpp",
      "position": null,
      "original_position": 21,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "7f6abb39159cd55b6c9193630ca4c3d9ae551be6",
      "in_reply_to_id": 1030669464,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It's to decrease the search time while moving across the `CoinsResult` vectors.\r\n\r\n`Erase` receives a const set with all the coins that needs to be removed from the `CoinsResult` internal vectors. So, what we do is loop across each coins vector and, for each coin inside them, **we test whether the coin is inside the set of coins provided by the caller**, if it's there, then we update the internal state and return true so `std:.remove_if` does its magic.\r\n(bolded the important part)\r\n\r\nSo, if we remove coins as we find them on the `CoinsResult` vectors from the to_remove set, we will continually search inside a container with less elements up until there is none and we can stop the search earlier.",
      "created_at": "2022-11-23T21:30:33Z",
      "updated_at": "2022-11-23T21:30:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1030884532",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1030884532"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 114,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1030894873",
      "pull_request_review_id": 1192298629,
      "id": 1030894873,
      "node_id": "PRRC_kwDOABII5849cjUZ",
      "diff_hunk": "@@ -102,15 +102,19 @@ void CoinsResult::Clear() {\n     coins.clear();\n }\n \n-void CoinsResult::Erase(std::set<COutPoint>& preset_coins)\n+void CoinsResult::Erase(const std::set<COutPoint>& outs)\n {\n-    for (auto& it : coins) {\n-        auto& vec = it.second;\n-        auto i = std::find_if(vec.begin(), vec.end(), [&](const COutput &c) { return preset_coins.count(c.outpoint);});\n-        if (i != vec.end()) {\n-            vec.erase(i);\n-            break;\n-        }\n+    std::set<COutPoint> coins_to_remove = outs;\n+    for (auto& [type, vec] : coins) {\n+        auto remove_it = std::remove_if(vec.begin(), vec.end(), [&](const COutput& coin) {\n+            auto it = coins_to_remove.find(coin.outpoint);\n+            if (it == coins_to_remove.end()) return false;\n+\n+            // remove coin\n+            coins_to_remove.erase(it);",
      "path": "src/wallet/spend.cpp",
      "position": null,
      "original_position": 21,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "7f6abb39159cd55b6c9193630ca4c3d9ae551be6",
      "in_reply_to_id": 1030669464,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't think that's really a useful optimization since `outs` is likely to be very small. If we are concerned about the complexity of `find`, then I think it would be better to use an `unordered_set` rather than erasing after each removal.\r\n\r\nThis isn't really a blocking comment, I just found it a bit confusing.",
      "created_at": "2022-11-23T21:50:56Z",
      "updated_at": "2022-11-23T21:50:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1030894873",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1030894873"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 114,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1030960317",
      "pull_request_review_id": 1192391348,
      "id": 1030960317,
      "node_id": "PRRC_kwDOABII5849czS9",
      "diff_hunk": "@@ -102,15 +102,19 @@ void CoinsResult::Clear() {\n     coins.clear();\n }\n \n-void CoinsResult::Erase(std::set<COutPoint>& preset_coins)\n+void CoinsResult::Erase(const std::set<COutPoint>& outs)\n {\n-    for (auto& it : coins) {\n-        auto& vec = it.second;\n-        auto i = std::find_if(vec.begin(), vec.end(), [&](const COutput &c) { return preset_coins.count(c.outpoint);});\n-        if (i != vec.end()) {\n-            vec.erase(i);\n-            break;\n-        }\n+    std::set<COutPoint> coins_to_remove = outs;\n+    for (auto& [type, vec] : coins) {\n+        auto remove_it = std::remove_if(vec.begin(), vec.end(), [&](const COutput& coin) {\n+            auto it = coins_to_remove.find(coin.outpoint);\n+            if (it == coins_to_remove.end()) return false;\n+\n+            // remove coin\n+            coins_to_remove.erase(it);",
      "path": "src/wallet/spend.cpp",
      "position": null,
      "original_position": 21,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "7f6abb39159cd55b6c9193630ca4c3d9ae551be6",
      "in_reply_to_id": 1030669464,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "yeah, an `unordered_set` sounds good too.\r\n\r\nstill, what I wanted to add (and I actually didn't add it for some reason..) is the capability to stop early if the set has no elements. E.g. if the wallet has 100k UTXO inside, the preset inputs set is small, and the coins appear early in the loop: the process could stop right away (no need to keep traversing the entire available coins vector if we already found them).\r\n\r\nbut.. as this is primarily to solve the dangerous bug in v24. Could go ahead with the `unordered_set`, make the code simpler, and leave any optimization for later.",
      "created_at": "2022-11-24T00:27:15Z",
      "updated_at": "2022-11-24T00:33:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1030960317",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1030960317"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 114,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032802753",
      "pull_request_review_id": 1194885937,
      "id": 1032802753,
      "node_id": "PRRC_kwDOABII5849j1HB",
      "diff_hunk": "@@ -1200,6 +1201,63 @@ def test_add_inputs_default_value(self):\n \n         self.nodes[2].unloadwallet(\"test_preset_inputs\")\n \n+    def test_preset_inputs_selection_crash(self):\n+        self.log.info('Test wallet preset inputs selection')\n+\n+        # Here will confuse the wallet to make it select the\n+        # preset inputs twice during the coin selection process (on v24.0).\n+        #\n+        # Making it think that the selection process result covers\n+        # the entire tx target when it does not. It's actually creating\n+        # a tx that sends more coins than what inputs are covering for.\n+        #\n+        # Which, combined with the subtract fee from outputs option,\n+        # makes the wallet generate and broadcast a tx that pays\n+        # up to the sum of all the preset inputs, minus one, amounts in fee!\n+\n+        # Create and fund the wallet with 10 UTXO of 5 BTC each\n+        self.nodes[2].createwallet(\"test_preset_inputs_selection\")\n+        wallet = self.nodes[2].get_wallet_rpc(\"test_preset_inputs_selection\")\n+        outputs = {}\n+        for _ in range(10):\n+            outputs[wallet.getnewaddress(address_type=\"bech32\")] = 5\n+        self.nodes[0].sendmany(\"\", outputs)\n+        self.generate(self.nodes[0], 1)\n+\n+        # Select the preset inputs and lock the rest of the coins",
      "path": "test/functional/rpc_fundrawtransaction.py",
      "position": null,
      "original_position": 35,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "in_reply_to_id": null,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Is locking here necessary? Can we just fund the wallets with 2 coins instead of 10?",
      "created_at": "2022-11-26T15:45:22Z",
      "updated_at": "2022-11-26T17:33:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1032802753",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032802753"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1227,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032807770",
      "pull_request_review_id": 1194885937,
      "id": 1032807770,
      "node_id": "PRRC_kwDOABII5849j2Va",
      "diff_hunk": "@@ -112,5 +112,38 @@ BOOST_FIXTURE_TEST_CASE(FillInputToWeightTest, BasicTestingSetup)\n     // Note: We don't test the next boundary because of memory allocation constraints.\n }\n \n+BOOST_FIXTURE_TEST_CASE(wallet_duplicated_preset_inputs_test, TestChain100Setup)\n+{\n+    // Verifies that the wallet's Coin Selection process does not include pre-selected inputs twice in a transaction.\n+    for (int i = 0; i < 10; i++) CreateAndProcessBlock({}, GetScriptForRawPubKey(coinbaseKey.GetPubKey()));\n+    auto wallet = CreateSyncedWallet(*m_node.chain, WITH_LOCK(Assert(m_node.chainman)->GetMutex(), return m_node.chainman->ActiveChain()), m_args, coinbaseKey);\n+\n+    LOCK(wallet->cs_wallet);\n+    auto available_coins = AvailableCoins(*wallet);\n+    std::vector<COutput> coins = available_coins.All();\n+    std::set<COutPoint> preset_inputs = {coins[0].outpoint, coins[1].outpoint};\n+    // Lock the rest of the coins",
      "path": "src/wallet/test/spend_tests.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "d8e195bc3d1ec46b874e70374b0d68698d442683",
      "in_reply_to_id": null,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Same question here. Do we really need to lock the coins? ",
      "created_at": "2022-11-26T16:33:35Z",
      "updated_at": "2022-11-26T17:33:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1032807770",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032807770"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 125,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032808028",
      "pull_request_review_id": 1194885937,
      "id": 1032808028,
      "node_id": "PRRC_kwDOABII5849j2Zc",
      "diff_hunk": "@@ -112,5 +112,38 @@ BOOST_FIXTURE_TEST_CASE(FillInputToWeightTest, BasicTestingSetup)\n     // Note: We don't test the next boundary because of memory allocation constraints.\n }\n \n+BOOST_FIXTURE_TEST_CASE(wallet_duplicated_preset_inputs_test, TestChain100Setup)",
      "path": "src/wallet/test/spend_tests.cpp",
      "position": 4,
      "original_position": 4,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "d8e195bc3d1ec46b874e70374b0d68698d442683",
      "in_reply_to_id": null,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: I'm not sure having second test provides enough extra value. I'd rather keep one, but ultimately up to you.",
      "created_at": "2022-11-26T16:36:00Z",
      "updated_at": "2022-11-26T17:33:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1032808028",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032808028"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 115,
      "original_line": 115,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032811592",
      "pull_request_review_id": 1194885937,
      "id": 1032811592,
      "node_id": "PRRC_kwDOABII5849j3RI",
      "diff_hunk": "@@ -575,6 +584,14 @@ std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& a\n         return result;\n     }\n \n+    // Return early if we cannot cover the target with the wallet's UTXO.\n+    // We use the total effective value if we are not subtracting fee from outputs and 'available_coins' contains the data.\n+    CAmount available_coins_total_amount = coin_selection_params.m_subtract_fee_outputs ? available_coins.total_amount :\n+            (available_coins.total_effective_amount.has_value() ? *available_coins.total_effective_amount : available_coins.total_amount);",
      "path": "src/wallet/spend.cpp",
      "position": null,
      "original_position": 43,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "in_reply_to_id": null,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't think it's correct to fallback on `available_coins.total_amount` when we don't do SFFO.\r\n\r\nwith SFFO we must have effective amount, if we don't - something went wrong.",
      "created_at": "2022-11-26T17:09:24Z",
      "updated_at": "2022-11-26T17:33:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1032811592",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032811592"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 590,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032813025",
      "pull_request_review_id": 1194885937,
      "id": 1032813025,
      "node_id": "PRRC_kwDOABII5849j3nh",
      "diff_hunk": "@@ -51,8 +51,10 @@ struct CoinsResult {\n     void Shuffle(FastRandomContext& rng_fast);\n     void Add(OutputType type, const COutput& out);\n \n-    /** Sum of all available coins */\n+    /** Sum of all available coins raw value */\n     CAmount total_amount{0};\n+    /** Sum of all available coins effective value (each output value minus fees required to spend it) */\n+    std::optional<CAmount> total_effective_amount{0};",
      "path": "src/wallet/spend.h",
      "position": 17,
      "original_position": 8,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "in_reply_to_id": null,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "note to self: not a huge fan of how this looks like with `optional`. The code would look much simpler if we can just always pass a fee rate to `AvailableCoins` (we can set it 0 by default). Can't make my mind which way is better...",
      "created_at": "2022-11-26T17:24:38Z",
      "updated_at": "2022-11-26T17:33:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1032813025",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032813025"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 61,
      "original_line": 61,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033634941",
      "pull_request_review_id": 1195944592,
      "id": 1033634941,
      "node_id": "PRRC_kwDOABII5849nAR9",
      "diff_hunk": "@@ -1200,6 +1201,63 @@ def test_add_inputs_default_value(self):\n \n         self.nodes[2].unloadwallet(\"test_preset_inputs\")\n \n+    def test_preset_inputs_selection_crash(self):\n+        self.log.info('Test wallet preset inputs selection')\n+\n+        # Here will confuse the wallet to make it select the\n+        # preset inputs twice during the coin selection process (on v24.0).\n+        #\n+        # Making it think that the selection process result covers\n+        # the entire tx target when it does not. It's actually creating\n+        # a tx that sends more coins than what inputs are covering for.\n+        #\n+        # Which, combined with the subtract fee from outputs option,\n+        # makes the wallet generate and broadcast a tx that pays\n+        # up to the sum of all the preset inputs, minus one, amounts in fee!\n+\n+        # Create and fund the wallet with 10 UTXO of 5 BTC each\n+        self.nodes[2].createwallet(\"test_preset_inputs_selection\")\n+        wallet = self.nodes[2].get_wallet_rpc(\"test_preset_inputs_selection\")\n+        outputs = {}\n+        for _ in range(10):\n+            outputs[wallet.getnewaddress(address_type=\"bech32\")] = 5\n+        self.nodes[0].sendmany(\"\", outputs)\n+        self.generate(self.nodes[0], 1)\n+\n+        # Select the preset inputs and lock the rest of the coins",
      "path": "test/functional/rpc_fundrawtransaction.py",
      "position": null,
      "original_position": 35,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "in_reply_to_id": 1032802753,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "let me double check it, IIRC I added it to make the wallet have enough funds in case we have an early balance check in the flow.",
      "created_at": "2022-11-28T14:46:30Z",
      "updated_at": "2022-11-28T14:46:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033634941",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033634941"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1227,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033644437",
      "pull_request_review_id": 1195958121,
      "id": 1033644437,
      "node_id": "PRRC_kwDOABII5849nCmV",
      "diff_hunk": "@@ -112,5 +112,38 @@ BOOST_FIXTURE_TEST_CASE(FillInputToWeightTest, BasicTestingSetup)\n     // Note: We don't test the next boundary because of memory allocation constraints.\n }\n \n+BOOST_FIXTURE_TEST_CASE(wallet_duplicated_preset_inputs_test, TestChain100Setup)",
      "path": "src/wallet/test/spend_tests.cpp",
      "position": 4,
      "original_position": 4,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "d8e195bc3d1ec46b874e70374b0d68698d442683",
      "in_reply_to_id": 1032808028,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "yeah. I almost remove it but.. ended up leaving because (1) the severity of the bug and (2) because it's easier to debug and assert that the code is failing where is supposed to be failing (in the functional test case, as we use the `send` RPC command, we do have other stuff involved).\r\n\r\nI'm fine either way, if this still doesn't convince you and more people don't see it useful, can remove it for sure.",
      "created_at": "2022-11-28T14:53:59Z",
      "updated_at": "2022-11-28T14:53:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033644437",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033644437"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 115,
      "original_line": 115,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033752353",
      "pull_request_review_id": 1196113714,
      "id": 1033752353,
      "node_id": "PRRC_kwDOABII5849nc8h",
      "diff_hunk": "@@ -575,6 +584,14 @@ std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& a\n         return result;\n     }\n \n+    // Return early if we cannot cover the target with the wallet's UTXO.\n+    // We use the total effective value if we are not subtracting fee from outputs and 'available_coins' contains the data.\n+    CAmount available_coins_total_amount = coin_selection_params.m_subtract_fee_outputs ? available_coins.total_amount :\n+            (available_coins.total_effective_amount.has_value() ? *available_coins.total_effective_amount : available_coins.total_amount);",
      "path": "src/wallet/spend.cpp",
      "position": null,
      "original_position": 43,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "in_reply_to_id": 1032811592,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Hmm, need a bit of context here.\r\nGuess that you are saying that because, with SFFO, the wallet needs to select a group of UTXOs that will be able to pay for themselves? So, the entire coin selection relies on the effective value existence so.. if it's not there there is a bug?",
      "created_at": "2022-11-28T16:18:46Z",
      "updated_at": "2022-11-28T16:18:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033752353",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033752353"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 590,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033815954",
      "pull_request_review_id": 1196209044,
      "id": 1033815954,
      "node_id": "PRRC_kwDOABII5849nseS",
      "diff_hunk": "@@ -575,6 +584,14 @@ std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& a\n         return result;\n     }\n \n+    // Return early if we cannot cover the target with the wallet's UTXO.\n+    // We use the total effective value if we are not subtracting fee from outputs and 'available_coins' contains the data.\n+    CAmount available_coins_total_amount = coin_selection_params.m_subtract_fee_outputs ? available_coins.total_amount :\n+            (available_coins.total_effective_amount.has_value() ? *available_coins.total_effective_amount : available_coins.total_amount);",
      "path": "src/wallet/spend.cpp",
      "position": null,
      "original_position": 43,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "in_reply_to_id": 1032811592,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "By the time we get here, if `total_effective_amount` doesn't have a value, that means that none of the UTXOs in this wallet were solvable, so we can't do any coin selection here in that case. So I think it would be better to always return early in that case.",
      "created_at": "2022-11-28T17:08:23Z",
      "updated_at": "2022-11-28T17:08:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033815954",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033815954"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 590,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033924509",
      "pull_request_review_id": 1196363778,
      "id": 1033924509,
      "node_id": "PRRC_kwDOABII5849oG-d",
      "diff_hunk": "@@ -575,6 +584,14 @@ std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& a\n         return result;\n     }\n \n+    // Return early if we cannot cover the target with the wallet's UTXO.\n+    // We use the total effective value if we are not subtracting fee from outputs and 'available_coins' contains the data.\n+    CAmount available_coins_total_amount = coin_selection_params.m_subtract_fee_outputs ? available_coins.total_amount :\n+            (available_coins.total_effective_amount.has_value() ? *available_coins.total_effective_amount : available_coins.total_amount);",
      "path": "src/wallet/spend.cpp",
      "position": null,
      "original_position": 43,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "in_reply_to_id": 1032811592,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> By the time we get here, if total_effective_amount doesn't have a value, that means that none of the UTXOs in this wallet were solvable, so we can't do any coin selection here in that case\r\n\r\nHmm, code wise, that doesn't seems to be what is happening.\r\n\r\nAt the `COutput` constructor, if the coin isn't solvable then `effective_value` will be equal to the nominal output value. So it will always have an effective value during the tx creation process.\r\n\r\nThe only way that a `COutput` has no `effective_value` is when we don't provide the feerate param to `AvailableCoins` (which happens on all the flows that uses `AvailableCoins` that are not part of the tx creation process).",
      "created_at": "2022-11-28T18:43:04Z",
      "updated_at": "2022-11-28T18:43:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033924509",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033924509"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 590,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033935017",
      "pull_request_review_id": 1196378617,
      "id": 1033935017,
      "node_id": "PRRC_kwDOABII5849oJip",
      "diff_hunk": "@@ -575,6 +584,14 @@ std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& a\n         return result;\n     }\n \n+    // Return early if we cannot cover the target with the wallet's UTXO.\n+    // We use the total effective value if we are not subtracting fee from outputs and 'available_coins' contains the data.\n+    CAmount available_coins_total_amount = coin_selection_params.m_subtract_fee_outputs ? available_coins.total_amount :\n+            (available_coins.total_effective_amount.has_value() ? *available_coins.total_effective_amount : available_coins.total_amount);",
      "path": "src/wallet/spend.cpp",
      "position": null,
      "original_position": 43,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "in_reply_to_id": 1032811592,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Oh, hmm, I thought it checked `input_bytes` as well.\r\n\r\nIn that case, `total_effective_amount` should always have a value if we have any coins. If it isn't set, then we don't have any coins and we can still return early.",
      "created_at": "2022-11-28T18:54:30Z",
      "updated_at": "2022-11-28T18:54:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033935017",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033935017"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 590,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033936642",
      "pull_request_review_id": 1196380793,
      "id": 1033936642,
      "node_id": "PRRC_kwDOABII5849oJ8C",
      "diff_hunk": "@@ -51,8 +51,10 @@ struct CoinsResult {\n     void Shuffle(FastRandomContext& rng_fast);\n     void Add(OutputType type, const COutput& out);\n \n-    /** Sum of all available coins */\n+    /** Sum of all available coins raw value */\n     CAmount total_amount{0};\n+    /** Sum of all available coins effective value (each output value minus fees required to spend it) */\n+    std::optional<CAmount> total_effective_amount{0};",
      "path": "src/wallet/spend.h",
      "position": 17,
      "original_position": 8,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "in_reply_to_id": 1032813025,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I would agree on always passing the fee rate to `AvailableCoins` if we were using the function only for the tx creation process, but we are using it for other processes that don't require to calculate the effective value nor the output spending fee.\r\n\r\nWe definitely can improve it but I don't think that this PR is the best place to do it.\r\n\r\nSide from that, from my side, have some plans to re-write the `AvailableCoins` functionality differently post #25806 (because, after it, will be able to continually connect outputs to existent output groups, outside of the coin selection process which is currently forcing us to do the whole calculation on-demand).",
      "created_at": "2022-11-28T18:56:14Z",
      "updated_at": "2022-11-29T23:07:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033936642",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033936642"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 61,
      "original_line": 61,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033971497",
      "pull_request_review_id": 1196436608,
      "id": 1033971497,
      "node_id": "PRRC_kwDOABII5849oScp",
      "diff_hunk": "@@ -1200,6 +1201,63 @@ def test_add_inputs_default_value(self):\n \n         self.nodes[2].unloadwallet(\"test_preset_inputs\")\n \n+    def test_preset_inputs_selection_crash(self):\n+        self.log.info('Test wallet preset inputs selection')\n+\n+        # Here will confuse the wallet to make it select the\n+        # preset inputs twice during the coin selection process (on v24.0).\n+        #\n+        # Making it think that the selection process result covers\n+        # the entire tx target when it does not. It's actually creating\n+        # a tx that sends more coins than what inputs are covering for.\n+        #\n+        # Which, combined with the subtract fee from outputs option,\n+        # makes the wallet generate and broadcast a tx that pays\n+        # up to the sum of all the preset inputs, minus one, amounts in fee!\n+\n+        # Create and fund the wallet with 10 UTXO of 5 BTC each\n+        self.nodes[2].createwallet(\"test_preset_inputs_selection\")\n+        wallet = self.nodes[2].get_wallet_rpc(\"test_preset_inputs_selection\")\n+        outputs = {}\n+        for _ in range(10):\n+            outputs[wallet.getnewaddress(address_type=\"bech32\")] = 5\n+        self.nodes[0].sendmany(\"\", outputs)\n+        self.generate(self.nodes[0], 1)\n+\n+        # Select the preset inputs and lock the rest of the coins",
      "path": "test/functional/rpc_fundrawtransaction.py",
      "position": null,
      "original_position": 35,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "f20f88f60e87867e755507dc6e59a5cd80e3c3a9",
      "in_reply_to_id": 1032802753,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "All good, just removed it. Seems that I was just over-thinking it.",
      "created_at": "2022-11-28T19:32:58Z",
      "updated_at": "2022-11-28T19:32:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033971497",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033971497"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1227,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033971966",
      "pull_request_review_id": 1196437167,
      "id": 1033971966,
      "node_id": "PRRC_kwDOABII5849oSj-",
      "diff_hunk": "@@ -112,5 +112,38 @@ BOOST_FIXTURE_TEST_CASE(FillInputToWeightTest, BasicTestingSetup)\n     // Note: We don't test the next boundary because of memory allocation constraints.\n }\n \n+BOOST_FIXTURE_TEST_CASE(wallet_duplicated_preset_inputs_test, TestChain100Setup)\n+{\n+    // Verifies that the wallet's Coin Selection process does not include pre-selected inputs twice in a transaction.\n+    for (int i = 0; i < 10; i++) CreateAndProcessBlock({}, GetScriptForRawPubKey(coinbaseKey.GetPubKey()));\n+    auto wallet = CreateSyncedWallet(*m_node.chain, WITH_LOCK(Assert(m_node.chainman)->GetMutex(), return m_node.chainman->ActiveChain()), m_args, coinbaseKey);\n+\n+    LOCK(wallet->cs_wallet);\n+    auto available_coins = AvailableCoins(*wallet);\n+    std::vector<COutput> coins = available_coins.All();\n+    std::set<COutPoint> preset_inputs = {coins[0].outpoint, coins[1].outpoint};\n+    // Lock the rest of the coins",
      "path": "src/wallet/test/spend_tests.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "d8e195bc3d1ec46b874e70374b0d68698d442683",
      "in_reply_to_id": 1032807770,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "not really, removed it. Thanks",
      "created_at": "2022-11-28T19:33:26Z",
      "updated_at": "2022-11-28T19:33:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1033971966",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1033971966"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 125,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034778211",
      "pull_request_review_id": 1197593313,
      "id": 1034778211,
      "node_id": "PRRC_kwDOABII5849rXZj",
      "diff_hunk": "@@ -102,15 +102,13 @@ void CoinsResult::Clear() {\n     coins.clear();\n }\n \n-void CoinsResult::Erase(std::set<COutPoint>& preset_coins)\n+void CoinsResult::Erase(const std::unordered_set<COutPoint, SaltedOutpointHasher>& coins_to_remove)\n {\n-    for (auto& it : coins) {\n-        auto& vec = it.second;\n-        auto i = std::find_if(vec.begin(), vec.end(), [&](const COutput &c) { return preset_coins.count(c.outpoint);});\n-        if (i != vec.end()) {\n-            vec.erase(i);\n-            break;\n-        }\n+    for (auto& [type, vec] : coins) {\n+        auto remove_it = std::remove_if(vec.begin(), vec.end(), [&](const COutput& coin) {\n+            return coins_to_remove.count(coin.outpoint) == 1;",
      "path": "src/wallet/spend.cpp",
      "position": null,
      "original_position": 16,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "65126cb522b28f53a020ce56826f7d15560241c9",
      "in_reply_to_id": null,
      "user": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "in https://github.com/bitcoin/bitcoin/pull/26560/commits/65126cb522b28f53a020ce56826f7d15560241c9:\r\n\r\nShouldn't this be a `std::find`? `count` will traverse the entire `coins_to_remove` vector whereas `std::find` will stop as soon as it finds the outpoint.\r\n",
      "created_at": "2022-11-29T13:50:32Z",
      "updated_at": "2022-11-29T14:23:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1034778211",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034778211"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 109,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034780473",
      "pull_request_review_id": 1197593313,
      "id": 1034780473,
      "node_id": "PRRC_kwDOABII5849rX85",
      "diff_hunk": "@@ -47,7 +47,7 @@ struct CoinsResult {\n      * i.e., methods can work with individual OutputType vectors or on the entire object */\n     size_t Size() const;\n     void Clear();\n-    void Erase(std::set<COutPoint>& preset_coins);\n+    void Erase(const std::unordered_set<COutPoint, SaltedOutpointHasher>& outs);",
      "path": "src/wallet/spend.h",
      "position": null,
      "original_position": 5,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "65126cb522b28f53a020ce56826f7d15560241c9",
      "in_reply_to_id": null,
      "user": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "in https://github.com/bitcoin/bitcoin/pull/26560/commits/65126cb522b28f53a020ce56826f7d15560241c9:\r\n\r\nnit, but can we keep the parameter names consistent? either use `outs` in both places or `coins_to_remove` in both places?",
      "created_at": "2022-11-29T13:52:28Z",
      "updated_at": "2022-11-29T14:23:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1034780473",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034780473"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 50,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034796746",
      "pull_request_review_id": 1197593313,
      "id": 1034796746,
      "node_id": "PRRC_kwDOABII5849rb7K",
      "diff_hunk": "@@ -112,5 +112,38 @@ BOOST_FIXTURE_TEST_CASE(FillInputToWeightTest, BasicTestingSetup)\n     // Note: We don't test the next boundary because of memory allocation constraints.\n }\n \n+BOOST_FIXTURE_TEST_CASE(wallet_duplicated_preset_inputs_test, TestChain100Setup)",
      "path": "src/wallet/test/spend_tests.cpp",
      "position": 4,
      "original_position": 4,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "d8e195bc3d1ec46b874e70374b0d68698d442683",
      "in_reply_to_id": 1032808028,
      "user": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I also agree that the second unit test (which isn't really a unit test) seems redundant and also a little confusing to me. I think the unit test for `CoinsResult::Erase` in an earlier commit is correct for a unit test and the functional test is better suited for testing the wallet behavior",
      "created_at": "2022-11-29T14:05:43Z",
      "updated_at": "2022-11-29T14:23:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1034796746",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034796746"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 115,
      "original_line": 115,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034800106",
      "pull_request_review_id": 1197593313,
      "id": 1034800106,
      "node_id": "PRRC_kwDOABII5849rcvq",
      "diff_hunk": "@@ -1200,6 +1201,59 @@ def test_add_inputs_default_value(self):\n \n         self.nodes[2].unloadwallet(\"test_preset_inputs\")\n \n+    def test_preset_inputs_selection_crash(self):\n+        self.log.info('Test wallet preset inputs selection')\n+\n+        # Here will confuse the wallet to make it select the\n+        # preset inputs twice during the coin selection process (on v24.0).\n+        #\n+        # Making it think that the selection process result covers\n+        # the entire tx target when it does not. It's actually creating\n+        # a tx that sends more coins than what inputs are covering for.\n+        #\n+        # Which, combined with the subtract fee from outputs option,\n+        # makes the wallet generate and broadcast a tx that pays\n+        # up to the sum of all the preset inputs, minus one, amounts in fee!\n+\n+        # Create and fund the wallet with 2 UTXO of 5 BTC each\n+        self.nodes[2].createwallet(\"test_preset_inputs_selection\")\n+        wallet = self.nodes[2].get_wallet_rpc(\"test_preset_inputs_selection\")\n+        outputs = {}\n+        for _ in range(2):\n+            outputs[wallet.getnewaddress(address_type=\"bech32\")] = 5\n+        self.nodes[0].sendmany(\"\", outputs)\n+        self.generate(self.nodes[0], 1)\n+\n+        # Select the preset inputs\n+        coins = wallet.listunspent()\n+        preset_inputs = [coins[0], coins[1]]\n+\n+        # Now let's create the tx\n+        options = {\n+            \"inputs\": [\n+                {\n+                    \"txid\": preset_inputs[0][\"txid\"],\n+                    \"vout\": preset_inputs[0][\"vout\"]\n+                },\n+                {\n+                    \"txid\": preset_inputs[1][\"txid\"],\n+                    \"vout\": preset_inputs[1][\"vout\"]\n+                },\n+            ],\n+            \"add_inputs\": True,\n+            \"subtract_fee_from_outputs\": [0],\n+            \"add_to_wallet\": False\n+        }\n+\n+        # First case, use 'subtract_fee_from_outputs' to make the wallet create a tx that pays an insane fee on v24.0.\n+        assert_raises_rpc_error(-4, \"Insufficient funds\", wallet.send, outputs=[{wallet.getnewaddress(address_type=\"bech32\"): 14}], options=options)\n+\n+        # Second case, don't use 'subtract_fee_from_outputs' to make the wallet crash due the insane fee on v24.0\n+        del options[\"subtract_fee_from_outputs\"]\n+        assert_raises_rpc_error(-4, \"Insufficient funds\", wallet.send, outputs=[{wallet.getnewaddress(address_type=\"bech32\"): 14}], options=options)",
      "path": "test/functional/rpc_fundrawtransaction.py",
      "position": null,
      "original_position": 61,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "a07c3b4cfdf864b419984103323d431cbe3cc870",
      "in_reply_to_id": null,
      "user": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "As it's written, the test comment doesn't make sense unless you have the background context. The comment describes a certain type of failure (insane fee, or wallet crash), but the assertion seems to check something entirely different. Perhaps it's worth writing a long comment which explains why you are checking for insufficient funds and what you would expect if the insufficient funds assert fails.",
      "created_at": "2022-11-29T14:08:35Z",
      "updated_at": "2022-11-29T14:23:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1034800106",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034800106"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": 1248,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1261,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034803002",
      "pull_request_review_id": 1197593313,
      "id": 1034803002,
      "node_id": "PRRC_kwDOABII5849rdc6",
      "diff_hunk": "@@ -106,7 +106,13 @@ void CoinsResult::Erase(const std::unordered_set<COutPoint, SaltedOutpointHasher\n {\n     for (auto& [type, vec] : coins) {\n         auto remove_it = std::remove_if(vec.begin(), vec.end(), [&](const COutput& coin) {\n-            return coins_to_remove.count(coin.outpoint) == 1;\n+            // remove it if it's on the set\n+            if (coins_to_remove.count(coin.outpoint) == 0) return false;",
      "path": "src/wallet/spend.cpp",
      "position": 17,
      "original_position": 6,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "1b14bd7ac77027351a1e5b3ef21fb2d1de659efd",
      "in_reply_to_id": null,
      "user": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "in https://github.com/bitcoin/bitcoin/pull/26560/commits/1b14bd7ac77027351a1e5b3ef21fb2d1de659efd:\r\n\r\nsame comment from before, I'd suggest using `find` here.",
      "created_at": "2022-11-29T14:10:54Z",
      "updated_at": "2022-11-29T14:23:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1034803002",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034803002"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 110,
      "original_line": 110,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034809655",
      "pull_request_review_id": 1197593313,
      "id": 1034809655,
      "node_id": "PRRC_kwDOABII5849rfE3",
      "diff_hunk": "@@ -106,7 +106,13 @@ void CoinsResult::Erase(const std::unordered_set<COutPoint, SaltedOutpointHasher\n {\n     for (auto& [type, vec] : coins) {\n         auto remove_it = std::remove_if(vec.begin(), vec.end(), [&](const COutput& coin) {\n-            return coins_to_remove.count(coin.outpoint) == 1;\n+            // remove it if it's on the set\n+            if (coins_to_remove.count(coin.outpoint) == 0) return false;",
      "path": "src/wallet/spend.cpp",
      "position": 17,
      "original_position": 6,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "1b14bd7ac77027351a1e5b3ef21fb2d1de659efd",
      "in_reply_to_id": 1034803002,
      "user": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "also, might be worth adding the `if () return false;` in the earlier commit so you don't end up touching this line twice? ",
      "created_at": "2022-11-29T14:16:13Z",
      "updated_at": "2022-11-29T14:23:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1034809655",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034809655"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 110,
      "original_line": 110,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034897955",
      "pull_request_review_id": 1197772333,
      "id": 1034897955,
      "node_id": "PRRC_kwDOABII5849r0oj",
      "diff_hunk": "@@ -102,15 +102,13 @@ void CoinsResult::Clear() {\n     coins.clear();\n }\n \n-void CoinsResult::Erase(std::set<COutPoint>& preset_coins)\n+void CoinsResult::Erase(const std::unordered_set<COutPoint, SaltedOutpointHasher>& coins_to_remove)\n {\n-    for (auto& it : coins) {\n-        auto& vec = it.second;\n-        auto i = std::find_if(vec.begin(), vec.end(), [&](const COutput &c) { return preset_coins.count(c.outpoint);});\n-        if (i != vec.end()) {\n-            vec.erase(i);\n-            break;\n-        }\n+    for (auto& [type, vec] : coins) {\n+        auto remove_it = std::remove_if(vec.begin(), vec.end(), [&](const COutput& coin) {\n+            return coins_to_remove.count(coin.outpoint) == 1;",
      "path": "src/wallet/spend.cpp",
      "position": null,
      "original_position": 16,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "65126cb522b28f53a020ce56826f7d15560241c9",
      "in_reply_to_id": 1034778211,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`coins_to_remove` is an unordered set, not a vector. Internally, uses a hash table where keys are hashed into indices. So, time complexity wise, `count` and `find` should take the same constant time.",
      "created_at": "2022-11-29T15:22:12Z",
      "updated_at": "2022-11-29T15:22:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1034897955",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034897955"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 109,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034898859",
      "pull_request_review_id": 1197773598,
      "id": 1034898859,
      "node_id": "PRRC_kwDOABII5849r02r",
      "diff_hunk": "@@ -47,7 +47,7 @@ struct CoinsResult {\n      * i.e., methods can work with individual OutputType vectors or on the entire object */\n     size_t Size() const;\n     void Clear();\n-    void Erase(std::set<COutPoint>& preset_coins);\n+    void Erase(const std::unordered_set<COutPoint, SaltedOutpointHasher>& outs);",
      "path": "src/wallet/spend.h",
      "position": null,
      "original_position": 5,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "65126cb522b28f53a020ce56826f7d15560241c9",
      "in_reply_to_id": 1034780473,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "yeah, thanks",
      "created_at": "2022-11-29T15:22:48Z",
      "updated_at": "2022-11-29T15:22:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1034898859",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034898859"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 50,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034903839",
      "pull_request_review_id": 1197780760,
      "id": 1034903839,
      "node_id": "PRRC_kwDOABII5849r2Ef",
      "diff_hunk": "@@ -106,7 +106,13 @@ void CoinsResult::Erase(const std::unordered_set<COutPoint, SaltedOutpointHasher\n {\n     for (auto& [type, vec] : coins) {\n         auto remove_it = std::remove_if(vec.begin(), vec.end(), [&](const COutput& coin) {\n-            return coins_to_remove.count(coin.outpoint) == 1;\n+            // remove it if it's on the set\n+            if (coins_to_remove.count(coin.outpoint) == 0) return false;",
      "path": "src/wallet/spend.cpp",
      "position": 17,
      "original_position": 6,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "1b14bd7ac77027351a1e5b3ef21fb2d1de659efd",
      "in_reply_to_id": 1034803002,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> in [1b14bd7](https://github.com/bitcoin/bitcoin/commit/1b14bd7ac77027351a1e5b3ef21fb2d1de659efd):\r\n> \r\n> same comment from before, I'd suggest using `find` here.\r\n\r\nanswered in the first commit comment https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1034897955\r\n\r\n\r\n> also, might be worth adding the `if () return false;` in the earlier commit so you don't end up touching this line twice?\r\n\r\nnot sure what you meant, the first commit has a single line (the `count` function will either return 1 if the element is in the set or 0 if not).\r\n```c++\r\nreturn coins_to_remove.count(coin.outpoint) == 1;\r\n```",
      "created_at": "2022-11-29T15:26:29Z",
      "updated_at": "2022-11-29T15:26:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1034903839",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034903839"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 110,
      "original_line": 110,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034921437",
      "pull_request_review_id": 1197805794,
      "id": 1034921437,
      "node_id": "PRRC_kwDOABII5849r6Xd",
      "diff_hunk": "@@ -1200,6 +1201,59 @@ def test_add_inputs_default_value(self):\n \n         self.nodes[2].unloadwallet(\"test_preset_inputs\")\n \n+    def test_preset_inputs_selection_crash(self):\n+        self.log.info('Test wallet preset inputs selection')\n+\n+        # Here will confuse the wallet to make it select the\n+        # preset inputs twice during the coin selection process (on v24.0).\n+        #\n+        # Making it think that the selection process result covers\n+        # the entire tx target when it does not. It's actually creating\n+        # a tx that sends more coins than what inputs are covering for.\n+        #\n+        # Which, combined with the subtract fee from outputs option,\n+        # makes the wallet generate and broadcast a tx that pays\n+        # up to the sum of all the preset inputs, minus one, amounts in fee!\n+\n+        # Create and fund the wallet with 2 UTXO of 5 BTC each\n+        self.nodes[2].createwallet(\"test_preset_inputs_selection\")\n+        wallet = self.nodes[2].get_wallet_rpc(\"test_preset_inputs_selection\")\n+        outputs = {}\n+        for _ in range(2):\n+            outputs[wallet.getnewaddress(address_type=\"bech32\")] = 5\n+        self.nodes[0].sendmany(\"\", outputs)\n+        self.generate(self.nodes[0], 1)\n+\n+        # Select the preset inputs\n+        coins = wallet.listunspent()\n+        preset_inputs = [coins[0], coins[1]]\n+\n+        # Now let's create the tx\n+        options = {\n+            \"inputs\": [\n+                {\n+                    \"txid\": preset_inputs[0][\"txid\"],\n+                    \"vout\": preset_inputs[0][\"vout\"]\n+                },\n+                {\n+                    \"txid\": preset_inputs[1][\"txid\"],\n+                    \"vout\": preset_inputs[1][\"vout\"]\n+                },\n+            ],\n+            \"add_inputs\": True,\n+            \"subtract_fee_from_outputs\": [0],\n+            \"add_to_wallet\": False\n+        }\n+\n+        # First case, use 'subtract_fee_from_outputs' to make the wallet create a tx that pays an insane fee on v24.0.\n+        assert_raises_rpc_error(-4, \"Insufficient funds\", wallet.send, outputs=[{wallet.getnewaddress(address_type=\"bech32\"): 14}], options=options)\n+\n+        # Second case, don't use 'subtract_fee_from_outputs' to make the wallet crash due the insane fee on v24.0\n+        del options[\"subtract_fee_from_outputs\"]\n+        assert_raises_rpc_error(-4, \"Insufficient funds\", wallet.send, outputs=[{wallet.getnewaddress(address_type=\"bech32\"): 14}], options=options)",
      "path": "test/functional/rpc_fundrawtransaction.py",
      "position": null,
      "original_position": 61,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "a07c3b4cfdf864b419984103323d431cbe3cc870",
      "in_reply_to_id": 1034800106,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "yeah ok. I added the topic background inside the commit description that introduces the tests. But.. agree that, at least in this post-mortem bug case, the link to the PR that fixes it and further comments inside the test code would make it more digestible. Thanks.",
      "created_at": "2022-11-29T15:39:50Z",
      "updated_at": "2022-11-29T15:41:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1034921437",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1034921437"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": 1248,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1261,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035007277",
      "pull_request_review_id": 1197936889,
      "id": 1035007277,
      "node_id": "PRRC_kwDOABII5849sPUt",
      "diff_hunk": "@@ -102,15 +102,13 @@ void CoinsResult::Clear() {\n     coins.clear();\n }\n \n-void CoinsResult::Erase(std::set<COutPoint>& preset_coins)\n+void CoinsResult::Erase(const std::unordered_set<COutPoint, SaltedOutpointHasher>& coins_to_remove)\n {\n-    for (auto& it : coins) {\n-        auto& vec = it.second;\n-        auto i = std::find_if(vec.begin(), vec.end(), [&](const COutput &c) { return preset_coins.count(c.outpoint);});\n-        if (i != vec.end()) {\n-            vec.erase(i);\n-            break;\n-        }\n+    for (auto& [type, vec] : coins) {\n+        auto remove_it = std::remove_if(vec.begin(), vec.end(), [&](const COutput& coin) {\n+            return coins_to_remove.count(coin.outpoint) == 1;",
      "path": "src/wallet/spend.cpp",
      "position": null,
      "original_position": 16,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "65126cb522b28f53a020ce56826f7d15560241c9",
      "in_reply_to_id": 1034778211,
      "user": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "ah, good point! i forgot how `find` \\ `count` work is dependent on the underlying container",
      "created_at": "2022-11-29T16:49:16Z",
      "updated_at": "2022-11-29T16:49:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1035007277",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035007277"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 109,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035016991",
      "pull_request_review_id": 1197947748,
      "id": 1035016991,
      "node_id": "PRRC_kwDOABII5849sRsf",
      "diff_hunk": "@@ -106,7 +106,13 @@ void CoinsResult::Erase(const std::unordered_set<COutPoint, SaltedOutpointHasher\n {\n     for (auto& [type, vec] : coins) {\n         auto remove_it = std::remove_if(vec.begin(), vec.end(), [&](const COutput& coin) {\n-            return coins_to_remove.count(coin.outpoint) == 1;\n+            // remove it if it's on the set\n+            if (coins_to_remove.count(coin.outpoint) == 0) return false;",
      "path": "src/wallet/spend.cpp",
      "position": 17,
      "original_position": 6,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "1b14bd7ac77027351a1e5b3ef21fb2d1de659efd",
      "in_reply_to_id": 1034803002,
      "user": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "yeah, more just saying you could write the first commit like:\r\n\r\n```\r\nif (coins_to_remove.count(coin.outpoint) == 0) return false;\r\nreturn true;\r\n```\r\n\r\nbecause you know that in a later commit you will add the `total_amount` and `total_effective` code, and this way you avoid re-writing the same line twice. it doesn't really matter in this case, just a suggestion. in general, it can be confusing as a reviewer when the same line of code is edited multiple times in different commits",
      "created_at": "2022-11-29T16:55:53Z",
      "updated_at": "2022-11-29T16:55:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1035016991",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035016991"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 110,
      "original_line": 110,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035058430",
      "pull_request_review_id": 1198036593,
      "id": 1035058430,
      "node_id": "PRRC_kwDOABII5849sbz-",
      "diff_hunk": "@@ -106,7 +106,13 @@ void CoinsResult::Erase(const std::unordered_set<COutPoint, SaltedOutpointHasher\n {\n     for (auto& [type, vec] : coins) {\n         auto remove_it = std::remove_if(vec.begin(), vec.end(), [&](const COutput& coin) {\n-            return coins_to_remove.count(coin.outpoint) == 1;\n+            // remove it if it's on the set\n+            if (coins_to_remove.count(coin.outpoint) == 0) return false;",
      "path": "src/wallet/spend.cpp",
      "position": 17,
      "original_position": 6,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "1b14bd7ac77027351a1e5b3ef21fb2d1de659efd",
      "in_reply_to_id": 1034803002,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Ideally, commits should introduce atomic changes. Did the first one in this way so it can be backported without any dependency into a different branch (due the lack of https://github.com/bitcoin/bitcoin/pull/25685, v24 branch cannot cherry-pick https://github.com/bitcoin/bitcoin/commit/1b14bd7ac77027351a1e5b3ef21fb2d1de659efd).\r\n\r\nSo, we would only have those lines inside v24, which I think that is ugly. The current one looks better.",
      "created_at": "2022-11-29T17:32:13Z",
      "updated_at": "2022-11-29T17:34:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1035058430",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1035058430"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 110,
      "original_line": 110,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1036068985",
      "pull_request_review_id": 1199471979,
      "id": 1036068985,
      "node_id": "PRRC_kwDOABII5849wSh5",
      "diff_hunk": "@@ -980,5 +980,43 @@ BOOST_AUTO_TEST_CASE(SelectCoins_effective_value_test)\n     BOOST_CHECK(!result);\n }\n \n+BOOST_FIXTURE_TEST_CASE(wallet_coinsresult_test, BasicTestingSetup)\n+{\n+    // Test case to verify CoinsResult object sanity.\n+    CoinsResult available_coins;\n+    {\n+        std::unique_ptr<CWallet> dummyWallet = std::make_unique<CWallet>(m_node.chain.get(), \"dummy\", m_args, CreateMockWalletDatabase());\n+        BOOST_CHECK_EQUAL(dummyWallet->LoadWallet(), DBErrors::LOAD_OK);\n+        LOCK(dummyWallet->cs_wallet);\n+        dummyWallet->SetWalletFlag(WALLET_FLAG_DESCRIPTORS);\n+        dummyWallet->SetupDescriptorScriptPubKeyMans();\n+\n+        // Add some coins to 'available_coins'\n+        for (int i=0; i<10; i++) {\n+            add_coin(available_coins, *dummyWallet, 1 * COIN);\n+        }\n+    }\n+\n+    {\n+        // First test case, check that 'CoinsResult::Erase' function works as expected.\n+        // By trying to erase two elements from the 'available_coins' object.\n+        std::unordered_set<COutPoint, SaltedOutpointHasher> outs_to_remove;\n+        const auto& coins = available_coins.All();\n+        for (int i = 0; i < 2; i++) {\n+            outs_to_remove.emplace(coins[i].outpoint);\n+        }\n+        available_coins.Erase(outs_to_remove);",
      "path": "src/wallet/test/coinselector_tests.cpp",
      "position": 63,
      "original_position": 29,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "4ba93512768201402e2ff445b13a6dba666cd80b",
      "in_reply_to_id": null,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: Could add a check that you also haven't removed things that weren't supposed to be removed. For example, a `BOOST_CHECK_EQUAL(available_coins.Size(), 8);` would catch a case of, for example, accidentally removing the entire map entry for that output type instead of an element in the vector of the entry.",
      "created_at": "2022-11-30T14:51:16Z",
      "updated_at": "2022-12-01T10:26:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1036068985",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1036068985"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1008,
      "original_line": 1008,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1036074023",
      "pull_request_review_id": 1199471979,
      "id": 1036074023,
      "node_id": "PRRC_kwDOABII5849wTwn",
      "diff_hunk": "@@ -1200,6 +1201,67 @@ def test_add_inputs_default_value(self):\n \n         self.nodes[2].unloadwallet(\"test_preset_inputs\")\n \n+    def test_preset_inputs_selection_crash(self):\n+        self.log.info('Test wallet preset inputs selection')\n+\n+        # This exercises the bug presented in #26559 that\n+        # ended up on (1) a wallet crash or (2) a created and\n+        # broadcasted tx that pays an insane fee amount.\n+        #\n+        # This is covered by making the wallet selects the preset\n+        # inputs twice during the coin selection process (which\n+        # is a dangerous bug on v24.0).\n+        #\n+        # Making the wallet think that the selection process result covers\n+        # the entire tx target when it does not. It's actually creating\n+        # a tx that sends more coins than what inputs are covering for.\n+        #\n+        # Which, combined with the subtract fee from outputs option,\n+        # makes the wallet generate and broadcast a tx that pays\n+        # up to the sum of all the preset inputs, minus one, amounts in\n+        # fee :(.\n+\n+        # Create and fund the wallet with 2 UTXO of 5 BTC each\n+        self.nodes[2].createwallet(\"test_preset_inputs_selection\")\n+        wallet = self.nodes[2].get_wallet_rpc(\"test_preset_inputs_selection\")\n+        outputs = {}\n+        for _ in range(2):\n+            outputs[wallet.getnewaddress(address_type=\"bech32\")] = 5\n+        self.nodes[0].sendmany(\"\", outputs)\n+        self.generate(self.nodes[0], 1)\n+\n+        # Select the preset inputs\n+        coins = wallet.listunspent()\n+        preset_inputs = [coins[0], coins[1]]\n+\n+        # Now let's create the tx\n+        options = {\n+            \"inputs\": [\n+                {\n+                    \"txid\": preset_inputs[0][\"txid\"],\n+                    \"vout\": preset_inputs[0][\"vout\"]\n+                },\n+                {\n+                    \"txid\": preset_inputs[1][\"txid\"],\n+                    \"vout\": preset_inputs[1][\"vout\"]\n+                },\n+            ],",
      "path": "test/functional/rpc_fundrawtransaction.py",
      "position": null,
      "original_position": 56,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "01d5cf9d1d65795edcd15efb0b2e7b8a22e0b778",
      "in_reply_to_id": null,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: why can't you just make this equal to `preset_inputs` - maybe I'm missing something?\r\n\r\n```suggestion\r\n           \"inputs\": preset_inputs,\r\n```",
      "created_at": "2022-11-30T14:55:11Z",
      "updated_at": "2022-12-01T10:26:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1036074023",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1036074023"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": 1239,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1248,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1036387520",
      "pull_request_review_id": 1199933874,
      "id": 1036387520,
      "node_id": "PRRC_kwDOABII5849xgTA",
      "diff_hunk": "@@ -112,5 +112,34 @@ BOOST_FIXTURE_TEST_CASE(FillInputToWeightTest, BasicTestingSetup)\n     // Note: We don't test the next boundary because of memory allocation constraints.\n }\n \n+BOOST_FIXTURE_TEST_CASE(wallet_duplicated_preset_inputs_test, TestChain100Setup)\n+{\n+    // Verify that the wallet's Coin Selection process does not include pre-selected inputs twice in a transaction.\n+    for (int i = 0; i < 2; i++) CreateAndProcessBlock({}, GetScriptForRawPubKey(coinbaseKey.GetPubKey()));\n+    auto wallet = CreateSyncedWallet(*m_node.chain, WITH_LOCK(Assert(m_node.chainman)->GetMutex(), return m_node.chainman->ActiveChain()), m_args, coinbaseKey);\n+\n+    LOCK(wallet->cs_wallet);\n+    auto available_coins = AvailableCoins(*wallet);\n+    std::vector<COutput> coins = available_coins.All();\n+    std::set<COutPoint> preset_inputs = {coins[0].outpoint, coins[1].outpoint};\n+\n+    // Now that all coins were locked except the two preset inputs, let's create a tx\n+    std::vector<CRecipient> recipients = {{GetScriptForDestination(*Assert(wallet->GetNewDestination(OutputType::BECH32, \"dummy\"))), 149 * COIN, /*fSubtractFeeFromAmount=*/true}};\n+    CCoinControl coin_control;\n+    coin_control.m_allow_other_inputs = true;\n+    for (const auto& outpoint : preset_inputs) {\n+        coin_control.Select(outpoint);\n+    }\n+\n+    // First case, use 'subtract_fee_from_outputs' to make the wallet create a tx that pays an insane fee on v24.0.",
      "path": "src/wallet/test/spend_tests.cpp",
      "position": null,
      "original_position": 23,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "01d5cf9d1d65795edcd15efb0b2e7b8a22e0b778",
      "in_reply_to_id": null,
      "user": {
        "login": "Xekyo",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Xekyo",
        "html_url": "https://github.com/Xekyo",
        "followers_url": "https://api.github.com/users/Xekyo/followers",
        "following_url": "https://api.github.com/users/Xekyo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Xekyo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Xekyo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Xekyo/subscriptions",
        "organizations_url": "https://api.github.com/users/Xekyo/orgs",
        "repos_url": "https://api.github.com/users/Xekyo/repos",
        "events_url": "https://api.github.com/users/Xekyo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Xekyo/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Just a nit, but the term \"insane fee\" had me thinking that this test has us paying a huge amount of fees, something that would be conflicting with our sanity checks.",
      "created_at": "2022-11-30T19:54:30Z",
      "updated_at": "2022-11-30T20:43:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1036387520",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1036387520"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 134,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1036388582",
      "pull_request_review_id": 1199933874,
      "id": 1036388582,
      "node_id": "PRRC_kwDOABII5849xgjm",
      "diff_hunk": "@@ -112,5 +112,34 @@ BOOST_FIXTURE_TEST_CASE(FillInputToWeightTest, BasicTestingSetup)\n     // Note: We don't test the next boundary because of memory allocation constraints.\n }\n \n+BOOST_FIXTURE_TEST_CASE(wallet_duplicated_preset_inputs_test, TestChain100Setup)\n+{\n+    // Verify that the wallet's Coin Selection process does not include pre-selected inputs twice in a transaction.\n+    for (int i = 0; i < 2; i++) CreateAndProcessBlock({}, GetScriptForRawPubKey(coinbaseKey.GetPubKey()));\n+    auto wallet = CreateSyncedWallet(*m_node.chain, WITH_LOCK(Assert(m_node.chainman)->GetMutex(), return m_node.chainman->ActiveChain()), m_args, coinbaseKey);\n+\n+    LOCK(wallet->cs_wallet);\n+    auto available_coins = AvailableCoins(*wallet);\n+    std::vector<COutput> coins = available_coins.All();\n+    std::set<COutPoint> preset_inputs = {coins[0].outpoint, coins[1].outpoint};\n+\n+    // Now that all coins were locked except the two preset inputs, let's create a tx\n+    std::vector<CRecipient> recipients = {{GetScriptForDestination(*Assert(wallet->GetNewDestination(OutputType::BECH32, \"dummy\"))), 149 * COIN, /*fSubtractFeeFromAmount=*/true}};\n+    CCoinControl coin_control;\n+    coin_control.m_allow_other_inputs = true;\n+    for (const auto& outpoint : preset_inputs) {\n+        coin_control.Select(outpoint);\n+    }\n+\n+    // First case, use 'subtract_fee_from_outputs' to make the wallet create a tx that pays an insane fee on v24.0.\n+    util::Result<CreatedTransactionResult> res_tx = CreateTransaction(*wallet, recipients, /*change_pos*/-1, coin_control);\n+    BOOST_CHECK(!res_tx.has_value());",
      "path": "src/wallet/test/spend_tests.cpp",
      "position": 41,
      "original_position": 25,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "01d5cf9d1d65795edcd15efb0b2e7b8a22e0b778",
      "in_reply_to_id": null,
      "user": {
        "login": "Xekyo",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Xekyo",
        "html_url": "https://github.com/Xekyo",
        "followers_url": "https://api.github.com/users/Xekyo/followers",
        "following_url": "https://api.github.com/users/Xekyo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Xekyo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Xekyo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Xekyo/subscriptions",
        "organizations_url": "https://api.github.com/users/Xekyo/orgs",
        "repos_url": "https://api.github.com/users/Xekyo/repos",
        "events_url": "https://api.github.com/users/Xekyo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Xekyo/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It was not clear to me at first why the expected outcome is that we don't create a transaction. That could have perhaps been captured in the comment instead: the wallet shouldn't have sufficient funds to create the tx, but the bug caused us previously to assume that preset UTXOs were available twice and thus overestimate our funding.",
      "created_at": "2022-11-30T19:55:43Z",
      "updated_at": "2022-11-30T20:43:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1036388582",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1036388582"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 152,
      "original_line": 152,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1036389602",
      "pull_request_review_id": 1199933874,
      "id": 1036389602,
      "node_id": "PRRC_kwDOABII5849xgzi",
      "diff_hunk": "@@ -1200,6 +1201,67 @@ def test_add_inputs_default_value(self):\n \n         self.nodes[2].unloadwallet(\"test_preset_inputs\")\n \n+    def test_preset_inputs_selection_crash(self):\n+        self.log.info('Test wallet preset inputs selection')\n+\n+        # This exercises the bug presented in #26559 that\n+        # ended up on (1) a wallet crash or (2) a created and\n+        # broadcasted tx that pays an insane fee amount.\n+        #\n+        # This is covered by making the wallet selects the preset\n+        # inputs twice during the coin selection process (which\n+        # is a dangerous bug on v24.0).\n+        #\n+        # Making the wallet think that the selection process result covers\n+        # the entire tx target when it does not. It's actually creating\n+        # a tx that sends more coins than what inputs are covering for.\n+        #\n+        # Which, combined with the subtract fee from outputs option,\n+        # makes the wallet generate and broadcast a tx that pays\n+        # up to the sum of all the preset inputs, minus one, amounts in\n+        # fee :(.",
      "path": "test/functional/rpc_fundrawtransaction.py",
      "position": null,
      "original_position": 30,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "01d5cf9d1d65795edcd15efb0b2e7b8a22e0b778",
      "in_reply_to_id": null,
      "user": {
        "login": "Xekyo",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Xekyo",
        "html_url": "https://github.com/Xekyo",
        "followers_url": "https://api.github.com/users/Xekyo/followers",
        "following_url": "https://api.github.com/users/Xekyo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Xekyo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Xekyo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Xekyo/subscriptions",
        "organizations_url": "https://api.github.com/users/Xekyo/orgs",
        "repos_url": "https://api.github.com/users/Xekyo/repos",
        "events_url": "https://api.github.com/users/Xekyo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Xekyo/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I see, that is the context that I was missing above! :)",
      "created_at": "2022-11-30T19:56:59Z",
      "updated_at": "2022-11-30T20:43:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1036389602",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1036389602"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": 1219,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1222,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1036411064",
      "pull_request_review_id": 1199933874,
      "id": 1036411064,
      "node_id": "PRRC_kwDOABII5849xmC4",
      "diff_hunk": "@@ -106,7 +106,13 @@ void CoinsResult::Erase(const std::unordered_set<COutPoint, SaltedOutpointHasher\n {\n     for (auto& [type, vec] : coins) {\n         auto remove_it = std::remove_if(vec.begin(), vec.end(), [&](const COutput& coin) {\n-            return coins_to_remove.count(coin.outpoint) == 1;\n+            // remove it if it's on the set\n+            if (coins_to_remove.count(coin.outpoint) == 0) return false;\n+\n+            // update cached amounts\n+            total_amount -= coin.txout.nValue;\n+            if (coin.HasEffectiveValue()) total_effective_amount = *total_effective_amount - coin.GetEffectiveValue();",
      "path": "src/wallet/spend.cpp",
      "position": 21,
      "original_position": 10,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "a45ecd64ba4f63cba8d5f623a9442d81ccf63ac4",
      "in_reply_to_id": null,
      "user": {
        "login": "Xekyo",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Xekyo",
        "html_url": "https://github.com/Xekyo",
        "followers_url": "https://api.github.com/users/Xekyo/followers",
        "following_url": "https://api.github.com/users/Xekyo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Xekyo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Xekyo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Xekyo/subscriptions",
        "organizations_url": "https://api.github.com/users/Xekyo/orgs",
        "repos_url": "https://api.github.com/users/Xekyo/repos",
        "events_url": "https://api.github.com/users/Xekyo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Xekyo/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Are we sure that `total_effective_value` is always set here?\r\n\r\nMaybe `assume(total_effective_amount.has_value()` here?",
      "created_at": "2022-11-30T20:24:26Z",
      "updated_at": "2022-11-30T20:43:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1036411064",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1036411064"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 114,
      "original_line": 114,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1036419174",
      "pull_request_review_id": 1199933874,
      "id": 1036419174,
      "node_id": "PRRC_kwDOABII5849xoBm",
      "diff_hunk": "@@ -575,6 +584,14 @@ std::optional<SelectionResult> SelectCoins(const CWallet& wallet, CoinsResult& a\n         return result;\n     }\n \n+    // Return early if we cannot cover the target with the wallet's UTXO.\n+    // We use the total effective value if we are not subtracting fee from outputs and 'available_coins' contains the data.\n+    CAmount available_coins_total_amount = coin_selection_params.m_subtract_fee_outputs ? available_coins.total_amount :\n+            (available_coins.total_effective_amount.has_value() ? *available_coins.total_effective_amount : 0);",
      "path": "src/wallet/spend.cpp",
      "position": null,
      "original_position": 43,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "a45ecd64ba4f63cba8d5f623a9442d81ccf63ac4",
      "in_reply_to_id": null,
      "user": {
        "login": "Xekyo",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Xekyo",
        "html_url": "https://github.com/Xekyo",
        "followers_url": "https://api.github.com/users/Xekyo/followers",
        "following_url": "https://api.github.com/users/Xekyo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Xekyo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Xekyo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Xekyo/subscriptions",
        "organizations_url": "https://api.github.com/users/Xekyo/orgs",
        "repos_url": "https://api.github.com/users/Xekyo/repos",
        "events_url": "https://api.github.com/users/Xekyo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Xekyo/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "We will never use `SelectCoins()` without a feerate. If you end up not having total_effective_amount here, something went terribly wrong. Perhaps just:\r\n\r\n```suggestion\r\n    assume(available_coins.total_effective_amount.has_value());\r\n    CAmount available_coins_total_amount = coin_selection_params.m_subtract_fee_outputs ? available_coins.total_amount : *available_coins.total_effective_amount);\r\n```",
      "created_at": "2022-11-30T20:35:33Z",
      "updated_at": "2022-11-30T20:43:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1036419174",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1036419174"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": 589,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 590,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1036421300",
      "pull_request_review_id": 1199933874,
      "id": 1036421300,
      "node_id": "PRRC_kwDOABII5849xoi0",
      "diff_hunk": "@@ -452,12 +452,16 @@ void SelectionResult::AddInputs(const std::set<COutput>& inputs, bool subtract_f\n \n void SelectionResult::Merge(const SelectionResult& other)\n {\n+    // Obtain the expected selected inputs count after the merge (for now, duplicates are not allowed)",
      "path": "src/wallet/coinselection.cpp",
      "position": 4,
      "original_position": 4,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "in_reply_to_id": null,
      "user": {
        "login": "Xekyo",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Xekyo",
        "html_url": "https://github.com/Xekyo",
        "followers_url": "https://api.github.com/users/Xekyo/followers",
        "following_url": "https://api.github.com/users/Xekyo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Xekyo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Xekyo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Xekyo/subscriptions",
        "organizations_url": "https://api.github.com/users/Xekyo/orgs",
        "repos_url": "https://api.github.com/users/Xekyo/repos",
        "events_url": "https://api.github.com/users/Xekyo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Xekyo/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```suggestion\r\n    // Store sum of combined input sets to check that no UTXO was used twice\r\n```",
      "created_at": "2022-11-30T20:38:46Z",
      "updated_at": "2022-11-30T20:43:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1036421300",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1036421300"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 455,
      "original_line": 455,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1036429162",
      "pull_request_review_id": 1199994539,
      "id": 1036429162,
      "node_id": "PRRC_kwDOABII5849xqdq",
      "diff_hunk": "@@ -47,12 +47,14 @@ struct CoinsResult {\n      * i.e., methods can work with individual OutputType vectors or on the entire object */\n     size_t Size() const;\n     void Clear();\n-    void Erase(std::set<COutPoint>& preset_coins);\n+    void Erase(const std::unordered_set<COutPoint, SaltedOutpointHasher>& coins_to_remove);\n     void Shuffle(FastRandomContext& rng_fast);\n     void Add(OutputType type, const COutput& out);\n \n-    /** Sum of all available coins */\n+    /** Sum of all available coins raw value */\n     CAmount total_amount{0};\n+    /** Sum of all available coins effective value (each output value minus fees required to spend it) */\n+    std::optional<CAmount> total_effective_amount{0};",
      "path": "src/wallet/spend.h",
      "position": 17,
      "original_position": 13,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think it would be useful to make `total_amount`, `total_effective_amount`, and `coins` private members to ensure that we are only adding/removing things with `Add` and `Erase`.",
      "created_at": "2022-11-30T20:49:27Z",
      "updated_at": "2022-11-30T20:49:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1036429162",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1036429162"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 61,
      "original_line": 61,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1036429177",
      "pull_request_review_id": 1199994567,
      "id": 1036429177,
      "node_id": "PRRC_kwDOABII5849xqd5",
      "diff_hunk": "@@ -106,7 +106,13 @@ void CoinsResult::Erase(const std::unordered_set<COutPoint, SaltedOutpointHasher\n {\n     for (auto& [type, vec] : coins) {\n         auto remove_it = std::remove_if(vec.begin(), vec.end(), [&](const COutput& coin) {\n-            return coins_to_remove.count(coin.outpoint) == 1;\n+            // remove it if it's on the set\n+            if (coins_to_remove.count(coin.outpoint) == 0) return false;\n+\n+            // update cached amounts\n+            total_amount -= coin.txout.nValue;\n+            if (coin.HasEffectiveValue()) total_effective_amount = *total_effective_amount - coin.GetEffectiveValue();",
      "path": "src/wallet/spend.cpp",
      "position": 21,
      "original_position": 10,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "a45ecd64ba4f63cba8d5f623a9442d81ccf63ac4",
      "in_reply_to_id": 1036411064,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I had this question myself. I figured if we remove the coin with effective value, then the coin was added before, hence we have `total_effective_value` defined. Please correct me if my reasoning is flawed.",
      "created_at": "2022-11-30T20:49:28Z",
      "updated_at": "2022-11-30T20:49:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1036429177",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1036429177"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 114,
      "original_line": 114,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1036936363",
      "pull_request_review_id": 1199471979,
      "id": 1036936363,
      "node_id": "PRRC_kwDOABII5849zmSr",
      "diff_hunk": "@@ -452,12 +452,16 @@ void SelectionResult::AddInputs(const std::set<COutput>& inputs, bool subtract_f\n \n void SelectionResult::Merge(const SelectionResult& other)\n {\n+    // Obtain the expected selected inputs count after the merge (for now, duplicates are not allowed)\n+    const size_t expected_count = m_selected_inputs.size() + other.m_selected_inputs.size();\n+\n     m_target += other.m_target;\n     m_use_effective |= other.m_use_effective;\n     if (m_algo == SelectionAlgorithm::MANUAL) {\n         m_algo = other.m_algo;\n     }\n     util::insert(m_selected_inputs, other.m_selected_inputs);\n+    assert(m_selected_inputs.size() == expected_count);",
      "path": "src/wallet/coinselection.cpp",
      "position": 13,
      "original_position": 13,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "in_reply_to_id": null,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It's a bit unclear to me how the assert added in eb76557331b4f34b568da1d9c589c7005d7ab46d is more safe? Wouldn't this mean we still crash if we haven't caught a similar bug before shipping?",
      "created_at": "2022-12-01T10:23:29Z",
      "updated_at": "2022-12-01T10:26:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1036936363",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1036936363"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 464,
      "original_line": 464,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1037315629",
      "pull_request_review_id": 1201300739,
      "id": 1037315629,
      "node_id": "PRRC_kwDOABII58491C4t",
      "diff_hunk": "@@ -112,5 +112,34 @@ BOOST_FIXTURE_TEST_CASE(FillInputToWeightTest, BasicTestingSetup)\n     // Note: We don't test the next boundary because of memory allocation constraints.\n }\n \n+BOOST_FIXTURE_TEST_CASE(wallet_duplicated_preset_inputs_test, TestChain100Setup)\n+{\n+    // Verify that the wallet's Coin Selection process does not include pre-selected inputs twice in a transaction.\n+    for (int i = 0; i < 2; i++) CreateAndProcessBlock({}, GetScriptForRawPubKey(coinbaseKey.GetPubKey()));\n+    auto wallet = CreateSyncedWallet(*m_node.chain, WITH_LOCK(Assert(m_node.chainman)->GetMutex(), return m_node.chainman->ActiveChain()), m_args, coinbaseKey);\n+\n+    LOCK(wallet->cs_wallet);\n+    auto available_coins = AvailableCoins(*wallet);\n+    std::vector<COutput> coins = available_coins.All();\n+    std::set<COutPoint> preset_inputs = {coins[0].outpoint, coins[1].outpoint};\n+\n+    // Now that all coins were locked except the two preset inputs, let's create a tx\n+    std::vector<CRecipient> recipients = {{GetScriptForDestination(*Assert(wallet->GetNewDestination(OutputType::BECH32, \"dummy\"))), 149 * COIN, /*fSubtractFeeFromAmount=*/true}};\n+    CCoinControl coin_control;\n+    coin_control.m_allow_other_inputs = true;\n+    for (const auto& outpoint : preset_inputs) {\n+        coin_control.Select(outpoint);\n+    }\n+\n+    // First case, use 'subtract_fee_from_outputs' to make the wallet create a tx that pays an insane fee on v24.0.",
      "path": "src/wallet/test/spend_tests.cpp",
      "position": null,
      "original_position": 23,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "in_reply_to_id": null,
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't think we should be adding specific version numbers to comments, because this just becomes (mostly) incorrect, once we've merged a backport, and doesn't really provide any value otherwise.\r\n```suggestion\r\n    // First case, use 'subtract_fee_from_outputs' to make the wallet create a tx that pays an insane fee.\r\n```",
      "created_at": "2022-12-01T16:18:50Z",
      "updated_at": "2022-12-01T16:18:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1037315629",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1037315629"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 134,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1037319314",
      "pull_request_review_id": 1201306217,
      "id": 1037319314,
      "node_id": "PRRC_kwDOABII58491DyS",
      "diff_hunk": "@@ -1200,6 +1201,67 @@ def test_add_inputs_default_value(self):\n \n         self.nodes[2].unloadwallet(\"test_preset_inputs\")\n \n+    def test_preset_inputs_selection_crash(self):\n+        self.log.info('Test wallet preset inputs selection')\n+\n+        # This exercises the bug presented in #26559 that\n+        # ended up on (1) a wallet crash or (2) a created and\n+        # broadcasted tx that pays an insane fee amount.\n+        #\n+        # This is covered by making the wallet selects the preset\n+        # inputs twice during the coin selection process (which\n+        # is a dangerous bug on v24.0).\n+        #\n+        # Making the wallet think that the selection process result covers\n+        # the entire tx target when it does not. It's actually creating\n+        # a tx that sends more coins than what inputs are covering for.\n+        #\n+        # Which, combined with the subtract fee from outputs option,\n+        # makes the wallet generate and broadcast a tx that pays\n+        # up to the sum of all the preset inputs, minus one, amounts in\n+        # fee :(.\n+\n+        # Create and fund the wallet with 2 UTXO of 5 BTC each\n+        self.nodes[2].createwallet(\"test_preset_inputs_selection\")\n+        wallet = self.nodes[2].get_wallet_rpc(\"test_preset_inputs_selection\")\n+        outputs = {}\n+        for _ in range(2):\n+            outputs[wallet.getnewaddress(address_type=\"bech32\")] = 5\n+        self.nodes[0].sendmany(\"\", outputs)\n+        self.generate(self.nodes[0], 1)\n+\n+        # Select the preset inputs\n+        coins = wallet.listunspent()\n+        preset_inputs = [coins[0], coins[1]]\n+\n+        # Now let's create the tx\n+        options = {\n+            \"inputs\": [\n+                {\n+                    \"txid\": preset_inputs[0][\"txid\"],\n+                    \"vout\": preset_inputs[0][\"vout\"]\n+                },\n+                {\n+                    \"txid\": preset_inputs[1][\"txid\"],\n+                    \"vout\": preset_inputs[1][\"vout\"]\n+                },\n+            ],\n+            \"add_inputs\": True,\n+            \"subtract_fee_from_outputs\": [0],\n+            \"add_to_wallet\": False\n+        }\n+\n+        # First case, use 'subtract_fee_from_outputs' to make the wallet create a tx that pays an insane fee on v24.0.\n+        # (further details in #26559).",
      "path": "test/functional/rpc_fundrawtransaction.py",
      "position": null,
      "original_position": 63,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "in_reply_to_id": null,
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "There is no need to continually write `v24.0` and `(further details in #26559)` (here and below and further above). If you need to provide further context or details, please put them in the commit (or PR) descriptions, so they are available with the code change.",
      "created_at": "2022-12-01T16:22:16Z",
      "updated_at": "2022-12-01T16:22:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1037319314",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1037319314"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1255,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1037337828",
      "pull_request_review_id": 1201333779,
      "id": 1037337828,
      "node_id": "PRRC_kwDOABII58491ITk",
      "diff_hunk": "@@ -1200,6 +1201,67 @@ def test_add_inputs_default_value(self):\n \n         self.nodes[2].unloadwallet(\"test_preset_inputs\")\n \n+    def test_preset_inputs_selection_crash(self):\n+        self.log.info('Test wallet preset inputs selection')\n+\n+        # This exercises the bug presented in #26559 that\n+        # ended up on (1) a wallet crash or (2) a created and\n+        # broadcasted tx that pays an insane fee amount.\n+        #\n+        # This is covered by making the wallet selects the preset\n+        # inputs twice during the coin selection process (which\n+        # is a dangerous bug on v24.0).\n+        #\n+        # Making the wallet think that the selection process result covers\n+        # the entire tx target when it does not. It's actually creating\n+        # a tx that sends more coins than what inputs are covering for.\n+        #\n+        # Which, combined with the subtract fee from outputs option,\n+        # makes the wallet generate and broadcast a tx that pays\n+        # up to the sum of all the preset inputs, minus one, amounts in\n+        # fee :(.\n+\n+        # Create and fund the wallet with 2 UTXO of 5 BTC each\n+        self.nodes[2].createwallet(\"test_preset_inputs_selection\")\n+        wallet = self.nodes[2].get_wallet_rpc(\"test_preset_inputs_selection\")\n+        outputs = {}\n+        for _ in range(2):\n+            outputs[wallet.getnewaddress(address_type=\"bech32\")] = 5\n+        self.nodes[0].sendmany(\"\", outputs)\n+        self.generate(self.nodes[0], 1)\n+\n+        # Select the preset inputs\n+        coins = wallet.listunspent()\n+        preset_inputs = [coins[0], coins[1]]\n+\n+        # Now let's create the tx\n+        options = {\n+            \"inputs\": [\n+                {\n+                    \"txid\": preset_inputs[0][\"txid\"],\n+                    \"vout\": preset_inputs[0][\"vout\"]\n+                },\n+                {\n+                    \"txid\": preset_inputs[1][\"txid\"],\n+                    \"vout\": preset_inputs[1][\"vout\"]\n+                },\n+            ],\n+            \"add_inputs\": True,\n+            \"subtract_fee_from_outputs\": [0],\n+            \"add_to_wallet\": False\n+        }\n+\n+        # First case, use 'subtract_fee_from_outputs' to make the wallet create a tx that pays an insane fee on v24.0.\n+        # (further details in #26559).",
      "path": "test/functional/rpc_fundrawtransaction.py",
      "position": null,
      "original_position": 63,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "in_reply_to_id": 1037319314,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "those were my initial thoughts actually, added this on the last push per request https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1034800106.\r\n\r\nseems that not everyone read the PR/commit description. But well, will just revert it.",
      "created_at": "2022-12-01T16:38:51Z",
      "updated_at": "2022-12-01T16:39:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1037337828",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1037337828"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1255,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1037351924",
      "pull_request_review_id": 1201354316,
      "id": 1037351924,
      "node_id": "PRRC_kwDOABII58491Lv0",
      "diff_hunk": "@@ -1200,6 +1201,67 @@ def test_add_inputs_default_value(self):\n \n         self.nodes[2].unloadwallet(\"test_preset_inputs\")\n \n+    def test_preset_inputs_selection_crash(self):\n+        self.log.info('Test wallet preset inputs selection')\n+\n+        # This exercises the bug presented in #26559 that\n+        # ended up on (1) a wallet crash or (2) a created and\n+        # broadcasted tx that pays an insane fee amount.\n+        #\n+        # This is covered by making the wallet selects the preset\n+        # inputs twice during the coin selection process (which\n+        # is a dangerous bug on v24.0).\n+        #\n+        # Making the wallet think that the selection process result covers\n+        # the entire tx target when it does not. It's actually creating\n+        # a tx that sends more coins than what inputs are covering for.\n+        #\n+        # Which, combined with the subtract fee from outputs option,\n+        # makes the wallet generate and broadcast a tx that pays\n+        # up to the sum of all the preset inputs, minus one, amounts in\n+        # fee :(.\n+\n+        # Create and fund the wallet with 2 UTXO of 5 BTC each\n+        self.nodes[2].createwallet(\"test_preset_inputs_selection\")\n+        wallet = self.nodes[2].get_wallet_rpc(\"test_preset_inputs_selection\")\n+        outputs = {}\n+        for _ in range(2):\n+            outputs[wallet.getnewaddress(address_type=\"bech32\")] = 5\n+        self.nodes[0].sendmany(\"\", outputs)\n+        self.generate(self.nodes[0], 1)\n+\n+        # Select the preset inputs\n+        coins = wallet.listunspent()\n+        preset_inputs = [coins[0], coins[1]]\n+\n+        # Now let's create the tx\n+        options = {\n+            \"inputs\": [\n+                {\n+                    \"txid\": preset_inputs[0][\"txid\"],\n+                    \"vout\": preset_inputs[0][\"vout\"]\n+                },\n+                {\n+                    \"txid\": preset_inputs[1][\"txid\"],\n+                    \"vout\": preset_inputs[1][\"vout\"]\n+                },\n+            ],\n+            \"add_inputs\": True,\n+            \"subtract_fee_from_outputs\": [0],\n+            \"add_to_wallet\": False\n+        }\n+\n+        # First case, use 'subtract_fee_from_outputs' to make the wallet create a tx that pays an insane fee on v24.0.\n+        # (further details in #26559).",
      "path": "test/functional/rpc_fundrawtransaction.py",
      "position": null,
      "original_position": 63,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "in_reply_to_id": 1037319314,
      "user": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Sorry if this wasn't clear in my comment, but I wasn't suggesting adding `v24` and links to the PR. My comment was to point out that the comments in the test didn't match what was being checked in the assertion, which would be confusing to someone who didn't have the background context. I understand this is a bit tricky because the test is for a bug that is no longer there, but ideally, the comment should explain why you are asserting \"Insufficient Funds\" in the happy case, and why, if the bug were present, that you would expect the \"Insufficient Funds\" assertion to fail. If you do want to link to the PR for more context, perhaps a top-level comment would be the best place?",
      "created_at": "2022-12-01T16:52:23Z",
      "updated_at": "2022-12-01T16:52:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1037351924",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1037351924"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1255,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1037395665",
      "pull_request_review_id": 1201406725,
      "id": 1037395665,
      "node_id": "PRRC_kwDOABII58491WbR",
      "diff_hunk": "@@ -452,12 +452,16 @@ void SelectionResult::AddInputs(const std::set<COutput>& inputs, bool subtract_f\n \n void SelectionResult::Merge(const SelectionResult& other)\n {\n+    // Obtain the expected selected inputs count after the merge (for now, duplicates are not allowed)\n+    const size_t expected_count = m_selected_inputs.size() + other.m_selected_inputs.size();\n+\n     m_target += other.m_target;\n     m_use_effective |= other.m_use_effective;\n     if (m_algo == SelectionAlgorithm::MANUAL) {\n         m_algo = other.m_algo;\n     }\n     util::insert(m_selected_inputs, other.m_selected_inputs);\n+    assert(m_selected_inputs.size() == expected_count);",
      "path": "src/wallet/coinselection.cpp",
      "position": 13,
      "original_position": 13,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "in_reply_to_id": 1036936363,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I suggest removing this last commit for this PR, and following up with an \"add sanity checks to coin selection code\" PR.\r\n\r\nOf course we don't want to create a bad transaction, but an assert would cause the user's node to crash in case we have implemented it wrong. I think something better could be to add `if(!Assume(...)) {return \"sorry, something went wrong and transaction creation failed. please report this bug...\";}` which should stop the wallet from doing something horrible but also not crash. Apologies if this is bikesheddy - my concrete suggestion is to remove this for now, and do a followup PR for these types of changes. Other appropriate sanity checks could include `AddInput()` never adds an input that's already there, `SelectCoins` result should cover `selection_target`, etc.",
      "created_at": "2022-12-01T17:36:37Z",
      "updated_at": "2022-12-01T17:58:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1037395665",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1037395665"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 464,
      "original_line": 464,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1037410273",
      "pull_request_review_id": 1201406725,
      "id": 1037410273,
      "node_id": "PRRC_kwDOABII58491Z_h",
      "diff_hunk": "@@ -1200,6 +1201,67 @@ def test_add_inputs_default_value(self):\n \n         self.nodes[2].unloadwallet(\"test_preset_inputs\")\n \n+    def test_preset_inputs_selection_crash(self):\n+        self.log.info('Test wallet preset inputs selection')\n+\n+        # This exercises the bug presented in #26559 that\n+        # ended up on (1) a wallet crash or (2) a created and\n+        # broadcasted tx that pays an insane fee amount.\n+        #\n+        # This is covered by making the wallet selects the preset\n+        # inputs twice during the coin selection process (which\n+        # is a dangerous bug on v24.0).\n+        #\n+        # Making the wallet think that the selection process result covers\n+        # the entire tx target when it does not. It's actually creating\n+        # a tx that sends more coins than what inputs are covering for.\n+        #\n+        # Which, combined with the subtract fee from outputs option,\n+        # makes the wallet generate and broadcast a tx that pays\n+        # up to the sum of all the preset inputs, minus one, amounts in\n+        # fee :(.\n+\n+        # Create and fund the wallet with 2 UTXO of 5 BTC each",
      "path": "test/functional/rpc_fundrawtransaction.py",
      "position": null,
      "original_position": 32,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "in_reply_to_id": null,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```suggestion\r\n        self.log.info('Test wallet preset inputs are not double-counted or reused in coin selection')\r\n\r\n        # Create and fund the wallet with 2 UTXO of 5 BTC each, total balance 10 BTC.\r\n```",
      "created_at": "2022-12-01T17:52:34Z",
      "updated_at": "2022-12-01T17:58:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1037410273",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1037410273"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": 1205,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1224,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1037410889",
      "pull_request_review_id": 1201406725,
      "id": 1037410889,
      "node_id": "PRRC_kwDOABII58491aJJ",
      "diff_hunk": "@@ -1200,6 +1201,67 @@ def test_add_inputs_default_value(self):\n \n         self.nodes[2].unloadwallet(\"test_preset_inputs\")\n \n+    def test_preset_inputs_selection_crash(self):\n+        self.log.info('Test wallet preset inputs selection')\n+\n+        # This exercises the bug presented in #26559 that\n+        # ended up on (1) a wallet crash or (2) a created and\n+        # broadcasted tx that pays an insane fee amount.\n+        #\n+        # This is covered by making the wallet selects the preset\n+        # inputs twice during the coin selection process (which\n+        # is a dangerous bug on v24.0).\n+        #\n+        # Making the wallet think that the selection process result covers\n+        # the entire tx target when it does not. It's actually creating\n+        # a tx that sends more coins than what inputs are covering for.\n+        #\n+        # Which, combined with the subtract fee from outputs option,\n+        # makes the wallet generate and broadcast a tx that pays\n+        # up to the sum of all the preset inputs, minus one, amounts in\n+        # fee :(.\n+\n+        # Create and fund the wallet with 2 UTXO of 5 BTC each\n+        self.nodes[2].createwallet(\"test_preset_inputs_selection\")\n+        wallet = self.nodes[2].get_wallet_rpc(\"test_preset_inputs_selection\")\n+        outputs = {}\n+        for _ in range(2):\n+            outputs[wallet.getnewaddress(address_type=\"bech32\")] = 5\n+        self.nodes[0].sendmany(\"\", outputs)\n+        self.generate(self.nodes[0], 1)\n+\n+        # Select the preset inputs\n+        coins = wallet.listunspent()\n+        preset_inputs = [coins[0], coins[1]]\n+\n+        # Now let's create the tx\n+        options = {\n+            \"inputs\": [\n+                {\n+                    \"txid\": preset_inputs[0][\"txid\"],\n+                    \"vout\": preset_inputs[0][\"vout\"]\n+                },\n+                {\n+                    \"txid\": preset_inputs[1][\"txid\"],\n+                    \"vout\": preset_inputs[1][\"vout\"]\n+                },\n+            ],\n+            \"add_inputs\": True,\n+            \"subtract_fee_from_outputs\": [0],\n+            \"add_to_wallet\": False\n+        }\n+\n+        # First case, use 'subtract_fee_from_outputs' to make the wallet create a tx that pays an insane fee on v24.0.\n+        # (further details in #26559).\n+        assert_raises_rpc_error(-4, \"Insufficient funds\", wallet.send, outputs=[{wallet.getnewaddress(address_type=\"bech32\"): 14}], options=options)\n+\n+        # Second case, don't use 'subtract_fee_from_outputs' to make the wallet crash due the insane fee on v24.0.\n+        # (further details in #26559).",
      "path": "test/functional/rpc_fundrawtransaction.py",
      "position": null,
      "original_position": 67,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "in_reply_to_id": null,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```suggestion\r\n        # Attempt to send 14 BTC. The wallet should exclude the preset inputs from the pool of\r\n        # available coins, realize that there is not enough money to fund the 14 BTC payment,\r\n        # and fail with \"insufficient funds.\"\r\n        # Even with SFFO, the wallet can only afford to send 10 BTC.\r\n\r\n        # If the wallet does not properly exclude preset inputs from the pool of available coins\r\n        # prior to coin selection, it may create a transaction that does not fund the full payment\r\n        # amount or, through SFFO, incorrectly reduce the payment amount so that payment+fee is not\r\n        # equal to 14 BTC.\r\n        assert_raises_rpc_error(-4, \"Insufficient funds\", wallet.send, outputs=[{wallet.getnewaddress(address_type=\"bech32\"): 14}], options=options)\r\n```",
      "created_at": "2022-12-01T17:53:14Z",
      "updated_at": "2022-12-01T17:58:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1037410889",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1037410889"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": 1254,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1259,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1037413633",
      "pull_request_review_id": 1201406725,
      "id": 1037413633,
      "node_id": "PRRC_kwDOABII58491a0B",
      "diff_hunk": "@@ -1200,6 +1201,67 @@ def test_add_inputs_default_value(self):\n \n         self.nodes[2].unloadwallet(\"test_preset_inputs\")\n \n+    def test_preset_inputs_selection_crash(self):\n+        self.log.info('Test wallet preset inputs selection')\n+\n+        # This exercises the bug presented in #26559 that\n+        # ended up on (1) a wallet crash or (2) a created and\n+        # broadcasted tx that pays an insane fee amount.\n+        #\n+        # This is covered by making the wallet selects the preset\n+        # inputs twice during the coin selection process (which\n+        # is a dangerous bug on v24.0).\n+        #\n+        # Making the wallet think that the selection process result covers\n+        # the entire tx target when it does not. It's actually creating\n+        # a tx that sends more coins than what inputs are covering for.\n+        #\n+        # Which, combined with the subtract fee from outputs option,\n+        # makes the wallet generate and broadcast a tx that pays\n+        # up to the sum of all the preset inputs, minus one, amounts in\n+        # fee :(.\n+\n+        # Create and fund the wallet with 2 UTXO of 5 BTC each\n+        self.nodes[2].createwallet(\"test_preset_inputs_selection\")\n+        wallet = self.nodes[2].get_wallet_rpc(\"test_preset_inputs_selection\")\n+        outputs = {}\n+        for _ in range(2):\n+            outputs[wallet.getnewaddress(address_type=\"bech32\")] = 5\n+        self.nodes[0].sendmany(\"\", outputs)\n+        self.generate(self.nodes[0], 1)\n+\n+        # Select the preset inputs\n+        coins = wallet.listunspent()\n+        preset_inputs = [coins[0], coins[1]]\n+\n+        # Now let's create the tx\n+        options = {\n+            \"inputs\": [\n+                {\n+                    \"txid\": preset_inputs[0][\"txid\"],\n+                    \"vout\": preset_inputs[0][\"vout\"]\n+                },\n+                {\n+                    \"txid\": preset_inputs[1][\"txid\"],\n+                    \"vout\": preset_inputs[1][\"vout\"]\n+                },\n+            ],\n+            \"add_inputs\": True,\n+            \"subtract_fee_from_outputs\": [0],\n+            \"add_to_wallet\": False\n+        }\n+\n+        # First case, use 'subtract_fee_from_outputs' to make the wallet create a tx that pays an insane fee on v24.0.\n+        # (further details in #26559).\n+        assert_raises_rpc_error(-4, \"Insufficient funds\", wallet.send, outputs=[{wallet.getnewaddress(address_type=\"bech32\"): 14}], options=options)",
      "path": "test/functional/rpc_fundrawtransaction.py",
      "position": null,
      "original_position": 64,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "in_reply_to_id": null,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "\r\nCherry-picking this test on top of 24.x, I can see that the wallet mistakenly uses a preset input twice and deducts the fee+5BTC from the payment, but the fee is actually exactly what is expected (since at the end the transaction only has 10BTC inputs and not 15): https://github.com/glozow/bitcoin/blob/test-n26560/test/functional/rpc_fundrawtransaction.py#L1250-L1266\r\n\r\n@achow101 suggested that maybe `nFeeRet` from `FundTransaction()` or  `CreatedTransactionResult::fee` could be incorrect but I wasn't able to get a test to show that. @achow101 then pointed me to this code showing the sffo fee should be correctly set before `CreateTransaction` returns:\r\nhttps://github.com/bitcoin/bitcoin/blob/f668a3a85933512e7efc369b5b2922d44b4bad82/src/wallet/spend.cpp#L971-L1004\r\n\r\nI could be mistaken, but in that case could you maybe write a test for v24.0 that shows what the expected vs actual fee are? Otherwise I'd suggest removing this from the comments/commit message/PR descriptions.\r\n\r\nHaving 2 test cases for sffo and non-sffo codepaths is still meaningful, but I think the current comment is misleading and can cause us to have trouble understanding this test in the future.",
      "created_at": "2022-12-01T17:56:16Z",
      "updated_at": "2022-12-01T17:58:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1037413633",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1037413633"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1256,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038265394",
      "pull_request_review_id": 1202683490,
      "id": 1038265394,
      "node_id": "PRRC_kwDOABII58494qwy",
      "diff_hunk": "@@ -980,5 +980,43 @@ BOOST_AUTO_TEST_CASE(SelectCoins_effective_value_test)\n     BOOST_CHECK(!result);\n }\n \n+BOOST_FIXTURE_TEST_CASE(wallet_coinsresult_test, BasicTestingSetup)\n+{\n+    // Test case to verify CoinsResult object sanity.\n+    CoinsResult available_coins;\n+    {\n+        std::unique_ptr<CWallet> dummyWallet = std::make_unique<CWallet>(m_node.chain.get(), \"dummy\", m_args, CreateMockWalletDatabase());\n+        BOOST_CHECK_EQUAL(dummyWallet->LoadWallet(), DBErrors::LOAD_OK);\n+        LOCK(dummyWallet->cs_wallet);\n+        dummyWallet->SetWalletFlag(WALLET_FLAG_DESCRIPTORS);\n+        dummyWallet->SetupDescriptorScriptPubKeyMans();\n+\n+        // Add some coins to 'available_coins'\n+        for (int i=0; i<10; i++) {\n+            add_coin(available_coins, *dummyWallet, 1 * COIN);\n+        }\n+    }\n+\n+    {\n+        // First test case, check that 'CoinsResult::Erase' function works as expected.\n+        // By trying to erase two elements from the 'available_coins' object.\n+        std::unordered_set<COutPoint, SaltedOutpointHasher> outs_to_remove;\n+        const auto& coins = available_coins.All();\n+        for (int i = 0; i < 2; i++) {\n+            outs_to_remove.emplace(coins[i].outpoint);\n+        }\n+        available_coins.Erase(outs_to_remove);",
      "path": "src/wallet/test/coinselector_tests.cpp",
      "position": 63,
      "original_position": 29,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "4ba93512768201402e2ff445b13a6dba666cd80b",
      "in_reply_to_id": 1036068985,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "sounds good",
      "created_at": "2022-12-02T15:35:36Z",
      "updated_at": "2022-12-02T15:35:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1038265394",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038265394"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1008,
      "original_line": 1008,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038266662",
      "pull_request_review_id": 1202685143,
      "id": 1038266662,
      "node_id": "PRRC_kwDOABII58494rEm",
      "diff_hunk": "@@ -1200,6 +1201,67 @@ def test_add_inputs_default_value(self):\n \n         self.nodes[2].unloadwallet(\"test_preset_inputs\")\n \n+    def test_preset_inputs_selection_crash(self):\n+        self.log.info('Test wallet preset inputs selection')\n+\n+        # This exercises the bug presented in #26559 that\n+        # ended up on (1) a wallet crash or (2) a created and\n+        # broadcasted tx that pays an insane fee amount.\n+        #\n+        # This is covered by making the wallet selects the preset\n+        # inputs twice during the coin selection process (which\n+        # is a dangerous bug on v24.0).\n+        #\n+        # Making the wallet think that the selection process result covers\n+        # the entire tx target when it does not. It's actually creating\n+        # a tx that sends more coins than what inputs are covering for.\n+        #\n+        # Which, combined with the subtract fee from outputs option,\n+        # makes the wallet generate and broadcast a tx that pays\n+        # up to the sum of all the preset inputs, minus one, amounts in\n+        # fee :(.\n+\n+        # Create and fund the wallet with 2 UTXO of 5 BTC each\n+        self.nodes[2].createwallet(\"test_preset_inputs_selection\")\n+        wallet = self.nodes[2].get_wallet_rpc(\"test_preset_inputs_selection\")\n+        outputs = {}\n+        for _ in range(2):\n+            outputs[wallet.getnewaddress(address_type=\"bech32\")] = 5\n+        self.nodes[0].sendmany(\"\", outputs)\n+        self.generate(self.nodes[0], 1)\n+\n+        # Select the preset inputs\n+        coins = wallet.listunspent()\n+        preset_inputs = [coins[0], coins[1]]\n+\n+        # Now let's create the tx\n+        options = {\n+            \"inputs\": [\n+                {\n+                    \"txid\": preset_inputs[0][\"txid\"],\n+                    \"vout\": preset_inputs[0][\"vout\"]\n+                },\n+                {\n+                    \"txid\": preset_inputs[1][\"txid\"],\n+                    \"vout\": preset_inputs[1][\"vout\"]\n+                },\n+            ],",
      "path": "test/functional/rpc_fundrawtransaction.py",
      "position": null,
      "original_position": 56,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "01d5cf9d1d65795edcd15efb0b2e7b8a22e0b778",
      "in_reply_to_id": 1036074023,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nop, you are right. I was doing this stuff manually at the beginning, can simplify it now. Thanks",
      "created_at": "2022-12-02T15:36:47Z",
      "updated_at": "2022-12-02T15:36:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1038266662",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038266662"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": 1239,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1248,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038307694",
      "pull_request_review_id": 1202746006,
      "id": 1038307694,
      "node_id": "PRRC_kwDOABII584941Fu",
      "diff_hunk": "@@ -452,12 +452,16 @@ void SelectionResult::AddInputs(const std::set<COutput>& inputs, bool subtract_f\n \n void SelectionResult::Merge(const SelectionResult& other)\n {\n+    // Obtain the expected selected inputs count after the merge (for now, duplicates are not allowed)\n+    const size_t expected_count = m_selected_inputs.size() + other.m_selected_inputs.size();\n+\n     m_target += other.m_target;\n     m_use_effective |= other.m_use_effective;\n     if (m_algo == SelectionAlgorithm::MANUAL) {\n         m_algo = other.m_algo;\n     }\n     util::insert(m_selected_inputs, other.m_selected_inputs);\n+    assert(m_selected_inputs.size() == expected_count);",
      "path": "src/wallet/coinselection.cpp",
      "position": 13,
      "original_position": 13,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "in_reply_to_id": 1036936363,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Of course we don't want to create a bad transaction, but an assert would cause the user's node to crash in case we have implemented it wrong. I think something better could be to add if(!Assume(...)) {return \"sorry, something went wrong and transaction creation failed. please report this bug...\";} which should stop the wallet from doing something horrible but also not crash.\r\n\r\nSure. I totally agree on using more `Assume` + user friendly error return messages than crashing the node with bare assertions.\r\n\r\nI do actually implemented the capability to return error messages from the Coin Selection process inside [#25806](https://github.com/bitcoin/bitcoin/pull/25806) -> 45bc10687f7b0131fd1c4575406b62f0608e2c01 few months ago (which is later used to return specific error messages instead of the current general \"Insufficient Funds\". Which is required to implement your suggestions as we currently don't have a way to return specific errors to the upper layers).\r\n\r\nSo, in short, could drop the last commit and open a follow-up PR moving forward with it, and more, for sure. But.. as I added the last commit by reviewers request, would be good to see if @S3RK is sync with this reasoning too (otherwise we would be going in circles).\r\nNote: Since, after the fix, this problem cannot realistically happen anymore, I'm fine to move either way.",
      "created_at": "2022-12-02T16:19:18Z",
      "updated_at": "2022-12-02T16:19:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1038307694",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038307694"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 464,
      "original_line": 464,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038319639",
      "pull_request_review_id": 1202763464,
      "id": 1038319639,
      "node_id": "PRRC_kwDOABII584944AX",
      "diff_hunk": "@@ -106,7 +106,13 @@ void CoinsResult::Erase(const std::unordered_set<COutPoint, SaltedOutpointHasher\n {\n     for (auto& [type, vec] : coins) {\n         auto remove_it = std::remove_if(vec.begin(), vec.end(), [&](const COutput& coin) {\n-            return coins_to_remove.count(coin.outpoint) == 1;\n+            // remove it if it's on the set\n+            if (coins_to_remove.count(coin.outpoint) == 0) return false;\n+\n+            // update cached amounts\n+            total_amount -= coin.txout.nValue;\n+            if (coin.HasEffectiveValue()) total_effective_amount = *total_effective_amount - coin.GetEffectiveValue();",
      "path": "src/wallet/spend.cpp",
      "position": 21,
      "original_position": 10,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "a45ecd64ba4f63cba8d5f623a9442d81ccf63ac4",
      "in_reply_to_id": 1036411064,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "yeah. As we only use `CoinsResult::Add` to append new coins: if we have the coin inside `CoinsResult`, and the coin has an effective value, then we must have `total_effective_amount`.",
      "created_at": "2022-12-02T16:32:11Z",
      "updated_at": "2022-12-02T16:32:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1038319639",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038319639"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 114,
      "original_line": 114,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038322763",
      "pull_request_review_id": 1202768141,
      "id": 1038322763,
      "node_id": "PRRC_kwDOABII584944xL",
      "diff_hunk": "@@ -112,5 +112,34 @@ BOOST_FIXTURE_TEST_CASE(FillInputToWeightTest, BasicTestingSetup)\n     // Note: We don't test the next boundary because of memory allocation constraints.\n }\n \n+BOOST_FIXTURE_TEST_CASE(wallet_duplicated_preset_inputs_test, TestChain100Setup)\n+{\n+    // Verify that the wallet's Coin Selection process does not include pre-selected inputs twice in a transaction.\n+    for (int i = 0; i < 2; i++) CreateAndProcessBlock({}, GetScriptForRawPubKey(coinbaseKey.GetPubKey()));\n+    auto wallet = CreateSyncedWallet(*m_node.chain, WITH_LOCK(Assert(m_node.chainman)->GetMutex(), return m_node.chainman->ActiveChain()), m_args, coinbaseKey);\n+\n+    LOCK(wallet->cs_wallet);\n+    auto available_coins = AvailableCoins(*wallet);\n+    std::vector<COutput> coins = available_coins.All();\n+    std::set<COutPoint> preset_inputs = {coins[0].outpoint, coins[1].outpoint};\n+\n+    // Now that all coins were locked except the two preset inputs, let's create a tx\n+    std::vector<CRecipient> recipients = {{GetScriptForDestination(*Assert(wallet->GetNewDestination(OutputType::BECH32, \"dummy\"))), 149 * COIN, /*fSubtractFeeFromAmount=*/true}};\n+    CCoinControl coin_control;\n+    coin_control.m_allow_other_inputs = true;\n+    for (const auto& outpoint : preset_inputs) {\n+        coin_control.Select(outpoint);\n+    }\n+\n+    // First case, use 'subtract_fee_from_outputs' to make the wallet create a tx that pays an insane fee on v24.0.",
      "path": "src/wallet/test/spend_tests.cpp",
      "position": null,
      "original_position": 23,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "01d5cf9d1d65795edcd15efb0b2e7b8a22e0b778",
      "in_reply_to_id": 1036387520,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "yeah ok, I used that term because the `nFeeRet` calculation prior to the SFFO process, can go insanely high based on the duplicated preset inputs, then we deduct it from the recipient's target.\r\nwill improve the documentation.",
      "created_at": "2022-12-02T16:35:53Z",
      "updated_at": "2022-12-02T16:35:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1038322763",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038322763"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 134,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038372600",
      "pull_request_review_id": 1202841958,
      "id": 1038372600,
      "node_id": "PRRC_kwDOABII58495E74",
      "diff_hunk": "@@ -47,12 +47,14 @@ struct CoinsResult {\n      * i.e., methods can work with individual OutputType vectors or on the entire object */\n     size_t Size() const;\n     void Clear();\n-    void Erase(std::set<COutPoint>& preset_coins);\n+    void Erase(const std::unordered_set<COutPoint, SaltedOutpointHasher>& coins_to_remove);\n     void Shuffle(FastRandomContext& rng_fast);\n     void Add(OutputType type, const COutput& out);\n \n-    /** Sum of all available coins */\n+    /** Sum of all available coins raw value */\n     CAmount total_amount{0};\n+    /** Sum of all available coins effective value (each output value minus fees required to spend it) */\n+    std::optional<CAmount> total_effective_amount{0};",
      "path": "src/wallet/spend.h",
      "position": 17,
      "original_position": 13,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "in_reply_to_id": 1036429162,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "done",
      "created_at": "2022-12-02T17:36:58Z",
      "updated_at": "2022-12-02T17:36:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1038372600",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038372600"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 61,
      "original_line": 61,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038372846",
      "pull_request_review_id": 1202842285,
      "id": 1038372846,
      "node_id": "PRRC_kwDOABII58495E_u",
      "diff_hunk": "@@ -112,5 +112,34 @@ BOOST_FIXTURE_TEST_CASE(FillInputToWeightTest, BasicTestingSetup)\n     // Note: We don't test the next boundary because of memory allocation constraints.\n }\n \n+BOOST_FIXTURE_TEST_CASE(wallet_duplicated_preset_inputs_test, TestChain100Setup)\n+{\n+    // Verify that the wallet's Coin Selection process does not include pre-selected inputs twice in a transaction.\n+    for (int i = 0; i < 2; i++) CreateAndProcessBlock({}, GetScriptForRawPubKey(coinbaseKey.GetPubKey()));\n+    auto wallet = CreateSyncedWallet(*m_node.chain, WITH_LOCK(Assert(m_node.chainman)->GetMutex(), return m_node.chainman->ActiveChain()), m_args, coinbaseKey);\n+\n+    LOCK(wallet->cs_wallet);\n+    auto available_coins = AvailableCoins(*wallet);\n+    std::vector<COutput> coins = available_coins.All();\n+    std::set<COutPoint> preset_inputs = {coins[0].outpoint, coins[1].outpoint};\n+\n+    // Now that all coins were locked except the two preset inputs, let's create a tx\n+    std::vector<CRecipient> recipients = {{GetScriptForDestination(*Assert(wallet->GetNewDestination(OutputType::BECH32, \"dummy\"))), 149 * COIN, /*fSubtractFeeFromAmount=*/true}};\n+    CCoinControl coin_control;\n+    coin_control.m_allow_other_inputs = true;\n+    for (const auto& outpoint : preset_inputs) {\n+        coin_control.Select(outpoint);\n+    }\n+\n+    // First case, use 'subtract_fee_from_outputs' to make the wallet create a tx that pays an insane fee on v24.0.",
      "path": "src/wallet/test/spend_tests.cpp",
      "position": null,
      "original_position": 23,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "in_reply_to_id": 1037315629,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "done",
      "created_at": "2022-12-02T17:37:15Z",
      "updated_at": "2022-12-02T17:37:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1038372846",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038372846"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 134,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038373086",
      "pull_request_review_id": 1202842629,
      "id": 1038373086,
      "node_id": "PRRC_kwDOABII58495FDe",
      "diff_hunk": "@@ -1200,6 +1201,67 @@ def test_add_inputs_default_value(self):\n \n         self.nodes[2].unloadwallet(\"test_preset_inputs\")\n \n+    def test_preset_inputs_selection_crash(self):\n+        self.log.info('Test wallet preset inputs selection')\n+\n+        # This exercises the bug presented in #26559 that\n+        # ended up on (1) a wallet crash or (2) a created and\n+        # broadcasted tx that pays an insane fee amount.\n+        #\n+        # This is covered by making the wallet selects the preset\n+        # inputs twice during the coin selection process (which\n+        # is a dangerous bug on v24.0).\n+        #\n+        # Making the wallet think that the selection process result covers\n+        # the entire tx target when it does not. It's actually creating\n+        # a tx that sends more coins than what inputs are covering for.\n+        #\n+        # Which, combined with the subtract fee from outputs option,\n+        # makes the wallet generate and broadcast a tx that pays\n+        # up to the sum of all the preset inputs, minus one, amounts in\n+        # fee :(.\n+\n+        # Create and fund the wallet with 2 UTXO of 5 BTC each",
      "path": "test/functional/rpc_fundrawtransaction.py",
      "position": null,
      "original_position": 32,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "in_reply_to_id": 1037410273,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "done",
      "created_at": "2022-12-02T17:37:33Z",
      "updated_at": "2022-12-02T17:37:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1038373086",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038373086"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": 1205,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1224,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038373248",
      "pull_request_review_id": 1202842848,
      "id": 1038373248,
      "node_id": "PRRC_kwDOABII58495FGA",
      "diff_hunk": "@@ -1200,6 +1201,67 @@ def test_add_inputs_default_value(self):\n \n         self.nodes[2].unloadwallet(\"test_preset_inputs\")\n \n+    def test_preset_inputs_selection_crash(self):\n+        self.log.info('Test wallet preset inputs selection')\n+\n+        # This exercises the bug presented in #26559 that\n+        # ended up on (1) a wallet crash or (2) a created and\n+        # broadcasted tx that pays an insane fee amount.\n+        #\n+        # This is covered by making the wallet selects the preset\n+        # inputs twice during the coin selection process (which\n+        # is a dangerous bug on v24.0).\n+        #\n+        # Making the wallet think that the selection process result covers\n+        # the entire tx target when it does not. It's actually creating\n+        # a tx that sends more coins than what inputs are covering for.\n+        #\n+        # Which, combined with the subtract fee from outputs option,\n+        # makes the wallet generate and broadcast a tx that pays\n+        # up to the sum of all the preset inputs, minus one, amounts in\n+        # fee :(.\n+\n+        # Create and fund the wallet with 2 UTXO of 5 BTC each\n+        self.nodes[2].createwallet(\"test_preset_inputs_selection\")\n+        wallet = self.nodes[2].get_wallet_rpc(\"test_preset_inputs_selection\")\n+        outputs = {}\n+        for _ in range(2):\n+            outputs[wallet.getnewaddress(address_type=\"bech32\")] = 5\n+        self.nodes[0].sendmany(\"\", outputs)\n+        self.generate(self.nodes[0], 1)\n+\n+        # Select the preset inputs\n+        coins = wallet.listunspent()\n+        preset_inputs = [coins[0], coins[1]]\n+\n+        # Now let's create the tx\n+        options = {\n+            \"inputs\": [\n+                {\n+                    \"txid\": preset_inputs[0][\"txid\"],\n+                    \"vout\": preset_inputs[0][\"vout\"]\n+                },\n+                {\n+                    \"txid\": preset_inputs[1][\"txid\"],\n+                    \"vout\": preset_inputs[1][\"vout\"]\n+                },\n+            ],\n+            \"add_inputs\": True,\n+            \"subtract_fee_from_outputs\": [0],\n+            \"add_to_wallet\": False\n+        }\n+\n+        # First case, use 'subtract_fee_from_outputs' to make the wallet create a tx that pays an insane fee on v24.0.\n+        # (further details in #26559).\n+        assert_raises_rpc_error(-4, \"Insufficient funds\", wallet.send, outputs=[{wallet.getnewaddress(address_type=\"bech32\"): 14}], options=options)\n+\n+        # Second case, don't use 'subtract_fee_from_outputs' to make the wallet crash due the insane fee on v24.0.\n+        # (further details in #26559).",
      "path": "test/functional/rpc_fundrawtransaction.py",
      "position": null,
      "original_position": 67,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "in_reply_to_id": 1037410889,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Updated, thanks",
      "created_at": "2022-12-02T17:37:43Z",
      "updated_at": "2022-12-02T17:37:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1038373248",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038373248"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": 1254,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1259,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038445723",
      "pull_request_review_id": 1202950392,
      "id": 1038445723,
      "node_id": "PRRC_kwDOABII58495Wyb",
      "diff_hunk": "@@ -1200,6 +1201,67 @@ def test_add_inputs_default_value(self):\n \n         self.nodes[2].unloadwallet(\"test_preset_inputs\")\n \n+    def test_preset_inputs_selection_crash(self):\n+        self.log.info('Test wallet preset inputs selection')\n+\n+        # This exercises the bug presented in #26559 that\n+        # ended up on (1) a wallet crash or (2) a created and\n+        # broadcasted tx that pays an insane fee amount.\n+        #\n+        # This is covered by making the wallet selects the preset\n+        # inputs twice during the coin selection process (which\n+        # is a dangerous bug on v24.0).\n+        #\n+        # Making the wallet think that the selection process result covers\n+        # the entire tx target when it does not. It's actually creating\n+        # a tx that sends more coins than what inputs are covering for.\n+        #\n+        # Which, combined with the subtract fee from outputs option,\n+        # makes the wallet generate and broadcast a tx that pays\n+        # up to the sum of all the preset inputs, minus one, amounts in\n+        # fee :(.\n+\n+        # Create and fund the wallet with 2 UTXO of 5 BTC each\n+        self.nodes[2].createwallet(\"test_preset_inputs_selection\")\n+        wallet = self.nodes[2].get_wallet_rpc(\"test_preset_inputs_selection\")\n+        outputs = {}\n+        for _ in range(2):\n+            outputs[wallet.getnewaddress(address_type=\"bech32\")] = 5\n+        self.nodes[0].sendmany(\"\", outputs)\n+        self.generate(self.nodes[0], 1)\n+\n+        # Select the preset inputs\n+        coins = wallet.listunspent()\n+        preset_inputs = [coins[0], coins[1]]\n+\n+        # Now let's create the tx\n+        options = {\n+            \"inputs\": [\n+                {\n+                    \"txid\": preset_inputs[0][\"txid\"],\n+                    \"vout\": preset_inputs[0][\"vout\"]\n+                },\n+                {\n+                    \"txid\": preset_inputs[1][\"txid\"],\n+                    \"vout\": preset_inputs[1][\"vout\"]\n+                },\n+            ],\n+            \"add_inputs\": True,\n+            \"subtract_fee_from_outputs\": [0],\n+            \"add_to_wallet\": False\n+        }\n+\n+        # First case, use 'subtract_fee_from_outputs' to make the wallet create a tx that pays an insane fee on v24.0.\n+        # (further details in #26559).",
      "path": "test/functional/rpc_fundrawtransaction.py",
      "position": null,
      "original_position": 63,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "in_reply_to_id": 1037319314,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Ok, done thanks. Ready for another review round.",
      "created_at": "2022-12-02T19:08:29Z",
      "updated_at": "2022-12-02T19:24:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1038445723",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038445723"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1255,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038451737",
      "pull_request_review_id": 1202964187,
      "id": 1038451737,
      "node_id": "PRRC_kwDOABII58495YQZ",
      "diff_hunk": "@@ -1200,6 +1201,67 @@ def test_add_inputs_default_value(self):\n \n         self.nodes[2].unloadwallet(\"test_preset_inputs\")\n \n+    def test_preset_inputs_selection_crash(self):\n+        self.log.info('Test wallet preset inputs selection')\n+\n+        # This exercises the bug presented in #26559 that\n+        # ended up on (1) a wallet crash or (2) a created and\n+        # broadcasted tx that pays an insane fee amount.\n+        #\n+        # This is covered by making the wallet selects the preset\n+        # inputs twice during the coin selection process (which\n+        # is a dangerous bug on v24.0).\n+        #\n+        # Making the wallet think that the selection process result covers\n+        # the entire tx target when it does not. It's actually creating\n+        # a tx that sends more coins than what inputs are covering for.\n+        #\n+        # Which, combined with the subtract fee from outputs option,\n+        # makes the wallet generate and broadcast a tx that pays\n+        # up to the sum of all the preset inputs, minus one, amounts in\n+        # fee :(.\n+\n+        # Create and fund the wallet with 2 UTXO of 5 BTC each\n+        self.nodes[2].createwallet(\"test_preset_inputs_selection\")\n+        wallet = self.nodes[2].get_wallet_rpc(\"test_preset_inputs_selection\")\n+        outputs = {}\n+        for _ in range(2):\n+            outputs[wallet.getnewaddress(address_type=\"bech32\")] = 5\n+        self.nodes[0].sendmany(\"\", outputs)\n+        self.generate(self.nodes[0], 1)\n+\n+        # Select the preset inputs\n+        coins = wallet.listunspent()\n+        preset_inputs = [coins[0], coins[1]]\n+\n+        # Now let's create the tx\n+        options = {\n+            \"inputs\": [\n+                {\n+                    \"txid\": preset_inputs[0][\"txid\"],\n+                    \"vout\": preset_inputs[0][\"vout\"]\n+                },\n+                {\n+                    \"txid\": preset_inputs[1][\"txid\"],\n+                    \"vout\": preset_inputs[1][\"vout\"]\n+                },\n+            ],\n+            \"add_inputs\": True,\n+            \"subtract_fee_from_outputs\": [0],\n+            \"add_to_wallet\": False\n+        }\n+\n+        # First case, use 'subtract_fee_from_outputs' to make the wallet create a tx that pays an insane fee on v24.0.\n+        # (further details in #26559).\n+        assert_raises_rpc_error(-4, \"Insufficient funds\", wallet.send, outputs=[{wallet.getnewaddress(address_type=\"bech32\"): 14}], options=options)",
      "path": "test/functional/rpc_fundrawtransaction.py",
      "position": null,
      "original_position": 64,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "in_reply_to_id": 1037413633,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done, updated per feedback. Thanks.\r\n\r\nSome context:\r\nThe \"insane fee\" label came from the `nFeeRet` calculation. Which, in case of this bug, sets a high value then is later deducted from the recipient's amount. Which.. as we spoke via dm, it's true that this is internal to the wallet only.. so the description should be something like \"double-counted preset inputs during Coin Selection incorrectly deduces the user's selected recipient's amount\" (or something similar)",
      "created_at": "2022-12-02T19:17:54Z",
      "updated_at": "2022-12-02T19:18:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1038451737",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038451737"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1256,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038455258",
      "pull_request_review_id": 1202967407,
      "id": 1038455258,
      "node_id": "PRRC_kwDOABII58495ZHa",
      "diff_hunk": "@@ -452,12 +452,16 @@ void SelectionResult::AddInputs(const std::set<COutput>& inputs, bool subtract_f\n \n void SelectionResult::Merge(const SelectionResult& other)\n {\n+    // Obtain the expected selected inputs count after the merge (for now, duplicates are not allowed)",
      "path": "src/wallet/coinselection.cpp",
      "position": 4,
      "original_position": 4,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "in_reply_to_id": 1036421300,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "this relies on https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1038307694 (where we are talking about whether should include the assertion commit here or in a follow-up PR).\r\nPlease, feel free to comment there.",
      "created_at": "2022-12-02T19:20:50Z",
      "updated_at": "2022-12-02T19:20:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1038455258",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038455258"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 455,
      "original_line": 455,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038529453",
      "pull_request_review_id": 1203077913,
      "id": 1038529453,
      "node_id": "PRRC_kwDOABII58495rOt",
      "diff_hunk": "@@ -452,12 +452,16 @@ void SelectionResult::AddInputs(const std::set<COutput>& inputs, bool subtract_f\n \n void SelectionResult::Merge(const SelectionResult& other)\n {\n+    // Obtain the expected selected inputs count after the merge (for now, duplicates are not allowed)\n+    const size_t expected_count = m_selected_inputs.size() + other.m_selected_inputs.size();\n+\n     m_target += other.m_target;\n     m_use_effective |= other.m_use_effective;\n     if (m_algo == SelectionAlgorithm::MANUAL) {\n         m_algo = other.m_algo;\n     }\n     util::insert(m_selected_inputs, other.m_selected_inputs);\n+    assert(m_selected_inputs.size() == expected_count);",
      "path": "src/wallet/coinselection.cpp",
      "position": 13,
      "original_position": 13,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "in_reply_to_id": 1036936363,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think it's find to change this to `Assume` for this PR. We should probably try to avoid asserts in general.",
      "created_at": "2022-12-02T21:01:13Z",
      "updated_at": "2022-12-02T21:01:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1038529453",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1038529453"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 464,
      "original_line": 464,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1039260388",
      "pull_request_review_id": 1204044729,
      "id": 1039260388,
      "node_id": "PRRC_kwDOABII58498drk",
      "diff_hunk": "@@ -452,12 +452,16 @@ void SelectionResult::AddInputs(const std::set<COutput>& inputs, bool subtract_f\n \n void SelectionResult::Merge(const SelectionResult& other)\n {\n+    // Obtain the expected selected inputs count after the merge (for now, duplicates are not allowed)\n+    const size_t expected_count = m_selected_inputs.size() + other.m_selected_inputs.size();\n+\n     m_target += other.m_target;\n     m_use_effective |= other.m_use_effective;\n     if (m_algo == SelectionAlgorithm::MANUAL) {\n         m_algo = other.m_algo;\n     }\n     util::insert(m_selected_inputs, other.m_selected_inputs);\n+    assert(m_selected_inputs.size() == expected_count);",
      "path": "src/wallet/coinselection.cpp",
      "position": 13,
      "original_position": 13,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "in_reply_to_id": 1036936363,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I'll be fine with any of the following: keep asserts as I proposed, replaced them with `Assume` for this PR, remove the commit and address this in a follow up. With that said, here's my strong opinion held lightly.\r\n\r\nIn the absence of ability of returning error messages from coin selection we have only two options. So the question is what is better within the scope of this PR:\r\na) crash the node if assert is hit\r\nb) keep executing and potentially creating bad transactions.\r\n\r\nBoth are bad, but a) is strictly better, because recovering from a crash is much easier than from a bad tx. Replacing `assert`s and returning error messages could/should done in a follow up.\r\n\r\nNow I agree that in general the wallet should not ever crash the node, but for this we need a general mechanism, something like multiprocess.\r\n\r\nAlso, my original suggestion included check within `AddInput()` and `AddInputs()`, as `SelectionResult` is not designed to work with duplicated inputs. This would make the class safe and its interface consistent.",
      "created_at": "2022-12-05T07:53:10Z",
      "updated_at": "2022-12-05T07:53:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1039260388",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1039260388"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 464,
      "original_line": 464,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1039352959",
      "pull_request_review_id": 1204183376,
      "id": 1039352959,
      "node_id": "PRRC_kwDOABII584980R_",
      "diff_hunk": "@@ -452,12 +452,16 @@ void SelectionResult::AddInputs(const std::set<COutput>& inputs, bool subtract_f\n \n void SelectionResult::Merge(const SelectionResult& other)\n {\n+    // Obtain the expected selected inputs count after the merge (for now, duplicates are not allowed)\n+    const size_t expected_count = m_selected_inputs.size() + other.m_selected_inputs.size();\n+\n     m_target += other.m_target;\n     m_use_effective |= other.m_use_effective;\n     if (m_algo == SelectionAlgorithm::MANUAL) {\n         m_algo = other.m_algo;\n     }\n     util::insert(m_selected_inputs, other.m_selected_inputs);\n+    assert(m_selected_inputs.size() == expected_count);",
      "path": "src/wallet/coinselection.cpp",
      "position": 13,
      "original_position": 13,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "in_reply_to_id": 1036936363,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Another alternative (not sure if applicable here) would be to throw an exception. This should only crash when running in the gui, but not when called from the RPC server.",
      "created_at": "2022-12-05T09:33:21Z",
      "updated_at": "2022-12-05T09:33:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1039352959",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1039352959"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 464,
      "original_line": 464,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1039380369",
      "pull_request_review_id": 1204227563,
      "id": 1039380369,
      "node_id": "PRRC_kwDOABII584986-R",
      "diff_hunk": "@@ -112,5 +112,34 @@ BOOST_FIXTURE_TEST_CASE(FillInputToWeightTest, BasicTestingSetup)\n     // Note: We don't test the next boundary because of memory allocation constraints.\n }\n \n+BOOST_FIXTURE_TEST_CASE(wallet_duplicated_preset_inputs_test, TestChain100Setup)\n+{\n+    // Verify that the wallet's Coin Selection process does not include pre-selected inputs twice in a transaction.\n+    for (int i = 0; i < 2; i++) CreateAndProcessBlock({}, GetScriptForRawPubKey(coinbaseKey.GetPubKey()));\n+    auto wallet = CreateSyncedWallet(*m_node.chain, WITH_LOCK(Assert(m_node.chainman)->GetMutex(), return m_node.chainman->ActiveChain()), m_args, coinbaseKey);\n+\n+    LOCK(wallet->cs_wallet);\n+    auto available_coins = AvailableCoins(*wallet);\n+    std::vector<COutput> coins = available_coins.All();\n+    std::set<COutPoint> preset_inputs = {coins[0].outpoint, coins[1].outpoint};\n+\n+    // Now that all coins were locked except the two preset inputs, let's create a tx\n+    std::vector<CRecipient> recipients = {{GetScriptForDestination(*Assert(wallet->GetNewDestination(OutputType::BECH32, \"dummy\"))), 149 * COIN, /*fSubtractFeeFromAmount=*/true}};\n+    CCoinControl coin_control;\n+    coin_control.m_allow_other_inputs = true;\n+    for (const auto& outpoint : preset_inputs) {\n+        coin_control.Select(outpoint);\n+    }\n+\n+    // First case, use 'subtract_fee_from_outputs' to make the wallet create a tx that pays an insane fee on v24.0.\n+    util::Result<CreatedTransactionResult> res_tx = CreateTransaction(*wallet, recipients, /*change_pos*/-1, coin_control);\n+    BOOST_CHECK(!res_tx.has_value());",
      "path": "src/wallet/test/spend_tests.cpp",
      "position": 41,
      "original_position": 25,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "01d5cf9d1d65795edcd15efb0b2e7b8a22e0b778",
      "in_reply_to_id": 1036388582,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Marking this as resolved - it now explains there are insufficient funds.",
      "created_at": "2022-12-05T09:59:14Z",
      "updated_at": "2022-12-05T11:10:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1039380369",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1039380369"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 152,
      "original_line": 152,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1039434239",
      "pull_request_review_id": 1204227563,
      "id": 1039434239,
      "node_id": "PRRC_kwDOABII58499IH_",
      "diff_hunk": "@@ -452,12 +452,16 @@ void SelectionResult::AddInputs(const std::set<COutput>& inputs, bool subtract_f\n \n void SelectionResult::Merge(const SelectionResult& other)\n {\n+    // Obtain the expected selected inputs count after the merge (for now, duplicates are not allowed)\n+    const size_t expected_count = m_selected_inputs.size() + other.m_selected_inputs.size();\n+\n     m_target += other.m_target;\n     m_use_effective |= other.m_use_effective;\n     if (m_algo == SelectionAlgorithm::MANUAL) {\n         m_algo = other.m_algo;\n     }\n     util::insert(m_selected_inputs, other.m_selected_inputs);\n+    assert(m_selected_inputs.size() == expected_count);",
      "path": "src/wallet/coinselection.cpp",
      "position": 13,
      "original_position": 13,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "in_reply_to_id": 1036936363,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Right, so the question of how to implement sanity checks warrants additional discussion and/or refactoring but that discussion shouldn't hold up this PR. Hence the recommendation to remove it.\r\n\r\nI disagree that it's harmless to have this assert after the fix; the bug can still exist or be reintroduced. But assuming these last few commits won't be backported and we'll have a followup PR to add/change sanity checks, fine with leaving it in this PR.",
      "created_at": "2022-12-05T10:46:59Z",
      "updated_at": "2022-12-05T11:10:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1039434239",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1039434239"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 464,
      "original_line": 464,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1039837111",
      "pull_request_review_id": 1204899567,
      "id": 1039837111,
      "node_id": "PRRC_kwDOABII5849-qe3",
      "diff_hunk": "@@ -452,12 +452,16 @@ void SelectionResult::AddInputs(const std::set<COutput>& inputs, bool subtract_f\n \n void SelectionResult::Merge(const SelectionResult& other)\n {\n+    // Obtain the expected selected inputs count after the merge (for now, duplicates are not allowed)\n+    const size_t expected_count = m_selected_inputs.size() + other.m_selected_inputs.size();\n+\n     m_target += other.m_target;\n     m_use_effective |= other.m_use_effective;\n     if (m_algo == SelectionAlgorithm::MANUAL) {\n         m_algo = other.m_algo;\n     }\n     util::insert(m_selected_inputs, other.m_selected_inputs);\n+    assert(m_selected_inputs.size() == expected_count);",
      "path": "src/wallet/coinselection.cpp",
      "position": 13,
      "original_position": 13,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "in_reply_to_id": 1036936363,
      "user": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It seems we all (mostly) agree that the `assert` is not ideal and how to deal with this should be addressed in a follow-up with more discussion, so I'd recommend dropping the commit so we don't merge code that we know will be removed/refactored shortly after and to avoid any confusion when backporting commits from this PR for v24",
      "created_at": "2022-12-05T16:45:25Z",
      "updated_at": "2022-12-05T16:53:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1039837111",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1039837111"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 464,
      "original_line": 464,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1040010250",
      "pull_request_review_id": 1205147731,
      "id": 1040010250,
      "node_id": "PRRC_kwDOABII5849_UwK",
      "diff_hunk": "@@ -452,12 +452,16 @@ void SelectionResult::AddInputs(const std::set<COutput>& inputs, bool subtract_f\n \n void SelectionResult::Merge(const SelectionResult& other)\n {\n+    // Obtain the expected selected inputs count after the merge (for now, duplicates are not allowed)\n+    const size_t expected_count = m_selected_inputs.size() + other.m_selected_inputs.size();\n+\n     m_target += other.m_target;\n     m_use_effective |= other.m_use_effective;\n     if (m_algo == SelectionAlgorithm::MANUAL) {\n         m_algo = other.m_algo;\n     }\n     util::insert(m_selected_inputs, other.m_selected_inputs);\n+    assert(m_selected_inputs.size() == expected_count);",
      "path": "src/wallet/coinselection.cpp",
      "position": 13,
      "original_position": 13,
      "commit_id": "7362f8e5e2497bc1ef27bfa871fc6dd306dd33c3",
      "original_commit_id": "eb76557331b4f34b568da1d9c589c7005d7ab46d",
      "in_reply_to_id": 1036936363,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "working on it ð . ",
      "created_at": "2022-12-05T19:40:01Z",
      "updated_at": "2022-12-05T19:40:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26560#discussion_r1040010250",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1040010250"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26560"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 464,
      "original_line": 464,
      "side": "RIGHT"
    }
  ]
}