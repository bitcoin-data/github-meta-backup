{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20849",
    "id": 548338549,
    "node_id": "MDExOlB1bGxSZXF1ZXN0NTQ4MzM4NTQ5",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/20849",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/20849.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/20849.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20849",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20849/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20849/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20849/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/98140bc855b037d2c552153496e8e4e2c2efdad9",
    "number": 20849,
    "state": "closed",
    "locked": true,
    "maintainer_can_modify": false,
    "title": "net: disconnect peers by address without using a subnet",
    "user": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Previously, when disconnecting a peer with a given address we would\r\ncreate a dummy subnet that contains just 1 address (/32 for IPv4 and\r\n/128 for IPv6) and would disconnect all peers that belong to this\r\nsubnet (there may be more than one connection, to a different port).\r\n\r\nThe problem is that for any non-IPv4 and non-IPv6 address we would\r\ncreate an invalid subnet which would later not match any addresses.\r\n\r\nThus, don't use a one-host-subnet, but compare the addresses directly.\r\nThis works for any type of addresses.\r\n\r\n<!--\r\n*** Please remove the following help text before submitting: ***\r\n\r\nPull requests without a rationale and clear improvement may be closed\r\nimmediately.\r\n\r\nGUI-related pull requests should be opened against\r\nhttps://github.com/bitcoin-core/gui\r\nfirst. See CONTRIBUTING.md\r\n-->\r\n\r\n<!--\r\nPlease provide clear motivation for your patch and explain how it improves\r\nBitcoin Core user experience or Bitcoin Core developer experience\r\nsignificantly:\r\n\r\n* Any test improvements or new tests that improve coverage are always welcome.\r\n* All other changes should have accompanying unit tests (see `src/test/`) or\r\n  functional tests (see `test/`). Contributors should note which tests cover\r\n  modified code. If no tests exist for a region of modified code, new tests\r\n  should accompany the change.\r\n* Bug fixes are most welcome when they come with steps to reproduce or an\r\n  explanation of the potential issue as well as reasoning for the way the bug\r\n  was fixed.\r\n* Features are welcome, but might be rejected due to design or scope issues.\r\n  If a feature is based on a lot of dependencies, contributors should first\r\n  consider building the system outside of Bitcoin Core, if possible.\r\n* Refactoring changes are only accepted if they are required for a feature or\r\n  bug fix or otherwise improve developer experience significantly. For example,\r\n  most \"code style\" refactoring changes require a thorough explanation why they\r\n  are useful, what downsides they have and why they *significantly* improve\r\n  developer experience or avoid serious programming bugs. Note that code style\r\n  is often a subjective matter. Unless they are explicitly mentioned to be\r\n  preferred in the [developer notes](/doc/developer-notes.md), stylistic code\r\n  changes are usually rejected.\r\n-->\r\n\r\n<!--\r\nBitcoin Core has a thorough review process and even the most trivial change\r\nneeds to pass a lot of eyes and requires non-zero or even substantial time\r\neffort to review. There is a huge lack of active reviewers on the project, so\r\npatches often sit for a long time.\r\n-->\r\n",
    "labels": [
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      }
    ],
    "milestone": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/45",
      "html_url": "https://github.com/bitcoin/bitcoin/milestone/45",
      "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/45/labels",
      "id": 4914019,
      "node_id": "MDk6TWlsZXN0b25lNDkxNDAxOQ==",
      "number": 45,
      "state": "closed",
      "title": "0.21.0",
      "description": "",
      "creator": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "open_issues": 0,
      "closed_issues": 132,
      "created_at": "2019-12-09T08:39:58Z",
      "updated_at": "2021-01-15T19:50:53Z",
      "closed_at": "2021-01-15T19:50:53Z"
    },
    "created_at": "2021-01-04T16:25:13Z",
    "updated_at": "2021-08-15T09:41:29Z",
    "closed_at": "2021-01-11T10:29:32Z",
    "mergeable_state": "unknown",
    "merge_commit_sha": "f2f75b96e519dc84fc707e9f24e13b03bf16b2d7",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "head": {
      "label": "vasild:disconnect_by_subnet_fix",
      "ref": "disconnect_by_subnet_fix",
      "sha": "98140bc855b037d2c552153496e8e4e2c2efdad9",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 120608826,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMjA2MDg4MjY=",
        "name": "bitcoin",
        "full_name": "vasild/bitcoin",
        "owner": {
          "login": "vasild",
          "id": 266751,
          "node_id": "MDQ6VXNlcjI2Njc1MQ==",
          "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/vasild",
          "html_url": "https://github.com/vasild",
          "followers_url": "https://api.github.com/users/vasild/followers",
          "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
          "organizations_url": "https://api.github.com/users/vasild/orgs",
          "repos_url": "https://api.github.com/users/vasild/repos",
          "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/vasild/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/vasild/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/vasild/bitcoin",
        "archive_url": "https://api.github.com/repos/vasild/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/vasild/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/vasild/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/vasild/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/vasild/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/vasild/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/vasild/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/vasild/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/vasild/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/vasild/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/vasild/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/vasild/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/vasild/bitcoin/events",
        "forks_url": "https://api.github.com/repos/vasild/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/vasild/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/vasild/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/vasild/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/vasild/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/vasild/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/vasild/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/vasild/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/vasild/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/vasild/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/vasild/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/vasild/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/vasild/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/vasild/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/vasild/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/vasild/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:vasild/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/vasild/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/vasild/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/vasild/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/vasild/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/vasild/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/vasild/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/vasild/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/vasild/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/vasild/bitcoin/hooks",
        "svn_url": "https://github.com/vasild/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 1,
        "stargazers_count": 3,
        "watchers_count": 3,
        "size": 211824,
        "default_branch": "master",
        "open_issues_count": 2,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-06T10:22:48Z",
        "created_at": "2018-02-07T11:52:47Z",
        "updated_at": "2023-01-31T16:56:52Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "bc8ada1c15345d14e324aee68488c8aa8a75cae0",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 34324,
        "stargazers_count": 69819,
        "watchers_count": 69819,
        "size": 233879,
        "default_branch": "master",
        "open_issues_count": 627,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-06T22:42:00Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-06-07T04:47:18Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20849"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 68,
    "deletions": 23,
    "changed_files": 2,
    "commits": 2,
    "review_comments": 5,
    "comments": 14
  },
  "events": [
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1ZmQyY2VlN2ZiYzM4YzY3N2QwOGExNTQ1NzcwMTU2Y2MwNjE4MzNl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5fd2cee7fbc38c677d08a1545770156cc061833e",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5fd2cee7fbc38c677d08a1545770156cc061833e",
      "tree": {
        "sha": "58cc6edfc7655386c689dda955ce7225c76463c7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/58cc6edfc7655386c689dda955ce7225c76463c7"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 58cc6edfc7655386c689dda955ce7225c76463c7\nparent bc8ada1c15345d14e324aee68488c8aa8a75cae0\nauthor Vasil Dimov <vd@FreeBSD.org> 1609775869 +0100\ncommitter Vasil Dimov <vd@FreeBSD.org> 1609777030 +0100\n\nnet: disconnect peers by address without using a subnet\n\nPreviously, when disconnecting a peer with a given address we would\ncreate a dummy subnet that contains just 1 address (/32 for IPv4 and\n/128 for IPv6) and would disconnect all peers that belong to this\nsubnet (there may be more than one connection, to a different port).\n\nThe problem is that for any non-IPv4 and non-IPv6 address we would\ncreate an invalid subnet which would later not match any addresses.\n\nThus, don't use a one-host-subnet, but compare the addresses directly.\nThis works for any type of addresses.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAl/zQRAACgkQVN8G9ktV\ny7/xBR/+N3gGh/30qzYDUpW9khsWq5f0CpLsO4YTYIpKeBGrbi6htW4PqfuhPPqz\n5/M5H5B9+JAD4+chajNWRnzF+cR88rW5vig0rUCIZzV3u16+50yF8UWnzBJJfVHO\n04nJIPyYb9PwdApRP980hVRqYvCbwOnl4Pk6h+OiTo5RhSucUXvYfHVyQ+NvXc2y\nN6HUFiYbh7pdlkRnitqPG/XY4LWHf8ZMDLCft7ps0e0YzleBA5XudbHrMdoLfNZL\nkFt47Y7Tfiuox9XvicVMRI98bDdGBVdNgYigJyyG29kp3dnhNEn7z4JBbAbvq4Mo\no0BDTEgtv+pVIlEHhXXeaezSqrl/9I1fwANX5bLnKbNQwZD41Pm5SDoMGut0hMv9\neR9udSf3bb3WSZtXfZxhMZrXREML2BH1lS4n0EntvhtrNC7HdZ4pjLUdg0PZdwLC\nhkXhdz0cHq7c6LIWIxw1kGm38B+pQ/PT813rIXsxLv8SYEPJfOfAo5WpgAh+GSjL\nvP5d2DgO4mohZAQTo2YDEQ9OTVp/cRlSiTfXvAWtNp2kxCxmgD2t3U9y18L3089k\nIW1sh8OJvxRgqAK5VV3mvcDWF+zkwfE3zLVZay194bgUpxJaJ5kCDUP8GliQbESI\nXgndfapoAZ1Ifz+vnuLAeE1Yw2/uy6Jur1HbnDCdr/1l9XcQd7btbfjyA6PjatJm\ngNwTXKOi0oBqEEjxM17Ol9+14Dtka9c3NDlYJhBsonvi3zp/hnzAOmzbqnLdDj9a\nQuoIFRX2KTdd1n45Dkjm+y3QhMpWamhq0aPzKYzR+5exg665aB/IaCDCxkwoUJ72\nkkRdXJQvHA1aWAAlPFAJPVHliOSqKGx9MKeQvm5p3NCi4tumeb1XehsHhF4/9W8z\nD6x+TNqWTYMjsUu4g1NJ4CrBL2Ytmd7dEWos1zLg+AYxgmwJb7PY2Cw5xc25opUE\nmOuywZkvzsuCl4D2rA9kuAIApF5yMMf23t3PopcAxC6R8vgl2633Gk0WxjSfJos9\nDZttJQQRHpNE/d2LRthab6HtqgOVzYq7gecpEWmpDLyFgIhhpMNk/zgk/X0c5kYl\nhxMdzMMbPXZO4mAodCOzZrZyuFjO5vXj99ZeisWks2U2yAQfnZJDJI5tSJcZiEeN\nK2xOJ7jCaSlLKG/2MvDbuADSbUWoMdFui6sHt+eL7oayViY7WMGSyXhyihYyoCjE\n09CfCzk/RD6sMEMc+lU4mVP8gSfrzu/SMsIkRYLb6HKksuyVNyQZGchW/NZP6N0R\nsoWnHCsPexU52GQo67GG7HnY9l8QRRdoX7JHrnERQwos4mM5+dTbRvW4yEyB27JK\nQamgVbTAI6+ZS0w7YpgtB10lIcyYOw==\n=kXK+\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bc8ada1c15345d14e324aee68488c8aa8a75cae0",
          "sha": "bc8ada1c15345d14e324aee68488c8aa8a75cae0",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/bc8ada1c15345d14e324aee68488c8aa8a75cae0"
        }
      ],
      "message": "net: disconnect peers by address without using a subnet\n\nPreviously, when disconnecting a peer with a given address we would\ncreate a dummy subnet that contains just 1 address (/32 for IPv4 and\n/128 for IPv6) and would disconnect all peers that belong to this\nsubnet (there may be more than one connection, to a different port).\n\nThe problem is that for any non-IPv4 and non-IPv6 address we would\ncreate an invalid subnet which would later not match any addresses.\n\nThus, don't use a one-host-subnet, but compare the addresses directly.\nThis works for any type of addresses.",
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2021-01-04T16:17:10Z"
      },
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2021-01-04T15:57:49Z"
      },
      "sha": "5fd2cee7fbc38c677d08a1545770156cc061833e"
    },
    {
      "event": "commented",
      "id": 754075051,
      "node_id": "MDEyOklzc3VlQ29tbWVudDc1NDA3NTA1MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/754075051",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-04T16:27:50Z",
      "updated_at": "2021-01-04T16:27:50Z",
      "author_association": "MEMBER",
      "body": "The problem was discovered by @MarcoFalke.",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20849#issuecomment-754075051",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20849"
    },
    {
      "event": "mentioned",
      "id": 4165718885,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDE2NTcxODg4NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4165718885",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-04T16:27:50Z"
    },
    {
      "event": "subscribed",
      "id": 4165718890,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQxNjU3MTg4OTA=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4165718890",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-04T16:27:50Z"
    },
    {
      "event": "milestoned",
      "id": 4165719407,
      "node_id": "MDE1Ok1pbGVzdG9uZWRFdmVudDQxNjU3MTk0MDc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4165719407",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-04T16:27:57Z",
      "milestone": {
        "title": "0.21.0"
      }
    },
    {
      "event": "labeled",
      "id": 4165720237,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDQxNjU3MjAyMzc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4165720237",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-04T16:28:10Z",
      "label": {
        "name": "Needs backport (0.21)",
        "color": "ff8200"
      }
    },
    {
      "event": "labeled",
      "id": 4165720238,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDQxNjU3MjAyMzg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4165720238",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-04T16:28:10Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    },
    {
      "event": "commented",
      "id": 754079617,
      "node_id": "MDEyOklzc3VlQ29tbWVudDc1NDA3OTYxNw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/754079617",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-04T16:35:58Z",
      "updated_at": "2021-01-04T16:35:58Z",
      "author_association": "MEMBER",
      "body": "tested-only ACK 5fd2cee7fbc38c677d08a1545770156cc061833e did not review the code 🔮\r\n\r\n<details><summary>Show signature and timestamp</summary>\r\n\r\nSignature:\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA512\r\n\r\ntested-only ACK 5fd2cee7fbc38c677d08a1545770156cc061833e did not review the code 🔮\r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\r\npUh/Sgv/W9d+TPMjSm+JqcwJBW7n3wmto0PDu+CvGkHSwHJaoLU7toj8W1y6Ohfz\r\nCDKRGq2ZG+VnxSbKRhItSeaWqleHfAJ0Ns1xZNbDudAw7/IrLMsvNd7+/apFgpUT\r\niM1ytrZMRRLqoPdRVgpzkamKMUyPTPzzXzGQoH6xdxSjMuKbJ69DVzg4d0DuAmH+\r\ny+ZP85yi7KDq5YvS25JUaOpZg4m9UnwTHctL1+hMeIWBtxlx3pFohExswbUC28xz\r\nytN4dWFxyQXC/t3i3fY3AiLiHZZ0frxHTd26sL/vqj935MWnH3SsIpIwm57kl1v2\r\nvHR7yakgWEcDF5qEQHa1+wYi1p26BgYQYjlPqYCM4fp+0MBg6lPpggthZkYVKTXI\r\nJg2mxdUl/kuFDA8Xy9u00uQj6BOWJfshBuClQkxf5184qTcMdQ6SwxagpfDGHEjn\r\nJDHbX+djj8+CfR6CVc3P7MWP1UxnuFI8NWiyMI6KrcEH3ESw16LmcrS3KOeLLI4Q\r\n5IVN+71Z\r\n=kXbR\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\n[Timestamp of file with hash `ffb08779a664f7e34db6952de6f0948d1fb8eeb7089b81525f9ffde67a8ac202  -`](https://opentimestamps.org/info/?004f70656e54696d657374616d7073000050726f6f6600bf89e2e884e892940108ffb08779a664f7e34db6952de6f0948d1fb8eeb7089b81525f9ffde67a8ac202f010ba914ef96fcd58dcf7ef97e69507f30f08fff01001ca557449cdd59ee8a489fa048bb29a08f1045ff343ccf0088c83c2e0c2202b560083dfe30d2ef90c8e232268747470733a2f2f6274632e63616c656e6461722e636174616c6c6178792e636f6dfff01004a917a47de2960e291f72db62a88de908f020750bb0dd61da48daa72731e0113a36703767a6b3fa7aedbd93d981a8f0b83d2008f020552fdc0c24dad87b2a713d4c04937ee0f5bbcd61bb355994634f12a8e8c28cdc08f1045ff343ccf00861a940fef48bc4080083dfe30d2ef90c8e2c2b68747470733a2f2f626f622e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267fff01016190e20a52f4e363ae04d98e1a52d8a08f020cd808e86f44edce43d5e8b4acfb96b5f61594caba830320a4d1be42eb59ebf1708f02022722abb7230b220a5da7037cd78b817045cf688c776916a9e38b955dc9a124608f02050b970d8126c0f5156e36ddb8b6f7d12297ee07c6860729af27d60d4df312ed908f1045ff343ccf0088f329964afa83b3d0083dfe30d2ef90c8e292868747470733a2f2f66696e6e65792e63616c656e6461722e657465726e69747977616c6c2e636f6df010dce13a9487c5c580d62df60b7705cc0d08f020b00c82767aafbe20855a385ea3e94bc9d48475c132a5000324b368a74520fba808f020ce0e21933b7b4cf9b6f557430dc02455a94ae6c0e85cee26ded22d0094a9dad408f1045ff343ccf00850484396068324400083dfe30d2ef90c8e2e2d68747470733a2f2f616c6963652e6274632e63616c656e6461722e6f70656e74696d657374616d70732e6f7267)\r\n\r\n</details>\r\n",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20849#issuecomment-754079617",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20849"
    },
    {
      "event": "referenced",
      "id": 4165764156,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDQxNjU3NjQxNTY=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4165764156",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "6f256c267b4628569ca0c52beff175e088e612a9",
      "commit_url": "https://api.github.com/repos/MarcoFalke/b-c/commits/6f256c267b4628569ca0c52beff175e088e612a9",
      "created_at": "2021-01-04T16:38:47Z"
    },
    {
      "event": "reviewed",
      "id": 561172578,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMTcyNTc4",
      "url": null,
      "actor": null,
      "commit_id": "5fd2cee7fbc38c677d08a1545770156cc061833e",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Code review ACK  5fd2cee7fbc38c677d08a1545770156cc061833e\r\n\r\nIt would be good to have a failing test case that this patch fixes, either unit tests or in the functional `rpc_setban` or `p2p_disconnect_ban` ones.",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20849#pullrequestreview-561172578",
      "submitted_at": "2021-01-04T16:40:36Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20849"
    },
    {
      "event": "commented",
      "id": 754122796,
      "node_id": "MDEyOklzc3VlQ29tbWVudDc1NDEyMjc5Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/754122796",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-04T17:57:25Z",
      "updated_at": "2021-01-04T17:57:25Z",
      "author_association": "MEMBER",
      "body": "https://github.com/bitcoin/bitcoin/pull/20852 contains a fix for this issue + it also fixes a similar issue in `BanMan`. If it is merged, then this can be closed without merge. They do not conflict in any way. Both can go in.",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20849#issuecomment-754122796",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20849"
    },
    {
      "event": "commented",
      "id": 754602325,
      "node_id": "MDEyOklzc3VlQ29tbWVudDc1NDYwMjMyNQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/754602325",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-05T12:20:36Z",
      "updated_at": "2021-01-05T12:20:36Z",
      "author_association": "MEMBER",
      "body": "Any tips how to test this manually? Disconnecting outbound onion peers with `disconnectnode` works for me on both master and this PR and in #20852.",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20849#issuecomment-754602325",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20849"
    },
    {
      "event": "commented",
      "id": 754740638,
      "node_id": "MDEyOklzc3VlQ29tbWVudDc1NDc0MDYzOA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/754740638",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-05T16:21:32Z",
      "updated_at": "2021-01-05T16:21:32Z",
      "author_association": "MEMBER",
      "body": "@jonatack yes, the `disconnectnode` RPC uses either `DisconnectNode(std::string)` or `DisconnectNode(NodeId)` and the problem is in `DisconnectNode(CNetAddr)`.\r\n\r\n`bitcoin-cli setban foo.onion add` will do the job.",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20849#issuecomment-754740638",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20849"
    },
    {
      "event": "mentioned",
      "id": 4170687048,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDE3MDY4NzA0OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4170687048",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-05T16:21:32Z"
    },
    {
      "event": "subscribed",
      "id": 4170687053,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQxNzA2ODcwNTM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4170687053",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-05T16:21:33Z"
    },
    {
      "event": "commented",
      "id": 754743895,
      "node_id": "MDEyOklzc3VlQ29tbWVudDc1NDc0Mzg5NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/754743895",
      "actor": {
        "login": "taurus228",
        "id": 45716417,
        "node_id": "MDQ6VXNlcjQ1NzE2NDE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/45716417?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/taurus228",
        "html_url": "https://github.com/taurus228",
        "followers_url": "https://api.github.com/users/taurus228/followers",
        "following_url": "https://api.github.com/users/taurus228/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/taurus228/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/taurus228/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/taurus228/subscriptions",
        "organizations_url": "https://api.github.com/users/taurus228/orgs",
        "repos_url": "https://api.github.com/users/taurus228/repos",
        "events_url": "https://api.github.com/users/taurus228/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/taurus228/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-05T16:26:58Z",
      "updated_at": "2021-01-05T17:00:20Z",
      "author_association": "NONE",
      "body": "вт, 5 янв. 2021 г. в 19:24, Vasil Dimov <notifications@github.com>:\n\n> @jonatack <https://github.com/jonatack> yes, the disconnectnode RPC uses\n> either DisconnectNode(std::string) or DisconnectNode(NodeId) and the\n> problem is in DisconnectNode(CNetAddr).\n>\n> bitcoin-cli setban foo.onion add will do the job.\n>\n> —\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/pull/20849#issuecomment-754740638>,\n> or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AK4ZHQKMTWFQ66BD3TC7WTLSYM4J7ANCNFSM4VTHTMFA>\n> .\n>\n-- \nNik\n",
      "user": {
        "login": "taurus228",
        "id": 45716417,
        "node_id": "MDQ6VXNlcjQ1NzE2NDE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/45716417?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/taurus228",
        "html_url": "https://github.com/taurus228",
        "followers_url": "https://api.github.com/users/taurus228/followers",
        "following_url": "https://api.github.com/users/taurus228/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/taurus228/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/taurus228/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/taurus228/subscriptions",
        "organizations_url": "https://api.github.com/users/taurus228/orgs",
        "repos_url": "https://api.github.com/users/taurus228/repos",
        "events_url": "https://api.github.com/users/taurus228/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/taurus228/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20849#issuecomment-754743895",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20849"
    },
    {
      "event": "mentioned",
      "id": 4170715903,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDE3MDcxNTkwMw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4170715903",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-05T16:26:58Z"
    },
    {
      "event": "subscribed",
      "id": 4170715906,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQxNzA3MTU5MDY=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4170715906",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-05T16:26:58Z"
    },
    {
      "event": "commented",
      "id": 754803214,
      "node_id": "MDEyOklzc3VlQ29tbWVudDc1NDgwMzIxNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/754803214",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-05T18:06:10Z",
      "updated_at": "2021-01-05T18:06:10Z",
      "author_association": "MEMBER",
      "body": "utACK 5fd2cee7fbc38c677d08a1545770156cc061833e\r\n\r\nLet's get this merged so the path forward for 0.21 is clear (we can still do #20852, but it's no longer critical then).",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20849#issuecomment-754803214",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20849"
    },
    {
      "event": "commented",
      "id": 755261977,
      "node_id": "MDEyOklzc3VlQ29tbWVudDc1NTI2MTk3Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/755261977",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-06T12:06:04Z",
      "updated_at": "2021-01-06T12:31:57Z",
      "author_association": "MEMBER",
      "body": "Adding logging to the code path and verified that `setban <onion> add` disconnects peers with this patch and fails to do so on master @ 68196a891056f, with both tor v2 and v3 peers.\r\n\r\nLogging added to master and to this patch:\r\n```diff\r\n@@ -2805,6 +2805,7 @@ bool CConnman::DisconnectNode(const CSubNet& subnet)\r\n     LOCK(cs_vNodes);\r\n     for (CNode* pnode : vNodes) {\r\n         if (subnet.Match(pnode->addr)) {\r\n+            LogPrintf(\"Disconnecting %s via subnet peer=%d address=%s network=%s\\n\",\r\n+                      pnode->ConnectionTypeAsString(), pnode->GetId(),\r\n+                      pnode->addr.ToString(), GetNetworkName(pnode->ConnectedThroughNetwork()));\r\n             pnode->fDisconnect = true;\r\n             disconnected = true;\r\n         }\r\n```\r\nLogging also added to this patch:\r\n```diff\r\n@@ -2818,6 +2819,7 @@ bool CConnman::DisconnectNode(const CNetAddr& addr)\r\n     LOCK(cs_vNodes);\r\n     for (CNode* pnode : vNodes) {\r\n         if (addr == pnode->addr) {\r\n+            LogPrintf(\"Disconnecting %s via addr peer=%d address=%s network=%s\\n\",\r\n+                      pnode->ConnectionTypeAsString(), pnode->GetId(),\r\n+                      pnode->addr.ToString(), GetNetworkName(pnode->ConnectedThroughNetwork()));\r\n             pnode->fDisconnect = true;\r\n             disconnected = true;\r\n         }\r\n```\r\n\r\nOn master, disconnection fails and nothing is logged. With this patch, the peer is immediately removed from the -netinfo 4 peers dashboard and the log shows:\r\n```\r\n2021-01-06T11:47:36Z Disconnecting manual via addr peer=5 address=TOR_V3_PEER network=onion\r\n2021-01-06T11:54:30Z Disconnecting manual via addr peer=25 address=TOR_V2_PEER network=onion\r\n2021-01-06T11:54:49Z Disconnecting outbound-full-relay via addr peer=16 address=TOR_V2_PEER:8333 network=onion\r\n```\r\n\r\nUpgrading to tested ACK 5fd2cee7fbc38c677d08a1545770156cc061833e",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20849#issuecomment-755261977",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20849"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5ODE0MGJjODU1YjAzN2QyYzU1MjE1MzQ5NmU4ZTRlMmMyZWZkYWQ5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/98140bc855b037d2c552153496e8e4e2c2efdad9",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/98140bc855b037d2c552153496e8e4e2c2efdad9",
      "tree": {
        "sha": "949742a54d00ea9e2be1293fd0ce79842a321492",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/949742a54d00ea9e2be1293fd0ce79842a321492"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 949742a54d00ea9e2be1293fd0ce79842a321492\nparent 5fd2cee7fbc38c677d08a1545770156cc061833e\nauthor Vasil Dimov <vd@FreeBSD.org> 1609942057 +0100\ncommitter Vasil Dimov <vd@FreeBSD.org> 1609944492 +0100\n\ntest: add test to ensure non-IP peers are properly misbehaved\n\nChange the `peer_discouragement` test to use `CNode` pointers so that\nthe nodes it uses can be added to `CConnman::vNodes` and cleaned up\nproperly. Make it use `CConnmanTest` instead of `CConnman`. This is\nneeded because we want to check `CNode::fDisconnect` and for this flag\nto be flipped by `CConnman::DisconnectNode()` the node must be in\n`CConnman::vNodes`.\n\nExtend the test with one torv3 peer and check that it is discouraged and\ndisconnected as expected.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAl/1zm8ACgkQVN8G9ktV\ny78VPCAAny6nM46U/nHWAZcrCZXOno+3HeCk+8A5c02Y2lVLyAat4UtIoTQtl6LT\n9oYPStH0p3KTlTwzPC5B0SYyaa2EdtS0/HZDtv1YvMJem09sUsSugZKAM5l1ogvN\nRT4Rsc3uDX2UL3/JWXggMhRTYt6ulai4TE8NbySPQbZpUMRi9kd+bEzAam5Y6pj6\nR3peuLKVFAgOPqBE6kvo0WjquLvoG8QWjYarKE/DeTtAK1jdVxwW5BjsHoVR0dvA\njcULzFJ8ZvJQsHVtN+k/nmIp4OuDAawB5Z5jkx1ikBVgOqAX2RcsfS7DLrd8lps8\nPzAfeh4uknxbE8AxfG5CctgbmWlCh+RPyxqUcpXGWc6jkMgX9TlpIqfsPMccMGUq\nBJXqYlh8Nj6C2iPfPRBe1AikuPIcIXIKC4J3JVc6Tw8r9D7BeLipIlE3wUoBsPhd\nryNLtO5+tvQVf+S3R61hk2yJlRmud02FrQa5hvFN0fFVQqxhDtsO3aj0torwraNH\nU69ud6muXUlxoR8HDTS2o2joGFK86Zh4gtE0xyd4kwBng6clRUI6urxiOCNGHNOe\nmjDGHLHWXkbW7Tf1xTOWuJXbfM6MMFcPhUF0m1r+YRt8LOShTdv5Qr4BCGoWv+1p\n6V/0J6jg+NPdkZpzcJKctu0R7gWNpeJ67uNVIDyDYeFs05TRBX26QwfJ2be5ZivV\ns7yL21NiM0uw++OY/vl+PJ20CmoGtxQE1Q0LSULR9GOkwOaeMp+0Y8cen9zsNInt\nqg/yj3BvHNbewazkCgKl9nYgmLkJjQYP+5PI3lcAyLinS1Nt/tg0KDRsVEK843Wg\n1WnWJchxL0Ofz80o5G3CLvthj0OHcihICqIqnmE6Zg/C6aN6n7DacInvxb+NRpBw\n/1CAOK/R9kpk6g9cgf7LLzm4yiCmlmBSVx+iqXXdA0KNiV6abpOKTngzbIFkgAzm\nABHVnw41OmgK0Fh26JefvNutnTODjqS7mLLT8NYVc8qYFxZ+uhuxeCjK4HKUD00e\njuABYXzpKAyU5QvU2V/NYK1x+lQmZM7T2wXAzevUs9C5EzyGegKKTQaAPqATbv1H\nnt9zKF6gaxpsVshjk5C0bgRyLdSWBVYe0BDcldwiBZAHlI6tVbrE9HYDpTiY6sWP\nUUl4umMgqwL0ACOtNk4VP5i4PGrj5ol2iVvve+6FV49P4/LODaJ5pf1QZmmfHC3p\nzwxy7r/iw42K/jXf5nF5PADzzpw+jOGGIx7XclBvRhcIUTwOk1oyHPjNPreZN1dD\nzVC+dZ//RXdAKW+flMYYgLMo7pdesUXl5ua4QXzmRBsrQelHAYPyX/Q/Q4u4DpT7\n9lbTdZh+Ifu3VoNH1zgmcC5LTnYkdw==\n=whOl\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5fd2cee7fbc38c677d08a1545770156cc061833e",
          "sha": "5fd2cee7fbc38c677d08a1545770156cc061833e",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5fd2cee7fbc38c677d08a1545770156cc061833e"
        }
      ],
      "message": "test: add test to ensure non-IP peers are properly misbehaved\n\nChange the `peer_discouragement` test to use `CNode` pointers so that\nthe nodes it uses can be added to `CConnman::vNodes` and cleaned up\nproperly. Make it use `CConnmanTest` instead of `CConnman`. This is\nneeded because we want to check `CNode::fDisconnect` and for this flag\nto be flipped by `CConnman::DisconnectNode()` the node must be in\n`CConnman::vNodes`.\n\nExtend the test with one torv3 peer and check that it is discouraged and\ndisconnected as expected.",
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2021-01-06T14:48:12Z"
      },
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2021-01-06T14:07:37Z"
      },
      "sha": "98140bc855b037d2c552153496e8e4e2c2efdad9"
    },
    {
      "event": "commented",
      "id": 755345783,
      "node_id": "MDEyOklzc3VlQ29tbWVudDc1NTM0NTc4Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/755345783",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-06T14:55:17Z",
      "updated_at": "2021-01-06T14:55:17Z",
      "author_association": "MEMBER",
      "body": "Appended an extra commit with unit test that fails on `master` and passes on this PR.\r\n\r\nIf it does not get re-ACKs or if it turns out to be problematic I will remove it, restoring the already ACK'ed commit id.",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20849#issuecomment-755345783",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20849"
    },
    {
      "event": "commented",
      "id": 755369515,
      "node_id": "MDEyOklzc3VlQ29tbWVudDc1NTM2OTUxNQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/755369515",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-06T15:33:21Z",
      "updated_at": "2021-01-06T15:33:21Z",
      "author_association": "MEMBER",
      "body": "Nice, will review asap.",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20849#issuecomment-755369515",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20849"
    },
    {
      "event": "commented",
      "id": 755526834,
      "node_id": "MDEyOklzc3VlQ29tbWVudDc1NTUyNjgzNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/755526834",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-06T19:03:27Z",
      "updated_at": "2021-01-10T15:01:08Z",
      "author_association": "MEMBER",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20811 (refactor: move net_processing implementation details out of header by ajtowns)\n* #20228 (addrman: Make addrman a top-level component by jnewbery)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20849#issuecomment-755526834",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20849"
    },
    {
      "event": "reviewed",
      "id": 563001548,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzMDAxNTQ4",
      "url": null,
      "actor": null,
      "commit_id": "98140bc855b037d2c552153496e8e4e2c2efdad9",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK 98140bc855b037d2c552153496e8e4e2c2efdad9 code review, manual testing with `setban OUTBOUND_ONION add`, and verified the new test fails on master on the non-IP Tor v3 peer disconnection assertion.",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20849#pullrequestreview-563001548",
      "submitted_at": "2021-01-06T20:36:29Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20849"
    },
    {
      "event": "reviewed",
      "id": 563546566,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzNTQ2NTY2",
      "url": null,
      "actor": null,
      "commit_id": "98140bc855b037d2c552153496e8e4e2c2efdad9",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20849#pullrequestreview-563546566",
      "submitted_at": "2021-01-07T14:49:46Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20849"
    },
    {
      "event": "commented",
      "id": 756667568,
      "node_id": "MDEyOklzc3VlQ29tbWVudDc1NjY2NzU2OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/756667568",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-08T10:05:18Z",
      "updated_at": "2021-01-08T10:05:18Z",
      "author_association": "MEMBER",
      "body": "Just to elaborate on the relationship between https://github.com/bitcoin/bitcoin/pull/20849 and https://github.com/bitcoin/bitcoin/pull/20852:\r\n\r\nThe problem in `master` is that `CSubNet(foo.onion)` creates an invalid subnet which later does not match any address, not even `foo.onion`. In two places in the code we expect that once we create such subnet later it will match `foo.onion`: in `CConnman::DisconnectNode()` and in `BanMan`.\r\n\r\nhttps://github.com/bitcoin/bitcoin/pull/20849 fixes `DisconnectNode()` by changing it to not use subnets at all (small isolated change, easy to verify it is correct).\r\n\r\nhttps://github.com/bitcoin/bitcoin/pull/20852 changes `CSubNet` to follow the above expected behavior, thus fixing both `DisconnectNode()` and `BanMan` (bigger change, harder to verify it is correct, caused unexpected CI failure (fixed)).\r\n\r\n**About the release, maybe the following makes sense:**\r\n\r\nInclude https://github.com/bitcoin/bitcoin/pull/20849 in the next rc and in the `0.21.0` release.\r\n\r\nLater, if https://github.com/bitcoin/bitcoin/pull/20852 is merged (ever) there is no need to revert https://github.com/bitcoin/bitcoin/pull/20849.\r\n",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20849#issuecomment-756667568",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20849"
    },
    {
      "event": "commented",
      "id": 757852730,
      "node_id": "MDEyOklzc3VlQ29tbWVudDc1Nzg1MjczMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/757852730",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-11T10:15:39Z",
      "updated_at": "2021-01-11T10:15:39Z",
      "author_association": "MEMBER",
      "body": "It might be better to wait for #20852 (0.21.1), after which this is not needed.",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20849#issuecomment-757852730",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20849"
    },
    {
      "event": "closed",
      "id": 4190003186,
      "node_id": "MDExOkNsb3NlZEV2ZW50NDE5MDAwMzE4Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4190003186",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-11T10:29:32Z"
    },
    {
      "event": "reviewed",
      "id": 565317267,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY1MzE3MjY3",
      "url": null,
      "actor": null,
      "commit_id": "98140bc855b037d2c552153496e8e4e2c2efdad9",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Concept ACK on adding the test. Mind to open a new pull for this?",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20849#pullrequestreview-565317267",
      "submitted_at": "2021-01-11T12:43:29Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20849"
    },
    {
      "event": "head_ref_deleted",
      "id": 4190631371,
      "node_id": "MDE5OkhlYWRSZWZEZWxldGVkRXZlbnQ0MTkwNjMxMzcx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4190631371",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-11T12:52:32Z"
    },
    {
      "event": "commented",
      "id": 758074471,
      "node_id": "MDEyOklzc3VlQ29tbWVudDc1ODA3NDQ3MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/758074471",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-11T16:39:20Z",
      "updated_at": "2021-01-11T16:39:20Z",
      "author_association": "MEMBER",
      "body": "The test is included in https://github.com/bitcoin/bitcoin/pull/20904.",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20849#issuecomment-758074471",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20849"
    },
    {
      "event": "unlabeled",
      "id": 4453597593,
      "node_id": "MDE0OlVubGFiZWxlZEV2ZW50NDQ1MzU5NzU5Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4453597593",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-03-13T08:20:53Z",
      "label": {
        "name": "Needs backport (0.21)",
        "color": "ff8200"
      }
    },
    {
      "event": "comment_deleted",
      "id": 5159482889,
      "node_id": "MDE5OkNvbW1lbnREZWxldGVkRXZlbnQ1MTU5NDgyODg5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5159482889",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-08-15T08:27:37Z"
    },
    {
      "event": "locked",
      "id": 5159543850,
      "node_id": "MDExOkxvY2tlZEV2ZW50NTE1OTU0Mzg1MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5159543850",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-08-15T09:41:29Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/552933686",
      "pull_request_review_id": 563001548,
      "id": 552933686,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjkzMzY4Ng==",
      "diff_hunk": "@@ -223,47 +223,84 @@ BOOST_AUTO_TEST_CASE(peer_discouragement)\n {\n     const CChainParams& chainparams = Params();\n     auto banman = MakeUnique<BanMan>(GetDataDir() / \"banlist.dat\", nullptr, DEFAULT_MISBEHAVING_BANTIME);\n-    auto connman = MakeUnique<CConnman>(0x1337, 0x1337);\n+    auto connman = MakeUnique<CConnmanTest>(0x1337, 0x1337);\n     auto peerLogic = std::make_unique<PeerManager>(chainparams, *connman, banman.get(), *m_node.scheduler,\n                                                    *m_node.chainman, *m_node.mempool, false);\n \n+    std::vector<CNode*> nodes(3);\n+\n     banman->ClearBanned();\n     CAddress addr1(ip(0xa0b0c001), NODE_NONE);\n-    CNode dummyNode1(id++, NODE_NETWORK, INVALID_SOCKET, addr1, 0, 0, CAddress(), \"\", ConnectionType::INBOUND);\n-    dummyNode1.SetCommonVersion(PROTOCOL_VERSION);\n-    peerLogic->InitializeNode(&dummyNode1);\n-    dummyNode1.fSuccessfullyConnected = true;\n-    peerLogic->Misbehaving(dummyNode1.GetId(), DISCOURAGEMENT_THRESHOLD, /* message */ \"\"); // Should be discouraged\n+    nodes[0] = new CNode(id++, NODE_NETWORK, INVALID_SOCKET, addr1, 0, 0, CAddress(), \"\", ConnectionType::INBOUND);\n+    nodes[0]->SetCommonVersion(PROTOCOL_VERSION);\n+    peerLogic->InitializeNode(nodes[0]);\n+    nodes[0]->fSuccessfullyConnected = true;\n+    connman->AddNode(*nodes[0]);\n+    peerLogic->Misbehaving(nodes[0]->GetId(), DISCOURAGEMENT_THRESHOLD, /* message */ \"\"); // Should be discouraged\n     {\n-        LOCK(dummyNode1.cs_sendProcessing);\n-        BOOST_CHECK(peerLogic->SendMessages(&dummyNode1));\n+        LOCK(nodes[0]->cs_sendProcessing);\n+        BOOST_CHECK(peerLogic->SendMessages(nodes[0]));\n     }\n     BOOST_CHECK(banman->IsDiscouraged(addr1));\n+    BOOST_CHECK(nodes[0]->fDisconnect);\n     BOOST_CHECK(!banman->IsDiscouraged(ip(0xa0b0c001|0x0000ff00))); // Different IP, not discouraged\n \n     CAddress addr2(ip(0xa0b0c002), NODE_NONE);\n-    CNode dummyNode2(id++, NODE_NETWORK, INVALID_SOCKET, addr2, 1, 1, CAddress(), \"\", ConnectionType::INBOUND);\n-    dummyNode2.SetCommonVersion(PROTOCOL_VERSION);\n-    peerLogic->InitializeNode(&dummyNode2);\n-    dummyNode2.fSuccessfullyConnected = true;\n-    peerLogic->Misbehaving(dummyNode2.GetId(), DISCOURAGEMENT_THRESHOLD - 1, /* message */ \"\");\n+    nodes[1] = new CNode(id++, NODE_NETWORK, INVALID_SOCKET, addr2, 1, 1, CAddress(), \"\", ConnectionType::INBOUND);\n+    nodes[1]->SetCommonVersion(PROTOCOL_VERSION);\n+    peerLogic->InitializeNode(nodes[1]);\n+    nodes[1]->fSuccessfullyConnected = true;\n+    connman->AddNode(*nodes[1]);\n+    peerLogic->Misbehaving(nodes[1]->GetId(), DISCOURAGEMENT_THRESHOLD - 1, /* message */ \"\");\n     {\n-        LOCK(dummyNode2.cs_sendProcessing);\n-        BOOST_CHECK(peerLogic->SendMessages(&dummyNode2));\n+        LOCK(nodes[1]->cs_sendProcessing);\n+        BOOST_CHECK(peerLogic->SendMessages(nodes[1]));\n     }\n     BOOST_CHECK(!banman->IsDiscouraged(addr2)); // 2 not discouraged yet...\n+    BOOST_CHECK(!nodes[1]->fDisconnect);\n     BOOST_CHECK(banman->IsDiscouraged(addr1));  // ... but 1 still should be\n-    peerLogic->Misbehaving(dummyNode2.GetId(), 1, /* message */ \"\");         // 2 reaches discouragement threshold\n+    BOOST_CHECK(nodes[0]->fDisconnect);\n+    peerLogic->Misbehaving(nodes[1]->GetId(), 1, /* message */ \"\");         // 2 reaches discouragement threshold\n+    {\n+        LOCK(nodes[1]->cs_sendProcessing);\n+        BOOST_CHECK(peerLogic->SendMessages(nodes[1]));\n+    }\n+    // Expect both 1 and 2 to be discouraged now.\n+    BOOST_CHECK(banman->IsDiscouraged(addr1));\n+    BOOST_CHECK(nodes[0]->fDisconnect);\n+    BOOST_CHECK(banman->IsDiscouraged(addr2));\n+    BOOST_CHECK(nodes[1]->fDisconnect);\n+\n+    // Make sure non-IP peers get discouraged and disconnected properly.\n+\n+    CNetAddr tor_netaddr;\n+    BOOST_REQUIRE(\n+        tor_netaddr.SetSpecial(\"pg6mmjiyjmcrsslvykfwnntlaru7p5svn6y2ymmju6nubxndf4pscryd.onion\"));\n+\n+    const CAddress addr3(CService(tor_netaddr, Params().GetDefaultPort()), NODE_NONE);\n+    nodes[2] = new CNode(id++, NODE_NETWORK, INVALID_SOCKET, addr3, 1, 1, CAddress(), \"\",\n+                         ConnectionType::OUTBOUND_FULL_RELAY);\n+    nodes[2]->SetCommonVersion(PROTOCOL_VERSION);\n+    peerLogic->InitializeNode(nodes[2]);\n+    connman->AddNode(*nodes[2]);\n+    nodes[2]->fSuccessfullyConnected = true;\n+    peerLogic->Misbehaving(nodes[2]->GetId(), DISCOURAGEMENT_THRESHOLD, /* message */ \"\");\n     {\n-        LOCK(dummyNode2.cs_sendProcessing);\n-        BOOST_CHECK(peerLogic->SendMessages(&dummyNode2));\n+        LOCK(nodes[2]->cs_sendProcessing);\n+        BOOST_CHECK(peerLogic->SendMessages(nodes[2]));\n+    }\n+    BOOST_CHECK(banman->IsDiscouraged(addr1));\n+    BOOST_CHECK(banman->IsDiscouraged(addr2));\n+    BOOST_CHECK(banman->IsDiscouraged(addr3));\n+    for (CNode* node : nodes) {\n+        BOOST_CHECK(node->fDisconnect);",
      "path": "src/test/denialofservice_tests.cpp",
      "position": 92,
      "original_position": 92,
      "commit_id": "98140bc855b037d2c552153496e8e4e2c2efdad9",
      "original_commit_id": "98140bc855b037d2c552153496e8e4e2c2efdad9",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The new test code fails at the right place on master\r\n```\r\ntest/denialofservice_tests.cpp(292): info: check banman->IsDiscouraged(addr1) has passed\r\ntest/denialofservice_tests.cpp(293): info: check banman->IsDiscouraged(addr2) has passed\r\ntest/denialofservice_tests.cpp(294): info: check banman->IsDiscouraged(addr3) has passed\r\ntest/denialofservice_tests.cpp(296): info: check node->fDisconnect has passed\r\ntest/denialofservice_tests.cpp(296): info: check node->fDisconnect has passed\r\ntest/denialofservice_tests.cpp(296): error: in \"denialofservice_tests/peer_discouragement\": check node->fDisconnect has failed\r\ntest/denialofservice_tests.cpp(222): Leaving test case \"peer_discouragement\"; testing time: 32905us\r\n```\r\n\r\nnit, maybe not worth it for tests, could use `nodes.at()` notation for bounds checking instead of `nodes[]`",
      "created_at": "2021-01-06T19:58:35Z",
      "updated_at": "2021-01-06T23:19:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20849#discussion_r552933686",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/552933686"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20849"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 296,
      "original_line": 296,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/553374275",
      "pull_request_review_id": 563546566,
      "id": 553374275,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzM3NDI3NQ==",
      "diff_hunk": "@@ -2814,7 +2814,15 @@ bool CConnman::DisconnectNode(const CSubNet& subnet)\n \n bool CConnman::DisconnectNode(const CNetAddr& addr)\n {\n-    return DisconnectNode(CSubNet(addr));\n+    bool disconnected = false;",
      "path": "src/net.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "98140bc855b037d2c552153496e8e4e2c2efdad9",
      "original_commit_id": "98140bc855b037d2c552153496e8e4e2c2efdad9",
      "in_reply_to_id": null,
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Is this change still needed with #20852? It seems to me that makes the old, much more compact, construction work?",
      "created_at": "2021-01-07T14:49:46Z",
      "updated_at": "2021-01-07T14:50:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20849#discussion_r553374275",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/553374275"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20849"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2817,
      "original_line": 2817,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/553388972",
      "pull_request_review_id": 563566447,
      "id": 553388972,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzM4ODk3Mg==",
      "diff_hunk": "@@ -2814,7 +2814,15 @@ bool CConnman::DisconnectNode(const CSubNet& subnet)\n \n bool CConnman::DisconnectNode(const CNetAddr& addr)\n {\n-    return DisconnectNode(CSubNet(addr));\n+    bool disconnected = false;",
      "path": "src/net.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "98140bc855b037d2c552153496e8e4e2c2efdad9",
      "original_commit_id": "98140bc855b037d2c552153496e8e4e2c2efdad9",
      "in_reply_to_id": 553374275,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "No, if #20852 is merged, then this PR is not needed, see https://github.com/bitcoin/bitcoin/pull/20849#issuecomment-754122796.\r\n\r\nI first opened this PR to fix `DisconnectNode()` and then realized that the same problem exists in `BanMan`, thus opened #20852 which fixes both by modifying `CSubNet`.\r\n\r\nMaybe this PR could be preferred as less risky compared to #20852. It is ok if this is merged first and later #20852 is also merged - they do not conflict and both go in `master`.",
      "created_at": "2021-01-07T15:13:12Z",
      "updated_at": "2021-01-07T15:13:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20849#discussion_r553388972",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/553388972"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20849"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2817,
      "original_line": 2817,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555019312",
      "pull_request_review_id": 565317267,
      "id": 555019312,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTAxOTMxMg==",
      "diff_hunk": "@@ -223,47 +223,84 @@ BOOST_AUTO_TEST_CASE(peer_discouragement)\n {\n     const CChainParams& chainparams = Params();\n     auto banman = MakeUnique<BanMan>(GetDataDir() / \"banlist.dat\", nullptr, DEFAULT_MISBEHAVING_BANTIME);\n-    auto connman = MakeUnique<CConnman>(0x1337, 0x1337);\n+    auto connman = MakeUnique<CConnmanTest>(0x1337, 0x1337);",
      "path": "src/test/denialofservice_tests.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "98140bc855b037d2c552153496e8e4e2c2efdad9",
      "original_commit_id": "98140bc855b037d2c552153496e8e4e2c2efdad9",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "std::make_unique for new code?\r\n\r\nAlso, could split the refactoring changes from the new-test changes?",
      "created_at": "2021-01-11T12:40:42Z",
      "updated_at": "2021-01-11T12:43:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20849#discussion_r555019312",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555019312"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20849"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 226,
      "original_line": 226,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555021056",
      "pull_request_review_id": 565319584,
      "id": 555021056,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTAyMTA1Ng==",
      "diff_hunk": "@@ -223,47 +223,84 @@ BOOST_AUTO_TEST_CASE(peer_discouragement)\n {\n     const CChainParams& chainparams = Params();\n     auto banman = MakeUnique<BanMan>(GetDataDir() / \"banlist.dat\", nullptr, DEFAULT_MISBEHAVING_BANTIME);\n-    auto connman = MakeUnique<CConnman>(0x1337, 0x1337);\n+    auto connman = MakeUnique<CConnmanTest>(0x1337, 0x1337);",
      "path": "src/test/denialofservice_tests.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "98140bc855b037d2c552153496e8e4e2c2efdad9",
      "original_commit_id": "98140bc855b037d2c552153496e8e4e2c2efdad9",
      "in_reply_to_id": 555019312,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Nvm, forget the std::make_unique suggestion. We want to backport the test changes.",
      "created_at": "2021-01-11T12:44:07Z",
      "updated_at": "2021-01-11T12:44:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/20849#discussion_r555021056",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/555021056"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20849"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 226,
      "original_line": 226,
      "side": "RIGHT"
    }
  ]
}