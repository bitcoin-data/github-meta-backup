{
  "type": "issue",
  "issue": {
    "id": 274152816,
    "node_id": "MDU6SXNzdWUyNzQxNTI4MTY=",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11693",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11693/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11693/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11693/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/11693",
    "number": 11693,
    "state": "closed",
    "state_reason": "completed",
    "title": "Signing raw transaction that has p2sh-p2wsh input",
    "body": "### Description:\r\nI am trying to sign an input that was sent to a p2sh-p2wsh address, but signrawtransaction RPC method returns an error stating = Witness program was passed an empty witness.\r\nAll the data can be seen through pastebin \r\n\r\n\r\n### Reproduction\r\nReproducible by following these actions (note that wallet does NOT know anything about address/private keys used):\r\nRelated address info (2of2 P2SH-P2WSH address): https://pastebin.com/TE1LrR44\r\n\r\n1) Raw transaction request/response:\r\nhttps://pastebin.com/r6HdMwsy\r\n\r\n2) SignRaw transaction request/response:\r\n1. - https://pastebin.com/2apuckBk\r\n2. - https://pastebin.com/SsszYS2w\r\n\r\n### Expected behavior\r\nI'd expect for it to sign a transaction just as if spendable input was inside wallet. Which I tested works just fine. I imported the address using import priv key->add multisig address->addwitnessaddress\r\nthen created a deposit to it and then spent it, transaction went through without a hitch.\r\n\r\n### Actual behaviour\r\nYou can see the result in step 2.2. \r\n\r\n### Additional info\r\nI talked about it at IRC bitcoin-core-dev channel with meshcollider. He said there might be an issue where I would need to pass in witness program as well to the signrawtransaction method and that it should add witness object if it is required since createrawtransaction method can't possibly know if output is plain p2sh or a segwit wrapper.\r\n\r\n### What version of bitcoin-core are you using?\r\nI am running v0.15.1.0-g7b57bc998f retrieved through Ubuntu PPA.\r\n\r\n",
    "user": {
      "login": "kgcorps",
      "id": 29866086,
      "node_id": "MDQ6VXNlcjI5ODY2MDg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/29866086?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kgcorps",
      "html_url": "https://github.com/kgcorps",
      "followers_url": "https://api.github.com/users/kgcorps/followers",
      "following_url": "https://api.github.com/users/kgcorps/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/kgcorps/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/kgcorps/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/kgcorps/subscriptions",
      "organizations_url": "https://api.github.com/users/kgcorps/orgs",
      "repos_url": "https://api.github.com/users/kgcorps/repos",
      "events_url": "https://api.github.com/users/kgcorps/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/kgcorps/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 98279177,
        "node_id": "MDU6TGFiZWw5ODI3OTE3Nw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ",
        "name": "RPC/REST/ZMQ",
        "color": "0052cc",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": true,
    "active_lock_reason": "resolved",
    "comments": 3,
    "closed_at": "2018-10-15T04:36:09Z",
    "created_at": "2017-11-15T13:17:08Z",
    "updated_at": "2021-09-08T12:39:29Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 1342970445,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDEzNDI5NzA0NDU=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1342970445",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-11-15T13:18:05Z",
      "label": {
        "name": "RPC/REST/ZMQ",
        "color": "0052cc"
      }
    },
    {
      "event": "commented",
      "id": 344593863,
      "node_id": "MDEyOklzc3VlQ29tbWVudDM0NDU5Mzg2Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/344593863",
      "actor": {
        "login": "meshcollider",
        "id": 3211283,
        "node_id": "MDQ6VXNlcjMyMTEyODM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/meshcollider",
        "html_url": "https://github.com/meshcollider",
        "followers_url": "https://api.github.com/users/meshcollider/followers",
        "following_url": "https://api.github.com/users/meshcollider/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/meshcollider/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/meshcollider/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
        "organizations_url": "https://api.github.com/users/meshcollider/orgs",
        "repos_url": "https://api.github.com/users/meshcollider/repos",
        "events_url": "https://api.github.com/users/meshcollider/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/meshcollider/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-11-15T13:35:54Z",
      "updated_at": "2017-11-15T13:35:54Z",
      "author_association": "CONTRIBUTOR",
      "body": "> where I would need to pass in witness program as well to the signrawtransaction method\r\n\r\nIndeed, I couldn't work out any way currently to pass both the P2SH wrapper redeem script and the P2WSH witness program redeem script in, so if that's not currently possible I'll make a PR tomorrow to accept it as a standalone input. Need someone more familiar with it to weigh in though.",
      "user": {
        "login": "meshcollider",
        "id": 3211283,
        "node_id": "MDQ6VXNlcjMyMTEyODM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/meshcollider",
        "html_url": "https://github.com/meshcollider",
        "followers_url": "https://api.github.com/users/meshcollider/followers",
        "following_url": "https://api.github.com/users/meshcollider/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/meshcollider/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/meshcollider/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
        "organizations_url": "https://api.github.com/users/meshcollider/orgs",
        "repos_url": "https://api.github.com/users/meshcollider/repos",
        "events_url": "https://api.github.com/users/meshcollider/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/meshcollider/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/11693#issuecomment-344593863",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11693"
    },
    {
      "event": "commented",
      "id": 344891456,
      "node_id": "MDEyOklzc3VlQ29tbWVudDM0NDg5MTQ1Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/344891456",
      "actor": {
        "login": "kgcorps",
        "id": 29866086,
        "node_id": "MDQ6VXNlcjI5ODY2MDg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/29866086?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kgcorps",
        "html_url": "https://github.com/kgcorps",
        "followers_url": "https://api.github.com/users/kgcorps/followers",
        "following_url": "https://api.github.com/users/kgcorps/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/kgcorps/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/kgcorps/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/kgcorps/subscriptions",
        "organizations_url": "https://api.github.com/users/kgcorps/orgs",
        "repos_url": "https://api.github.com/users/kgcorps/repos",
        "events_url": "https://api.github.com/users/kgcorps/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/kgcorps/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-11-16T11:09:20Z",
      "updated_at": "2017-11-16T11:09:20Z",
      "author_association": "NONE",
      "body": "I've found a way to add the witness program as well to the input when signing it, but it is definitely not straight forward, so basically what you have to do is add the same input 2x once with p2sh redeem script and once with p2wsh redeem script (props go to https://bitcoin.stackexchange.com/users/64730/arubi for figuring this one out). The example signing request for this particular example: https://pastebin.com/8CFhFP2Z\r\nWhether to change anything in the RPC API or not is up to you of course, but it is confusing to say the least. Might be a good idea for each input to add an optional witness script field with explanation when it should be passed.",
      "user": {
        "login": "kgcorps",
        "id": 29866086,
        "node_id": "MDQ6VXNlcjI5ODY2MDg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/29866086?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kgcorps",
        "html_url": "https://github.com/kgcorps",
        "followers_url": "https://api.github.com/users/kgcorps/followers",
        "following_url": "https://api.github.com/users/kgcorps/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/kgcorps/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/kgcorps/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/kgcorps/subscriptions",
        "organizations_url": "https://api.github.com/users/kgcorps/orgs",
        "repos_url": "https://api.github.com/users/kgcorps/repos",
        "events_url": "https://api.github.com/users/kgcorps/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/kgcorps/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/11693#issuecomment-344891456",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11693"
    },
    {
      "event": "commented",
      "id": 429706105,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQyOTcwNjEwNQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/429706105",
      "actor": {
        "login": "meshcollider",
        "id": 3211283,
        "node_id": "MDQ6VXNlcjMyMTEyODM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/meshcollider",
        "html_url": "https://github.com/meshcollider",
        "followers_url": "https://api.github.com/users/meshcollider/followers",
        "following_url": "https://api.github.com/users/meshcollider/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/meshcollider/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/meshcollider/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
        "organizations_url": "https://api.github.com/users/meshcollider/orgs",
        "repos_url": "https://api.github.com/users/meshcollider/repos",
        "events_url": "https://api.github.com/users/meshcollider/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/meshcollider/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-10-15T04:36:09Z",
      "updated_at": "2018-10-15T04:36:09Z",
      "author_association": "CONTRIBUTOR",
      "body": "This was fixed by #12427",
      "user": {
        "login": "meshcollider",
        "id": 3211283,
        "node_id": "MDQ6VXNlcjMyMTEyODM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/meshcollider",
        "html_url": "https://github.com/meshcollider",
        "followers_url": "https://api.github.com/users/meshcollider/followers",
        "following_url": "https://api.github.com/users/meshcollider/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/meshcollider/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/meshcollider/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
        "organizations_url": "https://api.github.com/users/meshcollider/orgs",
        "repos_url": "https://api.github.com/users/meshcollider/repos",
        "events_url": "https://api.github.com/users/meshcollider/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/meshcollider/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/11693#issuecomment-429706105",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11693"
    },
    {
      "event": "closed",
      "id": 1903057047,
      "node_id": "MDExOkNsb3NlZEV2ZW50MTkwMzA1NzA0Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1903057047",
      "actor": {
        "login": "meshcollider",
        "id": 3211283,
        "node_id": "MDQ6VXNlcjMyMTEyODM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/meshcollider",
        "html_url": "https://github.com/meshcollider",
        "followers_url": "https://api.github.com/users/meshcollider/followers",
        "following_url": "https://api.github.com/users/meshcollider/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/meshcollider/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/meshcollider/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
        "organizations_url": "https://api.github.com/users/meshcollider/orgs",
        "repos_url": "https://api.github.com/users/meshcollider/repos",
        "events_url": "https://api.github.com/users/meshcollider/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/meshcollider/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-10-15T04:36:09Z"
    },
    {
      "event": "locked",
      "id": 5272040503,
      "node_id": "LOE_lADOABII584QVz1wzwAAAAE6PPQ3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5272040503",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-08T12:39:29Z",
      "lock_reason": "resolved"
    }
  ]
}