{
  "type": "issue",
  "issue": {
    "id": 1081284406,
    "node_id": "I_kwDOABII585Acxc2",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23787",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23787/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23787/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23787/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/23787",
    "number": 23787,
    "state": "closed",
    "state_reason": "completed",
    "title": "wallet: Sweep function and deprecating subtractFeeFromOutputs",
    "body": "The subtractFeeFromOutputs function has long been the cause of many issues in coin selection. It is unclear whether it is being used for things other than sweeping the entire wallet balance, and sweeping specific inputs (i.e. spending inputs without creating change and without figuring out the feerate manually). Many issues opened about subtractFeeFromOutputs indicate that users are using it for sweeping, and the linked issue in the PR that adds it also discusses sweeping as the intended feature. Instead of using subtractFeeFromOutputs in order to implement this feature, it makes more sense to me to add specific functionality for sweeping. This would allow us to de-complicate our coin selection code by removing subtractFeeFromOutputs.\r\n\r\n***\r\n\r\nThere are a few specific things that I would want to see in a sweep function, besides the obvious spending all UTXOs with one destination.\r\n\r\nIt is possible that users will want to sweep to multiple destinations, so the sweep function should optionally allow users to specify amounts with addresses. If no amount is provided for an address, then the remaining value being swept will be sent to that address. Furthermore, multiple addresses may have no amount specified, in which case the remainder is split equally among the addresses, much in the same way that subtractFeeFromOutputs currently distributes the fee among the outputs.\r\n\r\nAdditionally, sweeping may be used to sweep only specific inputs. So this sweep function should be able to allow users to specify which inputs to use. All specified inputs should be spent. If no inputs are provided, then the entire wallet will be spent.\r\n\r\n***\r\n\r\nThere are a few ways this could be implemented. The obvious is a new RPC with an API similar to `send` so that all of the relevant options can be provided. This would allow for a psbt to be returned in the case that the wallet does not have private keys, or if the user requests it. Another way would be to add it as an option to `send`, however I don't think that the API for using it would be easy to understand. For the GUI, there should be a dedicated button.\r\n\r\nInternally, it should be completely separate from existing coin selection (i.e. not in `CreateTransaction`, `SelectCoins`, or `AttemptSelection`).\r\n\r\nLastly, when sweep is implemented, subtractFeeFromOutputs should be added to `-deprecatedrpc` and the option removed from the GUI. Users should be informed that they can use the sweep function if that is what they are doing. Otherwise they can open an issue to discuss their use case. After one (or two) major release with `-deprecatedrpc` and no users complaining about a use case for subtractFeeFromOutputs that was not sweeping, then the subtractFeeFromOutputs option can be removed and the code for handling it removed from coin selection.",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 64583,
        "node_id": "MDU6TGFiZWw2NDU4Mw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature",
        "name": "Feature",
        "color": "7cf575",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": false,
    "comments": 2,
    "closed_at": "2022-09-15T06:51:19Z",
    "created_at": "2021-12-15T17:11:34Z",
    "updated_at": "2022-09-15T06:51:19Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 5772848668,
      "node_id": "LE_lADOABII585Acxc2zwAAAAFYFq4c",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5772848668",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-15T17:11:34Z",
      "label": {
        "name": "Feature",
        "color": "7cf575"
      }
    },
    {
      "event": "commented",
      "id": 1246730256,
      "node_id": "IC_kwDOABII585KT5gQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1246730256",
      "actor": {
        "login": "aureleoules",
        "id": 22493292,
        "node_id": "MDQ6VXNlcjIyNDkzMjky",
        "avatar_url": "https://avatars.githubusercontent.com/u/22493292?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/aureleoules",
        "html_url": "https://github.com/aureleoules",
        "followers_url": "https://api.github.com/users/aureleoules/followers",
        "following_url": "https://api.github.com/users/aureleoules/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/aureleoules/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/aureleoules/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/aureleoules/subscriptions",
        "organizations_url": "https://api.github.com/users/aureleoules/orgs",
        "repos_url": "https://api.github.com/users/aureleoules/repos",
        "events_url": "https://api.github.com/users/aureleoules/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/aureleoules/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-14T12:59:58Z",
      "updated_at": "2022-09-14T12:59:58Z",
      "author_association": "MEMBER",
      "body": "This issue seems to be fixed with #24118.\r\n`subtractFeeFromOutputs` will not be deprecated though, see https://github.com/bitcoin/bitcoin/pull/24142#issuecomment-1029453451.",
      "user": {
        "login": "aureleoules",
        "id": 22493292,
        "node_id": "MDQ6VXNlcjIyNDkzMjky",
        "avatar_url": "https://avatars.githubusercontent.com/u/22493292?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/aureleoules",
        "html_url": "https://github.com/aureleoules",
        "followers_url": "https://api.github.com/users/aureleoules/followers",
        "following_url": "https://api.github.com/users/aureleoules/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/aureleoules/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/aureleoules/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/aureleoules/subscriptions",
        "organizations_url": "https://api.github.com/users/aureleoules/orgs",
        "repos_url": "https://api.github.com/users/aureleoules/repos",
        "events_url": "https://api.github.com/users/aureleoules/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/aureleoules/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/23787#issuecomment-1246730256",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23787"
    },
    {
      "event": "commented",
      "id": 1247657928,
      "node_id": "IC_kwDOABII585KXb_I",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1247657928",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-15T06:51:19Z",
      "updated_at": "2022-09-15T06:51:19Z",
      "author_association": "MEMBER",
      "body": "Ok, closing for now. Can be reopened or a fresh issue be opened if I incorrectly closed this.",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/23787#issuecomment-1247657928",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23787"
    },
    {
      "event": "closed",
      "id": 7391966779,
      "node_id": "CE_lADOABII585Acxc2zwAAAAG4mHY7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7391966779",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-15T06:51:19Z"
    }
  ]
}