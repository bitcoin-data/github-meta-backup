{
  "type": "issue",
  "issue": {
    "id": 250553745,
    "node_id": "MDU6SXNzdWUyNTA1NTM3NDU=",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11063",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11063/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11063/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11063/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/11063",
    "number": 11063,
    "state": "closed",
    "state_reason": "completed",
    "title": "bitcoind aborts",
    "body": "This is current git master on OpenBSD 6.1-current/amd64\r\n\r\n```\r\n$ gdb ~/bin/bitcoind\r\nGNU gdb 6.3\r\nCopyright 2004 Free Software Foundation, Inc.\r\nGDB is free software, covered by the GNU General Public License, and you are\r\nwelcome to change it and/or distribute copies of it under certain conditions.\r\nType \"show copying\" to see the conditions.\r\nThere is absolutely no warranty for GDB.  Type \"show warranty\" for details.\r\nThis GDB was configured as \"amd64-unknown-openbsd6.1\"...\r\n(gdb) run\r\nStarting program: /home/hans/bin/bitcoind\r\n\r\nProgram received signal SIGABRT, Aborted.\r\nthrkill () at -:3\r\n3\t-: No such file or directory.\r\n\tin -\r\nCurrent language:  auto; currently asm\r\n(gdb) bt\r\n#0  thrkill () at -:3\r\n#1  0x0000067e899c452b in _libc___stack_smash_handler (func=Variable \"func\" is not available.\r\n) at /usr/src/lib/libc/sys/stack_protector.c:79\r\nDie: DW_TAG_<unknown> (abbrev = 113, offset = 1678518)\r\n\thas children: FALSE\r\n\tattributes:\r\n\t\tDW_AT_type (DW_FORM_ref4) constant ref: 1634006 (adjusted)\r\nDwarf Error: Cannot find type of die [in module /home/hans/bin/bitcoind]\r\n(gdb) quit\r\nThe program is running.\t Exit anyway? (y or n) y\r\n```\r\n\r\nApparently, something bad is happening on the stack\r\nand falls victim to to stack protector, but I don't know what it is.\r\n",
    "user": {
      "login": "janstary",
      "id": 2013679,
      "node_id": "MDQ6VXNlcjIwMTM2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2013679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/janstary",
      "html_url": "https://github.com/janstary",
      "followers_url": "https://api.github.com/users/janstary/followers",
      "following_url": "https://api.github.com/users/janstary/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/janstary/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/janstary/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/janstary/subscriptions",
      "organizations_url": "https://api.github.com/users/janstary/orgs",
      "repos_url": "https://api.github.com/users/janstary/repos",
      "events_url": "https://api.github.com/users/janstary/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/janstary/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 234878,
        "node_id": "MDU6TGFiZWwyMzQ4Nzg=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Linux/Unix",
        "name": "Linux/Unix",
        "color": "770000",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": true,
    "active_lock_reason": "resolved",
    "comments": 3,
    "closed_at": "2018-03-07T19:01:34Z",
    "created_at": "2017-08-16T08:46:54Z",
    "updated_at": "2021-09-08T12:44:06Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 1207854288,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDEyMDc4NTQyODg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1207854288",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-08-16T08:48:50Z",
      "label": {
        "name": "Linux/Unix",
        "color": "770000"
      }
    },
    {
      "event": "commented",
      "id": 323180584,
      "node_id": "MDEyOklzc3VlQ29tbWVudDMyMzE4MDU4NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/323180584",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-08-17T20:10:12Z",
      "updated_at": "2017-08-17T20:20:43Z",
      "author_association": "MEMBER",
      "body": "- Does this happen every time you start, or irregularly?\r\n- Can you paste the last part of the debug.log, before the crash?\r\n- openbsd's default gdb version is useless (it's from 2004, DWARF 3, the format that modern compilers use for debug information didn't exist yet at the time, and we even have DWARF 4 now). Can you try installing a newer gdb from ports, and get a traceback with that?\r\n- If you run the tests `make check` and `test/functional/test_runner.py` for the unit tests and functional tests respectively, do they pass?\r\n\r\nFYI I tried running bitcoind on OpenBSD 6.1 and did basic sanity tests and did not have this issue, so we need to figure out what triggers it in your case.",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/11063#issuecomment-323180584",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11063"
    },
    {
      "event": "commented",
      "id": 325352267,
      "node_id": "MDEyOklzc3VlQ29tbWVudDMyNTM1MjI2Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/325352267",
      "actor": {
        "login": "janstary",
        "id": 2013679,
        "node_id": "MDQ6VXNlcjIwMTM2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2013679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/janstary",
        "html_url": "https://github.com/janstary",
        "followers_url": "https://api.github.com/users/janstary/followers",
        "following_url": "https://api.github.com/users/janstary/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/janstary/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/janstary/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/janstary/subscriptions",
        "organizations_url": "https://api.github.com/users/janstary/orgs",
        "repos_url": "https://api.github.com/users/janstary/repos",
        "events_url": "https://api.github.com/users/janstary/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/janstary/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-08-28T13:24:35Z",
      "updated_at": "2017-08-28T13:24:35Z",
      "author_association": "NONE",
      "body": "Here's trying again with the current git master on OpenBSD 6.1-current/amd64\r\n\r\n```\r\n $ env AUTOMAKE_VERSION=1.15 AUTOCONF_VERSION=2.69 sh autogen.sh\r\n./configure --prefix=$HOME --mandir=$HOME/man --disable-wallet  CC=cc CXX=c++\r\ngmake && gmake install\r\n```\r\n\r\nThe `cc` and `c++` is actually clang 4.0.0 as patched by OpenBSD.\r\n\r\nThe resulting bitcoind consistenly crashes with SIGABRT.\r\nThis is a backtrace from gdb 6.3:\r\n\r\n```\r\n$ egdb /home/hans/bin/bitcoind\r\nGNU gdb (GDB) 7.12.1\r\nCopyright (C) 2017 Free Software Foundation, Inc.\r\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\r\nThis is free software: you are free to change and redistribute it.\r\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\r\nand \"show warranty\" for details.\r\nThis GDB was configured as \"x86_64-unknown-openbsd6.2\".\r\nType \"show configuration\" for configuration details.\r\nFor bug reporting instructions, please see:\r\n<http://www.gnu.org/software/gdb/bugs/>.\r\nFind the GDB manual and other documentation resources online at:\r\n<http://www.gnu.org/software/gdb/documentation/>.\r\nFor help, type \"help\".\r\nType \"apropos word\" to search for commands related to \"word\"...\r\nReading symbols from /home/hans/bin/bitcoind...done.\r\n(gdb) run\r\nStarting program: /home/hans/bin/bitcoind\r\n[New thread 368295]\r\n[New thread 219480]\r\n[New thread 131428]\r\n[New thread 105176]\r\n[New thread 528467]\r\n[New thread 568060]\r\n[New thread 570717]\r\n[New thread 370839]\r\n[New thread 404259]\r\n\r\nThread 1 received signal SIGABRT, Aborted.\r\nthrkill () at -:3\r\n3\t-: No such file or directory.\r\n(gdb) bt\r\n#0  thrkill () at -:3\r\n#1  0x00001fcadaee152b in _libc___stack_smash_handler (func=<optimized out>, damaged=<optimized out>) at /usr/src/lib/libc/sys/stack_protector.c:79\r\n#2  0x00001fc7f264e2dd in CDBWrapper::CDBWrapper (this=0x1fca22a6bf00, path=..., nCacheSize=<optimized out>, fMemory=<optimized out>, fWipe=<optimized out>,\r\n    obfuscate=<error reading variable: access outside bounds of object referenced via synthetic pointer>) at dbwrapper.cpp:142\r\n#3  0x00001fc7f27685a9 in CBlockTreeDB::CBlockTreeDB (this=0x1fca22a6bf00, nCacheSize=2097152, fMemory=<error reading variable: access outside bounds of object referenced via synthetic pointer>,\r\n    fWipe=<error reading variable: access outside bounds of object referenced via synthetic pointer>) at txdb.cpp:150\r\n#4  0x00001fc7f2623922 in AppInitMain (threadGroup=..., scheduler=...) at init.cpp:1404\r\n#5  0x00001fc7f2602745 in AppInit (argc=1, argv=0x7f7fffff3228) at bitcoind.cpp:168\r\n#6  0x00001fc7f2602c3f in main (argc=0, argv=0x6) at bitcoind.cpp:195\r\n(gdb) quit\r\nA debugging session is active.\r\n\r\n\tInferior 1 [process 72956] will be killed.\r\n\r\nQuit anyway? (y or n) y\r\n```\r\n\r\nThis is what debug.log says:\r\n\r\n```\r\n\r\n2017-08-28 13:21:43 Bitcoin version v0.15.99.0-f088a1bb3\r\n2017-08-28 13:21:43 InitParameterInteraction: parameter interaction: -whitelistforcerelay=1 -> setting -whitelistrelay=1\r\n2017-08-28 13:21:43 Assuming ancestors of block 0000000000000000003b9ce759c2a087d52abc4266f8f4ebd6d768b89defa50a have valid signatures.\r\n2017-08-28 13:21:43 Using the 'standard' SHA256 implementation\r\n2017-08-28 13:21:43 Default data directory /home/hans/.bitcoin\r\n2017-08-28 13:21:43 Using data directory /home/hans/.bitcoin\r\n2017-08-28 13:21:43 Using config file /home/hans/.bitcoin/bitcoin.conf\r\n2017-08-28 13:21:43 Using at most 125 automatic connections (512 file descriptors available)\r\n2017-08-28 13:21:43 Using 16 MiB out of 32/2 requested for signature cache, able to store 524288 elements\r\n2017-08-28 13:21:43 Using 16 MiB out of 32/2 requested for script execution cache, able to store 524288 elements\r\n2017-08-28 13:21:43 Using 4 threads for script verification\r\n2017-08-28 13:21:43 scheduler thread start\r\n2017-08-28 13:21:43 HTTP: creating work queue of depth 16\r\n2017-08-28 13:21:43 No rpcpassword set - using random cookie authentication\r\n2017-08-28 13:21:43 Generated RPC authentication cookie /home/hans/.bitcoin/.cookie\r\n2017-08-28 13:21:43 HTTP: starting 4 worker threads\r\n2017-08-28 13:21:43 Cache configuration:\r\n2017-08-28 13:21:43 * Using 2.0MiB for block index database\r\n2017-08-28 13:21:43 * Using 8.0MiB for chain state database\r\n2017-08-28 13:21:43 * Using 440.0MiB for in-memory UTXO set (plus up to 286.1MiB of unused mempool space)\r\n2017-08-28 13:21:43 init message: Loading block index...\r\n2017-08-28 13:21:43 Opening LevelDB in /home/hans/.bitcoin/blocks/index\r\n2017-08-28 13:21:43 Opened LevelDB successfully\r\n2017-08-28 13:21:43 Using obfuscation key for /home/hans/.bitcoin/blocks/index: 0000000000000000\r\n```\r\n",
      "user": {
        "login": "janstary",
        "id": 2013679,
        "node_id": "MDQ6VXNlcjIwMTM2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2013679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/janstary",
        "html_url": "https://github.com/janstary",
        "followers_url": "https://api.github.com/users/janstary/followers",
        "following_url": "https://api.github.com/users/janstary/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/janstary/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/janstary/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/janstary/subscriptions",
        "organizations_url": "https://api.github.com/users/janstary/orgs",
        "repos_url": "https://api.github.com/users/janstary/repos",
        "events_url": "https://api.github.com/users/janstary/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/janstary/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/11063#issuecomment-325352267",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11063"
    },
    {
      "event": "commented",
      "id": 325360165,
      "node_id": "MDEyOklzc3VlQ29tbWVudDMyNTM2MDE2NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/325360165",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-08-28T13:55:55Z",
      "updated_at": "2017-08-28T13:56:18Z",
      "author_association": "MEMBER",
      "body": "> The cc and c++ is actually clang 4.0.0 as patched by OpenBSD.\r\n\r\nYes, building with clang++ had some issues for me as well last time I tried, that's why I suggest using eg++ in the openbsd build guide. It looks like some kind of ABI conflict in any case.",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/11063#issuecomment-325360165",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11063"
    },
    {
      "event": "closed",
      "id": 1509606613,
      "node_id": "MDExOkNsb3NlZEV2ZW50MTUwOTYwNjYxMw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1509606613",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-03-07T19:01:35Z"
    },
    {
      "event": "locked",
      "id": 5272065670,
      "node_id": "LOE_lADOABII584O7yWRzwAAAAE6PVaG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5272065670",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-08T12:44:06Z",
      "lock_reason": "resolved"
    }
  ]
}