{
  "type": "issue",
  "issue": {
    "id": 584785982,
    "node_id": "MDU6SXNzdWU1ODQ3ODU5ODI=",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18390",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18390/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18390/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18390/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/18390",
    "number": 18390,
    "state": "closed",
    "state_reason": "completed",
    "title": "A minor issue of SENDCMPCT msg in handshaking process",
    "body": "In `src/net_processing.cpp` line 2131 to 2143\r\n```\r\nif (pfrom->nVersion >= SHORT_IDS_BLOCKS_VERSION) {\r\n    bool fAnnounceUsingCMPCTBLOCK = false;\r\n    uint64_t nCMPCTBLOCKVersion = 2;\r\n    if (pfrom->GetLocalServices() & NODE_WITNESS)\r\n        connman->PushMessage(pfrom, msgMaker.Make(NetMsgType::SENDCMPCT, fAnnounceUsingCMPCTBLOCK, nCMPCTBLOCKVersion));\r\n    nCMPCTBLOCKVersion = 1;\r\n    connman->PushMessage(pfrom, msgMaker.Make(NetMsgType::SENDCMPCT, fAnnounceUsingCMPCTBLOCK, nCMPCTBLOCKVersion));\r\n}\r\n```\r\n\r\nCan anyone explain why the node sends one more SENDCMPCT msg with `nCMPCTBLOCKVersion = 1` when `pfrom->GetLocalServices() & NODE_WITNESS` is true?\r\n",
    "user": {
      "login": "seungww",
      "id": 48233791,
      "node_id": "MDQ6VXNlcjQ4MjMzNzkx",
      "avatar_url": "https://avatars.githubusercontent.com/u/48233791?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/seungww",
      "html_url": "https://github.com/seungww",
      "followers_url": "https://api.github.com/users/seungww/followers",
      "following_url": "https://api.github.com/users/seungww/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/seungww/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/seungww/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/seungww/subscriptions",
      "organizations_url": "https://api.github.com/users/seungww/orgs",
      "repos_url": "https://api.github.com/users/seungww/repos",
      "events_url": "https://api.github.com/users/seungww/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/seungww/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 6,
    "closed_at": "2023-03-13T15:33:26Z",
    "created_at": "2020-03-20T01:08:41Z",
    "updated_at": "2023-03-13T15:33:26Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 3147790727,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDMxNDc3OTA3Mjc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3147790727",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-20T01:26:21Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    },
    {
      "event": "commented",
      "id": 601742963,
      "node_id": "MDEyOklzc3VlQ29tbWVudDYwMTc0Mjk2Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/601742963",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-20T14:57:00Z",
      "updated_at": "2020-03-20T15:01:20Z",
      "author_association": "MEMBER",
      "body": "There is a lot of related discussion in the [PR](https://github.com/bitcoin/bitcoin/pull/8393) introducing this behaviour along with a [change](https://github.com/bitcoin/bips/pull/423) to the corresponding BIP-151.\r\n\r\nMore specifically, the updated BIP says:\r\n> Upon connection establishment, a node SHOULD send a burst of sendcmpct messages containing every version of compact block encodings for which they are willing to support sending cmpctblock and blocktxn messages, and receiving getblocktxn messages. These messages SHOULD be ordered in the order of the priority which the node wishes to receive cmpctblock/blocktxn messages, with the highest-priority version sendcmpct message sent first.\r\n\r\nI believe that this is done to enable the possible future where SegWit-supporting nodes (NODE_WITNESS) to participate in both v1 and v2 compact block relay, and this would allow current nodes to talk to them (by not implying that SegWit is always v2-cmpctblocks).\r\n\r\nTo be clear, I just spent about 30 minutes trying to figure out, and I'm still unsure that my rationale is correct. Maybe this means we should add a comment.",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/18390#issuecomment-601742963",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18390"
    },
    {
      "event": "commented",
      "id": 601745889,
      "node_id": "MDEyOklzc3VlQ29tbWVudDYwMTc0NTg4OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/601745889",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-20T15:02:40Z",
      "updated_at": "2020-03-20T15:02:40Z",
      "author_association": "MEMBER",
      "body": "There is a comment already:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/5bf45fe2a9642f8ae8f8a12bcbf8f8b4770421ad/src/net_processing.cpp#L2132\r\n\r\nBut I don't understand why we still support non-witness compact blocks these days. To simplify our code, we could just remove those things?",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/18390#issuecomment-601745889",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18390"
    },
    {
      "event": "commented",
      "id": 601748548,
      "node_id": "MDEyOklzc3VlQ29tbWVudDYwMTc0ODU0OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/601748548",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-20T15:08:06Z",
      "updated_at": "2020-03-20T15:08:06Z",
      "author_association": "MEMBER",
      "body": "@MarcoFalke yes, that comment is there, but it doesn't make clear why it is useful to announce cmpctblocks-v1 for segwit nodes. The confusing part is that it's definitely not useful if everybody uses current implementation, so one have to think about either past or future scenarios, where this could be useful via compatibility.",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/18390#issuecomment-601748548",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18390"
    },
    {
      "event": "mentioned",
      "id": 3149708819,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzE0OTcwODgxOQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3149708819",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-20T15:08:06Z"
    },
    {
      "event": "subscribed",
      "id": 3149708827,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDMxNDk3MDg4Mjc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3149708827",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-20T15:08:06Z"
    },
    {
      "event": "closed",
      "id": 3150084058,
      "node_id": "MDExOkNsb3NlZEV2ZW50MzE1MDA4NDA1OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3150084058",
      "actor": {
        "login": "seungww",
        "id": 48233791,
        "node_id": "MDQ6VXNlcjQ4MjMzNzkx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48233791?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/seungww",
        "html_url": "https://github.com/seungww",
        "followers_url": "https://api.github.com/users/seungww/followers",
        "following_url": "https://api.github.com/users/seungww/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/seungww/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/seungww/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/seungww/subscriptions",
        "organizations_url": "https://api.github.com/users/seungww/orgs",
        "repos_url": "https://api.github.com/users/seungww/repos",
        "events_url": "https://api.github.com/users/seungww/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/seungww/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-20T16:42:26Z"
    },
    {
      "event": "reopened",
      "id": 3150084238,
      "node_id": "MDEzOlJlb3BlbmVkRXZlbnQzMTUwMDg0MjM4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3150084238",
      "actor": {
        "login": "seungww",
        "id": 48233791,
        "node_id": "MDQ6VXNlcjQ4MjMzNzkx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48233791?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/seungww",
        "html_url": "https://github.com/seungww",
        "followers_url": "https://api.github.com/users/seungww/followers",
        "following_url": "https://api.github.com/users/seungww/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/seungww/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/seungww/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/seungww/subscriptions",
        "organizations_url": "https://api.github.com/users/seungww/orgs",
        "repos_url": "https://api.github.com/users/seungww/repos",
        "events_url": "https://api.github.com/users/seungww/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/seungww/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-20T16:42:28Z"
    },
    {
      "event": "commented",
      "id": 601818966,
      "node_id": "MDEyOklzc3VlQ29tbWVudDYwMTgxODk2Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/601818966",
      "actor": {
        "login": "seungww",
        "id": 48233791,
        "node_id": "MDQ6VXNlcjQ4MjMzNzkx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48233791?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/seungww",
        "html_url": "https://github.com/seungww",
        "followers_url": "https://api.github.com/users/seungww/followers",
        "following_url": "https://api.github.com/users/seungww/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/seungww/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/seungww/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/seungww/subscriptions",
        "organizations_url": "https://api.github.com/users/seungww/orgs",
        "repos_url": "https://api.github.com/users/seungww/repos",
        "events_url": "https://api.github.com/users/seungww/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/seungww/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-20T17:22:11Z",
      "updated_at": "2020-03-20T17:26:02Z",
      "author_association": "NONE",
      "body": "I accidentally clicked on the 'close issue' :).\r\nI understand that sending one more SENDCMPCT msg for some nodes that only support version 1.\r\n\r\nI still have something to discuss.\r\n\r\nWithout considering the version (1 or 2), I just understand the meaning of `nCMPCTBLOCKVersion` determines whether this node wants to send or receive witness data. This is because some nodes (supporting version 2) may not want to receive witness data. Also, I think `fWantsCmpctWitness` has the same role as `nCMPCTBLOCKVersion`.\r\n```\r\n// ! Whether this peer wants witnesses in cmpctblocks/blocktxns\r\nbool fWantsCmpctWitness;\r\n```\r\n\r\nBut, in receiving SENDCMPCT part,\r\nhttps://github.com/bitcoin/bitcoin/blob/5bf45fe2a9642f8ae8f8a12bcbf8f8b4770421ad/src/net_processing.cpp#L2215\r\nIf a peer sends any SENDCMPCT msg with `nCMPCTBLOCKVersion == 2`, there is no logic to change `fWantsCmpctWitness` to `False` even if the peer sends SENDCMPCT msg with `nCMPCTBLOCKVersion == 1`.\r\n\r\nIs there anything I misunderstand?\r\n",
      "user": {
        "login": "seungww",
        "id": 48233791,
        "node_id": "MDQ6VXNlcjQ4MjMzNzkx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48233791?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/seungww",
        "html_url": "https://github.com/seungww",
        "followers_url": "https://api.github.com/users/seungww/followers",
        "following_url": "https://api.github.com/users/seungww/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/seungww/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/seungww/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/seungww/subscriptions",
        "organizations_url": "https://api.github.com/users/seungww/orgs",
        "repos_url": "https://api.github.com/users/seungww/repos",
        "events_url": "https://api.github.com/users/seungww/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/seungww/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/18390#issuecomment-601818966",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18390"
    },
    {
      "event": "commented",
      "id": 601843295,
      "node_id": "MDEyOklzc3VlQ29tbWVudDYwMTg0MzI5NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/601843295",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-20T18:14:02Z",
      "updated_at": "2020-03-20T18:14:17Z",
      "author_association": "MEMBER",
      "body": "You are correct,  this is done to follow this part of BIP-152:\r\n\r\n>These messages SHOULD be ordered in the order of the priority which the node wishes to receive cmpctblock/blocktxn messages, with the highest-priority version sendcmpct message sent first.\r\n\r\nNotice that upgrade from v1 to v2 is also not allowed by this code (because it will stick to v1 which is received first).\r\n\r\nWhat **is** possible for future implementations of the node is to ignore v2 for some reason, and stick to v1, even if v1 is received later.",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/18390#issuecomment-601843295",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18390"
    },
    {
      "event": "commented",
      "id": 1466364121,
      "node_id": "IC_kwDOABII585XZvDZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1466364121",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-13T15:26:55Z",
      "updated_at": "2023-03-13T15:26:55Z",
      "author_association": "MEMBER",
      "body": "It appears that Bitcoin Core no longer sends multiple _versions_ of the `SENDCMPT` message:\r\n\r\n```fish\r\n$ rg NetMsgType::SENDCMPCT\r\nsrc/net_processing.cpp\r\n1220:                m_connman.PushMessage(pnodeStop, CNetMsgMaker(pnodeStop->GetCommonVersion()).Make(NetMsgType::SENDCMPCT, /*high_bandwidth=*/false, /*version=*/CMPCTBLOCKS_VERSION));\r\n1227:        m_connman.PushMessage(pfrom, CNetMsgMaker(pfrom->GetCommonVersion()).Make(NetMsgType::SENDCMPCT, /*high_bandwidth=*/true, /*version=*/CMPCTBLOCKS_VERSION));\r\n3418:            m_connman.PushMessage(&pfrom, msgMaker.Make(NetMsgType::SENDCMPCT, /*high_bandwidth=*/false, /*version=*/CMPCTBLOCKS_VERSION));\r\n3454:    if (msg_type == NetMsgType::SENDCMPCT) {\r\n\r\nsrc/protocol.cpp\r\n77:    NetMsgType::SENDCMPCT,\r\n``` \r\n\r\n...and when we do, we only specify V2 by sending `CMPCTBLOCKS_VERSION`:\r\n\r\n```\r\n/** The compactblocks version we support. See BIP 152. */\r\nstatic constexpr uint64_t CMPCTBLOCKS_VERSION{2};\r\n```\r\nIn addition to this, we now **ony** support V2 compact blocks:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/f088949fcfe6ba5000caa2f6adc6803e81925afb/src/net_processing.cpp#L3454-L3460\r\n\r\nTherefore I think this issue can be closed now.",
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/18390#issuecomment-1466364121",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18390"
    },
    {
      "event": "closed",
      "id": 8733282063,
      "node_id": "CE_lADOABII584i2yA-zwAAAAIIi08P",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8733282063",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-13T15:33:26Z"
    }
  ]
}