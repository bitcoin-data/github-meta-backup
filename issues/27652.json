{
  "type": "issue",
  "issue": {
    "id": 1708710593,
    "node_id": "I_kwDOABII585l2NrB",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27652",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27652/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27652/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27652/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/27652",
    "number": 27652,
    "state": "open",
    "state_reason": null,
    "title": "Allow getblockfrompeer to use any peer",
    "body": "### Please describe the feature you'd like to see added.\n\nWhen you use `getblockfrompeer` you have to specify an index of a specific peer. But it would be much easier if it allowed you to use ANY peer.\r\n\r\nFor example, if you run a pruned node, and your first peer happens to be also pruned, the call will fail. If the call tried all nodes, until it finds a peer that has the block, it wouldn't require you that implement any logic for that.\n\n### Is your feature related to a problem, if so please describe it.\n\n_No response_\n\n### Describe the solution you'd like\n\nThe solution would be simple: if you don't specify any index, then try all peers untill you find one that does have block, otherwise fail.\n\n### Describe any alternatives you've considered\n\n_No response_\n\n### Please leave any additional context\n\n_No response_",
    "user": {
      "login": "kroese",
      "id": 5763256,
      "node_id": "MDQ6VXNlcjU3NjMyNTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5763256?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kroese",
      "html_url": "https://github.com/kroese",
      "followers_url": "https://api.github.com/users/kroese/followers",
      "following_url": "https://api.github.com/users/kroese/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/kroese/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/kroese/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/kroese/subscriptions",
      "organizations_url": "https://api.github.com/users/kroese/orgs",
      "repos_url": "https://api.github.com/users/kroese/repos",
      "events_url": "https://api.github.com/users/kroese/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/kroese/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 64583,
        "node_id": "MDU6TGFiZWw2NDU4Mw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature",
        "name": "Feature",
        "color": "7cf575",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 10,
    "created_at": "2023-05-13T18:44:59Z",
    "updated_at": "2023-05-16T17:16:11Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 9239063420,
      "node_id": "LE_lADOABII585l2NrBzwAAAAImsOt8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9239063420",
      "actor": {
        "login": "kroese",
        "id": 5763256,
        "node_id": "MDQ6VXNlcjU3NjMyNTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5763256?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kroese",
        "html_url": "https://github.com/kroese",
        "followers_url": "https://api.github.com/users/kroese/followers",
        "following_url": "https://api.github.com/users/kroese/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/kroese/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/kroese/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/kroese/subscriptions",
        "organizations_url": "https://api.github.com/users/kroese/orgs",
        "repos_url": "https://api.github.com/users/kroese/repos",
        "events_url": "https://api.github.com/users/kroese/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/kroese/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-13T18:44:59Z",
      "label": {
        "name": "Feature",
        "color": "7cf575"
      }
    },
    {
      "event": "commented",
      "id": 1546731833,
      "node_id": "IC_kwDOABII585cMUE5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1546731833",
      "actor": {
        "login": "kroese",
        "id": 5763256,
        "node_id": "MDQ6VXNlcjU3NjMyNTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5763256?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kroese",
        "html_url": "https://github.com/kroese",
        "followers_url": "https://api.github.com/users/kroese/followers",
        "following_url": "https://api.github.com/users/kroese/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/kroese/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/kroese/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/kroese/subscriptions",
        "organizations_url": "https://api.github.com/users/kroese/orgs",
        "repos_url": "https://api.github.com/users/kroese/repos",
        "events_url": "https://api.github.com/users/kroese/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/kroese/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-13T19:03:40Z",
      "updated_at": "2023-05-13T19:03:40Z",
      "author_association": "NONE",
      "body": "Maybe @Sjors can look into this?",
      "user": {
        "login": "kroese",
        "id": 5763256,
        "node_id": "MDQ6VXNlcjU3NjMyNTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5763256?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kroese",
        "html_url": "https://github.com/kroese",
        "followers_url": "https://api.github.com/users/kroese/followers",
        "following_url": "https://api.github.com/users/kroese/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/kroese/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/kroese/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/kroese/subscriptions",
        "organizations_url": "https://api.github.com/users/kroese/orgs",
        "repos_url": "https://api.github.com/users/kroese/repos",
        "events_url": "https://api.github.com/users/kroese/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/kroese/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/27652#issuecomment-1546731833",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27652"
    },
    {
      "event": "mentioned",
      "id": 9239083105,
      "node_id": "MEE_lADOABII585l2NrBzwAAAAImsThh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9239083105",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-13T19:03:40Z"
    },
    {
      "event": "subscribed",
      "id": 9239083108,
      "node_id": "SE_lADOABII585l2NrBzwAAAAImsThk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9239083108",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-13T19:03:40Z"
    },
    {
      "event": "commented",
      "id": 1546733957,
      "node_id": "IC_kwDOABII585cMUmF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1546733957",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-13T19:17:24Z",
      "updated_at": "2023-05-13T19:17:24Z",
      "author_association": "MEMBER",
      "body": "> For example, if you run a pruned node, and your first peer happens to be also pruned, the call will fail. If the call tried all nodes, until it finds a peer that has the block, it wouldn't require you that implement any logic for that.\r\n\r\nBased on your words, guess that you are calling `getblockfrompeer` with a fixed index of `1`?\r\nYou could instead use `getpeerinfo` and filter the result by service. Only requesting the block to another full node.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/27652#issuecomment-1546733957",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27652"
    },
    {
      "event": "commented",
      "id": 1546736533,
      "node_id": "IC_kwDOABII585cMVOV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1546736533",
      "actor": {
        "login": "kroese",
        "id": 5763256,
        "node_id": "MDQ6VXNlcjU3NjMyNTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5763256?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kroese",
        "html_url": "https://github.com/kroese",
        "followers_url": "https://api.github.com/users/kroese/followers",
        "following_url": "https://api.github.com/users/kroese/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/kroese/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/kroese/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/kroese/subscriptions",
        "organizations_url": "https://api.github.com/users/kroese/orgs",
        "repos_url": "https://api.github.com/users/kroese/repos",
        "events_url": "https://api.github.com/users/kroese/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/kroese/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-13T19:35:15Z",
      "updated_at": "2023-05-13T19:45:05Z",
      "author_association": "NONE",
      "body": "> Based on your words, guess that you are calling `getblockfrompeer` with a fixed index of `1`?\r\n> You could instead use `getpeerinfo` and filter the result by service. Only requesting the block to another full node.\r\n\r\nI'm aware you could workaround this issue by implementing a bunch of manual logic on the client-side. But even if you skip the pruned nodes and  this full node couldn't provide you the block (for whatever reason), it would be handy if the call would just try the next one.\r\n",
      "user": {
        "login": "kroese",
        "id": 5763256,
        "node_id": "MDQ6VXNlcjU3NjMyNTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5763256?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kroese",
        "html_url": "https://github.com/kroese",
        "followers_url": "https://api.github.com/users/kroese/followers",
        "following_url": "https://api.github.com/users/kroese/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/kroese/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/kroese/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/kroese/subscriptions",
        "organizations_url": "https://api.github.com/users/kroese/orgs",
        "repos_url": "https://api.github.com/users/kroese/repos",
        "events_url": "https://api.github.com/users/kroese/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/kroese/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/27652#issuecomment-1546736533",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27652"
    },
    {
      "event": "commented",
      "id": 1546741712,
      "node_id": "IC_kwDOABII585cMWfQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1546741712",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-13T20:08:08Z",
      "updated_at": "2023-05-13T20:10:15Z",
      "author_association": "MEMBER",
      "body": "> I'm aware you could workaround this issue by implementing a bunch of manual logic on the client-side. But even if you skip the pruned nodes and this full node couldn't provide you the block, it would be handy if the call would just try the next one.\r\n\r\nSure. Was providing you a simple workaround to the described issue.\r\n\r\nI actually have done something similar for #21267 (in that case is a block filter tracker but here will be for blocks only).\r\nSo, I'm happy to work on it. Will tackle it soon.\r\n\r\nSmall note: the \"cannot provide block\" is actually a `getdata` request timeout. The RPC command isn't synchronously fetching the block from the other peer, so the command call will not be the one that tries it again.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/27652#issuecomment-1546741712",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27652"
    },
    {
      "event": "commented",
      "id": 1549226748,
      "node_id": "IC_kwDOABII585cV1L8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1549226748",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-16T08:28:33Z",
      "updated_at": "2023-05-16T08:32:53Z",
      "author_association": "MEMBER",
      "body": "I would like this as well but I was too lazy to implement it.\r\n\r\nThe downside is that it would make the call asynchronous and potentially very long (needing `-rpcclienttimeout=0`). But this would only be the case if the user _doesn't_ specify a peer.\r\n\r\nIt would also need a progress indicator, which our RPC doesn't really offer. The debug log can of course be used for that. Or you could go all fancy and have the node track the status of the block fetch, including the ability to cancel it.\r\n\r\nThe upside is that it can fix the weird quirk that we disconnect from any peer that fails to deliver the block. This is because net_processing works under the assumption that we only ask blocks from peers that told us they have it, so if they don't deliver we assume there's a problem with the peer. But if we try the next peer before this timeout, `BlockRequested` clears the in flight map and no timeout will occur. Well, except for the last attempt.\r\n\r\nYou could also request the block from all peers at the same time, but not without a major refactor (more than #27626 probably).\r\n\r\nFor the pruned node case @furszy is working on things are potentially a bit simpler. All of our non-pruned peers should have the block. That means the user wouldn't need to specifify a peer and instead we can just pick _one_.\r\n\r\nYou could implement that special case for the `getblockfrompeer` RPC:\r\n1. if the user doesn't specify a peer and the block is not an ancestor of the tip, fail with \"must specify peer when fetching a stale block\"; otherwise\r\n2. pick a random non-pruned node and fetch it (fail if we only have pruned peers)",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/27652#issuecomment-1549226748",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27652"
    },
    {
      "event": "mentioned",
      "id": 9255051969,
      "node_id": "MEE_lADOABII585l2NrBzwAAAAInpOLB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9255051969",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-16T08:29:39Z"
    },
    {
      "event": "subscribed",
      "id": 9255051981,
      "node_id": "SE_lADOABII585l2NrBzwAAAAInpOLN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9255051981",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-16T08:29:39Z"
    },
    {
      "event": "commented",
      "id": 1549464215,
      "node_id": "IC_kwDOABII585cWvKX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1549464215",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-16T11:13:47Z",
      "updated_at": "2023-05-16T11:13:47Z",
      "author_association": "MEMBER",
      "body": "I don't think this is hard to implement, and doesn't need #27626 (it wouldn't use compact blocks).\r\n\r\nWe effectively already have a background block download fetching algorithm, that regularly decides which blocks should be fetched from which peers (see `FindNextBlocksToDownload` in net_processing.cpp). I think it should be possible to have a list/set somewhere in the net processing state of CBlockIndexes/uint256s/... of blocks to-redownload. If any peer served by `FindNextBlocksToDownload` happens to have one of those refetch ones, they can get added to the fetching logic.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/27652#issuecomment-1549464215",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27652"
    },
    {
      "event": "commented",
      "id": 1549635506,
      "node_id": "IC_kwDOABII585cXY-y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1549635506",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-16T13:07:01Z",
      "updated_at": "2023-05-16T13:09:01Z",
      "author_association": "MEMBER",
      "body": "Ok great sipa and Sjors. Notes taken.\r\n\r\nI started implementing this in a separate class `BlockRequestTracker` with its own scheduled task to detect the timeout and re-try + follow the requests progress (which also involves listening to the node disconnection signal). But, agree that can also add it to the `FindNextBlocksToDownload` existent mechanism as well.\r\nCould merge both worlds and slowly start decoupling the block downloading logic into a separate module while continue using the `SendMessages` thread to detect timeouts and queue requests.\r\n\r\n> For the pruned node case @furszy is working on things are potentially a bit simpler. All of our non-pruned peers should have the block. That means the user wouldn't need to specifify a peer and instead we can just pick one.\r\n\r\nWell, peers could delay the response or directly not answer. Stalling the post-filter-matching blocks sync mechanism. So, we also need a blocks tracking module in that branch too.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/27652#issuecomment-1549635506",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27652"
    },
    {
      "event": "mentioned",
      "id": 9257932454,
      "node_id": "MEE_lADOABII585l2NrBzwAAAAIn0Nam",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9257932454",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-16T13:07:01Z"
    },
    {
      "event": "subscribed",
      "id": 9257932470,
      "node_id": "SE_lADOABII585l2NrBzwAAAAIn0Na2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9257932470",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-16T13:07:01Z"
    },
    {
      "event": "commented",
      "id": 1549867573,
      "node_id": "IC_kwDOABII585cYRo1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1549867573",
      "actor": {
        "login": "kroese",
        "id": 5763256,
        "node_id": "MDQ6VXNlcjU3NjMyNTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5763256?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kroese",
        "html_url": "https://github.com/kroese",
        "followers_url": "https://api.github.com/users/kroese/followers",
        "following_url": "https://api.github.com/users/kroese/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/kroese/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/kroese/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/kroese/subscriptions",
        "organizations_url": "https://api.github.com/users/kroese/orgs",
        "repos_url": "https://api.github.com/users/kroese/repos",
        "events_url": "https://api.github.com/users/kroese/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/kroese/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-16T15:11:44Z",
      "updated_at": "2023-05-16T15:11:44Z",
      "author_association": "NONE",
      "body": " > Well, peers could delay the response or directly not answer. Stalling the post-filter-matching blocks sync mechanism.\r\n\r\nYes, I think that peers who have reached their `maxuploadtarget` will also refuse to provide the block unless you have the whitelist / `download` permission. So there can be some edge-cases where non-pruned peers still fail to deliver it.",
      "user": {
        "login": "kroese",
        "id": 5763256,
        "node_id": "MDQ6VXNlcjU3NjMyNTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5763256?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kroese",
        "html_url": "https://github.com/kroese",
        "followers_url": "https://api.github.com/users/kroese/followers",
        "following_url": "https://api.github.com/users/kroese/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/kroese/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/kroese/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/kroese/subscriptions",
        "organizations_url": "https://api.github.com/users/kroese/orgs",
        "repos_url": "https://api.github.com/users/kroese/repos",
        "events_url": "https://api.github.com/users/kroese/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/kroese/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/27652#issuecomment-1549867573",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27652"
    },
    {
      "event": "commented",
      "id": 1550028698,
      "node_id": "IC_kwDOABII585cY4-a",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1550028698",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-16T16:51:09Z",
      "updated_at": "2023-05-16T16:51:09Z",
      "author_association": "MEMBER",
      "body": "If it fails you have to try again. It would presumably auto-pick the same peer, so you'd have to revert to manually picking one. Agree that's not ideal.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/27652#issuecomment-1550028698",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27652"
    },
    {
      "event": "commented",
      "id": 1550066620,
      "node_id": "IC_kwDOABII585cZCO8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1550066620",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-16T17:16:11Z",
      "updated_at": "2023-05-16T17:16:11Z",
      "author_association": "MEMBER",
      "body": "> If it fails you have to try again. It would presumably auto-pick the same peer, so you'd have to revert to manually picking one. Agree that's not ideal.\r\n\r\nIf the block request timeouts (fails), we disconnect the peer. So, if someone wants to use this as is now, it's ok to do another RPC call after 10 minutes, when the remote peer is no longer in the `getpeerinfo` response.\r\n\r\nStill, not ideal as it involves some extra RPC calls. Better to keep moving on providing a better tracking mechanism.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/27652#issuecomment-1550066620",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27652"
    }
  ]
}