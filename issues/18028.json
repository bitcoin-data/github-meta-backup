{
  "type": "issue",
  "issue": {
    "id": 557352742,
    "node_id": "MDU6SXNzdWU1NTczNTI3NDI=",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18028",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18028/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18028/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18028/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/18028",
    "number": 18028,
    "state": "closed",
    "state_reason": "completed",
    "title": "Some transactions can't be decoded from hex strings",
    "body": "While testing #18026 @fanquake had a transient error in rpc_rawtransaction.py where combinerawtransaction failed. The inputs to combinerawtransaction were two partial transactions:\r\n\r\n```\r\n0200000000010104d5aa747ccd13d493aa4bf33b71752f23ef2c2fcff094d0d35aaa87aa4a0b260000000000ffffffff01c0ac0d0d00000000160014ec9331188271ac1a2629108e3ae0cde4589a0a4a0400473044022035e173a3fe3b7019dc8d4457f588711adf3453ff28df630db0dd720b5ed9fd0e022034b118b826af7f10fd4c197b69ffc0e6391b746f40fdf50f08dc95bf3fd657e1010047522103d23bb22861a28722b924c48169a969aff7d1c2ae121a8c7bbabbfb203acff9032103aee7be172b78cc85b65059408c320a9988a6bdba9580666facc1f4f16ee75ea552ae00000000\r\n\r\n0200000000010104d5aa747ccd13d493aa4bf33b71752f23ef2c2fcff094d0d35aaa87aa4a0b260000000000ffffffff01c0ac0d0d00000000160014ec9331188271ac1a2629108e3ae0cde4589a0a4a040047304402201a91b10bc44d9ad9a0b57fde36ff776585de71e9b4625803d43507589f31c53d02205bb0f42bafe669b6e144d3bdb235b5d3333dc478636a1d1c6ee2e2160ad28f49010047522103d23bb22861a28722b924c48169a969aff7d1c2ae121a8c7bbabbfb203acff9032103aee7be172b78cc85b65059408c320a9988a6bdba9580666facc1f4f16ee75ea552ae00000000\r\n```\r\n\r\nBut the first first of these decodes \"incorrectly\" as:\r\n\r\n```\r\n{\r\n  \"txid\": \"90839dcde19bb9578ebcdf34ddea1eee5936fb8a17b5b1d36e9e7a1cd2093123\",\r\n  \"hash\": \"90839dcde19bb9578ebcdf34ddea1eee5936fb8a17b5b1d36e9e7a1cd2093123\",\r\n  \"version\": 2,\r\n  \"size\": 231,\r\n  \"vsize\": 231,\r\n  \"weight\": 924,\r\n  \"locktime\": 0,\r\n  \"vin\": [\r\n  ],\r\n  \"vout\": [\r\n    {\r\n      \"value\": 14269334974.70452737,\r\n      \"n\": 0,\r\n      \"scriptPubKey\": {\r\n        \"asm\": \"OP_ADD OP_HASH256 f33b71752f23ef2c2fcff094d0d35aaa87aa4a0b260000000000ffffffff01c0ac0d0d00000000160014ec9331188271ac1a2629108e3ae0cde4589a0a4a0400473044022035e173a3fe3b OP_2OVER dc8d4457f588711adf3453ff28df630db0dd720b5ed9fd0e02 34b118b826af7f10fd4c197b69ffc0e6391b746f40fdf50f08dc95bf3fd657e1 0 522103d23bb22861a28722b924c48169a969aff7d1c2ae121a8c7bbabbfb203acff9032103aee7be172b78cc85b65059408c320a9988a6bdba9580666facc1f4f16ee75ea552ae\",\r\n        \"hex\": \"93aa4bf33b71752f23ef2c2fcff094d0d35aaa87aa4a0b260000000000ffffffff01c0ac0d0d00000000160014ec9331188271ac1a2629108e3ae0cde4589a0a4a0400473044022035e173a3fe3b7019dc8d4457f588711adf3453ff28df630db0dd720b5ed9fd0e022034b118b826af7f10fd4c197b69ffc0e6391b746f40fdf50f08dc95bf3fd657e1010047522103d23bb22861a28722b924c48169a969aff7d1c2ae121a8c7bbabbfb203acff9032103aee7be172b78cc85b65059408c320a9988a6bdba9580666facc1f4f16ee75ea552ae\",\r\n        \"type\": \"nonstandard\"\r\n      }\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nbecause the flag gets decoded as \"00\" - no inputs, \"01\" - one output, the vin count and the last 15 bytes of the input txid get decoded as the output amount, and the sixteenth last byte of the input txid happens to be `0xd4` and there happen to be that many bytes left prior to the final sequence number, so it decodes successfully as a witlessness transaction, and everything breaks.\r\n\r\nFor short transactions (less than 282 bytes or 564 hex digits) that's a 1-in-256 chance of failure. (For longer transactions it's a 1-in-16M chance of failure or less, so that's probably no big deal)",
    "user": {
      "login": "ajtowns",
      "id": 127186,
      "node_id": "MDQ6VXNlcjEyNzE4Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajtowns",
      "html_url": "https://github.com/ajtowns",
      "followers_url": "https://api.github.com/users/ajtowns/followers",
      "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
      "organizations_url": "https://api.github.com/users/ajtowns/orgs",
      "repos_url": "https://api.github.com/users/ajtowns/repos",
      "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/ajtowns/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 64585,
        "node_id": "MDU6TGFiZWw2NDU4NQ==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug",
        "name": "Bug",
        "color": "FBBAAB",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": false,
    "comments": 3,
    "closed_at": "2022-08-04T09:29:13Z",
    "created_at": "2020-01-30T09:02:34Z",
    "updated_at": "2022-08-04T09:29:13Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 2992485228,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDI5OTI0ODUyMjg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2992485228",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-01-30T09:02:34Z",
      "label": {
        "name": "Bug",
        "color": "FBBAAB"
      }
    },
    {
      "event": "mentioned",
      "id": 2992485241,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50Mjk5MjQ4NTI0MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2992485241",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-01-30T09:02:35Z"
    },
    {
      "event": "subscribed",
      "id": 2992485243,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDI5OTI0ODUyNDM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2992485243",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-01-30T09:02:35Z"
    },
    {
      "event": "commented",
      "id": 580162933,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU4MDE2MjkzMw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580162933",
      "actor": {
        "login": "meshcollider",
        "id": 3211283,
        "node_id": "MDQ6VXNlcjMyMTEyODM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/meshcollider",
        "html_url": "https://github.com/meshcollider",
        "followers_url": "https://api.github.com/users/meshcollider/followers",
        "following_url": "https://api.github.com/users/meshcollider/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/meshcollider/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/meshcollider/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
        "organizations_url": "https://api.github.com/users/meshcollider/orgs",
        "repos_url": "https://api.github.com/users/meshcollider/repos",
        "events_url": "https://api.github.com/users/meshcollider/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/meshcollider/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-01-30T09:27:25Z",
      "updated_at": "2020-01-30T09:27:25Z",
      "author_association": "CONTRIBUTOR",
      "body": "Related to #9522 I believe",
      "user": {
        "login": "meshcollider",
        "id": 3211283,
        "node_id": "MDQ6VXNlcjMyMTEyODM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3211283?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/meshcollider",
        "html_url": "https://github.com/meshcollider",
        "followers_url": "https://api.github.com/users/meshcollider/followers",
        "following_url": "https://api.github.com/users/meshcollider/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/meshcollider/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/meshcollider/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/meshcollider/subscriptions",
        "organizations_url": "https://api.github.com/users/meshcollider/orgs",
        "repos_url": "https://api.github.com/users/meshcollider/repos",
        "events_url": "https://api.github.com/users/meshcollider/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/meshcollider/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/18028#issuecomment-580162933",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18028"
    },
    {
      "event": "commented",
      "id": 580175209,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU4MDE3NTIwOQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580175209",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-01-30T09:55:21Z",
      "updated_at": "2020-01-30T09:55:21Z",
      "author_association": "MEMBER",
      "body": "> Related to #9522 I believe\r\n\r\nYep, that's explains why this is much less likely than a 1-in-256 chance. Adding an additional sanity check for `tx.vout[i].nValue < 0 || tx.vout[i].nValue > MAX_MONEY` would fix the particular case, and reduce the chances of hitting this accidently by another 1-in-10,000.",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/18028#issuecomment-580175209",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18028"
    },
    {
      "event": "commented",
      "id": 580258209,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU4MDI1ODIwOQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580258209",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-01-30T13:41:37Z",
      "updated_at": "2020-01-30T13:41:37Z",
      "author_association": "MEMBER",
      "body": "Is this fixed by #17775 ?",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/18028#issuecomment-580258209",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18028"
    },
    {
      "event": "closed",
      "id": 7126103701,
      "node_id": "CE_lADOABII584hOIcmzwAAAAGov7aV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7126103701",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-04T09:29:13Z"
    }
  ]
}