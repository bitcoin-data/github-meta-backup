{
  "type": "issue",
  "issue": {
    "id": 184478152,
    "node_id": "MDU6SXNzdWUxODQ0NzgxNTI=",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8991",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8991/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8991/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8991/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/8991",
    "number": 8991,
    "state": "closed",
    "state_reason": "completed",
    "title": "Sighash calculation",
    "body": "Probably I am doing something wrong but the documentation is not very clear (and not very new), or I did not find it, except http://enetium.com/resources/Bitcoin.pdf which probably would deserve to be better referenced\n\nI am using test transactions 226a8b08dc46a00e9ecec5567a303a0b354bef3c1674476eb5e4b627b2ace493 whose preceding tx is 40872a376e98a1f8b285827c2ad8c5b3eec7d779d752dc3a4adda5d9bb70f3b5, these are probably @petertodd's transactions (226a... is the preceding tx of the recent DPL post from Peter)\n\nThen if I am correct the result to be computed should be:\n\n`0100000001b5f370bbd9a5dd4a3adc52d779d7c7eeb3c5d82a7c8285b2f8a1986e372a874000000000232102d5ddb8c9a2bc17624baa51245ef3c07380f90b2e2f38217307a8a1869508ca01feffffff02d75900000000000017a914ea4e30950c2495beba1e75e035bedd55ccfe4c9b874dd51d00000000001976a914676de8484253cd355c37fc51ba34f2e5d62a944088acb69f060001000000`\n\nBut the public key recovery leads to a public key fd5b0de93dae9f462788459ef96e6331e5b20b515de35e651c369aad20af4966 or 8f4df599d8dddca73d391f495537c9af7b7616b13e91a024fce33fc1fb9af0df for point x and not the expected d5ddb8c9a2bc17624baa51245ef3c07380f90b2e2f38217307a8a1869508ca01\n\nThe code is simply:\n\n``` javascript\nvar signature = new Buffer('3044022057a1234709270325e7215200f982546304cf465971cbd55d54231ead54ef1a7802207a82e93ef2b0f87188abe87bccb67ee9d5c650b1b58948e5b1c80ba1b4c43dc3','hex');\nvar message=new Buffer('0100000001b5f370bbd9a5dd4a3adc52d779d7c7eeb3c5d82a7c8285b2f8a1986e372a874000000000232102d5ddb8c9a2bc17624baa51245ef3c07380f90b2e2f38217307a8a1869508ca01feffffff02d75900000000000017a914ea4e30950c2495beba1e75e035bedd55ccfe4c9b874dd51d00000000001976a914676de8484253cd355c37fc51ba34f2e5d62a944088acb69f060001000000','hex');\nmessage=crypto.createHash('sha256').update(message).digest();\nmessage=crypto.createHash('sha256').update(message).digest();\n//<Buffer 2b 6d 20 06 78 4d 92 c4 da 3e 6d a8 6b ce c4 6b 6b 8a 18 9f 72 75 e1 e9 68 71 2b 91 96 7d 44 39>\ntry {\n    var pub=ec.recoverPubKey(message,signature,0);\n    console.log(pub);\n} catch(ee) {}\ntry {\n    pub=ec.recoverPubKey(message,signature,1);\n    console.log(pub);\n} catch(ee) {}\ntry {\n    pub=ec.recoverPubKey(message,signature,2);\n    console.log(pub);\n} catch(ee) {}\ntry {\n    pub=ec.recoverPubKey(message,signature,3);\n    console.log(pub);\n} catch(ee) {}\n```\n\nSame method used with the example given in https://en.bitcoin.it/wiki/OP_CHECKSIG works\n",
    "user": {
      "login": "Ayms",
      "id": 759202,
      "node_id": "MDQ6VXNlcjc1OTIwMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/759202?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Ayms",
      "html_url": "https://github.com/Ayms",
      "followers_url": "https://api.github.com/users/Ayms/followers",
      "following_url": "https://api.github.com/users/Ayms/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/Ayms/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/Ayms/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/Ayms/subscriptions",
      "organizations_url": "https://api.github.com/users/Ayms/orgs",
      "repos_url": "https://api.github.com/users/Ayms/repos",
      "events_url": "https://api.github.com/users/Ayms/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/Ayms/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [],
    "assignees": [],
    "author_association": "NONE",
    "locked": true,
    "active_lock_reason": "resolved",
    "comments": 2,
    "closed_at": "2016-10-21T17:18:30Z",
    "created_at": "2016-10-21T12:58:37Z",
    "updated_at": "2021-09-08T12:43:20Z"
  },
  "events": [
    {
      "event": "mentioned",
      "id": 831987483,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50ODMxOTg3NDgz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/831987483",
      "actor": {
        "login": "petertodd",
        "id": 7042,
        "node_id": "MDQ6VXNlcjcwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/petertodd",
        "html_url": "https://github.com/petertodd",
        "followers_url": "https://api.github.com/users/petertodd/followers",
        "following_url": "https://api.github.com/users/petertodd/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/petertodd/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/petertodd/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/petertodd/subscriptions",
        "organizations_url": "https://api.github.com/users/petertodd/orgs",
        "repos_url": "https://api.github.com/users/petertodd/repos",
        "events_url": "https://api.github.com/users/petertodd/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/petertodd/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-10-21T12:58:37Z"
    },
    {
      "event": "subscribed",
      "id": 831987484,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDgzMTk4NzQ4NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/831987484",
      "actor": {
        "login": "petertodd",
        "id": 7042,
        "node_id": "MDQ6VXNlcjcwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/petertodd",
        "html_url": "https://github.com/petertodd",
        "followers_url": "https://api.github.com/users/petertodd/followers",
        "following_url": "https://api.github.com/users/petertodd/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/petertodd/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/petertodd/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/petertodd/subscriptions",
        "organizations_url": "https://api.github.com/users/petertodd/orgs",
        "repos_url": "https://api.github.com/users/petertodd/repos",
        "events_url": "https://api.github.com/users/petertodd/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/petertodd/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-10-21T12:58:37Z"
    },
    {
      "event": "commented",
      "id": 255372814,
      "node_id": "MDEyOklzc3VlQ29tbWVudDI1NTM3MjgxNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/255372814",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-10-21T13:12:35Z",
      "updated_at": "2016-10-21T13:12:35Z",
      "author_association": "MEMBER",
      "body": "This is an issue tracker for Bitcoin Core, not the place to ask questions about how Bitcoin works. Please take your question to http://bitcoin.stackexchange.com/ and close this issue.\n",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/8991#issuecomment-255372814",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8991"
    },
    {
      "event": "commented",
      "id": 255429050,
      "node_id": "MDEyOklzc3VlQ29tbWVudDI1NTQyOTA1MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/255429050",
      "actor": {
        "login": "Ayms",
        "id": 759202,
        "node_id": "MDQ6VXNlcjc1OTIwMg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/759202?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Ayms",
        "html_url": "https://github.com/Ayms",
        "followers_url": "https://api.github.com/users/Ayms/followers",
        "following_url": "https://api.github.com/users/Ayms/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Ayms/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Ayms/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Ayms/subscriptions",
        "organizations_url": "https://api.github.com/users/Ayms/orgs",
        "repos_url": "https://api.github.com/users/Ayms/repos",
        "events_url": "https://api.github.com/users/Ayms/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Ayms/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-10-21T17:18:28Z",
      "updated_at": "2016-10-21T17:18:28Z",
      "author_association": "NONE",
      "body": "Missing OP_CHECKSIG in the subscript, the correct result is:\n\n`0100000001b5f370bbd9a5dd4a3adc52d779d7c7eeb3c5d82a7c8285b2f8a1986e372a874000000000232102d5ddb8c9a2bc17624baa51245ef3c07380f90b2e2f38217307a8a1869508ca01acfeffffff02d75900000000000017a914ea4e30950c2495beba1e75e035bedd55ccfe4c9b874dd51d00000000001976a914676de8484253cd355c37fc51ba34f2e5d62a944088acb69f060001000000`\n\nSo closing but might be of some use for other people later to understand how this thing works, since the docs are unclear and a 8 years old example from the genesis block does not help a lot, as well as the bitcoin core test vectors\n",
      "user": {
        "login": "Ayms",
        "id": 759202,
        "node_id": "MDQ6VXNlcjc1OTIwMg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/759202?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Ayms",
        "html_url": "https://github.com/Ayms",
        "followers_url": "https://api.github.com/users/Ayms/followers",
        "following_url": "https://api.github.com/users/Ayms/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Ayms/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Ayms/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Ayms/subscriptions",
        "organizations_url": "https://api.github.com/users/Ayms/orgs",
        "repos_url": "https://api.github.com/users/Ayms/repos",
        "events_url": "https://api.github.com/users/Ayms/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Ayms/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/8991#issuecomment-255429050",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/8991"
    },
    {
      "event": "closed",
      "id": 832305504,
      "node_id": "MDExOkNsb3NlZEV2ZW50ODMyMzA1NTA0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/832305504",
      "actor": {
        "login": "Ayms",
        "id": 759202,
        "node_id": "MDQ6VXNlcjc1OTIwMg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/759202?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Ayms",
        "html_url": "https://github.com/Ayms",
        "followers_url": "https://api.github.com/users/Ayms/followers",
        "following_url": "https://api.github.com/users/Ayms/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Ayms/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Ayms/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Ayms/subscriptions",
        "organizations_url": "https://api.github.com/users/Ayms/orgs",
        "repos_url": "https://api.github.com/users/Ayms/repos",
        "events_url": "https://api.github.com/users/Ayms/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Ayms/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-10-21T17:18:30Z"
    },
    {
      "event": "locked",
      "id": 5272061276,
      "node_id": "LOE_lADOABII584K_unIzwAAAAE6PUVc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5272061276",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-08T12:43:20Z",
      "lock_reason": "resolved"
    }
  ]
}