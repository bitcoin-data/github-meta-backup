{
  "type": "issue",
  "issue": {
    "id": 843446029,
    "node_id": "MDU6SXNzdWU4NDM0NDYwMjk=",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21547",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21547/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21547/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21547/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/21547",
    "number": 21547,
    "state": "closed",
    "state_reason": "completed",
    "title": "PSBT strange behavior",
    "body": "<!-- Describe the issue -->\r\nHi,\r\n\r\nI am trying to set-up a ColdCard to work air-gapped with Bitcoin Core (via SD card). Latest Bitcoin Core 0.21.0 and latest ColdCard firmware used.\r\n\r\n**Expected behavior**\r\n<!--- What behavior did you expect? -->\r\n\r\nI Create a watch-only non-descriptor wallet and I execute the importmulti command created by ColdCard (2x5000 addresses).\r\n\r\n- I do a two simple (1in 1 out) test transactions (main-net) all looks good. Core exports the PSBT file ~600 bytes. Coldcard signs it and creates the final TXN ~400 bytes. All good.\r\n- \r\nI believe the exported unsigned PSBT should stay small, but it's not.\r\n**Actual behavior**\r\n\r\n<!--- What was the actual behavior (provide screenshots if the issue is GUI-related)? -->\r\nNothing changed (I mean Core closed and reopened few hours later, that's all). New TX arrives in. Trying to do the same spend and PSBT export. Exported PSBT file is now ~176 Kilobytes(!!). See attached partial file.\r\n[PSBTPartial.txt](https://github.com/bitcoin/bitcoin/files/6222545/PSBTPartial.txt)\r\n\r\nTakes minutes while ColdCard digs through all of that and finally signs the one used and produces a ~400 bytes TXN with the one input one output.\r\n\r\nNothing fancy is going on, no multisig used, no nothing. Why does Core include a lot/all addresses in a PSBT? Also it's not doing it at the beginning.\r\n\r\n**To reproduce**\r\n- Create a watch-only non-descriptor wallet and I execute the importmulti command created by ColdCard (2x5000 addresses)\r\nimportdescriptors '[{\"range\": [0, 5000], \"timestamp\": \"now\", \"active\": true, \"watchonly\": true, \"desc\": \"pkh([XX/44h/0h/0h]xpubXX/0/*)#XX\", \"internal\": false}, {\"range\": [0, 5000], \"timestamp\": \"now\", \"active\": true, \"watchonly\": true, \"desc\": \"pkh([XX/44h/0h/0h]xpubXX/1/*)#XX\", \"internal\": true}]'\r\n- Check you received the correct addresses from Core\r\n- Make two receive and send (full) amount transaction to/from on other wallet\r\n- Now you should see the huge PSBT file now.\r\n\r\nI have done this from scratch with BIP44 and BIP84 addresses and both suffer from the same issue.\r\n\r\n**System information**\r\nCore v0.21.0 from download\r\nAMD 2920X Win10 x64\r\n",
    "user": {
      "login": "GhostOfSatoshi",
      "id": 60771378,
      "node_id": "MDQ6VXNlcjYwNzcxMzc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/60771378?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/GhostOfSatoshi",
      "html_url": "https://github.com/GhostOfSatoshi",
      "followers_url": "https://api.github.com/users/GhostOfSatoshi/followers",
      "following_url": "https://api.github.com/users/GhostOfSatoshi/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/GhostOfSatoshi/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/GhostOfSatoshi/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/GhostOfSatoshi/subscriptions",
      "organizations_url": "https://api.github.com/users/GhostOfSatoshi/orgs",
      "repos_url": "https://api.github.com/users/GhostOfSatoshi/repos",
      "events_url": "https://api.github.com/users/GhostOfSatoshi/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/GhostOfSatoshi/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 477890092,
        "node_id": "MDU6TGFiZWw0Nzc4OTAwOTI=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Questions%20and%20Help",
        "name": "Questions and Help",
        "color": "006688",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": true,
    "active_lock_reason": "resolved",
    "comments": 2,
    "closed_at": "2021-03-29T16:05:32Z",
    "created_at": "2021-03-29T14:46:30Z",
    "updated_at": "2022-08-18T19:53:03Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 4521977434,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDQ1MjE5Nzc0MzQ=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4521977434",
      "actor": {
        "login": "GhostOfSatoshi",
        "id": 60771378,
        "node_id": "MDQ6VXNlcjYwNzcxMzc4",
        "avatar_url": "https://avatars.githubusercontent.com/u/60771378?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/GhostOfSatoshi",
        "html_url": "https://github.com/GhostOfSatoshi",
        "followers_url": "https://api.github.com/users/GhostOfSatoshi/followers",
        "following_url": "https://api.github.com/users/GhostOfSatoshi/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/GhostOfSatoshi/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/GhostOfSatoshi/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/GhostOfSatoshi/subscriptions",
        "organizations_url": "https://api.github.com/users/GhostOfSatoshi/orgs",
        "repos_url": "https://api.github.com/users/GhostOfSatoshi/repos",
        "events_url": "https://api.github.com/users/GhostOfSatoshi/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/GhostOfSatoshi/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-03-29T14:46:30Z",
      "label": {
        "name": "Bug",
        "color": "FBBAAB"
      }
    },
    {
      "event": "commented",
      "id": 809507061,
      "node_id": "MDEyOklzc3VlQ29tbWVudDgwOTUwNzA2MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/809507061",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-03-29T16:03:27Z",
      "updated_at": "2021-03-29T16:03:27Z",
      "author_association": "MEMBER",
      "body": "This is expected behavior. Bitcoin Core is not including a lot of addresses in the PSBT. It is including an entire previous transaction which happens to be enormous. Due to the way that signing works currently, many airgapped/offline/hardware signers need the entire previous transaction for each input in order to verify the correctness of amounts before they sign the transaction. As such, PSBT includes entire previous transactions. Sometimes this results in very large PSBTs when previous transactions are themselves large. In this case, the previous transaction for the input in this transaction is very large - it is 131953 bytes. You can see this in the `non_witness_utxo` field of the input.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/21547#issuecomment-809507061",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21547"
    },
    {
      "event": "closed",
      "id": 4522436654,
      "node_id": "MDExOkNsb3NlZEV2ZW50NDUyMjQzNjY1NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4522436654",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-03-29T16:05:32Z"
    },
    {
      "event": "unlabeled",
      "id": 4522437580,
      "node_id": "MDE0OlVubGFiZWxlZEV2ZW50NDUyMjQzNzU4MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4522437580",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-03-29T16:05:42Z",
      "label": {
        "name": "Bug",
        "color": "FBBAAB"
      }
    },
    {
      "event": "labeled",
      "id": 4522437588,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDQ1MjI0Mzc1ODg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4522437588",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-03-29T16:05:42Z",
      "label": {
        "name": "Questions and Help",
        "color": "006688"
      }
    },
    {
      "event": "commented",
      "id": 809571807,
      "node_id": "MDEyOklzc3VlQ29tbWVudDgwOTU3MTgwNw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/809571807",
      "actor": {
        "login": "GhostOfSatoshi",
        "id": 60771378,
        "node_id": "MDQ6VXNlcjYwNzcxMzc4",
        "avatar_url": "https://avatars.githubusercontent.com/u/60771378?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/GhostOfSatoshi",
        "html_url": "https://github.com/GhostOfSatoshi",
        "followers_url": "https://api.github.com/users/GhostOfSatoshi/followers",
        "following_url": "https://api.github.com/users/GhostOfSatoshi/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/GhostOfSatoshi/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/GhostOfSatoshi/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/GhostOfSatoshi/subscriptions",
        "organizations_url": "https://api.github.com/users/GhostOfSatoshi/orgs",
        "repos_url": "https://api.github.com/users/GhostOfSatoshi/repos",
        "events_url": "https://api.github.com/users/GhostOfSatoshi/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/GhostOfSatoshi/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-03-29T17:35:32Z",
      "updated_at": "2021-03-29T17:35:32Z",
      "author_association": "NONE",
      "body": "I see and kind of makes sense now (and see why it includes addresses I have no clue about).\r\n\r\nThanks for the clarification!",
      "user": {
        "login": "GhostOfSatoshi",
        "id": 60771378,
        "node_id": "MDQ6VXNlcjYwNzcxMzc4",
        "avatar_url": "https://avatars.githubusercontent.com/u/60771378?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/GhostOfSatoshi",
        "html_url": "https://github.com/GhostOfSatoshi",
        "followers_url": "https://api.github.com/users/GhostOfSatoshi/followers",
        "following_url": "https://api.github.com/users/GhostOfSatoshi/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/GhostOfSatoshi/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/GhostOfSatoshi/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/GhostOfSatoshi/subscriptions",
        "organizations_url": "https://api.github.com/users/GhostOfSatoshi/orgs",
        "repos_url": "https://api.github.com/users/GhostOfSatoshi/repos",
        "events_url": "https://api.github.com/users/GhostOfSatoshi/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/GhostOfSatoshi/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/21547#issuecomment-809571807",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21547"
    },
    {
      "event": "locked",
      "id": 7217166263,
      "node_id": "LOE_lADOABII584yRfcNzwAAAAGuLTe3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7217166263",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-18T19:53:03Z",
      "lock_reason": "resolved"
    }
  ]
}