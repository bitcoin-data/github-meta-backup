{
  "type": "issue",
  "issue": {
    "id": 28562681,
    "node_id": "MDU6SXNzdWUyODU2MjY4MQ==",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/3774",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/3774/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/3774/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/3774/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/3774",
    "number": 3774,
    "state": "closed",
    "state_reason": "completed",
    "title": "large orphan transactions are left in askfor queue even when rejected",
    "body": "i.e. in the debug.log extract below, at 18:02:59 the tx is added to the askfor queue for node 6, the tx then comes through from node 2 and is rejected, but it stays in the askfor queue for node 6 because at 18:04:58 a getdata tx is sent to node 6.\n\nThe tx is also requested from other nodes, but this is because the inv for the tx comes through after the tx is rejected and the node doesn't keep track of recently rejected txs. This would involve a different fix (e.g. remembering rejected txs for a minute after rejecting them) - I've already raised a separate issue for this.\n\n2014-03-01 18:02:59 received: inv (37 bytes) node=2\n2014-03-01 18:02:59   got inventory: tx bc03a05296148ea7bc94f012f64be8c67a67bbe600b653468268a9e7a8310859  new\n2014-03-01 18:02:59 askfor tx bc03a05296148ea7bc94f012f64be8c67a67bbe600b653468268a9e7a8310859   0 (00:00:00)\n2014-03-01 18:02:59 sending getdata: tx bc03a05296148ea7bc94f012f64be8c67a67bbe600b653468268a9e7a8310859 node=2\n2014-03-01 18:02:59 received: inv (37 bytes) node=6\n2014-03-01 18:02:59   got inventory: tx bc03a05296148ea7bc94f012f64be8c67a67bbe600b653468268a9e7a8310859  new\n2014-03-01 18:02:59 askfor tx bc03a05296148ea7bc94f012f64be8c67a67bbe600b653468268a9e7a8310859   1393696978288703 (18:02:58)\n2014-03-01 18:02:59 received: tx (5018 bytes) node=2\n2014-03-01 18:02:59 ignoring large orphan tx (size: 5018, hash: bc03a05296148ea7bc94f012f64be8c67a67bbe600b653468268a9e7a8310859)\n2014-03-01 18:02:59 received: inv (37 bytes) node=4\n2014-03-01 18:02:59   got inventory: tx bc03a05296148ea7bc94f012f64be8c67a67bbe600b653468268a9e7a8310859  new\n2014-03-01 18:02:59 askfor tx bc03a05296148ea7bc94f012f64be8c67a67bbe600b653468268a9e7a8310859   1393697098288703 (18:04:58)\n2014-03-01 18:02:59 received: inv (73 bytes) node=7\n2014-03-01 18:02:59   got inventory: tx f79daee8051ef70319a53f9e0bb69c6f9034b4f24ba33efa63ceaa1d6383a7a2  have\n2014-03-01 18:02:59   got inventory: tx bc03a05296148ea7bc94f012f64be8c67a67bbe600b653468268a9e7a8310859  new\n2014-03-01 18:02:59 askfor tx bc03a05296148ea7bc94f012f64be8c67a67bbe600b653468268a9e7a8310859   1393697218288703 (18:06:58)\n2014-03-01 18:03:01 received: inv (109 bytes) node=3\n2014-03-01 18:03:01   got inventory: tx bc03a05296148ea7bc94f012f64be8c67a67bbe600b653468268a9e7a8310859  new\n2014-03-01 18:03:01 askfor tx bc03a05296148ea7bc94f012f64be8c67a67bbe600b653468268a9e7a8310859   1393697338288703 (18:08:58)\n2014-03-01 18:03:01 received: inv (73 bytes) node=8\n2014-03-01 18:03:01   got inventory: tx bc03a05296148ea7bc94f012f64be8c67a67bbe600b653468268a9e7a8310859  new\n2014-03-01 18:03:01 askfor tx bc03a05296148ea7bc94f012f64be8c67a67bbe600b653468268a9e7a8310859   1393697458288703 (18:10:58)\n2014-03-01 18:04:58 sending getdata: tx bc03a05296148ea7bc94f012f64be8c67a67bbe600b653468268a9e7a8310859 node=6\n2014-03-01 18:04:58 received: tx (5018 bytes) node=6\n2014-03-01 18:04:58 ignoring large orphan tx (size: 5018, hash: bc03a05296148ea7bc94f012f64be8c67a67bbe600b653468268a9e7a8310859)\n2014-03-01 18:06:58 sending getdata: tx bc03a05296148ea7bc94f012f64be8c67a67bbe600b653468268a9e7a8310859 node=4\n2014-03-01 18:08:58 sending getdata: tx bc03a05296148ea7bc94f012f64be8c67a67bbe600b653468268a9e7a8310859 node=7\n2014-03-01 18:10:58 sending getdata: tx bc03a05296148ea7bc94f012f64be8c67a67bbe600b653468268a9e7a8310859 node=3\n2014-03-01 18:12:58 sending getdata: tx bc03a05296148ea7bc94f012f64be8c67a67bbe600b653468268a9e7a8310859 node=8\n",
    "user": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/rebroad/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/rebroad/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "locked": true,
    "active_lock_reason": "resolved",
    "comments": 3,
    "closed_at": "2016-12-27T16:05:50Z",
    "created_at": "2014-03-01T18:32:22Z",
    "updated_at": "2021-09-08T12:25:13Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 36432489,
      "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDMyNDg5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/36432489",
      "actor": {
        "login": "rebroad",
        "id": 1530283,
        "node_id": "MDQ6VXNlcjE1MzAyODM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rebroad",
        "html_url": "https://github.com/rebroad",
        "followers_url": "https://api.github.com/users/rebroad/followers",
        "following_url": "https://api.github.com/users/rebroad/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rebroad/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rebroad/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
        "organizations_url": "https://api.github.com/users/rebroad/orgs",
        "repos_url": "https://api.github.com/users/rebroad/repos",
        "events_url": "https://api.github.com/users/rebroad/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rebroad/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2014-03-01T18:36:26Z",
      "updated_at": "2014-08-29T08:17:00Z",
      "author_association": "CONTRIBUTOR",
      "body": "I'm happy to work on a fix for this (including remembering rejecting transactions for a minute after they've been rejected) if anyone thinks this would be useful functionality. Please let me know.\n",
      "user": {
        "login": "rebroad",
        "id": 1530283,
        "node_id": "MDQ6VXNlcjE1MzAyODM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rebroad",
        "html_url": "https://github.com/rebroad",
        "followers_url": "https://api.github.com/users/rebroad/followers",
        "following_url": "https://api.github.com/users/rebroad/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rebroad/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rebroad/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
        "organizations_url": "https://api.github.com/users/rebroad/orgs",
        "repos_url": "https://api.github.com/users/rebroad/repos",
        "events_url": "https://api.github.com/users/rebroad/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rebroad/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/3774#issuecomment-36432489",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/3774"
    },
    {
      "event": "labeled",
      "id": 147591479,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDE0NzU5MTQ3OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/147591479",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2014-07-31T08:10:50Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    },
    {
      "event": "commented",
      "id": 50831289,
      "node_id": "MDEyOklzc3VlQ29tbWVudDUwODMxMjg5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/50831289",
      "actor": {
        "login": "kazcw",
        "id": 1047859,
        "node_id": "MDQ6VXNlcjEwNDc4NTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1047859?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kazcw",
        "html_url": "https://github.com/kazcw",
        "followers_url": "https://api.github.com/users/kazcw/followers",
        "following_url": "https://api.github.com/users/kazcw/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/kazcw/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/kazcw/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/kazcw/subscriptions",
        "organizations_url": "https://api.github.com/users/kazcw/orgs",
        "repos_url": "https://api.github.com/users/kazcw/repos",
        "events_url": "https://api.github.com/users/kazcw/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/kazcw/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2014-07-31T23:18:13Z",
      "updated_at": "2014-07-31T23:18:13Z",
      "author_association": "CONTRIBUTOR",
      "body": "I think #4542 effectively implements your suggested fix\n",
      "user": {
        "login": "kazcw",
        "id": 1047859,
        "node_id": "MDQ6VXNlcjEwNDc4NTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1047859?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kazcw",
        "html_url": "https://github.com/kazcw",
        "followers_url": "https://api.github.com/users/kazcw/followers",
        "following_url": "https://api.github.com/users/kazcw/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/kazcw/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/kazcw/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/kazcw/subscriptions",
        "organizations_url": "https://api.github.com/users/kazcw/orgs",
        "repos_url": "https://api.github.com/users/kazcw/repos",
        "events_url": "https://api.github.com/users/kazcw/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/kazcw/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/3774#issuecomment-50831289",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/3774"
    },
    {
      "event": "commented",
      "id": 269345334,
      "node_id": "MDEyOklzc3VlQ29tbWVudDI2OTM0NTMzNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/269345334",
      "actor": {
        "login": "rebroad",
        "id": 1530283,
        "node_id": "MDQ6VXNlcjE1MzAyODM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rebroad",
        "html_url": "https://github.com/rebroad",
        "followers_url": "https://api.github.com/users/rebroad/followers",
        "following_url": "https://api.github.com/users/rebroad/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rebroad/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rebroad/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
        "organizations_url": "https://api.github.com/users/rebroad/orgs",
        "repos_url": "https://api.github.com/users/rebroad/repos",
        "events_url": "https://api.github.com/users/rebroad/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rebroad/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-12-27T16:05:50Z",
      "updated_at": "2016-12-27T16:05:50Z",
      "author_association": "CONTRIBUTOR",
      "body": "#7079 probably fixed this",
      "user": {
        "login": "rebroad",
        "id": 1530283,
        "node_id": "MDQ6VXNlcjE1MzAyODM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rebroad",
        "html_url": "https://github.com/rebroad",
        "followers_url": "https://api.github.com/users/rebroad/followers",
        "following_url": "https://api.github.com/users/rebroad/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rebroad/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rebroad/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
        "organizations_url": "https://api.github.com/users/rebroad/orgs",
        "repos_url": "https://api.github.com/users/rebroad/repos",
        "events_url": "https://api.github.com/users/rebroad/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rebroad/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/3774#issuecomment-269345334",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/3774"
    },
    {
      "event": "closed",
      "id": 905820714,
      "node_id": "MDExOkNsb3NlZEV2ZW50OTA1ODIwNzE0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/905820714",
      "actor": {
        "login": "rebroad",
        "id": 1530283,
        "node_id": "MDQ6VXNlcjE1MzAyODM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rebroad",
        "html_url": "https://github.com/rebroad",
        "followers_url": "https://api.github.com/users/rebroad/followers",
        "following_url": "https://api.github.com/users/rebroad/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rebroad/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rebroad/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
        "organizations_url": "https://api.github.com/users/rebroad/orgs",
        "repos_url": "https://api.github.com/users/rebroad/repos",
        "events_url": "https://api.github.com/users/rebroad/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rebroad/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-12-27T16:05:50Z"
    },
    {
      "event": "locked",
      "id": 5271964055,
      "node_id": "LOE_lADOABII584Bs9T5zwAAAAE6O8mX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5271964055",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-08T12:25:13Z",
      "lock_reason": "resolved"
    }
  ]
}