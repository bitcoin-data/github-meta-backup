{
  "type": "issue",
  "issue": {
    "id": 751235104,
    "node_id": "MDU6SXNzdWU3NTEyMzUxMDQ=",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20500",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20500/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20500/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20500/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/20500",
    "number": 20500,
    "state": "closed",
    "state_reason": "completed",
    "title": "use try_emplace on std::map with c++17",
    "body": "Let's have a discussion and see if a structure change is warranted to many places std::maps/unsorted_maps are used in the code.\r\n\r\nNow that we support c++17 as a minimum as of #[20413](https://github.com/bitcoin/bitcoin/blob/2f71a1ea35667b3873197201531e7ae198ec5bf4/src/coins.cpp#L42) we should consider using try_emplace to gain efficiency when objects are not added, it also leads to more expressive and safer code(prevents stealing from arguments during failed insertion). For example, it seems FetchCoin uses emplace but does a piecewise_construct however it can be replaced with try_emplace:\r\n\r\n`CCoinsMap::iterator ret = cacheCoins.emplace(std::piecewise_construct, std::forward_as_tuple(outpoint), std::forward_as_tuple(std::move(tmp))).first;`\r\n\r\nbecomes\r\n`\r\nCCoinsMap::iterator ret = cacheCoins.try_emplace(outpoint, std::move(tmp)).first;`\r\n\r\nI also noticed emplace was used on dir_locks which is a map to unique_ptrs which is generally discouraged. It is used [here](https://github.com/bitcoin/bitcoin/blob/5a6f3c5a01eaf904c42bd77dbed931b49a8fec74/src/util/system.cpp#L107) and should likely just look like this:\r\n\r\n`dir_locks[pathLockFile.string()] = std::move(lock));`",
    "user": {
      "login": "sidhujag",
      "id": 6238042,
      "node_id": "MDQ6VXNlcjYyMzgwNDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sidhujag",
      "html_url": "https://github.com/sidhujag",
      "followers_url": "https://api.github.com/users/sidhujag/followers",
      "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
      "organizations_url": "https://api.github.com/users/sidhujag/orgs",
      "repos_url": "https://api.github.com/users/sidhujag/repos",
      "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/sidhujag/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 64583,
        "node_id": "MDU6TGFiZWw2NDU4Mw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature",
        "name": "Feature",
        "color": "7cf575",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 2,
    "closed_at": "2022-08-14T14:03:01Z",
    "created_at": "2020-11-26T02:36:53Z",
    "updated_at": "2022-08-14T14:03:01Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 4040510945,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDQwNDA1MTA5NDU=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4040510945",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-11-26T02:36:53Z",
      "label": {
        "name": "Feature",
        "color": "7cf575"
      }
    },
    {
      "event": "referenced",
      "id": 4040750315,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDQwNDA3NTAzMTU=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4040750315",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "c856f37b2cf714708beeff5f3545ca41da9dfa90",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/c856f37b2cf714708beeff5f3545ca41da9dfa90",
      "created_at": "2020-11-26T04:54:04Z"
    },
    {
      "event": "comment_deleted",
      "id": 4044907654,
      "node_id": "MDE5OkNvbW1lbnREZWxldGVkRXZlbnQ0MDQ0OTA3NjU0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4044907654",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-11-27T07:30:29Z"
    },
    {
      "event": "commented",
      "id": 845821650,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg0NTgyMTY1MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/845821650",
      "actor": {
        "login": "IamShubhamGupto",
        "id": 32878682,
        "node_id": "MDQ6VXNlcjMyODc4Njgy",
        "avatar_url": "https://avatars.githubusercontent.com/u/32878682?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/IamShubhamGupto",
        "html_url": "https://github.com/IamShubhamGupto",
        "followers_url": "https://api.github.com/users/IamShubhamGupto/followers",
        "following_url": "https://api.github.com/users/IamShubhamGupto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/IamShubhamGupto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/IamShubhamGupto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/IamShubhamGupto/subscriptions",
        "organizations_url": "https://api.github.com/users/IamShubhamGupto/orgs",
        "repos_url": "https://api.github.com/users/IamShubhamGupto/repos",
        "events_url": "https://api.github.com/users/IamShubhamGupto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/IamShubhamGupto/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-05-21T09:33:48Z",
      "updated_at": "2021-05-21T09:33:48Z",
      "author_association": "NONE",
      "body": "Hey, id like to work on this",
      "user": {
        "login": "IamShubhamGupto",
        "id": 32878682,
        "node_id": "MDQ6VXNlcjMyODc4Njgy",
        "avatar_url": "https://avatars.githubusercontent.com/u/32878682?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/IamShubhamGupto",
        "html_url": "https://github.com/IamShubhamGupto",
        "followers_url": "https://api.github.com/users/IamShubhamGupto/followers",
        "following_url": "https://api.github.com/users/IamShubhamGupto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/IamShubhamGupto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/IamShubhamGupto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/IamShubhamGupto/subscriptions",
        "organizations_url": "https://api.github.com/users/IamShubhamGupto/orgs",
        "repos_url": "https://api.github.com/users/IamShubhamGupto/repos",
        "events_url": "https://api.github.com/users/IamShubhamGupto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/IamShubhamGupto/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/20500#issuecomment-845821650",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20500"
    },
    {
      "event": "commented",
      "id": 1214384533,
      "node_id": "IC_kwDOABII585IYgmV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1214384533",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-14T14:03:01Z",
      "updated_at": "2022-08-14T14:03:01Z",
      "author_association": "MEMBER",
      "body": "Going to close this for now. Feel free to open a PR with code changes. That is likely a better venue for discussion than opening an issue.",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/20500#issuecomment-1214384533",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20500"
    },
    {
      "event": "closed",
      "id": 7184747293,
      "node_id": "CE_lADOABII584sxvAgzwAAAAGsPosd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7184747293",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-14T14:03:01Z"
    }
  ]
}