{
  "type": "issue",
  "issue": {
    "id": 223821773,
    "node_id": "MDU6SXNzdWUyMjM4MjE3NzM=",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10268",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10268/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10268/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10268/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/10268",
    "number": 10268,
    "state": "closed",
    "state_reason": "completed",
    "title": "zmq_test.py fails with out-of-tree builds",
    "body": "`zmq_test.py`, when run from `test/functional/test_runner.py`, fails when running it with an out-of-tree build:\r\n```\r\nzmq_test.py failed, Duration: 0 s\r\n\r\nstdout:\r\n2017-04-24 13:26:51.336000 TestFramework (INFO): Initializing test directory /tmp/testvfbalauk/558\r\n2017-04-24 13:26:51.460000 TestFramework (ERROR): Unexpected exception caught during testing\r\nTraceback (most recent call last):\r\n  File \"/store/orion/projects/bitcoin/bitcoin/test/functional/test_framework/test_framework.py\", line 150, in main\r\n    self.setup_network()\r\n  File \"/store/orion/projects/bitcoin/bitcoin/test/functional/test_framework/test_framework.py\", line 62, in setup_n\r\network\r\n    self.nodes = self.setup_nodes()\r\n  File \"/home/orion/projects/bitcoin/bitcoin/test/functional/zmq_test.py\", line 32, in setup_nodes\r\n    config.read_file(open(os.path.dirname(__file__) + \"/config.ini\"))\r\nFileNotFoundError: [Errno 2] No such file or directory: '/home/orion/projects/bitcoin/bitcoin/test/functional/config.ini'\r\n2017-04-24 13:26:51.477000 TestFramework (INFO): Stopping nodes\r\n\r\n\r\nstderr:\r\nTraceback (most recent call last):\r\n  File \"/home/orion/projects/bitcoin/bitcoin/test/functional/zmq_test.py\", line 110, in <module>\r\n    ZMQTest ().main ()\r\n  File \"/store/orion/projects/bitcoin/bitcoin/test/functional/test_framework/test_framework.py\", line 166, in main\r\n    stop_nodes(self.nodes)\r\n  File \"/store/orion/projects/bitcoin/bitcoin/test/functional/test_framework/util.py\", line 380, in stop_nodes\r\n    for i, node in enumerate(nodes):\r\nTypeError: 'NoneType' object is not iterable\r\n```\r\nI think the problem was introduced in 6803e09e6eeb2dbc820bb1025475a50a4352e30d. This added `config.read_file(open(os.path.dirname(__file__) + \"/config.ini\"))` to `test/functional/zmq_test.py`.\r\n\r\nNote that with out-of-tree builds, only `test/functional/test_runner.py` is symlinked, not all of the tests. The rest is simply executed in-place in the source directory. So individual tests won't find a `config.ini`. A potential solution would be to allow overriding the `config.ini` location through an environment variable or command line argument.\r\n\r\nSame happens when launching the test manually:\r\n```bash\r\nBITCOIND=$BUILDDIR/src/bitcoind $SRCDIR/bitcoin/test/functional/zmq_test.py \r\n```\r\n\r\nIn a pinch it can be worked around by adding a link in the source directory (ugly!)\r\n```bash\r\nln -s $BUILDDIR/test/functional/config.ini $SRCDIR/test/functional/config.ini\r\n```",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 62963516,
        "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
        "name": "Tests",
        "color": "d4c5f9",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": true,
    "active_lock_reason": "resolved",
    "comments": 2,
    "closed_at": "2017-05-03T06:48:09Z",
    "created_at": "2017-04-24T13:33:44Z",
    "updated_at": "2021-09-08T12:35:40Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 1054769178,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDEwNTQ3NjkxNzg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1054769178",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-04-24T13:33:44Z",
      "label": {
        "name": "Tests",
        "color": "d4c5f9"
      }
    },
    {
      "event": "commented",
      "id": 298406802,
      "node_id": "MDEyOklzc3VlQ29tbWVudDI5ODQwNjgwMg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/298406802",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-05-01T19:15:20Z",
      "updated_at": "2017-05-01T19:15:20Z",
      "author_association": "MEMBER",
      "body": "Yes, this was almost certainly broken by my change in #10097 :( I don't generally build out-of-tree and expect Travis to pick up the cases where building out of tree could cause problems. In this case, Travis doesn't fail because it's building bitcoin in a distdir, which does include all the test and config files in test/functional.\r\n\r\n#10307 should fix this by passing a new --configfile parameter from the test_runner to the individual tests. I've tested locally on an out-of-tree build and it seems to work.",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/10268#issuecomment-298406802",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10268"
    },
    {
      "event": "closed",
      "id": 1066724550,
      "node_id": "MDExOkNsb3NlZEV2ZW50MTA2NjcyNDU1MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1066724550",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-05-03T06:48:09Z"
    },
    {
      "event": "commented",
      "id": 298834913,
      "node_id": "MDEyOklzc3VlQ29tbWVudDI5ODgzNDkxMw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/298834913",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-05-03T06:49:10Z",
      "updated_at": "2017-05-03T06:49:10Z",
      "author_association": "MEMBER",
      "body": "> I don't generally build out-of-tree and expect Travis to pick up the cases where building out of tree could cause problems\r\n\r\nAh yes I also wondered why Travis wouldn't pick it up. Anyhow, if you break out-of-tree builds you can be sure that I notice :)",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/10268#issuecomment-298834913",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10268"
    },
    {
      "event": "locked",
      "id": 5272019708,
      "node_id": "LOE_lADOABII584NVz_NzwAAAAE6PKL8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5272019708",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-08T12:35:40Z",
      "lock_reason": "resolved"
    }
  ]
}