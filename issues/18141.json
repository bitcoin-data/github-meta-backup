{
  "type": "issue",
  "issue": {
    "id": 564904321,
    "node_id": "MDU6SXNzdWU1NjQ5MDQzMjE=",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18141",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18141/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18141/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18141/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/18141",
    "number": 18141,
    "state": "closed",
    "state_reason": "completed",
    "title": "IsRBFOptIn check for ancestors flagging BIP125",
    "body": "Hi there,\r\n\r\nPlease help me understand the following code: https://github.com/bitcoin/bitcoin/blob/master/src/policy/rbf.cpp#L25\r\n\r\nIt checks for ancestors flagging replaceability for RBF detection which is seemingly only used from utility and rpc commands. However note the mempool policy: https://github.com/bitcoin/bitcoin/blob/master/src/validation.cpp#L772\r\n\r\nIt seems as though relay won't happen if you are replacing inputs from ancestors anyway, so why does IsRBFOptIn need to check for ancestors? Do we need that or can we simply just use SignalsOptInRBF which just checks the tx inputs to ensure they aren't replaceable and not ancestral checks?",
    "user": {
      "login": "sidhujag",
      "id": 6238042,
      "node_id": "MDQ6VXNlcjYyMzgwNDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sidhujag",
      "html_url": "https://github.com/sidhujag",
      "followers_url": "https://api.github.com/users/sidhujag/followers",
      "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
      "organizations_url": "https://api.github.com/users/sidhujag/orgs",
      "repos_url": "https://api.github.com/users/sidhujag/repos",
      "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/sidhujag/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 82428251,
        "node_id": "MDU6TGFiZWw4MjQyODI1MQ==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/TX%20fees%20and%20policy",
        "name": "TX fees and policy",
        "color": "5319e7",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 4,
    "closed_at": "2022-08-03T08:56:31Z",
    "created_at": "2020-02-13T19:33:29Z",
    "updated_at": "2022-08-03T08:56:31Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 3036234230,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDMwMzYyMzQyMzA=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3036234230",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-02-13T19:33:29Z",
      "label": {
        "name": "Bug",
        "color": "FBBAAB"
      }
    },
    {
      "event": "commented",
      "id": 588182625,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU4ODE4MjYyNQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/588182625",
      "actor": {
        "login": "uncleray95",
        "id": 61146557,
        "node_id": "MDQ6VXNlcjYxMTQ2NTU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/61146557?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/uncleray95",
        "html_url": "https://github.com/uncleray95",
        "followers_url": "https://api.github.com/users/uncleray95/followers",
        "following_url": "https://api.github.com/users/uncleray95/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/uncleray95/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/uncleray95/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/uncleray95/subscriptions",
        "organizations_url": "https://api.github.com/users/uncleray95/orgs",
        "repos_url": "https://api.github.com/users/uncleray95/repos",
        "events_url": "https://api.github.com/users/uncleray95/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/uncleray95/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-02-19T11:47:10Z",
      "updated_at": "2020-02-19T11:47:10Z",
      "author_association": "NONE",
      "body": "I believe this is done to address a potential \"transaction pinning attack\", but I could be wrong. There's a good comment on StackOverflow that describes the problem [here.](https://bitcoin.stackexchange.com/questions/80803/what-is-meant-by-transaction-pinning)\r\n\r\n\r\n",
      "user": {
        "login": "uncleray95",
        "id": 61146557,
        "node_id": "MDQ6VXNlcjYxMTQ2NTU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/61146557?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/uncleray95",
        "html_url": "https://github.com/uncleray95",
        "followers_url": "https://api.github.com/users/uncleray95/followers",
        "following_url": "https://api.github.com/users/uncleray95/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/uncleray95/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/uncleray95/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/uncleray95/subscriptions",
        "organizations_url": "https://api.github.com/users/uncleray95/orgs",
        "repos_url": "https://api.github.com/users/uncleray95/repos",
        "events_url": "https://api.github.com/users/uncleray95/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/uncleray95/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/18141#issuecomment-588182625",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18141"
    },
    {
      "event": "commented",
      "id": 590030684,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU5MDAzMDY4NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/590030684",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-02-23T05:58:53Z",
      "updated_at": "2020-02-23T05:58:53Z",
      "author_association": "NONE",
      "body": "How is it an attack? the commercial service would sweet up outputs and spend them with higher fees but both should get mined because the fee rate of the package would be sufficient to mine... what is the actual attack? Also this is still just replacing the input of the child transaction and nothing to do with any ancestor? I was saying that the mempool acceptance code just ensures that ancestor inputs cannot be replaced and why does a function need to then check for them, I can't see how a pinning attack has anything to do with ancestors rather than just the child in question...",
      "user": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/18141#issuecomment-590030684",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18141"
    },
    {
      "event": "commented",
      "id": 590031406,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU5MDAzMTQwNg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/590031406",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-02-23T06:12:07Z",
      "updated_at": "2020-02-23T06:12:07Z",
      "author_association": "NONE",
      "body": "If someone can clarify how its an attack (like it wont get mined because its on the tx fee limit?), carve out still ensure LN works, what sorts of things would not be available to someone?\r\n\r\n\"Because descendant transactions may also be replaceable under this policy through inherited signaling, any method used to process opt-in full-RBF transactions should be inherited by any descendant transactions for as long as any ancestor opt-in full-RBF transactions remain unconfirmed.\" from the BIP is probably why the function exists, but I thought the code was saying that your not allowed to replace any other input in ancestor tree, where is the code that allows you to spend inputs that are in mempool as ancestors as long as one of them signals RBF?",
      "user": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/18141#issuecomment-590031406",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18141"
    },
    {
      "event": "unlabeled",
      "id": 7113353668,
      "node_id": "UNLE_lADOABII584hq8GBzwAAAAGn_SnE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7113353668",
      "actor": {
        "login": "adamjonas",
        "id": 755825,
        "node_id": "MDQ6VXNlcjc1NTgyNQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/755825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/adamjonas",
        "html_url": "https://github.com/adamjonas",
        "followers_url": "https://api.github.com/users/adamjonas/followers",
        "following_url": "https://api.github.com/users/adamjonas/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/adamjonas/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/adamjonas/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/adamjonas/subscriptions",
        "organizations_url": "https://api.github.com/users/adamjonas/orgs",
        "repos_url": "https://api.github.com/users/adamjonas/repos",
        "events_url": "https://api.github.com/users/adamjonas/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/adamjonas/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-02T20:50:23Z",
      "label": {
        "name": "Bug",
        "color": "FBBAAB"
      }
    },
    {
      "event": "labeled",
      "id": 7113353671,
      "node_id": "LE_lADOABII584hq8GBzwAAAAGn_SnH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7113353671",
      "actor": {
        "login": "adamjonas",
        "id": 755825,
        "node_id": "MDQ6VXNlcjc1NTgyNQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/755825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/adamjonas",
        "html_url": "https://github.com/adamjonas",
        "followers_url": "https://api.github.com/users/adamjonas/followers",
        "following_url": "https://api.github.com/users/adamjonas/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/adamjonas/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/adamjonas/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/adamjonas/subscriptions",
        "organizations_url": "https://api.github.com/users/adamjonas/orgs",
        "repos_url": "https://api.github.com/users/adamjonas/repos",
        "events_url": "https://api.github.com/users/adamjonas/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/adamjonas/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-02T20:50:23Z",
      "label": {
        "name": "TX fees and policy",
        "color": "5319e7"
      }
    },
    {
      "event": "subscribed",
      "id": 7113370250,
      "node_id": "SE_lADOABII584hq8GBzwAAAAGn_WqK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7113370250",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-02T20:52:51Z"
    },
    {
      "event": "commented",
      "id": 1203674072,
      "node_id": "IC_kwDOABII585HvpvY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1203674072",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-03T08:56:31Z",
      "updated_at": "2022-08-03T08:56:31Z",
      "author_association": "MEMBER",
      "body": "Not sure what code the link is pointing to in the OP, as it points to master >2 years ago, but will try to answer your question.\r\n\r\n> It seems as though relay won't happen if you are replacing inputs from ancestors anyway, so why does IsRBFOptIn need to check for ancestors?\r\n\r\n`IsRBFOptIn` checks ancestors to answer the question of \"can this transaction be replaced by RBF rules.\" If the ancestor is replaced, this tx is also evicted because it would no longer be valid. It's not checking whether the ancestors would signal/be replaced.\r\n\r\n\r\n> If someone can clarify how its an attack (like it wont get mined because its on the tx fee limit?), carve out still ensure LN works, what sorts of things would not be available to someone?\r\n\r\nThis is not related to a pinning attack.\r\n\r\nClosing now, hopefully this answers your question. We've added a doc/policy/mempool_replacements.md and more documentation since then if you have more questions about RBF.",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/18141#issuecomment-1203674072",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18141"
    },
    {
      "event": "closed",
      "id": 7116689390,
      "node_id": "CE_lADOABII584hq8GBzwAAAAGoMA_u",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7116689390",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-03T08:56:31Z"
    }
  ]
}