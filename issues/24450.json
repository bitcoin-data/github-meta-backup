{
  "type": "issue",
  "issue": {
    "id": 1153708183,
    "node_id": "I_kwDOABII585ExDCX",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24450",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24450/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24450/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24450/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/24450",
    "number": 24450,
    "state": "open",
    "state_reason": null,
    "title": "Apparently CJDNS network does not work with Tor on mainnet.",
    "body": "Apparently CJDNS network does not work with Tor on mainnet.\r\n\r\n**Expected behavior**\r\n\r\nBoth networks should work.\r\n\r\n**Actual behavior**\r\n\r\nWhen monitoring connections via `./src/bitcoin-cli  -netinfo 4`, this does not show any CJDNS peers if Tor is enabled.\r\nIf the Tor proxy is commented out in the configuration file, the CJDNS peers will be connected.\r\n\r\n**To reproduce**\r\n\r\nInstall Tor, I2P and CJDNS services on Fedora / Debian.\r\n\r\nAdd the following items to `bitcoin.conf` file:\r\n```\r\n[main]\r\nproxy=127.0.0.1:9050\r\ncjdnsreachable=1\r\ni2pacceptincoming=1\r\ni2psam=127.0.0.1:7656\r\naddnode=fcc7:be49:ccd1:dc91:3125:f0da:457d:8ce\r\naddnode=fc32:17ea:e415:c3bf:9808:149d:b5a2:c9aa\r\naddnode=sedndhv5vpcgdmykyi5st4yqhdxl3hpdtglta4do435wupahhx6q.b32.i2p:0\r\naddnode=zsxwyo6qcn3chqzwxnseusqgsnuw3maqnztkiypyfxtya4snkoka.b32.i2p:0\r\naddnode=wwbw7nqr3ahkqv62cuqfwgtneekvvpnuc4i4f6yo7tpoqjswvcwa.b32.i2p:0\r\naddnode=opnyfyeiibe5qo5a3wbxzbb4xdiagc32bbce46owmertdknta5mi7uyd.onion:8333\r\naddnode=rp7k2go3s5lyj3fnj6zn62ktarlrsft2ohlsxkyd7v3e3idqyptvread.onion:8333\r\naddnode=xqt25cobm5zqucac3634zfght72he6u3eagfyej5ellbhcdgos7t2had.onion:8333\r\n```\r\nRun Bicoin Core. With the configuration above, there can be IPv4, onion and I2P peers, but not CJDNS.\r\nStop Bitcoin Core, comment out `proxy=127.0.0.1:9050` and restart it. There can be IPv4, CJDNS and I2P\r\n\r\n**System information**\r\nBitcoin Core was compiled from master (last commit `ee8c9971256`). Ran on Fedora Linux 35. \r\nSame behavior observed on Debian 11.",
    "user": {
      "login": "lsilva01",
      "id": 84432093,
      "node_id": "MDQ6VXNlcjg0NDMyMDkz",
      "avatar_url": "https://avatars.githubusercontent.com/u/84432093?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lsilva01",
      "html_url": "https://github.com/lsilva01",
      "followers_url": "https://api.github.com/users/lsilva01/followers",
      "following_url": "https://api.github.com/users/lsilva01/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/lsilva01/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/lsilva01/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/lsilva01/subscriptions",
      "organizations_url": "https://api.github.com/users/lsilva01/orgs",
      "repos_url": "https://api.github.com/users/lsilva01/repos",
      "events_url": "https://api.github.com/users/lsilva01/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/lsilva01/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 64585,
        "node_id": "MDU6TGFiZWw2NDU4NQ==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug",
        "name": "Bug",
        "color": "FBBAAB",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "locked": false,
    "comments": 4,
    "created_at": "2022-02-28T06:28:16Z",
    "updated_at": "2022-06-30T01:45:59Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 6152360221,
      "node_id": "LE_lADOABII585ExDCXzwAAAAFutZEd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6152360221",
      "actor": {
        "login": "lsilva01",
        "id": 84432093,
        "node_id": "MDQ6VXNlcjg0NDMyMDkz",
        "avatar_url": "https://avatars.githubusercontent.com/u/84432093?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/lsilva01",
        "html_url": "https://github.com/lsilva01",
        "followers_url": "https://api.github.com/users/lsilva01/followers",
        "following_url": "https://api.github.com/users/lsilva01/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/lsilva01/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/lsilva01/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/lsilva01/subscriptions",
        "organizations_url": "https://api.github.com/users/lsilva01/orgs",
        "repos_url": "https://api.github.com/users/lsilva01/repos",
        "events_url": "https://api.github.com/users/lsilva01/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/lsilva01/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-02-28T06:28:16Z",
      "label": {
        "name": "Bug",
        "color": "FBBAAB"
      }
    },
    {
      "event": "commented",
      "id": 1054240232,
      "node_id": "IC_kwDOABII584-1m3o",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1054240232",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-02-28T13:09:30Z",
      "updated_at": "2022-02-28T13:09:57Z",
      "author_association": "MEMBER",
      "body": "I think this is at least partially expected behavior. The thing is, if you're proxying IPv6 over Tor, CJDNS will not work. `-proxy` is the catch-all (which is by far the safest behavior for what people *generally* want with Tor).\r\n\r\nGenerally if you want to run a multi-network node, set a proxy per network, e.g. `-onion=<ip:port>`. This will cause non-CJDNS IPv4 and IPv6 to go over clearnet, though, so might not be the configuration you want.\r\n",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/24450#issuecomment-1054240232",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24450"
    },
    {
      "event": "commented",
      "id": 1075069019,
      "node_id": "IC_kwDOABII585AFEBb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1075069019",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-03-22T11:36:48Z",
      "updated_at": "2022-03-22T11:52:31Z",
      "author_association": "MEMBER",
      "body": "> Apparently CJDNS network does not work with Tor on mainnet.\r\n> \r\n> this does not show any CJDNS peers if Tor is enabled\r\n\r\nA few ways one can run CJDNS (and I2P and IPv4/6) with Tor (provided they do what a user wants):\r\n\r\n- with a proxy per network as suggested by @laanwj\r\n- with `-onion=127.0.0.1:9050 -externalip=<your onion address> -discover -listen`\r\n- without setting a proxy\r\n- with `-proxy` and `-discover` (and optionally `-listen`), not sure this is a useful config though\r\n",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/24450#issuecomment-1075069019",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24450"
    },
    {
      "event": "mentioned",
      "id": 6282906321,
      "node_id": "MEE_lADOABII585ExDCXzwAAAAF2fYrR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6282906321",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-03-22T11:36:48Z"
    },
    {
      "event": "subscribed",
      "id": 6282906329,
      "node_id": "SE_lADOABII585ExDCXzwAAAAF2fYrZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6282906329",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-03-22T11:36:48Z"
    },
    {
      "event": "commented",
      "id": 1075125736,
      "node_id": "IC_kwDOABII585AFR3o",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1075125736",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-03-22T12:39:03Z",
      "updated_at": "2022-03-22T12:39:03Z",
      "author_association": "MEMBER",
      "body": "Yeah, I would say the above is misconfiguration which can be fixed by replacing `-proxy=` with `-onion=`. Some thoughts:\r\n\r\n`-proxy=` is catch-all setting. There may be a proxy running on one's router that also handles CJDNS. So, it would be undesirable to change the behavior to ignore `-proxy=` within Bitcoin Core when connecting to CJDNS addresses.\r\n\r\n`-proxy=` is ignored for I2P addresses, so it is catch-all _except_ I2P.\r\n\r\nLooks like we don't support right now a setup where IPv4 and IPv6 are routed via Tor and CJDNS connections are made without a proxy.\r\n\r\nMaybe we should consider something like `-proxy=1.2.3.4:5678=ipv4` for a more fine-grained control?",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/24450#issuecomment-1075125736",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24450"
    },
    {
      "event": "commented",
      "id": 1170660192,
      "node_id": "IC_kwDOABII585Fxttg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1170660192",
      "actor": {
        "login": "felipelalli",
        "id": 207639,
        "node_id": "MDQ6VXNlcjIwNzYzOQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/207639?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/felipelalli",
        "html_url": "https://github.com/felipelalli",
        "followers_url": "https://api.github.com/users/felipelalli/followers",
        "following_url": "https://api.github.com/users/felipelalli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/felipelalli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/felipelalli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/felipelalli/subscriptions",
        "organizations_url": "https://api.github.com/users/felipelalli/orgs",
        "repos_url": "https://api.github.com/users/felipelalli/repos",
        "events_url": "https://api.github.com/users/felipelalli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/felipelalli/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-30T01:45:59Z",
      "updated_at": "2022-06-30T01:45:59Z",
      "author_association": "NONE",
      "body": "I think this should be better documented in https://github.com/bitcoin/bitcoin/blob/master/doc/cjdns.md .",
      "user": {
        "login": "felipelalli",
        "id": 207639,
        "node_id": "MDQ6VXNlcjIwNzYzOQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/207639?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/felipelalli",
        "html_url": "https://github.com/felipelalli",
        "followers_url": "https://api.github.com/users/felipelalli/followers",
        "following_url": "https://api.github.com/users/felipelalli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/felipelalli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/felipelalli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/felipelalli/subscriptions",
        "organizations_url": "https://api.github.com/users/felipelalli/orgs",
        "repos_url": "https://api.github.com/users/felipelalli/repos",
        "events_url": "https://api.github.com/users/felipelalli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/felipelalli/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/24450#issuecomment-1170660192",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24450"
    }
  ]
}