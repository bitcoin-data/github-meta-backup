{
  "type": "issue",
  "issue": {
    "id": 252122226,
    "node_id": "MDU6SXNzdWUyNTIxMjIyMjY=",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11115",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11115/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11115/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11115/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/11115",
    "number": 11115,
    "state": "closed",
    "state_reason": "completed",
    "title": "prevector.h memory corruption when dealing with very large amounts of data (+/- 4GB)",
    "body": "### Describe the issue\r\n\r\n### Can you reliably reproduce the issue?\r\n#### If so, please list the steps to reproduce below:\r\n\r\nIn ```prevector.h```\r\n\r\n```c\r\n345         if (capacity() < new_size) {\r\n346             change_capacity(new_size + (new_size >> 1));\r\n347         }\r\n```\r\n\r\nThis construct makes it prone to uint32_t (the default size prevector\r\nuses) overflow if new_size is very high. A loop where many many\r\nelements are added to a prevector will trigger this. std::vector does\r\nnot appear to exhibit problems when dealing with excessively large\r\namounts of data.\r\n\r\n### Expected behaviour\r\nNothing (or throwing an exception?)\r\n\r\n### Actual behaviour\r\nMemory corruption\r\n\r\n### Screenshots.\r\n\r\n### What version of bitcoin-core are you using?\r\nbitcoin-0.14.2 self-compiled\r\n\r\n### Machine specs:\r\n- OS: Linux\r\n- CPU:\r\n- RAM:\r\n- Disk size:\r\n- Disk Type (HD/SDD):\r\n\r\n### Any extra information that might be useful in the debugging process.\r\n\r\nMy prevector fuzzer ( https://github.com/guidovranken/bitcoin/blob/fuzzing/fuzzers/fuzzer-prevector.cpp ) can be used to find this. You can compile it with the flag ```-DSIZETYPE_UINT16_T``` so that prevector uses ```uint16_t``` rather than the default ```uint32_t``` as its internal size type. So rather than having to operate on buffers that are gigabytes large in order to trigger any bugs, it can be done with buffers that involve only +/- 64K buffers.",
    "user": {
      "login": "guidovranken",
      "id": 6846644,
      "node_id": "MDQ6VXNlcjY4NDY2NDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6846644?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/guidovranken",
      "html_url": "https://github.com/guidovranken",
      "followers_url": "https://api.github.com/users/guidovranken/followers",
      "following_url": "https://api.github.com/users/guidovranken/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/guidovranken/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/guidovranken/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/guidovranken/subscriptions",
      "organizations_url": "https://api.github.com/users/guidovranken/orgs",
      "repos_url": "https://api.github.com/users/guidovranken/repos",
      "events_url": "https://api.github.com/users/guidovranken/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/guidovranken/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "locked": true,
    "active_lock_reason": "resolved",
    "comments": 2,
    "closed_at": "2020-04-26T01:14:00Z",
    "created_at": "2017-08-23T00:00:56Z",
    "updated_at": "2022-02-15T11:02:49Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 324187471,
      "node_id": "MDEyOklzc3VlQ29tbWVudDMyNDE4NzQ3MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/324187471",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-08-23T00:28:20Z",
      "updated_at": "2017-08-23T00:28:20Z",
      "author_association": "MEMBER",
      "body": "prevector has a type parameter for choosing the size type (which defaults to uint32_t). If a user of prevector uses it in a way that causes an overflow in that type, that's invalid usage of prevector.\r\n\r\nPerhaps an overflow check can be added, though.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/11115#issuecomment-324187471",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11115"
    },
    {
      "event": "commented",
      "id": 619463214,
      "node_id": "MDEyOklzc3VlQ29tbWVudDYxOTQ2MzIxNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/619463214",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-04-26T01:14:00Z",
      "updated_at": "2020-04-26T01:14:00Z",
      "author_association": "MEMBER",
      "body": "This seems like an issue of theoretical nature. I don't think we use prevectors of such size?\r\n\r\nSo closing for now, but pull requests with improvements are always welcome.",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/11115#issuecomment-619463214",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11115"
    },
    {
      "event": "closed",
      "id": 3272429078,
      "node_id": "MDExOkNsb3NlZEV2ZW50MzI3MjQyOTA3OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3272429078",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-04-26T01:14:00Z"
    },
    {
      "event": "locked",
      "id": 6074004575,
      "node_id": "LOE_lADOABII584PBxRyzwAAAAFqCfRf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6074004575",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-02-15T11:02:49Z",
      "lock_reason": "resolved"
    }
  ]
}