{
  "type": "issue",
  "issue": {
    "id": 376815284,
    "node_id": "MDU6SXNzdWUzNzY4MTUyODQ=",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14640",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14640/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14640/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14640/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/14640",
    "number": 14640,
    "state": "closed",
    "state_reason": "completed",
    "title": "Compilation warning on Fedora release 28 ",
    "body": "Compiling on Fedora release 28 I have the following warning:\r\n\r\n```\r\nIn file included from bench/prevector.cpp:6:\r\n./prevector.h: In instantiation of ‘void prevector<N, T, Size, Diff>::fill(T*, ptrdiff_t) [with unsigned int N = 28; T = nontrivial_t; Size = unsigned int; Diff = int; ptrdiff_t = long int]’:\r\n./prevector.h:340:9:   required from ‘void prevector<N, T, Size, Diff>::resize(prevector<N, T, Size, Diff>::size_type) [with unsigned int N = 28; T = nontrivial_t; Size = unsigned int; Diff = int; prevector<N, T, Size, Diff>::size_type = unsigned int]’\r\nbench/prevector.cpp:47:13:   required from ‘void PrevectorClear(benchmark::State&) [with T = nontrivial_t]’\r\nbench/prevector.cpp:102:1:   required from here\r\n./prevector.h:205:21: warning: ‘void* memset(void*, int, size_t)’ clearing an object of non-trivial type ‘struct nontrivial_t’; use assignment or value-initialization instead [-Wclass-memaccess]\r\n             ::memset(dst, 0, count * sizeof(T));\r\n             ~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~\r\nbench/prevector.cpp:12:8: note: ‘struct nontrivial_t’ declared here\r\n struct nontrivial_t {\r\n        ^~~~~~~~~~~~\r\n```\r\n\r\n$ gcc --version\r\ngcc (GCC) 8.2.1 20181011 (Red Hat 8.2.1-4)\r\nCopyright (C) 2018 Free Software Foundation, Inc.\r\nThis is free software; see the source for copying conditions.  There is NO\r\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n$ ld --version\r\nGNU ld version 2.29.1-23.fc28\r\nCopyright (C) 2017 Free Software Foundation, Inc.\r\nThis program is free software; you may redistribute it under the terms of\r\nthe GNU General Public License version 3 or (at your option) a later version.\r\nThis program has absolutely no warranty.\r\n\r\n$ g++ --version\r\ng++ (GCC) 8.2.1 20181011 (Red Hat 8.2.1-4)\r\nCopyright (C) 2018 Free Software Foundation, Inc.\r\nThis is free software; see the source for copying conditions.  There is NO\r\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\nCould someone help me to solve this warning.\r\n\r\nThanks\r\n",
    "user": {
      "login": "MarkLTZ",
      "id": 43173987,
      "node_id": "MDQ6VXNlcjQzMTczOTg3",
      "avatar_url": "https://avatars.githubusercontent.com/u/43173987?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarkLTZ",
      "html_url": "https://github.com/MarkLTZ",
      "followers_url": "https://api.github.com/users/MarkLTZ/followers",
      "following_url": "https://api.github.com/users/MarkLTZ/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/MarkLTZ/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/MarkLTZ/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/MarkLTZ/subscriptions",
      "organizations_url": "https://api.github.com/users/MarkLTZ/orgs",
      "repos_url": "https://api.github.com/users/MarkLTZ/repos",
      "events_url": "https://api.github.com/users/MarkLTZ/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/MarkLTZ/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 234878,
        "node_id": "MDU6TGFiZWwyMzQ4Nzg=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Linux/Unix",
        "name": "Linux/Unix",
        "color": "770000",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": true,
    "active_lock_reason": "resolved",
    "comments": 1,
    "closed_at": "2018-11-02T14:05:44Z",
    "created_at": "2018-11-02T13:43:34Z",
    "updated_at": "2021-09-08T12:49:42Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 1942976401,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDE5NDI5NzY0MDE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1942976401",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-11-02T13:44:37Z",
      "label": {
        "name": "Linux/Unix",
        "color": "770000"
      }
    },
    {
      "event": "commented",
      "id": 435390663,
      "node_id": "MDEyOklzc3VlQ29tbWVudDQzNTM5MDY2Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/435390663",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-11-02T14:05:44Z",
      "updated_at": "2018-11-02T14:05:44Z",
      "author_association": "MEMBER",
      "body": "The warning is implemented in the C++ front end and runs without the benefit of any sort of constant propagation or dead code elimination, so there is no way to avoid it in ordinary conditional statements.\r\n\r\nIn C++ 17 and later the warning can be avoided by using the if constexpr statement:\r\n\r\n```\r\n  if constexpr (std::is_trivial<T>::value)\r\n    memset(val, 0, sizeof(T);\r\n  else\r\n    *val = T();\r\n```\r\n\r\nIn older C++ versions it can be avoided by dispatching to different implementation functions at compile time.\r\n\r\nIn any event, the preferred way to zero-initialize an object is by making use the appropriate initialization form.   It's safer and easier for compilers to analyze both to detect bugs and to emit efficient code (sometimes more efficient than memset), so I would recommend adopting it in favor or raw memory functions even for trivial types.\r\n\r\nSource: https://gcc.gnu.org/bugzilla/show_bug.cgi?id=84656#c1",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/14640#issuecomment-435390663",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/14640"
    },
    {
      "event": "closed",
      "id": 1943025124,
      "node_id": "MDExOkNsb3NlZEV2ZW50MTk0MzAyNTEyNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1943025124",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-11-02T14:05:44Z"
    },
    {
      "event": "locked",
      "id": 5272097234,
      "node_id": "LOE_lADOABII584Wdb60zwAAAAE6PdHS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5272097234",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-08T12:49:42Z",
      "lock_reason": "resolved"
    }
  ]
}