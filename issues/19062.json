{
  "type": "issue",
  "issue": {
    "id": 623854659,
    "node_id": "MDU6SXNzdWU2MjM4NTQ2NTk=",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19062",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19062/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19062/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19062/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/19062",
    "number": 19062,
    "state": "closed",
    "state_reason": "completed",
    "title": "Investigate unnecessary uses of raw pointer parameters",
    "body": "The developer note's recommendations on how to pass (non-)fundamental types can be found [here](https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md#general-c).\r\n\r\nIn #19053 @theStack replaces some unnecessary uses of raw pointer parameters with references.\r\n\r\nThere are a few similar cases in our code base where references (or something else) might be [more appropriate](https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md#general-c) than raw pointer parameters.\r\n\r\nIf anyone is interested in investigating such cases the commands below might be helpful to find potential candidates.\r\n\r\nNote: It probably goes without saying, but any change of this type needs case-by-case evaluation :)  Each suggested individual parameter change must make sense and be worth doing: the commands are only provided to help find potential candidates.\r\n\r\nTop list of types passed as raw pointer parameters (incomplete top list, but it should be somewhat representative):\r\n\r\n```\r\n$ git grep -E '^[a-zA-Z].* [a-zA-Z:]+\\([^()]*\\*[^()]*\\)' -- \"src/**.cpp\" \"src/**.h\" \\\r\n      \":(exclude)src/bench/\" \":(exclude)src/compat/\" \":(exclude)src/crc32c/\" \\\r\n      \":(exclude)src/leveldb/\" \":(exclude)src/qt/\" \":(exclude)src/secp256k1/\" \\\r\n      \":(exclude)src/test/\" \":(exclude)src/tinyformat.h\" \":(exclude)src/univalue/\" \\\r\n      \":(exclude)src/zmq/\" \":(exclude)src/wallet/\" | grep -vE \"char *\\*\" | \\\r\n      cut -f2 -d'(' | cut -f1 -d')' | tr \",\" \"\\n\" | grep \"\\*\" | sed 's/^ *const  *//g' | \\\r\n      sed 's/^ *//g' | sed 's/ \\*/* /g' | sed 's/\\*.*$/*/g' | grep -E '[a-zA-Z]' | \\\r\n      sort | uniq -c | sort -rn\r\n    118 CBlockIndex*\r\n     24 CNode*\r\n     11 ScriptError*\r\n     10 void*\r\n      9 FILE*\r\n      9 bool*\r\n      8 CConnman*\r\n      7 std::string*\r\n      6 RPCTimerInterface*\r\n      6 CNetAddr*\r\n      4 std::vector<int>*\r\n      4 SigningProvider*\r\n      4 LockPoints*\r\n      4 HTTPRequest*\r\n      4 FlatFilePos*\r\n      4 CValidationInterface*\r\n      4 CScriptWitness*\r\n      4 CBlockHeader*\r\n      3 uint32_t*\r\n      3 struct sockaddr*\r\n      3 EstimationResult*\r\n      3 CNodeState*\r\n      3 CCoinsView*\r\n      2 uint8_t*\r\n      2 uint64_t*\r\n      2 struct bufferevent*\r\n      2 std::vector<unsigned char>*\r\n      2 std::vector<CScriptCheck>*\r\n      2 std::vector<const CBlockIndex*\r\n      2 SignatureData*\r\n      2 PrecomputedTransactionData*\r\n      2 int64_t*\r\n      2 int*\r\n      2 FillableSigningProvider*\r\n      2 double*\r\n      2 CRPCCommand*\r\n      2 CCoinsViewCache*\r\n      2 CBlock*\r\n      1 WorkQueue<HTTPClosure>*\r\n      1 struct timeval*\r\n      1 struct in_addr*\r\n      1 struct evhttp*\r\n      1 struct event_base*\r\n      1 std::vector<COutPoint>*\r\n      1 std::list<QueuedBlock>::iterator*\r\n      1 socklen_t*\r\n      1 secp256k1_ecdsa_signature*\r\n      1 leveldb::Options*\r\n      1 FeeCalculation*\r\n      1 DisconnectedBlockTransactions*\r\n      1 CTxMemPoolEntry*\r\n      1 Coin*\r\n      1 CCoinsViewCursor*\r\n      1 CChainState*\r\n      1 CBlockFileInfo*\r\n      1 BaseRequestHandler*\r\n      1 BanMan*\r\n```\r\n\r\nA subset of functions with raw pointer parameters:\r\n\r\n```\r\n$ git grep -E '^[a-zA-Z].* [a-zA-Z:]+\\([^()]*\\*[^()]*\\)' -- \"src/**.cpp\" \"src/**.h\" \\\r\n      \":(exclude)src/bench/\" \":(exclude)src/compat/\" \":(exclude)src/crc32c/\" \\\r\n      \":(exclude)src/leveldb/\" \":(exclude)src/qt/\" \":(exclude)src/secp256k1/\" \\\r\n      \":(exclude)src/test/\" \":(exclude)src/tinyformat.h\" \":(exclude)src/univalue/\" \\\r\n      \":(exclude)src/zmq/\" \":(exclude)src/wallet/\" | grep -vE \"char *\\*\"\r\nsrc/addrman.cpp:CAddrInfo* CAddrMan::Find(const CNetAddr& addr, int* pnId)\r\nsrc/addrman.cpp:CAddrInfo* CAddrMan::Create(const CAddress& addr, const CNetAddr& addrSource, int* pnId)\r\nsrc/bitcoin-cli.cpp:static UniValue CallRPC(BaseRequestHandler *rh, const std::string& strMethod, const std::vector<std::string>& args)\r\nsrc/blockfilter.cpp:bool GCSFilter::MatchInternal(const uint64_t* element_hashes, size_t size) const\r\nsrc/chain.cpp:void CChain::SetTip(CBlockIndex *pindex) {\r\nsrc/chain.cpp:CBlockLocator CChain::GetLocator(const CBlockIndex *pindex) const {\r\nsrc/chain.cpp:const CBlockIndex* LastCommonAncestor(const CBlockIndex* pa, const CBlockIndex* pb) {\r\nsrc/chain.h:const CBlockIndex* LastCommonAncestor(const CBlockIndex* pa, const CBlockIndex* pb);\r\nsrc/coins.cpp:bool CCoinsViewCache::SpendCoin(const COutPoint &outpoint, Coin* moveout) {\r\nsrc/consensus/merkle.cpp:uint256 ComputeMerkleRoot(std::vector<uint256> hashes, bool* mutated) {\r\nsrc/consensus/merkle.cpp:uint256 BlockMerkleRoot(const CBlock& block, bool* mutated)\r\nsrc/consensus/merkle.cpp:uint256 BlockWitnessMerkleRoot(const CBlock& block, bool* mutated)\r\nsrc/consensus/merkle.h:uint256 ComputeMerkleRoot(std::vector<uint256> hashes, bool* mutated = nullptr);\r\nsrc/consensus/merkle.h:uint256 BlockMerkleRoot(const CBlock& block, bool* mutated = nullptr);\r\nsrc/consensus/merkle.h:uint256 BlockWitnessMerkleRoot(const CBlock& block, bool* mutated = nullptr);\r\nsrc/consensus/tx_verify.cpp:std::pair<int, int64_t> CalculateSequenceLocks(const CTransaction &tx, int flags, std::vector<int>* prevHeights, const CBlockIndex& block)\r\nsrc/consensus/tx_verify.cpp:bool SequenceLocks(const CTransaction &tx, int flags, std::vector<int>* prevHeights, const CBlockIndex& block)\r\nsrc/consensus/tx_verify.h:std::pair<int, int64_t> CalculateSequenceLocks(const CTransaction &tx, int flags, std::vector<int>* prevHeights, const CBlockIndex& block);\r\nsrc/consensus/tx_verify.h:bool SequenceLocks(const CTransaction &tx, int flags, std::vector<int>* prevHeights, const CBlockIndex& block);\r\nsrc/crypto/ripemd160.cpp:void inline Initialize(uint32_t* s)\r\nâ€¦\r\n```",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/practicalswift/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/practicalswift/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 64584,
        "node_id": "MDU6TGFiZWw2NDU4NA==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Brainstorming",
        "name": "Brainstorming",
        "color": "ebd775",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "locked": true,
    "active_lock_reason": "resolved",
    "comments": 1,
    "closed_at": "2021-07-07T21:59:54Z",
    "created_at": "2020-05-24T12:27:09Z",
    "updated_at": "2022-08-18T18:36:37Z"
  },
  "events": [
    {
      "event": "mentioned",
      "id": 3367905131,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzM2NzkwNTEzMQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3367905131",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-05-24T12:27:09Z"
    },
    {
      "event": "subscribed",
      "id": 3367905133,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDMzNjc5MDUxMzM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3367905133",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-05-24T12:27:09Z"
    },
    {
      "event": "labeled",
      "id": 3367907249,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDMzNjc5MDcyNDk=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3367907249",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-05-24T12:30:07Z",
      "label": {
        "name": "Brainstorming",
        "color": "ebd775"
      }
    },
    {
      "event": "referenced",
      "id": 3420395132,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDM0MjAzOTUxMzI=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3420395132",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "a79bca2f1fb25f433d6e100a31a3acfde2656ce1",
      "commit_url": "https://api.github.com/repos/MarcoFalke/b-c/commits/a79bca2f1fb25f433d6e100a31a3acfde2656ce1",
      "created_at": "2020-06-08T14:38:29Z"
    },
    {
      "event": "referenced",
      "id": 3422258378,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDM0MjIyNTgzNzg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3422258378",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "b8f1025f30687c2ab9c9fd55340e9055b3f16dda",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/b8f1025f30687c2ab9c9fd55340e9055b3f16dda",
      "created_at": "2020-06-08T22:28:12Z"
    },
    {
      "event": "commented",
      "id": 864551000,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg2NDU1MTAwMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/864551000",
      "actor": {
        "login": "klementtan",
        "id": 49265907,
        "node_id": "MDQ6VXNlcjQ5MjY1OTA3",
        "avatar_url": "https://avatars.githubusercontent.com/u/49265907?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/klementtan",
        "html_url": "https://github.com/klementtan",
        "followers_url": "https://api.github.com/users/klementtan/followers",
        "following_url": "https://api.github.com/users/klementtan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/klementtan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/klementtan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/klementtan/subscriptions",
        "organizations_url": "https://api.github.com/users/klementtan/orgs",
        "repos_url": "https://api.github.com/users/klementtan/repos",
        "events_url": "https://api.github.com/users/klementtan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/klementtan/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-20T13:00:04Z",
      "updated_at": "2021-06-20T13:00:04Z",
      "author_association": "CONTRIBUTOR",
      "body": "#22282 fixes `CheckFinalTx` pass by pointer to pass by reference ",
      "user": {
        "login": "klementtan",
        "id": 49265907,
        "node_id": "MDQ6VXNlcjQ5MjY1OTA3",
        "avatar_url": "https://avatars.githubusercontent.com/u/49265907?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/klementtan",
        "html_url": "https://github.com/klementtan",
        "followers_url": "https://api.github.com/users/klementtan/followers",
        "following_url": "https://api.github.com/users/klementtan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/klementtan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/klementtan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/klementtan/subscriptions",
        "organizations_url": "https://api.github.com/users/klementtan/orgs",
        "repos_url": "https://api.github.com/users/klementtan/repos",
        "events_url": "https://api.github.com/users/klementtan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/klementtan/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/19062#issuecomment-864551000",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19062"
    },
    {
      "event": "closed",
      "id": 4991651559,
      "node_id": "MDExOkNsb3NlZEV2ZW50NDk5MTY1MTU1OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4991651559",
      "actor": {
        "login": "practicalswift",
        "id": 7826565,
        "node_id": "MDQ6VXNlcjc4MjY1NjU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/practicalswift",
        "html_url": "https://github.com/practicalswift",
        "followers_url": "https://api.github.com/users/practicalswift/followers",
        "following_url": "https://api.github.com/users/practicalswift/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/practicalswift/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/practicalswift/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
        "organizations_url": "https://api.github.com/users/practicalswift/orgs",
        "repos_url": "https://api.github.com/users/practicalswift/repos",
        "events_url": "https://api.github.com/users/practicalswift/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/practicalswift/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-07T21:59:54Z"
    },
    {
      "event": "locked",
      "id": 7216612023,
      "node_id": "LOE_lADOABII584lL0RDzwAAAAGuJMK3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7216612023",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-18T18:36:37Z",
      "lock_reason": "resolved"
    }
  ]
}