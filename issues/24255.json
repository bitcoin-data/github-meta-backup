{
  "type": "issue",
  "issue": {
    "id": 1123562782,
    "node_id": "I_kwDOABII585C-DUe",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24255",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24255/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24255/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24255/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/24255",
    "number": 24255,
    "state": "closed",
    "state_reason": "completed",
    "title": "`getblocktemplate` returns a standard P2PKH with 0 sigops (testnet)",
    "body": "<!-- This issue tracker is only for technical issues related to Bitcoin Core.\r\n\r\nGeneral bitcoin questions and/or support requests are best directed to the Bitcoin StackExchange at https://bitcoin.stackexchange.com.\r\n\r\nFor reporting security issues, please read instructions at https://bitcoincore.org/en/contact/.\r\n\r\nIf the node is \"stuck\" during sync or giving \"block checksum mismatch\" errors, please ensure your hardware is stable by running memtest and observe CPU temperature with a load-test tool such as linpack before creating an issue! -->\r\ni noticed a standard 0 sigops transaction when calling getblocktemplate, but that transaction turned out to be P2PKH of course **with** `OP_CHECKSIG`\r\n<!-- Describe the issue -->\r\n**Expected behavior**\r\n\r\n`\"sigops\": 36,` in block template json\r\n\r\n<!--- What behavior did you expect? -->\r\n\r\n**Actual behavior**\r\n\r\n```\r\n      ...\r\n      \"txid\": \"54eee291ec73fcc3faf496cf90ffc9b6faa57940234802bdae58c51540016853\",\r\n      \"hash\": \"54eee291ec73fcc3faf496cf90ffc9b6faa57940234802bdae58c51540016853\",\r\n      \"depends\": [\r\n      ],\r\n      \"fee\": 1404,\r\n      \"sigops\": 0,   <-- here\r\n      \"weight\": 5472\r\n      ...\r\n```\r\n<!--- What was the actual behavior (provide screenshots if the issue is GUI-related)? -->\r\n\r\n**To reproduce**\r\n<!--- How reliably can you reproduce the issue, what are the steps to do so? -->\r\n\r\nsomehow get the sigop count of `54eee291ec73fcc3faf496cf90ffc9b6faa57940234802bdae58c51540016853` (testnet)\r\n\r\n**System information**\r\n\r\nbitcoin.org binary v22.0.0\r\n\r\n<!-- What version of Bitcoin Core are you using, where did you get it (website, self-compiled, etc)? -->\r\n\r\n<!-- What type of machine are you observing the error on (OS/CPU and disk type)? -->\r\n\r\n<!-- GUI-related issue? What is your operating system and its version? If Linux, what is your desktop environment and graphical shell? -->\r\n\r\n<!-- Any extra information that might be useful in the debugging process. -->\r\n<!--- This is normally the contents of a `debug.log` or `config.log` file. Raw text or a link to a pastebin type site are preferred. -->\r\n",
    "user": {
      "login": "antonilol",
      "id": 49868160,
      "node_id": "MDQ6VXNlcjQ5ODY4MTYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/49868160?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/antonilol",
      "html_url": "https://github.com/antonilol",
      "followers_url": "https://api.github.com/users/antonilol/followers",
      "following_url": "https://api.github.com/users/antonilol/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/antonilol/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/antonilol/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/antonilol/subscriptions",
      "organizations_url": "https://api.github.com/users/antonilol/orgs",
      "repos_url": "https://api.github.com/users/antonilol/repos",
      "events_url": "https://api.github.com/users/antonilol/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/antonilol/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 64585,
        "node_id": "MDU6TGFiZWw2NDU4NQ==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug",
        "name": "Bug",
        "color": "FBBAAB",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 1,
    "closed_at": "2023-03-19T19:50:26Z",
    "created_at": "2022-02-03T21:17:25Z",
    "updated_at": "2023-03-19T19:50:26Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 6005725487,
      "node_id": "LE_lADOABII585C-DUezwAAAAFl-Bkv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6005725487",
      "actor": {
        "login": "antonilol",
        "id": 49868160,
        "node_id": "MDQ6VXNlcjQ5ODY4MTYw",
        "avatar_url": "https://avatars.githubusercontent.com/u/49868160?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/antonilol",
        "html_url": "https://github.com/antonilol",
        "followers_url": "https://api.github.com/users/antonilol/followers",
        "following_url": "https://api.github.com/users/antonilol/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/antonilol/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/antonilol/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/antonilol/subscriptions",
        "organizations_url": "https://api.github.com/users/antonilol/orgs",
        "repos_url": "https://api.github.com/users/antonilol/repos",
        "events_url": "https://api.github.com/users/antonilol/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/antonilol/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-02-03T21:17:25Z",
      "label": {
        "name": "Bug",
        "color": "FBBAAB"
      }
    },
    {
      "event": "commented",
      "id": 1475012160,
      "node_id": "IC_kwDOABII585X6uZA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1475012160",
      "actor": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-18T22:11:52Z",
      "updated_at": "2023-03-18T22:11:52Z",
      "author_association": "MEMBER",
      "body": "It's not unusual for a transaction to have 0 block-limit sigops.\r\n\r\nThe tx in your example has 9 inputs which all spend from legacy p2pkh UTXOs. In each of those spends, the `OP_CHECKSIG` is literally in the output of the previous transaction, and the sigop cost was \"paid for\" by the funding transactions. The inputs only contain public keys and signatures (no sigops). The single output of that tx is a P2WPKH. The signature operation required to spend that output will be \"paid for\" by the *spending* transaction: https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki#user-content-Sigops\r\n\r\n\r\nI ran `getblocktemplate` from my mainnet node and it built a block with 83 0-sigop transactions:\r\n\r\n```\r\n$ bitcoin/src/bitcoin-cli getblocktemplate '{\"rules\":[\"segwit\"]}' | grep -e  '\"sigops\": 0' | wc -l\r\n83\r\n```\r\n\r\n... most of these are P2TR transactions like https://blockstream.info/tx/0b3caca257f483715bccf70274179f78d8043a88b65df07f295dba40fe0a89f0?expand and in BIP342 it is documented that these sigops do not count towards the block limit at all: https://github.com/bitcoin/bips/blob/master/bip-0342.mediawiki#resource-limits",
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/24255#issuecomment-1475012160",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24255"
    },
    {
      "event": "closed",
      "id": 8788609965,
      "node_id": "CE_lADOABII585C-DUezwAAAAIL14ut",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8788609965",
      "actor": {
        "login": "antonilol",
        "id": 49868160,
        "node_id": "MDQ6VXNlcjQ5ODY4MTYw",
        "avatar_url": "https://avatars.githubusercontent.com/u/49868160?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/antonilol",
        "html_url": "https://github.com/antonilol",
        "followers_url": "https://api.github.com/users/antonilol/followers",
        "following_url": "https://api.github.com/users/antonilol/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/antonilol/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/antonilol/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/antonilol/subscriptions",
        "organizations_url": "https://api.github.com/users/antonilol/orgs",
        "repos_url": "https://api.github.com/users/antonilol/repos",
        "events_url": "https://api.github.com/users/antonilol/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/antonilol/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-19T19:50:26Z"
    }
  ]
}