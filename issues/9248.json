{
  "type": "issue",
  "issue": {
    "id": 192567313,
    "node_id": "MDU6SXNzdWUxOTI1NjczMTM=",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/9248",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/9248/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/9248/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/9248/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/9248",
    "number": 9248,
    "state": "closed",
    "state_reason": "completed",
    "title": "bitcoind running as Tor hidden service: When LAN IP gets banned -> no incoming connections anymore",
    "body": "Bitcoin 0.13.1\r\n\r\nE.g. having Tor service running on LAN IP 192.168.9.5\r\n\r\n(which ORPort is natted from the WAN router) and with Tor hidden service configuration\r\n\r\n`HiddenServicePort 8333 192.168.9.10:8333`\r\n\r\nand running bitcoind with `onlynet=tor` on another LAN host with IP 192.168.9.10, Port 8333\r\n\r\nthen on bitcoind one sees the connections all from IP 192.168.9.5 with different source ports, of course.\r\n\r\nNow I have the following in the debug log:\r\n\r\n> Misbehaving: 192.168.9.5:42853 (0 -> 200) BAN THRESHOLD EXCEEDED\r\n> connection from 192.168.9.5:42858 dropped (banned)\r\n> connection from 192.168.9.5:42860 dropped (banned)\r\n> connection from 192.168.9.5:42870 dropped (banned)\r\n> connection from 192.168.9.5:42883 dropped (banned)\r\n> connection from 192.168.9.5:42886 dropped (banned)\r\n\r\nThe IP 192.168.9.5 was blocked, and since that is the Tor hidden service IP, _all_ incoming connections are blocked.\r\n\r\nSo, I need to whitelist the IP 192.168.9.5, but then the ban function would be lost.\r\n",
    "user": {
      "login": "ghost",
      "id": 10137,
      "node_id": "MDQ6VXNlcjEwMTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ghost",
      "html_url": "https://github.com/ghost",
      "followers_url": "https://api.github.com/users/ghost/followers",
      "following_url": "https://api.github.com/users/ghost/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/ghost/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/ghost/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
      "organizations_url": "https://api.github.com/users/ghost/orgs",
      "repos_url": "https://api.github.com/users/ghost/repos",
      "events_url": "https://api.github.com/users/ghost/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/ghost/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [],
    "assignees": [],
    "author_association": "NONE",
    "locked": true,
    "active_lock_reason": "resolved",
    "comments": 4,
    "closed_at": "2018-06-04T13:31:25Z",
    "created_at": "2016-11-30T13:37:19Z",
    "updated_at": "2021-09-08T12:44:32Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 263885867,
      "node_id": "MDEyOklzc3VlQ29tbWVudDI2Mzg4NTg2Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/263885867",
      "actor": {
        "login": "ghost",
        "id": 10137,
        "node_id": "MDQ6VXNlcjEwMTM3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ghost",
        "html_url": "https://github.com/ghost",
        "followers_url": "https://api.github.com/users/ghost/followers",
        "following_url": "https://api.github.com/users/ghost/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ghost/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ghost/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
        "organizations_url": "https://api.github.com/users/ghost/orgs",
        "repos_url": "https://api.github.com/users/ghost/repos",
        "events_url": "https://api.github.com/users/ghost/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ghost/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-11-30T14:25:24Z",
      "updated_at": "2016-12-02T19:32:15Z",
      "author_association": "NONE",
      "body": "Clients of a Tor hidden service could only be identified on an upper application layer, since the source IP is obviously unknown.\r\n\r\nMaybe with onlynet=tor, IP address banning should automatically be disabled?",
      "user": {
        "login": "ghost",
        "id": 10137,
        "node_id": "MDQ6VXNlcjEwMTM3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ghost",
        "html_url": "https://github.com/ghost",
        "followers_url": "https://api.github.com/users/ghost/followers",
        "following_url": "https://api.github.com/users/ghost/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ghost/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ghost/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
        "organizations_url": "https://api.github.com/users/ghost/orgs",
        "repos_url": "https://api.github.com/users/ghost/repos",
        "events_url": "https://api.github.com/users/ghost/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ghost/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/9248#issuecomment-263885867",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/9248"
    },
    {
      "event": "commented",
      "id": 264781004,
      "node_id": "MDEyOklzc3VlQ29tbWVudDI2NDc4MTAwNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/264781004",
      "actor": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-12-05T06:58:57Z",
      "updated_at": "2016-12-05T06:58:57Z",
      "author_association": "CONTRIBUTOR",
      "body": "onlynet=tor deals with outbound connections.  Tor running on another host isn't something our setup really anticipates  -- localhost is exempt from banning.  We are probably due to add a torlistenport for other reasons in any case.",
      "user": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/9248#issuecomment-264781004",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/9248"
    },
    {
      "event": "commented",
      "id": 272370583,
      "node_id": "MDEyOklzc3VlQ29tbWVudDI3MjM3MDU4Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/272370583",
      "actor": {
        "login": "ghost",
        "id": 10137,
        "node_id": "MDQ6VXNlcjEwMTM3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ghost",
        "html_url": "https://github.com/ghost",
        "followers_url": "https://api.github.com/users/ghost/followers",
        "following_url": "https://api.github.com/users/ghost/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ghost/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ghost/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
        "organizations_url": "https://api.github.com/users/ghost/orgs",
        "repos_url": "https://api.github.com/users/ghost/repos",
        "events_url": "https://api.github.com/users/ghost/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ghost/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-01-13T06:22:58Z",
      "updated_at": "2017-01-13T06:23:50Z",
      "author_association": "NONE",
      "body": "OK, let me get this right. Assume having the following configuration (Tor on localhost with hidden service):\r\n```\r\nonlynet=onion\r\nproxy=127.0.0.1:9050\r\nlisten=1\r\nexternalip=abcdefghijklmnop.onion\r\n```\r\nThen all incoming connections bitcoind sees coming from localhost, with every peer just with different source port, but all the same IP (127.0.0.1).\r\nAnd since localhost is, as You said exempt from banning, there is in fact banning disabled?\r\nSo should I just, in my case, whitelist my externel Tor IP address from which all my incoming tor connections come, to prevent one possible bad guy to DoS my whole node?\r\nThanks for clearification.",
      "user": {
        "login": "ghost",
        "id": 10137,
        "node_id": "MDQ6VXNlcjEwMTM3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ghost",
        "html_url": "https://github.com/ghost",
        "followers_url": "https://api.github.com/users/ghost/followers",
        "following_url": "https://api.github.com/users/ghost/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ghost/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ghost/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
        "organizations_url": "https://api.github.com/users/ghost/orgs",
        "repos_url": "https://api.github.com/users/ghost/repos",
        "events_url": "https://api.github.com/users/ghost/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ghost/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/9248#issuecomment-272370583",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/9248"
    },
    {
      "event": "commented",
      "id": 394355367,
      "node_id": "MDEyOklzc3VlQ29tbWVudDM5NDM1NTM2Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/394355367",
      "actor": {
        "login": "ghost",
        "id": 10137,
        "node_id": "MDQ6VXNlcjEwMTM3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ghost",
        "html_url": "https://github.com/ghost",
        "followers_url": "https://api.github.com/users/ghost/followers",
        "following_url": "https://api.github.com/users/ghost/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ghost/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ghost/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
        "organizations_url": "https://api.github.com/users/ghost/orgs",
        "repos_url": "https://api.github.com/users/ghost/repos",
        "events_url": "https://api.github.com/users/ghost/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ghost/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-06-04T13:31:25Z",
      "updated_at": "2018-06-04T13:31:25Z",
      "author_association": "NONE",
      "body": "When running Tor Hidden Service, the IP address of the Tor node must be whitelisted, since it is used by all users of the Hidden Service. IP blocking is senseless with Tor. Nodes could only be banned by an application protocol layer e.g. \"Bitcoin Node ID\".",
      "user": {
        "login": "ghost",
        "id": 10137,
        "node_id": "MDQ6VXNlcjEwMTM3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ghost",
        "html_url": "https://github.com/ghost",
        "followers_url": "https://api.github.com/users/ghost/followers",
        "following_url": "https://api.github.com/users/ghost/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ghost/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ghost/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
        "organizations_url": "https://api.github.com/users/ghost/orgs",
        "repos_url": "https://api.github.com/users/ghost/repos",
        "events_url": "https://api.github.com/users/ghost/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ghost/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/9248#issuecomment-394355367",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/9248"
    },
    {
      "event": "closed",
      "id": 1661300955,
      "node_id": "MDExOkNsb3NlZEV2ZW50MTY2MTMwMDk1NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1661300955",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-06-04T13:31:25Z"
    },
    {
      "event": "locked",
      "id": 5272067948,
      "node_id": "LOE_lADOABII584LelgRzwAAAAE6PV9s",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5272067948",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-08T12:44:32Z",
      "lock_reason": "resolved"
    }
  ]
}