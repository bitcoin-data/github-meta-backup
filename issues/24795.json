{
  "type": "issue",
  "issue": {
    "id": 1195791507,
    "node_id": "I_kwDOABII585HRlST",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24795",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24795/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24795/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24795/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/24795",
    "number": 24795,
    "state": "open",
    "state_reason": null,
    "title": "Add `consolidate_wallet` argument to fund* RPCs",
    "body": "I'm creating this issue to chase some concept ACKs. If this looks like a good idea to some people (other than myself), I'll actually go ahead and implement it myself.\r\n\r\nCoin selection has a mode where it actively tries to consolidate small utxos into a bigger one. This is generally a good thing, but in L2 scenarios you don't want to consolidate too aggressively, because having a pool of small utxos is useful for fee-bumping.\r\n\r\nThis mode activates based on a start-up flag (`consolidatefeerate`, by default 10 sat/vbyte): if the current feerate is below this value, `bitcoind` will perform utxo consolidation when the user funds transactions. We've seen long periods of time where the feerate stayed below this value, effectively making utxo consolidation the default behavior. From an L2 application's perspective, I'd like to keep a pool of small utxos, and only consolidate when it becomes too big. Using a start-up flag makes this quite hard.\r\n\r\nMy proposal is to introduce a new RPC argument to all the funding RPCs: `consolidate_wallet` (or `consolidate_utxos`, whatever name you feel makes more sense). This would give more freedom to applications to choose when wallet consolidation should happen. The downside is that it's yet another RPC argument. Do you think this is acceptable?\r\n\r\n@achow101 @Xekyo ",
    "user": {
      "login": "t-bast",
      "id": 31281497,
      "node_id": "MDQ6VXNlcjMxMjgxNDk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/31281497?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/t-bast",
      "html_url": "https://github.com/t-bast",
      "followers_url": "https://api.github.com/users/t-bast/followers",
      "following_url": "https://api.github.com/users/t-bast/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/t-bast/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/t-bast/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/t-bast/subscriptions",
      "organizations_url": "https://api.github.com/users/t-bast/orgs",
      "repos_url": "https://api.github.com/users/t-bast/repos",
      "events_url": "https://api.github.com/users/t-bast/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/t-bast/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 64583,
        "node_id": "MDU6TGFiZWw2NDU4Mw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature",
        "name": "Feature",
        "color": "7cf575",
        "default": false
      },
      {
        "id": 64584,
        "node_id": "MDU6TGFiZWw2NDU4NA==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Brainstorming",
        "name": "Brainstorming",
        "color": "ebd775",
        "default": false
      },
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": false,
    "comments": 2,
    "created_at": "2022-04-07T09:42:41Z",
    "updated_at": "2022-05-29T20:45:04Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 6386812076,
      "node_id": "LE_lADOABII585HRlSTzwAAAAF8rwSs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6386812076",
      "actor": {
        "login": "t-bast",
        "id": 31281497,
        "node_id": "MDQ6VXNlcjMxMjgxNDk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/31281497?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/t-bast",
        "html_url": "https://github.com/t-bast",
        "followers_url": "https://api.github.com/users/t-bast/followers",
        "following_url": "https://api.github.com/users/t-bast/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/t-bast/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/t-bast/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/t-bast/subscriptions",
        "organizations_url": "https://api.github.com/users/t-bast/orgs",
        "repos_url": "https://api.github.com/users/t-bast/repos",
        "events_url": "https://api.github.com/users/t-bast/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/t-bast/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-07T09:42:41Z",
      "label": {
        "name": "Feature",
        "color": "7cf575"
      }
    },
    {
      "event": "mentioned",
      "id": 6386812119,
      "node_id": "MEE_lADOABII585HRlSTzwAAAAF8rwTX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6386812119",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-07T09:42:41Z"
    },
    {
      "event": "subscribed",
      "id": 6386812131,
      "node_id": "SE_lADOABII585HRlSTzwAAAAF8rwTj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6386812131",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-07T09:42:41Z"
    },
    {
      "event": "mentioned",
      "id": 6386812140,
      "node_id": "MEE_lADOABII585HRlSTzwAAAAF8rwTs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6386812140",
      "actor": {
        "login": "Xekyo",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Xekyo",
        "html_url": "https://github.com/Xekyo",
        "followers_url": "https://api.github.com/users/Xekyo/followers",
        "following_url": "https://api.github.com/users/Xekyo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Xekyo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Xekyo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Xekyo/subscriptions",
        "organizations_url": "https://api.github.com/users/Xekyo/orgs",
        "repos_url": "https://api.github.com/users/Xekyo/repos",
        "events_url": "https://api.github.com/users/Xekyo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Xekyo/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-07T09:42:42Z"
    },
    {
      "event": "subscribed",
      "id": 6386812151,
      "node_id": "SE_lADOABII585HRlSTzwAAAAF8rwT3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6386812151",
      "actor": {
        "login": "Xekyo",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Xekyo",
        "html_url": "https://github.com/Xekyo",
        "followers_url": "https://api.github.com/users/Xekyo/followers",
        "following_url": "https://api.github.com/users/Xekyo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Xekyo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Xekyo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Xekyo/subscriptions",
        "organizations_url": "https://api.github.com/users/Xekyo/orgs",
        "repos_url": "https://api.github.com/users/Xekyo/repos",
        "events_url": "https://api.github.com/users/Xekyo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Xekyo/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-07T09:42:42Z"
    },
    {
      "event": "labeled",
      "id": 6386849709,
      "node_id": "LE_lADOABII585HRlSTzwAAAAF8r5et",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6386849709",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-07T09:47:07Z",
      "label": {
        "name": "Brainstorming",
        "color": "ebd775"
      }
    },
    {
      "event": "labeled",
      "id": 6386849713,
      "node_id": "LE_lADOABII585HRlSTzwAAAAF8r5ex",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6386849713",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-07T09:47:07Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "subscribed",
      "id": 6387204988,
      "node_id": "SE_lADOABII585HRlSTzwAAAAF8tQN8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6387204988",
      "actor": {
        "login": "NicolaLS",
        "id": 90551797,
        "node_id": "MDQ6VXNlcjkwNTUxNzk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/90551797?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/NicolaLS",
        "html_url": "https://github.com/NicolaLS",
        "followers_url": "https://api.github.com/users/NicolaLS/followers",
        "following_url": "https://api.github.com/users/NicolaLS/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/NicolaLS/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/NicolaLS/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/NicolaLS/subscriptions",
        "organizations_url": "https://api.github.com/users/NicolaLS/orgs",
        "repos_url": "https://api.github.com/users/NicolaLS/repos",
        "events_url": "https://api.github.com/users/NicolaLS/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/NicolaLS/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-07T10:38:38Z"
    },
    {
      "event": "commented",
      "id": 1099363092,
      "node_id": "IC_kwDOABII585BhvMU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1099363092",
      "actor": {
        "login": "Xekyo",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Xekyo",
        "html_url": "https://github.com/Xekyo",
        "followers_url": "https://api.github.com/users/Xekyo/followers",
        "following_url": "https://api.github.com/users/Xekyo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Xekyo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Xekyo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Xekyo/subscriptions",
        "organizations_url": "https://api.github.com/users/Xekyo/orgs",
        "repos_url": "https://api.github.com/users/Xekyo/repos",
        "events_url": "https://api.github.com/users/Xekyo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Xekyo/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-14T16:18:55Z",
      "updated_at": "2022-04-14T16:18:55Z",
      "author_association": "MEMBER",
      "body": "I think that it may be interesting to maintain a minimum count of UTXOs for wallets with sufficient funds also from a privacy perspective: having all of your funds get consolidated into a very low count of UTXOs would converge all of your transaction histories and reveals to counterparties a larger part of the wallet's total funds when transacting. Perhaps it would be good to map out the problem space that we're trying to address a bit more before we talk about the concrete solution, but an idea would be to automatically lower the `consolidatefeerate` for wallets with a lower UTXO count.",
      "user": {
        "login": "Xekyo",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Xekyo",
        "html_url": "https://github.com/Xekyo",
        "followers_url": "https://api.github.com/users/Xekyo/followers",
        "following_url": "https://api.github.com/users/Xekyo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Xekyo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Xekyo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Xekyo/subscriptions",
        "organizations_url": "https://api.github.com/users/Xekyo/orgs",
        "repos_url": "https://api.github.com/users/Xekyo/repos",
        "events_url": "https://api.github.com/users/Xekyo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Xekyo/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/24795#issuecomment-1099363092",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24795"
    },
    {
      "event": "commented",
      "id": 1099463264,
      "node_id": "IC_kwDOABII585BiHpg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1099463264",
      "actor": {
        "login": "t-bast",
        "id": 31281497,
        "node_id": "MDQ6VXNlcjMxMjgxNDk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/31281497?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/t-bast",
        "html_url": "https://github.com/t-bast",
        "followers_url": "https://api.github.com/users/t-bast/followers",
        "following_url": "https://api.github.com/users/t-bast/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/t-bast/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/t-bast/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/t-bast/subscriptions",
        "organizations_url": "https://api.github.com/users/t-bast/orgs",
        "repos_url": "https://api.github.com/users/t-bast/repos",
        "events_url": "https://api.github.com/users/t-bast/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/t-bast/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-04-14T17:46:08Z",
      "updated_at": "2022-04-14T17:46:08Z",
      "author_association": "MEMBER",
      "body": "I agree, I believe it makes sense as default behavior for everyone.\r\n\r\nThe benefits I see of keeping a utxo pool:\r\n\r\n- fee bumping\r\n  - this is very important for L2 contracts\r\n  - but it's not as important for L1-only users who will only infrequently need to fee-bump\r\n- initiating multiple multi-party contracts in parallel (could be vaults, dual-funded lightning channels, payment pools, etc)\r\n  - multi-party contracts require a negotiation phase where you'll commit some of your utxos\r\n  - you cannot use these utxos elsewhere until the contract is either fully committed or aborted\r\n  - this use-case is also not important for L1-only users\r\n- more opportunities to send payments that won't need a change output\r\n- privacy\r\n  - this is important for everyone\r\n\r\nThe drawbacks:\r\n\r\n- more costly: when you actually need to send payments, you'll use more inputs so the tx size is larger than if you had consolidated earlier when the feerate was low\r\n- (unsure about that) potentially harder to restore?\r\n- (unsure about that) potentially less performant?\r\n\r\nI don't think we need to aim for something very accurate (e.g. trying to always have N utxos available with a value between X and Y), that would be too hard to manage and probably wouldn't really be necessary to address user needs.\r\n\r\nWe should aim for very simple knobs that users may configure, for example something like `utxo-pool-size = [small, medium, large]` and then internally tweak the `consolidatefeerate` to follow the user's configuration as much as possible. Another possibility is to define a list of _profiles_ (e.g. `pocket-money` / `multi-party-contracts` / `life-savings`) and map that to a utxo pooling behavior: that would work well if we're able to identify the different profiles that make sense and in what way they require a different behavior. What's interesting with that approach is that new profiles can be added in the future as they are identified.",
      "user": {
        "login": "t-bast",
        "id": 31281497,
        "node_id": "MDQ6VXNlcjMxMjgxNDk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/31281497?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/t-bast",
        "html_url": "https://github.com/t-bast",
        "followers_url": "https://api.github.com/users/t-bast/followers",
        "following_url": "https://api.github.com/users/t-bast/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/t-bast/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/t-bast/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/t-bast/subscriptions",
        "organizations_url": "https://api.github.com/users/t-bast/orgs",
        "repos_url": "https://api.github.com/users/t-bast/repos",
        "events_url": "https://api.github.com/users/t-bast/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/t-bast/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/24795#issuecomment-1099463264",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24795"
    }
  ]
}