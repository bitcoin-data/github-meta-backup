{
  "type": "issue",
  "issue": {
    "id": 1639034524,
    "node_id": "I_kwDOABII585hsa6c",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27320",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27320/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27320/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27320/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/27320",
    "number": 27320,
    "state": "closed",
    "state_reason": "completed",
    "title": "test_bitcoin: ./chain.h:261: uint256 CBlockIndex::GetBlockHash() const: Assertion `phashBlock != nullptr' failed.",
    "body": "https://cirrus-ci.com/task/6024293113397248?logs=ci#L3199\r\n\r\n```\r\nSimulating node restart\r\n2023-03-23T20:11:01.824273Z (mocktime: 2020-08-31T15:36:02Z) [test] [logging/timer.h:58] [Log] [bench] FlushStateToDisk: write block and undo data to disk started\r\n2023-03-23T20:11:01.824318Z (mocktime: 2020-08-31T15:36:02Z) [test] [logging/timer.h:58] [Log] [bench] FlushStateToDisk: write block and undo data to disk completed (0.03ms)\r\n2023-03-23T20:11:01.824330Z (mocktime: 2020-08-31T15:36:02Z) [test] [logging/timer.h:58] [Log] [bench] FlushStateToDisk: write block index to disk started\r\n2023-03-23T20:11:01.825668Z (mocktime: 2020-08-31T15:36:02Z) [test] [logging/timer.h:58] [Log] [bench] FlushStateToDisk: write block index to disk completed (1.33ms)\r\n2023-03-23T20:11:01.825686Z (mocktime: 2020-08-31T15:36:02Z) [test] [logging/timer.h:58] [Log] [bench] FlushStateToDisk: write coins cache to disk (0 coins, 0kB) started\r\n2023-03-23T20:11:01.825704Z (mocktime: 2020-08-31T15:36:02Z) [test] [txdb.cpp:167] [BatchWrite] [coindb] Writing final batch of 0.00 MiB\r\n2023-03-23T20:11:01.825719Z (mocktime: 2020-08-31T15:36:02Z) [test] [txdb.cpp:169] [BatchWrite] [coindb] Committed 0 changed transaction outputs (out of 0) to coin database...\r\n2023-03-23T20:11:01.825732Z (mocktime: 2020-08-31T15:36:02Z) [test] [logging/timer.h:58] [Log] [bench] FlushStateToDisk: write coins cache to disk (0 coins, 0kB) completed (0.03ms)\r\n2023-03-23T20:11:01.825744Z (mocktime: 2020-08-31T15:36:02Z) [test] [validationinterface.cpp:249] [ChainStateFlushed] [validation] Enqueuing ChainStateFlushed: block hash=696e92821f65549c7ee134edceeeeaaa4105647a3c4fd9f298c0aec0ab50425c\r\nPerforming Load/Verify/Activate of chainstate\r\ntest_bitcoin: ./chain.h:261: uint256 CBlockIndex::GetBlockHash() const: Assertion `phashBlock != nullptr' failed.\r\nmake[3]: *** [Makefile:21821: test/validation_chainstatemanager_tests.cpp.test] Error 1",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": false,
    "comments": 3,
    "closed_at": "2023-03-28T10:14:28Z",
    "created_at": "2023-03-24T09:31:29Z",
    "updated_at": "2023-03-28T10:14:28Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 1482504671,
      "node_id": "IC_kwDOABII585YXTnf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1482504671",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-24T09:32:03Z",
      "updated_at": "2023-03-24T09:32:03Z",
      "author_association": "MEMBER",
      "body": "On master @ 23056436461a8b3af1a504b9638c48e8c8170652",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/27320#issuecomment-1482504671",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27320"
    },
    {
      "event": "commented",
      "id": 1483430905,
      "node_id": "IC_kwDOABII585Ya1v5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1483430905",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-24T21:33:41Z",
      "updated_at": "2023-03-24T21:33:41Z",
      "author_association": "MEMBER",
      "body": "maybe not a cosmic ray after all (#26613)",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/27320#issuecomment-1483430905",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27320"
    },
    {
      "event": "commented",
      "id": 1485694691,
      "node_id": "IC_kwDOABII585Yjebj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1485694691",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-27T18:49:42Z",
      "updated_at": "2023-03-27T18:51:57Z",
      "author_association": "MEMBER",
      "body": "I think the following may be happening:\r\nIn the failed run, there is an `UpdatedBlockTip` scheduled in line [3169](https://cirrus-ci.com/task/6024293113397248?logs=ci#L3169) that has not been processed yet:\r\n```\r\n2023-03-23T20:11:01.813759Z (mocktime: 2020-08-31T15:36:01Z) [test] [validationinterface.cpp:201] [UpdatedBlockTip][validation] Enqueuing UpdatedBlockTip: new block hash=4fe08ff1d78843f1b6f0d2b80fee9af49b3c945368e585b8aed1807c89d14804 fork block\r\n```\r\nNext, the test calls `SimulateNodeRestart()`, which resets the ChainstateManager and creates a new one.\r\nAt last, the scheduler thread attempts to process the `UpdatedBlockTip` event, but the pointer to the `CBlockIndex` is no longer valid.\r\n\r\nIf that makes sense, a call to `SyncWithValidationInterfaceQueue()` within `SimulateNodeRestart()` might fix this - will open a PR.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/27320#issuecomment-1485694691",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27320"
    },
    {
      "event": "referenced",
      "id": 8863418185,
      "node_id": "REFE_lADOABII585hsa6czwAAAAIQTQdJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8863418185",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "86e7410b22d506a6ff22ccc36afac29dd10d0ede",
      "commit_url": "https://api.github.com/repos/bitcoin-core/gui/commits/86e7410b22d506a6ff22ccc36afac29dd10d0ede",
      "created_at": "2023-03-28T10:14:23Z"
    },
    {
      "event": "closed",
      "id": 8863419144,
      "node_id": "CE_lADOABII585hsa6czwAAAAIQTQsI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8863419144",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "86e7410b22d506a6ff22ccc36afac29dd10d0ede",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/86e7410b22d506a6ff22ccc36afac29dd10d0ede",
      "created_at": "2023-03-28T10:14:28Z"
    },
    {
      "event": "referenced",
      "id": 8866495126,
      "node_id": "REFE_lADOABII585hsa6czwAAAAIQe_qW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8866495126",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "6aa17fe6c30523aa2f42013c5f5f08c172ff84e1",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/6aa17fe6c30523aa2f42013c5f5f08c172ff84e1",
      "created_at": "2023-03-28T14:55:21Z"
    }
  ]
}