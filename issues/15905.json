{
  "type": "issue",
  "issue": {
    "id": 437874844,
    "node_id": "MDU6SXNzdWU0Mzc4NzQ4NDQ=",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15905",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15905/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15905/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15905/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/15905",
    "number": 15905,
    "state": "closed",
    "state_reason": "completed",
    "title": "Cannot generate blocks after invalidateblock on regtest chain longer than ~64 blocks",
    "body": "Bitcoin Core version: `v0.17.99.0-d6e700e40` running on OSX\r\n\r\nI'm testing a client against reorgs from a Bitcoin Core node in regtest. To create a reorg I generate some blocks, then use `invalidateblock` and `generatetoaddress` again to create a fork. The pattern works fine as long as the regtest blockchain _is not too long._\r\n\r\nI'm not sure the exact threshold where it stops working, but it's somewhere between 50 - 64 blocks.\r\n\r\nThe error is **\"AcceptBlockHeader [hash] is marked invalid\"** but that invalid header should be long gone -- I'm generating a brand new block now...?\r\n\r\nI guess bitcoind is probably re-generating the exact same block the second time, but not sure why the error only comes up on longer chains.\r\n\r\n### To reproduce:\r\n#### Short chains, behaves as expected:\r\n```\r\nbitcoind -regtest\r\n\r\nbitcoin-cli generatetoaddress 50 mfWxJ45yp2SFn7UciZyNpvDKrzbhyfKrY8\r\n\r\nbitcoin-cli invalidateblock <one of the hashes returned from previous command>\r\n\r\nbitcoin-cli generatetoaddress 1 mfWxJ45yp2SFn7UciZyNpvDKrzbhyfKrY8\r\n```\r\nResult:\r\n```\r\n2019-04-26T22:56:11Z InvalidChainFound: invalid block=37337d435262823883a7864536c08b06b07fe61205f02a404ec050e51a794191  height=49  log2_work=6.6438562  date=2019-04-26T22:56:13Z\r\n2019-04-26T22:56:11Z InvalidChainFound:  current best=725a7df044bc3b1bbb0e103749470d345aea0cdbfc2629c31818cedd45b20b46  height=48  log2_work=6.6147098  date=2019-04-26T22:56:13Z\r\n2019-04-26T22:56:15Z CreateNewBlock(): block weight: 900 txs: 0 fees: 0 sigops 400\r\n2019-04-26T22:56:15Z UpdateTip: new best=6f87e7f8d16404d8387d194e585d0b0e3b285a4cee9df76e4967783421b092c2 height=49 version=0x20000000 log2_work=6.6438562 tx=50 date='2019-04-26T22:56:15Z' progress=1.000000 cache=0.0MiB(50txo)\r\n```\r\n#### Slightly longer chains, unable to proceed:\r\n```\r\nbitcoind -regtest\r\n\r\nbitcoin-cli generatetoaddress 64 mfWxJ45yp2SFn7UciZyNpvDKrzbhyfKrY8\r\n\r\nbitcoin-cli invalidateblock <one of the hashes returned from previous command>\r\n\r\nbitcoin-cli generatetoaddress 1 mfWxJ45yp2SFn7UciZyNpvDKrzbhyfKrY8\r\n```\r\nResult:\r\n```\r\n2019-04-26T22:56:42Z InvalidChainFound: invalid block=6d73a1240616f89d2b382534edd543d0aa91321d850bcc0210547cfb174f1c92  height=62  log2_work=6.9772799  date=2019-04-26T22:56:45Z\r\n2019-04-26T22:56:42Z InvalidChainFound:  current best=5317e42ded19040fc71f33a3db275abdd393c7cad1044d7f482c6c6f8b8925ff  height=61  log2_work=6.9541963  date=2019-04-26T22:56:44Z\r\n2019-04-26T22:56:44Z CreateNewBlock(): block weight: 900 txs: 0 fees: 0 sigops 400\r\n2019-04-26T22:56:44Z ERROR: AcceptBlockHeader: block 6d73a1240616f89d2b382534edd543d0aa91321d850bcc0210547cfb174f1c92 is marked invalid\r\n2019-04-26T22:56:44Z ERROR: ProcessNewBlock: AcceptBlock FAILED (duplicate (code 0))\r\n```",
    "user": {
      "login": "pinheadmz",
      "id": 2084648,
      "node_id": "MDQ6VXNlcjIwODQ2NDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pinheadmz",
      "html_url": "https://github.com/pinheadmz",
      "followers_url": "https://api.github.com/users/pinheadmz/followers",
      "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
      "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
      "repos_url": "https://api.github.com/users/pinheadmz/repos",
      "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": true,
    "active_lock_reason": "resolved",
    "comments": 5,
    "closed_at": "2019-04-27T01:17:39Z",
    "created_at": "2019-04-26T23:06:47Z",
    "updated_at": "2022-02-15T11:04:04Z"
  },
  "events": [
    {
      "event": "closed",
      "id": 2304490398,
      "node_id": "MDExOkNsb3NlZEV2ZW50MjMwNDQ5MDM5OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2304490398",
      "actor": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-04-27T01:17:39Z"
    },
    {
      "event": "commented",
      "id": 652229417,
      "node_id": "MDEyOklzc3VlQ29tbWVudDY1MjIyOTQxNw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652229417",
      "actor": {
        "login": "dexX7",
        "id": 5836089,
        "node_id": "MDQ6VXNlcjU4MzYwODk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5836089?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dexX7",
        "html_url": "https://github.com/dexX7",
        "followers_url": "https://api.github.com/users/dexX7/followers",
        "following_url": "https://api.github.com/users/dexX7/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dexX7/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dexX7/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dexX7/subscriptions",
        "organizations_url": "https://api.github.com/users/dexX7/orgs",
        "repos_url": "https://api.github.com/users/dexX7/repos",
        "events_url": "https://api.github.com/users/dexX7/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dexX7/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-07-01T06:54:00Z",
      "updated_at": "2020-07-01T06:54:00Z",
      "author_association": "CONTRIBUTOR",
      "body": "Hello @pinheadmz,\r\n\r\nhow did you resolve this issue? We're stumbled upon it as well.",
      "user": {
        "login": "dexX7",
        "id": 5836089,
        "node_id": "MDQ6VXNlcjU4MzYwODk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5836089?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dexX7",
        "html_url": "https://github.com/dexX7",
        "followers_url": "https://api.github.com/users/dexX7/followers",
        "following_url": "https://api.github.com/users/dexX7/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dexX7/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dexX7/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dexX7/subscriptions",
        "organizations_url": "https://api.github.com/users/dexX7/orgs",
        "repos_url": "https://api.github.com/users/dexX7/repos",
        "events_url": "https://api.github.com/users/dexX7/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dexX7/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/15905#issuecomment-652229417",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15905"
    },
    {
      "event": "mentioned",
      "id": 3500952322,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzUwMDk1MjMyMg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3500952322",
      "actor": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-07-01T06:54:00Z"
    },
    {
      "event": "subscribed",
      "id": 3500952324,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDM1MDA5NTIzMjQ=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3500952324",
      "actor": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-07-01T06:54:00Z"
    },
    {
      "event": "commented",
      "id": 652239953,
      "node_id": "MDEyOklzc3VlQ29tbWVudDY1MjIzOTk1Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652239953",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-07-01T07:18:53Z",
      "updated_at": "2020-07-01T07:18:53Z",
      "author_association": "MEMBER",
      "body": "@dexX7 which version of Bitcoin Core did you see the issue with? Don't hesitate to provide any other info or steps needed to reproduce what you saw.\r\n\r\nI followed the above steps just now on current master with 50, 64, and 100 blocks in regtest, and was unable to reproduce the error -- it worked as expected.\r\n\r\nI was looking at a similar block propagation issue after `invalidateblock` lately in #19397 with @jnewbery (who just posted an v interesting analysis that I plan to look more into to learn what is going on). Don't hesitate to have a look or review if interested.",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/15905#issuecomment-652239953",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15905"
    },
    {
      "event": "mentioned",
      "id": 3501036038,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzUwMTAzNjAzOA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3501036038",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-07-01T07:18:53Z"
    },
    {
      "event": "subscribed",
      "id": 3501036041,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDM1MDEwMzYwNDE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3501036041",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-07-01T07:18:53Z"
    },
    {
      "event": "mentioned",
      "id": 3501036044,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzUwMTAzNjA0NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3501036044",
      "actor": {
        "login": "dexX7",
        "id": 5836089,
        "node_id": "MDQ6VXNlcjU4MzYwODk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5836089?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dexX7",
        "html_url": "https://github.com/dexX7",
        "followers_url": "https://api.github.com/users/dexX7/followers",
        "following_url": "https://api.github.com/users/dexX7/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dexX7/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dexX7/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dexX7/subscriptions",
        "organizations_url": "https://api.github.com/users/dexX7/orgs",
        "repos_url": "https://api.github.com/users/dexX7/repos",
        "events_url": "https://api.github.com/users/dexX7/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dexX7/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-07-01T07:18:53Z"
    },
    {
      "event": "subscribed",
      "id": 3501036046,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDM1MDEwMzYwNDY=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3501036046",
      "actor": {
        "login": "dexX7",
        "id": 5836089,
        "node_id": "MDQ6VXNlcjU4MzYwODk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5836089?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dexX7",
        "html_url": "https://github.com/dexX7",
        "followers_url": "https://api.github.com/users/dexX7/followers",
        "following_url": "https://api.github.com/users/dexX7/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dexX7/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dexX7/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dexX7/subscriptions",
        "organizations_url": "https://api.github.com/users/dexX7/orgs",
        "repos_url": "https://api.github.com/users/dexX7/repos",
        "events_url": "https://api.github.com/users/dexX7/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dexX7/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-07-01T07:18:53Z"
    },
    {
      "event": "commented",
      "id": 652247532,
      "node_id": "MDEyOklzc3VlQ29tbWVudDY1MjI0NzUzMg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652247532",
      "actor": {
        "login": "Bushstar",
        "id": 5293433,
        "node_id": "MDQ6VXNlcjUyOTM0MzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5293433?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Bushstar",
        "html_url": "https://github.com/Bushstar",
        "followers_url": "https://api.github.com/users/Bushstar/followers",
        "following_url": "https://api.github.com/users/Bushstar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Bushstar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Bushstar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Bushstar/subscriptions",
        "organizations_url": "https://api.github.com/users/Bushstar/orgs",
        "repos_url": "https://api.github.com/users/Bushstar/repos",
        "events_url": "https://api.github.com/users/Bushstar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Bushstar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-07-01T07:35:35Z",
      "updated_at": "2020-07-01T07:38:12Z",
      "author_association": "CONTRIBUTOR",
      "body": "@jonatack this happens after running invalidateblock and generating a replacement block at in same second and with the same coinbase address, the resulting block has the same hash as the invalidated block which then generates the \"AcceptBlock FAILED (duplicate (code 0))\" error reported above.\r\n\r\nFor our project (@dexX7 ) we run some bespoke tests that generate blocks, invalidates the chain then generates replacement blocks. This issue only arose after moving from the generate RPC call to generatetoaddress using the same address each time.\r\n\r\nDue to needing to generate replacement blocks in the same second it does not show up in manual tests, if you script it on regtest then this is more likely to show up. After our script failed I did manually recreate the problem by hard coding the block time in CreateNewBlock and skipping its call to UpdateTime.\r\n\r\nYou can see the same blockhash being generated here with block time fixed and the same coinbase address being used. Note that the client being run is based on Bitcoin 0.18.\r\n\r\n    user@disco:/mnt/development/github/omnicore-original/src$ ./omnicore-cli -regtest generatetoaddress 1  moneyqMan7uh8FqdCA2BV5yZ8qVrc9ikLP\r\n    [\r\n      \"1fbfceb118b6303dc3329d912524331fc49d7e92a87996151058ad73f48ccf22\"\r\n    ]\r\n    user@disco:/mnt/development/github/omnicore-original/src$ ./omnicore-cli -regtest stop\r\n    Omni Core server stopping\r\n    user@disco:/mnt/development/github/omnicore-original/src$ rm -Rf ~/.bitcoin\r\n    user@disco:/mnt/development/github/omnicore-original/src$ ./omnicored -regtest -daemon\r\n    Omni Core server starting\r\n    user@disco:/mnt/development/github/omnicore-original/src$ ./omnicore-cli -regtest generatetoaddress 1 moneyqMan7uh8FqdCA2BV5yZ8qVrc9ikLP\r\n    [\r\n      \"1fbfceb118b6303dc3329d912524331fc49d7e92a87996151058ad73f48ccf22\"\r\n    ]\r\n\r\nRunning another manual test with the same set up and using invalidateblock.\r\n\r\n    user@disco:/mnt/development/github/omnicore-original/src$ ./omnicore-cli -regtest generatetoaddress 1 moneyqMan7uh8FqdCA2BV5yZ8qVrc9ikLP\r\n    [\r\n      \"1fbfceb118b6303dc3329d912524331fc49d7e92a87996151058ad73f48ccf22\"\r\n    ]\r\n    user@disco:/mnt/development/github/omnicore-original/src$ ./omnicore-cli -regtest invalidateblock 1fbfceb118b6303dc3329d912524331fc49d7e92a87996151058ad73f48ccf22\r\n    user@disco:/mnt/development/github/omnicore-original/src$ ./omnicore-cli -regtest generatetoaddress 1 moneyqMan7uh8FqdCA2BV5yZ8qVrc9ikLP\r\n    error code: -32603\r\n    error message:\r\n    ProcessNewBlock, block not accepted\r\n\r\nSolutions for this would be to make your script wait a second after running invalidateblock or using a different coinbase address.",
      "user": {
        "login": "Bushstar",
        "id": 5293433,
        "node_id": "MDQ6VXNlcjUyOTM0MzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5293433?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Bushstar",
        "html_url": "https://github.com/Bushstar",
        "followers_url": "https://api.github.com/users/Bushstar/followers",
        "following_url": "https://api.github.com/users/Bushstar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Bushstar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Bushstar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Bushstar/subscriptions",
        "organizations_url": "https://api.github.com/users/Bushstar/orgs",
        "repos_url": "https://api.github.com/users/Bushstar/repos",
        "events_url": "https://api.github.com/users/Bushstar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Bushstar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/15905#issuecomment-652247532",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15905"
    },
    {
      "event": "mentioned",
      "id": 3501094139,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzUwMTA5NDEzOQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3501094139",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-07-01T07:35:35Z"
    },
    {
      "event": "subscribed",
      "id": 3501094142,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDM1MDEwOTQxNDI=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3501094142",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-07-01T07:35:35Z"
    },
    {
      "event": "mentioned",
      "id": 3501094147,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzUwMTA5NDE0Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3501094147",
      "actor": {
        "login": "dexX7",
        "id": 5836089,
        "node_id": "MDQ6VXNlcjU4MzYwODk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5836089?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dexX7",
        "html_url": "https://github.com/dexX7",
        "followers_url": "https://api.github.com/users/dexX7/followers",
        "following_url": "https://api.github.com/users/dexX7/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dexX7/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dexX7/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dexX7/subscriptions",
        "organizations_url": "https://api.github.com/users/dexX7/orgs",
        "repos_url": "https://api.github.com/users/dexX7/repos",
        "events_url": "https://api.github.com/users/dexX7/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dexX7/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-07-01T07:35:35Z"
    },
    {
      "event": "subscribed",
      "id": 3501094149,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDM1MDEwOTQxNDk=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3501094149",
      "actor": {
        "login": "dexX7",
        "id": 5836089,
        "node_id": "MDQ6VXNlcjU4MzYwODk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5836089?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dexX7",
        "html_url": "https://github.com/dexX7",
        "followers_url": "https://api.github.com/users/dexX7/followers",
        "following_url": "https://api.github.com/users/dexX7/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dexX7/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dexX7/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dexX7/subscriptions",
        "organizations_url": "https://api.github.com/users/dexX7/orgs",
        "repos_url": "https://api.github.com/users/dexX7/repos",
        "events_url": "https://api.github.com/users/dexX7/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dexX7/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-07-01T07:35:35Z"
    },
    {
      "event": "commented",
      "id": 652369085,
      "node_id": "MDEyOklzc3VlQ29tbWVudDY1MjM2OTA4NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/652369085",
      "actor": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-07-01T11:42:17Z",
      "updated_at": "2020-07-01T11:42:50Z",
      "author_association": "MEMBER",
      "body": "> Solutions for this would be to make your script wait a second after running invalidateblock or using a different coinbase address.\r\n\r\nYeah the issue for me was bitcoind was re-creating a new block with the same hash as the previously invalidated block.  Changing any part of the block would fix it - extranonce, nonce, timestamp, coinbase address etc.\r\n\r\nI noticed we didn't have this problem in bcoin, and I think it's because that library adds a random 4-byte nonce to every coinbase scriptSig (after the BIP34 height commitment). On mainnet I think this is usually taken care of by extraNonce, but we could prevent this issue on regtest in bitcoind by adding a similar mechanism.",
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/15905#issuecomment-652369085",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15905"
    },
    {
      "event": "commented",
      "id": 663058445,
      "node_id": "MDEyOklzc3VlQ29tbWVudDY2MzA1ODQ0NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/663058445",
      "actor": {
        "login": "sr-gi",
        "id": 6665628,
        "node_id": "MDQ6VXNlcjY2NjU2Mjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6665628?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sr-gi",
        "html_url": "https://github.com/sr-gi",
        "followers_url": "https://api.github.com/users/sr-gi/followers",
        "following_url": "https://api.github.com/users/sr-gi/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sr-gi/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sr-gi/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sr-gi/subscriptions",
        "organizations_url": "https://api.github.com/users/sr-gi/orgs",
        "repos_url": "https://api.github.com/users/sr-gi/repos",
        "events_url": "https://api.github.com/users/sr-gi/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sr-gi/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-07-23T15:02:24Z",
      "updated_at": "2020-07-23T15:02:24Z",
      "author_association": "NONE",
      "body": "I've also come across this issue for `v0.19.1.0-g58ba7c314d552cea8cb024960a8504577aee586f`. \r\n\r\nSame exact process:\r\n\r\n- Run `invalidateblock` on `regtest`\r\n- Generate a new block to the same address.\r\n\r\nThe issue seems to be the exact same, the block that is being generated has the exact same fields as the invalidated one, so the former conflicts with the latter.\r\n",
      "user": {
        "login": "sr-gi",
        "id": 6665628,
        "node_id": "MDQ6VXNlcjY2NjU2Mjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6665628?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sr-gi",
        "html_url": "https://github.com/sr-gi",
        "followers_url": "https://api.github.com/users/sr-gi/followers",
        "following_url": "https://api.github.com/users/sr-gi/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sr-gi/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sr-gi/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sr-gi/subscriptions",
        "organizations_url": "https://api.github.com/users/sr-gi/orgs",
        "repos_url": "https://api.github.com/users/sr-gi/repos",
        "events_url": "https://api.github.com/users/sr-gi/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sr-gi/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/15905#issuecomment-663058445",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15905"
    },
    {
      "event": "locked",
      "id": 6074013317,
      "node_id": "LOE_lADOABII584aGXCczwAAAAFqChaF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6074013317",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-02-15T11:04:04Z",
      "lock_reason": "resolved"
    }
  ]
}