{
  "type": "issue",
  "issue": {
    "id": 589815265,
    "node_id": "MDU6SXNzdWU1ODk4MTUyNjU=",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18465",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18465/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18465/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18465/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/18465",
    "number": 18465,
    "state": "closed",
    "state_reason": "completed",
    "title": "bitcoin-tx (and probably others) fails to build without libevent",
    "body": "libevent seems to have invaded `libbitcoin_common` via `url.cpp`\r\n\r\n`url.cpp` is used only from `test/fuzz/string.cpp` and `wallet/rpcwallet.cpp`\r\n\r\nlibevent should only be required for bitcoind, bitcoin-cli and (due only to the hack of passing wallet names) bitcoin-qt\r\n",
    "user": {
      "login": "luke-jr",
      "id": 1095675,
      "node_id": "MDQ6VXNlcjEwOTU2NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luke-jr",
      "html_url": "https://github.com/luke-jr",
      "followers_url": "https://api.github.com/users/luke-jr/followers",
      "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
      "organizations_url": "https://api.github.com/users/luke-jr/orgs",
      "repos_url": "https://api.github.com/users/luke-jr/repos",
      "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/luke-jr/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 64585,
        "node_id": "MDU6TGFiZWw2NDU4NQ==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug",
        "name": "Bug",
        "color": "FBBAAB",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "MEMBER",
    "milestone": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/42",
      "html_url": "https://github.com/bitcoin/bitcoin/milestone/42",
      "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/42/labels",
      "id": 4116761,
      "node_id": "MDk6TWlsZXN0b25lNDExNjc2MQ==",
      "number": 42,
      "state": "closed",
      "title": "0.20.0",
      "description": "",
      "creator": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "open_issues": 0,
      "closed_issues": 91,
      "created_at": "2019-03-06T20:02:40Z",
      "updated_at": "2020-06-02T07:55:47Z",
      "closed_at": "2020-06-02T07:55:47Z"
    },
    "locked": true,
    "active_lock_reason": "resolved",
    "comments": 10,
    "closed_at": "2020-04-10T16:54:01Z",
    "created_at": "2020-03-29T15:19:39Z",
    "updated_at": "2022-02-15T10:42:31Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 3176003774,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDMxNzYwMDM3NzQ=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3176003774",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-29T15:19:39Z",
      "label": {
        "name": "Bug",
        "color": "FBBAAB"
      }
    },
    {
      "event": "commented",
      "id": 605652930,
      "node_id": "MDEyOklzc3VlQ29tbWVudDYwNTY1MjkzMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/605652930",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-29T15:19:52Z",
      "updated_at": "2020-03-29T15:19:52Z",
      "author_association": "MEMBER",
      "body": "See also: https://bugs.gentoo.org/715268",
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/18465#issuecomment-605652930",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18465"
    },
    {
      "event": "commented",
      "id": 605655111,
      "node_id": "MDEyOklzc3VlQ29tbWVudDYwNTY1NTExMQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/605655111",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-29T15:33:50Z",
      "updated_at": "2020-03-29T15:33:50Z",
      "author_association": "MEMBER",
      "body": "It could be moved to bitcoin_server (`src/rpc/url` or so)?",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/18465#issuecomment-605655111",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18465"
    },
    {
      "event": "commented",
      "id": 605725824,
      "node_id": "MDEyOklzc3VlQ29tbWVudDYwNTcyNTgyNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/605725824",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-30T00:24:18Z",
      "updated_at": "2020-03-30T00:24:18Z",
      "author_association": "MEMBER",
      "body": "I suspect that will make problems for `bitcoin-wallet` tool",
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/18465#issuecomment-605725824",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18465"
    },
    {
      "event": "commented",
      "id": 605891317,
      "node_id": "MDEyOklzc3VlQ29tbWVudDYwNTg5MTMxNw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/605891317",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-30T09:34:56Z",
      "updated_at": "2020-03-30T09:34:56Z",
      "author_association": "MEMBER",
      "body": "I can reproduce this on ubuntu with:\r\n\r\n```bash\r\nsudo apt remove libevent-dev\r\n./configure --disable-util-cli --disable-util-wallet --with-daemon=no --with-gui=no --disable-tests --disable-bench\r\nmake\r\n```\r\n\r\nExpected behavior: successful build of `bitcoin-tx`\r\n\r\nActual behavior: compile error\r\n\r\n```\r\n  CXX      util/libbitcoin_util_a-url.o\r\nutil/url.cpp:7:10: fatal error: event2/http.h: No such file or directory\r\n #include <event2/http.h>\r\n          ^~~~~~~~~~~~~~~\r\n```\r\n\r\nSuggested fix:\r\n\r\n```diff\r\ndiff --git a/configure.ac b/configure.ac\r\nindex 1f85dd3a99d..b43a29c7fb8 100644\r\n--- a/configure.ac\r\n+++ b/configure.ac\r\n@@ -1255,7 +1255,7 @@ if test x$use_pkgconfig = xyes; then\r\n         BITCOIN_QT_CHECK([PKG_CHECK_MODULES([QR], [libqrencode], [have_qrencode=yes], [have_qrencode=no])])\r\n       fi\r\n       if test x$build_bitcoin_cli$build_bitcoind$bitcoin_enable_qt$use_tests$use_bench != xnonononono; then\r\n-        PKG_CHECK_MODULES([EVENT], [libevent],, [AC_MSG_ERROR(libevent not found.)])\r\n+        PKG_CHECK_MODULES([EVENT], [libevent], [use_libevent=yes], [AC_MSG_ERROR(libevent not found.)])\r\n         if test x$TARGET_OS != xwindows; then\r\n           PKG_CHECK_MODULES([EVENT_PTHREADS], [libevent_pthreads],, [AC_MSG_ERROR(libevent_pthreads not found.)])\r\n         fi\r\n@@ -1275,7 +1275,7 @@ if test x$use_pkgconfig = xyes; then\r\n else\r\n \r\n   if test x$build_bitcoin_cli$build_bitcoind$bitcoin_enable_qt$use_tests$use_bench != xnonononono; then\r\n-    AC_CHECK_HEADER([event2/event.h],, AC_MSG_ERROR(libevent headers missing),)\r\n+    AC_CHECK_HEADER([event2/event.h], [use_libevent=yes], AC_MSG_ERROR(libevent headers missing),)\r\n     AC_CHECK_LIB([event],[main],EVENT_LIBS=-levent,AC_MSG_ERROR(libevent missing))\r\n     if test x$TARGET_OS != xwindows; then\r\n       AC_CHECK_LIB([event_pthreads],[main],EVENT_PTHREADS_LIBS=-levent_pthreads,AC_MSG_ERROR(libevent_pthreads missing))\r\n@@ -1529,6 +1529,7 @@ AM_CONDITIONAL([ENABLE_QT_TESTS],[test x$BUILD_TEST_QT = xyes])\r\n AM_CONDITIONAL([ENABLE_BENCH],[test x$use_bench = xyes])\r\n AM_CONDITIONAL([USE_QRCODE], [test x$use_qr = xyes])\r\n AM_CONDITIONAL([USE_LCOV],[test x$use_lcov = xyes])\r\n+AM_CONDITIONAL([USE_LIBEVENT],[test x$use_libevent = xyes])\r\n AM_CONDITIONAL([GLIBC_BACK_COMPAT],[test x$use_glibc_compat = xyes])\r\n AM_CONDITIONAL([HARDEN],[test x$use_hardening = xyes])\r\n AM_CONDITIONAL([ENABLE_SSE42],[test x$enable_sse42 = xyes])\r\ndiff --git a/src/Makefile.am b/src/Makefile.am\r\nindex 8c927f330b8..c38a87a1e4b 100644\r\n--- a/src/Makefile.am\r\n+++ b/src/Makefile.am\r\n@@ -523,9 +523,12 @@ libbitcoin_util_a_SOURCES = \\\r\n   util/strencodings.cpp \\\r\n   util/string.cpp \\\r\n   util/time.cpp \\\r\n-  util/url.cpp \\\r\n   $(BITCOIN_CORE_H)\r\n \r\n+if USE_LIBEVENT\r\n+libbitcoin_util_a_SOURCES += util/url.cpp\r\n+endif\r\n+\r\n if GLIBC_BACK_COMPAT\r\n libbitcoin_util_a_SOURCES += compat/glibc_compat.cpp\r\n AM_LDFLAGS += $(COMPAT_LDFLAGS)\r\n```\r\n\r\n\r\n",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/18465#issuecomment-605891317",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18465"
    },
    {
      "event": "commented",
      "id": 605948385,
      "node_id": "MDEyOklzc3VlQ29tbWVudDYwNTk0ODM4NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/605948385",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-30T11:38:10Z",
      "updated_at": "2020-03-30T11:38:10Z",
      "author_association": "MEMBER",
      "body": "`wallet/rpcwallet.cpp` calls `urlDecode`, which will presumably give a new linker error when building `bitcoin-wallet` without libevent?",
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/18465#issuecomment-605948385",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18465"
    },
    {
      "event": "commented",
      "id": 605984805,
      "node_id": "MDEyOklzc3VlQ29tbWVudDYwNTk4NDgwNQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/605984805",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-30T13:01:49Z",
      "updated_at": "2020-03-30T13:02:14Z",
      "author_association": "MEMBER",
      "body": "> `wallet/rpcwallet.cpp` calls `urlDecode`, which will presumably give a new linker error when building `bitcoin-wallet` without libevent?\r\n\r\nYes, I didn't mention it, but for the future I do want bitcoin-wallet to be able to optionally depend on libevent so it can listen for RPC requests (https://github.com/ryanofsky/bitcoin/blob/ipc-export/doc/multiprocess.md#next-steps).\r\n\r\nIf it's important for bitcoin-wallet to be built without libevent, then something needs to break the link dependency between `bitcoin-wallet.cpp` and `urlDecode`. Your PR #18469 does this by breaking the dependency at the RegisterWalletRPCCommands symbol, but I would do it at the GetWalletNameFromJSONRPCRequest symbol instead so `bitcoin-wallet.cpp`  isn't cut off entirely from rpcwallet.\r\n\r\nRight now I am worried about code duplication in bitcoin-wallet, and concerned that it if gains more offline functionality it is going to turn into a third wallet interface duplicating functionality already implemented in the two current interfaces (RPC and GUI). This concern would go away if bitcoin-wallet could be a simple shim around rpcwallet methods that are tweaked to work offline (https://github.com/bitcoin/bitcoin/pull/15307#issuecomment-461480203, https://github.com/bitcoin/bitcoin/pull/13926#issuecomment-455187379)\r\n\r\nAny case I believe simplest possible fix for gentoo bitcoin-tx problem is one from my comment https://github.com/bitcoin/bitcoin/issues/18465#issuecomment-605891317. Simplest fix for bitcoin-wallet link error without libevent is to just require libevent to build bitcoin-wallet. Second simplest fix would be to tweak GetWalletNameFromJSONRPCRequest to return false when urlDecode function isn't available. Lots of ways to do this, you can make urlDecode a function pointer, use a HAVE_LIBEVENT macro, or make rule. I can post something later if it would be helpful.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/18465#issuecomment-605984805",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18465"
    },
    {
      "event": "commented",
      "id": 606004479,
      "node_id": "MDEyOklzc3VlQ29tbWVudDYwNjAwNDQ3OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/606004479",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-30T13:38:27Z",
      "updated_at": "2020-03-30T13:38:27Z",
      "author_association": "MEMBER",
      "body": "Fix for bitcoin-wallet as well as bitcoin-tx:\r\n\r\n```diff\r\ndiff --git a/configure.ac b/configure.ac\r\nindex 1f85dd3a99d..05ab0dd1e55 100644\r\n--- a/configure.ac\r\n+++ b/configure.ac\r\n@@ -1255,7 +1255,9 @@ if test x$use_pkgconfig = xyes; then\r\n         BITCOIN_QT_CHECK([PKG_CHECK_MODULES([QR], [libqrencode], [have_qrencode=yes], [have_qrencode=no])])\r\n       fi\r\n       if test x$build_bitcoin_cli$build_bitcoind$bitcoin_enable_qt$use_tests$use_bench != xnonononono; then\r\n-        PKG_CHECK_MODULES([EVENT], [libevent],, [AC_MSG_ERROR(libevent not found.)])\r\n+        PKG_CHECK_MODULES([EVENT], [libevent],\r\n+          [AC_DEFINE(USE_LIBEVENT, 1, [Define this symbol to enable libevent dependency])],\r\n+          [AC_MSG_ERROR(libevent not found.)])\r\n         if test x$TARGET_OS != xwindows; then\r\n           PKG_CHECK_MODULES([EVENT_PTHREADS], [libevent_pthreads],, [AC_MSG_ERROR(libevent_pthreads not found.)])\r\n         fi\r\n@@ -1275,7 +1277,9 @@ if test x$use_pkgconfig = xyes; then\r\n else\r\n \r\n   if test x$build_bitcoin_cli$build_bitcoind$bitcoin_enable_qt$use_tests$use_bench != xnonononono; then\r\n-    AC_CHECK_HEADER([event2/event.h],, AC_MSG_ERROR(libevent headers missing),)\r\n+    AC_CHECK_HEADER([event2/event.h],\r\n+      [AC_DEFINE(USE_LIBEVENT, 1, [Define this symbol to enable libevent dependency])],\r\n+      AC_MSG_ERROR(libevent headers missing),)\r\n     AC_CHECK_LIB([event],[main],EVENT_LIBS=-levent,AC_MSG_ERROR(libevent missing))\r\n     if test x$TARGET_OS != xwindows; then\r\n       AC_CHECK_LIB([event_pthreads],[main],EVENT_PTHREADS_LIBS=-levent_pthreads,AC_MSG_ERROR(libevent_pthreads missing))\r\ndiff --git a/src/util/url.cpp b/src/util/url.cpp\r\nindex e42d93bce8a..ae15815f0f7 100644\r\n--- a/src/util/url.cpp\r\n+++ b/src/util/url.cpp\r\n@@ -4,6 +4,10 @@\r\n \r\n #include <util/url.h>\r\n \r\n+#include <config/bitcoin-config.h>\r\n+\r\n+#if USE_LIBEVENT\r\n+\r\n #include <event2/http.h>\r\n #include <stdlib.h>\r\n #include <string>\r\n@@ -19,3 +23,11 @@ std::string urlDecode(const std::string &urlEncoded) {\r\n     }\r\n     return res;\r\n }\r\n+\r\n+UrlDecodeFn* const g_url_decode = urlDecode;\r\n+\r\n+#else\r\n+\r\n+UrlDecodeFn* const g_url_decode = nullptr;\r\n+\r\n+#endif\r\ndiff --git a/src/util/url.h b/src/util/url.h\r\nindex e9ea2ab765a..4c5da762c31 100644\r\n--- a/src/util/url.h\r\n+++ b/src/util/url.h\r\n@@ -7,6 +7,8 @@\r\n \r\n #include <string>\r\n \r\n-std::string urlDecode(const std::string &urlEncoded);\r\n+using UrlDecodeFn = std::string(const std::string& url_encoded);\r\n+UrlDecodeFn urlDecode;\r\n+extern UrlDecodeFn* const g_url_decode;\r\n \r\n #endif // BITCOIN_UTIL_URL_H\r\ndiff --git a/src/wallet/rpcwallet.cpp b/src/wallet/rpcwallet.cpp\r\nindex 5d34e592dbe..901d5ce9d4d 100644\r\n--- a/src/wallet/rpcwallet.cpp\r\n+++ b/src/wallet/rpcwallet.cpp\r\n@@ -77,9 +77,9 @@ bool HaveKey(const SigningProvider& wallet, const CKey& key)\r\n \r\n bool GetWalletNameFromJSONRPCRequest(const JSONRPCRequest& request, std::string& wallet_name)\r\n {\r\n-    if (request.URI.substr(0, WALLET_ENDPOINT_BASE.size()) == WALLET_ENDPOINT_BASE) {\r\n+    if (g_url_decode && request.URI.substr(0, WALLET_ENDPOINT_BASE.size()) == WALLET_ENDPOINT_BASE) {\r\n         // wallet endpoint was used\r\n-        wallet_name = urlDecode(request.URI.substr(WALLET_ENDPOINT_BASE.size()));\r\n+        wallet_name = g_url_decode(request.URI.substr(WALLET_ENDPOINT_BASE.size()));\r\n         return true;\r\n     }\r\n     return false;\r\n```",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/18465#issuecomment-606004479",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18465"
    },
    {
      "event": "commented",
      "id": 606072924,
      "node_id": "MDEyOklzc3VlQ29tbWVudDYwNjA3MjkyNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/606072924",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-30T15:34:05Z",
      "updated_at": "2020-03-30T15:34:05Z",
      "author_association": "MEMBER",
      "body": "IMO a build of `bitcoin-wallet` shouldn't change based on whether or not it was built with bitcoind/bitcoin-qt at the same time?",
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/18465#issuecomment-606072924",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18465"
    },
    {
      "event": "commented",
      "id": 606137014,
      "node_id": "MDEyOklzc3VlQ29tbWVudDYwNjEzNzAxNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/606137014",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-30T17:31:43Z",
      "updated_at": "2020-03-30T18:08:52Z",
      "author_association": "MEMBER",
      "body": "> IMO a build of `bitcoin-wallet` shouldn't change based on whether or not it was built with bitcoind/bitcoin-qt at the same time?\r\n\r\nGood point, it seems like a nice property to avoid changing. You could use:\r\n\r\n```diff\r\ndiff --git a/configure.ac b/configure.ac\r\nindex 1f85dd3a99d..b43a29c7fb8 100644\r\n--- a/configure.ac\r\n+++ b/configure.ac\r\n@@ -1255,7 +1255,7 @@ if test x$use_pkgconfig = xyes; then\r\n         BITCOIN_QT_CHECK([PKG_CHECK_MODULES([QR], [libqrencode], [have_qrencode=yes], [have_qrencode=no])])\r\n       fi\r\n       if test x$build_bitcoin_cli$build_bitcoind$bitcoin_enable_qt$use_tests$use_bench != xnonononono; then\r\n-        PKG_CHECK_MODULES([EVENT], [libevent],, [AC_MSG_ERROR(libevent not found.)])\r\n+        PKG_CHECK_MODULES([EVENT], [libevent], [use_libevent=yes], [AC_MSG_ERROR(libevent not found.)])\r\n         if test x$TARGET_OS != xwindows; then\r\n           PKG_CHECK_MODULES([EVENT_PTHREADS], [libevent_pthreads],, [AC_MSG_ERROR(libevent_pthreads not found.)])\r\n         fi\r\n@@ -1275,7 +1275,7 @@ if test x$use_pkgconfig = xyes; then\r\n else\r\n \r\n   if test x$build_bitcoin_cli$build_bitcoind$bitcoin_enable_qt$use_tests$use_bench != xnonononono; then\r\n-    AC_CHECK_HEADER([event2/event.h],, AC_MSG_ERROR(libevent headers missing),)\r\n+    AC_CHECK_HEADER([event2/event.h], [use_libevent=yes], AC_MSG_ERROR(libevent headers missing),)\r\n     AC_CHECK_LIB([event],[main],EVENT_LIBS=-levent,AC_MSG_ERROR(libevent missing))\r\n     if test x$TARGET_OS != xwindows; then\r\n       AC_CHECK_LIB([event_pthreads],[main],EVENT_PTHREADS_LIBS=-levent_pthreads,AC_MSG_ERROR(libevent_pthreads missing))\r\n@@ -1529,6 +1529,7 @@ AM_CONDITIONAL([ENABLE_QT_TESTS],[test x$BUILD_TEST_QT = xyes])\r\n AM_CONDITIONAL([ENABLE_BENCH],[test x$use_bench = xyes])\r\n AM_CONDITIONAL([USE_QRCODE], [test x$use_qr = xyes])\r\n AM_CONDITIONAL([USE_LCOV],[test x$use_lcov = xyes])\r\n+AM_CONDITIONAL([USE_LIBEVENT],[test x$use_libevent = xyes])\r\n AM_CONDITIONAL([GLIBC_BACK_COMPAT],[test x$use_glibc_compat = xyes])\r\n AM_CONDITIONAL([HARDEN],[test x$use_hardening = xyes])\r\n AM_CONDITIONAL([ENABLE_SSE42],[test x$enable_sse42 = xyes])\r\ndiff --git a/src/Makefile.am b/src/Makefile.am\r\nindex 8c927f330b8..c38a87a1e4b 100644\r\n--- a/src/Makefile.am\r\n+++ b/src/Makefile.am\r\n@@ -523,9 +523,12 @@ libbitcoin_util_a_SOURCES = \\\r\n   util/strencodings.cpp \\\r\n   util/string.cpp \\\r\n   util/time.cpp \\\r\n-  util/url.cpp \\\r\n   $(BITCOIN_CORE_H)\r\n \r\n+if USE_LIBEVENT\r\n+libbitcoin_util_a_SOURCES += util/url.cpp\r\n+endif\r\n+\r\n if GLIBC_BACK_COMPAT\r\n libbitcoin_util_a_SOURCES += compat/glibc_compat.cpp\r\n AM_LDFLAGS += $(COMPAT_LDFLAGS)\r\ndiff --git a/src/bitcoin-cli.cpp b/src/bitcoin-cli.cpp\r\nindex 6982eaab61d..3c773fb64db 100644\r\n--- a/src/bitcoin-cli.cpp\r\n+++ b/src/bitcoin-cli.cpp\r\n@@ -15,6 +15,7 @@\r\n #include <util/strencodings.h>\r\n #include <util/system.h>\r\n #include <util/translation.h>\r\n+#include <util/url.h>\r\n \r\n #include <functional>\r\n #include <memory>\r\n@@ -29,6 +30,7 @@\r\n #include <compat/stdin.h>\r\n \r\n const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\r\n+UrlDecodeFn* const URL_DECODE = urlDecode;\r\n \r\n static const char DEFAULT_RPCCONNECT[] = \"127.0.0.1\";\r\n static const int DEFAULT_HTTP_CLIENT_TIMEOUT=900;\r\ndiff --git a/src/bitcoin-wallet.cpp b/src/bitcoin-wallet.cpp\r\nindex 7f1a4a114ba..76152a81d84 100644\r\n--- a/src/bitcoin-wallet.cpp\r\n+++ b/src/bitcoin-wallet.cpp\r\n@@ -11,11 +11,13 @@\r\n #include <logging.h>\r\n #include <util/system.h>\r\n #include <util/translation.h>\r\n+#include <util/url.h>\r\n #include <wallet/wallettool.h>\r\n \r\n #include <functional>\r\n \r\n const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\r\n+UrlDecodeFn* const URL_DECODE = nullptr;\r\n \r\n static void SetupWalletToolArgs()\r\n {\r\ndiff --git a/src/bitcoind.cpp b/src/bitcoind.cpp\r\nindex e284dce0d5d..f26eb45fcea 100644\r\n--- a/src/bitcoind.cpp\r\n+++ b/src/bitcoind.cpp\r\n@@ -20,10 +20,12 @@\r\n #include <util/system.h>\r\n #include <util/threadnames.h>\r\n #include <util/translation.h>\r\n+#include <util/url.h>\r\n \r\n #include <functional>\r\n \r\n const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\r\n+UrlDecodeFn* const URL_DECODE = urlDecode;\r\n \r\n static void WaitForShutdown(NodeContext& node)\r\n {\r\ndiff --git a/src/qt/main.cpp b/src/qt/main.cpp\r\nindex 3dfd9e850ef..607cf9f9760 100644\r\n--- a/src/qt/main.cpp\r\n+++ b/src/qt/main.cpp\r\n@@ -5,6 +5,7 @@\r\n #include <qt/bitcoin.h>\r\n \r\n #include <util/translation.h>\r\n+#include <util/url.h>\r\n \r\n #include <QCoreApplication>\r\n \r\n@@ -15,5 +16,6 @@\r\n extern const std::function<std::string(const char*)> G_TRANSLATION_FUN = [](const char* psz) {\r\n     return QCoreApplication::translate(\"bitcoin-core\", psz).toStdString();\r\n };\r\n+UrlDecodeFn* const URL_DECODE = urlDecode;\r\n \r\n int main(int argc, char* argv[]) { return GuiMain(argc, argv); }\r\ndiff --git a/src/test/util/setup_common.cpp b/src/test/util/setup_common.cpp\r\nindex d684b977876..b7f5dcfe43b 100644\r\n--- a/src/test/util/setup_common.cpp\r\n+++ b/src/test/util/setup_common.cpp\r\n@@ -27,12 +27,14 @@\r\n #include <util/string.h>\r\n #include <util/time.h>\r\n #include <util/translation.h>\r\n+#include <util/url.h>\r\n #include <validation.h>\r\n #include <validationinterface.h>\r\n \r\n #include <functional>\r\n \r\n const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\r\n+UrlDecodeFn* const URL_DECODE = nullptr;\r\n \r\n FastRandomContext g_insecure_rand_ctx;\r\n /** Random context to get unique temp data dirs. Separate from g_insecure_rand_ctx, which can be seeded from a const env var */\r\ndiff --git a/src/util/url.h b/src/util/url.h\r\nindex e9ea2ab765a..be9f1c9e8a7 100644\r\n--- a/src/util/url.h\r\n+++ b/src/util/url.h\r\n@@ -7,6 +7,8 @@\r\n \r\n #include <string>\r\n \r\n-std::string urlDecode(const std::string &urlEncoded);\r\n+using UrlDecodeFn = std::string(const std::string& url_encoded);\r\n+UrlDecodeFn urlDecode;\r\n+extern UrlDecodeFn* const URL_DECODE;\r\n \r\n #endif // BITCOIN_UTIL_URL_H\r\ndiff --git a/src/wallet/rpcwallet.cpp b/src/wallet/rpcwallet.cpp\r\nindex 5d34e592dbe..9dd684a94c0 100644\r\n--- a/src/wallet/rpcwallet.cpp\r\n+++ b/src/wallet/rpcwallet.cpp\r\n@@ -77,9 +77,9 @@ bool HaveKey(const SigningProvider& wallet, const CKey& key)\r\n \r\n bool GetWalletNameFromJSONRPCRequest(const JSONRPCRequest& request, std::string& wallet_name)\r\n {\r\n-    if (request.URI.substr(0, WALLET_ENDPOINT_BASE.size()) == WALLET_ENDPOINT_BASE) {\r\n+    if (URL_DECODE && request.URI.substr(0, WALLET_ENDPOINT_BASE.size()) == WALLET_ENDPOINT_BASE) {\r\n         // wallet endpoint was used\r\n-        wallet_name = urlDecode(request.URI.substr(WALLET_ENDPOINT_BASE.size()));\r\n+        wallet_name = URL_DECODE(request.URI.substr(WALLET_ENDPOINT_BASE.size()));\r\n         return true;\r\n     }\r\n     return false;\r\n```",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/18465#issuecomment-606137014",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18465"
    },
    {
      "event": "referenced",
      "id": 3192074885,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDMxOTIwNzQ4ODU=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3192074885",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "e432309c648b86c91109adb6169d640c0960916f",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/e432309c648b86c91109adb6169d640c0960916f",
      "created_at": "2020-04-02T12:57:58Z"
    },
    {
      "event": "milestoned",
      "id": 3193666925,
      "node_id": "MDE1Ok1pbGVzdG9uZWRFdmVudDMxOTM2NjY5MjU=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3193666925",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-04-02T19:17:01Z",
      "milestone": {
        "title": "0.20.0"
      }
    },
    {
      "event": "referenced",
      "id": 3196478941,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDMxOTY0Nzg5NDE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3196478941",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "0660119ac372c2863d14060ac1bc9bc243771f94",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/0660119ac372c2863d14060ac1bc9bc243771f94",
      "created_at": "2020-04-03T13:47:25Z"
    },
    {
      "event": "commented",
      "id": 608614547,
      "node_id": "MDEyOklzc3VlQ29tbWVudDYwODYxNDU0Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/608614547",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-04-03T19:18:39Z",
      "updated_at": "2020-04-03T19:18:56Z",
      "author_association": "MEMBER",
      "body": "Would recommend using #18504 to resolve this issue. #18504 fixes the reported bitcoin-tx compile error by adding a conditional build rule for src/url.cpp, and fixes the other issues raised by luke-jr above: avoiding bitcoin-wallet link error, building identical bitcoin-wallet binary when libevent is or isn't found.\r\n\r\nAlternate approach in draft PR #18469 is probably not an ideal fix for this issue. It complicates chain client interface in a way that does not seem to make sense (though could be my own ignorance), and adds new static library that doesn't seem to line up with source code organization (https://github.com/bitcoin/bitcoin/issues/15732), and might make it difficult to add more offline wallet functionality to bitcoin wallet (https://github.com/bitcoin/bitcoin/issues/18465#issuecomment-605984805)",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/18465#issuecomment-608614547",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18465"
    },
    {
      "event": "closed",
      "id": 3222445559,
      "node_id": "MDExOkNsb3NlZEV2ZW50MzIyMjQ0NTU1OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3222445559",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "0660119ac372c2863d14060ac1bc9bc243771f94",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0660119ac372c2863d14060ac1bc9bc243771f94",
      "created_at": "2020-04-10T16:54:01Z"
    },
    {
      "event": "referenced",
      "id": 3222445574,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDMyMjI0NDU1NzQ=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3222445574",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "4eb1eeb02c57774b2de3e2d5fe3dab4f3da97ee0",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4eb1eeb02c57774b2de3e2d5fe3dab4f3da97ee0",
      "created_at": "2020-04-10T16:54:01Z"
    },
    {
      "event": "referenced",
      "id": 3228467457,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDMyMjg0Njc0NTc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3228467457",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "32d6ead51ad07fd80b2b8b3cbbff4bd1dbc9e104",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/32d6ead51ad07fd80b2b8b3cbbff4bd1dbc9e104",
      "created_at": "2020-04-13T20:31:58Z"
    },
    {
      "event": "referenced",
      "id": 3960339221,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDM5NjAzMzkyMjE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3960339221",
      "actor": {
        "login": "janus",
        "id": 6726,
        "node_id": "MDQ6VXNlcjY3MjY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6726?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/janus",
        "html_url": "https://github.com/janus",
        "followers_url": "https://api.github.com/users/janus/followers",
        "following_url": "https://api.github.com/users/janus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/janus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/janus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/janus/subscriptions",
        "organizations_url": "https://api.github.com/users/janus/orgs",
        "repos_url": "https://api.github.com/users/janus/repos",
        "events_url": "https://api.github.com/users/janus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/janus/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "951e97777e06fabfd51311aea4c605c0e720af44",
      "commit_url": "https://api.github.com/repos/janus/bitgesell/commits/951e97777e06fabfd51311aea4c605c0e720af44",
      "created_at": "2020-11-05T03:08:30Z"
    },
    {
      "event": "referenced",
      "id": 5752031918,
      "node_id": "REFE_lADOABII584jJ93hzwAAAAFW2Qqu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5752031918",
      "actor": {
        "login": "PhotoshiNakamoto",
        "id": 95452682,
        "node_id": "U_kgDOBbB-Cg",
        "avatar_url": "https://avatars.githubusercontent.com/u/95452682?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/PhotoshiNakamoto",
        "html_url": "https://github.com/PhotoshiNakamoto",
        "followers_url": "https://api.github.com/users/PhotoshiNakamoto/followers",
        "following_url": "https://api.github.com/users/PhotoshiNakamoto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/PhotoshiNakamoto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/PhotoshiNakamoto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/PhotoshiNakamoto/subscriptions",
        "organizations_url": "https://api.github.com/users/PhotoshiNakamoto/orgs",
        "repos_url": "https://api.github.com/users/PhotoshiNakamoto/repos",
        "events_url": "https://api.github.com/users/PhotoshiNakamoto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/PhotoshiNakamoto/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "f7bcb3d3410611aee9c93cd4122c7c5f654398e1",
      "commit_url": "https://api.github.com/repos/PhotonicBitcoin/pBTC-core/commits/f7bcb3d3410611aee9c93cd4122c7c5f654398e1",
      "created_at": "2021-12-11T20:24:05Z"
    },
    {
      "event": "locked",
      "id": 6073867263,
      "node_id": "LOE_lADOABII584jJ93hzwAAAAFqB9v_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6073867263",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-02-15T10:42:31Z",
      "lock_reason": "resolved"
    }
  ]
}