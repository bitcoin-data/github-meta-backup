{
  "type": "issue",
  "issue": {
    "id": 200868056,
    "node_id": "MDU6SXNzdWUyMDA4NjgwNTY=",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/9562",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/9562/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/9562/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/9562/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/9562",
    "number": 9562,
    "state": "closed",
    "state_reason": "completed",
    "title": "If whitelist option is used, any previously banned nodes that match the whitelist should be unbanned upon restart",
    "body": "### Issue\r\nI was running node version 0.13.2 (official binary package Linux 64 bit) that had banned a IPv4 address, e.g. 1.2.3.4\r\nI wanted to whitelist that address, so I added the option \r\n`whitelist=1.2.3.4`\r\nto bitcoin.conf and restarted the node. But the whitelisted address still showed up as banned in the GUI debug connections tab.\r\n\r\n### Expected behaviour\r\nI expected the now whitelisted address not to be banned after startup.\r\n\r\n### Actual behaviour\r\nAddress matching the new whitelist option pattern is still banned, showing up in the GUI debug window tab \"remote peers\" in a banned nodes section, with a button \"Unban node\".\r\nSo I clicked that button to manually unban the address.\r\nIt was lucky that I watched the connections debug tab in the GUI as a routine after startup. I was really surprised about seeing the just whitelisted address there as banned.",
    "user": {
      "login": "ghost",
      "id": 10137,
      "node_id": "MDQ6VXNlcjEwMTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ghost",
      "html_url": "https://github.com/ghost",
      "followers_url": "https://api.github.com/users/ghost/followers",
      "following_url": "https://api.github.com/users/ghost/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/ghost/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/ghost/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
      "organizations_url": "https://api.github.com/users/ghost/orgs",
      "repos_url": "https://api.github.com/users/ghost/repos",
      "events_url": "https://api.github.com/users/ghost/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/ghost/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": true,
    "active_lock_reason": "resolved",
    "comments": 3,
    "closed_at": "2018-07-04T04:11:23Z",
    "created_at": "2017-01-15T13:13:00Z",
    "updated_at": "2021-09-08T12:49:15Z"
  },
  "events": [
    {
      "event": "renamed",
      "id": 923487990,
      "node_id": "MDE3OlJlbmFtZWRUaXRsZUV2ZW50OTIzNDg3OTkw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/923487990",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-01-15T13:13:22Z",
      "rename": {
        "from": "If whitelist option is used, any previously banned nodes that match the whitelist should be unbanned",
        "to": "If whitelist option is used, any previously banned nodes that match the whitelist should be unbanned upon restart"
      }
    },
    {
      "event": "labeled",
      "id": 923488582,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDkyMzQ4ODU4Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/923488582",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-01-15T13:15:20Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    },
    {
      "event": "commented",
      "id": 274621349,
      "node_id": "MDEyOklzc3VlQ29tbWVudDI3NDYyMTM0OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/274621349",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-01-23T21:23:50Z",
      "updated_at": "2017-01-23T21:23:50Z",
      "author_association": "MEMBER",
      "body": "I'm not sure we should do this, since it leads to edge cases and interactions which are difficult to reason about. For example, what should happen in the following scenario:\r\n\r\n- there's a current ban for subnet 1.2.3.0/24\r\n- there's whitelist configuration for 1.2.3.1\r\n\r\nshould we remove banning for the entire subnet? Or remove the ban for the subnet and add bans for all other address in the subnet? Or keep the subnet ban configuration?\r\n\r\nI'd prefer that the UI issue a warning if it detects that a configured whitelisted address is banned at startup. For example:\r\n\r\n\"1.2.3.4 is configured as a whitelist address, but is within banned subnet 1.2.3.0/24. To remove the ban, go to <place> and do <thing>\"",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/9562#issuecomment-274621349",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/9562"
    },
    {
      "event": "commented",
      "id": 280900708,
      "node_id": "MDEyOklzc3VlQ29tbWVudDI4MDkwMDcwOA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/280900708",
      "actor": {
        "login": "ghost",
        "id": 10137,
        "node_id": "MDQ6VXNlcjEwMTM3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ghost",
        "html_url": "https://github.com/ghost",
        "followers_url": "https://api.github.com/users/ghost/followers",
        "following_url": "https://api.github.com/users/ghost/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ghost/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ghost/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
        "organizations_url": "https://api.github.com/users/ghost/orgs",
        "repos_url": "https://api.github.com/users/ghost/repos",
        "events_url": "https://api.github.com/users/ghost/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ghost/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-02-19T06:59:58Z",
      "updated_at": "2017-02-19T06:59:58Z",
      "author_association": "NONE",
      "body": "I would say for this example:\r\n\"first match wins\", with whitelist match checking before ban match checking:\r\n1. check for whitelist match\r\n2. check for ban match\r\n3. if neither matches, do the default action: allow\r\n\r\nSo, the ban match checking for 1.2.3.0/24 would be kept, but _before_ that ban match check, there would be the (successful) whitelist match check for 1.2.3.1, at which point further matching is stopped and access is granted. 1.2.3.2 would stilll be banned, because first match would be for banned subnet 1.2.3.0/24, at which point further matching is stopped.",
      "user": {
        "login": "ghost",
        "id": 10137,
        "node_id": "MDQ6VXNlcjEwMTM3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ghost",
        "html_url": "https://github.com/ghost",
        "followers_url": "https://api.github.com/users/ghost/followers",
        "following_url": "https://api.github.com/users/ghost/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ghost/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ghost/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
        "organizations_url": "https://api.github.com/users/ghost/orgs",
        "repos_url": "https://api.github.com/users/ghost/repos",
        "events_url": "https://api.github.com/users/ghost/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ghost/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/9562#issuecomment-280900708",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/9562"
    },
    {
      "event": "commented",
      "id": 280953741,
      "node_id": "MDEyOklzc3VlQ29tbWVudDI4MDk1Mzc0MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/280953741",
      "actor": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-02-19T22:12:44Z",
      "updated_at": "2017-02-19T22:12:44Z",
      "author_association": "MEMBER",
      "body": "Hum, generally for stuff like this you want most-specific to match first, not always whitelist first. Still, the UI issue of the ban appearing in the ban list with a conflicting whitelist is hard... Likely need to just add the whitelist list to the same dialog, and have whitelists that are identical to bans remove the ban (ie most-recently-set-matches-first)\n\nOn February 19, 2017 2:00:02 AM EST, wodry <notifications@github.com> wrote:\n>I would say for this example:\n>\"first match wins\", with whitelist match checking before ban match\n>checking:\n>1. check for whitelist match\n>2. check for ban match\n>3. if neither matches, do the default action: allow\n>\n>So, the ban match checking for 1.2.3.0/24 would be kept, but _before_\n>that ban match check, there would be the (successful) whitelist match\n>check for 1.2.3.1, at which point further matching is stopped and\n>access is granted. 1.2.3.2 would stilll be banned, because first match\n>would be for banned subnet 1.2.3.0/24, at which point further matching\n>is stopped.\n>\n>-- \n>You are receiving this because you are subscribed to this thread.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/bitcoin/bitcoin/issues/9562#issuecomment-280900708\n",
      "user": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/9562#issuecomment-280953741",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/9562"
    },
    {
      "event": "closed",
      "id": 1715431938,
      "node_id": "MDExOkNsb3NlZEV2ZW50MTcxNTQzMTkzOA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1715431938",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-07-04T04:11:23Z"
    },
    {
      "event": "locked",
      "id": 5272094647,
      "node_id": "LOE_lADOABII584L-QDYzwAAAAE6Pce3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5272094647",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-08T12:49:15Z",
      "lock_reason": "resolved"
    }
  ]
}