{
  "type": "issue",
  "issue": {
    "id": 323931798,
    "node_id": "MDU6SXNzdWUzMjM5MzE3OTg=",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13261",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13261/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13261/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13261/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/13261",
    "number": 13261,
    "state": "closed",
    "state_reason": "completed",
    "title": "Account inconsistency in regtest with raw Tx",
    "body": "In a simple scenario where Bob pays Marry some BTC sending a signed raw Tx, the accounts / UTOX list show some inconsistency.\r\n\r\nPlease note, that at the end only Marry (but Bob no longer) has an UTOX, but the account balances are shown like this\r\n\r\n```\r\n> listaccounts\r\n{\r\n  \"\": 129.99996200,\r\n  \"Bob\": 10.00000000,\r\n  \"Marry\": 9.99000000\r\n}\r\n```\r\n\r\nIt seems that Marry got payed from the default account, instead of Bob's account as defined in the raw Tx.\r\n\r\n```\r\n> generate 101\r\n\r\n> importprivkey cVfiZLCWbCm3SWoBAToaCoMuYJJjEw5cR6ifuWQY1a5wadXynGC2 Bob \r\n\r\n> importprivkey cMcT5vjU5UiF2mh8WE6EsD3YdFEuFuUKm6rCcA8UuR9FUS6VLeRx Marry\r\n\r\n> listaccounts\r\n{\r\n  \"\": 50.00000000,\r\n  \"Bob\": 0.00000000,\r\n  \"Marry\": 0.00000000\r\n}\r\n\r\n> getaddressesbyaccount Bob\r\n[\r\n  \"n3ha6rJa8ZS7B4v4vwNWn8CnLHfUYXW1XE\",\r\n  \"2Mxztt6zTZ7KPHMdPt8iYtSLxQ9FHAPJMns\",\r\n  \"bcrt1q7d2dzgxmgu4kzpmvrlz306kcffw225ydq2jwm7\"\r\n]\r\n\r\n> getaddressesbyaccount Marry\r\n[\r\n  \"mm2PoHeFncAStYeZJSSTa4bmUVXRa3L6PL\",\r\n  \"2NCvSGnUTueMFim31cpyw7yp1pKwAyeH4Vj\",\r\n  \"bcrt1q835lks7r7s7qru78g7uh6l5apr46akde5z5zq2\"\r\n]\r\n\r\n> sendtoaddress n3ha6rJa8ZS7B4v4vwNWn8CnLHfUYXW1XE 10.0\r\n> generate 1\r\n> listaccounts\r\n{\r\n  \"\": 89.99996200,\r\n  \"Bob\": 10.00000000,\r\n  \"Marry\": 0.00000000\r\n}\r\n\r\n> listunspent 1\r\n[\r\n  ...,\r\n  {\r\n    \"txid\": \"c680f0abc596dfb5cec6dfc44a7ef7e54c2fa0b6557910c67cc4c3474487d37c\",\r\n    \"vout\": 0,\r\n    \"address\": \"n3ha6rJa8ZS7B4v4vwNWn8CnLHfUYXW1XE\",\r\n    \"account\": \"Bob\",\r\n    \"scriptPubKey\": \"76a914f354d120db472b61076c1fc517ead84a5ca5508d88ac\",\r\n    \"amount\": 10.00000000,\r\n    \"confirmations\": 1,\r\n    \"spendable\": true,\r\n    \"solvable\": true,\r\n    \"safe\": true\r\n  },\r\n  ...\r\n]\r\n\r\n> createrawtransaction '[{\"txid\":\"c680f0abc596dfb5cec6dfc44a7ef7e54c2fa0b6557910c67cc4c3474487d37c\",\"vout\":0}]' '{\"mm2PoHeFncAStYeZJSSTa4bmUVXRa3L6PL\":9.99}'\r\n02000000017cd3874447c3c47cc6107955b6a02f4ce5f77e4ac4dfc6ceb5df96c5abf080c60000000000ffffffff01c0878b3b000000001976a9143c69fb43c3f43c01f3c747b97d7e9d08ebaed9b988ac00000000\r\n\r\n> signrawtransaction '02000000017cd3874447c3c47cc6107955b6a02f4ce5f77e4ac4dfc6ceb5df96c5abf080c60000000000ffffffff01c0878b3b000000001976a9143c69fb43c3f43c01f3c747b97d7e9d08ebaed9b988ac00000000' '[{\"txid\":\"c680f0abc596dfb5cec6dfc44a7ef7e54c2fa0b6557910c67cc4c3474487d37c\",\"vout\":0, \"scriptPubKey\":\"76a914f354d120db472b61076c1fc517ead84a5ca5508d88ac\"}]' '[\"cVfiZLCWbCm3SWoBAToaCoMuYJJjEw5cR6ifuWQY1a5wadXynGC2\"]'\r\n{\r\n  \"hex\": \"02000000017cd3874447c3c47cc6107955b6a02f4ce5f77e4ac4dfc6ceb5df96c5abf080c6000000006a473044022009fcc3faa221db782d56f1e388979e61d5eb903ec0f16e919051aba631c3bdbf022073be7a8ea3ba73e436f6dd2f4b365131fe4537bbfa0944a73872e15e55f366eb01210389f32f5b1a8339b53308c4ee36bdcaacec27cf74e4138d2b372c8df323c21cf6ffffffff01c0878b3b000000001976a9143c69fb43c3f43c01f3c747b97d7e9d08ebaed9b988ac00000000\",\r\n  \"complete\": true\r\n}\r\n\r\n> sendrawtransaction 02000000017cd3874447c3c47cc6107955b6a02f4ce5f77e4ac4dfc6ceb5df96c5abf080c6000000006a473044022009fcc3faa221db782d56f1e388979e61d5eb903ec0f16e919051aba631c3bdbf022073be7a8ea3ba73e436f6dd2f4b365131fe4537bbfa0944a73872e15e55f366eb01210389f32f5b1a8339b53308c4ee36bdcaacec27cf74e4138d2b372c8df323c21cf6ffffffff01c0878b3b000000001976a9143c69fb43c3f43c01f3c747b97d7e9d08ebaed9b988ac00000000\r\n> generate 1\r\n\r\n> listunspent 1\r\n[\r\n  {\r\n    \"txid\": \"efcac0dca6a10e9f0a2a89ac34e64309819441dcc2f9553e1d3cf52a333ab939\",\r\n    \"vout\": 0,\r\n    \"address\": \"mqnLRnRoExhUFsP1Y66JLen2h2qXtCw8dF\",\r\n    \"scriptPubKey\": \"210340323d67d27e075030ea9c286e078e30ec728b46710952d3e2bb201cca533b24ac\",\r\n    \"amount\": 50.00000000,\r\n    \"confirmations\": 102,\r\n    \"spendable\": true,\r\n    \"solvable\": true,\r\n    \"safe\": true\r\n  },\r\n  {\r\n    \"txid\": \"fa3a28d1f9136fadb43984e464276b6b2a28443af0a0f73381487a71204a4d44\",\r\n    \"vout\": 0,\r\n    \"address\": \"mm2PoHeFncAStYeZJSSTa4bmUVXRa3L6PL\",\r\n    \"account\": \"Marry\",\r\n    \"scriptPubKey\": \"76a9143c69fb43c3f43c01f3c747b97d7e9d08ebaed9b988ac\",\r\n    \"amount\": 9.99000000,\r\n    \"confirmations\": 1,\r\n    \"spendable\": true,\r\n    \"solvable\": true,\r\n    \"safe\": true\r\n  },\r\n  {\r\n    \"txid\": \"c680f0abc596dfb5cec6dfc44a7ef7e54c2fa0b6557910c67cc4c3474487d37c\",\r\n    \"vout\": 1,\r\n    \"address\": \"2NFAvRVEoE7jfVuZQkSgSNZRkEUeUeic3HR\",\r\n    \"redeemScript\": \"001406a25b3828b5f9a58940279fb65c72fa3ebf8702\",\r\n    \"scriptPubKey\": \"a914f08270c43a050a9faf69dc0bdd3b8e078a48c56987\",\r\n    \"amount\": 39.99996200,\r\n    \"confirmations\": 2,\r\n    \"spendable\": true,\r\n    \"solvable\": true,\r\n    \"safe\": true\r\n  },\r\n  {\r\n    \"txid\": \"8104c596910e143232dd3f6c94875fe42ef358908575bb87e93830d9db2c77d4\",\r\n    \"vout\": 0,\r\n    \"address\": \"mqnLRnRoExhUFsP1Y66JLen2h2qXtCw8dF\",\r\n    \"scriptPubKey\": \"210340323d67d27e075030ea9c286e078e30ec728b46710952d3e2bb201cca533b24ac\",\r\n    \"amount\": 50.00000000,\r\n    \"confirmations\": 101,\r\n    \"spendable\": true,\r\n    \"solvable\": true,\r\n    \"safe\": true\r\n  }\r\n]\r\n\r\n> listaccounts\r\n{\r\n  \"\": 129.99996200,\r\n  \"Bob\": 10.00000000,\r\n  \"Marry\": 9.99000000\r\n}\r\n``` ",
    "user": {
      "login": "tdiesler",
      "id": 244946,
      "node_id": "MDQ6VXNlcjI0NDk0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/244946?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tdiesler",
      "html_url": "https://github.com/tdiesler",
      "followers_url": "https://api.github.com/users/tdiesler/followers",
      "following_url": "https://api.github.com/users/tdiesler/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/tdiesler/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/tdiesler/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/tdiesler/subscriptions",
      "organizations_url": "https://api.github.com/users/tdiesler/orgs",
      "repos_url": "https://api.github.com/users/tdiesler/repos",
      "events_url": "https://api.github.com/users/tdiesler/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/tdiesler/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [],
    "assignees": [],
    "author_association": "NONE",
    "locked": true,
    "active_lock_reason": "resolved",
    "comments": 3,
    "closed_at": "2018-05-17T13:05:43Z",
    "created_at": "2018-05-17T09:00:13Z",
    "updated_at": "2021-09-08T12:37:36Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 389806129,
      "node_id": "MDEyOklzc3VlQ29tbWVudDM4OTgwNjEyOQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/389806129",
      "actor": {
        "login": "marcoagner",
        "id": 5016303,
        "node_id": "MDQ6VXNlcjUwMTYzMDM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5016303?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/marcoagner",
        "html_url": "https://github.com/marcoagner",
        "followers_url": "https://api.github.com/users/marcoagner/followers",
        "following_url": "https://api.github.com/users/marcoagner/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/marcoagner/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/marcoagner/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/marcoagner/subscriptions",
        "organizations_url": "https://api.github.com/users/marcoagner/orgs",
        "repos_url": "https://api.github.com/users/marcoagner/repos",
        "events_url": "https://api.github.com/users/marcoagner/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/marcoagner/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-05-17T09:33:08Z",
      "updated_at": "2018-05-17T09:52:01Z",
      "author_association": "CONTRIBUTOR",
      "body": "FWIW the account API is being deprecated for `v0.17.0` and will be removed on `v0.18.0` - which does not invalidate the issue, ofc.\r\nEdit: for more info about the deprecation, https://github.com/bitcoin/bitcoin/issues/12952 and https://github.com/bitcoin/bitcoin/pull/12953.",
      "user": {
        "login": "marcoagner",
        "id": 5016303,
        "node_id": "MDQ6VXNlcjUwMTYzMDM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5016303?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/marcoagner",
        "html_url": "https://github.com/marcoagner",
        "followers_url": "https://api.github.com/users/marcoagner/followers",
        "following_url": "https://api.github.com/users/marcoagner/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/marcoagner/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/marcoagner/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/marcoagner/subscriptions",
        "organizations_url": "https://api.github.com/users/marcoagner/orgs",
        "repos_url": "https://api.github.com/users/marcoagner/repos",
        "events_url": "https://api.github.com/users/marcoagner/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/marcoagner/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/13261#issuecomment-389806129",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13261"
    },
    {
      "event": "commented",
      "id": 389817559,
      "node_id": "MDEyOklzc3VlQ29tbWVudDM4OTgxNzU1OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/389817559",
      "actor": {
        "login": "ken2812221",
        "id": 11154118,
        "node_id": "MDQ6VXNlcjExMTU0MTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/11154118?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ken2812221",
        "html_url": "https://github.com/ken2812221",
        "followers_url": "https://api.github.com/users/ken2812221/followers",
        "following_url": "https://api.github.com/users/ken2812221/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ken2812221/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ken2812221/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ken2812221/subscriptions",
        "organizations_url": "https://api.github.com/users/ken2812221/orgs",
        "repos_url": "https://api.github.com/users/ken2812221/repos",
        "events_url": "https://api.github.com/users/ken2812221/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ken2812221/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-05-17T10:14:03Z",
      "updated_at": "2018-05-17T10:14:03Z",
      "author_association": "CONTRIBUTOR",
      "body": "Maybe related #12608",
      "user": {
        "login": "ken2812221",
        "id": 11154118,
        "node_id": "MDQ6VXNlcjExMTU0MTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/11154118?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ken2812221",
        "html_url": "https://github.com/ken2812221",
        "followers_url": "https://api.github.com/users/ken2812221/followers",
        "following_url": "https://api.github.com/users/ken2812221/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ken2812221/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ken2812221/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ken2812221/subscriptions",
        "organizations_url": "https://api.github.com/users/ken2812221/orgs",
        "repos_url": "https://api.github.com/users/ken2812221/repos",
        "events_url": "https://api.github.com/users/ken2812221/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ken2812221/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/13261#issuecomment-389817559",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13261"
    },
    {
      "event": "commented",
      "id": 389819549,
      "node_id": "MDEyOklzc3VlQ29tbWVudDM4OTgxOTU0OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/389819549",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-05-17T10:22:13Z",
      "updated_at": "2018-05-17T10:22:13Z",
      "author_association": "MEMBER",
      "body": "A transaction received from the network (and not issued locally by any of\nthe RPC commands) will always deduct the \"\" account - there is no way to\nguess which account was intended to be deducted.\n\nAddresses associated with accounts define which account gets *credited* for\nincoming payments. But deducting always has to be specified explicitly.\n\nThis is just one of the many problems with the account system, and it's\nbeing deprecated and removed in upcoming versions.\n",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/13261#issuecomment-389819549",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/13261"
    },
    {
      "event": "closed",
      "id": 1631914794,
      "node_id": "MDExOkNsb3NlZEV2ZW50MTYzMTkxNDc5NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1631914794",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-05-17T13:05:43Z"
    },
    {
      "event": "locked",
      "id": 5272030293,
      "node_id": "LOE_lADOABII584TTs6WzwAAAAE6PMxV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5272030293",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-08T12:37:36Z",
      "lock_reason": "resolved"
    }
  ]
}