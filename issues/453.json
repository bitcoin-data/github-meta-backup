{
  "type": "issue",
  "issue": {
    "id": 1352221,
    "node_id": "MDU6SXNzdWUxMzUyMjIx",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/453",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/453/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/453/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/453/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/453",
    "number": 453,
    "state": "closed",
    "state_reason": "completed",
    "title": "Deadlock in key generation due to CCryptoKeyStore",
    "body": "From the forum: https://bitcointalk.org/index.php?topic=34642.0\n\nThis is in the latest version in Git.  This is not in the released client.\n\nCreating a new key can freeze the client.  It appears to be much more frequent when there are blocks and transactions to download.\n\nI've been digging in the code to try and find the cause, and I think this is the reason:\n\nCAddressBookDialog::OnButtonNew grabs the cs_vMasterKey, then calls pwalletMain->GetOrReuseKeyFromPool()\nGetOrReuseKeyFromPool() calls ReserveKeyFromKeyPool() which attempts to grab cs_main\n\nMeanwhile..\n\nProcessMessages grabs cs_main and then calls ProcessMessage\nProcessMessage() calls SyncWithWallets, either directly when receiving \"tx\" or indirectly when receiving a block (via ProcessBlock -> AcceptBlock -> AddToBlockIndex -> SetBestChain -> ConnectBlock -> SyncWithWallets)\nSyncWithWallets calls AddToWalletIfInvolvingMe\nAddToWalletIfInvolvingMe calls CWallet::IsMine, which calls the global ::IsMine\nIsMine(const CKeyStore &keystore, const CScript& scriptPubKey) then calls keystore.GetPubKey\nCCryptoKeyStore::GetPubKey then grabs cs_vMasterKey\n\nDeadlock.\n\nMost of the critical sections protect something small well-defined, though I'm not quite sure what cs_main is supposed to be protecting.\n\nI would generate a pull request, except that \n1. I have an ugly hack but not a good fix.  I'm not sure what the final strategy is going to be on wallet encryption, and whether the public keys are going to be encrypted too.\n2. I am new to git and I am not yet skilled at rebasing commits to include only the changes I want.\n",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 64585,
        "node_id": "MDU6TGFiZWw2NDU4NQ==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug",
        "name": "Bug",
        "color": "FBBAAB",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": true,
    "active_lock_reason": "resolved",
    "comments": 7,
    "closed_at": "2011-09-01T18:59:35Z",
    "created_at": "2011-08-05T16:31:22Z",
    "updated_at": "2021-09-08T12:16:27Z"
  },
  "events": [
    {
      "event": "subscribed",
      "id": 2244797,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDIyNDQ3OTc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2244797",
      "actor": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2011-08-05T16:31:22Z"
    },
    {
      "event": "commented",
      "id": 1737042,
      "node_id": "MDEyOklzc3VlQ29tbWVudDE3MzcwNDI=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1737042",
      "actor": {
        "login": "vector76",
        "id": 955138,
        "node_id": "MDQ6VXNlcjk1NTEzOA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/955138?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vector76",
        "html_url": "https://github.com/vector76",
        "followers_url": "https://api.github.com/users/vector76/followers",
        "following_url": "https://api.github.com/users/vector76/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vector76/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vector76/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vector76/subscriptions",
        "organizations_url": "https://api.github.com/users/vector76/orgs",
        "repos_url": "https://api.github.com/users/vector76/repos",
        "events_url": "https://api.github.com/users/vector76/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vector76/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2011-08-05T16:58:42Z",
      "updated_at": "2011-08-05T16:58:42Z",
      "author_association": "NONE",
      "body": "Ah ok this is clearly a better place to post issues.\nThank you.\n",
      "user": {
        "login": "vector76",
        "id": 955138,
        "node_id": "MDQ6VXNlcjk1NTEzOA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/955138?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vector76",
        "html_url": "https://github.com/vector76",
        "followers_url": "https://api.github.com/users/vector76/followers",
        "following_url": "https://api.github.com/users/vector76/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vector76/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vector76/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vector76/subscriptions",
        "organizations_url": "https://api.github.com/users/vector76/orgs",
        "repos_url": "https://api.github.com/users/vector76/repos",
        "events_url": "https://api.github.com/users/vector76/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vector76/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/453#issuecomment-1737042",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/453"
    },
    {
      "event": "subscribed",
      "id": 2245425,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDIyNDU0MjU=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2245425",
      "actor": {
        "login": "vector76",
        "id": 955138,
        "node_id": "MDQ6VXNlcjk1NTEzOA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/955138?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vector76",
        "html_url": "https://github.com/vector76",
        "followers_url": "https://api.github.com/users/vector76/followers",
        "following_url": "https://api.github.com/users/vector76/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vector76/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vector76/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vector76/subscriptions",
        "organizations_url": "https://api.github.com/users/vector76/orgs",
        "repos_url": "https://api.github.com/users/vector76/repos",
        "events_url": "https://api.github.com/users/vector76/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vector76/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2011-08-05T16:58:42Z"
    },
    {
      "event": "commented",
      "id": 1749626,
      "node_id": "MDEyOklzc3VlQ29tbWVudDE3NDk2MjY=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1749626",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2011-08-07T19:36:20Z",
      "updated_at": "2011-08-07T19:36:20Z",
      "author_association": "MEMBER",
      "body": "I think the entire locking system may need to be revised in general, it is very hard currently to find this kind of bugs. Your analysis looks correct to be though, but wouldn't locking cs_main before cs_vMasterKey in CAddressBookDialog be sufficient?\n",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/453#issuecomment-1749626",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/453"
    },
    {
      "event": "subscribed",
      "id": 2275237,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDIyNzUyMzc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2275237",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2011-08-07T19:36:20Z"
    },
    {
      "event": "commented",
      "id": 1754558,
      "node_id": "MDEyOklzc3VlQ29tbWVudDE3NTQ1NTg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1754558",
      "actor": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2011-08-08T14:29:59Z",
      "updated_at": "2011-08-08T14:29:59Z",
      "author_association": "MEMBER",
      "body": "If you lock it in CAddressBookDialog, as long as the password dialog box is open, the entire cs_main is locked, which is quite a problem (as nothing else important will work during that time)...so I'd say not really.\n",
      "user": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/453#issuecomment-1754558",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/453"
    },
    {
      "event": "commented",
      "id": 1775538,
      "node_id": "MDEyOklzc3VlQ29tbWVudDE3NzU1Mzg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1775538",
      "actor": {
        "login": "vector76",
        "id": 955138,
        "node_id": "MDQ6VXNlcjk1NTEzOA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/955138?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vector76",
        "html_url": "https://github.com/vector76",
        "followers_url": "https://api.github.com/users/vector76/followers",
        "following_url": "https://api.github.com/users/vector76/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vector76/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vector76/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vector76/subscriptions",
        "organizations_url": "https://api.github.com/users/vector76/orgs",
        "repos_url": "https://api.github.com/users/vector76/repos",
        "events_url": "https://api.github.com/users/vector76/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vector76/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2011-08-10T18:51:46Z",
      "updated_at": "2011-08-10T18:51:46Z",
      "author_association": "NONE",
      "body": "I think the locking system is fine as long as each lock is logically tied to a relatively small subsystem with few dependencies.  This is already true for the most part.  I think the problem here is cs_main, because it is not at all obvious what it is trying to lock.\n",
      "user": {
        "login": "vector76",
        "id": 955138,
        "node_id": "MDQ6VXNlcjk1NTEzOA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/955138?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vector76",
        "html_url": "https://github.com/vector76",
        "followers_url": "https://api.github.com/users/vector76/followers",
        "following_url": "https://api.github.com/users/vector76/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vector76/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vector76/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vector76/subscriptions",
        "organizations_url": "https://api.github.com/users/vector76/orgs",
        "repos_url": "https://api.github.com/users/vector76/repos",
        "events_url": "https://api.github.com/users/vector76/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vector76/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/453#issuecomment-1775538",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/453"
    },
    {
      "event": "commented",
      "id": 1778763,
      "node_id": "MDEyOklzc3VlQ29tbWVudDE3Nzg3NjM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1778763",
      "actor": {
        "login": "JoelKatz",
        "id": 877549,
        "node_id": "MDQ6VXNlcjg3NzU0OQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/877549?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/JoelKatz",
        "html_url": "https://github.com/JoelKatz",
        "followers_url": "https://api.github.com/users/JoelKatz/followers",
        "following_url": "https://api.github.com/users/JoelKatz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/JoelKatz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/JoelKatz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/JoelKatz/subscriptions",
        "organizations_url": "https://api.github.com/users/JoelKatz/orgs",
        "repos_url": "https://api.github.com/users/JoelKatz/repos",
        "events_url": "https://api.github.com/users/JoelKatz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/JoelKatz/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2011-08-11T02:55:59Z",
      "updated_at": "2011-08-11T02:55:59Z",
      "author_association": "CONTRIBUTOR",
      "body": "One thing that would help an awful lot is some documentation explaining the intended locking hierarchy. Presumably, there is some intended order in which locks are acquired. If we know what that hierarchy is supposed to be, we can easily add test code to confirm that the hierarchy is not violated. Also, when it is, it will be obvious which section of code is at fault and (usually) how to fix it. (By acquiring the last lock sooner in the code path, usually.)\n",
      "user": {
        "login": "JoelKatz",
        "id": 877549,
        "node_id": "MDQ6VXNlcjg3NzU0OQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/877549?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/JoelKatz",
        "html_url": "https://github.com/JoelKatz",
        "followers_url": "https://api.github.com/users/JoelKatz/followers",
        "following_url": "https://api.github.com/users/JoelKatz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/JoelKatz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/JoelKatz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/JoelKatz/subscriptions",
        "organizations_url": "https://api.github.com/users/JoelKatz/orgs",
        "repos_url": "https://api.github.com/users/JoelKatz/repos",
        "events_url": "https://api.github.com/users/JoelKatz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/JoelKatz/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/453#issuecomment-1778763",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/453"
    },
    {
      "event": "subscribed",
      "id": 2360264,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDIzNjAyNjQ=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2360264",
      "actor": {
        "login": "JoelKatz",
        "id": 877549,
        "node_id": "MDQ6VXNlcjg3NzU0OQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/877549?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/JoelKatz",
        "html_url": "https://github.com/JoelKatz",
        "followers_url": "https://api.github.com/users/JoelKatz/followers",
        "following_url": "https://api.github.com/users/JoelKatz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/JoelKatz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/JoelKatz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/JoelKatz/subscriptions",
        "organizations_url": "https://api.github.com/users/JoelKatz/orgs",
        "repos_url": "https://api.github.com/users/JoelKatz/repos",
        "events_url": "https://api.github.com/users/JoelKatz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/JoelKatz/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2011-08-11T02:55:59Z"
    },
    {
      "event": "commented",
      "id": 1789972,
      "node_id": "MDEyOklzc3VlQ29tbWVudDE3ODk5NzI=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1789972",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2011-08-12T09:27:31Z",
      "updated_at": "2011-08-12T09:28:37Z",
      "author_association": "MEMBER",
      "body": "I think the current locks can be divided into three components: 1) main/blockdb/mempool, 2) wallet/keystore, 3) network\n\nWithin each component the order of locks can be fixed, and easily checked. However, between the components there are also dependencies. As both wallet and network request and submit information from main, I'd say 2>1 and 3>1. Wallet code also depends on the network, so 2>3. That gives us a total ordering on the locks: first wallet, then network, then main. This implies that you can call net and main functions while having a lock on wallet, and that you can call main while having a lock on network.\n\nHowever, this also means it is not allowed to call (possibly locking) code in wallet while having a lock on main. That's exactly what I caused by introducing the wallet-dispatch functions in main (IsFromMe, GetTransaction, EraseFromWallets, SyncWithWallets, ...). The best solution, i suppose, would be to modify these callbacks to only happen outside of main-locked code, and only pass identifiers (by value) to them, as passing references to blocks may mean exposing data that needs locking, and can change while being inspected.\n",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/453#issuecomment-1789972",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/453"
    },
    {
      "event": "commented",
      "id": 1822336,
      "node_id": "MDEyOklzc3VlQ29tbWVudDE4MjIzMzY=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1822336",
      "actor": {
        "login": "gavinandresen",
        "id": 331997,
        "node_id": "MDQ6VXNlcjMzMTk5Nw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gavinandresen",
        "html_url": "https://github.com/gavinandresen",
        "followers_url": "https://api.github.com/users/gavinandresen/followers",
        "following_url": "https://api.github.com/users/gavinandresen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gavinandresen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gavinandresen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
        "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
        "repos_url": "https://api.github.com/users/gavinandresen/repos",
        "events_url": "https://api.github.com/users/gavinandresen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2011-08-17T01:41:26Z",
      "updated_at": "2011-08-17T01:41:26Z",
      "author_association": "CONTRIBUTOR",
      "body": "I'll be commiting lock order inconsistency detection code tomorrow (I need to rebase some code and make it #ifdef DEBUG_LOCKORDER).  RE: Joel's suggestion on documentation:  Good Idea. It might be a good idea to give each CCriticalSection an integer 'depth', and make it a run-time error to lock out of 'in-depth' order.\n",
      "user": {
        "login": "gavinandresen",
        "id": 331997,
        "node_id": "MDQ6VXNlcjMzMTk5Nw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gavinandresen",
        "html_url": "https://github.com/gavinandresen",
        "followers_url": "https://api.github.com/users/gavinandresen/followers",
        "following_url": "https://api.github.com/users/gavinandresen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gavinandresen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gavinandresen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
        "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
        "repos_url": "https://api.github.com/users/gavinandresen/repos",
        "events_url": "https://api.github.com/users/gavinandresen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/453#issuecomment-1822336",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/453"
    },
    {
      "event": "subscribed",
      "id": 2488297,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDI0ODgyOTc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2488297",
      "actor": {
        "login": "gavinandresen",
        "id": 331997,
        "node_id": "MDQ6VXNlcjMzMTk5Nw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gavinandresen",
        "html_url": "https://github.com/gavinandresen",
        "followers_url": "https://api.github.com/users/gavinandresen/followers",
        "following_url": "https://api.github.com/users/gavinandresen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gavinandresen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gavinandresen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
        "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
        "repos_url": "https://api.github.com/users/gavinandresen/repos",
        "events_url": "https://api.github.com/users/gavinandresen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2011-08-17T01:41:26Z"
    },
    {
      "event": "referenced",
      "id": 2873500,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDI4NzM1MDA=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2873500",
      "actor": {
        "login": "gavinandresen",
        "id": 331997,
        "node_id": "MDQ6VXNlcjMzMTk5Nw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gavinandresen",
        "html_url": "https://github.com/gavinandresen",
        "followers_url": "https://api.github.com/users/gavinandresen/followers",
        "following_url": "https://api.github.com/users/gavinandresen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gavinandresen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gavinandresen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
        "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
        "repos_url": "https://api.github.com/users/gavinandresen/repos",
        "events_url": "https://api.github.com/users/gavinandresen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "cb6c4b883da6896b39bd46f845453f69d0f516f1",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/cb6c4b883da6896b39bd46f845453f69d0f516f1",
      "created_at": "2011-08-31T17:24:46Z"
    },
    {
      "event": "closed",
      "id": 2910077,
      "node_id": "MDExOkNsb3NlZEV2ZW50MjkxMDA3Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2910077",
      "actor": {
        "login": "gavinandresen",
        "id": 331997,
        "node_id": "MDQ6VXNlcjMzMTk5Nw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gavinandresen",
        "html_url": "https://github.com/gavinandresen",
        "followers_url": "https://api.github.com/users/gavinandresen/followers",
        "following_url": "https://api.github.com/users/gavinandresen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gavinandresen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gavinandresen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
        "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
        "repos_url": "https://api.github.com/users/gavinandresen/repos",
        "events_url": "https://api.github.com/users/gavinandresen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2011-09-01T18:59:35Z"
    },
    {
      "event": "referenced",
      "id": 934356636,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDkzNDM1NjYzNg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/934356636",
      "actor": {
        "login": "dexX7",
        "id": 5836089,
        "node_id": "MDQ6VXNlcjU4MzYwODk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5836089?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dexX7",
        "html_url": "https://github.com/dexX7",
        "followers_url": "https://api.github.com/users/dexX7/followers",
        "following_url": "https://api.github.com/users/dexX7/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dexX7/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dexX7/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dexX7/subscriptions",
        "organizations_url": "https://api.github.com/users/dexX7/orgs",
        "repos_url": "https://api.github.com/users/dexX7/repos",
        "events_url": "https://api.github.com/users/dexX7/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dexX7/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "3022c6b7c02ab90999ba2798540856a3853cb3d2",
      "commit_url": "https://api.github.com/repos/dexX7/bitcoin/commits/3022c6b7c02ab90999ba2798540856a3853cb3d2",
      "created_at": "2017-01-24T11:45:40Z"
    },
    {
      "event": "referenced",
      "id": 1063052413,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDEwNjMwNTI0MTM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1063052413",
      "actor": {
        "login": "dgenr8",
        "id": 4284124,
        "node_id": "MDQ6VXNlcjQyODQxMjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4284124?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dgenr8",
        "html_url": "https://github.com/dgenr8",
        "followers_url": "https://api.github.com/users/dgenr8/followers",
        "following_url": "https://api.github.com/users/dgenr8/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dgenr8/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dgenr8/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dgenr8/subscriptions",
        "organizations_url": "https://api.github.com/users/dgenr8/orgs",
        "repos_url": "https://api.github.com/users/dgenr8/repos",
        "events_url": "https://api.github.com/users/dgenr8/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dgenr8/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "77b1860792390bee65dad717573ceec7a4379e37",
      "commit_url": "https://api.github.com/repos/dgenr8/bitcoin/commits/77b1860792390bee65dad717573ceec7a4379e37",
      "created_at": "2017-04-29T06:17:01Z"
    },
    {
      "event": "referenced",
      "id": 1406893011,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDE0MDY4OTMwMTE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1406893011",
      "actor": {
        "login": "classesjack",
        "id": 34173563,
        "node_id": "MDQ6VXNlcjM0MTczNTYz",
        "avatar_url": "https://avatars.githubusercontent.com/u/34173563?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/classesjack",
        "html_url": "https://github.com/classesjack",
        "followers_url": "https://api.github.com/users/classesjack/followers",
        "following_url": "https://api.github.com/users/classesjack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/classesjack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/classesjack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/classesjack/subscriptions",
        "organizations_url": "https://api.github.com/users/classesjack/orgs",
        "repos_url": "https://api.github.com/users/classesjack/repos",
        "events_url": "https://api.github.com/users/classesjack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/classesjack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "d78dd1b1d5412ec3dd52a721469e03f6af565efb",
      "commit_url": "https://api.github.com/repos/classesjack/bitcoin/commits/d78dd1b1d5412ec3dd52a721469e03f6af565efb",
      "created_at": "2018-01-02T20:45:38Z"
    },
    {
      "event": "referenced",
      "id": 2686112304,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDI2ODYxMTIzMDQ=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2686112304",
      "actor": {
        "login": "kallewoof",
        "id": 250224,
        "node_id": "MDQ6VXNlcjI1MDIyNA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kallewoof",
        "html_url": "https://github.com/kallewoof",
        "followers_url": "https://api.github.com/users/kallewoof/followers",
        "following_url": "https://api.github.com/users/kallewoof/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/kallewoof/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/kallewoof/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
        "organizations_url": "https://api.github.com/users/kallewoof/orgs",
        "repos_url": "https://api.github.com/users/kallewoof/repos",
        "events_url": "https://api.github.com/users/kallewoof/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/kallewoof/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "823b9093e945357ee5142b4e4d8a3fbeb9143313",
      "commit_url": "https://api.github.com/repos/kallewoof/bitcoin/commits/823b9093e945357ee5142b4e4d8a3fbeb9143313",
      "created_at": "2019-10-04T04:05:56Z"
    },
    {
      "event": "locked",
      "id": 5271917171,
      "node_id": "LOE_lADOABII584AFKIdzwAAAAE6OxJz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5271917171",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-08T12:16:27Z",
      "lock_reason": "resolved"
    }
  ]
}